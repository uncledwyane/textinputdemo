/*! cn.tee3.avd-4.0.4.1 2022-07-26 06:51:11 */

var base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64DecodeChars=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);function base64encode(e){var t,r,o,n,i,a;for(o=e.length,r=0,t="";r<o;){if(n=255&e.charCodeAt(r++),r==o){t+=base64EncodeChars.charAt(n>>2),t+=base64EncodeChars.charAt((3&n)<<4),t+="==";break}if(i=e.charCodeAt(r++),r==o){t+=base64EncodeChars.charAt(n>>2),t+=base64EncodeChars.charAt((3&n)<<4|(240&i)>>4),t+=base64EncodeChars.charAt((15&i)<<2),t+="=";break}a=e.charCodeAt(r++),t+=base64EncodeChars.charAt(n>>2),t+=base64EncodeChars.charAt((3&n)<<4|(240&i)>>4),t+=base64EncodeChars.charAt((15&i)<<2|(192&a)>>6),t+=base64EncodeChars.charAt(63&a)}return t}function base64decode(e){var t,r,o,n,i,a,s;for(a=e.length,i=0,s="";i<a;){for(;t=base64DecodeChars[255&e.charCodeAt(i++)],i<a&&-1==t;);if(-1==t)break;for(;r=base64DecodeChars[255&e.charCodeAt(i++)],i<a&&-1==r;);if(-1==r)break;s+=String.fromCharCode(t<<2|(48&r)>>4);do{if(61==(o=255&e.charCodeAt(i++)))return s;o=base64DecodeChars[o]}while(i<a&&-1==o);if(-1==o)break;s+=String.fromCharCode((15&r)<<4|(60&o)>>2);do{if(61==(n=255&e.charCodeAt(i++)))return s;n=base64DecodeChars[n]}while(i<a&&-1==n);if(-1==n)break;s+=String.fromCharCode((3&o)<<6|n)}return s}function utf16to8(e){var t,r,o,n;for(t="",o=e.length,r=0;r<o;r++)1<=(n=e.charCodeAt(r))&&n<=127?t+=e.charAt(r):(2047<n?(t+=String.fromCharCode(224|n>>12&15),t+=String.fromCharCode(128|n>>6&63)):t+=String.fromCharCode(192|n>>6&31),t+=String.fromCharCode(128|n>>0&63));return t}function utf8to16(e){var t,r,o,n,i,a;for(t="",o=e.length,r=0;r<o;)switch((n=e.charCodeAt(r++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=e.charAt(r-1);break;case 12:case 13:i=e.charCodeAt(r++),t+=String.fromCharCode((31&n)<<6|63&i);break;case 14:i=e.charCodeAt(r++),a=e.charCodeAt(r++),t+=String.fromCharCode((15&n)<<12|(63&i)<<6|(63&a)<<0)}return t}function doit(){var e=document.f;e.output.value=base64encode(utf16to8(e.source.value)),e.decode.value=utf8to16(base64decode(e.output.value))}function SdpSerializer(e){for(var u={},n=[],t=!1,r=!1,o=!1,i=!1,a=e.split("\r\n"),s=0;s<a.length;s++){var d=a[s];t||0==d.indexOf("m=audio")?(t=!0,l("audio"),(d=a[s+1])&&0==d.indexOf("m=video")&&(i=t=!1)):r||0==d.indexOf("m=video")?(r=!0,l("video"),(d=a[s+1])&&0==d.indexOf("m=application")&&(i=r=!1)):o||0==d.indexOf("m=application")?(o=!0,l("data")):n.push(d)}function l(t){if(u[t])if(d=="a=mid:"+t){var e=a[s-1];e&&(u[t].direction=e.split("a=")[1],u[t].attributes.pop(1)),i=!0,u[t]["a=mid:"+t]={line:d,attributes:[]}}else if(i)if(0==d.indexOf("a=crypto:"))u[t].crypto[d.split("AES_CM_128_HMAC_SHA1_")[1].split(" ")[0]]=d;else if(0==d.indexOf("a=rtpmap:")){var r=d.split("a=rtpmap:")[1].split(" ");u[t].payload[r[0]]=r[1],function e(){(d=a[s+1])&&-1==d.indexOf("a=rtpmap:")&&-1==d.indexOf("m=")&&(-1!=d.indexOf("a=ssrc")&&u[t].ssrc.push(d),-1==d.indexOf("a=ssrc")&&(u[t].payload[r[0]]+="\r\n"+d),s++,e())}()}else u[t]["a=mid:"+t].attributes.push(d);else u[t].attributes.push(d);else if(u[t]={line:d,attributes:[],payload:{},ssrc:[],crypto:{}},-1!=d.indexOf("RTP/SAVPF"))for(var o=d.split("RTP/SAVPF ")[1].split(" "),n=0;n<o.length;n++)u[t].payload[o[n]]=""}function c(e){if(u[e]){for(var t=[],r="",o=0;o<u[e].ssrc.length;o++){var n=u[e].ssrc[o];""==r?r=n:r+="\r\n"+n,-1==n.indexOf("cname:")&&-1==n.indexOf("a=ssrc-group:")||t.push([]),0<t.length&&t[t.length-1].push(n)}u[e].ssrc=t,u[e].ssrcStr=r}}function p(e,t){if(!u[t])return e;e+=u[t].line+"\r\n";for(var r=0;r<u[t].attributes.length;r++)e+=u[t].attributes[r]+"\r\n";u[t].direction&&(e+="a="+u[t].direction+"\r\n"),e+="a=mid:"+t+"\r\n";for(r=0;r<u[t]["a=mid:"+t].attributes.length;r++)u[t]["a=mid:"+t].attributes[r]&&(e+=u[t]["a=mid:"+t].attributes[r]+"\r\n");for(var o in u[t].crypto)e+=u[t].crypto[o]+"\r\n";if(-1!=u[t].line.indexOf("RTP/SAVPF"))for(var n=u[t].line.split("RTP/SAVPF ")[1].split(" "),i=0;i<n.length;i++){var a=n[i];a&&(e+="a=rtpmap:"+a+" "+u[t].payload[a]+"\r\n")}for(var s=0;s<u[t].ssrc.length;s++)for(var d=u[t].ssrc[s],l=0;l<d.length;l++)e+=d[l]+"\r\n";return e}function h(r){return{mLine:r,payload:function(e){return u[this.mLine]&&u[this.mLine].payload[e]||log.error(e,"doesn'nt exits."),{payload:e,mLine:this.mLine,newLine:function(e){u[this.mLine].payload[this.payload]+="\r\n"+e},remove:function(){!function(e,t){if(u[t]&&-1!=u[t].line.indexOf(e)&&(u[t].payload[e]&&delete u[t].payload[e],-1!=u[t].line.indexOf("RTP/SAVPF"))){for(var r=u[t].line.split("RTP/SAVPF ")[1].split(" "),o=0;o<r.length;o++)r[o]==e&&delete r[o];r=swap(r),u[t].line=u[t].line.split("RTP/SAVPF ")[0]+"RTP/SAVPF "+r.join(" ")}}(this.payload,this.mLine)},order:function(e){!function(e,t,r){if(u[r]&&-1!=u[r].line.indexOf(e)&&-1!=u[r].line.indexOf("RTP/SAVPF")){for(var o=u[r].line.split("RTP/SAVPF ")[1].split(" "),n=[],i=0;i<o.length;i++)o[i]==e&&(n[t]=o[i],delete o[i]);for(i=0;i<o.length;i++)i<t&&(n[i]=o[i]),t<=i&&(n[i+1]=o[i]);n=swap(n),u[r].line=u[r].line.split("RTP/SAVPF ")[0]+"RTP/SAVPF "+n.join(" ")}}(this.payload,e,this.mLine)}}},remove:function(){!function(e){u[e]&&delete u[e];for(var t=0;t<n.length;t++)if(-1!=n[t].indexOf("a=group")){var r=n[t].split("a=group:BUNDLE ")[1].split(" ");n[t]="a=group:BUNDLE";for(var o=0;o<r.length;o++)r[o]!=e&&(n[t]+=" "+r[o])}}(this.mLine)},isRejected:function(){var e=u[this.mLine].line.split("m="+this.mLine)[1];return 0==parseInt(e)},crypto:function(e){var t=u[this.mLine].crypto[e];return{mLine:this.mLine,remove:function(){t&&delete u[this.mLine].crypto[e]},newLine:function(e){u[this.mLine].crypto[e.split("AES_CM_128_HMAC_SHA1_")[1].split(" ")[0]]=e}}},track:function(t){var e=u[r].ssrc[t];return{ssrc:e,set:function(e){u[this.mLine].ssrc[t]=e},mLine:this.mLine,remove:function(){e&&(delete u[r].ssrc[t],u[r].ssrc=swap(u[r].ssrc))}}}}}c("audio"),c("video"),c("data"),this.deserialize=function(){for(var e="",t=0;t<n.length;t++)e+=n[t]+"\r\n";return e=p(e=p(e=p(e,"audio"),"video"),"data")},this.audio=h("audio"),this.video=h("video"),this.data=h("data"),this._inner=u}function swap(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t}!function(e,t){"function"==typeof define&&define.amd?define([],t):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=t():(e.dcodeIO=e.dcodeIO||{}).Long=t()}(this,function(){"use strict";function h(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}try{Object.defineProperty(h.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1})}catch(e){}h.isLong=function(e){return!0===(e&&e.__isLong__)};var n={},i={};h.fromInt=function(e,t){var r,o;return t?0<=(e>>>=0)&&e<256&&(o=i[e])?o:(r=new h(e,(0|e)<0?-1:0,!0),0<=e&&e<256&&(i[e]=r),r):-128<=(e|=0)&&e<128&&(o=n[e])?o:(r=new h(e,e<0?-1:0,!1),-128<=e&&e<128&&(n[e]=r),r)},h.fromNumber=function(e,t){return t=!!t,isNaN(e)||!isFinite(e)?h.ZERO:!t&&e<=-a?h.MIN_VALUE:!t&&a<=e+1?h.MAX_VALUE:t&&o<=e?h.MAX_UNSIGNED_VALUE:e<0?h.fromNumber(-e,t).negate():new h(e%r|0,e/r|0,t)},h.fromBits=function(e,t,r){return new h(e,t,r)},h.fromString=function(e,t,r){if(0===e.length)throw Error("number format error: empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return h.ZERO;if("number"==typeof t&&(r=t,t=!1),(r=r||10)<2||36<r)throw Error("radix out of range: "+r);var o;if(0<(o=e.indexOf("-")))throw Error('number format error: interior "-" character: '+e);if(0===o)return h.fromString(e.substring(1),t,r).negate();for(var n=h.fromNumber(Math.pow(r,8)),i=h.ZERO,a=0;a<e.length;a+=8){var s=Math.min(8,e.length-a),d=parseInt(e.substring(a,a+s),r);if(s<8){var l=h.fromNumber(Math.pow(r,s));i=i.multiply(l).add(h.fromNumber(d))}else i=(i=i.multiply(n)).add(h.fromNumber(d))}return i.unsigned=t,i},h.fromValue=function(e){return e instanceof h?e:"number"==typeof e?h.fromNumber(e):"string"==typeof e?h.fromString(e):new h(e.low,e.high,e.unsigned)};var r=4294967296,o=r*r,a=o/2,f=h.fromInt(1<<24);return h.ZERO=h.fromInt(0),h.UZERO=h.fromInt(0,!0),h.ONE=h.fromInt(1),h.UONE=h.fromInt(1,!0),h.NEG_ONE=h.fromInt(-1),h.MAX_VALUE=h.fromBits(-1,2147483647,!1),h.MAX_UNSIGNED_VALUE=h.fromBits(-1,-1,!0),h.MIN_VALUE=h.fromBits(0,-2147483648,!1),h.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},h.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*r+(this.low>>>0):this.high*r+(this.low>>>0)},h.prototype.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix out of range: "+e);if(this.isZero())return"0";var t;if(this.isNegative()){if(this.equals(h.MIN_VALUE)){var r=h.fromNumber(e),o=this.divide(r);return t=o.multiply(r).subtract(this),o.toString(e)+t.toInt().toString(e)}return"-"+this.negate().toString(e)}var n=h.fromNumber(Math.pow(e,6),this.unsigned);t=this;for(var i="";;){var a=t.divide(n),s=(t.subtract(a.multiply(n)).toInt()>>>0).toString(e);if((t=a).isZero())return s+i;for(;s.length<6;)s="0"+s;i=""+s+i}},h.prototype.getHighBits=function(){return this.high},h.prototype.getHighBitsUnsigned=function(){return this.high>>>0},h.prototype.getLowBits=function(){return this.low},h.prototype.getLowBitsUnsigned=function(){return this.low>>>0},h.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(h.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;0<t&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},h.prototype.isZero=function(){return 0===this.high&&0===this.low},h.prototype.isNegative=function(){return!this.unsigned&&this.high<0},h.prototype.isPositive=function(){return this.unsigned||0<=this.high},h.prototype.isOdd=function(){return 1==(1&this.low)},h.prototype.isEven=function(){return 0==(1&this.low)},h.eq=h.prototype.equals=function(e){return h.isLong(e)||(e=h.fromValue(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},h.neq=h.prototype.notEquals=function(e){return!this.equals(e)},h.prototype.lt=h.prototype.lessThan=function(e){return this.compare(e)<0},h.prototype.lte=h.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},h.prototype.gt=h.prototype.greaterThan=function(e){return 0<this.compare(e)},h.prototype.gte=h.prototype.greaterThanOrEqual=function(e){return 0<=this.compare(e)},h.prototype.compare=function(e){if(h.isLong(e)||(e=h.fromValue(e)),this.equals(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.subtract(e).isNegative()?-1:1},h.prototype.neg=h.prototype.negate=function(){return!this.unsigned&&this.equals(h.MIN_VALUE)?h.MIN_VALUE:this.not().add(h.ONE)},h.prototype.add=function(e){h.isLong(e)||(e=h.fromValue(e));var t=this.high>>>16,r=65535&this.high,o=this.low>>>16,n=65535&this.low,i=e.high>>>16,a=65535&e.high,s=e.low>>>16,d=0,l=0,u=0,c=0;return u+=(c+=n+(65535&e.low))>>>16,l+=(u+=o+s)>>>16,d+=(l+=r+a)>>>16,d+=t+i,h.fromBits((u&=65535)<<16|(c&=65535),(d&=65535)<<16|(l&=65535),this.unsigned)},h.prototype.sub=h.prototype.subtract=function(e){return h.isLong(e)||(e=h.fromValue(e)),this.add(e.negate())},h.prototype.mul=h.prototype.multiply=function(e){if(this.isZero())return h.ZERO;if(h.isLong(e)||(e=h.fromValue(e)),e.isZero())return h.ZERO;if(this.equals(h.MIN_VALUE))return e.isOdd()?h.MIN_VALUE:h.ZERO;if(e.equals(h.MIN_VALUE))return this.isOdd()?h.MIN_VALUE:h.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(f)&&e.lessThan(f))return h.fromNumber(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,r=65535&this.high,o=this.low>>>16,n=65535&this.low,i=e.high>>>16,a=65535&e.high,s=e.low>>>16,d=65535&e.low,l=0,u=0,c=0,p=0;return c+=(p+=n*d)>>>16,u+=(c+=o*d)>>>16,c&=65535,u+=(c+=n*s)>>>16,l+=(u+=r*d)>>>16,u&=65535,l+=(u+=o*s)>>>16,u&=65535,l+=(u+=n*a)>>>16,l+=t*d+r*s+o*a+n*i,h.fromBits((c&=65535)<<16|(p&=65535),(l&=65535)<<16|(u&=65535),this.unsigned)},h.prototype.div=h.prototype.divide=function(e){if(h.isLong(e)||(e=h.fromValue(e)),e.isZero())throw new Error("division by zero");if(this.isZero())return this.unsigned?h.UZERO:h.ZERO;var t,r,o;{if(this.equals(h.MIN_VALUE))return e.equals(h.ONE)||e.equals(h.NEG_ONE)?h.MIN_VALUE:e.equals(h.MIN_VALUE)?h.ONE:(t=this.shiftRight(1).divide(e).shiftLeft(1)).equals(h.ZERO)?e.isNegative()?h.ONE:h.NEG_ONE:(r=this.subtract(e.multiply(t)),o=t.add(r.divide(e)));if(e.equals(h.MIN_VALUE))return this.unsigned?h.UZERO:h.ZERO}if(this.isNegative())return e.isNegative()?this.negate().divide(e.negate()):this.negate().divide(e).negate();if(e.isNegative())return this.divide(e.negate()).negate();for(o=h.ZERO,r=this;r.greaterThanOrEqual(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var n=Math.ceil(Math.log(t)/Math.LN2),i=n<=48?1:Math.pow(2,n-48),a=h.fromNumber(t),s=a.multiply(e);s.isNegative()||s.greaterThan(r);)s=(a=h.fromNumber(t-=i,this.unsigned)).multiply(e);a.isZero()&&(a=h.ONE),o=o.add(a),r=r.subtract(s)}return o},h.prototype.mod=h.prototype.modulo=function(e){return h.isLong(e)||(e=h.fromValue(e)),this.subtract(this.divide(e).multiply(e))},h.prototype.not=function(){return h.fromBits(~this.low,~this.high,this.unsigned)},h.prototype.and=function(e){return h.isLong(e)||(e=h.fromValue(e)),h.fromBits(this.low&e.low,this.high&e.high,this.unsigned)},h.prototype.or=function(e){return h.isLong(e)||(e=h.fromValue(e)),h.fromBits(this.low|e.low,this.high|e.high,this.unsigned)},h.prototype.xor=function(e){return h.isLong(e)||(e=h.fromValue(e)),h.fromBits(this.low^e.low,this.high^e.high,this.unsigned)},h.prototype.shl=h.prototype.shiftLeft=function(e){return h.isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?h.fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):h.fromBits(0,this.low<<e-32,this.unsigned)},h.prototype.shr=h.prototype.shiftRight=function(e){return h.isLong(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?h.fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):h.fromBits(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},h.prototype.shru=h.prototype.shiftRightUnsigned=function(e){if(h.isLong(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;if(e<32){var r=this.low;return h.fromBits(r>>>e|t<<32-e,t>>>e,this.unsigned)}return h.fromBits(32===e?t:t>>>e-32,0,this.unsigned)},h.prototype.toSigned=function(){return this.unsigned?new h(this.low,this.high,!1):this},h.prototype.toUnsigned=function(){return this.unsigned?this:new h(this.low,this.high,!0)},h}),function(e,t){"function"==typeof define&&define.amd?define(["long"],t):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=function(){var e;try{e=require("long")}catch(e){}return t(e)}():(e.dcodeIO=e.dcodeIO||{}).ByteBuffer=t(e.dcodeIO.Long)}(this,function(d){"use strict";var f=function(e,t,r){if(void 0===e&&(e=f.DEFAULT_CAPACITY),void 0===t&&(t=f.DEFAULT_ENDIAN),void 0===r&&(r=f.DEFAULT_NOASSERT),!r){if((e|=0)<0)throw RangeError("Illegal capacity");t=!!t,r=!!r}this.buffer=0===e?i:new ArrayBuffer(e),this.view=0===e?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=e,this.littleEndian=t,this.noAssert=r};f.VERSION="5.0.1",f.LITTLE_ENDIAN=!0,f.BIG_ENDIAN=!1,f.DEFAULT_CAPACITY=16,f.DEFAULT_ENDIAN=f.BIG_ENDIAN,f.DEFAULT_NOASSERT=!1,f.Long=d||null;var a=f.prototype;a.__isByteBuffer__;try{Object.defineProperty(a,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1})}catch(e){}try{var i=new ArrayBuffer(0)}catch(e){i=""}var r=String.fromCharCode;function s(e){var t=0;return function(){return t<e.length?e.charCodeAt(t++):null}}function l(){var e=[],t=[];return function(){if(0===arguments.length)return t.join("")+r.apply(String,e);1024<e.length+arguments.length&&(t.push(r.apply(String,e)),e.length=0),Array.prototype.push.apply(e,arguments)}}function o(e,t,r,o,n){var i,a,s=8*n-o-1,d=(1<<s)-1,l=d>>1,u=-7,c=r?n-1:0,p=r?-1:1,h=e[t+c];for(c+=p,i=h&(1<<-u)-1,h>>=-u,u+=s;0<u;i=256*i+e[t+c],c+=p,u-=8);for(a=i&(1<<-u)-1,i>>=-u,u+=o;0<u;a=256*a+e[t+c],c+=p,u-=8);if(0===i)i=1-l;else{if(i===d)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,o),i-=l}return(h?-1:1)*a*Math.pow(2,i-o)}function n(e,t,r,o,n,i){var a,s,d,l=8*i-n-1,u=(1<<l)-1,c=u>>1,p=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,h=o?0:i-1,f=o?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(d=Math.pow(2,-a))<1&&(a--,d*=2),2<=(t+=1<=a+c?p/d:p*Math.pow(2,1-c))*d&&(a++,d/=2),u<=a+c?(s=0,a=u):1<=a+c?(s=(t*d-1)*Math.pow(2,n),a+=c):(s=t*Math.pow(2,c-1)*Math.pow(2,n),a=0));8<=n;e[r+h]=255&s,h+=f,s/=256,n-=8);for(a=a<<n|s,l+=n;0<l;e[r+h]=255&a,h+=f,a/=256,l-=8);e[r+h-f]|=128*m}f.accessor=function(){return Uint8Array},f.allocate=function(e,t,r){return new f(e,t,r)},f.concat=function(e,t,r,o){"boolean"!=typeof t&&"string"==typeof t||(o=r,r=t,t=void 0);for(var n,i=0,a=0,s=e.length;a<s;++a)f.isByteBuffer(e[a])||(e[a]=f.wrap(e[a],t)),0<(n=e[a].limit-e[a].offset)&&(i+=n);if(0===i)return new f(0,r,o);var d,l=new f(i,r,o);for(a=0;a<s;)(n=(d=e[a++]).limit-d.offset)<=0||(l.view.set(d.view.subarray(d.offset,d.limit),l.offset),l.offset+=n);return l.limit=l.offset,l.offset=0,l},f.isByteBuffer=function(e){return!0===(e&&e.__isByteBuffer__)},f.type=function(){return ArrayBuffer},f.wrap=function(e,t,r,o){if("string"!=typeof t&&(o=r,r=t,t=void 0),"string"==typeof e)switch(void 0===t&&(t="utf8"),t){case"base64":return f.fromBase64(e,r);case"hex":return f.fromHex(e,r);case"binary":return f.fromBinary(e,r);case"utf8":return f.fromUTF8(e,r);case"debug":return f.fromDebug(e,r);default:throw Error("Unsupported encoding: "+t)}if(null===e||"object"!=typeof e)throw TypeError("Illegal buffer");var n;if(f.isByteBuffer(e))return(n=a.clone.call(e)).markedOffset=-1,n;if(e instanceof Uint8Array)n=new f(0,r,o),0<e.length&&(n.buffer=e.buffer,n.offset=e.byteOffset,n.limit=e.byteOffset+e.byteLength,n.view=new Uint8Array(e.buffer));else if(e instanceof ArrayBuffer)n=new f(0,r,o),0<e.byteLength&&(n.buffer=e,n.offset=0,n.limit=e.byteLength,n.view=0<e.byteLength?new Uint8Array(e):null);else{if("[object Array]"!==Object.prototype.toString.call(e))throw TypeError("Illegal buffer");(n=new f(e.length,r,o)).limit=e.length;for(var i=0;i<e.length;++i)n.view[i]=e[i]}return n},a.writeBitSet=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if(!(e instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var o,n=t,i=e.length,a=i>>3,s=0;for(t+=this.writeVarint32(i,t);a--;)o=1&!!e[s++]|(1&!!e[s++])<<1|(1&!!e[s++])<<2|(1&!!e[s++])<<3|(1&!!e[s++])<<4|(1&!!e[s++])<<5|(1&!!e[s++])<<6|(1&!!e[s++])<<7,this.writeByte(o,t++);if(s<i){var d=0;for(o=0;s<i;)o|=(1&!!e[s++])<<d++;this.writeByte(o,t++)}return r?(this.offset=t,this):t-n},a.readBitSet=function(e){var t=void 0===e;t&&(e=this.offset);var r,o=this.readVarint32(e),n=o.value,i=n>>3,a=0,s=[];for(e+=o.length;i--;)r=this.readByte(e++),s[a++]=!!(1&r),s[a++]=!!(2&r),s[a++]=!!(4&r),s[a++]=!!(8&r),s[a++]=!!(16&r),s[a++]=!!(32&r),s[a++]=!!(64&r),s[a++]=!!(128&r);if(a<n){var d=0;for(r=this.readByte(e++);a<n;)s[a++]=!!(r>>d++&1)}return t&&(this.offset=e),s},a.readBytes=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+"+e+") <= "+this.buffer.byteLength)}var o=this.slice(t,t+e);return r&&(this.offset+=e),o},a.writeBytes=a.append,a.writeInt8=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var o=this.buffer.byteLength;return o<t&&this.resize((o*=2)>t?o:t),t-=1,this.view[t]=e,r&&(this.offset+=1),this},a.writeByte=a.writeInt8,a.readInt8=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=this.view[e];return 128==(128&r)&&(r=-(255-r+1)),t&&(this.offset+=1),r},a.readByte=a.readInt8,a.writeUint8=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=1;var o=this.buffer.byteLength;return o<t&&this.resize((o*=2)>t?o:t),t-=1,this.view[t]=e,r&&(this.offset+=1),this},a.writeUInt8=a.writeUint8,a.readUint8=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=this.view[e];return t&&(this.offset+=1),r},a.readUInt8=a.readUint8,a.writeInt16=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var o=this.buffer.byteLength;return o<t&&this.resize((o*=2)>t?o:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),r&&(this.offset+=2),this},a.writeShort=a.writeInt16,a.readInt16=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[e],r|=this.view[e+1]<<8):(r=this.view[e]<<8,r|=this.view[e+1]),32768==(32768&r)&&(r=-(65535-r+1)),t&&(this.offset+=2),r},a.readShort=a.readInt16,a.writeUint16=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=2;var o=this.buffer.byteLength;return o<t&&this.resize((o*=2)>t?o:t),t-=2,this.littleEndian?(this.view[t+1]=(65280&e)>>>8,this.view[t]=255&e):(this.view[t]=(65280&e)>>>8,this.view[t+1]=255&e),r&&(this.offset+=2),this},a.writeUInt16=a.writeUint16,a.readUint16=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+2) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[e],r|=this.view[e+1]<<8):(r=this.view[e]<<8,r|=this.view[e+1]),t&&(this.offset+=2),r},a.readUInt16=a.readUint16,a.writeInt32=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var o=this.buffer.byteLength;return o<t&&this.resize((o*=2)>t?o:t),t-=4,this.littleEndian?(this.view[t+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e),r&&(this.offset+=4),this},a.writeInt=a.writeInt32,a.readInt32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[e+2]<<16,r|=this.view[e+1]<<8,r|=this.view[e],r+=this.view[e+3]<<24>>>0):(r=this.view[e+1]<<16,r|=this.view[e+2]<<8,r|=this.view[e+3],r+=this.view[e]<<24>>>0),r|=0,t&&(this.offset+=4),r},a.readInt=a.readInt32,a.writeUint32=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var o=this.buffer.byteLength;return o<t&&this.resize((o*=2)>t?o:t),t-=4,this.littleEndian?(this.view[t+3]=e>>>24&255,this.view[t+2]=e>>>16&255,this.view[t+1]=e>>>8&255,this.view[t]=255&e):(this.view[t]=e>>>24&255,this.view[t+1]=e>>>16&255,this.view[t+2]=e>>>8&255,this.view[t+3]=255&e),r&&(this.offset+=4),this},a.writeUInt32=a.writeUint32,a.readUint32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[e+2]<<16,r|=this.view[e+1]<<8,r|=this.view[e],r+=this.view[e+3]<<24>>>0):(r=this.view[e+1]<<16,r|=this.view[e+2]<<8,r|=this.view[e+3],r+=this.view[e]<<24>>>0),t&&(this.offset+=4),r},a.readUInt32=a.readUint32,d&&(a.writeInt64=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"==typeof e)e=d.fromNumber(e);else if("string"==typeof e)e=d.fromString(e);else if(!(e&&e instanceof d))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=d.fromNumber(e):"string"==typeof e&&(e=d.fromString(e)),t+=8;var o=this.buffer.byteLength;o<t&&this.resize((o*=2)>t?o:t),t-=8;var n=e.low,i=e.high;return this.littleEndian?(this.view[t+3]=n>>>24&255,this.view[t+2]=n>>>16&255,this.view[t+1]=n>>>8&255,this.view[t]=255&n,t+=4,this.view[t+3]=i>>>24&255,this.view[t+2]=i>>>16&255,this.view[t+1]=i>>>8&255,this.view[t]=255&i):(this.view[t]=i>>>24&255,this.view[t+1]=i>>>16&255,this.view[t+2]=i>>>8&255,this.view[t+3]=255&i,t+=4,this.view[t]=n>>>24&255,this.view[t+1]=n>>>16&255,this.view[t+2]=n>>>8&255,this.view[t+3]=255&n),r&&(this.offset+=8),this},a.writeLong=a.writeInt64,a.readInt64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var r=0,o=0;this.littleEndian?(r=this.view[e+2]<<16,r|=this.view[e+1]<<8,r|=this.view[e],r+=this.view[e+3]<<24>>>0,e+=4,o=this.view[e+2]<<16,o|=this.view[e+1]<<8,o|=this.view[e],o+=this.view[e+3]<<24>>>0):(o=this.view[e+1]<<16,o|=this.view[e+2]<<8,o|=this.view[e+3],o+=this.view[e]<<24>>>0,e+=4,r=this.view[e+1]<<16,r|=this.view[e+2]<<8,r|=this.view[e+3],r+=this.view[e]<<24>>>0);var n=new d(r,o,!1);return t&&(this.offset+=8),n},a.readLong=a.readInt64,a.writeUint64=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"==typeof e)e=d.fromNumber(e);else if("string"==typeof e)e=d.fromString(e);else if(!(e&&e instanceof d))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=d.fromNumber(e):"string"==typeof e&&(e=d.fromString(e)),t+=8;var o=this.buffer.byteLength;o<t&&this.resize((o*=2)>t?o:t),t-=8;var n=e.low,i=e.high;return this.littleEndian?(this.view[t+3]=n>>>24&255,this.view[t+2]=n>>>16&255,this.view[t+1]=n>>>8&255,this.view[t]=255&n,t+=4,this.view[t+3]=i>>>24&255,this.view[t+2]=i>>>16&255,this.view[t+1]=i>>>8&255,this.view[t]=255&i):(this.view[t]=i>>>24&255,this.view[t+1]=i>>>16&255,this.view[t+2]=i>>>8&255,this.view[t+3]=255&i,t+=4,this.view[t]=n>>>24&255,this.view[t+1]=n>>>16&255,this.view[t+2]=n>>>8&255,this.view[t+3]=255&n),r&&(this.offset+=8),this},a.writeUInt64=a.writeUint64,a.readUint64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var r=0,o=0;this.littleEndian?(r=this.view[e+2]<<16,r|=this.view[e+1]<<8,r|=this.view[e],r+=this.view[e+3]<<24>>>0,e+=4,o=this.view[e+2]<<16,o|=this.view[e+1]<<8,o|=this.view[e],o+=this.view[e+3]<<24>>>0):(o=this.view[e+1]<<16,o|=this.view[e+2]<<8,o|=this.view[e+3],o+=this.view[e]<<24>>>0,e+=4,r=this.view[e+1]<<16,r|=this.view[e+2]<<8,r|=this.view[e+3],r+=this.view[e]<<24>>>0);var n=new d(r,o,!0);return t&&(this.offset+=8),n},a.readUInt64=a.readUint64),a.writeFloat32=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=4;var o=this.buffer.byteLength;return o<t&&this.resize((o*=2)>t?o:t),t-=4,n(this.view,e,t,this.littleEndian,23,4),r&&(this.offset+=4),this},a.writeFloat=a.writeFloat32,a.readFloat32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=o(this.view,e,this.littleEndian,23,4);return t&&(this.offset+=4),r},a.readFloat=a.readFloat32,a.writeFloat64=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}t+=8;var o=this.buffer.byteLength;return o<t&&this.resize((o*=2)>t?o:t),t-=8,n(this.view,e,t,this.littleEndian,52,8),r&&(this.offset+=8),this},a.writeDouble=a.writeFloat64,a.readFloat64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var r=o(this.view,e,this.littleEndian,52,8);return t&&(this.offset+=8),r},a.readDouble=a.readFloat64,f.MAX_VARINT32_BYTES=5,f.calculateVarint32=function(e){return(e>>>=0)<128?1:e<16384?2:e<1<<21?3:e<1<<28?4:5},f.zigZagEncode32=function(e){return((e|=0)<<1^e>>31)>>>0},f.zigZagDecode32=function(e){return e>>>1^-(1&e)|0},a.writeVarint32=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var o,n=f.calculateVarint32(e);t+=n;var i=this.buffer.byteLength;for(i<t&&this.resize((i*=2)>t?i:t),t-=n,e>>>=0;128<=e;)o=127&e|128,this.view[t++]=o,e>>>=7;return this.view[t++]=e,r?(this.offset=t,this):n},a.writeVarint32ZigZag=function(e,t){return this.writeVarint32(f.zigZagEncode32(e),t)},a.readVarint32=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r,o=0,n=0;do{if(!this.noAssert&&e>this.limit){var i=Error("Truncated");throw i.truncated=!0,i}r=this.view[e++],o<5&&(n|=(127&r)<<7*o),++o}while(0!=(128&r));return n|=0,t?(this.offset=e,n):{value:n,length:o}},a.readVarint32ZigZag=function(e){var t=this.readVarint32(e);return"object"==typeof t?t.value=f.zigZagDecode32(t.value):t=f.zigZagDecode32(t),t},d&&(f.MAX_VARINT64_BYTES=10,f.calculateVarint64=function(e){"number"==typeof e?e=d.fromNumber(e):"string"==typeof e&&(e=d.fromString(e));var t=e.toInt()>>>0,r=e.shiftRightUnsigned(28).toInt()>>>0,o=e.shiftRightUnsigned(56).toInt()>>>0;return 0==o?0==r?t<16384?t<128?1:2:t<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:o<128?9:10},f.zigZagEncode64=function(e){return"number"==typeof e?e=d.fromNumber(e,!1):"string"==typeof e?e=d.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftLeft(1).xor(e.shiftRight(63)).toUnsigned()},f.zigZagDecode64=function(e){return"number"==typeof e?e=d.fromNumber(e,!1):"string"==typeof e?e=d.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftRightUnsigned(1).xor(e.and(d.ONE).toSigned().negate()).toSigned()},a.writeVarint64=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("number"==typeof e)e=d.fromNumber(e);else if("string"==typeof e)e=d.fromString(e);else if(!(e&&e instanceof d))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=d.fromNumber(e,!1):"string"==typeof e?e=d.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned());var o=f.calculateVarint64(e),n=e.toInt()>>>0,i=e.shiftRightUnsigned(28).toInt()>>>0,a=e.shiftRightUnsigned(56).toInt()>>>0;t+=o;var s=this.buffer.byteLength;switch(s<t&&this.resize((s*=2)>t?s:t),t-=o,o){case 10:this.view[t+9]=a>>>7&1;case 9:this.view[t+8]=9!==o?128|a:127&a;case 8:this.view[t+7]=8!==o?i>>>21|128:i>>>21&127;case 7:this.view[t+6]=7!==o?i>>>14|128:i>>>14&127;case 6:this.view[t+5]=6!==o?i>>>7|128:i>>>7&127;case 5:this.view[t+4]=5!==o?128|i:127&i;case 4:this.view[t+3]=4!==o?n>>>21|128:n>>>21&127;case 3:this.view[t+2]=3!==o?n>>>14|128:n>>>14&127;case 2:this.view[t+1]=2!==o?n>>>7|128:n>>>7&127;case 1:this.view[t]=1!==o?128|n:127&n}return r?(this.offset+=o,this):o},a.writeVarint64ZigZag=function(e,t){return this.writeVarint64(f.zigZagEncode64(e),t)},a.readVarint64=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=e,o=0,n=0,i=0,a=0;if(o=127&(a=this.view[e++]),128&a&&(o|=(127&(a=this.view[e++]))<<7,(128&a||this.noAssert&&void 0===a)&&(o|=(127&(a=this.view[e++]))<<14,(128&a||this.noAssert&&void 0===a)&&(o|=(127&(a=this.view[e++]))<<21,(128&a||this.noAssert&&void 0===a)&&(n=127&(a=this.view[e++]),(128&a||this.noAssert&&void 0===a)&&(n|=(127&(a=this.view[e++]))<<7,(128&a||this.noAssert&&void 0===a)&&(n|=(127&(a=this.view[e++]))<<14,(128&a||this.noAssert&&void 0===a)&&(n|=(127&(a=this.view[e++]))<<21,(128&a||this.noAssert&&void 0===a)&&(i=127&(a=this.view[e++]),(128&a||this.noAssert&&void 0===a)&&(i|=(127&(a=this.view[e++]))<<7,128&a||this.noAssert&&void 0===a))))))))))throw Error("Buffer overrun");var s=d.fromBits(o|n<<28,n>>>4|i<<24,!1);return t?(this.offset=e,s):{value:s,length:e-r}},a.readVarint64ZigZag=function(e){var t=this.readVarint64(e);return t&&t.value instanceof d?t.value=f.zigZagDecode64(t.value):t=f.zigZagDecode64(t),t}),a.writeCString=function(e,t){var r=void 0===t;r&&(t=this.offset);var o,n=e.length;if(!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");for(o=0;o<n;++o)if(0===e.charCodeAt(o))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}n=p.calculateUTF16asUTF8(s(e))[1],t+=n+1;var i=this.buffer.byteLength;return i<t&&this.resize((i*=2)>t?i:t),t-=n+1,p.encodeUTF16toUTF8(s(e),function(e){this.view[t++]=e}.bind(this)),this.view[t++]=0,r?(this.offset=t,this):n},a.readCString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r,o=e,n=-1;return p.decodeUTF8toUTF16(function(){if(0===n)return null;if(e>=this.limit)throw RangeError("Illegal range: Truncated data, "+e+" < "+this.limit);return 0===(n=this.view[e++])?null:n}.bind(this),r=l(),!0),t?(this.offset=e,r()):{string:r(),length:e-o}},a.writeIString=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var o,n=t;o=p.calculateUTF16asUTF8(s(e),this.noAssert)[1],t+=4+o;var i=this.buffer.byteLength;if(i<t&&this.resize((i*=2)>t?i:t),t-=4+o,this.littleEndian?(this.view[t+3]=o>>>24&255,this.view[t+2]=o>>>16&255,this.view[t+1]=o>>>8&255,this.view[t]=255&o):(this.view[t]=o>>>24&255,this.view[t+1]=o>>>16&255,this.view[t+2]=o>>>8&255,this.view[t+3]=255&o),t+=4,p.encodeUTF16toUTF8(s(e),function(e){this.view[t++]=e}.bind(this)),t!==n+4+o)throw RangeError("Illegal range: Truncated data, "+t+" == "+(t+4+o));return r?(this.offset=t,this):t-n},a.readIString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var r=e,o=this.readUint32(e),n=this.readUTF8String(o,f.METRICS_BYTES,e+=4);return e+=n.length,t?(this.offset=e,n.string):{string:n.string,length:e-r}},f.METRICS_CHARS="c",f.METRICS_BYTES="b",a.writeUTF8String=function(e,t){var r,o=void 0===t;if(o&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var n=t;r=p.calculateUTF16asUTF8(s(e))[1],t+=r;var i=this.buffer.byteLength;return i<t&&this.resize((i*=2)>t?i:t),t-=r,p.encodeUTF16toUTF8(s(e),function(e){this.view[t++]=e}.bind(this)),o?(this.offset=t,this):t-n},a.writeString=a.writeUTF8String,f.calculateUTF8Chars=function(e){return p.calculateUTF16asUTF8(s(e))[0]},f.calculateUTF8Bytes=function(e){return p.calculateUTF16asUTF8(s(e))[1]},f.calculateString=f.calculateUTF8Bytes,a.readUTF8String=function(e,t,r){"number"==typeof t&&(r=t,t=void 0);var o=void 0===r;if(o&&(r=this.offset),void 0===t&&(t=f.METRICS_CHARS),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal length: "+e+" (not an integer)");if(e|=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var n,i=0,a=r;if(t===f.METRICS_CHARS){if(n=l(),p.decodeUTF8(function(){return i<e&&r<this.limit?this.view[r++]:null}.bind(this),function(e){++i,p.UTF8toUTF16(e,n)}),i!==e)throw RangeError("Illegal range: Truncated data, "+i+" == "+e);return o?(this.offset=r,n()):{string:n(),length:r-a}}if(t!==f.METRICS_BYTES)throw TypeError("Unsupported metrics: "+t);if(!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+"+e+") <= "+this.buffer.byteLength)}var s=r+e;if(p.decodeUTF8toUTF16(function(){return r<s?this.view[r++]:null}.bind(this),n=l(),this.noAssert),r!==s)throw RangeError("Illegal range: Truncated data, "+r+" == "+s);return o?(this.offset=r,n()):{string:n(),length:r-a}},a.readString=a.readUTF8String,a.writeVString=function(e,t){var r=void 0===t;if(r&&(t=this.offset),!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}var o,n,i=t;o=p.calculateUTF16asUTF8(s(e),this.noAssert)[1],n=f.calculateVarint32(o),t+=n+o;var a=this.buffer.byteLength;if(a<t&&this.resize((a*=2)>t?a:t),t-=n+o,t+=this.writeVarint32(o,t),p.encodeUTF16toUTF8(s(e),function(e){this.view[t++]=e}.bind(this)),t!==i+o+n)throw RangeError("Illegal range: Truncated data, "+t+" == "+(t+o+n));return r?(this.offset=t,this):t-i},a.readVString=function(e){var t=void 0===e;if(t&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var r=e,o=this.readVarint32(e),n=this.readUTF8String(o.value,f.METRICS_BYTES,e+=o.length);return e+=n.length,t?(this.offset=e,n.string):{string:n.string,length:e-r}},a.append=function(e,t,r){"number"!=typeof t&&"string"==typeof t||(r=t,t=void 0);var o=void 0===r;if(o&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}e instanceof f||(e=f.wrap(e,t));var n=e.limit-e.offset;if(n<=0)return this;r+=n;var i=this.buffer.byteLength;return i<r&&this.resize((i*=2)>r?i:r),r-=n,this.view.set(e.view.subarray(e.offset,e.limit),r),e.offset+=n,o&&(this.offset+=n),this},a.appendTo=function(e,t){return e.append(this,t),this},a.assert=function(e){return this.noAssert=!e,this},a.capacity=function(){return this.buffer.byteLength},a.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},a.clone=function(e){var t=new f(0,this.littleEndian,this.noAssert);return e?(t.buffer=new ArrayBuffer(this.buffer.byteLength),t.view=new Uint8Array(t.buffer)):(t.buffer=this.buffer,t.view=this.view),t.offset=this.offset,t.markedOffset=this.markedOffset,t.limit=this.limit,t},a.compact=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(0===e&&t===this.buffer.byteLength)return this;var r=t-e;if(0===r)return this.buffer=i,this.view=null,0<=this.markedOffset&&(this.markedOffset-=e),this.offset=0,this.limit=0,this;var o=new ArrayBuffer(r),n=new Uint8Array(o);return n.set(this.view.subarray(e,t)),this.buffer=o,this.view=n,0<=this.markedOffset&&(this.markedOffset-=e),this.offset=0,this.limit=r,this},a.copy=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}if(e===t)return new f(0,this.littleEndian,this.noAssert);var r=t-e,o=new f(r,this.littleEndian,this.noAssert);return o.offset=0,o.limit=r,0<=o.markedOffset&&(o.markedOffset-=e),this.copyTo(o,0,e,t),o},a.copyTo=function(e,t,r,o){var n,i;if(!this.noAssert&&!f.isByteBuffer(e))throw TypeError("Illegal target: Not a ByteBuffer");if(t=(i=void 0===t)?e.offset:0|t,r=(n=void 0===r)?this.offset:0|r,o=void 0===o?this.limit:0|o,t<0||t>e.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+t+" <= "+e.buffer.byteLength);if(r<0||o>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+r+" <= "+this.buffer.byteLength);var a=o-r;return 0===a?e:(e.ensureCapacity(t+a),e.view.set(this.view.subarray(r,o),t),n&&(this.offset+=a),i&&(e.offset+=a),this)},a.ensureCapacity=function(e){var t=this.buffer.byteLength;return t<e?this.resize((t*=2)>e?t:e):this},a.fill=function(e,t,r){var o=void 0===t;if(o&&(t=this.offset),"string"==typeof e&&0<e.length&&(e=e.charCodeAt(0)),void 0===t&&(t=this.offset),void 0===r&&(r=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal end: Not an integer");if(r>>>=0,t<0||r<t||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+r+" <= "+this.buffer.byteLength)}if(r<=t)return this;for(;t<r;)this.view[t++]=e;return o&&(this.offset=t),this},a.flip=function(){return this.limit=this.offset,this.offset=0,this},a.mark=function(e){if(e=void 0===e?this.offset:e,!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=e,this},a.order=function(e){if(!this.noAssert&&"boolean"!=typeof e)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!e,this},a.LE=function(e){return this.littleEndian=void 0===e||!!e,this},a.BE=function(e){return this.littleEndian=void 0!==e&&!e,this},a.prepend=function(e,t,r){"number"!=typeof t&&"string"==typeof t||(r=t,t=void 0);var o=void 0===r;if(o&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}e instanceof f||(e=f.wrap(e,t));var n=e.limit-e.offset;if(n<=0)return this;var i=n-r;if(0<i){var a=new ArrayBuffer(this.buffer.byteLength+i),s=new Uint8Array(a);s.set(this.view.subarray(r,this.buffer.byteLength),n),this.buffer=a,this.view=s,this.offset+=i,0<=this.markedOffset&&(this.markedOffset+=i),this.limit+=i,r+=i}else new Uint8Array(this.buffer);return this.view.set(e.view.subarray(e.offset,e.limit),r-n),e.offset=e.limit,o&&(this.offset-=n),this},a.prependTo=function(e,t){return e.prepend(this,t),this},a.printDebug=function(e){"function"!=typeof e&&(e=console.log.bind(console)),e(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},a.remaining=function(){return this.limit-this.offset},a.reset=function(){return 0<=this.markedOffset?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},a.resize=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal capacity: "+e+" (not an integer)");if((e|=0)<0)throw RangeError("Illegal capacity: 0 <= "+e)}if(this.buffer.byteLength<e){var t=new ArrayBuffer(e),r=new Uint8Array(t);r.set(this.view),this.buffer=t,this.view=r}return this},a.reverse=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}return e===t||Array.prototype.reverse.call(this.view.subarray(e,t)),this},a.skip=function(e){if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal length: "+e+" (not an integer)");e|=0}var t=this.offset+e;if(!this.noAssert&&(t<0||t>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+e+" <= "+this.buffer.byteLength);return this.offset=t,this},a.slice=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}var r=this.clone();return r.offset=e,r.limit=t,r},a.toBuffer=function(e){var t=this.offset,r=this.limit;if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: Not an integer");if(t>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal limit: Not an integer");if(r>>>=0,t<0||r<t||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+r+" <= "+this.buffer.byteLength)}if(!e&&0===t&&r===this.buffer.byteLength)return this.buffer;if(t===r)return i;var o=new ArrayBuffer(r-t);return new Uint8Array(o).set(new Uint8Array(this.buffer).subarray(t,r),0),o},a.toArrayBuffer=a.toBuffer,a.toString=function(e,t,r){if(void 0===e)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof e&&(r=t=e="utf8"),e){case"utf8":return this.toUTF8(t,r);case"base64":return this.toBase64(t,r);case"hex":return this.toHex(t,r);case"binary":return this.toBinary(t,r);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+e)}};var u=function(){for(var e={},n=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],a=[],t=0,r=n.length;t<r;++t)a[n[t]]=t;return e.encode=function(e,t){for(var r,o;null!==(r=e());)t(n[r>>2&63]),o=(3&r)<<4,null!==(r=e())?(t(n[63&((o|=r>>4&15)|r>>4&15)]),o=(15&r)<<2,null!==(r=e())?(t(n[63&(o|r>>6&3)]),t(n[63&r])):(t(n[63&o]),t(61))):(t(n[63&o]),t(61),t(61))},e.decode=function(e,t){var r,o,n;function i(e){throw Error("Illegal character code: "+e)}for(;null!==(r=e());)if(void 0===(o=a[r])&&i(r),null!==(r=e())&&(void 0===(n=a[r])&&i(r),t(o<<2>>>0|(48&n)>>4),null!==(r=e()))){if(void 0===(o=a[r])){if(61===r)break;i(r)}if(t((15&n)<<4>>>0|(60&o)>>2),null!==(r=e())){if(void 0===(n=a[r])){if(61===r)break;i(r)}t((3&o)<<6>>>0|n)}}},e.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)},e}();a.toBase64=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),t|=0,(e|=0)<0||t>this.capacity||t<e)throw RangeError("begin, end");var r;return u.encode(function(){return e<t?this.view[e++]:null}.bind(this),r=l()),r()},f.fromBase64=function(e,t){if("string"!=typeof e)throw TypeError("str");var r=new f(e.length/4*3,t),o=0;return u.decode(s(e),function(e){r.view[o++]=e}),r.limit=o,r},f.btoa=function(e){return f.fromBinary(e).toBase64()},f.atob=function(e){return f.fromBase64(e).toBinary()},a.toBinary=function(e,t){if(void 0===e&&(e=this.offset),void 0===t&&(t=this.limit),t|=0,(e|=0)<0||t>this.capacity()||t<e)throw RangeError("begin, end");if(e===t)return"";for(var r=[],o=[];e<t;)r.push(this.view[e++]),1024<=r.length&&(o.push(String.fromCharCode.apply(String,r)),r=[]);return o.join("")+String.fromCharCode.apply(String,r)},f.fromBinary=function(e,t){if("string"!=typeof e)throw TypeError("str");for(var r,o=0,n=e.length,i=new f(n,t);o<n;){if(255<(r=e.charCodeAt(o)))throw RangeError("illegal char code: "+r);i.view[o++]=r}return i.limit=n,i},a.toDebug=function(e){for(var t,r=-1,o=this.buffer.byteLength,n="",i="",a="";r<o;){if(-1!==r&&(n+=(t=this.view[r])<16?"0"+t.toString(16).toUpperCase():t.toString(16).toUpperCase(),e&&(i+=32<t&&t<127?String.fromCharCode(t):".")),++r,e&&0<r&&r%16==0&&r!==o){for(;n.length<51;)n+=" ";a+=n+i+"\n",n=i=""}r===this.offset&&r===this.limit?n+=r===this.markedOffset?"!":"|":r===this.offset?n+=r===this.markedOffset?"[":"<":r===this.limit?n+=r===this.markedOffset?"]":">":n+=r===this.markedOffset?"'":e||0!==r&&r!==o?" ":""}if(e&&" "!==n){for(;n.length<51;)n+=" ";a+=n+i+"\n"}return e?a:n},f.fromDebug=function(e,t,r){for(var o,n,i=e.length,a=new f((i+1)/3|0,t,r),s=0,d=0,l=!1,u=!1,c=!1,p=!1,h=!1;s<i;){switch(o=e.charAt(s++)){case"!":if(!r){if(u||c||p){h=!0;break}u=c=p=!0}a.offset=a.markedOffset=a.limit=d,l=!1;break;case"|":if(!r){if(u||p){h=!0;break}u=p=!0}a.offset=a.limit=d,l=!1;break;case"[":if(!r){if(u||c){h=!0;break}u=c=!0}a.offset=a.markedOffset=d,l=!1;break;case"<":if(!r){if(u){h=!0;break}u=!0}a.offset=d,l=!1;break;case"]":if(!r){if(p||c){h=!0;break}p=c=!0}a.limit=a.markedOffset=d,l=!1;break;case">":if(!r){if(p){h=!0;break}p=!0}a.limit=d,l=!1;break;case"'":if(!r){if(c){h=!0;break}c=!0}a.markedOffset=d,l=!1;break;case" ":l=!1;break;default:if(!r&&l){h=!0;break}if(n=parseInt(o+e.charAt(s++),16),!r&&(isNaN(n)||n<0||255<n))throw TypeError("Illegal str: Not a debug encoded string");a.view[d++]=n,l=!0}if(h)throw TypeError("Illegal str: Invalid symbol at "+s)}if(!r){if(!u||!p)throw TypeError("Illegal str: Missing offset or limit");if(d<a.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+d+" < "+i)}return a},a.toHex=function(e,t){if(e=void 0===e?this.offset:e,t=void 0===t?this.limit:t,!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof t||t%1!=0)throw TypeError("Illegal end: Not an integer");if(t>>>=0,e<0||t<e||t>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+t+" <= "+this.buffer.byteLength)}for(var r,o=new Array(t-e);e<t;)(r=this.view[e++])<16?o.push("0",r.toString(16)):o.push(r.toString(16));return o.join("")},f.fromHex=function(e,t,r){if(!r){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");if(e.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var o,n=e.length,i=new f(n/2|0,t),a=0,s=0;a<n;a+=2){if(o=parseInt(e.substring(a,a+2),16),!r&&(!isFinite(o)||o<0||255<o))throw TypeError("Illegal str: Contains non-hex characters");i.view[s++]=o}return i.limit=s,i};var c,p=c={MAX_CODEPOINT:1114111,encodeUTF8:function(e,t){var r=null;for("number"==typeof e&&(r=e,e=function(){return null});null!==r||null!==(r=e());)r<128?t(127&r):(r<2048?t(r>>6&31|192):(r<65536?t(r>>12&15|224):(t(r>>18&7|240),t(r>>12&63|128)),t(r>>6&63|128)),t(63&r|128)),r=null},decodeUTF8:function(e,t){for(var r,o,n,i,a=function(e){e=e.slice(0,e.indexOf(null));var t=Error(e.toString());throw t.name="TruncatedError",t.bytes=e,t};null!==(r=e());)if(0==(128&r))t(r);else if(192==(224&r))null===(o=e())&&a([r,o]),t((31&r)<<6|63&o);else if(224==(240&r))(null===(o=e())||null===(n=e()))&&a([r,o,n]),t((15&r)<<12|(63&o)<<6|63&n);else{if(240!=(248&r))throw RangeError("Illegal starting byte: "+r);(null===(o=e())||null===(n=e())||null===(i=e()))&&a([r,o,n,i]),t((7&r)<<18|(63&o)<<12|(63&n)<<6|63&i)}},UTF16toUTF8:function(e,t){for(var r,o=null;null!==(r=null!==o?o:e());)55296<=r&&r<=57343&&null!==(o=e())&&56320<=o&&o<=57343?(t(1024*(r-55296)+o-56320+65536),o=null):t(r);null!==o&&t(o)},UTF8toUTF16:function(e,t){var r=null;for("number"==typeof e&&(r=e,e=function(){return null});null!==r||null!==(r=e());)r<=65535?t(r):(t(55296+((r-=65536)>>10)),t(r%1024+56320)),r=null},encodeUTF16toUTF8:function(e,t){c.UTF16toUTF8(e,function(e){c.encodeUTF8(e,t)})},decodeUTF8toUTF16:function(e,t){c.decodeUTF8(e,function(e){c.UTF8toUTF16(e,t)})},calculateCodePoint:function(e){return e<128?1:e<2048?2:e<65536?3:4},calculateUTF8:function(e){for(var t,r=0;null!==(t=e());)r+=t<128?1:t<2048?2:t<65536?3:4;return r},calculateUTF16asUTF8:function(e){var t=0,r=0;return c.UTF16toUTF8(e,function(e){++t,r+=e<128?1:e<2048?2:e<65536?3:4}),[t,r]}};return a.toUTF8=function(t,r){if(void 0===t&&(t=this.offset),void 0===r&&(r=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal end: Not an integer");if(r>>>=0,t<0||r<t||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+r+" <= "+this.buffer.byteLength)}var e;try{p.decodeUTF8toUTF16(function(){return t<r?this.view[t++]:null}.bind(this),e=l())}catch(e){if(t!==r)throw RangeError("Illegal range: Truncated data, "+t+" != "+r)}return e()},f.fromUTF8=function(e,t,r){if(!r&&"string"!=typeof e)throw TypeError("Illegal str: Not a string");var o=new f(p.calculateUTF16asUTF8(s(e),!0)[1],t,r),n=0;return p.encodeUTF16toUTF8(s(e),function(e){o.view[n++]=e}),o.limit=n,o},f}),function(e,t){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e():t.log4javascript=e()}(function(){function isUndefined(e){return void 0===e}function EventSupport(){}Array.prototype.push||(Array.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)this[this.length]=arguments[e];return this.length}),Array.prototype.shift||(Array.prototype.shift=function(){if(0<this.length){for(var e=this[0],t=0,r=this.length-1;t<r;t++)this[t]=this[t+1];return this.length=this.length-1,e}}),Array.prototype.splice||(Array.prototype.splice=function(e,t){var r=this.slice(e+t),o=this.slice(e,e+t);this.length=e;for(var n=[],i=0,a=arguments.length;i<a;i++)n[i]=arguments[i];var s=2<n.length?r=n.slice(2).concat(r):r;for(i=0,a=s.length;i<a;i++)this.push(s[i]);return o}),EventSupport.prototype={eventTypes:[],eventListeners:{},setEventTypes:function(e){if(e instanceof Array){this.eventTypes=e,this.eventListeners={};for(var t=0,r=this.eventTypes.length;t<r;t++)this.eventListeners[this.eventTypes[t]]=[]}else handleError("log4javascript.EventSupport ["+this+"]: setEventTypes: eventTypes parameter must be an Array")},addEventListener:function(e,t){"function"==typeof t?(array_contains(this.eventTypes,e)||handleError("log4javascript.EventSupport ["+this+"]: addEventListener: no event called '"+e+"'"),this.eventListeners[e].push(t)):handleError("log4javascript.EventSupport ["+this+"]: addEventListener: listener must be a function")},removeEventListener:function(e,t){"function"==typeof t?(array_contains(this.eventTypes,e)||handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: no event called '"+e+"'"),array_remove(this.eventListeners[e],t)):handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: listener must be a function")},dispatchEvent:function(e,t){if(array_contains(this.eventTypes,e))for(var r=this.eventListeners[e],o=0,n=r.length;o<n;o++)r[o](this,e,t);else handleError("log4javascript.EventSupport ["+this+"]: dispatchEvent: no event called '"+e+"'")}};var applicationStartDate=new Date,uniqueId="log4javascript_"+applicationStartDate.getTime()+"_"+Math.floor(1e8*Math.random()),emptyFunction=function(){},newLine="\r\n",pageLoaded=!1;function Log4JavaScript(){}Log4JavaScript.prototype=new EventSupport;var log4javascript=new Log4JavaScript;function toStr(e){return e&&e.toString?e.toString():String(e)}function getExceptionMessage(e){return e.message?e.message:e.description?e.description:toStr(e)}function getUrlFileName(e){var t=Math.max(e.lastIndexOf("/"),e.lastIndexOf("\\"));return e.substr(t+1)}function getExceptionStringRep(e){if(e){var t="Exception: "+getExceptionMessage(e);try{e.lineNumber&&(t+=" on line number "+e.lineNumber),e.fileName&&(t+=" in file "+getUrlFileName(e.fileName))}catch(e){logLog.warn("Unable to obtain file and line information for error")}return showStackTraces&&e.stack&&(t+=newLine+"Stack trace:"+newLine+e.stack),t}return null}function bool(e){return Boolean(e)}function trim(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function splitIntoLines(e){return e.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n")}log4javascript.version="1.4.11",log4javascript.edition="log4javascript";var urlEncode=void 0!==window.encodeURIComponent?function(e){return encodeURIComponent(e)}:function(e){return escape(e).replace(/\+/g,"%2B").replace(/"/g,"%22").replace(/'/g,"%27").replace(/\//g,"%2F").replace(/=/g,"%3D")};function array_remove(e,t){for(var r=-1,o=0,n=e.length;o<n;o++)if(e[o]===t){r=o;break}return 0<=r&&(e.splice(r,1),!0)}function array_contains(e,t){for(var r=0,o=e.length;r<o;r++)if(e[r]==t)return!0;return!1}function extractBooleanFromParam(e,t){return isUndefined(e)?t:bool(e)}function extractStringFromParam(e,t){return isUndefined(e)?t:String(e)}function extractIntFromParam(t,r){if(isUndefined(t))return r;try{var e=parseInt(t,10);return isNaN(e)?r:e}catch(e){return logLog.warn("Invalid int param "+t,e),r}}function extractFunctionFromParam(e,t){return"function"==typeof e?e:t}function isError(e){return e instanceof Error}Function.prototype.apply||(Function.prototype.apply=function(obj,args){var methodName="__apply__";void 0!==obj[methodName]&&(methodName+=String(Math.random()).substr(2)),obj[methodName]=this;for(var argsStrings=[],i=0,len=args.length;i<len;i++)argsStrings[i]="args["+i+"]";var script="obj."+methodName+"("+argsStrings.join(",")+")",returnValue=eval(script);return delete obj[methodName],returnValue}),Function.prototype.call||(Function.prototype.call=function(e){for(var t=[],r=1,o=arguments.length;r<o;r++)t[r-1]=arguments[r];return this.apply(e,t)});var logLog={quietMode:!1,debugMessages:[],setQuietMode:function(e){this.quietMode=bool(e)},numberOfErrors:0,alertAllErrors:!1,setAlertAllErrors:function(e){this.alertAllErrors=e},debug:function(e){this.debugMessages.push(e)},displayDebug:function(){alert(this.debugMessages.join(newLine))},warn:function(e,t){},error:function(e,t){if((1==++this.numberOfErrors||this.alertAllErrors)&&!this.quietMode){var r="log4javascript error: "+e;t&&(r+=newLine+newLine+"Original error: "+getExceptionStringRep(t)),alert(r)}}};function handleError(e,t){logLog.error(e,t),log4javascript.dispatchEvent("error",{message:e,exception:t})}log4javascript.logLog=logLog,log4javascript.setEventTypes(["load","error"]),log4javascript.handleError=handleError;var enabled=!("undefined"!=typeof log4javascript_disabled&&log4javascript_disabled);log4javascript.setEnabled=function(e){enabled=bool(e)},log4javascript.isEnabled=function(){return enabled};var useTimeStampsInMilliseconds=!0;log4javascript.setTimeStampsInMilliseconds=function(e){useTimeStampsInMilliseconds=bool(e)},log4javascript.isTimeStampsInMilliseconds=function(){return useTimeStampsInMilliseconds},log4javascript.evalInScope=function(expr){return eval(expr)};var showStackTraces=!1;log4javascript.setShowStackTraces=function(e){showStackTraces=bool(e)};var Level=function(e,t){this.level=e,this.name=t};function Timer(e,t){this.name=e,this.level=isUndefined(t)?Level.INFO:t,this.start=new Date}Level.prototype={toString:function(){return this.name},equals:function(e){return this.level==e.level},isGreaterOrEqual:function(e){return this.level>=e.level}},Level.ALL=new Level(Number.MIN_VALUE,"ALL"),Level.TRACE=new Level(1e4,"TRACE"),Level.DEBUG=new Level(2e4,"DEBUG"),Level.INFO=new Level(3e4,"INFO"),Level.WARN=new Level(4e4,"WARN"),Level.ERROR=new Level(5e4,"ERROR"),Level.FATAL=new Level(6e4,"FATAL"),Level.OFF=new Level(Number.MAX_VALUE,"OFF"),log4javascript.Level=Level,Timer.prototype.getElapsedTime=function(){return(new Date).getTime()-this.start.getTime()};var anonymousLoggerName="[anonymous]",defaultLoggerName="[default]",nullLoggerName="[null]",rootLoggerName="root";function Logger(e){this.name=e,this.parent=null,this.children=[];var r=[],t=null,o=this.name===rootLoggerName,n=this.name===nullLoggerName,i=null,a=!1;this.addChild=function(e){this.children.push(e),e.parent=this,e.invalidateAppenderCache()};var s=!0;this.getAdditivity=function(){return s},this.setAdditivity=function(e){var t=s!=e;s=e,t&&this.invalidateAppenderCache()},this.addAppender=function(e){n?handleError("Logger.addAppender: you may not add an appender to the null logger"):e instanceof log4javascript.Appender?array_contains(r,e)||(r.push(e),e.setAddedToLogger(this),this.invalidateAppenderCache()):handleError("Logger.addAppender: appender supplied ('"+toStr(e)+"') is not a subclass of Appender")},this.removeAppender=function(e){array_remove(r,e),e.setRemovedFromLogger(this),this.invalidateAppenderCache()},this.removeAllAppenders=function(){var e=r.length;if(0<e){for(var t=0;t<e;t++)r[t].setRemovedFromLogger(this);r.length=0,this.invalidateAppenderCache()}},this.getEffectiveAppenders=function(){if(null===i||a){var e=o||!this.getAdditivity()?[]:this.parent.getEffectiveAppenders();i=e.concat(r),a=!1}return i},this.invalidateAppenderCache=function(){a=!0;for(var e=0,t=this.children.length;e<t;e++)this.children[e].invalidateAppenderCache()},this.log=function(e,t){if(enabled&&e.isGreaterOrEqual(this.getEffectiveLevel())){var r,o=t.length-1,n=t[o];1<t.length&&isError(n)&&(r=n,o--);for(var i=[],a=0;a<=o;a++)i[a]=t[a];var s=new LoggingEvent(this,new Date,e,i,r);if(this.callAppenders(s),_appSign&&_appFunName&&e.level>=_levelValue){var d=this.formatTimestamp(new Date);d+=e+" - ",d+=i.toString(),_appFunName(_appSign,d)}bugout&&(e==Level.TRACE?bugout.trace(i.toString()):e==Level.DEBUG?bugout.debug(i.toString()):e==Level.INFO?bugout.info(i.toString()):e==Level.ERROR?bugout.error(i.toString()):bugout.info(i.toString()))}"undefined"!=typeof logAjax&&logAjax.enabled&&e.level>=logAjax.level&&saveLog(e.name,t[0],t[1])},this.formatTimestamp=function(e){var t=e.getFullYear(),r=e.getDate();return"["+t+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+r+" "+Number(e.getHours())+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)+" "+e.getMilliseconds()+"]: "},this.callAppenders=function(e){for(var t=this.getEffectiveAppenders(),r=0,o=t.length;r<o;r++)t[r].doAppend(e)},this.setLevel=function(e){o&&null===e?handleError("Logger.setLevel: you cannot set the level of the root logger to null"):e instanceof Level?t=e:handleError("Logger.setLevel: level supplied to logger "+this.name+" is not an instance of log4javascript.Level")},this.getLevel=function(){return t},this.getEffectiveLevel=function(){for(var e=this;null!==e;e=e.parent){var t=e.getLevel();if(null!==t)return t}},this.group=function(e,t){if(enabled)for(var r=this.getEffectiveAppenders(),o=0,n=r.length;o<n;o++)r[o].group(e,t)},this.groupEnd=function(){if(enabled)for(var e=this.getEffectiveAppenders(),t=0,r=e.length;t<r;t++)e[t].groupEnd()};var d={};this.time=function(e,t){enabled&&(isUndefined(e)?handleError("Logger.time: a name for the timer must be supplied"):!t||t instanceof Level?d[e]=new Timer(e,t):handleError("Logger.time: level supplied to timer "+e+" is not an instance of log4javascript.Level"))},this.timeEnd=function(e){if(enabled)if(isUndefined(e))handleError("Logger.timeEnd: a name for the timer must be supplied");else if(d[e]){var t=d[e],r=t.getElapsedTime();this.log(t.level,["Timer "+toStr(e)+" completed in "+r+"ms"]),delete d[e]}else logLog.warn("Logger.timeEnd: no timer found with name "+e)},this.assert=function(e){if(enabled&&!e){for(var t=[],r=1,o=arguments.length;r<o;r++)t.push(arguments[r]);(t=0<t.length?t:["Assertion Failure"]).push(newLine),t.push(e),this.log(Level.ERROR,t)}},this.toString=function(){return"Logger["+this.name+"]"}}Logger.prototype={trace:function(){this.log(Level.TRACE,arguments)},debug:function(){this.log(Level.DEBUG,arguments)},info:function(){this.log(Level.INFO,arguments)},warn:function(){this.log(Level.WARN,arguments)},error:function(){this.log(Level.ERROR,arguments)},fatal:function(){this.log(Level.FATAL,arguments)},isEnabledFor:function(e){return e.isGreaterOrEqual(this.getEffectiveLevel())},isTraceEnabled:function(){return this.isEnabledFor(Level.TRACE)},isDebugEnabled:function(){return this.isEnabledFor(Level.DEBUG)},isInfoEnabled:function(){return this.isEnabledFor(Level.INFO)},isWarnEnabled:function(){return this.isEnabledFor(Level.WARN)},isErrorEnabled:function(){return this.isEnabledFor(Level.ERROR)},isFatalEnabled:function(){return this.isEnabledFor(Level.FATAL)}},Logger.prototype.trace.isEntryPoint=!0,Logger.prototype.debug.isEntryPoint=!0,Logger.prototype.info.isEntryPoint=!0,Logger.prototype.warn.isEntryPoint=!0,Logger.prototype.error.isEntryPoint=!0,Logger.prototype.fatal.isEntryPoint=!0;var loggers={},loggerNames=[],ROOT_LOGGER_DEFAULT_LEVEL=Level.DEBUG,rootLogger=new Logger(rootLoggerName);rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL),log4javascript.getRootLogger=function(){return rootLogger},log4javascript.getLogger=function(e){if("string"!=typeof e&&(e=anonymousLoggerName,logLog.warn("log4javascript.getLogger: non-string logger name "+toStr(e)+" supplied, returning anonymous logger")),e==rootLoggerName&&handleError("log4javascript.getLogger: root logger may not be obtained by name"),!loggers[e]){var t=new Logger(e);loggers[e]=t,loggerNames.push(e);var r,o=e.lastIndexOf(".");if(-1<o){var n=e.substring(0,o);r=log4javascript.getLogger(n)}else r=rootLogger;r.addChild(t)}return loggers[e]};var defaultLogger=null;log4javascript.getDefaultLogger=function(){return defaultLogger||(defaultLogger=createDefaultLogger()),defaultLogger};var nullLogger=null;log4javascript.getNullLogger=function(){return nullLogger||(nullLogger=new Logger(nullLoggerName)).setLevel(Level.OFF),nullLogger},log4javascript.resetConfiguration=function(){rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL),loggers={}};var LoggingEvent=function(e,t,r,o,n){this.logger=e,this.timeStamp=t,this.timeStampInMilliseconds=t.getTime(),this.timeStampInSeconds=Math.floor(this.timeStampInMilliseconds/1e3),this.milliseconds=this.timeStamp.getMilliseconds(),this.level=r,this.messages=o,this.exception=n};LoggingEvent.prototype={getThrowableStrRep:function(){return this.exception?getExceptionStringRep(this.exception):""},getCombinedMessages:function(){return 1==this.messages.length?this.messages[0]:this.messages.join(newLine)},toString:function(){return"LoggingEvent["+this.level+"]"}},log4javascript.LoggingEvent=LoggingEvent;var Layout=function(){};Layout.prototype={defaults:{loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url"},loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url",batchHeader:"",batchFooter:"",batchSeparator:"",returnsPostData:!1,overrideTimeStampsSetting:!1,useTimeStampsInMilliseconds:null,format:function(){handleError("Layout.format: layout supplied has no format() method")},ignoresThrowable:function(){handleError("Layout.ignoresThrowable: layout supplied has no ignoresThrowable() method")},getContentType:function(){return"text/plain"},allowBatching:function(){return!0},setTimeStampsInMilliseconds:function(e){this.overrideTimeStampsSetting=!0,this.useTimeStampsInMilliseconds=bool(e)},isTimeStampsInMilliseconds:function(){return this.overrideTimeStampsSetting?this.useTimeStampsInMilliseconds:useTimeStampsInMilliseconds},getTimeStampValue:function(e){return this.isTimeStampsInMilliseconds()?e.timeStampInMilliseconds:e.timeStampInSeconds},getDataValues:function(e,t){var r=[[this.loggerKey,e.logger.name],[this.timeStampKey,this.getTimeStampValue(e)],[this.levelKey,e.level.name],[this.urlKey,window.location.href],[this.messageKey,t?e.getCombinedMessages():e.messages]];if(this.isTimeStampsInMilliseconds()||r.push([this.millisecondsKey,e.milliseconds]),e.exception&&r.push([this.exceptionKey,getExceptionStringRep(e.exception)]),this.hasCustomFields())for(var o=0,n=this.customFields.length;o<n;o++){var i=this.customFields[o].value;"function"==typeof i&&(i=i(this,e)),r.push([this.customFields[o].name,i])}return r},setKeys:function(e,t,r,o,n,i,a){this.loggerKey=extractStringFromParam(e,this.defaults.loggerKey),this.timeStampKey=extractStringFromParam(t,this.defaults.timeStampKey),this.levelKey=extractStringFromParam(r,this.defaults.levelKey),this.messageKey=extractStringFromParam(o,this.defaults.messageKey),this.exceptionKey=extractStringFromParam(n,this.defaults.exceptionKey),this.urlKey=extractStringFromParam(i,this.defaults.urlKey),this.millisecondsKey=extractStringFromParam(a,this.defaults.millisecondsKey)},setCustomField:function(e,t){for(var r=!1,o=0,n=this.customFields.length;o<n;o++)this.customFields[o].name===e&&(this.customFields[o].value=t,r=!0);r||this.customFields.push({name:e,value:t})},hasCustomFields:function(){return 0<this.customFields.length},formatWithException:function(e){var t=this.format(e);return e.exception&&this.ignoresThrowable()&&(t+=e.getThrowableStrRep()),t},toString:function(){handleError("Layout.toString: all layouts must override this method")}},log4javascript.Layout=Layout;var Appender=function(){},SimpleDateFormat;function SimpleLayout(){this.customFields=[]}function NullLayout(){this.customFields=[]}function XmlLayout(e){this.combineMessages=extractBooleanFromParam(e,!0),this.customFields=[]}function escapeNewLines(e){return e.replace(/\r\n|\r|\n/g,"\\r\\n")}function JsonLayout(e,t){this.readable=extractBooleanFromParam(e,!1),this.combineMessages=extractBooleanFromParam(t,!0),this.batchHeader=this.readable?"["+newLine:"[",this.batchFooter=this.readable?"]"+newLine:"]",this.batchSeparator=this.readable?","+newLine:",",this.setKeys(),this.colon=this.readable?": ":":",this.tab=this.readable?"\t":"",this.lineBreak=this.readable?newLine:"",this.customFields=[]}function HttpPostDataLayout(){this.setKeys(),this.customFields=[],this.returnsPostData=!0}function formatObjectExpansion(e,t,r){var p=[];return function e(t,r,n){var o,i,a,s,d,l,u;function c(e){for(var t=splitIntoLines(e),r=1,o=t.length;r<o;r++)t[r]=n+t[r];return t.join(newLine)}if(n||(n=""),null===t)return"null";if(void 0===t)return"undefined";if("string"==typeof t)return c(t);if("object"==typeof t&&array_contains(p,t)){try{l=toStr(t)}catch(e){l="Error formatting property. Details: "+getExceptionStringRep(e)}return l+" [already expanded]"}if(t instanceof Array&&0<r){for(p.push(t),l="["+newLine,a=r-1,s=n+"  ",d=[],o=0,i=t.length;o<i;o++)try{u=e(t[o],a,s),d.push(s+u)}catch(e){d.push(s+"Error formatting array member. Details: "+getExceptionStringRep(e))}return l+=d.join(","+newLine)+newLine+n+"]"}if("[object Date]"==Object.prototype.toString.call(t))return t.toString();if("object"==typeof t&&0<r){for(o in p.push(t),l="{"+newLine,a=r-1,s=n+"  ",d=[],t)try{u=e(t[o],a,s),d.push(s+o+": "+u)}catch(e){d.push(s+o+": Error formatting property. Details: "+getExceptionStringRep(e))}return l+=d.join(","+newLine)+newLine+n+"}"}return c(toStr(t))}(e,t,r)}function PatternLayout(e){this.pattern=e||PatternLayout.DEFAULT_CONVERSION_PATTERN,this.customFields=[]}function AlertAppender(){}function BrowserConsoleAppender(){}Appender.prototype=new EventSupport,Appender.prototype.layout=new PatternLayout,Appender.prototype.threshold=Level.ALL,Appender.prototype.loggers=[],Appender.prototype.doAppend=function(e){enabled&&e.level.level>=this.threshold.level&&this.append(e)},Appender.prototype.append=function(e){},Appender.prototype.setLayout=function(e){e instanceof Layout?this.layout=e:handleError("Appender.setLayout: layout supplied to "+this.toString()+" is not a subclass of Layout")},Appender.prototype.getLayout=function(){return this.layout},Appender.prototype.setThreshold=function(e){e instanceof Level?this.threshold=e:handleError("Appender.setThreshold: threshold supplied to "+this.toString()+" is not a subclass of Level")},Appender.prototype.getThreshold=function(){return this.threshold},Appender.prototype.setAddedToLogger=function(e){this.loggers.push(e)},Appender.prototype.setRemovedFromLogger=function(e){array_remove(this.loggers,e)},Appender.prototype.group=emptyFunction,Appender.prototype.groupEnd=emptyFunction,Appender.prototype.toString=function(){handleError("Appender.toString: all appenders must override this method")},log4javascript.Appender=Appender,SimpleLayout.prototype=new Layout,SimpleLayout.prototype.format=function(e){return e.level.name+" - "+e.getCombinedMessages()},SimpleLayout.prototype.ignoresThrowable=function(){return!0},SimpleLayout.prototype.toString=function(){return"SimpleLayout"},log4javascript.SimpleLayout=SimpleLayout,NullLayout.prototype=new Layout,NullLayout.prototype.format=function(e){return e.messages},NullLayout.prototype.ignoresThrowable=function(){return!0},NullLayout.prototype.formatWithException=function(e){var t=e.messages,r=e.exception;return r?t.concat([r]):t},NullLayout.prototype.toString=function(){return"NullLayout"},log4javascript.NullLayout=NullLayout,XmlLayout.prototype=new Layout,XmlLayout.prototype.isCombinedMessages=function(){return this.combineMessages},XmlLayout.prototype.getContentType=function(){return"text/xml"},XmlLayout.prototype.escapeCdata=function(e){return e.replace(/\]\]>/,"]]>]]&gt;<![CDATA[")},XmlLayout.prototype.format=function(e){var t,r,o=this;function n(e){return e="string"==typeof e?e:toStr(e),"<log4javascript:message><![CDATA["+o.escapeCdata(e)+"]]></log4javascript:message>"}var i='<log4javascript:event logger="'+e.logger.name+'" timestamp="'+this.getTimeStampValue(e)+'"';if(this.isTimeStampsInMilliseconds()||(i+=' milliseconds="'+e.milliseconds+'"'),i+=' level="'+e.level.name+'">'+newLine,this.combineMessages)i+=n(e.getCombinedMessages());else{for(i+="<log4javascript:messages>"+newLine,t=0,r=e.messages.length;t<r;t++)i+=n(e.messages[t])+newLine;i+="</log4javascript:messages>"+newLine}if(this.hasCustomFields())for(t=0,r=this.customFields.length;t<r;t++)i+='<log4javascript:customfield name="'+this.customFields[t].name+'"><![CDATA['+this.customFields[t].value.toString()+"]]></log4javascript:customfield>"+newLine;return e.exception&&(i+="<log4javascript:exception><![CDATA["+getExceptionStringRep(e.exception)+"]]></log4javascript:exception>"+newLine),i+="</log4javascript:event>"+newLine+newLine},XmlLayout.prototype.ignoresThrowable=function(){return!1},XmlLayout.prototype.toString=function(){return"XmlLayout"},log4javascript.XmlLayout=XmlLayout,JsonLayout.prototype=new Layout,JsonLayout.prototype.isReadable=function(){return this.readable},JsonLayout.prototype.isCombinedMessages=function(){return this.combineMessages},JsonLayout.prototype.format=function(e){var t,r,d=this,o=this.getDataValues(e,this.combineMessages),n="{"+this.lineBreak;function l(e,t,r){var o,n=typeof e;if(e instanceof Date)o=String(e.getTime());else if(r&&e instanceof Array){o="["+d.lineBreak;for(var i=0,a=e.length;i<a;i++){var s=t+d.tab;o+=s+l(e[i],s,!1),i<e.length-1&&(o+=","),o+=d.lineBreak}o+=t+"]"}else o="number"!==n&&"boolean"!==n?'"'+escapeNewLines(toStr(e).replace(/\"/g,'\\"'))+'"':e;return o}for(t=0,r=o.length-1;t<=r;t++)n+=this.tab+'"'+o[t][0]+'"'+this.colon+l(o[t][1],this.tab,!0),t<r&&(n+=","),n+=this.lineBreak;return n+="}"+this.lineBreak},JsonLayout.prototype.ignoresThrowable=function(){return!1},JsonLayout.prototype.toString=function(){return"JsonLayout"},JsonLayout.prototype.getContentType=function(){return"application/json"},log4javascript.JsonLayout=JsonLayout,HttpPostDataLayout.prototype=new Layout,HttpPostDataLayout.prototype.allowBatching=function(){return!1},HttpPostDataLayout.prototype.format=function(e){for(var t=this.getDataValues(e),r=[],o=0,n=t.length;o<n;o++){var i=t[o][1]instanceof Date?String(t[o][1].getTime()):t[o][1];r.push(urlEncode(t[o][0])+"="+urlEncode(i))}return r.join("&")},HttpPostDataLayout.prototype.ignoresThrowable=function(e){return!1},HttpPostDataLayout.prototype.toString=function(){return"HttpPostDataLayout"},log4javascript.HttpPostDataLayout=HttpPostDataLayout,function(){var m=/('[^']*')|(G+|y+|M+|w+|W+|D+|d+|F+|E+|a+|H+|k+|K+|h+|m+|s+|S+|Z+)|([a-zA-Z]+)|([^a-zA-Z']+)/,g=["January","February","March","April","May","June","July","August","September","October","November","December"],v=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],y={G:0,y:3,M:4,w:2,W:2,D:2,d:2,F:2,E:1,a:0,H:2,k:2,K:2,h:2,m:2,s:2,S:2,Z:5},n=function(e,t,r){var o=new Date(e,t,r,0,0,0);return o.setMilliseconds(0),o};Date.prototype.getDifference=function(e){return this.getTime()-e.getTime()},Date.prototype.isBefore=function(e){return this.getTime()<e.getTime()},Date.prototype.getUTCTime=function(){return Date.UTC(this.getFullYear(),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds())},Date.prototype.getTimeSince=function(e){return this.getUTCTime()-e.getUTCTime()},Date.prototype.getPreviousSunday=function(){var e=new Date(this.getFullYear(),this.getMonth(),this.getDate(),12,0,0),t=new Date(e.getTime()-864e5*this.getDay());return n(t.getFullYear(),t.getMonth(),t.getDate())},Date.prototype.getWeekInYear=function(e){isUndefined(this.minimalDaysInFirstWeek)&&(e=1);var t=this.getPreviousSunday(),r=n(this.getFullYear(),0,1),o=t.isBefore(r)?0:1+Math.floor(t.getTimeSince(r)/6048e5);return 7-r.getDay()<e&&o--,o},Date.prototype.getWeekInMonth=function(e){isUndefined(this.minimalDaysInFirstWeek)&&(e=1);var t=this.getPreviousSunday(),r=n(this.getFullYear(),this.getMonth(),1),o=t.isBefore(r)?0:1+Math.floor(t.getTimeSince(r)/6048e5);return e<=7-r.getDay()&&o++,o},Date.prototype.getDayInYear=function(){var e=n(this.getFullYear(),0,1);return 1+Math.floor(this.getTimeSince(e)/864e5)},(SimpleDateFormat=function(e){this.formatString=e}).prototype.setMinimalDaysInFirstWeek=function(e){this.minimalDaysInFirstWeek=e},SimpleDateFormat.prototype.getMinimalDaysInFirstWeek=function(){return isUndefined(this.minimalDaysInFirstWeek)?1:this.minimalDaysInFirstWeek};var b=function(e,t){for(;e.length<t;)e="0"+e;return e},_=function(e,t,r){return 4<=t?e:e.substr(0,Math.max(r,t))},w=function(e,t){return b(""+e,t)};SimpleDateFormat.prototype.format=function(e){for(var t,r="",o=this.formatString;t=m.exec(o);){var n=t[1],i=t[2],a=t[3],s=t[4];if(n)r+="''"==n?"'":n.substring(1,n.length-1);else if(a);else if(s)r+=s;else if(i){var d=i.charAt(0),l=i.length,u="";switch(d){case"G":u="AD";break;case"y":u=e.getFullYear();break;case"M":u=e.getMonth();break;case"w":u=e.getWeekInYear(this.getMinimalDaysInFirstWeek());break;case"W":u=e.getWeekInMonth(this.getMinimalDaysInFirstWeek());break;case"D":u=e.getDayInYear();break;case"d":u=e.getDate();break;case"F":u=1+Math.floor((e.getDate()-1)/7);break;case"E":u=v[e.getDay()];break;case"a":u=12<=e.getHours()?"PM":"AM";break;case"H":u=e.getHours();break;case"k":u=e.getHours()||24;break;case"K":u=e.getHours()%12;break;case"h":u=e.getHours()%12||12;break;case"m":u=e.getMinutes();break;case"s":u=e.getSeconds();break;case"S":u=e.getMilliseconds();break;case"Z":u=e.getTimezoneOffset()}switch(y[d]){case 0:r+=_(u,l,2);break;case 1:r+=_(u,l,3);break;case 2:r+=w(u,l);break;case 3:if(l<=3)r+=(""+u).substr(2,2);else r+=w(u,l);break;case 4:r+=3<=l?_(g[u],l,l):w(u+1,l);break;case 5:var c=0<u?"-":"+",p=Math.abs(u),h=""+Math.floor(p/60),f=""+p%60;r+=c+(h=b(h,2))+(f=b(f,2))}}o=o.substr(t.index+t[0].length)}return r}}(),log4javascript.SimpleDateFormat=SimpleDateFormat,PatternLayout.TTCC_CONVERSION_PATTERN="%r %p %c - %m%n",PatternLayout.DEFAULT_CONVERSION_PATTERN="%m%n",PatternLayout.ISO8601_DATEFORMAT="yyyy-MM-dd HH:mm:ss,SSS",PatternLayout.DATETIME_DATEFORMAT="dd MMM yyyy HH:mm:ss,SSS",PatternLayout.ABSOLUTETIME_DATEFORMAT="HH:mm:ss,SSS",PatternLayout.prototype=new Layout,PatternLayout.prototype.format=function(e){for(var t,r=/%(-?[0-9]+)?(\.?[0-9]+)?([acdfmMnpr%])(\{([^\}]+)\})?|([^%]+)/,o="",n=this.pattern;t=r.exec(n);){var i=t[0],a=t[1],s=t[2],d=t[3],l=t[5],u=t[6];if(u)o+=""+u;else{var c,p="";switch(d){case"a":case"m":var h=0;l&&(h=parseInt(l,10),isNaN(h)&&(handleError("PatternLayout.format: invalid specifier '"+l+"' for conversion character '"+d+"' - should be a number"),h=0));for(var f="a"===d?e.messages[0]:e.messages,m=0,g=f.length;m<g;m++)0<m&&" "!==p.charAt(p.length-1)&&(p+=" "),p+=0===h?f[m]:formatObjectExpansion(f[m],h);break;case"c":var v=e.logger.name;if(l){var y=parseInt(l,10),b=e.logger.name.split(".");p=y>=b.length?v:b.slice(b.length-y).join(".")}else p=v;break;case"d":var _=PatternLayout.ISO8601_DATEFORMAT;l&&("ISO8601"==(_=l)?_=PatternLayout.ISO8601_DATEFORMAT:"ABSOLUTE"==_?_=PatternLayout.ABSOLUTETIME_DATEFORMAT:"DATE"==_&&(_=PatternLayout.DATETIME_DATEFORMAT)),p=new SimpleDateFormat(_).format(e.timeStamp);break;case"f":if(this.hasCustomFields()){var w=0;l&&(w=parseInt(l,10),isNaN(w)?handleError("PatternLayout.format: invalid specifier '"+l+"' for conversion character 'f' - should be a number"):0===w?handleError("PatternLayout.format: invalid specifier '"+l+"' for conversion character 'f' - must be greater than zero"):w>this.customFields.length?handleError("PatternLayout.format: invalid specifier '"+l+"' for conversion character 'f' - there aren't that many custom fields"):w-=1);var S=this.customFields[w].value;"function"==typeof S&&(S=S(this,e)),p=S}break;case"n":p=newLine;break;case"p":p=e.level.name;break;case"r":p=""+e.timeStamp.getDifference(applicationStartDate);break;case"%":p="%";break;default:p=i}if(s){c=parseInt(s.substr(1),10);var E=p.length;c<E&&(p=p.substring(E-c,E))}if(a)if("-"==a.charAt(0))for(c=parseInt(a.substr(1),10);p.length<c;)p+=" ";else for(c=parseInt(a,10);p.length<c;)p=" "+p;o+=p}n=n.substr(t.index+t[0].length)}return o},PatternLayout.prototype.ignoresThrowable=function(){return!0},PatternLayout.prototype.toString=function(){return"PatternLayout"},log4javascript.PatternLayout=PatternLayout,AlertAppender.prototype=new Appender,AlertAppender.prototype.layout=new SimpleLayout,AlertAppender.prototype.append=function(e){alert(this.getLayout().formatWithException(e))},AlertAppender.prototype.toString=function(){return"AlertAppender"},log4javascript.AlertAppender=AlertAppender,BrowserConsoleAppender.prototype=new log4javascript.Appender,BrowserConsoleAppender.prototype.layout=new NullLayout,BrowserConsoleAppender.prototype.threshold=Level.DEBUG,BrowserConsoleAppender.prototype.append=function(t){var e,r=this,o=function(){var e=r.getLayout().formatWithException(t);return"string"==typeof e?[e]:e};if((e=window.console)&&e.log){var n,i=o();e[n=e.debug&&Level.DEBUG.isGreaterOrEqual(t.level)?"debug":e.info&&Level.INFO.equals(t.level)?"info":e.warn&&Level.WARN.equals(t.level)?"warn":e.error&&t.level.isGreaterOrEqual(Level.ERROR)?"error":"log"].apply?e[n].apply(e,i):e[n](i)}else"undefined"!=typeof opera&&opera.postError&&opera.postError(o())},BrowserConsoleAppender.prototype.group=function(e){window.console&&window.console.group&&window.console.group(e)},BrowserConsoleAppender.prototype.groupEnd=function(){window.console&&window.console.groupEnd&&window.console.groupEnd()},BrowserConsoleAppender.prototype.toString=function(){return"BrowserConsoleAppender"},log4javascript.BrowserConsoleAppender=BrowserConsoleAppender;var xhrFactory=function(){return new XMLHttpRequest},xmlHttpFactories=[xhrFactory,function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],withCredentialsSupported=!1,getXmlHttp=function(e){for(var t,r=null,o=0,n=xmlHttpFactories.length;o<n;o++){t=xmlHttpFactories[o];try{return r=t(),withCredentialsSupported=t==xhrFactory&&"withCredentials"in r,getXmlHttp=t,r}catch(e){}}e?e():handleError("getXmlHttp: unable to obtain XMLHttpRequest object")},ConsoleAppender;function isHttpRequestSuccessful(e){return isUndefined(e.status)||0===e.status||200<=e.status&&e.status<300||1223==e.status}function AjaxAppender(s,d){var n=this,l=!0;s||(handleError("AjaxAppender: URL must be specified in constructor"),l=!1);var i=this.defaults.timed,a=this.defaults.waitForResponse,u=this.defaults.batchSize,t=this.defaults.timerInterval,c=this.defaults.requestSuccessCallback,p=this.defaults.failCallback,h=this.defaults.postVarName,f=this.defaults.sendAllOnUnload,m=this.defaults.contentType,r=null,g=[],v=[],y=[],b=!1,_=!1;function o(e){return!_||(handleError("AjaxAppender: configuration option '"+e+"' may not be set after the appender has been initialized"),!1)}function w(){var e;if(l&&enabled)if(b=!0,a)0<v.length?R(E(e=v.shift()),w):(b=!1,i&&I());else{for(;e=v.shift();)R(E(e));b=!1,i&&I()}}function S(){var e=!1;if(l&&enabled){for(var t,r=n.getLayout().allowBatching()?u:1,o=[];t=g.shift();)o.push(t),g.length>=r&&(v.push(o),o=[]);0<o.length&&v.push(o),e=0<v.length,i=a=!1,w()}return e}function E(e){for(var t,r=[],o="";t=e.shift();)r.push(n.getLayout().formatWithException(t));return o=1==e.length?r.join(""):n.getLayout().batchHeader+r.join(n.getLayout().batchSeparator)+n.getLayout().batchFooter,m==n.defaults.contentType&&(0<(o=n.getLayout().returnsPostData?o:urlEncode(h)+"="+urlEncode(o)).length&&(o+="&"),o+="layout="+urlEncode(n.getLayout().toString())),o}function I(){window.setTimeout(w,t)}function T(){var e="AjaxAppender: could not create XMLHttpRequest object. AjaxAppender disabled";handleError(e),l=!1,p&&p(e)}function R(e,t){try{var r=getXmlHttp(T);if(l){r.onreadystatechange=function(){if(4==r.readyState){if(isHttpRequestSuccessful(r))c&&c(r),t&&t(r);else{var e="AjaxAppender.append: XMLHttpRequest request to URL "+s+" returned status code "+r.status;handleError(e),p&&p(e)}r.onreadystatechange=emptyFunction,r=null}},r.open("POST",s,!0),d&&withCredentialsSupported&&(r.withCredentials=!0);try{for(var o,n=0;o=y[n++];)r.setRequestHeader(o.name,o.value);r.setRequestHeader("Content-Type",m)}catch(e){var i="AjaxAppender.append: your browser's XMLHttpRequest implementation does not support setRequestHeader, therefore cannot post data. AjaxAppender disabled";return handleError(i),l=!1,void(p&&p(i))}r.send(e)}}catch(e){var a="AjaxAppender.append: error sending log message to "+s;handleError(a,e),l=!1,p&&p(a+". Details: "+getExceptionStringRep(e))}}this.getSessionId=function(){return r},this.setSessionId=function(e){r=extractStringFromParam(e,null),this.layout.setCustomField("sessionid",r)},this.setLayout=function(e){o("layout")&&(this.layout=e,null!==r&&this.setSessionId(r))},this.isTimed=function(){return i},this.setTimed=function(e){o("timed")&&(i=bool(e))},this.getTimerInterval=function(){return t},this.setTimerInterval=function(e){o("timerInterval")&&(t=extractIntFromParam(e,t))},this.isWaitForResponse=function(){return a},this.setWaitForResponse=function(e){o("waitForResponse")&&(a=bool(e))},this.getBatchSize=function(){return u},this.setBatchSize=function(e){o("batchSize")&&(u=extractIntFromParam(e,u))},this.isSendAllOnUnload=function(){return f},this.setSendAllOnUnload=function(e){o("sendAllOnUnload")&&(f=extractBooleanFromParam(e,f))},this.setRequestSuccessCallback=function(e){c=extractFunctionFromParam(e,c)},this.setFailCallback=function(e){p=extractFunctionFromParam(e,p)},this.getPostVarName=function(){return h},this.setPostVarName=function(e){o("postVarName")&&(h=extractStringFromParam(e,h))},this.getHeaders=function(){return y},this.addHeader=function(e,t){"content-type"==e.toLowerCase()?m=t:y.push({name:e,value:t})},this.sendAll=w,this.sendAllRemaining=S,this.append=function(e){if(l){_||function(){if(_=!0,f){var e=window.onbeforeunload;window.onbeforeunload=function(){e&&e(),S()}}i&&I()}(),g.push(e);var t=this.getLayout().allowBatching()?u:1;if(g.length>=t){for(var r,o=[];r=g.shift();)o.push(r);v.push(o),i||a&&(!a||b)||w()}}}}function setCookie(e,t,r,o){var n;if(o=o?"; path="+o:"",r){var i=new Date;i.setTime(i.getTime()+24*r*60*60*1e3),n="; expires="+i.toGMTString()}else n="";document.cookie=escape(e)+"="+escape(t)+n+o}function getCookie(e){for(var t=escape(e)+"=",r=document.cookie.split(";"),o=0,n=r.length;o<n;o++){for(var i=r[o];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return unescape(i.substring(t.length,i.length))}return null}function getBaseUrl(){for(var e=document.getElementsByTagName("script"),t=0,r=e.length;t<r;++t)if(-1!=e[t].src.indexOf("log4javascript")){var o=e[t].src.lastIndexOf("/");return-1==o?"":e[t].src.substr(0,o+1)}return null}function isLoaded(e){try{return bool(e.loaded)}catch(e){return!1}}function padWithSpaces(e,t){if(e.length<t){for(var r=[],o=Math.max(0,t-e.length),n=0;n<o;n++)r[n]=" ";e+=r.join("")}return e}function createDefaultLogger(){var e=log4javascript.getLogger(defaultLoggerName),t=new log4javascript.PopUpAppender;return e.addAppender(t),e}if(AjaxAppender.prototype=new Appender,AjaxAppender.prototype.defaults={waitForResponse:!1,timed:!1,timerInterval:1e3,batchSize:1,sendAllOnUnload:!1,requestSuccessCallback:null,failCallback:null,postVarName:"data",contentType:"application/x-www-form-urlencoded"},AjaxAppender.prototype.layout=new HttpPostDataLayout,AjaxAppender.prototype.toString=function(){return"AjaxAppender"},log4javascript.AjaxAppender=AjaxAppender,function(){var ee=[],te=1;function e(e,t,r,o,n){this.create(!1,null,e,t,r,o,n,this.defaults.focusPopUp)}function t(e,t,r,o,n,i){this.create(!0,e,t,r,o,n,i,!1)}(ConsoleAppender=function(){}).prototype=new Appender,ConsoleAppender.prototype.create=function(e,r,t,s,d,l,u,o){var h=this,n=!1,c=!1,p=!1,f=!1,i=[],m=!0,g=te++;s=extractBooleanFromParam(s,this.defaults.initiallyMinimized),t=extractBooleanFromParam(t,this.defaults.lazyInit),d=extractBooleanFromParam(d,this.defaults.useDocumentWrite);var a=this.defaults.newestMessageAtTop,v=this.defaults.scrollToLatestMessage;l=l||this.defaults.width,u=u||this.defaults.height;var y,b,_,w,S,E=this.defaults.maxMessages,I=this.defaults.showCommandLine,T=this.defaults.commandLineObjectExpansionDepth,R=this.defaults.showHideButton,C=this.defaults.showCloseButton;this.setLayout(this.defaults.layout);var P=e?"InPageAppender":"PopUpAppender",M=function(e){return!c||(handleError(P+": configuration option '"+e+"' may not be set after the appender has been initialized"),!1)},x=function(){return p&&m&&!f};this.isNewestMessageAtTop=function(){return a},this.setNewestMessageAtTop=function(e){a=bool(e),x()&&w().setNewestAtTop(a)},this.isScrollToLatestMessage=function(){return v},this.setScrollToLatestMessage=function(e){v=bool(e),x()&&w().setScrollToLatest(v)},this.getWidth=function(){return l},this.setWidth=function(e){M("width")&&(l=extractStringFromParam(e,l))},this.getHeight=function(){return u},this.setHeight=function(e){M("height")&&(u=extractStringFromParam(e,u))},this.getMaxMessages=function(){return E},this.setMaxMessages=function(e){E=extractIntFromParam(e,E),x()&&w().setMaxMessages(E)},this.isShowCommandLine=function(){return I},this.setShowCommandLine=function(e){I=bool(e),x()&&w().setShowCommandLine(I)},this.isShowHideButton=function(){return R},this.setShowHideButton=function(e){R=bool(e),x()&&w().setShowHideButton(R)},this.isShowCloseButton=function(){return C},this.setShowCloseButton=function(e){C=bool(e),x()&&w().setShowCloseButton(C)},this.getCommandLineObjectExpansionDepth=function(){return T},this.setCommandLineObjectExpansionDepth=function(e){T=extractIntFromParam(e,T)};var A=s;function k(e,t){this.loggingEvent=e,this.levelName=e.level.name,this.formattedMessage=t}function O(e,t){this.name=e,this.initiallyExpanded=t}function U(){}this.isInitiallyMinimized=function(){return s},this.setInitiallyMinimized=function(e){M("initiallyMinimized")&&(s=bool(e),A=s)},this.isUseDocumentWrite=function(){return d},this.setUseDocumentWrite=function(e){M("useDocumentWrite")&&(d=bool(e))},k.prototype.append=function(){w().log(this.levelName,this.formattedMessage)},O.prototype.append=function(){w().group(this.name,this.initiallyExpanded)},U.prototype.append=function(){w().groupEnd()};var L=function(){_(),n?f&&Z&&b():y(),_()&&D()};this.append=function(e){if(m){var t=h.getLayout().formatWithException(e);i.push(new k(e,t)),L()}},this.group=function(e,t){m&&(i.push(new O(e,t)),L())},this.groupEnd=function(){m&&(i.push(new U),L())};var D=function(){for(;0<i.length;)i.shift().append();o&&w().focus()};this.setAddedToLogger=function(e){this.loggers.push(e),enabled&&!t&&y()},this.clear=function(){x()&&w().clearLog(),i.length=0},this.focus=function(){x()&&w().focus()},this.focusCommandLine=function(){x()&&w().focusCommandLine()},this.focusSearch=function(){x()&&w().focusSearch()};var N=window;this.getCommandWindow=function(){return N},this.setCommandWindow=function(e){N=e},this.executeLastCommand=function(){x()&&w().evalLastCommand()};var B=new PatternLayout("%m");this.getCommandLayout=function(){return B},this.setCommandLayout=function(e){B=e},this.evalCommandAndAppend=function(e){var t={appendResult:!0,isError:!1},r="";try{var o,n;!N.eval&&N.execScript&&N.execScript("null");var i={};for(n=0,len=j.length;n<len;n++)i[j[n][0]]=j[n][1];var a=[],s=function(e){a.push([e,N[e]])};s("appender"),N.appender=h,s("commandReturnValue"),N.commandReturnValue=t,s("commandLineFunctionsHash"),N.commandLineFunctionsHash=i;var d=function(e){s(e),N[e]=function(){return this.commandLineFunctionsHash[e](h,arguments,t)}};for(n=0,len=j.length;n<len;n++)d(j[n][0]);for(r=isUndefined(o=N===window&&N.execScript?(s("evalExpr"),s("result"),window.evalExpr=e,N.execScript("window.result=eval(window.evalExpr);"),window.result):N.eval(e))?o:formatObjectExpansion(o,T),n=0,len=a.length;n<len;n++)N[a[n][0]]=a[n][1]}catch(e){r="Error evaluating command: "+getExceptionStringRep(e),t.isError=!0}if(t.appendResult){var l=">>> "+e;isUndefined(r)||(l+=newLine+r);var u=t.isError?Level.ERROR:Level.INFO,c=new LoggingEvent(null,new Date,u,[l],null),p=this.getLayout();this.setLayout(B),this.append(c),this.setLayout(p)}};var j=ee.concat([]);this.addCommandLineFunction=function(e,t){j.push([e,t])};var V="log4javascriptCommandHistory";this.storeCommandHistory=function(e){setCookie(V,e.join(","))};var F=function(e){var t=['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">','<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">',"\t<head>","\t\t<title>log4javascript</title>",'\t\t<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />',"\t\t\x3c!-- Make IE8 behave like IE7, having gone to all the trouble of making IE work --\x3e",'\t\t<meta http-equiv="X-UA-Compatible" content="IE=7" />','\t\t<script type="text/javascript">var isIe = false, isIePre7 = false;<\/script>','\t\t\x3c!--[if IE]><script type="text/javascript">isIe = true<\/script><![endif]--\x3e','\t\t\x3c!--[if lt IE 7]><script type="text/javascript">isIePre7 = true<\/script><![endif]--\x3e','\t\t<script type="text/javascript">',"\t\t\t//<![CDATA[","\t\t\tvar loggingEnabled = true;","\t\t\tvar logQueuedEventsTimer = null;","\t\t\tvar logEntries = [];","\t\t\tvar logEntriesAndSeparators = [];","\t\t\tvar logItems = [];","\t\t\tvar renderDelay = 100;","\t\t\tvar unrenderedLogItemsExist = false;","\t\t\tvar rootGroup, currentGroup = null;","\t\t\tvar loaded = false;","\t\t\tvar currentLogItem = null;","\t\t\tvar logMainContainer;","","\t\t\tfunction copyProperties(obj, props) {","\t\t\t\tfor (var i in props) {","\t\t\t\t\tobj[i] = props[i];","\t\t\t\t}","\t\t\t}","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItem() {","\t\t\t}","","\t\t\tLogItem.prototype = {","\t\t\t\tmainContainer: null,","\t\t\t\twrappedContainer: null,","\t\t\t\tunwrappedContainer: null,","\t\t\t\tgroup: null,","","\t\t\t\tappendToLog: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].appendToLog();","\t\t\t\t\t}","\t\t\t\t\tthis.group.update();","\t\t\t\t},","","\t\t\t\tdoRemove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tif (this.rendered) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].remove();","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.unwrappedElementContainer = null;","\t\t\t\t\t\tthis.wrappedElementContainer = null;","\t\t\t\t\t\tthis.mainElementContainer = null;","\t\t\t\t\t}","\t\t\t\t\tif (this.group && removeFromGroup) {","\t\t\t\t\t\tthis.group.removeChild(this, doUpdate);","\t\t\t\t\t}","\t\t\t\t\tif (this === currentLogItem) {","\t\t\t\t\t\tcurrentLogItem = null;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tthis.doRemove(doUpdate, removeFromGroup);","\t\t\t\t},","","\t\t\t\trender: function() {},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visit(this);","\t\t\t\t},","","\t\t\t\tgetUnwrappedDomContainer: function() {","\t\t\t\t\treturn this.group.unwrappedElementContainer.contentDiv;","\t\t\t\t},","","\t\t\t\tgetWrappedDomContainer: function() {","\t\t\t\t\treturn this.group.wrappedElementContainer.contentDiv;","\t\t\t\t},","","\t\t\t\tgetMainDomContainer: function() {","\t\t\t\t\treturn this.group.mainElementContainer.contentDiv;","\t\t\t\t}","\t\t\t};","","\t\t\tLogItem.serializedItemKeys = {LOG_ENTRY: 0, GROUP_START: 1, GROUP_END: 2};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemContainerElement() {","\t\t\t}","","\t\t\tLogItemContainerElement.prototype = {","\t\t\t\tappendToLog: function() {","\t\t\t\t\tvar insertBeforeFirst = (newestAtTop && this.containerDomNode.hasChildNodes());","\t\t\t\t\tif (insertBeforeFirst) {","\t\t\t\t\t\tthis.containerDomNode.insertBefore(this.mainDiv, this.containerDomNode.firstChild);","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.containerDomNode.appendChild(this.mainDiv);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction SeparatorElementContainer(containerDomNode) {","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "separator";','\t\t\t\tthis.mainDiv.innerHTML = "&nbsp;";',"\t\t\t}","","\t\t\tSeparatorElementContainer.prototype = new LogItemContainerElement();","","\t\t\tSeparatorElementContainer.prototype.remove = function() {","\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\tthis.mainDiv = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction Separator() {","\t\t\t\tthis.rendered = false;","\t\t\t}","","\t\t\tSeparator.prototype = new LogItem();","","\t\t\tcopyProperties(Separator.prototype, {","\t\t\t\trender: function() {","\t\t\t\t\tvar containerDomNode = this.group.contentDiv;","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tthis.unwrappedElementContainer = new SeparatorElementContainer(this.getUnwrappedDomContainer());","\t\t\t\t\t\tthis.wrappedElementContainer = new SeparatorElementContainer(this.getWrappedDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.mainElementContainer = new SeparatorElementContainer(this.getMainDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.content = this.formattedMessage;","\t\t\t\t\tthis.rendered = true;","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction GroupElementContainer(group, containerDomNode, isRoot, isWrapped) {","\t\t\t\tthis.group = group;","\t\t\t\tthis.containerDomNode = containerDomNode;","\t\t\t\tthis.isRoot = isRoot;","\t\t\t\tthis.isWrapped = isWrapped;","\t\t\t\tthis.expandable = false;","","\t\t\t\tif (this.isRoot) {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tthis.contentDiv = logMainContainer.appendChild(document.createElement("div"));','\t\t\t\t\t\tthis.contentDiv.id = this.isWrapped ? "log_wrapped" : "log_unwrapped";',"\t\t\t\t\t} else {","\t\t\t\t\t\tthis.contentDiv = logMainContainer;","\t\t\t\t\t}","\t\t\t\t} else {","\t\t\t\t\tvar groupElementContainer = this;","\t\t\t\t\t",'\t\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\t\tthis.mainDiv.className = "group";',"",'\t\t\t\t\tthis.headingDiv = this.mainDiv.appendChild(document.createElement("div"));','\t\t\t\t\tthis.headingDiv.className = "groupheading";',"",'\t\t\t\t\tthis.expander = this.headingDiv.appendChild(document.createElement("span"));','\t\t\t\t\tthis.expander.className = "expander unselectable greyedout";',"\t\t\t\t\tthis.expander.unselectable = true;",'\t\t\t\t\tvar expanderText = this.group.expanded ? "-" : "+";',"\t\t\t\t\tthis.expanderTextNode = this.expander.appendChild(document.createTextNode(expanderText));","\t\t\t\t\t",'\t\t\t\t\tthis.headingDiv.appendChild(document.createTextNode(" " + this.group.name));',"",'\t\t\t\t\tthis.contentDiv = this.mainDiv.appendChild(document.createElement("div"));','\t\t\t\t\tvar contentCssClass = this.group.expanded ? "expanded" : "collapsed";','\t\t\t\t\tthis.contentDiv.className = "groupcontent " + contentCssClass;',"","\t\t\t\t\tthis.expander.onclick = function() {","\t\t\t\t\t\tif (groupElementContainer.group.expandable) {","\t\t\t\t\t\t\tgroupElementContainer.group.toggleExpanded();","\t\t\t\t\t\t}","\t\t\t\t\t};","\t\t\t\t}","\t\t\t}","","\t\t\tGroupElementContainer.prototype = new LogItemContainerElement();","","\t\t\tcopyProperties(GroupElementContainer.prototype, {","\t\t\t\ttoggleExpanded: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tvar oldCssClass, newCssClass, expanderText;","\t\t\t\t\t\tif (this.group.expanded) {",'\t\t\t\t\t\t\tnewCssClass = "expanded";','\t\t\t\t\t\t\toldCssClass = "collapsed";','\t\t\t\t\t\t\texpanderText = "-";',"\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\tnewCssClass = "collapsed";','\t\t\t\t\t\t\toldCssClass = "expanded";','\t\t\t\t\t\t\texpanderText = "+";',"\t\t\t\t\t\t}","\t\t\t\t\t\treplaceClass(this.contentDiv, newCssClass, oldCssClass);","\t\t\t\t\t\tthis.expanderTextNode.nodeValue = expanderText;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tthis.headingDiv = null;","\t\t\t\t\t\tthis.expander.onclick = null;","\t\t\t\t\t\tthis.expander = null;","\t\t\t\t\t\tthis.expanderTextNode = null;","\t\t\t\t\t\tthis.contentDiv = null;","\t\t\t\t\t\tthis.containerDomNode = null;","\t\t\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\t\t\tthis.mainDiv = null;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\treverseChildren: function() {","\t\t\t\t\t// Invert the order of the log entries","\t\t\t\t\tvar node = null;","","\t\t\t\t\t// Remove all the log container nodes","\t\t\t\t\tvar childDomNodes = [];","\t\t\t\t\twhile ((node = this.contentDiv.firstChild)) {","\t\t\t\t\t\tthis.contentDiv.removeChild(node);","\t\t\t\t\t\tchildDomNodes.push(node);","\t\t\t\t\t}","","\t\t\t\t\t// Put them all back in reverse order","\t\t\t\t\twhile ((node = childDomNodes.pop())) {","\t\t\t\t\t\tthis.contentDiv.appendChild(node);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tupdate: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tif (this.group.expandable) {",'\t\t\t\t\t\t\tremoveClass(this.expander, "greyedout");',"\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\taddClass(this.expander, "greyedout");',"\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclear: function() {","\t\t\t\t\tif (this.isRoot) {",'\t\t\t\t\t\tthis.contentDiv.innerHTML = "";',"\t\t\t\t\t}","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction Group(name, isRoot, initiallyExpanded) {","\t\t\t\tthis.name = name;","\t\t\t\tthis.group = null;","\t\t\t\tthis.isRoot = isRoot;","\t\t\t\tthis.initiallyExpanded = initiallyExpanded;","\t\t\t\tthis.elementContainers = [];","\t\t\t\tthis.children = [];","\t\t\t\tthis.expanded = initiallyExpanded;","\t\t\t\tthis.rendered = false;","\t\t\t\tthis.expandable = false;","\t\t\t}","","\t\t\tGroup.prototype = new LogItem();","","\t\t\tcopyProperties(Group.prototype, {","\t\t\t\taddChild: function(logItem) {","\t\t\t\t\tthis.children.push(logItem);","\t\t\t\t\tlogItem.group = this;","\t\t\t\t},","","\t\t\t\trender: function() {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tvar unwrappedDomContainer, wrappedDomContainer;","\t\t\t\t\t\tif (this.isRoot) {","\t\t\t\t\t\t\tunwrappedDomContainer = logMainContainer;","\t\t\t\t\t\t\twrappedDomContainer = logMainContainer;","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tunwrappedDomContainer = this.getUnwrappedDomContainer();","\t\t\t\t\t\t\twrappedDomContainer = this.getWrappedDomContainer();","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.unwrappedElementContainer = new GroupElementContainer(this, unwrappedDomContainer, this.isRoot, false);","\t\t\t\t\t\tthis.wrappedElementContainer = new GroupElementContainer(this, wrappedDomContainer, this.isRoot, true);","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tvar mainDomContainer = this.isRoot ? logMainContainer : this.getMainDomContainer();","\t\t\t\t\t\tthis.mainElementContainer = new GroupElementContainer(this, mainDomContainer, this.isRoot, false);","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.rendered = true;","\t\t\t\t},","","\t\t\t\ttoggleExpanded: function() {","\t\t\t\t\tthis.expanded = !this.expanded;","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].toggleExpanded();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\texpand: function() {","\t\t\t\t\tif (!this.expanded) {","\t\t\t\t\t\tthis.toggleExpanded();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visitGroup(this);","\t\t\t\t},","","\t\t\t\treverseChildren: function() {","\t\t\t\t\tif (this.rendered) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].reverseChildren();","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tupdate: function() {","\t\t\t\t\tvar previouslyExpandable = this.expandable;","\t\t\t\t\tthis.expandable = (this.children.length !== 0);","\t\t\t\t\tif (this.expandable !== previouslyExpandable) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].update();","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tflatten: function() {","\t\t\t\t\tvar visitor = new GroupFlattener();","\t\t\t\t\tthis.accept(visitor);","\t\t\t\t\treturn visitor.logEntriesAndSeparators;","\t\t\t\t},","","\t\t\t\tremoveChild: function(child, doUpdate) {","\t\t\t\t\tarray_remove(this.children, child);","\t\t\t\t\tchild.group = null;","\t\t\t\t\tif (doUpdate) {","\t\t\t\t\t\tthis.update();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tfor (var i = 0, len = this.children.length; i < len; i++) {","\t\t\t\t\t\tthis.children[i].remove(false, false);","\t\t\t\t\t}","\t\t\t\t\tthis.children = [];","\t\t\t\t\tthis.update();","\t\t\t\t\tif (this === currentGroup) {","\t\t\t\t\t\tcurrentGroup = this.group;","\t\t\t\t\t}","\t\t\t\t\tthis.doRemove(doUpdate, removeFromGroup);","\t\t\t\t},","","\t\t\t\tserialize: function(items) {","\t\t\t\t\titems.push([LogItem.serializedItemKeys.GROUP_START, this.name]);","\t\t\t\t\tfor (var i = 0, len = this.children.length; i < len; i++) {","\t\t\t\t\t\tthis.children[i].serialize(items);","\t\t\t\t\t}","\t\t\t\t\tif (this !== currentGroup) {","\t\t\t\t\t\titems.push([LogItem.serializedItemKeys.GROUP_END]);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclear: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].clear();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryElementContainer() {","\t\t\t}","","\t\t\tLogEntryElementContainer.prototype = new LogItemContainerElement();","","\t\t\tcopyProperties(LogEntryElementContainer.prototype, {","\t\t\t\tremove: function() {","\t\t\t\t\tthis.doRemove();","\t\t\t\t},","","\t\t\t\tdoRemove: function() {","\t\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\t\tthis.mainDiv = null;","\t\t\t\t\tthis.contentElement = null;","\t\t\t\t\tthis.containerDomNode = null;","\t\t\t\t},","","\t\t\t\tsetContent: function(content, wrappedContent) {","\t\t\t\t\tif (content === this.formattedMessage) {",'\t\t\t\t\t\tthis.contentElement.innerHTML = "";',"\t\t\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.formattedMessage));","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.contentElement.innerHTML = content;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tsetSearchMatch: function(isMatch) {",'\t\t\t\t\tvar oldCssClass = isMatch ? "searchnonmatch" : "searchmatch";','\t\t\t\t\tvar newCssClass = isMatch ? "searchmatch" : "searchnonmatch";',"\t\t\t\t\treplaceClass(this.mainDiv, newCssClass, oldCssClass);","\t\t\t\t},","","\t\t\t\tclearSearch: function() {",'\t\t\t\t\tremoveClass(this.mainDiv, "searchmatch");','\t\t\t\t\tremoveClass(this.mainDiv, "searchnonmatch");',"\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryWrappedElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");',"\t\t\t\tthis.mainDiv.appendChild(document.createTextNode(this.logEntry.formattedMessage));",'\t\t\t\tthis.mainDiv.className = "logentry wrapped " + this.logEntry.level;',"\t\t\t\tthis.contentElement = this.mainDiv;","\t\t\t}","","\t\t\tLogEntryWrappedElementContainer.prototype = new LogEntryElementContainer();","","\t\t\tLogEntryWrappedElementContainer.prototype.setContent = function(content, wrappedContent) {","\t\t\t\tif (content === this.formattedMessage) {",'\t\t\t\t\tthis.contentElement.innerHTML = "";',"\t\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.formattedMessage));","\t\t\t\t} else {","\t\t\t\t\tthis.contentElement.innerHTML = wrappedContent;","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryUnwrappedElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "logentry unwrapped " + this.logEntry.level;','\t\t\t\tthis.pre = this.mainDiv.appendChild(document.createElement("pre"));',"\t\t\t\tthis.pre.appendChild(document.createTextNode(this.logEntry.formattedMessage));",'\t\t\t\tthis.pre.className = "unwrapped";',"\t\t\t\tthis.contentElement = this.pre;","\t\t\t}","","\t\t\tLogEntryUnwrappedElementContainer.prototype = new LogEntryElementContainer();","","\t\t\tLogEntryUnwrappedElementContainer.prototype.remove = function() {","\t\t\t\tthis.doRemove();","\t\t\t\tthis.pre = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryMainElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "logentry nonielogentry " + this.logEntry.level;','\t\t\t\tthis.contentElement = this.mainDiv.appendChild(document.createElement("span"));',"\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.logEntry.formattedMessage));","\t\t\t}","","\t\t\tLogEntryMainElementContainer.prototype = new LogEntryElementContainer();","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntry(level, formattedMessage) {","\t\t\t\tthis.level = level;","\t\t\t\tthis.formattedMessage = formattedMessage;","\t\t\t\tthis.rendered = false;","\t\t\t}","","\t\t\tLogEntry.prototype = new LogItem();","","\t\t\tcopyProperties(LogEntry.prototype, {","\t\t\t\trender: function() {","\t\t\t\t\tvar logEntry = this;","\t\t\t\t\tvar containerDomNode = this.group.contentDiv;","","\t\t\t\t\t// Support for the CSS attribute white-space in IE for Windows is","\t\t\t\t\t// non-existent pre version 6 and slightly odd in 6, so instead","\t\t\t\t\t// use two different HTML elements","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tthis.formattedMessage = this.formattedMessage.replace(/\\r\\n/g, "\\r"); // Workaround for IE\'s treatment of white space',"\t\t\t\t\t\tthis.unwrappedElementContainer = new LogEntryUnwrappedElementContainer(this, this.getUnwrappedDomContainer());","\t\t\t\t\t\tthis.wrappedElementContainer = new LogEntryWrappedElementContainer(this, this.getWrappedDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.mainElementContainer = new LogEntryMainElementContainer(this, this.getMainDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.content = this.formattedMessage;","\t\t\t\t\tthis.rendered = true;","\t\t\t\t},","","\t\t\t\tsetContent: function(content, wrappedContent) {","\t\t\t\t\tif (content != this.content) {","\t\t\t\t\t\tif (isIe && (content !== this.formattedMessage)) {",'\t\t\t\t\t\t\tcontent = content.replace(/\\r\\n/g, "\\r"); // Workaround for IE\'s treatment of white space',"\t\t\t\t\t\t}","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].setContent(content, wrappedContent);","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.content = content;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tgetSearchMatches: function() {","\t\t\t\t\tvar matches = [];","\t\t\t\t\tvar i, len;","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tvar unwrappedEls = getElementsByClass(this.unwrappedElementContainer.mainDiv, "searchterm", "span");','\t\t\t\t\t\tvar wrappedEls = getElementsByClass(this.wrappedElementContainer.mainDiv, "searchterm", "span");',"\t\t\t\t\t\tfor (i = 0, len = unwrappedEls.length; i < len; i++) {","\t\t\t\t\t\t\tmatches[i] = new Match(this.level, null, unwrappedEls[i], wrappedEls[i]);","\t\t\t\t\t\t}","\t\t\t\t\t} else {",'\t\t\t\t\t\tvar els = getElementsByClass(this.mainElementContainer.mainDiv, "searchterm", "span");',"\t\t\t\t\t\tfor (i = 0, len = els.length; i < len; i++) {","\t\t\t\t\t\t\tmatches[i] = new Match(this.level, els[i]);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn matches;","\t\t\t\t},","","\t\t\t\tsetSearchMatch: function(isMatch) {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].setSearchMatch(isMatch);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclearSearch: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].clearSearch();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visitLogEntry(this);","\t\t\t\t},","","\t\t\t\tserialize: function(items) {","\t\t\t\t\titems.push([LogItem.serializedItemKeys.LOG_ENTRY, this.level, this.formattedMessage]);","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemVisitor() {","\t\t\t}","","\t\t\tLogItemVisitor.prototype = {","\t\t\t\tvisit: function(logItem) {","\t\t\t\t},","","\t\t\t\tvisitParent: function(logItem) {","\t\t\t\t\tif (logItem.group) {","\t\t\t\t\t\tlogItem.group.accept(this);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tvisitChildren: function(logItem) {","\t\t\t\t\tfor (var i = 0, len = logItem.children.length; i < len; i++) {","\t\t\t\t\t\tlogItem.children[i].accept(this);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tvisitLogEntry: function(logEntry) {","\t\t\t\t\tthis.visit(logEntry);","\t\t\t\t},","","\t\t\t\tvisitSeparator: function(separator) {","\t\t\t\t\tthis.visit(separator);","\t\t\t\t},","","\t\t\t\tvisitGroup: function(group) {","\t\t\t\t\tthis.visit(group);","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction GroupFlattener() {","\t\t\t\tthis.logEntriesAndSeparators = [];","\t\t\t}","","\t\t\tGroupFlattener.prototype = new LogItemVisitor();","","\t\t\tGroupFlattener.prototype.visitGroup = function(group) {","\t\t\t\tthis.visitChildren(group);","\t\t\t};","","\t\t\tGroupFlattener.prototype.visitLogEntry = function(logEntry) {","\t\t\t\tthis.logEntriesAndSeparators.push(logEntry);","\t\t\t};","","\t\t\tGroupFlattener.prototype.visitSeparator = function(separator) {","\t\t\t\tthis.logEntriesAndSeparators.push(separator);","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\twindow.onload = function() {","\t\t\t\t// Sort out document.domain","\t\t\t\tif (location.search) {",'\t\t\t\t\tvar queryBits = unescape(location.search).substr(1).split("&"), nameValueBits;',"\t\t\t\t\tfor (var i = 0, len = queryBits.length; i < len; i++) {",'\t\t\t\t\t\tnameValueBits = queryBits[i].split("=");','\t\t\t\t\t\tif (nameValueBits[0] == "log4javascript_domain") {',"\t\t\t\t\t\t\tdocument.domain = nameValueBits[1];","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","","\t\t\t\t// Create DOM objects",'\t\t\t\tlogMainContainer = $("log");',"\t\t\t\tif (isIePre7) {",'\t\t\t\t\taddClass(logMainContainer, "oldIe");',"\t\t\t\t}","",'\t\t\t\trootGroup = new Group("root", true);',"\t\t\t\trootGroup.render();","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\t","\t\t\t\tsetCommandInputWidth();","\t\t\t\tsetLogContainerHeight();","\t\t\t\ttoggleLoggingEnabled();","\t\t\t\ttoggleSearchEnabled();","\t\t\t\ttoggleSearchFilter();","\t\t\t\ttoggleSearchHighlight();","\t\t\t\tapplyFilters();","\t\t\t\tcheckAllLevels();","\t\t\t\ttoggleWrap();","\t\t\t\ttoggleNewestAtTop();","\t\t\t\ttoggleScrollToLatest();","\t\t\t\trenderQueuedLogItems();","\t\t\t\tloaded = true;",'\t\t\t\t$("command").value = "";','\t\t\t\t$("command").autocomplete = "off";','\t\t\t\t$("command").onkeydown = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 10 || evt.keyCode == 13) { // Return/Enter","\t\t\t\t\t\tevalCommandLine();","\t\t\t\t\t\tstopPropagation(evt);","\t\t\t\t\t} else if (evt.keyCode == 27) { // Escape",'\t\t\t\t\t\tthis.value = "";',"\t\t\t\t\t\tthis.focus();","\t\t\t\t\t} else if (evt.keyCode == 38 && commandHistory.length > 0) { // Up","\t\t\t\t\t\tcurrentCommandIndex = Math.max(0, currentCommandIndex - 1);","\t\t\t\t\t\tthis.value = commandHistory[currentCommandIndex];","\t\t\t\t\t\tmoveCaretToEnd(this);","\t\t\t\t\t} else if (evt.keyCode == 40 && commandHistory.length > 0) { // Down","\t\t\t\t\t\tcurrentCommandIndex = Math.min(commandHistory.length - 1, currentCommandIndex + 1);","\t\t\t\t\t\tthis.value = commandHistory[currentCommandIndex];","\t\t\t\t\t\tmoveCaretToEnd(this);","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Prevent the keypress moving the caret in Firefox",'\t\t\t\t$("command").onkeypress = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 38 && commandHistory.length > 0 && evt.preventDefault) { // Up","\t\t\t\t\t\tevt.preventDefault();","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Prevent the keyup event blurring the input in Opera",'\t\t\t\t$("command").onkeyup = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 27 && evt.preventDefault) { // Up","\t\t\t\t\t\tevt.preventDefault();","\t\t\t\t\t\tthis.focus();","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Add document keyboard shortcuts","\t\t\t\tdocument.onkeydown = function keyEventHandler(evt) {","\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tswitch (evt.keyCode) {","\t\t\t\t\t\tcase 69: // Ctrl + shift + E: re-execute last command","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tevalLastCommand();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase 75: // Ctrl + shift + K: focus search","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tfocusSearch();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase 40: // Ctrl + shift + down arrow: focus command line","\t\t\t\t\t\tcase 76: // Ctrl + shift + L: focus command line","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tfocusCommandLine();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Workaround to make sure log div starts at the correct size","\t\t\t\tsetTimeout(setLogContainerHeight, 20);","","\t\t\t\tsetShowCommandLine(showCommandLine);","\t\t\t\tdoSearch();","\t\t\t};","","\t\t\twindow.onunload = function() {","\t\t\t\tif (mainWindowExists()) {","\t\t\t\t\tappender.unload();","\t\t\t\t}","\t\t\t\tappender = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction toggleLoggingEnabled() {",'\t\t\t\tsetLoggingEnabled($("enableLogging").checked);',"\t\t\t}","","\t\t\tfunction setLoggingEnabled(enable) {","\t\t\t\tloggingEnabled = enable;","\t\t\t}","","\t\t\tvar appender = null;","","\t\t\tfunction setAppender(appenderParam) {","\t\t\t\tappender = appenderParam;","\t\t\t}","","\t\t\tfunction setShowCloseButton(showCloseButton) {",'\t\t\t\t$("closeButton").style.display = showCloseButton ? "inline" : "none";',"\t\t\t}","","\t\t\tfunction setShowHideButton(showHideButton) {",'\t\t\t\t$("hideButton").style.display = showHideButton ? "inline" : "none";',"\t\t\t}","","\t\t\tvar newestAtTop = false;","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemContentReverser() {","\t\t\t}","\t\t\t","\t\t\tLogItemContentReverser.prototype = new LogItemVisitor();","\t\t\t","\t\t\tLogItemContentReverser.prototype.visitGroup = function(group) {","\t\t\t\tgroup.reverseChildren();","\t\t\t\tthis.visitChildren(group);","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction setNewestAtTop(isNewestAtTop) {","\t\t\t\tvar oldNewestAtTop = newestAtTop;","\t\t\t\tvar i, iLen, j, jLen;","\t\t\t\tnewestAtTop = Boolean(isNewestAtTop);","\t\t\t\tif (oldNewestAtTop != newestAtTop) {","\t\t\t\t\tvar visitor = new LogItemContentReverser();","\t\t\t\t\trootGroup.accept(visitor);","","\t\t\t\t\t// Reassemble the matches array","\t\t\t\t\tif (currentSearch) {","\t\t\t\t\t\tvar currentMatch = currentSearch.matches[currentMatchIndex];","\t\t\t\t\t\tvar matchIndex = 0;","\t\t\t\t\t\tvar matches = [];","\t\t\t\t\t\tvar actOnLogEntry = function(logEntry) {","\t\t\t\t\t\t\tvar logEntryMatches = logEntry.getSearchMatches();","\t\t\t\t\t\t\tfor (j = 0, jLen = logEntryMatches.length; j < jLen; j++) {","\t\t\t\t\t\t\t\tmatches[matchIndex] = logEntryMatches[j];","\t\t\t\t\t\t\t\tif (currentMatch && logEntryMatches[j].equals(currentMatch)) {","\t\t\t\t\t\t\t\t\tcurrentMatchIndex = matchIndex;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tmatchIndex++;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t};","\t\t\t\t\t\tif (newestAtTop) {","\t\t\t\t\t\t\tfor (i = logEntries.length - 1; i >= 0; i--) {","\t\t\t\t\t\t\t\tactOnLogEntry(logEntries[i]);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tfor (i = 0, iLen = logEntries.length; i < iLen; i++) {","\t\t\t\t\t\t\t\tactOnLogEntry(logEntries[i]);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\tcurrentSearch.matches = matches;","\t\t\t\t\t\tif (currentMatch) {","\t\t\t\t\t\t\tcurrentMatch.setCurrent();","\t\t\t\t\t\t}","\t\t\t\t\t} else if (scrollToLatest) {","\t\t\t\t\t\tdoScrollToLatest();","\t\t\t\t\t}","\t\t\t\t}",'\t\t\t\t$("newestAtTop").checked = isNewestAtTop;',"\t\t\t}","","\t\t\tfunction toggleNewestAtTop() {",'\t\t\t\tvar isNewestAtTop = $("newestAtTop").checked;',"\t\t\t\tsetNewestAtTop(isNewestAtTop);","\t\t\t}","","\t\t\tvar scrollToLatest = true;","","\t\t\tfunction setScrollToLatest(isScrollToLatest) {","\t\t\t\tscrollToLatest = isScrollToLatest;","\t\t\t\tif (scrollToLatest) {","\t\t\t\t\tdoScrollToLatest();","\t\t\t\t}",'\t\t\t\t$("scrollToLatest").checked = isScrollToLatest;',"\t\t\t}","","\t\t\tfunction toggleScrollToLatest() {",'\t\t\t\tvar isScrollToLatest = $("scrollToLatest").checked;',"\t\t\t\tsetScrollToLatest(isScrollToLatest);","\t\t\t}","","\t\t\tfunction doScrollToLatest() {","\t\t\t\tvar l = logMainContainer;",'\t\t\t\tif (typeof l.scrollTop != "undefined") {',"\t\t\t\t\tif (newestAtTop) {","\t\t\t\t\t\tl.scrollTop = 0;","\t\t\t\t\t} else {","\t\t\t\t\t\tvar latestLogEntry = l.lastChild;","\t\t\t\t\t\tif (latestLogEntry) {","\t\t\t\t\t\t\tl.scrollTop = l.scrollHeight;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tvar closeIfOpenerCloses = true;","","\t\t\tfunction setCloseIfOpenerCloses(isCloseIfOpenerCloses) {","\t\t\t\tcloseIfOpenerCloses = isCloseIfOpenerCloses;","\t\t\t}","","\t\t\tvar maxMessages = null;","","\t\t\tfunction setMaxMessages(max) {","\t\t\t\tmaxMessages = max;","\t\t\t\tpruneLogEntries();","\t\t\t}","","\t\t\tvar showCommandLine = false;","","\t\t\tfunction setShowCommandLine(isShowCommandLine) {","\t\t\t\tshowCommandLine = isShowCommandLine;","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("commandLine").style.display = showCommandLine ? "block" : "none";',"\t\t\t\t\tsetCommandInputWidth();","\t\t\t\t\tsetLogContainerHeight();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction focusCommandLine() {","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("command").focus();',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction focusSearch() {","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("searchBox").focus();',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction getLogItems() {","\t\t\t\tvar items = [];","\t\t\t\tfor (var i = 0, len = logItems.length; i < len; i++) {","\t\t\t\t\tlogItems[i].serialize(items);","\t\t\t\t}","\t\t\t\treturn items;","\t\t\t}","","\t\t\tfunction setLogItems(items) {","\t\t\t\tvar loggingReallyEnabled = loggingEnabled;","\t\t\t\t// Temporarily turn logging on","\t\t\t\tloggingEnabled = true;","\t\t\t\tfor (var i = 0, len = items.length; i < len; i++) {","\t\t\t\t\tswitch (items[i][0]) {","\t\t\t\t\t\tcase LogItem.serializedItemKeys.LOG_ENTRY:","\t\t\t\t\t\t\tlog(items[i][1], items[i][2]);","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase LogItem.serializedItemKeys.GROUP_START:","\t\t\t\t\t\t\tgroup(items[i][1]);","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase LogItem.serializedItemKeys.GROUP_END:","\t\t\t\t\t\t\tgroupEnd();","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tloggingEnabled = loggingReallyEnabled;","\t\t\t}","","\t\t\tfunction log(logLevel, formattedMessage) {","\t\t\t\tif (loggingEnabled) {","\t\t\t\t\tvar logEntry = new LogEntry(logLevel, formattedMessage);","\t\t\t\t\tlogEntries.push(logEntry);","\t\t\t\t\tlogEntriesAndSeparators.push(logEntry);","\t\t\t\t\tlogItems.push(logEntry);","\t\t\t\t\tcurrentGroup.addChild(logEntry);","\t\t\t\t\tif (loaded) {","\t\t\t\t\t\tif (logQueuedEventsTimer !== null) {","\t\t\t\t\t\t\tclearTimeout(logQueuedEventsTimer);","\t\t\t\t\t\t}","\t\t\t\t\t\tlogQueuedEventsTimer = setTimeout(renderQueuedLogItems, renderDelay);","\t\t\t\t\t\tunrenderedLogItemsExist = true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction renderQueuedLogItems() {","\t\t\t\tlogQueuedEventsTimer = null;","\t\t\t\tvar pruned = pruneLogEntries();","","\t\t\t\t// Render any unrendered log entries and apply the current search to them","\t\t\t\tvar initiallyHasMatches = currentSearch ? currentSearch.hasMatches() : false;","\t\t\t\tfor (var i = 0, len = logItems.length; i < len; i++) {","\t\t\t\t\tif (!logItems[i].rendered) {","\t\t\t\t\t\tlogItems[i].render();","\t\t\t\t\t\tlogItems[i].appendToLog();","\t\t\t\t\t\tif (currentSearch && (logItems[i] instanceof LogEntry)) {","\t\t\t\t\t\t\tcurrentSearch.applyTo(logItems[i]);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (currentSearch) {","\t\t\t\t\tif (pruned) {","\t\t\t\t\t\tif (currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\t\tif (currentMatchIndex === null) {","\t\t\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t\t}","\t\t\t\t\t} else if (!initiallyHasMatches && currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (scrollToLatest) {","\t\t\t\t\tdoScrollToLatest();","\t\t\t\t}","\t\t\t\tunrenderedLogItemsExist = false;","\t\t\t}","","\t\t\tfunction pruneLogEntries() {","\t\t\t\tif ((maxMessages !== null) && (logEntriesAndSeparators.length > maxMessages)) {","\t\t\t\t\tvar numberToDelete = logEntriesAndSeparators.length - maxMessages;","\t\t\t\t\tvar prunedLogEntries = logEntriesAndSeparators.slice(0, numberToDelete);","\t\t\t\t\tif (currentSearch) {","\t\t\t\t\t\tcurrentSearch.removeMatches(prunedLogEntries);","\t\t\t\t\t}","\t\t\t\t\tvar group;","\t\t\t\t\tfor (var i = 0; i < numberToDelete; i++) {","\t\t\t\t\t\tgroup = logEntriesAndSeparators[i].group;","\t\t\t\t\t\tarray_remove(logItems, logEntriesAndSeparators[i]);","\t\t\t\t\t\tarray_remove(logEntries, logEntriesAndSeparators[i]);","\t\t\t\t\t\tlogEntriesAndSeparators[i].remove(true, true);","\t\t\t\t\t\tif (group.children.length === 0 && group !== currentGroup && group !== rootGroup) {","\t\t\t\t\t\t\tarray_remove(logItems, group);","\t\t\t\t\t\t\tgroup.remove(true, true);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\tlogEntriesAndSeparators = array_removeFromStart(logEntriesAndSeparators, numberToDelete);","\t\t\t\t\treturn true;","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction group(name, startExpanded) {","\t\t\t\tif (loggingEnabled) {",'\t\t\t\t\tinitiallyExpanded = (typeof startExpanded === "undefined") ? true : Boolean(startExpanded);',"\t\t\t\t\tvar newGroup = new Group(name, false, initiallyExpanded);","\t\t\t\t\tcurrentGroup.addChild(newGroup);","\t\t\t\t\tcurrentGroup = newGroup;","\t\t\t\t\tlogItems.push(newGroup);","\t\t\t\t\tif (loaded) {","\t\t\t\t\t\tif (logQueuedEventsTimer !== null) {","\t\t\t\t\t\t\tclearTimeout(logQueuedEventsTimer);","\t\t\t\t\t\t}","\t\t\t\t\t\tlogQueuedEventsTimer = setTimeout(renderQueuedLogItems, renderDelay);","\t\t\t\t\t\tunrenderedLogItemsExist = true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction groupEnd() {","\t\t\t\tcurrentGroup = (currentGroup === rootGroup) ? rootGroup : currentGroup.group;","\t\t\t}","","\t\t\tfunction mainPageReloaded() {","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\tvar separator = new Separator();","\t\t\t\tlogEntriesAndSeparators.push(separator);","\t\t\t\tlogItems.push(separator);","\t\t\t\tcurrentGroup.addChild(separator);","\t\t\t}","","\t\t\tfunction closeWindow() {","\t\t\t\tif (appender && mainWindowExists()) {","\t\t\t\t\tappender.close(true);","\t\t\t\t} else {","\t\t\t\t\twindow.close();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction hide() {","\t\t\t\tif (appender && mainWindowExists()) {","\t\t\t\t\tappender.hide();","\t\t\t\t}","\t\t\t}","","\t\t\tvar mainWindow = window;",'\t\t\tvar windowId = "log4javascriptConsoleWindow_" + new Date().getTime() + "_" + ("" + Math.random()).substr(2);',"","\t\t\tfunction setMainWindow(win) {","\t\t\t\tmainWindow = win;","\t\t\t\tmainWindow[windowId] = window;","\t\t\t\t// If this is a pop-up, poll the opener to see if it's closed","\t\t\t\tif (opener && closeIfOpenerCloses) {","\t\t\t\t\tpollOpener();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction pollOpener() {","\t\t\t\tif (closeIfOpenerCloses) {","\t\t\t\t\tif (mainWindowExists()) {","\t\t\t\t\t\tsetTimeout(pollOpener, 500);","\t\t\t\t\t} else {","\t\t\t\t\t\tcloseWindow();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction mainWindowExists() {","\t\t\t\ttry {","\t\t\t\t\treturn (mainWindow && !mainWindow.closed &&","\t\t\t\t\t\tmainWindow[windowId] == window);","\t\t\t\t} catch (ex) {}","\t\t\t\treturn false;","\t\t\t}","",'\t\t\tvar logLevels = ["TRACE", "DEBUG", "INFO", "WARN", "ERROR", "FATAL"];',"","\t\t\tfunction getCheckBox(logLevel) {",'\t\t\t\treturn $("switch_" + logLevel);',"\t\t\t}","","\t\t\tfunction getIeWrappedLogContainer() {",'\t\t\t\treturn $("log_wrapped");',"\t\t\t}","","\t\t\tfunction getIeUnwrappedLogContainer() {",'\t\t\t\treturn $("log_unwrapped");',"\t\t\t}","","\t\t\tfunction applyFilters() {","\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tif (getCheckBox(logLevels[i]).checked) {","\t\t\t\t\t\taddClass(logMainContainer, logLevels[i]);","\t\t\t\t\t} else {","\t\t\t\t\t\tremoveClass(logMainContainer, logLevels[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tupdateSearchFromFilters();","\t\t\t}","","\t\t\tfunction toggleAllLevels() {",'\t\t\t\tvar turnOn = $("switch_ALL").checked;',"\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tgetCheckBox(logLevels[i]).checked = turnOn;","\t\t\t\t\tif (turnOn) {","\t\t\t\t\t\taddClass(logMainContainer, logLevels[i]);","\t\t\t\t\t} else {","\t\t\t\t\t\tremoveClass(logMainContainer, logLevels[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction checkAllLevels() {","\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tif (!getCheckBox(logLevels[i]).checked) {",'\t\t\t\t\t\tgetCheckBox("ALL").checked = false;',"\t\t\t\t\t\treturn;","\t\t\t\t\t}","\t\t\t\t}",'\t\t\t\tgetCheckBox("ALL").checked = true;',"\t\t\t}","","\t\t\tfunction clearLog() {","\t\t\t\trootGroup.clear();","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\tlogEntries = [];","\t\t\t\tlogItems = [];","\t\t\t\tlogEntriesAndSeparators = [];"," \t\t\t\tdoSearch();","\t\t\t}","","\t\t\tfunction toggleWrap() {",'\t\t\t\tvar enable = $("wrap").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "wrap");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "wrap");',"\t\t\t\t}","\t\t\t\trefreshCurrentMatch();","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------- */","","\t\t\t// Search","","\t\t\tvar searchTimer = null;","","\t\t\tfunction scheduleSearch() {","\t\t\t\ttry {","\t\t\t\t\tclearTimeout(searchTimer);","\t\t\t\t} catch (ex) {","\t\t\t\t\t// Do nothing","\t\t\t\t}","\t\t\t\tsearchTimer = setTimeout(doSearch, 500);","\t\t\t}","","\t\t\tfunction Search(searchTerm, isRegex, searchRegex, isCaseSensitive) {","\t\t\t\tthis.searchTerm = searchTerm;","\t\t\t\tthis.isRegex = isRegex;","\t\t\t\tthis.searchRegex = searchRegex;","\t\t\t\tthis.isCaseSensitive = isCaseSensitive;","\t\t\t\tthis.matches = [];","\t\t\t}","","\t\t\tSearch.prototype = {","\t\t\t\thasMatches: function() {","\t\t\t\t\treturn this.matches.length > 0;","\t\t\t\t},","","\t\t\t\thasVisibleMatches: function() {","\t\t\t\t\tif (this.hasMatches()) {","\t\t\t\t\t\tfor (var i = 0; i < this.matches.length; i++) {","\t\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\t\treturn true;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn false;","\t\t\t\t},","","\t\t\t\tmatch: function(logEntry) {","\t\t\t\t\tvar entryText = String(logEntry.formattedMessage);","\t\t\t\t\tvar matchesSearch = false;","\t\t\t\t\tif (this.isRegex) {","\t\t\t\t\t\tmatchesSearch = this.searchRegex.test(entryText);","\t\t\t\t\t} else if (this.isCaseSensitive) {","\t\t\t\t\t\tmatchesSearch = (entryText.indexOf(this.searchTerm) > -1);","\t\t\t\t\t} else {","\t\t\t\t\t\tmatchesSearch = (entryText.toLowerCase().indexOf(this.searchTerm.toLowerCase()) > -1);","\t\t\t\t\t}","\t\t\t\t\treturn matchesSearch;","\t\t\t\t},","","\t\t\t\tgetNextVisibleMatchIndex: function() {","\t\t\t\t\tfor (var i = currentMatchIndex + 1; i < this.matches.length; i++) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\t// Start again from the first match","\t\t\t\t\tfor (i = 0; i <= currentMatchIndex; i++) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn -1;","\t\t\t\t},","","\t\t\t\tgetPreviousVisibleMatchIndex: function() {","\t\t\t\t\tfor (var i = currentMatchIndex - 1; i >= 0; i--) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\t// Start again from the last match","\t\t\t\t\tfor (var i = this.matches.length - 1; i >= currentMatchIndex; i--) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn -1;","\t\t\t\t},","","\t\t\t\tapplyTo: function(logEntry) {","\t\t\t\t\tvar doesMatch = this.match(logEntry);","\t\t\t\t\tif (doesMatch) {","\t\t\t\t\t\tlogEntry.group.expand();","\t\t\t\t\t\tlogEntry.setSearchMatch(true);","\t\t\t\t\t\tvar logEntryContent;","\t\t\t\t\t\tvar wrappedLogEntryContent;",'\t\t\t\t\t\tvar searchTermReplacementStartTag = "<span class=\\"searchterm\\">";','\t\t\t\t\t\tvar searchTermReplacementEndTag = "<" + "/span>";','\t\t\t\t\t\tvar preTagName = isIe ? "pre" : "span";','\t\t\t\t\t\tvar preStartTag = "<" + preTagName + " class=\\"pre\\">";','\t\t\t\t\t\tvar preEndTag = "<" + "/" + preTagName + ">";',"\t\t\t\t\t\tvar startIndex = 0;","\t\t\t\t\t\tvar searchIndex, matchedText, textBeforeMatch;","\t\t\t\t\t\tif (this.isRegex) {",'\t\t\t\t\t\t\tvar flags = this.isCaseSensitive ? "g" : "gi";','\t\t\t\t\t\t\tvar capturingRegex = new RegExp("(" + this.searchRegex.source + ")", flags);',"","\t\t\t\t\t\t\t// Replace the search term with temporary tokens for the start and end tags",'\t\t\t\t\t\t\tvar rnd = ("" + Math.random()).substr(2);','\t\t\t\t\t\t\tvar startToken = "%%s" + rnd + "%%";','\t\t\t\t\t\t\tvar endToken = "%%e" + rnd + "%%";','\t\t\t\t\t\t\tlogEntryContent = logEntry.formattedMessage.replace(capturingRegex, startToken + "$1" + endToken);',"","\t\t\t\t\t\t\t// Escape the HTML to get rid of angle brackets","\t\t\t\t\t\t\tlogEntryContent = escapeHtml(logEntryContent);","","\t\t\t\t\t\t\t// Substitute the proper HTML back in for the search match","\t\t\t\t\t\t\tvar result;","\t\t\t\t\t\t\tvar searchString = logEntryContent;",'\t\t\t\t\t\t\tlogEntryContent = "";','\t\t\t\t\t\t\twrappedLogEntryContent = "";',"\t\t\t\t\t\t\twhile ((searchIndex = searchString.indexOf(startToken, startIndex)) > -1) {","\t\t\t\t\t\t\t\tvar endTokenIndex = searchString.indexOf(endToken, searchIndex);","\t\t\t\t\t\t\t\tmatchedText = searchString.substring(searchIndex + startToken.length, endTokenIndex);","\t\t\t\t\t\t\t\ttextBeforeMatch = searchString.substring(startIndex, searchIndex);","\t\t\t\t\t\t\t\tlogEntryContent += preStartTag + textBeforeMatch + preEndTag;","\t\t\t\t\t\t\t\tlogEntryContent += searchTermReplacementStartTag + preStartTag + matchedText +","\t\t\t\t\t\t\t\t\tpreEndTag + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\t\twrappedLogEntryContent += textBeforeMatch + searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\t\tmatchedText + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tstartIndex = endTokenIndex + endToken.length;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tlogEntryContent += preStartTag + searchString.substr(startIndex) + preEndTag;","\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\twrappedLogEntryContent += searchString.substr(startIndex);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\tlogEntryContent = "";','\t\t\t\t\t\t\twrappedLogEntryContent = "";',"\t\t\t\t\t\t\tvar searchTermReplacementLength = searchTermReplacementStartTag.length +","\t\t\t\t\t\t\t\tthis.searchTerm.length + searchTermReplacementEndTag.length;","\t\t\t\t\t\t\tvar searchTermLength = this.searchTerm.length;","\t\t\t\t\t\t\tvar searchTermLowerCase = this.searchTerm.toLowerCase();","\t\t\t\t\t\t\tvar logTextLowerCase = logEntry.formattedMessage.toLowerCase();","\t\t\t\t\t\t\twhile ((searchIndex = logTextLowerCase.indexOf(searchTermLowerCase, startIndex)) > -1) {","\t\t\t\t\t\t\t\tmatchedText = escapeHtml(logEntry.formattedMessage.substr(searchIndex, this.searchTerm.length));","\t\t\t\t\t\t\t\ttextBeforeMatch = escapeHtml(logEntry.formattedMessage.substring(startIndex, searchIndex));","\t\t\t\t\t\t\t\tvar searchTermReplacement = searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\tpreStartTag + matchedText + preEndTag + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\tlogEntryContent += preStartTag + textBeforeMatch + preEndTag + searchTermReplacement;","\t\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\t\twrappedLogEntryContent += textBeforeMatch + searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\t\tmatchedText + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tstartIndex = searchIndex + searchTermLength;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tvar textAfterLastMatch = escapeHtml(logEntry.formattedMessage.substr(startIndex));","\t\t\t\t\t\t\tlogEntryContent += preStartTag + textAfterLastMatch + preEndTag;","\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\twrappedLogEntryContent += textAfterLastMatch;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\tlogEntry.setContent(logEntryContent, wrappedLogEntryContent);","\t\t\t\t\t\tvar logEntryMatches = logEntry.getSearchMatches();","\t\t\t\t\t\tthis.matches = this.matches.concat(logEntryMatches);","\t\t\t\t\t} else {","\t\t\t\t\t\tlogEntry.setSearchMatch(false);","\t\t\t\t\t\tlogEntry.setContent(logEntry.formattedMessage, logEntry.formattedMessage);","\t\t\t\t\t}","\t\t\t\t\treturn doesMatch;","\t\t\t\t},","","\t\t\t\tremoveMatches: function(logEntries) {","\t\t\t\t\tvar matchesToRemoveCount = 0;","\t\t\t\t\tvar currentMatchRemoved = false;","\t\t\t\t\tvar matchesToRemove = [];","\t\t\t\t\tvar i, iLen, j, jLen;","","\t\t\t\t\t// Establish the list of matches to be removed","\t\t\t\t\tfor (i = 0, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\tfor (j = 0, jLen = logEntries.length; j < jLen; j++) {","\t\t\t\t\t\t\tif (this.matches[i].belongsTo(logEntries[j])) {","\t\t\t\t\t\t\t\tmatchesToRemove.push(this.matches[i]);","\t\t\t\t\t\t\t\tif (i === currentMatchIndex) {","\t\t\t\t\t\t\t\t\tcurrentMatchRemoved = true;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","","\t\t\t\t\t// Set the new current match index if the current match has been deleted","\t\t\t\t\t// This will be the first match that appears after the first log entry being","\t\t\t\t\t// deleted, if one exists; otherwise, it's the first match overall","\t\t\t\t\tvar newMatch = currentMatchRemoved ? null : this.matches[currentMatchIndex];","\t\t\t\t\tif (currentMatchRemoved) {","\t\t\t\t\t\tfor (i = currentMatchIndex, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\t\tif (this.matches[i].isVisible() && !array_contains(matchesToRemove, this.matches[i])) {","\t\t\t\t\t\t\t\tnewMatch = this.matches[i];","\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","","\t\t\t\t\t// Remove the matches","\t\t\t\t\tfor (i = 0, iLen = matchesToRemove.length; i < iLen; i++) {","\t\t\t\t\t\tarray_remove(this.matches, matchesToRemove[i]);","\t\t\t\t\t\tmatchesToRemove[i].remove();","\t\t\t\t\t}","","\t\t\t\t\t// Set the new match, if one exists","\t\t\t\t\tif (this.hasVisibleMatches()) {","\t\t\t\t\t\tif (newMatch === null) {","\t\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\t// Get the index of the new match","\t\t\t\t\t\t\tvar newMatchIndex = 0;","\t\t\t\t\t\t\tfor (i = 0, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\t\t\tif (newMatch === this.matches[i]) {","\t\t\t\t\t\t\t\t\tnewMatchIndex = i;","\t\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tsetCurrentMatchIndex(newMatchIndex);","\t\t\t\t\t\t}","\t\t\t\t\t} else {","\t\t\t\t\t\tcurrentMatchIndex = null;","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\tfunction getPageOffsetTop(el, container) {","\t\t\t\tvar currentEl = el;","\t\t\t\tvar y = 0;","\t\t\t\twhile (currentEl && currentEl != container) {","\t\t\t\t\ty += currentEl.offsetTop;","\t\t\t\t\tcurrentEl = currentEl.offsetParent;","\t\t\t\t}","\t\t\t\treturn y;","\t\t\t}","","\t\t\tfunction scrollIntoView(el) {","\t\t\t\tvar logContainer = logMainContainer;","\t\t\t\t// Check if the whole width of the element is visible and centre if not",'\t\t\t\tif (!$("wrap").checked) {',"\t\t\t\t\tvar logContainerLeft = logContainer.scrollLeft;","\t\t\t\t\tvar logContainerRight = logContainerLeft  + logContainer.offsetWidth;","\t\t\t\t\tvar elLeft = el.offsetLeft;","\t\t\t\t\tvar elRight = elLeft + el.offsetWidth;","\t\t\t\t\tif (elLeft < logContainerLeft || elRight > logContainerRight) {","\t\t\t\t\t\tlogContainer.scrollLeft = elLeft - (logContainer.offsetWidth - el.offsetWidth) / 2;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\t// Check if the whole height of the element is visible and centre if not","\t\t\t\tvar logContainerTop = logContainer.scrollTop;","\t\t\t\tvar logContainerBottom = logContainerTop  + logContainer.offsetHeight;","\t\t\t\tvar elTop = getPageOffsetTop(el) - getToolBarsHeight();","\t\t\t\tvar elBottom = elTop + el.offsetHeight;","\t\t\t\tif (elTop < logContainerTop || elBottom > logContainerBottom) {","\t\t\t\t\tlogContainer.scrollTop = elTop - (logContainer.offsetHeight - el.offsetHeight) / 2;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction Match(logEntryLevel, spanInMainDiv, spanInUnwrappedPre, spanInWrappedDiv) {","\t\t\t\tthis.logEntryLevel = logEntryLevel;","\t\t\t\tthis.spanInMainDiv = spanInMainDiv;","\t\t\t\tif (isIe) {","\t\t\t\t\tthis.spanInUnwrappedPre = spanInUnwrappedPre;","\t\t\t\t\tthis.spanInWrappedDiv = spanInWrappedDiv;","\t\t\t\t}","\t\t\t\tthis.mainSpan = isIe ? spanInUnwrappedPre : spanInMainDiv;","\t\t\t}","","\t\t\tMatch.prototype = {","\t\t\t\tequals: function(match) {","\t\t\t\t\treturn this.mainSpan === match.mainSpan;","\t\t\t\t},","","\t\t\t\tsetCurrent: function() {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\taddClass(this.spanInUnwrappedPre, "currentmatch");','\t\t\t\t\t\taddClass(this.spanInWrappedDiv, "currentmatch");',"\t\t\t\t\t\t// Scroll the visible one into view",'\t\t\t\t\t\tvar elementToScroll = $("wrap").checked ? this.spanInWrappedDiv : this.spanInUnwrappedPre;',"\t\t\t\t\t\tscrollIntoView(elementToScroll);","\t\t\t\t\t} else {",'\t\t\t\t\t\taddClass(this.spanInMainDiv, "currentmatch");',"\t\t\t\t\t\tscrollIntoView(this.spanInMainDiv);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tbelongsTo: function(logEntry) {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\treturn isDescendant(this.spanInUnwrappedPre, logEntry.unwrappedPre);","\t\t\t\t\t} else {","\t\t\t\t\t\treturn isDescendant(this.spanInMainDiv, logEntry.mainDiv);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tsetNotCurrent: function() {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tremoveClass(this.spanInUnwrappedPre, "currentmatch");','\t\t\t\t\t\tremoveClass(this.spanInWrappedDiv, "currentmatch");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(this.spanInMainDiv, "currentmatch");',"\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tisOrphan: function() {","\t\t\t\t\treturn isOrphan(this.mainSpan);","\t\t\t\t},","","\t\t\t\tisVisible: function() {","\t\t\t\t\treturn getCheckBox(this.logEntryLevel).checked;","\t\t\t\t},","","\t\t\t\tremove: function() {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tthis.spanInUnwrappedPre = null;","\t\t\t\t\t\tthis.spanInWrappedDiv = null;","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.spanInMainDiv = null;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\tvar currentSearch = null;","\t\t\tvar currentMatchIndex = null;","","\t\t\tfunction doSearch() {",'\t\t\t\tvar searchBox = $("searchBox");',"\t\t\t\tvar searchTerm = searchBox.value;",'\t\t\t\tvar isRegex = $("searchRegex").checked;','\t\t\t\tvar isCaseSensitive = $("searchCaseSensitive").checked;',"\t\t\t\tvar i;","",'\t\t\t\tif (searchTerm === "") {','\t\t\t\t\t$("searchReset").disabled = true;','\t\t\t\t\t$("searchNav").style.display = "none";','\t\t\t\t\tremoveClass(document.body, "searching");','\t\t\t\t\tremoveClass(searchBox, "hasmatches");','\t\t\t\t\tremoveClass(searchBox, "nomatches");',"\t\t\t\t\tfor (i = 0; i < logEntries.length; i++) {","\t\t\t\t\t\tlogEntries[i].clearSearch();","\t\t\t\t\t\tlogEntries[i].setContent(logEntries[i].formattedMessage, logEntries[i].formattedMessage);","\t\t\t\t\t}","\t\t\t\t\tcurrentSearch = null;","\t\t\t\t\tsetLogContainerHeight();","\t\t\t\t} else {",'\t\t\t\t\t$("searchReset").disabled = false;','\t\t\t\t\t$("searchNav").style.display = "block";',"\t\t\t\t\tvar searchRegex;","\t\t\t\t\tvar regexValid;","\t\t\t\t\tif (isRegex) {","\t\t\t\t\t\ttry {",'\t\t\t\t\t\t\tsearchRegex = isCaseSensitive ? new RegExp(searchTerm, "g") : new RegExp(searchTerm, "gi");',"\t\t\t\t\t\t\tregexValid = true;",'\t\t\t\t\t\t\treplaceClass(searchBox, "validregex", "invalidregex");','\t\t\t\t\t\t\tsearchBox.title = "Valid regex";',"\t\t\t\t\t\t} catch (ex) {","\t\t\t\t\t\t\tregexValid = false;",'\t\t\t\t\t\t\treplaceClass(searchBox, "invalidregex", "validregex");','\t\t\t\t\t\t\tsearchBox.title = "Invalid regex: " + (ex.message ? ex.message : (ex.description ? ex.description : "unknown error"));',"\t\t\t\t\t\t\treturn;","\t\t\t\t\t\t}","\t\t\t\t\t} else {",'\t\t\t\t\t\tsearchBox.title = "";','\t\t\t\t\t\tremoveClass(searchBox, "validregex");','\t\t\t\t\t\tremoveClass(searchBox, "invalidregex");',"\t\t\t\t\t}",'\t\t\t\t\taddClass(document.body, "searching");',"\t\t\t\t\tcurrentSearch = new Search(searchTerm, isRegex, searchRegex, isCaseSensitive);","\t\t\t\t\tfor (i = 0; i < logEntries.length; i++) {","\t\t\t\t\t\tcurrentSearch.applyTo(logEntries[i]);","\t\t\t\t\t}","\t\t\t\t\tsetLogContainerHeight();","","\t\t\t\t\t// Highlight the first search match","\t\t\t\t\tif (currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t} else {","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction updateSearchFromFilters() {","\t\t\t\tif (currentSearch) {","\t\t\t\t\tif (currentSearch.hasMatches()) {","\t\t\t\t\t\tif (currentMatchIndex === null) {","\t\t\t\t\t\t\tcurrentMatchIndex = 0;","\t\t\t\t\t\t}","\t\t\t\t\t\tvar currentMatch = currentSearch.matches[currentMatchIndex];","\t\t\t\t\t\tif (currentMatch.isVisible()) {","\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t\tsetCurrentMatchIndex(currentMatchIndex);","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tcurrentMatch.setNotCurrent();","\t\t\t\t\t\t\t// Find the next visible match, if one exists","\t\t\t\t\t\t\tvar nextVisibleMatchIndex = currentSearch.getNextVisibleMatchIndex();","\t\t\t\t\t\t\tif (nextVisibleMatchIndex > -1) {","\t\t\t\t\t\t\t\tsetCurrentMatchIndex(nextVisibleMatchIndex);","\t\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t\t} else {","\t\t\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t} else {","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction refreshCurrentMatch() {","\t\t\t\tif (currentSearch && currentSearch.hasVisibleMatches()) {","\t\t\t\t\tsetCurrentMatchIndex(currentMatchIndex);","\t\t\t\t}","\t\t\t}","","\t\t\tfunction displayMatches() {",'\t\t\t\treplaceClass($("searchBox"), "hasmatches", "nomatches");','\t\t\t\t$("searchBox").title = "" + currentSearch.matches.length + " matches found";','\t\t\t\t$("searchNav").style.display = "block";',"\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction displayNoMatches() {",'\t\t\t\treplaceClass($("searchBox"), "nomatches", "hasmatches");','\t\t\t\t$("searchBox").title = "No matches found";','\t\t\t\t$("searchNav").style.display = "none";',"\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction toggleSearchEnabled(enable) {",'\t\t\t\tenable = (typeof enable == "undefined") ? !$("searchDisable").checked : enable;','\t\t\t\t$("searchBox").disabled = !enable;','\t\t\t\t$("searchReset").disabled = !enable;','\t\t\t\t$("searchRegex").disabled = !enable;','\t\t\t\t$("searchNext").disabled = !enable;','\t\t\t\t$("searchPrevious").disabled = !enable;','\t\t\t\t$("searchCaseSensitive").disabled = !enable;','\t\t\t\t$("searchNav").style.display = (enable && ($("searchBox").value !== "") &&',"\t\t\t\t\t\tcurrentSearch && currentSearch.hasVisibleMatches()) ?",'\t\t\t\t\t"block" : "none";',"\t\t\t\tif (enable) {",'\t\t\t\t\tremoveClass($("search"), "greyedout");','\t\t\t\t\taddClass(document.body, "searching");','\t\t\t\t\tif ($("searchHighlight").checked) {','\t\t\t\t\t\taddClass(logMainContainer, "searchhighlight");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");',"\t\t\t\t\t}",'\t\t\t\t\tif ($("searchFilter").checked) {','\t\t\t\t\t\taddClass(logMainContainer, "searchfilter");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t\t}",'\t\t\t\t\t$("searchDisable").checked = !enable;',"\t\t\t\t} else {",'\t\t\t\t\taddClass($("search"), "greyedout");','\t\t\t\t\tremoveClass(document.body, "searching");','\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");','\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t}","\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction toggleSearchFilter() {",'\t\t\t\tvar enable = $("searchFilter").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "searchfilter");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t}","\t\t\t\trefreshCurrentMatch();","\t\t\t}","","\t\t\tfunction toggleSearchHighlight() {",'\t\t\t\tvar enable = $("searchHighlight").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "searchhighlight");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction clearSearch() {",'\t\t\t\t$("searchBox").value = "";',"\t\t\t\tdoSearch();","\t\t\t}","","\t\t\tfunction searchNext() {","\t\t\t\tif (currentSearch !== null && currentMatchIndex !== null) {","\t\t\t\t\tcurrentSearch.matches[currentMatchIndex].setNotCurrent();","\t\t\t\t\tvar nextMatchIndex = currentSearch.getNextVisibleMatchIndex();",'\t\t\t\t\tif (nextMatchIndex > currentMatchIndex || confirm("Reached the end of the page. Start from the top?")) {',"\t\t\t\t\t\tsetCurrentMatchIndex(nextMatchIndex);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction searchPrevious() {","\t\t\t\tif (currentSearch !== null && currentMatchIndex !== null) {","\t\t\t\t\tcurrentSearch.matches[currentMatchIndex].setNotCurrent();","\t\t\t\t\tvar previousMatchIndex = currentSearch.getPreviousVisibleMatchIndex();",'\t\t\t\t\tif (previousMatchIndex < currentMatchIndex || confirm("Reached the start of the page. Continue from the bottom?")) {',"\t\t\t\t\t\tsetCurrentMatchIndex(previousMatchIndex);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction setCurrentMatchIndex(index) {","\t\t\t\tcurrentMatchIndex = index;","\t\t\t\tcurrentSearch.matches[currentMatchIndex].setCurrent();","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------------- */","","\t\t\t// CSS Utilities","","\t\t\tfunction addClass(el, cssClass) {","\t\t\t\tif (!hasClass(el, cssClass)) {","\t\t\t\t\tif (el.className) {",'\t\t\t\t\t\tel.className += " " + cssClass;',"\t\t\t\t\t} else {","\t\t\t\t\t\tel.className = cssClass;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction hasClass(el, cssClass) {","\t\t\t\tif (el.className) {",'\t\t\t\t\tvar classNames = el.className.split(" ");',"\t\t\t\t\treturn array_contains(classNames, cssClass);","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction removeClass(el, cssClass) {","\t\t\t\tif (hasClass(el, cssClass)) {","\t\t\t\t\t// Rebuild the className property",'\t\t\t\t\tvar existingClasses = el.className.split(" ");',"\t\t\t\t\tvar newClasses = [];","\t\t\t\t\tfor (var i = 0, len = existingClasses.length; i < len; i++) {","\t\t\t\t\t\tif (existingClasses[i] != cssClass) {","\t\t\t\t\t\t\tnewClasses[newClasses.length] = existingClasses[i];","\t\t\t\t\t\t}","\t\t\t\t\t}",'\t\t\t\t\tel.className = newClasses.join(" ");',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction replaceClass(el, newCssClass, oldCssClass) {","\t\t\t\tremoveClass(el, oldCssClass);","\t\t\t\taddClass(el, newCssClass);","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------------- */","","\t\t\t// Other utility functions","","\t\t\tfunction getElementsByClass(el, cssClass, tagName) {","\t\t\t\tvar elements = el.getElementsByTagName(tagName);","\t\t\t\tvar matches = [];","\t\t\t\tfor (var i = 0, len = elements.length; i < len; i++) {","\t\t\t\t\tif (hasClass(elements[i], cssClass)) {","\t\t\t\t\t\tmatches.push(elements[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\treturn matches;","\t\t\t}","","\t\t\t// Syntax borrowed from Prototype library","\t\t\tfunction $(id) {","\t\t\t\treturn document.getElementById(id);","\t\t\t}","","\t\t\tfunction isDescendant(node, ancestorNode) {","\t\t\t\twhile (node != null) {","\t\t\t\t\tif (node === ancestorNode) {","\t\t\t\t\t\treturn true;","\t\t\t\t\t}","\t\t\t\t\tnode = node.parentNode;","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction isOrphan(node) {","\t\t\t\tvar currentNode = node;","\t\t\t\twhile (currentNode) {","\t\t\t\t\tif (currentNode == document.body) {","\t\t\t\t\t\treturn false;","\t\t\t\t\t}","\t\t\t\t\tcurrentNode = currentNode.parentNode;","\t\t\t\t}","\t\t\t\treturn true;","\t\t\t}","","\t\t\tfunction escapeHtml(str) {",'\t\t\t\treturn str.replace(/&/g, "&amp;").replace(/[<]/g, "&lt;").replace(/>/g, "&gt;");',"\t\t\t}","","\t\t\tfunction getWindowWidth() {","\t\t\t\tif (window.innerWidth) {","\t\t\t\t\treturn window.innerWidth;","\t\t\t\t} else if (document.documentElement && document.documentElement.clientWidth) {","\t\t\t\t\treturn document.documentElement.clientWidth;","\t\t\t\t} else if (document.body) {","\t\t\t\t\treturn document.body.clientWidth;","\t\t\t\t}","\t\t\t\treturn 0;","\t\t\t}","","\t\t\tfunction getWindowHeight() {","\t\t\t\tif (window.innerHeight) {","\t\t\t\t\treturn window.innerHeight;","\t\t\t\t} else if (document.documentElement && document.documentElement.clientHeight) {","\t\t\t\t\treturn document.documentElement.clientHeight;","\t\t\t\t} else if (document.body) {","\t\t\t\t\treturn document.body.clientHeight;","\t\t\t\t}","\t\t\t\treturn 0;","\t\t\t}","","\t\t\tfunction getToolBarsHeight() {",'\t\t\t\treturn $("switches").offsetHeight;',"\t\t\t}","","\t\t\tfunction getChromeHeight() {","\t\t\t\tvar height = getToolBarsHeight();","\t\t\t\tif (showCommandLine) {",'\t\t\t\t\theight += $("commandLine").offsetHeight;',"\t\t\t\t}","\t\t\t\treturn height;","\t\t\t}","","\t\t\tfunction setLogContainerHeight() {","\t\t\t\tif (logMainContainer) {","\t\t\t\t\tvar windowHeight = getWindowHeight();",'\t\t\t\t\t$("body").style.height = getWindowHeight() + "px";','\t\t\t\t\tlogMainContainer.style.height = "" +','\t\t\t\t\t\tMath.max(0, windowHeight - getChromeHeight()) + "px";',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction setCommandInputWidth() {","\t\t\t\tif (showCommandLine) {",'\t\t\t\t\t$("command").style.width = "" + Math.max(0, $("commandLineContainer").offsetWidth -','\t\t\t\t\t\t($("evaluateButton").offsetWidth + 13)) + "px";',"\t\t\t\t}","\t\t\t}","","\t\t\twindow.onresize = function() {","\t\t\t\tsetCommandInputWidth();","\t\t\t\tsetLogContainerHeight();","\t\t\t};","","\t\t\tif (!Array.prototype.push) {","\t\t\t\tArray.prototype.push = function() {","\t\t\t        for (var i = 0, len = arguments.length; i < len; i++){","\t\t\t            this[this.length] = arguments[i];","\t\t\t        }","\t\t\t        return this.length;","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.pop) {","\t\t\t\tArray.prototype.pop = function() {","\t\t\t\t\tif (this.length > 0) {","\t\t\t\t\t\tvar val = this[this.length - 1];","\t\t\t\t\t\tthis.length = this.length - 1;","\t\t\t\t\t\treturn val;","\t\t\t\t\t}","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.shift) {","\t\t\t\tArray.prototype.shift = function() {","\t\t\t\t\tif (this.length > 0) {","\t\t\t\t\t\tvar firstItem = this[0];","\t\t\t\t\t\tfor (var i = 0, len = this.length - 1; i < len; i++) {","\t\t\t\t\t\t\tthis[i] = this[i + 1];","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.length = this.length - 1;","\t\t\t\t\t\treturn firstItem;","\t\t\t\t\t}","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.splice) {","\t\t\t\tArray.prototype.splice = function(startIndex, deleteCount) {","\t\t\t\t\tvar itemsAfterDeleted = this.slice(startIndex + deleteCount);","\t\t\t\t\tvar itemsDeleted = this.slice(startIndex, startIndex + deleteCount);","\t\t\t\t\tthis.length = startIndex;","\t\t\t\t\t// Copy the arguments into a proper Array object","\t\t\t\t\tvar argumentsArray = [];","\t\t\t\t\tfor (var i = 0, len = arguments.length; i < len; i++) {","\t\t\t\t\t\targumentsArray[i] = arguments[i];","\t\t\t\t\t}","\t\t\t\t\tvar itemsToAppend = (argumentsArray.length > 2) ?","\t\t\t\t\t\titemsAfterDeleted = argumentsArray.slice(2).concat(itemsAfterDeleted) : itemsAfterDeleted;","\t\t\t\t\tfor (i = 0, len = itemsToAppend.length; i < len; i++) {","\t\t\t\t\t\tthis.push(itemsToAppend[i]);","\t\t\t\t\t}","\t\t\t\t\treturn itemsDeleted;","\t\t\t\t};","\t\t\t}","","\t\t\tfunction array_remove(arr, val) {","\t\t\t\tvar index = -1;","\t\t\t\tfor (var i = 0, len = arr.length; i < len; i++) {","\t\t\t\t\tif (arr[i] === val) {","\t\t\t\t\t\tindex = i;","\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (index >= 0) {","\t\t\t\t\tarr.splice(index, 1);","\t\t\t\t\treturn index;","\t\t\t\t} else {","\t\t\t\t\treturn false;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction array_removeFromStart(array, numberToRemove) {","\t\t\t\tif (Array.prototype.splice) {","\t\t\t\t\tarray.splice(0, numberToRemove);","\t\t\t\t} else {","\t\t\t\t\tfor (var i = numberToRemove, len = array.length; i < len; i++) {","\t\t\t\t\t\tarray[i - numberToRemove] = array[i];","\t\t\t\t\t}","\t\t\t\t\tarray.length = array.length - numberToRemove;","\t\t\t\t}","\t\t\t\treturn array;","\t\t\t}","","\t\t\tfunction array_contains(arr, val) {","\t\t\t\tfor (var i = 0, len = arr.length; i < len; i++) {","\t\t\t\t\tif (arr[i] == val) {","\t\t\t\t\t\treturn true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction getErrorMessage(ex) {","\t\t\t\tif (ex.message) {","\t\t\t\t\treturn ex.message;","\t\t\t\t} else if (ex.description) {","\t\t\t\t\treturn ex.description;","\t\t\t\t}",'\t\t\t\treturn "" + ex;',"\t\t\t}","","\t\t\tfunction moveCaretToEnd(input) {","\t\t\t\tif (input.setSelectionRange) {","\t\t\t\t\tinput.focus();","\t\t\t\t\tvar length = input.value.length;","\t\t\t\t\tinput.setSelectionRange(length, length);","\t\t\t\t} else if (input.createTextRange) {","\t\t\t\t\tvar range = input.createTextRange();","\t\t\t\t\trange.collapse(false);","\t\t\t\t\trange.select();","\t\t\t\t}","\t\t\t\tinput.focus();","\t\t\t}","","\t\t\tfunction stopPropagation(evt) {","\t\t\t\tif (evt.stopPropagation) {","\t\t\t\t\tevt.stopPropagation();",'\t\t\t\t} else if (typeof evt.cancelBubble != "undefined") {',"\t\t\t\t\tevt.cancelBubble = true;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction getEvent(evt) {","\t\t\t\treturn evt ? evt : event;","\t\t\t}","","\t\t\tfunction getTarget(evt) {","\t\t\t\treturn evt.target ? evt.target : evt.srcElement;","\t\t\t}","","\t\t\tfunction getRelatedTarget(evt) {","\t\t\t\tif (evt.relatedTarget) {","\t\t\t\t\treturn evt.relatedTarget;","\t\t\t\t} else if (evt.srcElement) {","\t\t\t\t\tswitch(evt.type) {",'\t\t\t\t\t\tcase "mouseover":',"\t\t\t\t\t\t\treturn evt.fromElement;",'\t\t\t\t\t\tcase "mouseout":',"\t\t\t\t\t\t\treturn evt.toElement;","\t\t\t\t\t\tdefault:","\t\t\t\t\t\t\treturn evt.srcElement;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction cancelKeyEvent(evt) {","\t\t\t\tevt.returnValue = false;","\t\t\t\tstopPropagation(evt);","\t\t\t}","","\t\t\tfunction evalCommandLine() {",'\t\t\t\tvar expr = $("command").value;',"\t\t\t\tevalCommand(expr);",'\t\t\t\t$("command").value = "";',"\t\t\t}","","\t\t\tfunction evalLastCommand() {","\t\t\t\tif (lastCommand != null) {","\t\t\t\t\tevalCommand(lastCommand);","\t\t\t\t}","\t\t\t}","","\t\t\tvar lastCommand = null;","\t\t\tvar commandHistory = [];","\t\t\tvar currentCommandIndex = 0;","","\t\t\tfunction evalCommand(expr) {","\t\t\t\tif (appender) {","\t\t\t\t\tappender.evalCommandAndAppend(expr);","\t\t\t\t} else {",'\t\t\t\t\tvar prefix = ">>> " + expr + "\\r\\n";',"\t\t\t\t\ttry {",'\t\t\t\t\t\tlog("INFO", prefix + eval(expr));',"\t\t\t\t\t} catch (ex) {",'\t\t\t\t\t\tlog("ERROR", prefix + "Error: " + getErrorMessage(ex));',"\t\t\t\t\t}","\t\t\t\t}","\t\t\t\t// Update command history","\t\t\t\tif (expr != commandHistory[commandHistory.length - 1]) {","\t\t\t\t\tcommandHistory.push(expr);","\t\t\t\t\t// Update the appender","\t\t\t\t\tif (appender) {","\t\t\t\t\t\tappender.storeCommandHistory(commandHistory);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tcurrentCommandIndex = (expr == commandHistory[currentCommandIndex]) ? currentCommandIndex + 1 : commandHistory.length;","\t\t\t\tlastCommand = expr;","\t\t\t}","\t\t\t//]]>","\t\t<\/script>",'\t\t<style type="text/css">',"\t\t\tbody {","\t\t\t\tbackground-color: white;","\t\t\t\tcolor: black;","\t\t\t\tpadding: 0;","\t\t\t\tmargin: 0;","\t\t\t\tfont-family: tahoma, verdana, arial, helvetica, sans-serif;","\t\t\t\toverflow: hidden;","\t\t\t}","","\t\t\tdiv#switchesContainer input {","\t\t\t\tmargin-bottom: 0;","\t\t\t}","","\t\t\tdiv.toolbar {","\t\t\t\tborder-top: solid #ffffff 1px;","\t\t\t\tborder-bottom: solid #aca899 1px;","\t\t\t\tbackground-color: #f1efe7;","\t\t\t\tpadding: 3px 5px;","\t\t\t\tfont-size: 68.75%;","\t\t\t}","","\t\t\tdiv.toolbar, div#search input {","\t\t\t\tfont-family: tahoma, verdana, arial, helvetica, sans-serif;","\t\t\t}","","\t\t\tdiv.toolbar input.button {","\t\t\t\tpadding: 0 5px;","\t\t\t\tfont-size: 100%;","\t\t\t}","","\t\t\tdiv.toolbar input.hidden {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#switches input#clearButton {","\t\t\t\tmargin-left: 20px;","\t\t\t}","","\t\t\tdiv#levels label {","\t\t\t\tfont-weight: bold;","\t\t\t}","","\t\t\tdiv#levels label, div#options label {","\t\t\t\tmargin-right: 5px;","\t\t\t}","","\t\t\tdiv#levels label#wrapLabel {","\t\t\t\tfont-weight: normal;","\t\t\t}","","\t\t\tdiv#search label {","\t\t\t\tmargin-right: 10px;","\t\t\t}","","\t\t\tdiv#search label.searchboxlabel {","\t\t\t\tmargin-right: 0;","\t\t\t}","","\t\t\tdiv#search input {","\t\t\t\tfont-size: 100%;","\t\t\t}","","\t\t\tdiv#search input.validregex {","\t\t\t\tcolor: green;","\t\t\t}","","\t\t\tdiv#search input.invalidregex {","\t\t\t\tcolor: red;","\t\t\t}","","\t\t\tdiv#search input.nomatches {","\t\t\t\tcolor: white;","\t\t\t\tbackground-color: #ff6666;","\t\t\t}","","\t\t\tdiv#search input.nomatches {","\t\t\t\tcolor: white;","\t\t\t\tbackground-color: #ff6666;","\t\t\t}","","\t\t\tdiv#searchNav {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#commandLine {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#commandLine input#command {","\t\t\t\tfont-size: 100%;","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t}","","\t\t\tdiv#commandLine input#evaluateButton {","\t\t\t}","","\t\t\t*.greyedout {","\t\t\t\tcolor: gray !important;","\t\t\t\tborder-color: gray !important;","\t\t\t}","","\t\t\t*.greyedout *.alwaysenabled { color: black; }","","\t\t\t*.unselectable {","\t\t\t\t-khtml-user-select: none;","\t\t\t\t-moz-user-select: none;","\t\t\t\tuser-select: none;","\t\t\t}","","\t\t\tdiv#log {","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t\tfont-size: 75%;","\t\t\t\twidth: 100%;","\t\t\t\toverflow: auto;","\t\t\t\tclear: both;","\t\t\t\tposition: relative;","\t\t\t}","","\t\t\tdiv.group {","\t\t\t\tborder-color: #cccccc;","\t\t\t\tborder-style: solid;","\t\t\t\tborder-width: 1px 0 1px 1px;","\t\t\t\toverflow: visible;","\t\t\t}","","\t\t\tdiv.oldIe div.group, div.oldIe div.group *, div.oldIe *.logentry {","\t\t\t\theight: 1%;","\t\t\t}","","\t\t\tdiv.group div.groupheading span.expander {","\t\t\t\tborder: solid black 1px;","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t\tfont-size: 0.833em;","\t\t\t\tbackground-color: #eeeeee;","\t\t\t\tposition: relative;","\t\t\t\ttop: -1px;","\t\t\t\tcolor: black;","\t\t\t\tpadding: 0 2px;","\t\t\t\tcursor: pointer;","\t\t\t\tcursor: hand;","\t\t\t\theight: 1%;","\t\t\t}","","\t\t\tdiv.group div.groupcontent {","\t\t\t\tmargin-left: 10px;","\t\t\t\tpadding-bottom: 2px;","\t\t\t\toverflow: visible;","\t\t\t}","","\t\t\tdiv.group div.expanded {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv.group div.collapsed {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\t*.logentry {","\t\t\t\toverflow: visible;","\t\t\t\tdisplay: none;","\t\t\t\twhite-space: pre;","\t\t\t}","","\t\t\tspan.pre {","\t\t\t\twhite-space: pre;","\t\t\t}","\t\t\t","\t\t\tpre.unwrapped {","\t\t\t\tdisplay: inline !important;","\t\t\t}","","\t\t\tpre.unwrapped pre.pre, div.wrapped pre.pre {","\t\t\t\tdisplay: inline;","\t\t\t}","","\t\t\tdiv.wrapped pre.pre {","\t\t\t\twhite-space: normal;","\t\t\t}","","\t\t\tdiv.wrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tbody.searching *.logentry span.currentmatch {","\t\t\t\tcolor: white !important;","\t\t\t\tbackground-color: green !important;","\t\t\t}","","\t\t\tbody.searching div.searchhighlight *.logentry span.searchterm {","\t\t\t\tcolor: black;","\t\t\t\tbackground-color: yellow;","\t\t\t}","","\t\t\tdiv.wrap *.logentry {","\t\t\t\twhite-space: normal !important;","\t\t\t\tborder-width: 0 0 1px 0;","\t\t\t\tborder-color: #dddddd;","\t\t\t\tborder-style: dotted;","\t\t\t}","","\t\t\tdiv.wrap #log_wrapped, #log_unwrapped {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv.wrap #log_unwrapped, #log_wrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv.wrap *.logentry span.pre {","\t\t\t\toverflow: visible;","\t\t\t\twhite-space: normal;","\t\t\t}","","\t\t\tdiv.wrap *.logentry pre.unwrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv.wrap *.logentry span.wrapped {","\t\t\t\tdisplay: inline;","\t\t\t}","","\t\t\tdiv.searchfilter *.searchnonmatch {","\t\t\t\tdisplay: none !important;","\t\t\t}","","\t\t\tdiv#log *.TRACE, label#label_TRACE {","\t\t\t\tcolor: #666666;","\t\t\t}","","\t\t\tdiv#log *.DEBUG, label#label_DEBUG {","\t\t\t\tcolor: green;","\t\t\t}","","\t\t\tdiv#log *.INFO, label#label_INFO {","\t\t\t\tcolor: #000099;","\t\t\t}","","\t\t\tdiv#log *.WARN, label#label_WARN {","\t\t\t\tcolor: #999900;","\t\t\t}","","\t\t\tdiv#log *.ERROR, label#label_ERROR {","\t\t\t\tcolor: red;","\t\t\t}","","\t\t\tdiv#log *.FATAL, label#label_FATAL {","\t\t\t\tcolor: #660066;","\t\t\t}","","\t\t\tdiv.TRACE#log *.TRACE,","\t\t\tdiv.DEBUG#log *.DEBUG,","\t\t\tdiv.INFO#log *.INFO,","\t\t\tdiv.WARN#log *.WARN,","\t\t\tdiv.ERROR#log *.ERROR,","\t\t\tdiv.FATAL#log *.FATAL {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv#log div.separator {","\t\t\t\tbackground-color: #cccccc;","\t\t\t\tmargin: 5px 0;","\t\t\t\tline-height: 1px;","\t\t\t}","\t\t</style>","\t</head>","",'\t<body id="body">','\t\t<div id="switchesContainer">','\t\t\t<div id="switches">','\t\t\t\t<div id="levels" class="toolbar">',"\t\t\t\t\tFilters:",'\t\t\t\t\t<input type="checkbox" id="switch_TRACE" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide trace messages" /><label for="switch_TRACE" id="label_TRACE">trace</label>','\t\t\t\t\t<input type="checkbox" id="switch_DEBUG" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide debug messages" /><label for="switch_DEBUG" id="label_DEBUG">debug</label>','\t\t\t\t\t<input type="checkbox" id="switch_INFO" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide info messages" /><label for="switch_INFO" id="label_INFO">info</label>','\t\t\t\t\t<input type="checkbox" id="switch_WARN" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide warn messages" /><label for="switch_WARN" id="label_WARN">warn</label>','\t\t\t\t\t<input type="checkbox" id="switch_ERROR" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide error messages" /><label for="switch_ERROR" id="label_ERROR">error</label>','\t\t\t\t\t<input type="checkbox" id="switch_FATAL" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide fatal messages" /><label for="switch_FATAL" id="label_FATAL">fatal</label>','\t\t\t\t\t<input type="checkbox" id="switch_ALL" onclick="toggleAllLevels(); applyFilters()" checked="checked" title="Show/hide all messages" /><label for="switch_ALL" id="label_ALL">all</label>',"\t\t\t\t</div>",'\t\t\t\t<div id="search" class="toolbar">','\t\t\t\t\t<label for="searchBox" class="searchboxlabel">Search:</label> <input type="text" id="searchBox" onclick="toggleSearchEnabled(true)" onkeyup="scheduleSearch()" size="20" />','\t\t\t\t\t<input type="button" id="searchReset" disabled="disabled" value="Reset" onclick="clearSearch()" class="button" title="Reset the search" />','\t\t\t\t\t<input type="checkbox" id="searchRegex" onclick="doSearch()" title="If checked, search is treated as a regular expression" /><label for="searchRegex">Regex</label>','\t\t\t\t\t<input type="checkbox" id="searchCaseSensitive" onclick="doSearch()" title="If checked, search is case sensitive" /><label for="searchCaseSensitive">Match case</label>','\t\t\t\t\t<input type="checkbox" id="searchDisable" onclick="toggleSearchEnabled()" title="Enable/disable search" /><label for="searchDisable" class="alwaysenabled">Disable</label>','\t\t\t\t\t<div id="searchNav">','\t\t\t\t\t\t<input type="button" id="searchNext" disabled="disabled" value="Next" onclick="searchNext()" class="button" title="Go to the next matching log entry" />','\t\t\t\t\t\t<input type="button" id="searchPrevious" disabled="disabled" value="Previous" onclick="searchPrevious()" class="button" title="Go to the previous matching log entry" />','\t\t\t\t\t\t<input type="checkbox" id="searchFilter" onclick="toggleSearchFilter()" title="If checked, non-matching log entries are filtered out" /><label for="searchFilter">Filter</label>','\t\t\t\t\t\t<input type="checkbox" id="searchHighlight" onclick="toggleSearchHighlight()" title="Highlight matched search terms" /><label for="searchHighlight" class="alwaysenabled">Highlight all</label>',"\t\t\t\t\t</div>","\t\t\t\t</div>",'\t\t\t\t<div id="options" class="toolbar">',"\t\t\t\t\tOptions:",'\t\t\t\t\t<input type="checkbox" id="enableLogging" onclick="toggleLoggingEnabled()" checked="checked" title="Enable/disable logging" /><label for="enableLogging" id="enableLoggingLabel">Log</label>','\t\t\t\t\t<input type="checkbox" id="wrap" onclick="toggleWrap()" title="Enable / disable word wrap" /><label for="wrap" id="wrapLabel">Wrap</label>','\t\t\t\t\t<input type="checkbox" id="newestAtTop" onclick="toggleNewestAtTop()" title="If checked, causes newest messages to appear at the top" /><label for="newestAtTop" id="newestAtTopLabel">Newest at the top</label>','\t\t\t\t\t<input type="checkbox" id="scrollToLatest" onclick="toggleScrollToLatest()" checked="checked" title="If checked, window automatically scrolls to a new message when it is added" /><label for="scrollToLatest" id="scrollToLatestLabel">Scroll to latest</label>','\t\t\t\t\t<input type="button" id="clearButton" value="Clear" onclick="clearLog()" class="button" title="Clear all log messages"  />','\t\t\t\t\t<input type="button" id="hideButton" value="Hide" onclick="hide()" class="hidden button" title="Hide the console" />','\t\t\t\t\t<input type="button" id="closeButton" value="Close" onclick="closeWindow()" class="hidden button" title="Close the window" />',"\t\t\t\t</div>","\t\t\t</div>","\t\t</div>",'\t\t<div id="log" class="TRACE DEBUG INFO WARN ERROR FATAL"></div>','\t\t<div id="commandLine" class="toolbar">','\t\t\t<div id="commandLineContainer">','\t\t\t\t<input type="text" id="command" title="Enter a JavaScript command here and hit return or press \'Evaluate\'" />','\t\t\t\t<input type="button" id="evaluateButton" value="Evaluate" class="button" title="Evaluate the command" onclick="evalCommandLine()" />',"\t\t\t</div>","\t\t</div>","\t</body>","</html>",""];e.open();for(var r=0,o=t.length;r<o;r++)e.writeln(t[r]);e.close()};this.setEventTypes(["load","unload"]);var q=function(){var e=w();e.setAppender(h),e.setNewestAtTop(a),e.setScrollToLatest(v),e.setMaxMessages(E),e.setShowCommandLine(I),e.setShowHideButton(R),e.setShowCloseButton(C),e.setMainWindow(window);var t=getCookie(V);t&&(e.commandHistory=t.split(","),e.currentCommandIndex=e.commandHistory.length),h.dispatchEvent("load",{win:e})};this.unload=function(){logLog.debug("unload "+this+", caller: "+this.unload.caller),f||(logLog.debug("really doing unload "+this),c=p=!(f=!0),h.dispatchEvent("unload",{}))};var G=function(e,t,r,o){var n=setInterval(function(){try{f&&clearInterval(n),e(w())&&(clearInterval(n),r())}catch(e){clearInterval(n),m=!1,handleError(o,e)}},t)},H=function(){var e=document.domain!=location.hostname;return d?"":getBaseUrl()+"console_uncompressed.html"+(e?"?log4javascript_domain="+escape(document.domain):"")};if(e){var W,Y=null,z=[],K=!(this.addCssProperty=function(e,t){M("cssProperties")&&z.push([e,t])}),X=uniqueId+"_InPageAppender_"+g;this.hide=function(){n&&c&&(x()&&w().$("command").blur(),W.style.display="none",A=!0)},this.show=function(){n&&(c?(W.style.display="block",this.setShowCommandLine(I),A=!1):K||b(!0))},this.isVisible=function(){return!A&&!f},this.close=function(e){f||e&&!confirm("This will permanently remove the console from the page. No more messages will be logged. Do you wish to continue?")||(W.parentNode.removeChild(W),this.unload())},S=function(){var t="InPageAppender.open: unable to create console iframe";function r(){try{s||h.show(),q(),p=!0,D()}catch(e){m=!1,handleError(t,e)}}function e(){try{var e=function(e){return isLoaded(e)};d&&F(w().document),e(w())?r():G(e,100,r,t)}catch(e){m=!1,handleError(t,e)}}A=!1,(W=Y.appendChild(document.createElement("div"))).style.width=l,W.style.height=u,W.style.border="solid gray 1px";for(var o=0,n=z.length;o<n;o++)W.style[z[o][0]]=z[o][1];var i=d?"":" src='"+H()+"'";W.innerHTML="<iframe id='"+X+"' name='"+X+"' width='100%' height='100%' frameborder='0'"+i+" scrolling='no'></iframe>",f=!1;var a=function(e){try{return bool(e)&&bool(e.document)}catch(e){return!1}};a(w())?e():G(a,100,e,t),c=!0},b=function(e){if(e||!s){var t=function(){if(r)try{var e=document.getElementById(r);1==e.nodeType&&(Y=e),S()}catch(e){handleError("InPageAppender.init: invalid container element '"+r+"' supplied",e)}else(Y=document.createElement("div")).style.position="fixed",Y.style.left="0",Y.style.right="0",Y.style.bottom="0",document.body.appendChild(Y),h.addCssProperty("borderWidth","1px 0 0 0"),h.addCssProperty("zIndex",1e6),S()};pageLoaded&&r&&r.appendChild?(Y=r,S()):pageLoaded?t():log4javascript.addEventListener("load",t),K=!0}},y=function(){b(),n=!0},w=function(){var e=window.frames[X];if(e)return e},_=function(){return!(!m||f)&&(c&&!p&&w()&&isLoaded(w())&&(p=!0),p)}}else{var J,Q=h.defaults.useOldPopUp,$=h.defaults.complainAboutPopUpBlocking,Z=this.defaults.reopenWhenClosed;this.isUseOldPopUp=function(){return Q},this.setUseOldPopUp=function(e){M("useOldPopUp")&&(Q=bool(e))},this.isComplainAboutPopUpBlocking=function(){return $},this.setComplainAboutPopUpBlocking=function(e){M("complainAboutPopUpBlocking")&&($=bool(e))},this.isFocusPopUp=function(){return o},this.setFocusPopUp=function(e){o=bool(e)},this.isReopenWhenClosed=function(){return Z},this.setReopenWhenClosed=function(e){Z=bool(e)},this.close=function(){logLog.debug("close "+this);try{J.close(),this.unload()}catch(e){}},this.hide=function(){logLog.debug("hide "+this),x()&&this.close()},this.show=function(){logLog.debug("show "+this),c||S()},this.isVisible=function(){return _()},S=function(){var e="width="+l+",height="+u+",status,resizable",t="";try{var r=window.frameElement;r&&(t="_"+r.tagName+"_"+(r.name||r.id||""))}catch(e){t="_inaccessibleParentFrame"}var o="PopUp_"+location.host.replace(/[^a-z0-9]/gi,"_")+"_"+g+t;Q&&d||(o=o+"_"+uniqueId);var n=function(e){if(f)return!0;try{return bool(e)&&e.closed}catch(e){}return!1},i=function(){f||h.unload()};function a(){w().setCloseIfOpenerCloses(!Q||!d),q(),p=!0,D(),G(n,500,i,"PopUpAppender.checkPopUpClosed: error checking pop-up window")}try{if(J=window.open(H(),o,e),c=!(f=!1),J&&J.document)if(d&&Q&&isLoaded(J))J.mainPageReloaded(),a();else{d&&F(J.document);isLoaded(J)?a():G(function(e){return bool(e)&&isLoaded(e)},100,a,"PopUpAppender.init: unable to create console window")}else m=!1,logLog.warn("PopUpAppender.init: pop-ups blocked, please unblock to use PopUpAppender"),$&&handleError("log4javascript: pop-up windows appear to be blocked. Please unblock them to use pop-up logging.")}catch(e){handleError("PopUpAppender.init: error creating pop-up",e)}},b=function(){s||S()},y=function(){b(),n=!0},w=function(){return J},_=function(){if(m&&!isUndefined(J)&&!f){if(J.closed||p&&isUndefined(J.closed))return h.unload(),logLog.debug("PopUpAppender: pop-up closed"),!1;!p&&isLoaded(J)&&(p=!0)}return m&&p&&!f}}this.getConsoleWindow=w},ConsoleAppender.addGlobalCommandLineFunction=function(e,t){ee.push([e,t])},(e.prototype=new ConsoleAppender).defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:!1,focusPopUp:!1,lazyInit:!0,useOldPopUp:!0,complainAboutPopUpBlocking:!0,newestMessageAtTop:!1,scrollToLatestMessage:!0,width:"600",height:"400",reopenWhenClosed:!1,maxMessages:null,showCommandLine:!0,commandLineObjectExpansionDepth:1,showHideButton:!1,showCloseButton:!0,useDocumentWrite:!0},e.prototype.toString=function(){return"PopUpAppender"},log4javascript.PopUpAppender=e,(t.prototype=new ConsoleAppender).defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:!1,lazyInit:!0,newestMessageAtTop:!1,scrollToLatestMessage:!0,width:"100%",height:"220px",maxMessages:null,showCommandLine:!0,commandLineObjectExpansionDepth:1,showHideButton:!1,showCloseButton:!1,showLogEntryDeleteButtons:!0,useDocumentWrite:!0},t.prototype.toString=function(){return"InPageAppender"},log4javascript.InPageAppender=t,log4javascript.InlineAppender=t}(),function(){function a(e){var t=0;for(var r in e)t=Math.max(toStr(r).length,t);var o=[];for(r in e){var n,i="  "+padWithSpaces(toStr(r),t+2);try{n=splitIntoLines(toStr(e[r])).join(padWithSpaces(newLine,t+6))}catch(e){n="[Error obtaining property. Details: "+getExceptionMessage(e)+"]"}o.push(i+n)}return o.join(newLine)}var _={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},w=["script","pre"],S=["br","img","hr","param","link","area","input","col","base","meta"],E="  ";function I(e,t,r,o,n){var i;function a(e){for(var t=e.style.cssText.split(";"),r="",o=0,n=t.length;o<n;o++){var i=t[o].split(":"),a=[];/^\s*$/.test(i[0])||a.push(trim(i[0]).toLowerCase()+":"+trim(i[1])),r=a.join(";")}return r}"string"!=typeof r&&(r=""),o=!!o,n=!!n;var s,d,l,u;if(!(t=void 0===t||!!t)||e.nodeType==_.DOCUMENT_FRAGMENT_NODE){for(i="",s=0,d=e.childNodes.length;s<d;s++)i+=I(e.childNodes[s],!0,r+E);return i}switch(e.nodeType){case _.ELEMENT_NODE:var c=e.tagName.toLowerCase();i=o?newLine+r:"",i+="<";var p=(u=e).prefix?u.prefix:u.outerHTML&&new RegExp("<([^:]+):"+u.tagName+"[^>]*>","i").test(u.outerHTML)?RegExp.$1.toLowerCase():"",h=!!p;for(h&&(i+=p+":"),i+=c,s=0,d=e.attributes.length;s<d;s++){var f=e.attributes[s];f.specified&&null!==f.nodeValue&&"style"!==f.nodeName.toLowerCase()&&"string"==typeof f.nodeValue&&0!==f.nodeName.indexOf("_moz")&&(i+=" "+f.nodeName.toLowerCase()+'="',i+=f.nodeValue.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;"),i+='"')}if(e.style.cssText)""!==a(e)&&(i+=' style="'+a(e)+'"');if(array_contains(S,c)||h&&!e.hasChildNodes())i+="/>";else{i+=">";var m=!(1===e.childNodes.length&&e.childNodes[0].nodeType===_.TEXT_NODE),g=array_contains(w,c);for(s=0,d=e.childNodes.length;s<d;s++)i+=I(e.childNodes[s],!0,r+E,m,g);var v="</"+c+">";i+=m?newLine+r+v:v}return i;case _.TEXT_NODE:if((l=e).nodeType==_.TEXT_NODE&&/^[ \t\r\n]*$/.test(l.nodeValue))i="";else{if(n)i=e.nodeValue;else{var y=splitIntoLines(trim(e.nodeValue)),b=[];for(s=0,d=y.length;s<d;s++)b[s]=trim(y[s]);i=b.join(newLine+r)}o&&(i=newLine+r+i)}return i;case _.CDATA_SECTION_NODE:return"<![CDATA["+e.nodeValue+"]]>"+newLine;case _.DOCUMENT_NODE:for(i="",s=0,d=e.childNodes.length;s<d;s++)i+=I(e.childNodes[s],!0,r);return i;default:return""}}ConsoleAppender.addGlobalCommandLineFunction("$",function(e,t,r){return document.getElementById(t[0])}),ConsoleAppender.addGlobalCommandLineFunction("dir",function(e,t,r){for(var o=[],n=0,i=t.length;n<i;n++)o[n]=a(t[n]);return o.join(newLine+newLine)}),ConsoleAppender.addGlobalCommandLineFunction("dirxml",function(e,t,r){for(var o=[],n=0,i=t.length;n<i;n++)o[n]=I(t[n]);return o.join(newLine+newLine)}),ConsoleAppender.addGlobalCommandLineFunction("cd",function(e,t,r){var o,n;return 0===t.length||""===t[0]?(o=window,n="Command line set to run in main window"):t[0].window==t[0]?(o=t[0],n="Command line set to run in frame '"+t[0].name+"'"):(o=window.frames[t[0]])?n="Command line set to run in frame '"+t[0]+"'":(r.isError=!0,n="Frame '"+t[0]+"' does not exist",o=e.getCommandWindow()),e.setCommandWindow(o),n}),ConsoleAppender.addGlobalCommandLineFunction("clear",function(e,t,r){r.appendResult=!1,e.clear()}),ConsoleAppender.addGlobalCommandLineFunction("keys",function(e,t,r){var o=[];for(var n in t[0])o.push(n);return o}),ConsoleAppender.addGlobalCommandLineFunction("values",function(e,t,r){var o=[];for(var n in t[0])try{o.push(t[0][n])}catch(e){logLog.warn("values(): Unable to obtain value for key "+n+". Details: "+getExceptionMessage(e))}return o}),ConsoleAppender.addGlobalCommandLineFunction("expansionDepth",function(e,t,r){var o=parseInt(t[0],10);return isNaN(o)||o<0?(r.isError=!0,t[0]+" is not a valid expansion depth"):(e.setCommandLineObjectExpansionDepth(o),"Object expansion depth set to "+o)})}(),log4javascript.setDocumentReady=function(){pageLoaded=!0,log4javascript.dispatchEvent("load",{})},window.addEventListener)window.addEventListener("load",log4javascript.setDocumentReady,!1);else if(window.attachEvent)window.attachEvent("onload",log4javascript.setDocumentReady);else{var oldOnload=window.onload;"function"!=typeof window.onload?window.onload=log4javascript.setDocumentReady:window.onload=function(e){oldOnload&&oldOnload(e),log4javascript.setDocumentReady()}}return log4javascript},this),function(e,t){"function"==typeof define&&define.amd?define(["bytebuffer"],t):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=t(require("bytebuffer"),!0):(e.dcodeIO=e.dcodeIO||{}).ProtoBuf=t(e.dcodeIO.ByteBuffer)}(this,function(I,e){"use strict";var n,c,t,a,s,r,i={};return i.ByteBuffer=I,i.Long=I.Long||null,i.VERSION="5.0.1",i.WIRE_TYPES={},i.WIRE_TYPES.VARINT=0,i.WIRE_TYPES.BITS64=1,i.WIRE_TYPES.LDELIM=2,i.WIRE_TYPES.STARTGROUP=3,i.WIRE_TYPES.ENDGROUP=4,i.WIRE_TYPES.BITS32=5,i.PACKABLE_WIRE_TYPES=[i.WIRE_TYPES.VARINT,i.WIRE_TYPES.BITS64,i.WIRE_TYPES.BITS32],i.TYPES={int32:{name:"int32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:i.WIRE_TYPES.VARINT,defaultValue:i.Long?i.Long.ZERO:void 0},uint64:{name:"uint64",wireType:i.WIRE_TYPES.VARINT,defaultValue:i.Long?i.Long.UZERO:void 0},sint64:{name:"sint64",wireType:i.WIRE_TYPES.VARINT,defaultValue:i.Long?i.Long.ZERO:void 0},bool:{name:"bool",wireType:i.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:"double",wireType:i.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:i.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:i.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:i.WIRE_TYPES.BITS64,defaultValue:i.Long?i.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:i.WIRE_TYPES.BITS64,defaultValue:i.Long?i.Long.ZERO:void 0},float:{name:"float",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:"enum",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:i.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:i.WIRE_TYPES.STARTGROUP,defaultValue:null}},i.MAP_KEY_TYPES=[i.TYPES.int32,i.TYPES.sint32,i.TYPES.sfixed32,i.TYPES.uint32,i.TYPES.fixed32,i.TYPES.int64,i.TYPES.sint64,i.TYPES.sfixed64,i.TYPES.uint64,i.TYPES.fixed64,i.TYPES.bool,i.TYPES.string,i.TYPES.bytes],i.ID_MIN=1,i.ID_MAX=536870911,i.convertFieldsToCamelCase=!1,i.populateAccessors=!0,i.populateDefaults=!0,i.Util=((n={}).IS_NODE=!("object"!=typeof process||process+""!="[object process]"||process.browser),n.XHR=function(){for(var e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],t=null,r=0;r<e.length;r++){try{t=e[r]()}catch(e){continue}break}if(!t)throw Error("XMLHttpRequest is not supported");return t},n.fetch=function(e,r){if(r&&"function"!=typeof r&&(r=null),n.IS_NODE){var t=require("fs");if(r)t.readFile(e,function(e,t){r(e?null:""+t)});else try{return t.readFileSync(e)}catch(e){return null}}else{var o=n.XHR();if(o.open("GET",e,!!r),o.setRequestHeader("Accept","text/plain"),"function"==typeof o.overrideMimeType&&o.overrideMimeType("text/plain"),!r)return o.send(null),200==o.status||0==o.status&&"string"==typeof o.responseText?o.responseText:null;if(o.onreadystatechange=function(){4==o.readyState&&(200==o.status||0==o.status&&"string"==typeof o.responseText?r(o.responseText):r(null))},4==o.readyState)return;o.send(null)}},n.toCamelCase=function(e){return e.replace(/_([a-zA-Z])/g,function(e,t){return t.toUpperCase()})},n),i.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},i.DotProto=function(n,a){var e={},t=function(e){this.source=e+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},r=t.prototype;r._readString=function(){var e='"'===this._stringOpen?a.STRING_DQ:a.STRING_SQ;e.lastIndex=this.index-1;var t=e.exec(this.source);if(!t)throw Error("unterminated string");return this.index=e.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,t[1]},r.next=function(){if(0<this.stack.length)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var e,t,r;do{for(e=!1;a.WHITESPACE.test(r=this.source.charAt(this.index));)if("\n"===r&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,e=!0}else{if("*"!==(r=this.source.charAt(this.index)))return"/";do{if("\n"===r&&++this.line,++this.index===this.source.length)return null;t=r,r=this.source.charAt(this.index)}while("*"!==t||"/"!==r);++this.index,e=!0}}while(e);if(this.index===this.source.length)return null;var o=this.index;if(a.DELIM.lastIndex=0,!a.DELIM.test(this.source.charAt(o++)))for(;o<this.source.length&&!a.DELIM.test(this.source.charAt(o));)++o;var n=this.source.substring(this.index,this.index=o);return'"'!==n&&"'"!==n||(this._stringOpen=n),n},r.peek=function(){if(0===this.stack.length){var e=this.next();if(null===e)return null;this.stack.push(e)}return this.stack[0]},r.skip=function(e){var t=this.next();if(t!==e)throw Error("illegal '"+t+"', '"+e+"' expected")},r.omit=function(e){return this.peek()===e&&(this.next(),!0)},r.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},e.Tokenizer=t;var o=function(e){this.tn=new t(e),this.proto3=!1},i=o.prototype;function s(e,t){var r=-1,o=1;if("-"==e.charAt(0)&&(o=-1,e=e.substring(1)),a.NUMBER_DEC.test(e))r=parseInt(e);else if(a.NUMBER_HEX.test(e))r=parseInt(e.substring(2),16);else{if(!a.NUMBER_OCT.test(e))throw Error("illegal id value: "+(o<0?"-":"")+e);r=parseInt(e.substring(1),8)}if(r=o*r|0,!t&&r<0)throw Error("illegal id value: "+(o<0?"-":"")+e);return r}function d(e){var t=1;if("-"==e.charAt(0)&&(t=-1,e=e.substring(1)),a.NUMBER_DEC.test(e))return t*parseInt(e,10);if(a.NUMBER_HEX.test(e))return t*parseInt(e.substring(2),16);if(a.NUMBER_OCT.test(e))return t*parseInt(e.substring(1),8);if("inf"===e)return t*(1/0);if("nan"===e)return NaN;if(a.NUMBER_FLT.test(e))return t*parseFloat(e);throw Error("illegal number value: "+(t<0?"-":"")+e)}function l(e,t,r){void 0===e[t]?e[t]=r:(Array.isArray(e[t])||(e[t]=[e[t]]),e[t].push(r))}return i.parse=function(){var e,t,r={name:"[ROOT]",package:null,messages:[],enums:[],imports:[],options:{},services:[]},o=!0;try{for(;e=this.tn.next();)switch(e){case"package":if(!o||null!==r.package)throw Error("unexpected 'package'");if(e=this.tn.next(),!a.TYPEREF.test(e))throw Error("illegal package name: "+e);this.tn.skip(";"),r.package=e;break;case"import":if(!o)throw Error("unexpected 'import'");("public"===(e=this.tn.peek())||(t="weak"===e))&&this.tn.next(),e=this._readString(),this.tn.skip(";"),t||r.imports.push(e);break;case"syntax":if(!o)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(r.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(r,null),o=!1;break;case"enum":this._parseEnum(r),o=!1;break;case"option":this._parseOption(r);break;case"service":this._parseService(r);break;case"extend":this._parseExtend(r);break;default:throw Error("unexpected '"+e+"'")}}catch(e){throw e.message="Parse error at line "+this.tn.line+": "+e.message,e}return delete r.name,r},o.parse=function(e){return new o(e).parse()},i._readString=function(){var e,t,r="";do{if("'"!==(t=this.tn.next())&&'"'!==t)throw Error("illegal string delimiter: "+t);r+=this.tn.next(),this.tn.skip(t),e=this.tn.peek()}while('"'===e||'"'===e);return r},i._readValue=function(e){var t=this.tn.peek();if('"'===t||"'"===t)return this._readString();if(this.tn.next(),a.NUMBER.test(t))return d(t);if(a.BOOL.test(t))return"true"===t.toLowerCase();if(e&&a.TYPEREF.test(t))return t;throw Error("illegal value: "+t)},i._parseOption=function(e,t){var r=this.tn.next(),o=!1;if("("===r&&(o=!0,r=this.tn.next()),!a.TYPEREF.test(r))throw Error("illegal option name: "+r);var n=r;o&&(this.tn.skip(")"),n="("+n+")",r=this.tn.peek(),a.FQTYPEREF.test(r)&&(n+=r,this.tn.next())),this.tn.skip("="),this._parseOptionValue(e,n),t||this.tn.skip(";")},i._parseOptionValue=function(e,t){var r=this.tn.peek();if("{"!==r)l(e.options,t,this._readValue(!0));else for(this.tn.skip("{");"}"!==(r=this.tn.next());){if(!a.NAME.test(r))throw Error("illegal option name: "+t+"."+r);this.tn.omit(":")?l(e.options,t+"."+r,this._readValue(!0)):this._parseOptionValue(e,t+"."+r)}},i._parseService=function(e){var t=this.tn.next();if(!a.NAME.test(t))throw Error("illegal service name at line "+this.tn.line+": "+t);var r={name:t,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(t=this.tn.next());)if("option"===t)this._parseOption(r);else{if("rpc"!==t)throw Error("illegal service token: "+t);this._parseServiceRPC(r)}this.tn.omit(";"),e.services.push(r)},i._parseServiceRPC=function(e){var t=this.tn.next();if(!a.NAME.test(t))throw Error("illegal rpc service method name: "+t);var r=t,o={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),"stream"===(t=this.tn.next()).toLowerCase()&&(o.request_stream=!0,t=this.tn.next()),!a.TYPEREF.test(t))throw Error("illegal rpc service request type: "+t);if(o.request=t,this.tn.skip(")"),"returns"!==(t=this.tn.next()).toLowerCase())throw Error("illegal rpc service request type delimiter: "+t);if(this.tn.skip("("),"stream"===(t=this.tn.next()).toLowerCase()&&(o.response_stream=!0,t=this.tn.next()),o.response=t,this.tn.skip(")"),"{"===(t=this.tn.peek())){for(this.tn.next();"}"!==(t=this.tn.next());){if("option"!==t)throw Error("illegal rpc service token: "+t);this._parseOption(o)}this.tn.omit(";")}else this.tn.skip(";");void 0===e.rpc&&(e.rpc={}),e.rpc[r]=o},i._parseMessage=function(e,t){var r=!!t,o=this.tn.next(),n={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!a.NAME.test(o))throw Error("illegal "+(r?"group":"message")+" name: "+o);for(n.name=o,r&&(this.tn.skip("="),t.id=s(this.tn.next()),n.isGroup=!0),"["===(o=this.tn.peek())&&t&&this._parseFieldOptions(t),this.tn.skip("{");"}"!==(o=this.tn.next());)if(a.RULE.test(o))this._parseMessageField(n,o);else if("oneof"===o)this._parseMessageOneOf(n);else if("enum"===o)this._parseEnum(n);else if("message"===o)this._parseMessage(n);else if("option"===o)this._parseOption(n);else if("service"===o)this._parseService(n);else if("extensions"===o)n.extensions=this._parseExtensionRanges();else if("reserved"===o)this._parseIgnored();else if("extend"===o)this._parseExtend(n);else{if(!a.TYPEREF.test(o))throw Error("illegal message token: "+o);if(!this.proto3)throw Error("illegal field rule: "+o);this._parseMessageField(n,"optional",o)}return this.tn.omit(";"),e.messages.push(n),n},i._parseIgnored=function(){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},i._parseMessageField=function(e,t,r){if(!a.RULE.test(t))throw Error("illegal message field rule: "+t);var o,n={rule:t,type:"",name:"",options:{},id:0};if("map"===t){if(r)throw Error("illegal type: "+r);if(this.tn.skip("<"),o=this.tn.next(),!a.TYPE.test(o)&&!a.TYPEREF.test(o))throw Error("illegal message field type: "+o);if(n.keytype=o,this.tn.skip(","),o=this.tn.next(),!a.TYPE.test(o)&&!a.TYPEREF.test(o))throw Error("illegal message field: "+o);if(n.type=o,this.tn.skip(">"),o=this.tn.next(),!a.NAME.test(o))throw Error("illegal message field name: "+o);n.name=o,this.tn.skip("="),n.id=s(this.tn.next()),"["===(o=this.tn.peek())&&this._parseFieldOptions(n),this.tn.skip(";")}else if("group"===(r=void 0!==r?r:this.tn.next())){var i=this._parseMessage(e,n);if(!/^[A-Z]/.test(i.name))throw Error("illegal group name: "+i.name);n.type=i.name,n.name=i.name.toLowerCase(),this.tn.omit(";")}else{if(!a.TYPE.test(r)&&!a.TYPEREF.test(r))throw Error("illegal message field type: "+r);if(n.type=r,o=this.tn.next(),!a.NAME.test(o))throw Error("illegal message field name: "+o);n.name=o,this.tn.skip("="),n.id=s(this.tn.next()),"["===(o=this.tn.peek())&&this._parseFieldOptions(n),this.tn.skip(";")}return e.fields.push(n),n},i._parseMessageOneOf=function(e){var t=this.tn.next();if(!a.NAME.test(t))throw Error("illegal oneof name: "+t);var r,o=t,n=[];for(this.tn.skip("{");"}"!==(t=this.tn.next());)(r=this._parseMessageField(e,"optional",t)).oneof=o,n.push(r.id);this.tn.omit(";"),e.oneofs[o]=n},i._parseFieldOptions=function(e){this.tn.skip("[");for(var t=!0;"]"!==this.tn.peek();)t||this.tn.skip(","),this._parseOption(e,!0),t=!1;this.tn.next()},i._parseEnum=function(e){var t={name:"",values:[],options:{}},r=this.tn.next();if(!a.NAME.test(r))throw Error("illegal name: "+r);for(t.name=r,this.tn.skip("{");"}"!==(r=this.tn.next());)if("option"===r)this._parseOption(t);else{if(!a.NAME.test(r))throw Error("illegal name: "+r);this.tn.skip("=");var o={name:r,id:s(this.tn.next(),!0)};"["===(r=this.tn.peek())&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),t.values.push(o)}this.tn.omit(";"),e.enums.push(t)},i._parseExtensionRanges=function(){var e,t,r,o=[];do{for(t=[];;){switch(e=this.tn.next()){case"min":r=n.ID_MIN;break;case"max":r=n.ID_MAX;break;default:r=d(e)}if(t.push(r),2===t.length)break;if("to"!==this.tn.peek()){t.push(r);break}this.tn.next()}o.push(t)}while(this.tn.omit(","));return this.tn.skip(";"),o},i._parseExtend=function(e){var t=this.tn.next();if(!a.TYPEREF.test(t))throw Error("illegal extend reference: "+t);var r={ref:t,fields:[]};for(this.tn.skip("{");"}"!==(t=this.tn.next());)if(a.RULE.test(t))this._parseMessageField(r,t);else{if(!a.TYPEREF.test(t))throw Error("illegal extend token: "+t);if(!this.proto3)throw Error("illegal field rule: "+t);this._parseMessageField(r,"optional",t)}return this.tn.omit(";"),e.messages.push(r),r},i.toString=function(){return"Parser at line "+this.tn.line},e.Parser=o,e}(i,i.Lang),i.Reflect=function(m){var a={},u=function(e,t,r){this.builder=e,this.parent=t,this.name=r,this.className},e=u.prototype;e.fqn=function(){for(var e=this.name,t=this;;){if(null==(t=t.parent))break;e=t.name+"."+e}return e},e.toString=function(e){return(e?this.className+" ":"")+this.fqn()},e.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},a.T=u;var s=function(e,t,r,o,n){u.call(this,e,t,r),this.className="Namespace",this.children=[],this.options=o||{},this.syntax=n||"proto2"};try{var t=s.prototype=Object.create(u.prototype)}catch(e){t=""}t.getChildren=function(e){if(null==(e=e||null))return this.children.slice();for(var t=[],r=0,o=this.children.length;r<o;++r)this.children[r]instanceof e&&t.push(this.children[r]);return t},t.addChild=function(e){var t;if(t=this.getChild(e.name))if(t instanceof p.Field&&t.name!==t.originalName&&null===this.getChild(t.originalName))t.name=t.originalName;else{if(!(e instanceof p.Field&&e.name!==e.originalName&&null===this.getChild(e.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+e.name);e.name=e.originalName}this.children.push(e)},t.getChild=function(e){for(var t="number"==typeof e?"id":"name",r=0,o=this.children.length;r<o;++r)if(this.children[r][t]===e)return this.children[r];return null},t.resolve=function(e,t){var r,o="string"==typeof e?e.split("."):e,n=this,i=0;if(""===o[i]){for(;null!==n.parent;)n=n.parent;i++}do{do{if(!(n instanceof a.Namespace)){n=null;break}if(!(r=n.getChild(o[i]))||!(r instanceof a.T)||t&&!(r instanceof a.Namespace)){n=null;break}n=r,i++}while(i<o.length);if(null!=n)break;if(null!==this.parent)return this.parent.resolve(e,t)}while(null!=n);return n},t.qn=function(e){for(var t=[],r=e;t.unshift(r.name),null!==(r=r.parent););for(var o=1;o<=t.length;o++){var n=t.slice(t.length-o);if(e===this.resolve(n,e instanceof a.Namespace))return n.join(".")}return e.fqn()},t.build=function(){for(var e,t={},r=this.children,o=0,n=r.length;o<n;++o)(e=r[o])instanceof s&&(t[e.name]=e.build());return Object.defineProperty&&Object.defineProperty(t,"$options",{value:this.buildOpt()}),t},t.buildOpt=function(){for(var e={},t=Object.keys(this.options),r=0,o=t.length;r<o;++r){var n=t[r],i=this.options[t[r]];e[n]=i}return e},t.getOption=function(e){return void 0===e?this.options:void 0!==this.options[e]?this.options[e]:null},a.Namespace=s;var c=function(e,t,r,o){if(this.type=e,this.resolvedType=t,this.isMapKey=r,this.syntax=o,r&&m.MAP_KEY_TYPES.indexOf(e)<0)throw Error("Invalid map key type: "+e.name)},r=c.prototype;function d(e,t){if(e&&"number"==typeof e.low&&"number"==typeof e.high&&"boolean"==typeof e.unsigned&&e.low==e.low&&e.high==e.high)return new m.Long(e.low,e.high,void 0===t?e.unsigned:t);if("string"==typeof e)return m.Long.fromString(e,t||!1,10);if("number"==typeof e)return m.Long.fromNumber(e,t||!1);throw Error("not convertible to Long")}c.defaultFieldValue=function(e){if("string"==typeof e&&(e=m.TYPES[e]),void 0===e.defaultValue)throw Error("default value for type "+e.name+" is not supported");return e==m.TYPES.bytes?new I(0):e.defaultValue},r.verifyValue=function(t){var r=this;function o(e,t){throw Error("Illegal value for "+r.toString(!0)+" of type "+r.type.name+": "+e+" ("+t+")")}switch(this.type){case m.TYPES.int32:case m.TYPES.sint32:case m.TYPES.sfixed32:return("number"!=typeof t||t==t&&t%1!=0)&&o(typeof t,"not an integer"),4294967295<t?0|t:t;case m.TYPES.uint32:case m.TYPES.fixed32:return("number"!=typeof t||t==t&&t%1!=0)&&o(typeof t,"not an integer"),t<0?t>>>0:t;case m.TYPES.int64:case m.TYPES.sint64:case m.TYPES.sfixed64:if(m.Long)try{return d(t,!1)}catch(e){o(typeof t,e.message)}else o(typeof t,"requires Long.js");case m.TYPES.uint64:case m.TYPES.fixed64:if(m.Long)try{return d(t,!0)}catch(e){o(typeof t,e.message)}else o(typeof t,"requires Long.js");case m.TYPES.bool:return"boolean"!=typeof t&&o(typeof t,"not a boolean"),t;case m.TYPES.float:case m.TYPES.double:return"number"!=typeof t&&o(typeof t,"not a number"),t;case m.TYPES.string:return"string"==typeof t||t&&t instanceof String||o(typeof t,"not a string"),""+t;case m.TYPES.bytes:return I.isByteBuffer(t)?t:I.wrap(t,"base64");case m.TYPES.enum:var e=this.resolvedType.getChildren(m.Reflect.Enum.Value);for(i=0;i<e.length;i++){if(e[i].name==t)return e[i].id;if(e[i].id==t)return e[i].id}if("proto3"===this.syntax)return("number"!=typeof t||t==t&&t%1!=0)&&o(typeof t,"not an integer"),(4294967295<t||t<0)&&o(typeof t,"not in range for uint32"),t;o(t,"not a valid enum value");case m.TYPES.group:case m.TYPES.message:if(t&&"object"==typeof t||o(typeof t,"object expected"),t instanceof this.resolvedType.clazz)return t;if(t instanceof m.Builder.Message){var n={};for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);t=n}return new this.resolvedType.clazz(t)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+t+" (undefined type "+this.type+")")},r.calculateLength=function(e,t){if(null===t)return 0;var r;switch(this.type){case m.TYPES.int32:return t<0?I.calculateVarint64(t):I.calculateVarint32(t);case m.TYPES.uint32:return I.calculateVarint32(t);case m.TYPES.sint32:return I.calculateVarint32(I.zigZagEncode32(t));case m.TYPES.fixed32:case m.TYPES.sfixed32:case m.TYPES.float:return 4;case m.TYPES.int64:case m.TYPES.uint64:return I.calculateVarint64(t);case m.TYPES.sint64:return I.calculateVarint64(I.zigZagEncode64(t));case m.TYPES.fixed64:case m.TYPES.sfixed64:return 8;case m.TYPES.bool:return 1;case m.TYPES.enum:return I.calculateVarint32(t);case m.TYPES.double:return 8;case m.TYPES.string:return r=I.calculateUTF8Bytes(t),I.calculateVarint32(r)+r;case m.TYPES.bytes:if(t.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+t.remaining()+" bytes remaining");return I.calculateVarint32(t.remaining())+t.remaining();case m.TYPES.message:return r=this.resolvedType.calculate(t),I.calculateVarint32(r)+r;case m.TYPES.group:return(r=this.resolvedType.calculate(t))+I.calculateVarint32(e<<3|m.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+t+" (unknown type)")},r.encodeValue=function(e,t,r){if(null===t)return r;switch(this.type){case m.TYPES.int32:t<0?r.writeVarint64(t):r.writeVarint32(t);break;case m.TYPES.uint32:r.writeVarint32(t);break;case m.TYPES.sint32:r.writeVarint32ZigZag(t);break;case m.TYPES.fixed32:r.writeUint32(t);break;case m.TYPES.sfixed32:r.writeInt32(t);break;case m.TYPES.int64:case m.TYPES.uint64:r.writeVarint64(t);break;case m.TYPES.sint64:r.writeVarint64ZigZag(t);break;case m.TYPES.fixed64:r.writeUint64(t);break;case m.TYPES.sfixed64:r.writeInt64(t);break;case m.TYPES.bool:"string"==typeof t?r.writeVarint32("false"===t.toLowerCase()?0:!!t):r.writeVarint32(t?1:0);break;case m.TYPES.enum:r.writeVarint32(t);break;case m.TYPES.float:r.writeFloat32(t);break;case m.TYPES.double:r.writeFloat64(t);break;case m.TYPES.string:r.writeVString(t);break;case m.TYPES.bytes:if(t.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+t.remaining()+" bytes remaining");var o=t.offset;r.writeVarint32(t.remaining()),r.append(t),t.offset=o;break;case m.TYPES.message:var n=(new I).LE();this.resolvedType.encode(t,n),r.writeVarint32(n.offset),r.append(n.flip());break;case m.TYPES.group:this.resolvedType.encode(t,r),r.writeVarint32(e<<3|m.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+t+" (unknown type)")}return r},r.decode=function(e,t,r){if(t!=this.type.wireType)throw Error("Unexpected wire type for element");var o,n;switch(this.type){case m.TYPES.int32:return 0|e.readVarint32();case m.TYPES.uint32:return e.readVarint32()>>>0;case m.TYPES.sint32:return 0|e.readVarint32ZigZag();case m.TYPES.fixed32:return e.readUint32()>>>0;case m.TYPES.sfixed32:return 0|e.readInt32();case m.TYPES.int64:return e.readVarint64();case m.TYPES.uint64:return e.readVarint64().toUnsigned();case m.TYPES.sint64:return e.readVarint64ZigZag();case m.TYPES.fixed64:return e.readUint64();case m.TYPES.sfixed64:return e.readInt64();case m.TYPES.bool:return!!e.readVarint32();case m.TYPES.enum:return e.readVarint32();case m.TYPES.float:return e.readFloat();case m.TYPES.double:return e.readDouble();case m.TYPES.string:return e.readVString();case m.TYPES.bytes:if(n=e.readVarint32(),e.remaining()<n)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+n+" required but got only "+e.remaining());return(o=e.clone()).limit=o.offset+n,e.offset+=n,o;case m.TYPES.message:return n=e.readVarint32(),this.resolvedType.decode(e,n);case m.TYPES.group:return this.resolvedType.decode(e,-1,r)}throw Error("[INTERNAL] Illegal decode type")},r.valueFromString=function(e){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case m.TYPES.int32:case m.TYPES.sint32:case m.TYPES.sfixed32:case m.TYPES.uint32:case m.TYPES.fixed32:return this.verifyValue(parseInt(e));case m.TYPES.int64:case m.TYPES.sint64:case m.TYPES.sfixed64:case m.TYPES.uint64:case m.TYPES.fixed64:return this.verifyValue(e);case m.TYPES.bool:return"true"===e;case m.TYPES.string:return this.verifyValue(e);case m.TYPES.bytes:return I.fromBinary(e)}},r.valueToString=function(e){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===m.TYPES.bytes?e.toString("binary"):e.toString()},a.Element=c;var p=function(e,t,r,o,n,i){s.call(this,e,t,r,o,i),this.className="Message",this.extensions=void 0,this.clazz=null,this.isGroup=!!n,this._fields=null,this._fieldsById=null,this._fieldsByName=null};try{var o=p.prototype=Object.create(s.prototype)}catch(e){o=""}function g(e,t){var r=t.readVarint32(),o=7&r,n=r>>>3;switch(o){case m.WIRE_TYPES.VARINT:for(;128==(128&(r=t.readUint8())););break;case m.WIRE_TYPES.BITS64:t.offset+=8;break;case m.WIRE_TYPES.LDELIM:r=t.readVarint32(),t.offset+=r;break;case m.WIRE_TYPES.STARTGROUP:g(n,t);break;case m.WIRE_TYPES.ENDGROUP:if(n===e)return!1;throw Error("Illegal GROUPEND after unknown group: "+n+" ("+e+" expected)");case m.WIRE_TYPES.BITS32:t.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+e+": "+o)}return!0}o.build=function(e){if(this.clazz&&!e)return this.clazz;var t=function(c,a){var s=a.getChildren(c.Reflect.Message.Field),d=a.getChildren(c.Reflect.Message.OneOf),l=function(e,t){c.Builder.Message.call(this);for(var r=0,o=d.length;r<o;++r)this[d[r].name]=null;for(r=0,o=s.length;r<o;++r){var n=s[r];this[n.name]=n.repeated?[]:n.map?new c.Map(n):null,!n.required&&"proto3"!==a.syntax||null===n.defaultValue||(this[n.name]=n.defaultValue)}var i;if(0<arguments.length)if(1!==arguments.length||null===e||"object"!=typeof e||!("function"!=typeof e.encode||e instanceof l)||Array.isArray(e)||e instanceof c.Map||I.isByteBuffer(e)||e instanceof ArrayBuffer||c.Long&&e instanceof c.Long)for(r=0,o=arguments.length;r<o;++r)void 0!==(i=arguments[r])&&this.$set(s[r].name,i);else this.$set(e)};try{var i=l.prototype=Object.create(c.Builder.Message.prototype)}catch(e){i=""}i.add=function(e,t,r){var o=a._fieldsByName[e];if(!r){if(!o)throw Error(this+"#"+e+" is undefined");if(!(o instanceof c.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+o.toString(!0));if(!o.repeated)throw Error(this+"#"+e+" is not a repeated field");t=o.verifyValue(t,!0)}return null===this[e]&&(this[e]=[]),this[e].push(t),this},i.$add=i.add,i.set=function(e,t,r){if(e&&"object"==typeof e){for(var o in r=t,e)e.hasOwnProperty(o)&&void 0!==(t=e[o])&&this.$set(o,t,r);return this}var n=a._fieldsByName[e];if(r)this[e]=t;else{if(!n)throw Error(this+"#"+e+" is not a field: undefined");if(!(n instanceof c.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+n.toString(!0));this[n.name]=t=n.verifyValue(t)}if(n&&n.oneof){var i=this[n.oneof.name];null!==t?(null!==i&&i!==n.name&&(this[i]=null),this[n.oneof.name]=n.name):i===e&&(this[n.oneof.name]=null)}return this},i.$set=i.set,i.get=function(e,t){if(t)return this[e];var r=a._fieldsByName[e];if(!(r&&r instanceof c.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: undefined");if(!(r instanceof c.Reflect.Message.Field))throw Error(this+"#"+e+" is not a field: "+r.toString(!0));return this[r.name]},i.$get=i.get;for(var e=0;e<s.length;e++){var t=s[e];t instanceof c.Reflect.Message.ExtensionField||a.builder.options.populateAccessors&&function(r){var e=r.originalName.replace(/(_[a-zA-Z])/g,function(e){return e.toUpperCase().replace("_","")});e=e.substring(0,1).toUpperCase()+e.substring(1);var t=r.originalName.replace(/([A-Z])/g,function(e){return"_"+e}),o=function(e,t){return this[r.name]=t?e:r.verifyValue(e),this},n=function(){return this[r.name]};null===a.getChild("set"+e)&&(i["set"+e]=o),null===a.getChild("set_"+t)&&(i["set_"+t]=o),null===a.getChild("get"+e)&&(i["get"+e]=n),null===a.getChild("get_"+t)&&(i["get_"+t]=n)}(t)}function p(e,r,o,n){if(null===e||"object"!=typeof e){if(n&&n instanceof c.Reflect.Enum){var t=c.Reflect.Enum.getName(n.object,e);if(null!==t)return t}return e}if(I.isByteBuffer(e))return r?e.toBase64():e.toBuffer();if(c.Long.isLong(e))return o?e.toString():c.Long.fromValue(e);var i;if(Array.isArray(e))return i=[],e.forEach(function(e,t){i[t]=p(e,r,o,n)}),i;if(i={},e instanceof c.Map){for(var a=e.entries(),s=a.next();!s.done;s=a.next())i[e.keyElem.valueToString(s.value[0])]=p(s.value[1],r,o,e.valueElem.resolvedType);return i}var d=e.$type,l=void 0;for(var u in e)e.hasOwnProperty(u)&&(d&&(l=d.getChild(u))?i[u]=p(e[u],r,o,l.resolvedType):i[u]=p(e[u],r,o));return i}return i.encode=function(t,e){"boolean"==typeof t&&(e=t,t=void 0);var r=!1;t||(t=new I,r=!0);var o=t.littleEndian;try{return a.encode(this,t.LE(),e),(r?t.flip():t).LE(o)}catch(e){throw t.LE(o),e}},l.encode=function(e,t,r){return new l(e).encode(t,r)},i.calculate=function(){return a.calculate(this)},i.encodeDelimited=function(e,t){var r=!1;e||(e=new I,r=!0);var o=(new I).LE();return a.encode(this,o,t).flip(),e.writeVarint32(o.remaining()),e.append(o),r?e.flip():e},i.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toArrayBuffer()),e}},i.toArrayBuffer=i.encodeAB,i.encodeNB=function(){try{return this.encode().toBuffer()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBuffer()),e}},i.toBuffer=i.encodeNB,i.encode64=function(){try{return this.encode().toBase64()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toBase64()),e}},i.toBase64=i.encode64,i.encodeHex=function(){try{return this.encode().toHex()}catch(e){throw e.encoded&&(e.encoded=e.encoded.toHex()),e}},i.toHex=i.encodeHex,i.toRaw=function(e,t){return p(this,!!e,!!t,this.$type)},i.encodeJSON=function(){return JSON.stringify(p(this,!0,!0,this.$type))},l.decode=function(t,e,r){"string"==typeof e&&(r=e,e=-1),"string"==typeof t&&(t=I.wrap(t,r||"base64"));var o=(t=I.isByteBuffer(t)?t:I.wrap(t)).littleEndian;try{var n=a.decode(t.LE());return t.LE(o),n}catch(e){throw t.LE(o),e}},l.decodeDelimited=function(t,e){if("string"==typeof t&&(t=I.wrap(t,e||"base64")),(t=I.isByteBuffer(t)?t:I.wrap(t)).remaining()<1)return null;var r=t.offset,o=t.readVarint32();if(t.remaining()<o)return t.offset=r,null;try{var n=a.decode(t.slice(t.offset,t.offset+o).LE());return t.offset+=o,n}catch(e){throw t.offset+=o,e}},l.decode64=function(e){return l.decode(e,"base64")},l.decodeHex=function(e){return l.decode(e,"hex")},l.decodeJSON=function(e){return new l(JSON.parse(e))},i.toString=function(){return a.toString()},Object.defineProperty&&(Object.defineProperty(l,"$options",{value:a.buildOpt()}),Object.defineProperty(i,"$options",{value:l.$options}),Object.defineProperty(l,"$type",{value:a}),Object.defineProperty(i,"$type",{value:a})),l}(m,this);this._fields=[],this._fieldsById={},this._fieldsByName={};for(var r,o=0,n=this.children.length;o<n;o++)if((r=this.children[o])instanceof h||r instanceof p||r instanceof b){if(t.hasOwnProperty(r.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+r.toString(!0)+" cannot override static property '"+r.name+"'");t[r.name]=r.build()}else if(r instanceof p.Field)r.build(),this._fields.push(r),this._fieldsById[r.id]=r,this._fieldsByName[r.name]=r;else if(!(r instanceof p.OneOf||r instanceof y))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[o].toString(!0));return this.clazz=t},o.encode=function(e,t,r){for(var o,n,i=null,a=0,s=this._fields.length;a<s;++a)n=e[(o=this._fields[a]).name],o.required&&null===n?null===i&&(i=o):o.encode(r?n:o.verifyValue(n),t,e);if(null===i)return t;var d=Error("Missing at least one required field for "+this.toString(!0)+": "+i);throw d.encoded=t,d},o.calculate=function(e){for(var t,r,o=0,n=0,i=this._fields.length;n<i;++n){if(r=e[(t=this._fields[n]).name],t.required&&null===r)throw Error("Missing at least one required field for "+this.toString(!0)+": "+t);o+=t.calculate(r,e)}return o},o.decode=function(e,t,r){t="number"==typeof t?t:-1;for(var o,n,i,a,s=e.offset,d=new this.clazz;e.offset<s+t||-1===t&&0<e.remaining();){if(i=(o=e.readVarint32())>>>3,(n=7&o)===m.WIRE_TYPES.ENDGROUP){if(i!==r)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+i+" ("+(r?r+" expected":"not a group")+")");break}if(a=this._fieldsById[i]){if(a.repeated&&!a.options.packed)d[a.name].push(a.decode(n,e));else if(a.map){var l=a.decode(n,e);d[a.name].set(l[0],l[1])}else if(d[a.name]=a.decode(n,e),a.oneof){var u=d[a.oneof.name];null!==u&&u!==a.name&&(d[u]=null),d[a.oneof.name]=a.name}}else switch(n){case m.WIRE_TYPES.VARINT:e.readVarint32();break;case m.WIRE_TYPES.BITS32:e.offset+=4;break;case m.WIRE_TYPES.BITS64:e.offset+=8;break;case m.WIRE_TYPES.LDELIM:var c=e.readVarint32();e.offset+=c;break;case m.WIRE_TYPES.STARTGROUP:for(;g(i,e););break;default:throw Error("Illegal wire type for unknown field "+i+" in "+this.toString(!0)+"#decode: "+n)}}for(var p=0,h=this._fields.length;p<h;++p)if(null===d[(a=this._fields[p]).name])if("proto3"===this.syntax)d[a.name]=a.defaultValue;else{if(a.required){var f=Error("Missing at least one required field for "+this.toString(!0)+": "+a.name);throw f.decoded=d,f}m.populateDefaults&&null!==a.defaultValue&&(d[a.name]=a.defaultValue)}return d},a.Message=p;var l=function(e,t,r,o,n,i,a,s,d,l){u.call(this,e,t,i),this.className="Message.Field",this.required="required"===r,this.repeated="repeated"===r,this.map="map"===r,this.keyType=o||null,this.type=n,this.resolvedType=null,this.id=a,this.options=s||{},this.defaultValue=null,this.oneof=d||null,this.syntax=l||"proto2",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof p.ExtensionField||(this.name=m.Util.toCamelCase(this.name))};try{var n=l.prototype=Object.create(u.prototype)}catch(e){n=""}n.build=function(){this.element=new c(this.type,this.resolvedType,!1,this.syntax),this.map&&(this.keyElement=new c(this.keyType,void 0,!0,this.syntax)),"proto3"!==this.syntax||this.repeated||this.map?void 0!==this.options.default&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=c.defaultFieldValue(this.type)},n.verifyValue=function(e,t){t=t||!1;var r,o=this;function n(e,t){throw Error("Illegal value for "+o.toString(!0)+" of type "+o.type.name+": "+e+" ("+t+")")}if(null===e)return this.required&&n(typeof e,"required"),"proto3"===this.syntax&&this.type!==m.TYPES.message&&n(typeof e,"proto3 field without field presence cannot be null"),null;if(!this.repeated||t)return this.map&&!t?e instanceof m.Map?e:(e instanceof Object||n(typeof e,"expected ProtoBuf.Map or raw object for map field"),new m.Map(this,e)):(!this.repeated&&Array.isArray(e)&&n(typeof e,"no array expected"),this.element.verifyValue(e));Array.isArray(e)||(e=[e]);var i=[];for(r=0;r<e.length;r++)i.push(this.element.verifyValue(e[r]));return i},n.hasWirePresence=function(e,t){if("proto3"!==this.syntax)return null!==e;if(this.oneof&&t[this.oneof.name]===this.name)return!0;switch(this.type){case m.TYPES.int32:case m.TYPES.sint32:case m.TYPES.sfixed32:case m.TYPES.uint32:case m.TYPES.fixed32:return 0!==e;case m.TYPES.int64:case m.TYPES.sint64:case m.TYPES.sfixed64:case m.TYPES.uint64:case m.TYPES.fixed64:return 0!==e.low||0!==e.high;case m.TYPES.bool:return e;case m.TYPES.float:case m.TYPES.double:return 0!==e;case m.TYPES.string:return 0<e.length;case m.TYPES.bytes:return 0<e.remaining();case m.TYPES.enum:return 0!==e;case m.TYPES.message:return null!==e;default:return!0}},n.encode=function(t,n,e){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===t||this.repeated&&0==t.length)return n;try{var r;if(this.repeated)if(this.options.packed&&0<=m.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){n.writeVarint32(this.id<<3|m.WIRE_TYPES.LDELIM),n.ensureCapacity(n.offset+=1);var o=n.offset;for(r=0;r<t.length;r++)this.element.encodeValue(this.id,t[r],n);var i=n.offset-o,a=I.calculateVarint32(i);if(1<a){var s=n.slice(o,n.offset);o+=a-1,n.offset=o,n.append(s)}n.writeVarint32(i,o-a)}else for(r=0;r<t.length;r++)n.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,t[r],n);else this.map?t.forEach(function(e,t,r){var o=I.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,t)+I.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,e);n.writeVarint32(this.id<<3|m.WIRE_TYPES.LDELIM),n.writeVarint32(o),n.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,t,n),n.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,e,n)},this):this.hasWirePresence(t,e)&&(n.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,t,n))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+t+" ("+e+")")}return n},n.calculate=function(t,e){if(t=this.verifyValue(t),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===t||this.repeated&&0==t.length)return 0;var n=0;try{var r,o;if(this.repeated)if(this.options.packed&&0<=m.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){for(n+=I.calculateVarint32(this.id<<3|m.WIRE_TYPES.LDELIM),r=o=0;r<t.length;r++)o+=this.element.calculateLength(this.id,t[r]);n+=I.calculateVarint32(o),n+=o}else for(r=0;r<t.length;r++)n+=I.calculateVarint32(this.id<<3|this.type.wireType),n+=this.element.calculateLength(this.id,t[r]);else this.map?t.forEach(function(e,t,r){var o=I.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,t)+I.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,e);n+=I.calculateVarint32(this.id<<3|m.WIRE_TYPES.LDELIM),n+=I.calculateVarint32(o),n+=o},this):this.hasWirePresence(t,e)&&(n+=I.calculateVarint32(this.id<<3|this.type.wireType),n+=this.element.calculateLength(this.id,t))}catch(e){throw Error("Illegal value for "+this.toString(!0)+": "+t+" ("+e+")")}return n},n.decode=function(e,t,r){var o,n;if(!(!this.map&&e==this.type.wireType||!r&&this.repeated&&this.options.packed&&e==m.WIRE_TYPES.LDELIM||this.map&&e==m.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+e+" ("+this.type.wireType+" expected)");if(e==m.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&0<=m.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)&&!r){n=t.readVarint32(),n=t.offset+n;for(var i=[];t.offset<n;)i.push(this.decode(this.type.wireType,t,!0));return i}if(this.map){var a=c.defaultFieldValue(this.keyType);if(o=c.defaultFieldValue(this.type),n=t.readVarint32(),t.remaining()<n)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+n+" required but got only "+t.remaining());var s=t.clone();for(s.limit=s.offset+n,t.offset+=n;0<s.remaining();){var d=s.readVarint32();e=7&d;var l=d>>>3;if(1===l)a=this.keyElement.decode(s,e,l);else{if(2!==l)throw Error("Unexpected tag in map field key/value submessage");o=this.element.decode(s,e,l)}}return[a,o]}return this.element.decode(t,e,this.id)},a.Message.Field=l;var i=function(e,t,r,o,n,i,a){l.call(this,e,t,r,null,o,n,i,a),this.extension};try{i.prototype=Object.create(l.prototype)}catch(e){i.prototype=null}a.Message.ExtensionField=i;a.Message.OneOf=function(e,t,r){u.call(this,e,t,r),this.fields=[]};var h=function(e,t,r,o,n){s.call(this,e,t,r,o,n),this.className="Enum",this.object=null};h.getName=function(e,t){for(var r,o=Object.keys(e),n=0;n<o.length;++n)if(e[r=o[n]]===t)return r;return null};try{var f=h.prototype=Object.create(s.prototype)}catch(e){f=h.prototype=null}f&&(f.build=function(e){if(this.object&&!e)return this.object;for(var t=new m.Builder.Enum,r=this.getChildren(h.Value),o=0,n=r.length;o<n;++o)t[r[o].name]=r[o].id;return Object.defineProperty&&Object.defineProperty(t,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=t}),a.Enum=h;var v=function(e,t,r,o){u.call(this,e,t,r),this.className="Enum.Value",this.id=o};try{v.prototype=Object.create(u.prototype)}catch(e){v.prototype=null}a.Enum.Value=v;var y=function(e,t,r,o){u.call(this,e,t,r),this.field=o};try{y.prototype=Object.create(u.prototype)}catch(e){y.prototype=null}a.Extension=y;var b=function(e,t,r,o){s.call(this,e,t,r,o),this.className="Service",this.clazz=null};try{var _=b.prototype=Object.create(s.prototype)}catch(e){_=null}_&&(_.build=function(e){return this.clazz&&!e?this.clazz:this.clazz=function(t,n){for(var i=function(e){t.Builder.Service.call(this),this.rpcImpl=e||function(e,t,r){setTimeout(r.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},e=i.prototype=Object.create(t.Builder.Service.prototype),r=n.getChildren(t.Reflect.Service.RPCMethod),o=0;o<r.length;o++)!function(o){e[o.name]=function(e,r){try{try{e=o.resolvedRequestType.clazz.decode(I.wrap(e))}catch(e){if(!(e instanceof TypeError))throw e}if(null===e||"object"!=typeof e)throw Error("Illegal arguments");e instanceof o.resolvedRequestType.clazz||(e=new o.resolvedRequestType.clazz(e)),this.rpcImpl(o.fqn(),e,function(e,t){if(e)r(e);else{null===t&&(t="");try{t=o.resolvedResponseType.clazz.decode(t)}catch(e){}t&&t instanceof o.resolvedResponseType.clazz?r(null,t):r(Error("Illegal response type received in service method "+n.name+"#"+o.name))}})}catch(e){setTimeout(r.bind(this,e),0)}},i[o.name]=function(e,t,r){new i(e)[o.name](t,r)},Object.defineProperty&&(Object.defineProperty(i[o.name],"$options",{value:o.buildOpt()}),Object.defineProperty(e[o.name],"$options",{value:i[o.name].$options}))}(r[o]);return Object.defineProperty&&(Object.defineProperty(i,"$options",{value:n.buildOpt()}),Object.defineProperty(e,"$options",{value:i.$options}),Object.defineProperty(i,"$type",{value:n}),Object.defineProperty(e,"$type",{value:n})),i}(m,this)}),a.Service=b;var w=function(e,t,r,o){u.call(this,e,t,r),this.className="Service.Method",this.options=o||{}};try{var S=w.prototype=Object.create(u.prototype)}catch(e){S=null}S&&(S.buildOpt=t.buildOpt),a.Service.Method=w;var E=function(e,t,r,o,n,i,a,s){w.call(this,e,t,r,s),this.className="Service.RPCMethod",this.requestName=o,this.responseName=n,this.requestStream=i,this.responseStream=a,this.resolvedRequestType=null,this.resolvedResponseType=null};try{E.prototype=Object.create(w.prototype)}catch(e){E.prototype=null}return a.Service.RPCMethod=E,a}(i),i.Builder=(t=(c=i).Lang,a=i.Reflect,r=(s=function(e){this.ns=new a.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=e||{}}).prototype,s.isMessage=function(e){return"string"==typeof e.name&&void 0===e.values&&void 0===e.rpc},s.isMessageField=function(e){return"string"==typeof e.rule&&"string"==typeof e.name&&"string"==typeof e.type&&void 0!==e.id},s.isEnum=function(e){return"string"==typeof e.name&&!(void 0===e.values||!Array.isArray(e.values)||0===e.values.length)},s.isService=function(e){return!("string"!=typeof e.name||"object"!=typeof e.rpc||!e.rpc)},s.isExtend=function(e){return"string"==typeof e.ref},r.reset=function(){return this.ptr=this.ns,this},r.define=function(e){if("string"!=typeof e||!t.TYPEREF.test(e))throw Error("illegal namespace: "+e);return e.split(".").forEach(function(e){var t=this.ptr.getChild(e);null===t&&this.ptr.addChild(t=new a.Namespace(this,this.ptr,e)),this.ptr=t},this),this},r.create=function(e){if(!e)return this;if(Array.isArray(e)){if(0===e.length)return this;e=e.slice()}else e=[e];for(var t=[e];0<t.length;){if(e=t.pop(),!Array.isArray(e))throw Error("not a valid namespace: "+JSON.stringify(e));for(;0<e.length;){var r=e.shift();if(s.isMessage(r)){var i=new a.Message(this,this.ptr,r.name,r.options,r.isGroup,r.syntax),o={};r.oneofs&&Object.keys(r.oneofs).forEach(function(e){i.addChild(o[e]=new a.Message.OneOf(this,i,e))},this),r.fields&&r.fields.forEach(function(e){if(null!==i.getChild(0|e.id))throw Error("duplicate or invalid field id in "+i.name+": "+e.id);if(e.options&&"object"!=typeof e.options)throw Error("illegal field options in "+i.name+"#"+e.name);var t=null;if("string"==typeof e.oneof&&!(t=o[e.oneof]))throw Error("illegal oneof in "+i.name+"#"+e.name+": "+e.oneof);e=new a.Message.Field(this,i,e.rule,e.keytype,e.type,e.name,e.id,e.options,t,r.syntax),t&&t.fields.push(e),i.addChild(e)},this);var n=[];if(r.enums&&r.enums.forEach(function(e){n.push(e)}),r.messages&&r.messages.forEach(function(e){n.push(e)}),r.services&&r.services.forEach(function(e){n.push(e)}),r.extensions&&("number"==typeof r.extensions[0]?i.extensions=[r.extensions]:i.extensions=r.extensions),this.ptr.addChild(i),0<n.length){t.push(e),e=n,n=null,this.ptr=i,i=null;continue}n=null}else if(s.isEnum(r))i=new a.Enum(this,this.ptr,r.name,r.options,r.syntax),r.values.forEach(function(e){i.addChild(new a.Enum.Value(this,i,e.name,e.id))},this),this.ptr.addChild(i);else if(s.isService(r))i=new a.Service(this,this.ptr,r.name,r.options),Object.keys(r.rpc).forEach(function(e){var t=r.rpc[e];i.addChild(new a.Service.RPCMethod(this,i,e,t.request,t.response,!!t.request_stream,!!t.response_stream,t.options))},this),this.ptr.addChild(i);else{if(!s.isExtend(r))throw Error("not a valid definition: "+JSON.stringify(r));if(i=this.ptr.resolve(r.ref,!0))r.fields.forEach(function(t){if(null!==i.getChild(0|t.id))throw Error("duplicate extended field id in "+i.name+": "+t.id);if(i.extensions){var r=!1;if(i.extensions.forEach(function(e){t.id>=e[0]&&t.id<=e[1]&&(r=!0)}),!r)throw Error("illegal extended field id in "+i.name+": "+t.id+" (not within valid ranges)")}var e=t.name;this.options.convertFieldsToCamelCase&&(e=c.Util.toCamelCase(e));var o=new a.Message.ExtensionField(this,i,t.rule,t.type,this.ptr.fqn()+"."+e,t.id,t.options),n=new a.Extension(this,this.ptr,t.name,o);o.extension=n,this.ptr.addChild(n),i.addChild(o)},this);else if(!/\.?google\.protobuf\./.test(r.ref))throw Error("extended message "+r.ref+" is not defined")}i=r=null}e=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},r.import=function(t,e){var r="/";if("string"==typeof e){if(c.Util.IS_NODE&&(e=require("path").resolve(e)),!0===this.files[e])return this.reset();this.files[e]=!0}else if("object"==typeof e){var o=e.root;c.Util.IS_NODE&&(o=require("path").resolve(o)),(0<=o.indexOf("\\")||0<=e.file.indexOf("\\"))&&(r="\\");var n=o+r+e.file;if(!0===this.files[n])return this.reset();this.files[n]=!0}if(t.imports&&0<t.imports.length){var i,a=!1;"object"==typeof e?(this.importRoot=e.root,a=!0,i=this.importRoot,e=e.file,(0<=i.indexOf("\\")||0<=e.indexOf("\\"))&&(r="\\")):"string"==typeof e?this.importRoot?i=this.importRoot:0<=e.indexOf("/")?""===(i=e.replace(/\/[^\/]*$/,""))&&(i="/"):0<=e.indexOf("\\")?(i=e.replace(/\\[^\\]*$/,""),r="\\"):i=".":i=null;for(var s=0;s<t.imports.length;s++)if("string"==typeof t.imports[s]){if(!i)throw Error("cannot determine import root");var d=t.imports[s];if("google/protobuf/descriptor.proto"===d)continue;if(d=i+r+d,!0===this.files[d])continue;/\.proto$/i.test(d)&&!c.DotProto&&(d=d.replace(/\.proto$/,".json"));var l=c.Util.fetch(d);if(null===l)throw Error("failed to import '"+d+"' in '"+e+"': file not found");/\.json$/i.test(d)?this.import(JSON.parse(l+""),d):this.import(c.DotProto.Parser.parse(l),d)}else e?/\.(\w+)$/.test(e)?this.import(t.imports[s],e.replace(/^(.+)\.(\w+)$/,function(e,t,r){return t+"_import"+s+"."+r})):this.import(t.imports[s],e+"_import"+s):this.import(t.imports[s]);a&&(this.importRoot=null)}t.package&&this.define(t.package),t.syntax&&function t(r){r.messages&&r.messages.forEach(function(e){e.syntax=r.syntax,t(e)}),r.enums&&r.enums.forEach(function(e){e.syntax=r.syntax})}(t);var u=this.ptr;return t.options&&Object.keys(t.options).forEach(function(e){u.options[e]=t.options[e]}),t.messages&&(this.create(t.messages),this.ptr=u),t.enums&&(this.create(t.enums),this.ptr=u),t.services&&(this.create(t.services),this.ptr=u),t.extends&&this.create(t.extends),this.reset()},r.resolveAll=function(){var e;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof a.Namespace)this.ptr.children.forEach(function(e){this.ptr=e,this.resolveAll()},this);else if(this.ptr instanceof a.Message.Field){if(t.TYPE.test(this.ptr.type))this.ptr.type=c.TYPES[this.ptr.type];else{if(!t.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(!(e=(this.ptr instanceof a.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0)))throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if((this.ptr.resolvedType=e)instanceof a.Enum){if(this.ptr.type=c.TYPES.enum,"proto3"===this.ptr.syntax&&"proto3"!==e.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(e instanceof a.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=e.isGroup?c.TYPES.group:c.TYPES.message}}if(this.ptr.map){if(!t.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=c.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof c.Reflect.Service.Method){if(!(this.ptr instanceof c.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(!((e=this.ptr.parent.resolve(this.ptr.requestName,!0))&&e instanceof c.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=e,!((e=this.ptr.parent.resolve(this.ptr.responseName,!0))&&e instanceof c.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=e}else if(!(this.ptr instanceof c.Reflect.Message.OneOf||this.ptr instanceof c.Reflect.Extension||this.ptr instanceof c.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},r.build=function(e){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!e)return this.result;for(var t="string"==typeof e?e.split("."):e,r=this.result,o=0;o<t.length;o++){if(!r[t[o]]){r=null;break}r=r[t[o]]}return r},r.lookup=function(e,t){return e?this.ns.resolve(e,t):this.ns},r.toString=function(){return"Builder"},s.Message=function(){},s.Enum=function(){},s.Service=function(){},s),i.Map=function(e,a){var t=function(e,t){if(!e.map)throw Error("field is not a map");if(this.field=e,this.keyElem=new a.Element(e.keyType,null,!0,e.syntax),this.valueElem=new a.Element(e.type,e.resolvedType,!1,e.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),t)for(var r=Object.keys(t),o=0;o<r.length;o++){var n=this.keyElem.valueFromString(r[o]),i=this.valueElem.verifyValue(t[r[o]]);this.map[this.keyElem.valueToString(n)]={key:n,value:i}}},r=t.prototype;function n(e){var t=0;return{next:function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}}return r.clear=function(){this.map={}},r.delete=function(e){var t=this.keyElem.valueToString(this.keyElem.verifyValue(e)),r=t in this.map;return delete this.map[t],r},r.entries=function(){for(var e,t=[],r=Object.keys(this.map),o=0;o<r.length;o++)t.push([(e=this.map[r[o]]).key,e.value]);return n(t)},r.keys=function(){for(var e=[],t=Object.keys(this.map),r=0;r<t.length;r++)e.push(this.map[t[r]].key);return n(e)},r.values=function(){for(var e=[],t=Object.keys(this.map),r=0;r<t.length;r++)e.push(this.map[t[r]].value);return n(e)},r.forEach=function(e,t){for(var r,o=Object.keys(this.map),n=0;n<o.length;n++)e.call(t,(r=this.map[o[n]]).value,r.key,this)},r.set=function(e,t){var r=this.keyElem.verifyValue(e),o=this.valueElem.verifyValue(t);return this.map[this.keyElem.valueToString(r)]={key:r,value:o},this},r.get=function(e){var t=this.keyElem.valueToString(this.keyElem.verifyValue(e));if(t in this.map)return this.map[t].value},r.has=function(e){return this.keyElem.valueToString(this.keyElem.verifyValue(e))in this.map},t}(0,i.Reflect),i.loadProto=function(e,t,r){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(r=t,t=void 0),i.loadJson(i.DotProto.Parser.parse(e),t,r)},i.protoFromString=i.loadProto,i.loadProtoFile=function(t,r,o){if(r&&"object"==typeof r?(o=r,r=null):r&&"function"==typeof r||(r=null),r)return i.Util.fetch("string"==typeof t?t:t.root+"/"+t.file,function(e){if(null!==e)try{r(null,i.loadProto(e,o,t))}catch(e){r(e)}else r(Error("Failed to fetch file"))});var e=i.Util.fetch("object"==typeof t?t.root+"/"+t.file:t);return null===e?null:i.loadProto(e,o,t)},i.protoFromFile=i.loadProtoFile,i.newBuilder=function(e){return void 0===(e=e||{}).convertFieldsToCamelCase&&(e.convertFieldsToCamelCase=i.convertFieldsToCamelCase),void 0===e.populateAccessors&&(e.populateAccessors=i.populateAccessors),new i.Builder(e)},i.loadJson=function(e,t,r){return("string"==typeof t||t&&"string"==typeof t.file&&"string"==typeof t.root)&&(r=t,t=null),t&&"object"==typeof t||(t=i.newBuilder()),"string"==typeof e&&(e=JSON.parse(e)),t.import(e,r),t.resolveAll(),t},i.loadJsonFile=function(t,r,o){if(r&&"object"==typeof r?(o=r,r=null):r&&"function"==typeof r||(r=null),r)return i.Util.fetch("string"==typeof t?t:t.root+"/"+t.file,function(e){if(null!==e)try{r(null,i.loadJson(JSON.parse(e),o,t))}catch(e){r(e)}else r(Error("Failed to fetch file"))});var e=i.Util.fetch("object"==typeof t?t.root+"/"+t.file:t);return null===e?null:i.loadJson(JSON.parse(e),o,t)},i}),SdpSerializer.SerializeASBandwidth=function(e,t){return t=t||{},e=(e=(e=(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")).replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+(t.audio||50)+"\r\n")).replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(t.video||256)+"\r\n")).replace(/a=mid:data\r\n/g,"a=mid:data\r\nb=AS:"+(t.data||1638400)+"\r\n")},SdpSerializer.SerializePTime=function(e,t){return t=t||{},e=(e=e.replace("a=fmtp:111 minptime=10","a=fmtp:111 minptime="+(t.minptime||10))).replace("a=maxptime:60","a=maxptime:"+(t.maxptime||60))},SdpSerializer.SerializeGoogleMinBitrate=function(e,t){return e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\na=rtpmap:120 VP8/90000\r\na=fmtp:120 \t\t\t\t\t\t\tx-google-min-bitrate="+(t||10)+"\r\n")},SdpSerializer.RTPOverTCP=function(e){return e.replace(/a=candidate:.*udp.*\r\n/g,"")};var SDPTransform=function(){var s={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"sdptype",reg:/^sdptype:([\w-_]*)/,format:"sdptype:%s"},{push:"t3s",reg:/^t3:(\w*) ([\S|]*)/,names:["type","config"],format:"t3:%s %s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"invalid",names:["value"]}]};Object.keys(s).forEach(function(e){s[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})});var i=function(e){return String(Number(e))===e?Number(e):e},d=function(e,t,r){var o=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:o&&!t[e.name]&&(t[e.name]={});var n=e.push?{}:o?t[e.name]:t;!function(e,t,r,o){if(o&&!r)t[o]=i(e[1]);else for(var n=0;n<r.length;n+=1)null!=e[n+1]&&(t[r[n]]=i(e[n+1]))}(r.match(e.reg),n,e.names,e.name),e.push&&t[e.push].push(n)},r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);this.parse=function(e){var t={},i=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach(function(e){var t=e[0],r=e.slice(2);"m"===t&&(i.push({rtp:[],fmtp:[]}),a=i[i.length-1]);for(var o=0;o<(s[t]||[]).length;o+=1){var n=s[t][o];if(n.reg.test(r))return d(n,a,r)}}),t.media=i,t},this.paramReducer=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=i(r[1]):1===r.length&&1<t.length&&(e[r[0]]=void 0),e},this.parseParams=function(e){return e.split(/\;\s?/).reduce(paramReducer,{})},this.parseFmtpConfig=this.parseParams,this.parsePayloads=function(e){return e.split(" ").map(Number)},this.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(i),o=0;o<r.length;o+=3)t.push({component:r[o],ip:r[o+1],port:r[o+2]});return t},this.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(paramReducer,{})})},this.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=i(e):(t=i(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})};var a=/%[sdv%]/g,l=function(e,t,r){var o=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var n=0;n<t.names.length;n+=1){var i=t.names[n];t.name?o.push(r[t.name][i]):o.push(r[t.names[n]])}else o.push(r[t.name]);return function(e){var r=1,o=arguments,n=o.length;return e.replace(a,function(e){if(n<=r)return e;var t=o[r];switch(r+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}})}.apply(null,o)},u=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];this.writer=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||u,o=t.innerOrder||c,n=[];return r.forEach(function(r){s[r].forEach(function(t){t.name in e&&null!=e[t.name]?n.push(l(r,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){n.push(l(r,t,e))})})}),e.media.forEach(function(e){n.push(l("m",s.m[0],e)),o.forEach(function(r){s[r].forEach(function(t){t.name in e&&null!=e[t.name]?n.push(l(r,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){n.push(l(r,t,e))})})})}),n.join("\r\n")+"\r\n"},this.mediaWriter=function(e,t){t=t||{},null==e.payloads&&(e.payloads="");t.outerOrder;var r=t.innerOrder||c,o=[];return o.push(l("m",s.m[0],e)),r.forEach(function(r){s[r].forEach(function(t){t.name in e&&null!=e[t.name]?o.push(l(r,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){o.push(l(r,t,e))})})}),o.join("\r\n")+"\r\n"},this.ssrcGroupsAndSsrcsWriter=function(e,t,r){(r=r||{}).outerOrder;var o=r.innerOrder||c,n=[];return e&&e.forEach(function(r){o.forEach(function(t){s[t].forEach(function(e){"ssrcGroups"==e.push&&n.push(l(t,e,r))})})}),t&&t.forEach(function(r){o.forEach(function(t){s[t].forEach(function(e){"ssrcs"==e.push&&n.push(l(t,e,r))})})}),n.join("\r\n")+"\r\n"}};function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}function debugout(){var s=this;if(s.realTimeLoggingOn=!0,s.useTimestamps=!1,s.useLocalStorage=!1,s.recordLogs=!0,s.autoTrim=!0,s.maxLines=2e5,s.tailNumLines=100,s.logFilename="debugout.txt",s.maxDepth=25,s.depth=0,s.parentSizes=[0],s.currentResult="",s.startTime=new Date,s.output="",s.logLevel={all:1,trace:2,debug:3,info:4,warn:5,error:6,fatal:7,off:8},this.version=function(){return"0.5.0"},this.getLog=function(){var e=new Date;if(s.recordLogs||s.log("[debugout.js] log recording is off."),s.useLocalStorage){var t=window.localStorage.getItem("debugout.js");t&&(t=JSON.parse(t),s.startTime=new Date(t.startTime),s.output=t.log,e=new Date(t.lastLog))}return s.output+"\n---- Log retrieved: "+e+" ----\n"+s.formatSessionDuration(s.startTime,e)},this.tail=function(e){e=e||s.tailLines;return s.trimLog(s.getLog(),e)},this.search=function(e){for(var t=s.output.split("\n"),r=new RegExp(e),o=[],n=0;n<t.length;n++){var i="["+n+"] ";t[n].match(r)&&o.push(i+t[n])}var a=o.join("\n");return 0==a.length&&(a='Nothing found for "'+e+'".'),a},this.getSlice=function(e,t){return s.output.split("\n").slice(e,e+t).join("\n")},this.downloadLog=function(){var e="data:text/plain;charset=utf-8,",t=s.getLog();e+=encodeURIComponent(t);var r=document.createElement("a");r.href=e,r.target="_blank",r.download=s.logFilename,document.body.appendChild(r),r.click(),r.remove()},this.clear=function(){var e=new Date;if(s.output="---- Log cleared: "+e+" ----\n",s.useLocalStorage){var t={startTime:s.startTime,log:s.output,lastLog:e};t=JSON.stringify(t),window.localStorage.setItem("debugout.js",t)}s.realTimeLoggingOn&&console.log("[debugout.js] clear()")},this.track=function(e){s.log(s.logLevel.track,e)},this.debug=function(e){s.log(s.logLevel.debug,e)},this.info=function(e){s.log(s.logLevel.info,e)},this.error=function(e){s.log(s.logLevel.error,e)},this.log=function(e,t){s.realTimeLoggingOn&&(e==this.logLevel.trace?console.trace(t):e==this.logLevel.debug?console.debug(t):e==this.logLevel.info?console.info(t):e==this.logLevel.error?console.error(t):console.info(t));var r=s.determineType(t);if(null!=r&&s.recordLogs){var o=s.formatType(r,t);if(s.useTimestamps){var n=new Date;s.output+=s.formatTimestamp(n)}if(e==this.logLevel.trace?s.output+="TRACK - ":e==this.logLevel.debug?s.output+="DEBUG - ":e==this.logLevel.info?s.output+="INFO - ":e==this.logLevel.error?s.output+="ERROR - ":s.output+="INFO - ",s.output+=o+"\n",s.autoTrim&&(s.output=s.trimLog(s.output,s.maxLines)),s.useLocalStorage){var i=new Date,a={startTime:s.startTime,log:s.output,lastLog:i};a=JSON.stringify(a),window.localStorage.setItem("debugout.js",a)}}s.depth=0,s.parentSizes=[0],s.currentResult=""},this.determineType=function(e){if(null==e)return null;var t=typeof e;return"object"==t?null==e.length?"function"==typeof e.getTime?"Date":"function"==typeof e.test?"RegExp":"Object":"Array":t},this.formatType=function(e,t){if(s.maxDepth&&s.depth>=s.maxDepth)return"... (max-depth reached)";switch(e){case"Object":s.currentResult+="{\n",s.depth++,s.parentSizes.push(s.objectSize(t));var r=0;for(var o in t){s.currentResult+=s.indentsForDepth(s.depth),s.currentResult+=o+": ";var n=s.determineType(t[o]);(i=s.formatType(n,t[o]))&&(s.currentResult+=i),r!=s.parentSizes[s.depth]-1&&(s.currentResult+=","),s.currentResult+="\n",r++}if(s.depth--,s.parentSizes.pop(),s.currentResult+=s.indentsForDepth(s.depth),s.currentResult+="}",0==s.depth)return s.currentResult;break;case"Array":s.currentResult+="[",s.depth++,s.parentSizes.push(t.length);for(r=0;r<t.length;r++){var i;"Object"!=(n=s.determineType(t[r]))&&"Array"!=n||(s.currentResult+="\n"+s.indentsForDepth(s.depth)),(i=s.formatType(n,t[r]))?(s.currentResult+=i,r!=s.parentSizes[s.depth]-1&&(s.currentResult+=", "),"Array"==n&&(s.currentResult+="\n")):(r!=s.parentSizes[s.depth]-1&&(s.currentResult+=", "),"Object"!=n?s.currentResult+="\n":r==s.parentSizes[s.depth]-1&&(s.currentResult+="\n"))}if(s.depth--,s.parentSizes.pop(),s.currentResult+="]",0==s.depth)return s.currentResult;break;case"function":var a=(t+="").split("\n");for(r=0;r<a.length;r++)a[r].match(/\}/)&&s.depth--,s.currentResult+=s.indentsForDepth(s.depth),a[r].match(/\{/)&&s.depth++,s.currentResult+=a[r]+"\n";return s.currentResult;case"RegExp":return"/"+t.source+"/";case"Date":case"string":return 0<s.depth||0==t.length?'"'+t+'"':t;case"boolean":return t?"true":"false";case"number":return t+""}},this.indentsForDepth=function(e){for(var t="",r=0;r<e;r++)t+="\t";return t},this.trimLog=function(e,t){var r=e.split("\n");return r.length>t&&(r=r.slice(r.length-t)),r.join("\n")},this.lines=function(){return s.output.split("\n").length},this.formatSessionDuration=function(e,t){var r=t-e,o=Math.floor(r/1e3/60/60),n=("0"+o).slice(-2);r-=1e3*o*60*60;var i=Math.floor(r/1e3/60),a=("0"+i).slice(-2);r-=1e3*i*60;var s=Math.floor(r/1e3);return r-=1e3*s,"---- Session duration: "+n+":"+a+":"+("0"+s).slice(-2)+" ----"},this.formatTimestamp=function(e){var t=e.getFullYear(),r=e.getDate();return"["+t+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+r+" "+Number(e.getHours())+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)+" "+e.getMilliseconds()+"]: "},this.objectSize=function(e){var t,r=0;for(t in e)e.hasOwnProperty(t)&&r++;return r},s.useLocalStorage){var e=window.localStorage.getItem("debugout.js");if(e){e=JSON.parse(e),s.output=e.log;var t=new Date(e.startTime),r=new Date(e.lastLog);s.output+="\n---- Session end: "+e.lastLog+" ----\n",s.output+=s.formatSessionDuration(t,r),s.output+="\n\n"}}s.output+="---- Session started: "+s.startTime+" ----\n\n"}!function(e,R){e(function(){function m(e,t,r,o){return s(e).then(t,r,o)}function a(e,t){this.then=e,this.inspect=t}function s(t){return c(function(e){e(t)})}function c(e){function t(e){d&&(s=n(e),o(d,s),d=T)}function r(e){t(l(e))}var s,d=[];try{e(t,r,function(e){d&&o(d,function o(n){var i=new a(function(e,t,r){try{return"function"==typeof r?o(r(n)):i}catch(e){return o(e)}});return i}(e))})}catch(e){r(e)}return new a(function(n,i,a){return c(function(t,r,o){d?d.push(function(e){e.then(n,i,a).then(t,r,o)}):h(function(){s.then(n,i,a).then(t,r,o)})})},function(){return s?s.inspect():{state:"pending"}})}function n(n){return n instanceof a?n:n===Object(n)&&"then"in n?c(function(t,r,o){h(function(){try{var e=n.then;"function"==typeof e?b(e,n,t,r,o):t(i(n))}catch(e){r(e)}})}):i(n)}function i(t){var r=new a(function(e){try{return"function"==typeof e?n(e(t)):r}catch(e){return l(e)}},function(){return p(t)});return r}function l(r){var o=new a(function(e,t){try{return"function"==typeof t?n(t(r)):o}catch(e){return l(e)}},function(){return t(r)});return o}function o(r,o){h(function(){for(var e,t=0;e=r[t++];)e(o)})}function d(e,f,t,r,o){return m(e,function(h){return c(function(t,r,e){function o(e){u(e)}function n(e){l(e)}var i,a,s,d,l,u,c,p;if(c=h.length>>>0,i=Math.max(0,Math.min(f,c)),s=[],a=c-i+1,d=[],i)for(u=function(e){d.push(e),--a||(l=u=g,r(d))},l=function(e){s.push(e),--i||(l=u=g,t(s))},p=0;p<c;++p)p in h&&m(h[p],n,o,e);else t(s)}).then(t,r,o)})}function r(e,t,r,o){return u(e,g).then(t,r,o)}function u(e,l,u){return m(e,function(d){return c(function(r,o,n){var i,e,a,t,s;if(a=e=d.length>>>0,i=[],a)for(t=function(e,t){m(e,l,u).then(function(e){i[t]=e,--a||r(i)},o,n)},s=0;s<e;s++)s in d?t(d[s],s):--a;else r(i)})})}function p(e){return{state:"fulfilled",value:e}}function t(e){return{state:"rejected",reason:e}}function h(e){1===w.push(e)&&_(f)}function f(){for(var e,t=0;e=w[t++];)e();w=[]}function g(e){return e}var v,y,b,_,w,S,e,E,I,T;return m.defer=function(){var e,n,i;return(e={promise:T,resolve:T,reject:T,notify:T,resolver:{resolve:T,reject:T,notify:T}}).promise=n=c(function(t,r,o){e.resolve=e.resolver.resolve=function(e){return i?s(e):(i=!0,t(e),n)},e.reject=e.resolver.reject=function(e){return i?s(l(e)):(i=!0,r(e),n)},e.notify=e.resolver.notify=function(e){return o(e),e}}),e},m.resolve=s,m.reject=function(e){return m(e,l)},m.join=function(){return u(arguments,g)},m.all=r,m.map=function(e,t){return u(e,t)},m.reduce=function(e,i){var t=b(y,arguments,1);return m(e,function(e){var n;return n=e.length,t[0]=function(e,r,o){return m(e,function(t){return m(r,function(e){return i(t,e,o,n)})})},v.apply(e,t)})},m.settle=function(e){return u(e,p,t)},m.any=function(e,t,r,o){return d(e,1,function(e){return t?t(e[0]):e[0]},r,o)},m.some=d,m.isPromise=function(e){return e&&"function"==typeof e.then},m.promise=c,a.prototype={otherwise:function(e){return this.then(T,e)},ensure:function(e){function t(){return s(e())}return this.then(t,t).yield2(this)},yield2:function(e){return this.then(function(){return e})},spread:function(t){return this.then(function(e){return r(e,function(e){return t.apply(T,e)})})},always:function(e,t){return this.then(e,e,t)}},w=[],S=R.setTimeout,_="function"==typeof setImmediate?setImmediate.bind(R):"object"==typeof process&&process.nextTick?process.nextTick:"object"==typeof vertx?vertx.runOnLoop:function(e){S(e,0)},E=(e=Function.prototype).call,b=e.bind?E.bind(E):function(e,t){return e.apply(t,y.call(arguments,2))},y=(I=[]).slice,v=I.reduce||function(e){var t,r,o,n,i;if(i=0,n=(t=Object(this)).length>>>0,(r=arguments).length<=1)for(;;){if(i in t){o=t[i++];break}if(++i>=n)throw new TypeError}else o=r[1];for(;i<n;++i)i in t&&(o=e(o,t[i],i,t));return o},m})}("function"==typeof define&&define.amd?define:function(e){window.when=e()},this),EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=500,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,r,o,n,i,a;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(isUndefined(r=this._events[e]))return!1;if(isFunction(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(o=arguments.length,n=new Array(o-1),i=1;i<o;i++)n[i-1]=arguments[i];r.apply(this,n)}else if(isObject(r)){for(o=arguments.length,n=new Array(o-1),i=1;i<o;i++)n[i-1]=arguments[i];for(o=(a=r.slice()).length,i=0;i<o;i++)a[i].apply(this,n)}return!0},EventEmitter.prototype.addListener=function(e,t){var r;if(!isFunction(t))throw TypeError("listener must be a function");(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned)&&((r=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners)&&0<r&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()));return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){if(!isFunction(t))throw TypeError("listener must be a function");var r=!1;function o(){this.removeListener(e,o),r||(r=!0,t.apply(this,arguments))}return o.listener=t,this.on(e,o),this},EventEmitter.prototype.removeListener=function(e,t){var r,o,n,i;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=(r=this._events[e]).length,o=-1,r===t||isFunction(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(r)){for(i=n;0<i--;)if(r[i]===t||r[i].listener&&r[i].listener===t){o=i;break}if(o<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(isFunction(r=this._events[e]))this.removeListener(e,r);else for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){return this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.listenerCount=function(e,t){return e._events&&e._events[t]?isFunction(e._events[t])?1:e._events[t].length:0},function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.zrender={})}(this,function(e){"use strict";var t=2311,o=function(){return t++},u="undefined"==typeof document&&"undefined"!=typeof self?{browser:{},os:{},node:!1,worker:!0,canvasSupported:!0}:"undefined"==typeof navigator?{browser:{},os:{},node:!0,worker:!1,canvasSupported:!0,svgSupported:!0}:function(e){var t={},r=e.match(/Firefox\/([\d.]+)/),o=e.match(/MSIE\s([\d.]+)/)||e.match(/Trident\/.+?rv:(([\d.]+))/),n=e.match(/Edge\/([\d.]+)/),i=/micromessenger/i.test(e);r&&(t.firefox=!0,t.version=r[1]);o&&(t.ie=!0,t.version=o[1]);n&&(t.edge=!0,t.version=n[1]);i&&(t.weChat=!0);return{browser:t,os:{},node:!1,canvasSupported:!!document.createElement("canvas").getContext,svgSupported:"undefined"!=typeof SVGRect,touchEventsSupported:"ontouchstart"in window&&!t.ie&&!t.edge,pointerEventsSupported:"onpointerdown"in window&&(t.edge||t.ie&&11<=t.version)}}(navigator.userAgent);var s={"[object Function]":1,"[object RegExp]":1,"[object Date]":1,"[object Error]":1,"[object CanvasGradient]":1,"[object CanvasPattern]":1,"[object Image]":1,"[object Canvas]":1},d={"[object Int8Array]":1,"[object Uint8Array]":1,"[object Uint8ClampedArray]":1,"[object Int16Array]":1,"[object Uint16Array]":1,"[object Int32Array]":1,"[object Uint32Array]":1,"[object Float32Array]":1,"[object Float64Array]":1},l=Object.prototype.toString,r=Array.prototype,a=r.forEach,c=r.filter,n=r.slice,p=r.map,h=r.reduce,i={};function f(e){if(null==e||"object"!=typeof e)return e;var t=e,r=l.call(e);if("[object Array]"===r){if(!B(e)){t=[];for(var o=0,n=e.length;o<n;o++)t[o]=f(e[o])}}else if(d[r]){if(!B(e)){var i=e.constructor;if(e.constructor.from)t=i.from(e);else{t=new i(e.length);for(o=0,n=e.length;o<n;o++)t[o]=f(e[o])}}}else if(!s[r]&&!B(e)&&!k(e))for(var a in t={},e)e.hasOwnProperty(a)&&(t[a]=f(e[a]));return t}function m(e,t,r){if(!x(t)||!x(e))return r?f(t):e;for(var o in t)if(t.hasOwnProperty(o)){var n=e[o],i=t[o];!x(i)||!x(n)||C(i)||C(n)||k(i)||k(n)||A(i)||A(n)||B(i)||B(n)?!r&&o in e||(e[o]=f(t[o])):m(n,i,r)}return e}function g(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}function v(e,t,r){for(var o in t)t.hasOwnProperty(o)&&(r?null!=t[o]:null==e[o])&&(e[o]=t[o]);return e}var y,b=function(){return i.createCanvas()};function _(){return y||(y=b().getContext("2d")),y}function w(e,t){if(e){if(e.indexOf)return e.indexOf(t);for(var r=0,o=e.length;r<o;r++)if(e[r]===t)return r}return-1}function S(e,t){var r=e.prototype;function o(){}for(var n in o.prototype=t.prototype,e.prototype=new o,r)e.prototype[n]=r[n];(e.prototype.constructor=e).superClass=t}function E(e,t,r){v(e="prototype"in e?e.prototype:e,t="prototype"in t?t.prototype:t,r)}function U(e){if(e)return"string"!=typeof e&&"number"==typeof e.length}function I(e,t,r){if(e&&t)if(e.forEach&&e.forEach===a)e.forEach(t,r);else if(e.length===+e.length)for(var o=0,n=e.length;o<n;o++)t.call(r,e[o],o,e);else for(var i in e)e.hasOwnProperty(i)&&t.call(r,e[i],i,e)}function T(e,t,r){if(e&&t){if(e.map&&e.map===p)return e.map(t,r);for(var o=[],n=0,i=e.length;n<i;n++)o.push(t.call(r,e[n],n,e));return o}}function R(e,t){var r=n.call(arguments,2);return function(){return e.apply(t,r.concat(n.call(arguments)))}}function C(e){return"[object Array]"===l.call(e)}function P(e){return"function"==typeof e}function M(e){return"[object String]"===l.call(e)}function x(e){var t=typeof e;return"function"===t||!!e&&"object"==t}function A(e){return!!s[l.call(e)]}function k(e){return"object"==typeof e&&"number"==typeof e.nodeType&&"object"==typeof e.ownerDocument}function O(e,t){return null!=e?e:t}function L(e,t,r){return null!=e?e:null!=t?t:r}function D(e){if("number"==typeof e)return[e,e,e,e];var t=e.length;return 2===t?[e[0],e[1],e[0],e[1]]:3===t?[e[0],e[1],e[2],e[1]]:e}i.createCanvas=function(){return document.createElement("canvas")};var N="__ec_primitive__";function B(e){return e[N]}function j(e){e&&I(e,function(e,t){this.set(t,e)},this)}var V="_ec_";j.prototype={constructor:j,get:function(e){return this[V+e]},set:function(e,t){return this[V+e]=t},each:function(e,t){for(var r in void 0!==t&&(e=R(e,t)),this)this.hasOwnProperty(r)&&e(this[r],r.slice(4))},removeKey:function(e){delete this[V+e]}};var F=(Object.freeze||Object)({$override:function(e,t){i[e]=t},clone:f,merge:m,mergeAll:function(e,t){for(var r=e[0],o=1,n=e.length;o<n;o++)r=m(r,e[o],t);return r},extend:g,defaults:v,createCanvas:b,getContext:_,indexOf:w,inherits:S,mixin:E,isArrayLike:U,each:I,map:T,reduce:function(e,t,r,o){if(e&&t){if(e.reduce&&e.reduce===h)return e.reduce(t,r,o);for(var n=0,i=e.length;n<i;n++)r=t.call(o,r,e[n],n,e);return r}},filter:function(e,t,r){if(e&&t){if(e.filter&&e.filter===c)return e.filter(t,r);for(var o=[],n=0,i=e.length;n<i;n++)t.call(r,e[n],n,e)&&o.push(e[n]);return o}},find:function(e,t,r){if(e&&t)for(var o=0,n=e.length;o<n;o++)if(t.call(r,e[o],o,e))return e[o]},bind:R,curry:function(e){var t=n.call(arguments,1);return function(){return e.apply(this,t.concat(n.call(arguments)))}},isArray:C,isFunction:P,isString:M,isObject:x,isBuiltInObject:A,isDom:k,eqNaN:function(e){return e!=e},retrieve:function(e){for(var t=0,r=arguments.length;t<r;t++)if(null!=arguments[t])return arguments[t]},retrieve2:O,retrieve3:L,slice:function(){return Function.call.apply(n,arguments)},normalizeCssArray:D,assert:function(e,t){if(!e)throw new Error(t)},setAsPrimitive:function(e){e[N]=!0},isPrimitive:B,createHashMap:function(e){return new j(e)},noop:function(){}}),q="undefined"==typeof Float32Array?Array:Float32Array;function G(e,t){var r=new q(2);return null==e&&(e=0),null==t&&(t=0),r[0]=e,r[1]=t,r}function H(e){var t=new q(2);return t[0]=e[0],t[1]=e[1],t}function W(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function Y(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function z(e){return Math.sqrt(X(e))}var K=z;function X(e){return e[0]*e[0]+e[1]*e[1]}var J=X;function Q(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function $(e,t){var r=z(t);return 0===r?(e[0]=0,e[1]=0):(e[0]=t[0]/r,e[1]=t[1]/r),e}function Z(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}var ee=Z;function te(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}var re=te;function oe(e,t,r){var o=t[0],n=t[1];return e[0]=r[0]*o+r[2]*n+r[4],e[1]=r[1]*o+r[3]*n+r[5],e}function ne(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function ie(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}var ae=(Object.freeze||Object)({create:G,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},clone:H,set:function(e,t,r){return e[0]=t,e[1]=r,e},add:W,scaleAndAdd:function(e,t,r,o){return e[0]=t[0]+r[0]*o,e[1]=t[1]+r[1]*o,e},sub:Y,len:z,length:K,lenSquare:X,lengthSquare:J,mul:function(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e},div:function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},scale:Q,normalize:$,distance:Z,dist:ee,distanceSquare:te,distSquare:re,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e},lerp:function(e,t,r,o){return e[0]=t[0]+o*(r[0]-t[0]),e[1]=t[1]+o*(r[1]-t[1]),e},applyTransform:oe,min:ne,max:ie});function se(){this.on("mousedown",this._dragStart,this),this.on("mousemove",this._drag,this),this.on("mouseup",this._dragEnd,this),this.on("globalout",this._dragEnd,this)}function de(e,t){return{target:e,topTarget:t&&t.topTarget}}se.prototype={constructor:se,_dragStart:function(e){var t=e.target;t&&t.draggable&&((this._draggingTarget=t).dragging=!0,this._x=e.offsetX,this._y=e.offsetY,this.dispatchToElement(de(t,e),"dragstart",e.event))},_drag:function(e){var t=this._draggingTarget;if(t){var r=e.offsetX,o=e.offsetY,n=r-this._x,i=o-this._y;this._x=r,this._y=o,t.drift(n,i,e),this.dispatchToElement(de(t,e),"drag",e.event);var a=this.findHover(r,o,t).target,s=this._dropTarget;t!==(this._dropTarget=a)&&(s&&a!==s&&this.dispatchToElement(de(s,e),"dragleave",e.event),a&&a!==s&&this.dispatchToElement(de(a,e),"dragenter",e.event))}},_dragEnd:function(e){var t=this._draggingTarget;t&&(t.dragging=!1),this.dispatchToElement(de(t,e),"dragend",e.event),this._dropTarget&&this.dispatchToElement(de(this._dropTarget,e),"drop",e.event),this._draggingTarget=null,this._dropTarget=null}};var le=Array.prototype.slice,ue=function(){this._$handlers={}};ue.prototype={constructor:ue,one:function(e,t,r){var o=this._$handlers;if(!t||!e)return this;o[e]||(o[e]=[]);for(var n=0;n<o[e].length;n++)if(o[e][n].h===t)return this;return o[e].push({h:t,one:!0,ctx:r||this}),this},on:function(e,t,r){var o=this._$handlers;if(!t||!e)return this;o[e]||(o[e]=[]);for(var n=0;n<o[e].length;n++)if(o[e][n].h===t)return this;return o[e].push({h:t,one:!1,ctx:r||this}),this},isSilent:function(e){var t=this._$handlers;return t[e]&&t[e].length},off:function(e,t){var r=this._$handlers;if(!e)return this._$handlers={},this;if(t){if(r[e]){for(var o=[],n=0,i=r[e].length;n<i;n++)r[e][n].h!=t&&o.push(r[e][n]);r[e]=o}r[e]&&0===r[e].length&&delete r[e]}else delete r[e];return this},trigger:function(e){if(this._$handlers[e]){var t=arguments,r=t.length;3<r&&(t=le.call(t,1));for(var o=this._$handlers[e],n=o.length,i=0;i<n;){switch(r){case 1:o[i].h.call(o[i].ctx);break;case 2:o[i].h.call(o[i].ctx,t[1]);break;case 3:o[i].h.call(o[i].ctx,t[1],t[2]);break;default:o[i].h.apply(o[i].ctx,t)}o[i].one?(o.splice(i,1),n--):i++}}return this},triggerWithContext:function(e){if(this._$handlers[e]){var t=arguments,r=t.length;4<r&&(t=le.call(t,1,t.length-1));for(var o=t[t.length-1],n=this._$handlers[e],i=n.length,a=0;a<i;){switch(r){case 1:n[a].h.call(o);break;case 2:n[a].h.call(o,t[1]);break;case 3:n[a].h.call(o,t[1],t[2]);break;default:n[a].h.apply(o,t)}n[a].one?(n.splice(a,1),i--):a++}}return this}};var ce="silent";function pe(){}pe.prototype.dispose=function(){};var he=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],fe=function(e,t,r,o){ue.call(this),this.storage=e,this.painter=t,this.painterRoot=o,r=r||new pe,this.proxy=null,this._hovered={},this._lastTouchMoment,this._lastX,this._lastY,se.call(this),this.setHandlerProxy(r)};function me(e,t,r){if(e[e.rectHover?"rectContain":"contain"](t,r)){for(var o,n=e;n;){if(n.clipPath&&!n.clipPath.contain(t,r))return!1;n.silent&&(o=!0),n=n.parent}return!o||ce}return!1}fe.prototype={constructor:fe,setHandlerProxy:function(t){this.proxy&&this.proxy.dispose(),t&&(I(he,function(e){t.on&&t.on(e,this[e],this)},this),t.handler=this),this.proxy=t},mousemove:function(e){var t=e.zrX,r=e.zrY,o=this._hovered,n=o.target;n&&!n.__zr&&(n=(o=this.findHover(o.x,o.y)).target);var i=this._hovered=this.findHover(t,r),a=i.target,s=this.proxy;s.setCursor&&s.setCursor(a?a.cursor:"default"),n&&a!==n&&this.dispatchToElement(o,"mouseout",e),this.dispatchToElement(i,"mousemove",e),a&&a!==n&&this.dispatchToElement(i,"mouseover",e)},mouseout:function(e){this.dispatchToElement(this._hovered,"mouseout",e);for(var t,r=e.toElement||e.relatedTarget;(r=r&&r.parentNode)&&9!=r.nodeType&&!(t=r===this.painterRoot););!t&&this.trigger("globalout",{event:e})},resize:function(e){this._hovered={}},dispatch:function(e,t){var r=this[e];r&&r.call(this,t)},dispose:function(){this.proxy.dispose(),this.storage=this.proxy=this.painter=null},setCursorStyle:function(e){var t=this.proxy;t.setCursor&&t.setCursor(e)},dispatchToElement:function(e,t,r){var o=(e=e||{}).target;if(!o||!o.silent){for(var n,i,a="on"+t,s={type:t,event:i=r,target:(n=e).target,topTarget:n.topTarget,cancelBubble:!1,offsetX:i.zrX,offsetY:i.zrY,gestureEvent:i.gestureEvent,pinchX:i.pinchX,pinchY:i.pinchY,pinchScale:i.pinchScale,wheelDelta:i.zrDelta,zrByTouch:i.zrByTouch,which:i.which};o&&(o[a]&&(s.cancelBubble=o[a].call(o,s)),o.trigger(t,s),o=o.parent,!s.cancelBubble););s.cancelBubble||(this.trigger(t,s),this.painter&&this.painter.eachOtherLayer(function(e){"function"==typeof e[a]&&e[a].call(e,s),e.trigger&&e.trigger(t,s)}))}},findHover:function(e,t,r){for(var o=this.storage.getDisplayList(),n={x:e,y:t},i=o.length-1;0<=i;i--){var a;if(o[i]!==r&&!o[i].ignore&&(a=me(o[i],e,t))&&(!n.topTarget&&(n.topTarget=o[i]),a!==ce)){n.target=o[i];break}}return n}},I(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(o){fe.prototype[o]=function(e){var t=this.findHover(e.zrX,e.zrY),r=t.target;if("mousedown"===o)this._downEl=r,this._downPoint=[e.zrX,e.zrY],this._upEl=r;else if("mosueup"===o)this._upEl=r;else if("click"===o){if(this._downEl!==this._upEl||!this._downPoint||4<ee(this._downPoint,[e.zrX,e.zrY]))return;this._downPoint=null}this.dispatchToElement(t,o,e)}}),E(fe,ue),E(fe,se);var ge="undefined"==typeof Float32Array?Array:Float32Array;function ve(){var e=new ge(6);return ye(e),e}function ye(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function be(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function _e(e,t,r){var o=t[0]*r[0]+t[2]*r[1],n=t[1]*r[0]+t[3]*r[1],i=t[0]*r[2]+t[2]*r[3],a=t[1]*r[2]+t[3]*r[3],s=t[0]*r[4]+t[2]*r[5]+t[4],d=t[1]*r[4]+t[3]*r[5]+t[5];return e[0]=o,e[1]=n,e[2]=i,e[3]=a,e[4]=s,e[5]=d,e}function we(e,t,r){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4]+r[0],e[5]=t[5]+r[1],e}function Se(e,t,r){var o=t[0],n=t[2],i=t[4],a=t[1],s=t[3],d=t[5],l=Math.sin(r),u=Math.cos(r);return e[0]=o*u+a*l,e[1]=-o*l+a*u,e[2]=n*u+s*l,e[3]=-n*l+u*s,e[4]=u*i+l*d,e[5]=u*d-l*i,e}function Ee(e,t,r){var o=r[0],n=r[1];return e[0]=t[0]*o,e[1]=t[1]*n,e[2]=t[2]*o,e[3]=t[3]*n,e[4]=t[4]*o,e[5]=t[5]*n,e}function Ie(e,t){var r=t[0],o=t[2],n=t[4],i=t[1],a=t[3],s=t[5],d=r*a-i*o;return d?(d=1/d,e[0]=a*d,e[1]=-i*d,e[2]=-o*d,e[3]=r*d,e[4]=(o*s-a*n)*d,e[5]=(i*n-r*s)*d,e):null}var Te=(Object.freeze||Object)({create:ve,identity:ye,copy:be,mul:_e,translate:we,rotate:Se,scale:Ee,invert:Ie}),Re=ye;function Ce(e){return 5e-5<e||e<-5e-5}var Pe=function(e){(e=e||{}).position||(this.position=[0,0]),null==e.rotation&&(this.rotation=0),e.scale||(this.scale=[1,1]),this.origin=this.origin||null},Me=Pe.prototype;Me.transform=null,Me.needLocalTransform=function(){return Ce(this.rotation)||Ce(this.position[0])||Ce(this.position[1])||Ce(this.scale[0]-1)||Ce(this.scale[1]-1)},Me.updateTransform=function(){var e=this.parent,t=e&&e.transform,r=this.needLocalTransform(),o=this.transform;r||t?(o=o||ve(),r?this.getLocalTransform(o):Re(o),t&&(r?_e(o,e.transform,o):be(o,e.transform)),this.transform=o,this.invTransform=this.invTransform||ve(),Ie(this.invTransform,o)):o&&Re(o)},Me.getLocalTransform=function(e){return Pe.getLocalTransform(this,e)},Me.setTransform=function(e){var t=this.transform,r=e.dpr||1;t?e.setTransform(r*t[0],r*t[1],r*t[2],r*t[3],r*t[4],r*t[5]):e.setTransform(r,0,0,r,0,0)},Me.restoreTransform=function(e){var t=e.dpr||1;e.setTransform(t,0,0,t,0,0)};var xe=[];Me.decomposeTransform=function(){if(this.transform){var e=this.parent,t=this.transform;e&&e.transform&&(_e(xe,e.invTransform,t),t=xe);var r=t[0]*t[0]+t[1]*t[1],o=t[2]*t[2]+t[3]*t[3],n=this.position,i=this.scale;Ce(r-1)&&(r=Math.sqrt(r)),Ce(o-1)&&(o=Math.sqrt(o)),t[0]<0&&(r=-r),t[3]<0&&(o=-o),n[0]=t[4],n[1]=t[5],i[0]=r,i[1]=o,this.rotation=Math.atan2(-t[1]/o,t[0]/r)}},Me.getGlobalScale=function(){var e=this.transform;if(!e)return[1,1];var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]),r=Math.sqrt(e[2]*e[2]+e[3]*e[3]);return e[0]<0&&(t=-t),e[3]<0&&(r=-r),[t,r]},Me.transformCoordToLocal=function(e,t){var r=[e,t],o=this.invTransform;return o&&oe(r,r,o),r},Me.transformCoordToGlobal=function(e,t){var r=[e,t],o=this.transform;return o&&oe(r,r,o),r},Pe.getLocalTransform=function(e,t){Re(t=t||[]);var r=e.origin,o=e.scale||[1,1],n=e.rotation||0,i=e.position||[0,0];return r&&(t[4]-=r[0],t[5]-=r[1]),Ee(t,t,o),n&&Se(t,t,n),r&&(t[4]+=r[0],t[5]+=r[1]),t[4]+=i[0],t[5]+=i[1],t};var Ae={linear:function(e){return e},quadraticIn:function(e){return e*e},quadraticOut:function(e){return e*(2-e)},quadraticInOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},cubicIn:function(e){return e*e*e},cubicOut:function(e){return--e*e*e+1},cubicInOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},quarticIn:function(e){return e*e*e*e},quarticOut:function(e){return 1- --e*e*e*e},quarticInOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},quinticIn:function(e){return e*e*e*e*e},quinticOut:function(e){return--e*e*e*e*e+1},quinticInOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},sinusoidalIn:function(e){return 1-Math.cos(e*Math.PI/2)},sinusoidalOut:function(e){return Math.sin(e*Math.PI/2)},sinusoidalInOut:function(e){return.5*(1-Math.cos(Math.PI*e))},exponentialIn:function(e){return 0===e?0:Math.pow(1024,e-1)},exponentialOut:function(e){return 1===e?1:1-Math.pow(2,-10*e)},exponentialInOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))},circularIn:function(e){return 1-Math.sqrt(1-e*e)},circularOut:function(e){return Math.sqrt(1- --e*e)},circularInOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},elasticIn:function(e){var t,r=.1;return 0===e?0:1===e?1:(t=!r||r<1?(r=1,.1):.4*Math.asin(1/r)/(2*Math.PI),-r*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4))},elasticOut:function(e){var t,r=.1;return 0===e?0:1===e?1:(t=!r||r<1?(r=1,.1):.4*Math.asin(1/r)/(2*Math.PI),r*Math.pow(2,-10*e)*Math.sin((e-t)*(2*Math.PI)/.4)+1)},elasticInOut:function(e){var t,r=.1;return 0===e?0:1===e?1:(t=!r||r<1?(r=1,.1):.4*Math.asin(1/r)/(2*Math.PI),(e*=2)<1?r*Math.pow(2,10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4)*-.5:r*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*(2*Math.PI)/.4)*.5+1)},backIn:function(e){return e*e*(2.70158*e-1.70158)},backOut:function(e){return--e*e*(2.70158*e+1.70158)+1},backInOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)},bounceIn:function(e){return 1-Ae.bounceOut(1-e)},bounceOut:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},bounceInOut:function(e){return e<.5?.5*Ae.bounceIn(2*e):.5*Ae.bounceOut(2*e-1)+.5}};function ke(e){this._target=e.target,this._life=e.life||1e3,this._delay=e.delay||0,this._initialized=!1,this.loop=null!=e.loop&&e.loop,this.gap=e.gap||0,this.easing=e.easing||"Linear",this.onframe=e.onframe,this.ondestroy=e.ondestroy,this.onrestart=e.onrestart,this._pausedTime=0,this._paused=!1}ke.prototype={constructor:ke,step:function(e,t){if(this._initialized||(this._startTime=e+this._delay,this._initialized=!0),this._paused)this._pausedTime+=t;else{var r=(e-this._startTime-this._pausedTime)/this._life;if(!(r<0)){r=Math.min(r,1);var o=this.easing,n="string"==typeof o?Ae[o]:o,i="function"==typeof n?n(r):r;return this.fire("frame",i),1==r?this.loop?(this.restart(e),"restart"):(this._needsRemove=!0,"destroy"):null}}},restart:function(e){var t=(e-this._startTime-this._pausedTime)%this._life;this._startTime=e-t+this.gap,this._pausedTime=0,this._needsRemove=!1},fire:function(e,t){this[e="on"+e]&&this[e](this._target,t)},pause:function(){this._paused=!0},resume:function(){this._paused=!1}};var Oe=function(){this.head=null,this.tail=null,this._len=0},Ue=Oe.prototype;Ue.insert=function(e){var t=new Le(e);return this.insertEntry(t),t},Ue.insertEntry=function(e){this.head?((this.tail.next=e).prev=this.tail,e.next=null,this.tail=e):this.head=this.tail=e,this._len++},Ue.remove=function(e){var t=e.prev,r=e.next;t?t.next=r:this.head=r,r?r.prev=t:this.tail=t,e.next=e.prev=null,this._len--},Ue.len=function(){return this._len},Ue.clear=function(){this.head=this.tail=null,this._len=0};var Le=function(e){this.value=e,this.next,this.prev},De=function(e){this._list=new Oe,this._map={},this._maxSize=e||10,this._lastRemovedEntry=null},Ne=De.prototype;Ne.put=function(e,t){var r=this._list,o=this._map,n=null;if(null==o[e]){var i=r.len(),a=this._lastRemovedEntry;if(i>=this._maxSize&&0<i){var s=r.head;r.remove(s),delete o[s.key],n=s.value,this._lastRemovedEntry=s}a?a.value=t:a=new Le(t),a.key=e,r.insertEntry(a),o[e]=a}return n},Ne.get=function(e){var t=this._map[e],r=this._list;if(null!=t)return t!==r.tail&&(r.remove(t),r.insertEntry(t)),t.value},Ne.clear=function(){this._list.clear(),this._map={}};var Be={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function je(e){return(e=Math.round(e))<0?0:255<e?255:e}function Ve(e){return e<0?0:1<e?1:e}function Fe(e){return e.length&&"%"===e.charAt(e.length-1)?je(parseFloat(e)/100*255):je(parseInt(e,10))}function qe(e){return e.length&&"%"===e.charAt(e.length-1)?Ve(parseFloat(e)/100):Ve(parseFloat(e))}function Ge(e,t,r){return r<0?r+=1:1<r&&(r-=1),6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}function He(e,t,r){return e+(t-e)*r}function We(e,t,r,o,n){return e[0]=t,e[1]=r,e[2]=o,e[3]=n,e}function Ye(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}var ze=new De(20),Ke=null;function Xe(e,t){Ke&&Ye(Ke,t),Ke=ze.put(e,Ke||t.slice())}function Je(e,t){if(e){t=t||[];var r=ze.get(e);if(r)return Ye(t,r);var o,n=(e+="").replace(/ /g,"").toLowerCase();if(n in Be)return Ye(t,Be[n]),Xe(e,t),t;if("#"===n.charAt(0))return 4===n.length?0<=(o=parseInt(n.substr(1),16))&&o<=4095?(We(t,(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1),Xe(e,t),t):void We(t,0,0,0,1):7===n.length?0<=(o=parseInt(n.substr(1),16))&&o<=16777215?(We(t,(16711680&o)>>16,(65280&o)>>8,255&o,1),Xe(e,t),t):void We(t,0,0,0,1):void 0;var i=n.indexOf("("),a=n.indexOf(")");if(-1!==i&&a+1===n.length){var s=n.substr(0,i),d=n.substr(i+1,a-(i+1)).split(","),l=1;switch(s){case"rgba":if(4!==d.length)return void We(t,0,0,0,1);l=qe(d.pop());case"rgb":return 3!==d.length?void We(t,0,0,0,1):(We(t,Fe(d[0]),Fe(d[1]),Fe(d[2]),l),Xe(e,t),t);case"hsla":return 4!==d.length?void We(t,0,0,0,1):(d[3]=qe(d[3]),Qe(d,t),Xe(e,t),t);case"hsl":return 3!==d.length?void We(t,0,0,0,1):(Qe(d,t),Xe(e,t),t);default:return}}We(t,0,0,0,1)}}function Qe(e,t){var r=(parseFloat(e[0])%360+360)%360/360,o=qe(e[1]),n=qe(e[2]),i=n<=.5?n*(o+1):n+o-n*o,a=2*n-i;return We(t=t||[],je(255*Ge(a,i,r+1/3)),je(255*Ge(a,i,r)),je(255*Ge(a,i,r-1/3)),1),4===e.length&&(t[3]=e[3]),t}function $e(e,t,r){if(t&&t.length&&0<=e&&e<=1){r=r||[];var o=e*(t.length-1),n=Math.floor(o),i=Math.ceil(o),a=t[n],s=t[i],d=o-n;return r[0]=je(He(a[0],s[0],d)),r[1]=je(He(a[1],s[1],d)),r[2]=je(He(a[2],s[2],d)),r[3]=Ve(He(a[3],s[3],d)),r}}var Ze=$e;function et(e,t,r){if(t&&t.length&&0<=e&&e<=1){var o=e*(t.length-1),n=Math.floor(o),i=Math.ceil(o),a=Je(t[n]),s=Je(t[i]),d=o-n,l=rt([je(He(a[0],s[0],d)),je(He(a[1],s[1],d)),je(He(a[2],s[2],d)),Ve(He(a[3],s[3],d))],"rgba");return r?{color:l,leftIndex:n,rightIndex:i,value:o}:l}}var tt=et;function rt(e,t){if(e&&e.length){var r=e[0]+","+e[1]+","+e[2];return"rgba"!==t&&"hsva"!==t&&"hsla"!==t||(r+=","+e[3]),t+"("+r+")"}}var ot=(Object.freeze||Object)({parse:Je,lift:function(e,t){var r=Je(e);if(r){for(var o=0;o<3;o++)r[o]=t<0?r[o]*(1-t)|0:(255-r[o])*t+r[o]|0;return rt(r,4===r.length?"rgba":"rgb")}},toHex:function(e){var t=Je(e);if(t)return((1<<24)+(t[0]<<16)+(t[1]<<8)+ +t[2]).toString(16).slice(1)},fastLerp:$e,fastMapToColor:Ze,lerp:et,mapToColor:tt,modifyHSL:function(e,t,r,o){if(e=Je(e))return e=function(e){if(e){var t,r,o=e[0]/255,n=e[1]/255,i=e[2]/255,a=Math.min(o,n,i),s=Math.max(o,n,i),d=s-a,l=(s+a)/2;if(0===d)r=t=0;else{r=l<.5?d/(s+a):d/(2-s-a);var u=((s-o)/6+d/2)/d,c=((s-n)/6+d/2)/d,p=((s-i)/6+d/2)/d;o===s?t=p-c:n===s?t=1/3+u-p:i===s&&(t=2/3+c-u),t<0&&(t+=1),1<t&&(t-=1)}var h=[360*t,r,l];return null!=e[3]&&h.push(e[3]),h}}(e),null!=t&&(e[0]=(n=t,(n=Math.round(n))<0?0:360<n?360:n)),null!=r&&(e[1]=qe(r)),null!=o&&(e[2]=qe(o)),rt(Qe(e),"rgba");var n},modifyAlpha:function(e,t){if((e=Je(e))&&null!=t)return e[3]=Ve(t),rt(e,"rgba")},stringify:rt}),nt=Array.prototype.slice;function it(e,t){return e[t]}function at(e,t,r){e[t]=r}function st(e,t,r){return(t-e)*r+e}function dt(e,t,r){return.5<r?t:e}function lt(e,t,r,o,n){var i=e.length;if(1==n)for(var a=0;a<i;a++)o[a]=st(e[a],t[a],r);else{var s=i&&e[0].length;for(a=0;a<i;a++)for(var d=0;d<s;d++)o[a][d]=st(e[a][d],t[a][d],r)}}function ut(e,t,r){var o=e.length,n=t.length;if(o!==n)if(n<o)e.length=n;else for(var i=o;i<n;i++)e.push(1===r?t[i]:nt.call(t[i]));var a=e[0]&&e[0].length;for(i=0;i<e.length;i++)if(1===r)isNaN(e[i])&&(e[i]=t[i]);else for(var s=0;s<a;s++)isNaN(e[i][s])&&(e[i][s]=t[i][s])}function ct(e,t,r){if(e===t)return!0;var o=e.length;if(o!==t.length)return!1;if(1===r){for(var n=0;n<o;n++)if(e[n]!==t[n])return!1}else{var i=e[0].length;for(n=0;n<o;n++)for(var a=0;a<i;a++)if(e[n][a]!==t[n][a])return!1}return!0}function pt(e,t,r,o,n,i,a,s,d){var l=e.length;if(1==d)for(var u=0;u<l;u++)s[u]=ht(e[u],t[u],r[u],o[u],n,i,a);else{var c=e[0].length;for(u=0;u<l;u++)for(var p=0;p<c;p++)s[u][p]=ht(e[u][p],t[u][p],r[u][p],o[u][p],n,i,a)}}function ht(e,t,r,o,n,i,a){var s=.5*(r-e),d=.5*(o-t);return(2*(t-r)+s+d)*a+(-3*(t-r)-2*s-d)*i+s*n+t}function ft(e){if(U(e)){var t=e.length;if(U(e[0])){for(var r=[],o=0;o<t;o++)r.push(nt.call(e[o]));return r}return nt.call(e)}return e}function mt(e){return e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.floor(e[2]),"rgba("+e.join(",")+")"}function gt(e,t,r,o,i,n){var a=e._getter,s=e._setter,d="spline"===t,l=o.length;if(l){var u,c,p,h=U(o[0].value),f=!1,m=!1,g=h?U((c=(u=o)[u.length-1].value)&&c[0])?2:1:0;o.sort(function(e,t){return e.time-t.time}),p=o[l-1].time;for(var v=[],y=[],b=o[0].value,_=!0,w=0;w<l;w++){v.push(o[w].time/p);var S=o[w].value;if(h&&ct(S,b,g)||!h&&S===b||(_=!1),"string"==typeof(b=S)){var E=Je(S);E?(S=E,f=!0):m=!0}y.push(S)}if(n||!_){var I=y[l-1];for(w=0;w<l-1;w++)h?ut(y[w],I,g):!isNaN(y[w])||isNaN(I)||m||f||(y[w]=I);h&&ut(a(e._target,i),I,g);var T,R,C,P,M,x=0,A=0;if(f)var k=[0,0,0,0];var O=new ke({target:e._target,life:p,loop:e._loop,delay:e._delay,onframe:function(e,t){var r;if(t<0)r=0;else if(t<A){for(r=Math.min(x+1,l-1);0<=r&&!(v[r]<=t);r--);r=Math.min(r,l-2)}else{for(r=x;r<l&&!(v[r]>t);r++);r=Math.min(r-1,l-2)}A=t;var o=v[(x=r)+1]-v[r];if(0!==o)if(T=(t-v[r])/o,d)if(C=y[r],R=y[0===r?r:r-1],P=y[l-2<r?l-1:r+1],M=y[l-3<r?l-1:r+2],h)pt(R,C,P,M,T,T*T,T*T*T,a(e,i),g);else{if(f)n=pt(R,C,P,M,T,T*T,T*T*T,k,1),n=mt(k);else{if(m)return dt(C,P,T);n=ht(R,C,P,M,T,T*T,T*T*T)}s(e,i,n)}else if(h)lt(y[r],y[r+1],T,a(e,i),g);else{var n;if(f)lt(y[r],y[r+1],T,k,1),n=mt(k);else{if(m)return dt(y[r],y[r+1],T);n=st(y[r],y[r+1],T)}s(e,i,n)}},ondestroy:r});return t&&"spline"!==t&&(O.easing=t),O}}}var vt=function(e,t,r,o){this._tracks={},this._target=e,this._loop=t||!1,this._getter=r||it,this._setter=o||at,this._clipCount=0,this._delay=0,this._doneList=[],this._onframeList=[],this._clipList=[]};vt.prototype={when:function(e,t){var r=this._tracks;for(var o in t)if(t.hasOwnProperty(o)){if(!r[o]){r[o]=[];var n=this._getter(this._target,o);if(null==n)continue;0!==e&&r[o].push({time:0,value:ft(n)})}r[o].push({time:e,value:t[o]})}return this},during:function(e){return this._onframeList.push(e),this},pause:function(){for(var e=0;e<this._clipList.length;e++)this._clipList[e].pause();this._paused=!0},resume:function(){for(var e=0;e<this._clipList.length;e++)this._clipList[e].resume();this._paused=!1},isPaused:function(){return!!this._paused},_doneCallback:function(){this._tracks={},this._clipList.length=0;for(var e=this._doneList,t=e.length,r=0;r<t;r++)e[r].call(this)},start:function(e,t){var r,o=this,n=0,i=function(){--n||o._doneCallback()};for(var a in this._tracks)if(this._tracks.hasOwnProperty(a)){var s=gt(this,e,i,this._tracks[a],a,t);s&&(this._clipList.push(s),n++,this.animation&&this.animation.addClip(s),r=s)}if(r){var d=r.onframe;r.onframe=function(e,t){d(e,t);for(var r=0;r<o._onframeList.length;r++)o._onframeList[r](e,t)}}return n||this._doneCallback(),this},stop:function(e){for(var t=this._clipList,r=this.animation,o=0;o<t.length;o++){var n=t[o];e&&n.onframe(this._target,1),r&&r.removeClip(n)}t.length=0},delay:function(e){return this._delay=e,this},done:function(e){return e&&this._doneList.push(e),this},getClips:function(){return this._clipList}};var yt=1;"undefined"!=typeof window&&(yt=Math.max(window.devicePixelRatio||1,1));var bt=yt,_t=function(){};var wt=_t,St=function(){this.animators=[]};St.prototype={constructor:St,animate:function(e,t){var r,o=!1,n=this,i=this.__zr;if(e){var a=e.split("."),s=n;o="shape"===a[0];for(var d=0,l=a.length;d<l;d++)s&&(s=s[a[d]]);s&&(r=s)}else r=n;if(r){var u=n.animators,c=new vt(r,t);return c.during(function(e){n.dirty(o)}).done(function(){u.splice(w(u,c),1)}),u.push(c),i&&i.animation.addAnimator(c),c}wt('Property "'+e+'" is not existed in element '+n.id)},stopAnimation:function(e){for(var t=this.animators,r=t.length,o=0;o<r;o++)t[o].stop(e);return t.length=0,this},animateTo:function(e,t,r,o,n,i){M(r)?(n=o,o=r,r=0):P(o)?(n=o,o="linear",r=0):P(r)?(n=r,r=0):P(t)?(n=t,t=500):t||(t=500),this.stopAnimation(),this._animateToShallow("",this,e,t,r);var a=this.animators.slice(),s=a.length;function d(){--s||n&&n()}s||n&&n();for(var l=0;l<a.length;l++)a[l].done(d).start(o,i)},_animateToShallow:function(e,t,r,o,n){var i={},a=0;for(var s in r)if(r.hasOwnProperty(s))if(null!=t[s])x(r[s])&&!U(r[s])?this._animateToShallow(e?e+"."+s:s,t[s],r[s],o,n):(i[s]=r[s],a++);else if(null!=r[s])if(e){var d={};d[e]={},d[e][s]=r[s],this.attr(d)}else this.attr(s,r[s]);return 0<a&&this.animate(e,!1).when(null==o?500:o,i).delay(n||0),this}};var Et=function(e){Pe.call(this,e),ue.call(this,e),St.call(this,e),this.id=e.id||o()};Et.prototype={type:"element",name:"",__zr:null,ignore:!1,clipPath:null,isGroup:!1,drift:function(e,t){switch(this.draggable){case"horizontal":t=0;break;case"vertical":e=0}var r=this.transform;r||(r=this.transform=[1,0,0,1,0,0]),r[4]+=e,r[5]+=t,this.decomposeTransform(),this.dirty(!1)},beforeUpdate:function(){},afterUpdate:function(){},update:function(){this.updateTransform()},traverse:function(e,t){},attrKV:function(e,t){if("position"===e||"scale"===e||"origin"===e){if(t){var r=this[e];r||(r=this[e]=[]),r[0]=t[0],r[1]=t[1]}}else this[e]=t},hide:function(){this.ignore=!0,this.__zr&&this.__zr.refresh()},show:function(){this.ignore=!1,this.__zr&&this.__zr.refresh()},attr:function(e,t){if("string"==typeof e)this.attrKV(e,t);else if(x(e))for(var r in e)e.hasOwnProperty(r)&&this.attrKV(r,e[r]);return this.dirty(!1),this},setClipPath:function(e){var t=this.__zr;t&&e.addSelfToZr(t),this.clipPath&&this.clipPath!==e&&this.removeClipPath(),(this.clipPath=e).__zr=t,(e.__clipTarget=this).dirty(!1)},removeClipPath:function(){var e=this.clipPath;e&&(e.__zr&&e.removeSelfFromZr(e.__zr),e.__zr=null,e.__clipTarget=null,this.clipPath=null,this.dirty(!1))},addSelfToZr:function(e){this.__zr=e;var t=this.animators;if(t)for(var r=0;r<t.length;r++)e.animation.addAnimator(t[r]);this.clipPath&&this.clipPath.addSelfToZr(e)},removeSelfFromZr:function(e){this.__zr=null;var t=this.animators;if(t)for(var r=0;r<t.length;r++)e.animation.removeAnimator(t[r]);this.clipPath&&this.clipPath.removeSelfFromZr(e)}},E(Et,St),E(Et,Pe),E(Et,ue);var It,Tt,Rt,Ct,Pt=oe,Mt=Math.min,xt=Math.max;function At(e,t,r,o){r<0&&(e+=r,r=-r),o<0&&(t+=o,o=-o),this.x=e,this.y=t,this.width=r,this.height=o}At.prototype={constructor:At,union:function(e){var t=Mt(e.x,this.x),r=Mt(e.y,this.y);this.width=xt(e.x+e.width,this.x+this.width)-t,this.height=xt(e.y+e.height,this.y+this.height)-r,this.x=t,this.y=r},applyTransform:(It=[],Tt=[],Rt=[],Ct=[],function(e){if(e){It[0]=Rt[0]=this.x,It[1]=Ct[1]=this.y,Tt[0]=Ct[0]=this.x+this.width,Tt[1]=Rt[1]=this.y+this.height,Pt(It,It,e),Pt(Tt,Tt,e),Pt(Rt,Rt,e),Pt(Ct,Ct,e),this.x=Mt(It[0],Tt[0],Rt[0],Ct[0]),this.y=Mt(It[1],Tt[1],Rt[1],Ct[1]);var t=xt(It[0],Tt[0],Rt[0],Ct[0]),r=xt(It[1],Tt[1],Rt[1],Ct[1]);this.width=t-this.x,this.height=r-this.y}}),calculateTransform:function(e){var t=e.width/this.width,r=e.height/this.height,o=ve();return we(o,o,[-this.x,-this.y]),Ee(o,o,[t,r]),we(o,o,[e.x,e.y]),o},intersect:function(e){if(!e)return!1;e instanceof At||(e=At.create(e));var t=this.x,r=this.x+this.width,o=this.y,n=this.y+this.height,i=e.x,a=e.x+e.width,s=e.y,d=e.y+e.height;return!(r<i||a<t||n<s||d<o)},contain:function(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height},clone:function(){return new At(this.x,this.y,this.width,this.height)},copy:function(e){this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height},plain:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}}};var kt=function(e){for(var t in e=e||{},Et.call(this,e),e)e.hasOwnProperty(t)&&(this[t]=e[t]);this._children=[],this.__storage=null,this.__dirty=!0};kt.prototype={constructor:kt,isGroup:!0,type:"group",silent:!(At.create=function(e){return new At(e.x,e.y,e.width,e.height)}),children:function(){return this._children.slice()},childAt:function(e){return this._children[e]},childOfName:function(e){for(var t=this._children,r=0;r<t.length;r++)if(t[r].name===e)return t[r]},childCount:function(){return this._children.length},add:function(e){return e&&e!==this&&e.parent!==this&&(this._children.push(e),this._doAdd(e)),this},addBefore:function(e,t){if(e&&e!==this&&e.parent!==this&&t&&t.parent===this){var r=this._children,o=r.indexOf(t);0<=o&&(r.splice(o,0,e),this._doAdd(e))}return this},_doAdd:function(e){e.parent&&e.parent.remove(e);var t=(e.parent=this).__storage,r=this.__zr;t&&t!==e.__storage&&(t.addToStorage(e),e instanceof kt&&e.addChildrenToStorage(t)),r&&r.refresh()},remove:function(e){var t=this.__zr,r=this.__storage,o=this._children,n=w(o,e);return n<0||(o.splice(n,1),e.parent=null,r&&(r.delFromStorage(e),e instanceof kt&&e.delChildrenFromStorage(r)),t&&t.refresh()),this},removeAll:function(){var e,t,r=this._children,o=this.__storage;for(t=0;t<r.length;t++)e=r[t],o&&(o.delFromStorage(e),e instanceof kt&&e.delChildrenFromStorage(o)),e.parent=null;return r.length=0,this},eachChild:function(e,t){for(var r=this._children,o=0;o<r.length;o++){var n=r[o];e.call(t,n,o)}return this},traverse:function(e,t){for(var r=0;r<this._children.length;r++){var o=this._children[r];e.call(t,o),"group"===o.type&&o.traverse(e,t)}return this},addChildrenToStorage:function(e){for(var t=0;t<this._children.length;t++){var r=this._children[t];e.addToStorage(r),r instanceof kt&&r.addChildrenToStorage(e)}},delChildrenFromStorage:function(e){for(var t=0;t<this._children.length;t++){var r=this._children[t];e.delFromStorage(r),r instanceof kt&&r.delChildrenFromStorage(e)}},dirty:function(){return this.__dirty=!0,this.__zr&&this.__zr.refresh(),this},getBoundingRect:function(e){for(var t=null,r=new At(0,0,0,0),o=e||this._children,n=[],i=0;i<o.length;i++){var a=o[i];if(!a.ignore&&!a.invisible){var s=a.getBoundingRect(),d=a.getLocalTransform(n);d?(r.copy(s),r.applyTransform(d),(t=t||r.clone()).union(r)):(t=t||s.clone()).union(s)}}return t||r}},S(kt,Et);var Ot=32,Ut=7;function Lt(e,t,r,o){var n=t+1;if(n===r)return 1;if(o(e[n++],e[t])<0){for(;n<r&&o(e[n],e[n-1])<0;)n++;!function(e,t,r){r--;for(;t<r;){var o=e[t];e[t++]=e[r],e[r--]=o}}(e,t,n)}else for(;n<r&&0<=o(e[n],e[n-1]);)n++;return n-t}function Dt(e,t,r,o,n){for(o===t&&o++;o<r;o++){for(var i,a=e[o],s=t,d=o;s<d;)n(a,e[i=s+d>>>1])<0?d=i:s=i+1;var l=o-s;switch(l){case 3:e[s+3]=e[s+2];case 2:e[s+2]=e[s+1];case 1:e[s+1]=e[s];break;default:for(;0<l;)e[s+l]=e[s+l-1],l--}e[s]=a}}function Nt(e,t,r,o,n,i){var a=0,s=0,d=1;if(0<i(e,t[r+n])){for(s=o-n;d<s&&0<i(e,t[r+n+d]);)(d=1+((a=d)<<1))<=0&&(d=s);s<d&&(d=s),a+=n,d+=n}else{for(s=n+1;d<s&&i(e,t[r+n-d])<=0;)(d=1+((a=d)<<1))<=0&&(d=s);s<d&&(d=s);var l=a;a=n-d,d=n-l}for(a++;a<d;){var u=a+(d-a>>>1);0<i(e,t[r+u])?a=u+1:d=u}return d}function Bt(e,t,r,o,n,i){var a=0,s=0,d=1;if(i(e,t[r+n])<0){for(s=n+1;d<s&&i(e,t[r+n-d])<0;)(d=1+((a=d)<<1))<=0&&(d=s);s<d&&(d=s);var l=a;a=n-d,d=n-l}else{for(s=o-n;d<s&&0<=i(e,t[r+n+d]);)(d=1+((a=d)<<1))<=0&&(d=s);s<d&&(d=s),a+=n,d+=n}for(a++;a<d;){var u=a+(d-a>>>1);i(e,t[r+u])<0?d=u:a=u+1}return d}function jt(f,m){var a,s,g=Ut,d=0,v=[];function t(e){var t=a[e],r=s[e],o=a[e+1],n=s[e+1];s[e]=r+n,e===d-3&&(a[e+1]=a[e+2],s[e+1]=s[e+2]),d--;var i=Bt(f[o],f,t,r,0,m);t+=i,0!==(r-=i)&&0!==(n=Nt(f[t+r-1],f,o,n,n-1,m))&&(r<=n?function(e,t,r,o){var n=0;for(n=0;n<t;n++)v[n]=f[e+n];var i=0,a=r,s=e;if(f[s++]=f[a++],0==--o){for(n=0;n<t;n++)f[s+n]=v[i+n];return}if(1===t){for(n=0;n<o;n++)f[s+n]=f[a+n];return f[s+o]=v[i]}var d,l,u,c=g;for(;;){l=d=0,u=!1;do{if(m(f[a],v[i])<0){if(f[s++]=f[a++],l++,(d=0)==--o){u=!0;break}}else if(f[s++]=v[i++],d++,l=0,1==--t){u=!0;break}}while((d|l)<c);if(u)break;do{if(0!==(d=Bt(f[a],v,i,t,0,m))){for(n=0;n<d;n++)f[s+n]=v[i+n];if(s+=d,i+=d,(t-=d)<=1){u=!0;break}}if(f[s++]=f[a++],0==--o){u=!0;break}if(0!==(l=Nt(v[i],f,a,o,0,m))){for(n=0;n<l;n++)f[s+n]=f[a+n];if(s+=l,a+=l,0===(o-=l)){u=!0;break}}if(f[s++]=v[i++],1==--t){u=!0;break}c--}while(Ut<=d||Ut<=l);if(u)break;c<0&&(c=0),c+=2}if((g=c)<1&&(g=1),1===t){for(n=0;n<o;n++)f[s+n]=f[a+n];f[s+o]=v[i]}else{if(0===t)throw new Error;for(n=0;n<t;n++)f[s+n]=v[i+n]}}(t,r,o,n):function(e,t,r,o){var n=0;for(n=0;n<o;n++)v[n]=f[r+n];var i=e+t-1,a=o-1,s=r+o-1,d=0,l=0;if(f[s--]=f[i--],0==--t){for(d=s-(o-1),n=0;n<o;n++)f[d+n]=v[n];return}if(1===o){for(l=(s-=t)+1,d=(i-=t)+1,n=t-1;0<=n;n--)f[l+n]=f[d+n];return f[s]=v[a]}var u=g;for(;;){var c=0,p=0,h=!1;do{if(m(v[a],f[i])<0){if(f[s--]=f[i--],c++,(p=0)==--t){h=!0;break}}else if(f[s--]=v[a--],p++,c=0,1==--o){h=!0;break}}while((c|p)<u);if(h)break;do{if(0!==(c=t-Bt(v[a],f,e,t,t-1,m))){for(t-=c,l=(s-=c)+1,d=(i-=c)+1,n=c-1;0<=n;n--)f[l+n]=f[d+n];if(0===t){h=!0;break}}if(f[s--]=v[a--],1==--o){h=!0;break}if(0!==(p=o-Nt(f[i],v,0,o,o-1,m))){for(o-=p,l=(s-=p)+1,d=(a-=p)+1,n=0;n<p;n++)f[l+n]=v[d+n];if(o<=1){h=!0;break}}if(f[s--]=f[i--],0==--t){h=!0;break}u--}while(Ut<=c||Ut<=p);if(h)break;u<0&&(u=0),u+=2}(g=u)<1&&(g=1);if(1===o){for(l=(s-=t)+1,d=(i-=t)+1,n=t-1;0<=n;n--)f[l+n]=f[d+n];f[s]=v[a]}else{if(0===o)throw new Error;for(d=s-(o-1),n=0;n<o;n++)f[d+n]=v[n]}}(t,r,o,n))}a=[],s=[],this.mergeRuns=function(){for(;1<d;){var e=d-2;if(1<=e&&s[e-1]<=s[e]+s[e+1]||2<=e&&s[e-2]<=s[e]+s[e-1])s[e-1]<s[e+1]&&e--;else if(s[e]>s[e+1])break;t(e)}},this.forceMergeRuns=function(){for(;1<d;){var e=d-2;0<e&&s[e-1]<s[e+1]&&e--,t(e)}},this.pushRun=function(e,t){a[d]=e,s[d]=t,d+=1}}function Vt(e,t,r,o){r||(r=0),o||(o=e.length);var n=o-r;if(!(n<2)){var i=0;if(n<Ot)Dt(e,r,o,r+(i=Lt(e,r,o,t)),t);else{var a=new jt(e,t),s=function(e){for(var t=0;Ot<=e;)t|=1&e,e>>=1;return e+t}(n);do{if((i=Lt(e,r,o,t))<s){var d=n;s<d&&(d=s),Dt(e,r,r+d,r+i,t),i=d}a.pushRun(r,i),a.mergeRuns(),n-=i,r+=i}while(0!==n);a.forceMergeRuns()}}}function Ft(e,t){return e.zlevel===t.zlevel?e.z===t.z?e.z2-t.z2:e.z-t.z:e.zlevel-t.zlevel}var qt=function(){this._roots=[],this._displayList=[],this._displayListLen=0};qt.prototype={constructor:qt,_needsUpdateList:!0,traverse:function(e,t){for(var r=0;r<this._roots.length;r++)this._roots[r].traverse(e,t)},getDisplayList:function(e,t){return t=t||!1,e&&this.updateDisplayList(t),this._displayList},updateDisplayList:function(e){this._needsUpdateList&&(this._displayListLen=0);for(var t=this._roots,r=this._displayList,o=0,n=t.length;o<n;o++)this._updateAndAddDisplayable(t[o],null,e);this._needsUpdateList&&(r.length=this._displayListLen),u.canvasSupported&&Vt(r,Ft),this._needsUpdateList=!1},_updateAndAddDisplayable:function(e,t,r){if(!e.ignore||r){e.beforeUpdate(),e.__dirty&&e.update(),e.afterUpdate();var o=e.clipPath;if(o){t=t?t.slice():[];for(var n=o,i=e;n;)n.parent=i,n.updateTransform(),t.push(n),n=(i=n).clipPath}if(e.isGroup){for(var a=e._children,s=0;s<a.length;s++){var d=a[s];e.__dirty&&(d.__dirty=!0),this._updateAndAddDisplayable(d,t,r)}e.__dirty=!1}else e.__clipPaths=t,this._needsUpdateList&&(this._displayList[this._displayListLen++]=e)}},addRoot:function(e){e.__storage!==this&&(e instanceof kt&&e.addChildrenToStorage(this),this.addToStorage(e),this._roots.push(e))},delRoot:function(e){if(null==e){for(var t=0;t<this._roots.length;t++){var r=this._roots[t];r instanceof kt&&r.delChildrenFromStorage(this)}return this._roots=[],this._displayList=[],void(this._displayListLen=0)}if(e instanceof Array){t=0;for(var o=e.length;t<o;t++)this.delRoot(e[t])}else{var n=w(this._roots,e);0<=n&&(this.delFromStorage(e),this._roots.splice(n,1),e instanceof kt&&e.delChildrenFromStorage(this))}},addToStorage:function(e){return e&&(e.__storage=this,e.dirty(!1),this._needsUpdateList=!0),this},delFromStorage:function(e){return e&&(e.__storage=null,this._needsUpdateList=!0),this},dispose:function(){this._renderList=this._roots=null},displayableSortFunc:Ft};var Gt={shadowBlur:1,shadowOffsetX:1,shadowOffsetY:1,textShadowBlur:1,textShadowOffsetX:1,textShadowOffsetY:1,textBoxShadowBlur:1,textBoxShadowOffsetX:1,textBoxShadowOffsetY:1},Ht=function(e,t,r){return Gt.hasOwnProperty(t)?r*e.dpr:r},Wt=[["shadowBlur",0],["shadowOffsetX",0],["shadowOffsetY",0],["shadowColor","#000"],["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]],Yt=function(e,t){this.extendFrom(e,!1),this.host=t};function zt(e,t,r){var o=null==t.x?0:t.x,n=null==t.x2?1:t.x2,i=null==t.y?0:t.y,a=null==t.y2?0:t.y2;return t.global||(o=o*r.width+r.x,n=n*r.width+r.x,i=i*r.height+r.y,a=a*r.height+r.y),e.createLinearGradient(o,i,n,a)}function Kt(e,t,r){var o=r.width,n=r.height,i=Math.min(o,n),a=null==t.x?.5:t.x,s=null==t.y?.5:t.y,d=null==t.r?.5:t.r;return t.global||(a=a*o+r.x,s=s*n+r.y,d*=i),e.createRadialGradient(a,s,0,a,s,d)}Yt.prototype={constructor:Yt,host:null,fill:"#000",stroke:null,opacity:1,lineDash:null,lineDashOffset:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,lineWidth:1,strokeNoScale:!1,text:null,font:null,textFont:null,fontStyle:null,fontWeight:null,fontSize:null,fontFamily:null,textTag:null,textFill:"#000",textStroke:null,textWidth:null,textHeight:null,textStrokeWidth:0,textLineHeight:null,textPosition:"inside",textRect:null,textOffset:null,textAlign:null,textVerticalAlign:null,textDistance:5,textShadowColor:"transparent",textShadowBlur:0,textShadowOffsetX:0,textShadowOffsetY:0,textBoxShadowColor:"transparent",textBoxShadowBlur:0,textBoxShadowOffsetX:0,textBoxShadowOffsetY:0,transformText:!1,textRotation:0,textOrigin:null,textBackgroundColor:null,textBorderColor:null,textBorderWidth:0,textBorderRadius:0,textPadding:null,rich:null,truncate:null,blend:null,bind:function(e,t,r){for(var o=this,n=r&&r.style,i=!n,a=0;a<Wt.length;a++){var s=Wt[a],d=s[0];(i||o[d]!==n[d])&&(e[d]=Ht(e,d,o[d]||s[1]))}if((i||o.fill!==n.fill)&&(e.fillStyle=o.fill),(i||o.stroke!==n.stroke)&&(e.strokeStyle=o.stroke),(i||o.opacity!==n.opacity)&&(e.globalAlpha=null==o.opacity?1:o.opacity),(i||o.blend!==n.blend)&&(e.globalCompositeOperation=o.blend||"source-over"),this.hasStroke()){var l=o.lineWidth;e.lineWidth=l/(this.strokeNoScale&&t&&t.getLineScale?t.getLineScale():1)}},hasFill:function(){var e=this.fill;return null!=e&&"none"!==e},hasStroke:function(){var e=this.stroke;return null!=e&&"none"!==e&&0<this.lineWidth},extendFrom:function(e,t){if(e)for(var r in e)!e.hasOwnProperty(r)||!0!==t&&(!1===t?this.hasOwnProperty(r):null==e[r])||(this[r]=e[r])},set:function(e,t){"string"==typeof e?this[e]=t:this.extendFrom(e,!0)},clone:function(){var e=new this.constructor;return e.extendFrom(this,!0),e},getGradient:function(e,t,r){for(var o=("radial"===t.type?Kt:zt)(e,t,r),n=t.colorStops,i=0;i<n.length;i++)o.addColorStop(n[i].offset,n[i].color);return o}};for(var Xt=Yt.prototype,Jt=0;Jt<Wt.length;Jt++){var Qt=Wt[Jt];Qt[0]in Xt||(Xt[Qt[0]]=Qt[1])}Yt.getGradient=Xt.getGradient;var $t=function(e,t){this.image=e,this.repeat=t,this.type="pattern"};function Zt(){return!1}function er(e,t,r){var o=b(),n=t.getWidth(),i=t.getHeight(),a=o.style;return a.position="absolute",a.left=0,a.top=0,a.width=n+"px",a.height=i+"px",o.width=n*r,o.height=i*r,o.setAttribute("data-zr-dom-id",e),o}var tr=function(e,t,r){var o;r=r||bt,"string"==typeof e?o=er(e,t,r):x(e)&&(e=(o=e).id),this.id=e;var n=(this.dom=o).style;n&&(o.onselectstart=Zt,n["-webkit-user-select"]="none",n["user-select"]="none",n["-webkit-touch-callout"]="none",n["-webkit-tap-highlight-color"]="rgba(0,0,0,0)",n.padding=0,n.margin=0,n["border-width"]=0),this.domBack=null,this.ctxBack=null,this.painter=t,this.config=null,this.clearColor=0,this.motionBlur=!1,this.lastFrameAlpha=.7,this.dpr=r};tr.prototype={constructor:tr,__dirty:!0,__used:!($t.prototype.getCanvasPattern=function(e){return e.createPattern(this.image,this.repeat||"repeat")}),__drawIndex:0,__startIndex:0,__endIndex:0,isIncremental:!1,getElementCount:function(){return this.__endIndex-this.__startIndex},initContext:function(){this.ctx=this.dom.getContext("2d"),this.ctx.dpr=this.dpr},createBackBuffer:function(){var e=this.dpr;this.domBack=er("back-"+this.id,this.painter,e),this.ctxBack=this.domBack.getContext("2d"),1!=e&&this.ctxBack.scale(e,e)},resize:function(e,t){var r=this.dpr,o=this.dom,n=o.style,i=this.domBack;n.width=e+"px",n.height=t+"px",o.width=e*r,o.height=t*r,i&&(i.width=e*r,i.height=t*r,1!=r&&this.ctxBack.scale(r,r))},clear:function(e){var t,r=this.dom,o=this.ctx,n=r.width,i=r.height,a=this.clearColor,s=this.motionBlur&&!e,d=this.lastFrameAlpha,l=this.dpr;(s&&(this.domBack||this.createBackBuffer(),this.ctxBack.globalCompositeOperation="copy",this.ctxBack.drawImage(r,0,0,n/l,i/l)),o.clearRect(0,0,n,i),a)&&(a.colorStops?(t=a.__canvasGradient||Yt.getGradient(o,a,{x:0,y:0,width:n,height:i}),a.__canvasGradient=t):a.image&&(t=$t.prototype.getCanvasPattern.call(a,o)),o.save(),o.fillStyle=t||a,o.fillRect(0,0,n,i),o.restore());if(s){var u=this.domBack;o.save(),o.globalAlpha=d,o.drawImage(u,0,0,n,i),o.restore()}}};var rr="undefined"!=typeof window&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(e){setTimeout(e,16)},or=new De(50);function nr(e){if("string"!=typeof e)return e;var t=or.get(e);return t&&t.image}function ir(e,t,r,o,n){if(e){if("string"!=typeof e)return e;if(t&&t.__zrImageSrc===e||!r)return t;var i=or.get(e),a={hostEl:r,cb:o,cbPayload:n};return i?!sr(t=i.image)&&i.pending.push(a):(!t&&(t=new Image),t.onload=ar,or.put(e,t.__cachedImgObj={image:t,pending:[a]}),t.src=t.__zrImageSrc=e),t}return t}function ar(){var e=this.__cachedImgObj;this.onload=this.__cachedImgObj=null;for(var t=0;t<e.pending.length;t++){var r=e.pending[t],o=r.cb;o&&o(this,r.cbPayload),r.hostEl.dirty()}e.pending.length=0}function sr(e){return e&&e.width&&e.height}var dr={},lr=0,ur=5e3,cr=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g,pr="12px sans-serif",hr={};function fr(e,t){var r=e+":"+(t=t||pr);if(dr[r])return dr[r];for(var o,n,i=(e+"").split("\n"),a=0,s=0,d=i.length;s<d;s++)a=Math.max((o=i[s],n=t,hr.measureText(o,n)).width,a);return ur<lr&&(lr=0,dr={}),lr++,dr[r]=a}function mr(e,t,r,o,n,i,a){return i?(d=o,l=Tr(e,{rich:i,truncate:a,font:t,textAlign:s=r,textPadding:n}),u=l.outerWidth,c=l.outerHeight,p=gr(0,u,s),h=vr(0,c,d),new At(p,h,u,c)):function(e,t,r,o,n,i){var a=Ir(e,t,n,i),s=fr(e,t);n&&(s+=n[1]+n[3]);var d=a.outerHeight,l=gr(0,s,r),u=vr(0,d,o),c=new At(l,u,s,d);return c.lineHeight=a.lineHeight,c}(e,t,r,o,n,a);var s,d,l,u,c,p,h}function gr(e,t,r){return"right"===r?e-=t:"center"===r&&(e-=t/2),e}function vr(e,t,r){return"middle"===r?e-=t/2:"bottom"===r&&(e-=t),e}function yr(e,t,r){var o=t.x,n=t.y,i=t.height,a=t.width,s=i/2,d="left",l="top";switch(e){case"left":o-=r,n+=s,d="right",l="middle";break;case"right":o+=r+a,n+=s,l="middle";break;case"top":o+=a/2,n-=r,d="center",l="bottom";break;case"bottom":o+=a/2,n+=i+r,d="center";break;case"inside":o+=a/2,n+=s,d="center",l="middle";break;case"insideLeft":o+=r,n+=s,l="middle";break;case"insideRight":o+=a-r,n+=s,d="right",l="middle";break;case"insideTop":o+=a/2,n+=r,d="center";break;case"insideBottom":o+=a/2,n+=i-r,d="center",l="bottom";break;case"insideTopLeft":o+=r,n+=r;break;case"insideTopRight":o+=a-r,n+=r,d="right";break;case"insideBottomLeft":o+=r,n+=i-r,l="bottom";break;case"insideBottomRight":o+=a-r,n+=i-r,d="right",l="bottom"}return{x:o,y:n,textAlign:d,textVerticalAlign:l}}function br(e,t,r,o,n){if(!t)return"";var i=(e+"").split("\n");n=_r(t,r,o,n);for(var a=0,s=i.length;a<s;a++)i[a]=wr(i[a],n);return i.join("\n")}function _r(e,t,r,o){(o=g({},o)).font=t;r=O(r,"...");o.maxIterations=O(o.maxIterations,2);var n=o.minChar=O(o.minChar,0);o.cnCharWidth=fr("",t);var i=o.ascCharWidth=fr("a",t);o.placeholder=O(o.placeholder,"");for(var a=e=Math.max(0,e-1),s=0;s<n&&i<=a;s++)a-=i;var d=fr(r);return a<d&&(r="",d=0),a=e-d,o.ellipsis=r,o.ellipsisWidth=d,o.contentWidth=a,o.containerWidth=e,o}function wr(e,t){var r=t.containerWidth,o=t.font,n=t.contentWidth;if(!r)return"";var i=fr(e,o);if(i<=r)return e;for(var a=0;;a++){if(i<=n||a>=t.maxIterations){e+=t.ellipsis;break}var s=0===a?Sr(e,n,t.ascCharWidth,t.cnCharWidth):0<i?Math.floor(e.length*n/i):0;i=fr(e=e.substr(0,s),o)}return""===e&&(e=t.placeholder),e}function Sr(e,t,r,o){for(var n=0,i=0,a=e.length;i<a&&n<t;i++){var s=e.charCodeAt(i);n+=0<=s&&s<=127?r:o}return i}function Er(e){return fr("",e)}function Ir(e,t,r,o){null!=e&&(e+="");var n=Er(t),i=e?e.split("\n"):[],a=i.length*n,s=a;if(r&&(s+=r[0]+r[2]),e&&o){var d=o.outerHeight,l=o.outerWidth;if(null!=d&&d<s)e="",i=[];else if(null!=l)for(var u=_r(l-(r?r[1]+r[3]:0),t,o.ellipsis,{minChar:o.minChar,placeholder:o.placeholder}),c=0,p=i.length;c<p;c++)i[c]=wr(i[c],u)}return{lines:i,height:a,outerHeight:s,lineHeight:n}}function Tr(e,t){var r={lines:[],width:0,height:0};if(null!=e&&(e+=""),!e)return r;for(var o,n=cr.lastIndex=0;null!=(o=cr.exec(e));){var i=o.index;n<i&&Rr(r,e.substring(n,i)),Rr(r,o[2],o[1]),n=cr.lastIndex}n<e.length&&Rr(r,e.substring(n,e.length));var a=r.lines,s=0,d=0,l=[],u=t.textPadding,c=t.truncate,p=c&&c.outerWidth,h=c&&c.outerHeight;u&&(null!=p&&(p-=u[1]+u[3]),null!=h&&(h-=u[0]+u[2]));for(var f=0;f<a.length;f++){for(var m=a[f],g=0,v=0,y=0;y<m.tokens.length;y++){var b=(M=m.tokens[y]).styleName&&t.rich[M.styleName]||{},_=M.textPadding=b.textPadding,w=M.font=b.font||t.font,S=M.textHeight=O(b.textHeight,Er(w));if(_&&(S+=_[0]+_[2]),M.height=S,M.lineHeight=L(b.textLineHeight,t.textLineHeight,S),M.textAlign=b&&b.textAlign||t.textAlign,M.textVerticalAlign=b&&b.textVerticalAlign||"middle",null!=h&&s+M.lineHeight>h)return{lines:[],width:0,height:0};M.textWidth=fr(M.text,w);var E=b.textWidth,I=null==E||"auto"===E;if("string"==typeof E&&"%"===E.charAt(E.length-1))M.percentWidth=E,l.push(M),E=0;else{if(I){E=M.textWidth;var T=b.textBackgroundColor,R=T&&T.image;R&&sr(R=nr(R))&&(E=Math.max(E,R.width*S/R.height))}var C=_?_[1]+_[3]:0;E+=C;var P=null!=p?p-v:null;null!=P&&P<E&&(!I||P<C?(M.text="",M.textWidth=E=0):(M.text=br(M.text,P-C,w,c.ellipsis,{minChar:c.minChar}),M.textWidth=fr(M.text,w),E=M.textWidth+C))}v+=M.width=E,b&&(g=Math.max(g,M.lineHeight))}m.width=v,s+=m.lineHeight=g,d=Math.max(d,v)}r.outerWidth=r.width=O(t.textWidth,d),r.outerHeight=r.height=O(t.textHeight,s),u&&(r.outerWidth+=u[1]+u[3],r.outerHeight+=u[0]+u[2]);for(f=0;f<l.length;f++){var M,x=(M=l[f]).percentWidth;M.width=parseInt(x,10)/100*d}return r}function Rr(e,t,r){for(var o=""===t,n=t.split("\n"),i=e.lines,a=0;a<n.length;a++){var s=n[a],d={styleName:r,text:s,isLineHolder:!s&&!o};if(a)i.push({tokens:[d]});else{var l=(i[i.length-1]||(i[0]={tokens:[]})).tokens,u=l.length;1===u&&l[0].isLineHolder?l[0]=d:(s||!u||o)&&l.push(d)}}}function Cr(e,t){var r,o,n,i,a,s=t.x,d=t.y,l=t.width,u=t.height,c=t.r;l<0&&(s+=l,l=-l),u<0&&(d+=u,u=-u),"number"==typeof c?r=o=n=i=c:c instanceof Array?1===c.length?r=o=n=i=c[0]:2===c.length?(r=n=c[0],o=i=c[1]):3===c.length?(r=c[0],o=i=c[1],n=c[2]):(r=c[0],o=c[1],n=c[2],i=c[3]):r=o=n=i=0,l<r+o&&(r*=l/(a=r+o),o*=l/a),l<n+i&&(n*=l/(a=n+i),i*=l/a),u<o+n&&(o*=u/(a=o+n),n*=u/a),u<r+i&&(r*=u/(a=r+i),i*=u/a),e.moveTo(s+r,d),e.lineTo(s+l-o,d),0!==o&&e.quadraticCurveTo(s+l,d,s+l,d+o),e.lineTo(s+l,d+u-n),0!==n&&e.quadraticCurveTo(s+l,d+u,s+l-n,d+u),e.lineTo(s+i,d+u),0!==i&&e.quadraticCurveTo(s,d+u,s,d+u-i),e.lineTo(s,d+r),0!==r&&e.quadraticCurveTo(s,d,s+r,d)}hr.measureText=function(e,t){var r=_();return r.font=t||pr,r.measureText(e)};var Pr={left:1,right:1,center:1},Mr={top:1,bottom:1,middle:1};function xr(e){return Ar(e),I(e.rich,Ar),e}function Ar(e){if(e){e.font=((o=e).fontSize||o.fontFamily)&&[o.fontStyle,o.fontWeight,(o.fontSize||12)+"px",o.fontFamily||"sans-serif"].join(" ")||o.textFont||o.font;var t=e.textAlign;"middle"===t&&(t="center"),e.textAlign=null==t||Pr[t]?t:"left";var r=e.textVerticalAlign||e.textBaseline;"center"===r&&(r="middle"),e.textVerticalAlign=null==r||Mr[r]?r:"top",e.textPadding&&(e.textPadding=D(e.textPadding))}var o}function kr(e,t,r,o,n){o.rich?function(e,t,r,o,n){var i=e.__textCotentBlock;i&&!e.__dirty||(i=e.__textCotentBlock=Tr(r,o));!function(e,t,r,o,n){var i=r.width,a=r.outerWidth,s=r.outerHeight,d=o.textPadding,l=Br(s,o,n),u=l.baseX,c=l.baseY,p=l.textAlign,h=l.textVerticalAlign;Or(t,o,n,u,c);var f=gr(u,a,p),m=vr(c,s,h),g=f,v=m;d&&(g+=d[3],v+=d[0]);var y=g+i;Lr(o)&&Dr(e,t,o,f,m,a,s);for(var b=0;b<r.lines.length;b++){for(var _,w=r.lines[b],S=w.tokens,E=S.length,I=w.lineHeight,T=w.width,R=0,C=g,P=y,M=E-1;R<E&&(!(_=S[R]).textAlign||"left"===_.textAlign);)Ur(e,t,_,o,I,v,C,"left"),T-=_.width,C+=_.width,R++;for(;0<=M&&"right"===(_=S[M]).textAlign;)Ur(e,t,_,o,I,v,P,"right"),T-=_.width,P-=_.width,M--;for(C+=(i-(C-g)-(y-P)-T)/2;R<=M;)_=S[R],Ur(e,t,_,o,I,v,C+_.width/2,"center"),C+=_.width,R++;v+=I}}(e,t,i,o,n)}(e,t,r,o,n):function(e,t,r,o,n){var i=jr(t,"font",o.font||pr),a=o.textPadding,s=e.__textCotentBlock;s&&!e.__dirty||(s=e.__textCotentBlock=Ir(r,i,a,o.truncate));var d=s.outerHeight,l=s.lines,u=s.lineHeight,c=Br(d,o,n),p=c.baseX,h=c.baseY,f=c.textAlign,m=c.textVerticalAlign;Or(t,o,n,p,h);var g=vr(h,d,m),v=p,y=g,b=Lr(o);if(b||a){var _=fr(r,i),w=_;a&&(w+=a[1]+a[3]);var S=gr(p,w,f);b&&Dr(e,t,o,S,g,w,d),a&&(v=Gr(p,f,a),y+=a[0])}jr(t,"textAlign",f||"left"),jr(t,"textBaseline","middle"),jr(t,"shadowBlur",o.textShadowBlur||0),jr(t,"shadowColor",o.textShadowColor||"transparent"),jr(t,"shadowOffsetX",o.textShadowOffsetX||0),jr(t,"shadowOffsetY",o.textShadowOffsetY||0),y+=u/2;var E=o.textStrokeWidth,I=Vr(o.textStroke,E),T=Fr(o.textFill);I&&(jr(t,"lineWidth",E),jr(t,"strokeStyle",I));T&&jr(t,"fillStyle",T);for(var R=0;R<l.length;R++)I&&t.strokeText(l[R],v,y),T&&t.fillText(l[R],v,y),y+=u}(e,t,r,o,n)}function Or(e,t,r,o,n){if(r&&t.textRotation){var i=t.textOrigin;"center"===i?(o=r.width/2+r.x,n=r.height/2+r.y):i&&(o=i[0]+r.x,n=i[1]+r.y),e.translate(o,n),e.rotate(-t.textRotation),e.translate(-o,-n)}}function Ur(e,t,r,o,n,i,a,s){var d=o.rich[r.styleName]||{},l=r.textVerticalAlign,u=i+n/2;"top"===l?u=i+r.height/2:"bottom"===l&&(u=i+n-r.height/2),!r.isLineHolder&&Lr(d)&&Dr(e,t,d,"right"===s?a-r.width:"center"===s?a-r.width/2:a,u-r.height/2,r.width,r.height);var c=r.textPadding;c&&(a=Gr(a,s,c),u-=r.height/2-c[2]-r.textHeight/2),jr(t,"shadowBlur",L(d.textShadowBlur,o.textShadowBlur,0)),jr(t,"shadowColor",d.textShadowColor||o.textShadowColor||"transparent"),jr(t,"shadowOffsetX",L(d.textShadowOffsetX,o.textShadowOffsetX,0)),jr(t,"shadowOffsetY",L(d.textShadowOffsetY,o.textShadowOffsetY,0)),jr(t,"textAlign",s),jr(t,"textBaseline","middle"),jr(t,"font",r.font||pr);var p=Vr(d.textStroke||o.textStroke,f),h=Fr(d.textFill||o.textFill),f=O(d.textStrokeWidth,o.textStrokeWidth);p&&(jr(t,"lineWidth",f),jr(t,"strokeStyle",p),t.strokeText(r.text,a,u)),h&&(jr(t,"fillStyle",h),t.fillText(r.text,a,u))}function Lr(e){return e.textBackgroundColor||e.textBorderWidth&&e.textBorderColor}function Dr(e,t,r,o,n,i,a){var s=r.textBackgroundColor,d=r.textBorderWidth,l=r.textBorderColor,u=M(s);if(jr(t,"shadowBlur",r.textBoxShadowBlur||0),jr(t,"shadowColor",r.textBoxShadowColor||"transparent"),jr(t,"shadowOffsetX",r.textBoxShadowOffsetX||0),jr(t,"shadowOffsetY",r.textBoxShadowOffsetY||0),u||d&&l){t.beginPath();var c=r.textBorderRadius;c?Cr(t,{x:o,y:n,width:i,height:a,r:c}):t.rect(o,n,i,a),t.closePath()}if(u)jr(t,"fillStyle",s),t.fill();else if(x(s)){var p=s.image;(p=ir(p,null,e,Nr,s))&&sr(p)&&t.drawImage(p,o,n,i,a)}d&&l&&(jr(t,"lineWidth",d),jr(t,"strokeStyle",l),t.stroke())}function Nr(e,t){t.image=e}function Br(e,t,r){var o=t.x||0,n=t.y||0,i=t.textAlign,a=t.textVerticalAlign;if(r){var s=t.textPosition;if(s instanceof Array)o=r.x+qr(s[0],r.width),n=r.y+qr(s[1],r.height);else{var d=yr(s,r,t.textDistance);o=d.x,n=d.y,i=i||d.textAlign,a=a||d.textVerticalAlign}var l=t.textOffset;l&&(o+=l[0],n+=l[1])}return{baseX:o,baseY:n,textAlign:i,textVerticalAlign:a}}function jr(e,t,r){return e[t]=Ht(e,t,r),e[t]}function Vr(e,t){return null==e||t<=0||"transparent"===e||"none"===e?null:e.image||e.colorStops?"#000":e}function Fr(e){return null==e||"none"===e?null:e.image||e.colorStops?"#000":e}function qr(e,t){return"string"==typeof e?0<=e.lastIndexOf("%")?parseFloat(e)/100*t:parseFloat(e):e}function Gr(e,t,r){return"right"===t?e-r[1]:"center"===t?e+r[3]/2-r[1]/2:e+r[3]}function Hr(e,t){return null!=e&&(e||t.textBackgroundColor||t.textBorderWidth&&t.textBorderColor||t.textPadding)}var Wr=new At,Yr=function(){};function zr(e){for(var t in e=e||{},Et.call(this,e),e)e.hasOwnProperty(t)&&"style"!==t&&(this[t]=e[t]);this.style=new Yt(e.style,this),this._rect=null,this.__clipPaths=[]}function Kr(e){zr.call(this,e)}function Xr(e){return parseInt(e,10)}zr.prototype={constructor:zr,type:"displayable",__dirty:!0,invisible:!(Yr.prototype={constructor:Yr,drawRectText:function(e,t){var r=this.style;t=r.textRect||t,this.__dirty&&xr(r);var o=r.text;if(null!=o&&(o+=""),Hr(o,r)){e.save();var n=this.transform;r.transformText?this.setTransform(e):n&&(Wr.copy(t),Wr.applyTransform(n),t=Wr),kr(this,e,o,r,t),e.restore()}}}),z:0,z2:0,zlevel:0,draggable:!1,dragging:!1,silent:!1,culling:!1,cursor:"pointer",rectHover:!1,progressive:!1,isIncremental:!1,beforeBrush:function(e){},afterBrush:function(e){},brush:function(e,t){},getBoundingRect:function(){},contain:function(e,t){return this.rectContain(e,t)},traverse:function(e,t){e.call(t,this)},rectContain:function(e,t){var r=this.transformCoordToLocal(e,t);return this.getBoundingRect().contain(r[0],r[1])},dirty:function(){this.__dirty=!0,this._rect=null,this.__zr&&this.__zr.refresh()},animateStyle:function(e){return this.animate("style",e)},attrKV:function(e,t){"style"!==e?Et.prototype.attrKV.call(this,e,t):this.style.set(t)},setStyle:function(e,t){return this.style.set(e,t),this.dirty(!1),this},useStyle:function(e){return this.style=new Yt(e,this),this.dirty(!1),this}},S(zr,Et),E(zr,Yr),Kr.prototype={constructor:Kr,type:"image",brush:function(e,t){var r=this.style,o=r.image;r.bind(e,this,t);var n=this._image=ir(o,this._image,this,this.onload);if(n&&sr(n)){var i=r.x||0,a=r.y||0,s=r.width,d=r.height,l=n.width/n.height;if(null==s&&null!=d?s=d*l:null==d&&null!=s?d=s/l:null==s&&null==d&&(s=n.width,d=n.height),this.setTransform(e),r.sWidth&&r.sHeight){var u=r.sx||0,c=r.sy||0;e.drawImage(n,u,c,r.sWidth,r.sHeight,i,a,s,d)}else if(r.sx&&r.sy){var p=s-(u=r.sx),h=d-(c=r.sy);e.drawImage(n,u,c,p,h,i,a,s,d)}else e.drawImage(n,i,a,s,d);null!=r.text&&(this.restoreTransform(e),this.drawRectText(e,this.getBoundingRect()))}},getBoundingRect:function(){var e=this.style;return this._rect||(this._rect=new At(e.x||0,e.y||0,e.width||0,e.height||0)),this._rect}},S(Kr,zr);var Jr=new At(0,0,0,0),Qr=new At(0,0,0,0);var $r=function(e,t,r){this.type="canvas";var o=!e.nodeName||"CANVAS"===e.nodeName.toUpperCase();this._opts=r=g({},r||{}),this.dpr=r.devicePixelRatio||bt,this._singleCanvas=o;var n=(this.root=e).style;n&&(n["-webkit-tap-highlight-color"]="transparent",n["-webkit-user-select"]=n["user-select"]=n["-webkit-touch-callout"]="none",e.innerHTML=""),this.storage=t;var i,a,s,d=this._zlevelList=[],l=this._layers={};if(this._layerConfig={},o){null!=r.width&&(e.width=r.width),null!=r.height&&(e.height=r.height);var u=e.width,c=e.height;this._width=u,this._height=c;var p=new tr(e,this,1);p.initContext(),l[0]=p,d.push(0),this._domRoot=e}else{this._width=this._getSize(0),this._height=this._getSize(1);var h=this._domRoot=(i=this._width,a=this._height,(s=document.createElement("div")).style.cssText=["position:relative","overflow:hidden","width:"+i+"px","height:"+a+"px","padding:0","margin:0","border-width:0"].join(";")+";",s);e.appendChild(h)}this._hoverlayer=null,this._hoverElements=[]};$r.prototype={constructor:$r,getType:function(){return"canvas"},isSingleCanvas:function(){return this._singleCanvas},getViewportRoot:function(){return this._domRoot},getViewportRootOffset:function(){var e=this.getViewportRoot();if(e)return{offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}},refresh:function(e){var t=this.storage.getDisplayList(!0),r=this._zlevelList;this._paintList(t,e);for(var o=0;o<r.length;o++){var n=r[o],i=this._layers[n];!i.__builtin__&&i.refresh&&i.refresh()}return this.refreshHover(),this},addHover:function(e,t){if(!e.__hoverMir){var r=new e.constructor({style:e.style,shape:e.shape});((r.__from=e).__hoverMir=r).setStyle(t),this._hoverElements.push(r)}},removeHover:function(e){var t=e.__hoverMir,r=this._hoverElements,o=w(r,t);0<=o&&r.splice(o,1),e.__hoverMir=null},clearHover:function(e){for(var t=this._hoverElements,r=0;r<t.length;r++){var o=t[r].__from;o&&(o.__hoverMir=null)}t.length=0},refreshHover:function(){var e=this._hoverElements,t=e.length,r=this._hoverlayer;if(r&&r.clear(),t){Vt(e,this.storage.displayableSortFunc),r||(r=this._hoverlayer=this.getLayer(1e5));var o={};r.ctx.save();for(var n=0;n<t;){var i=e[n],a=i.__from;a&&a.__zr?(n++,a.invisible||(i.transform=a.transform,i.invTransform=a.invTransform,i.__clipPaths=a.__clipPaths,this._doPaintEl(i,r,!0,o))):(e.splice(n,1),a.__hoverMir=null,t--)}r.ctx.restore()}},getHoverLayer:function(){return this._hoverlayer},_paintList:function(e,t){null==t&&(t=!1),this._updateLayerStatus(e),this._doPaintList(e,t)},_doPaintList:function(e,t){for(var r=[],o=0;o<this._zlevelList.length;o++){var n=this._zlevelList[o];(a=this._layers[n]).__builtin__&&a!==this._hoverlayer&&(a.__dirty||t)&&r.push(a)}for(var i=0;i<r.length;i++){var a,s=(a=r[i]).ctx,d={};if(s.save(),a.__startIndex===a.__drawIndex)if(a.isIncremental){var l=e[a.__drawIndex];l&&l.needsClear()&&a.clear()}else a.clear();for(var u=a.__drawIndex;u<a.__endIndex;u++){var c=e[u];this._doPaintEl(c,a,t,d),c.__dirty=!1}s.restore()}},_doPaintEl:function(e,t,r,o){var n,i,a,s=t.ctx,d=e.transform;if((t.__dirty||r)&&!e.invisible&&0!==e.style.opacity&&(!d||d[0]||d[3])&&(!e.culling||(n=e,i=this._width,a=this._height,Jr.copy(n.getBoundingRect()),n.transform&&Jr.applyTransform(n.transform),Qr.width=i,Qr.height=a,Jr.intersect(Qr)))){var l=e.__clipPaths;(o.prevClipLayer!==t||function(e,t){if(e==t)return!1;if(!e||!t||e.length!==t.length)return!0;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!0}(l,o.prevElClipPaths))&&(o.prevElClipPaths&&(o.prevClipLayer.ctx.restore(),o.prevClipLayer=o.prevElClipPaths=null,o.prevEl=null),l&&(s.save(),function(e,t){for(var r=0;r<e.length;r++){var o=e[r];o.setTransform(t),t.beginPath(),o.buildPath(t,o.shape),t.clip(),o.restoreTransform(t)}}(l,s),o.prevClipLayer=t,o.prevElClipPaths=l)),e.beforeBrush&&e.beforeBrush(s),e.brush(s,o.prevEl||null),(o.prevEl=e).afterBrush&&e.afterBrush(s)}},getLayer:function(e){if(this._singleCanvas)return this._layers[0];var t=this._layers[e];return t||((t=new tr("zr_"+e,this,this.dpr)).__builtin__=!0,this._layerConfig[e]&&m(t,this._layerConfig[e],!0),this.insertLayer(e,t),t.initContext()),t},insertLayer:function(e,t){var r=this._layers,o=this._zlevelList,n=o.length,i=null,a=-1,s=this._domRoot;if(r[e])wt("ZLevel "+e+" has been used already");else if((d=t)&&(d.__builtin__||"function"==typeof d.resize&&"function"==typeof d.refresh)){var d;if(0<n&&e>o[0]){for(a=0;a<n-1&&!(o[a]<e&&o[a+1]>e);a++);i=r[o[a]]}if(o.splice(a+1,0,e),!(r[e]=t).virtual)if(i){var l=i.dom;l.nextSibling?s.insertBefore(t.dom,l.nextSibling):s.appendChild(t.dom)}else s.firstChild?s.insertBefore(t.dom,s.firstChild):s.appendChild(t.dom)}else wt("Layer of zlevel "+e+" is not valid")},eachLayer:function(e,t){var r,o,n=this._zlevelList;for(o=0;o<n.length;o++)r=n[o],e.call(t,this._layers[r],r)},eachBuiltinLayer:function(e,t){var r,o,n,i=this._zlevelList;for(n=0;n<i.length;n++)o=i[n],(r=this._layers[o]).__builtin__&&e.call(t,r,o)},eachOtherLayer:function(e,t){var r,o,n,i=this._zlevelList;for(n=0;n<i.length;n++)o=i[n],(r=this._layers[o]).__builtin__||e.call(t,r,o)},getLayers:function(){return this._layers},_updateLayerStatus:function(e){function t(e){r&&(r.__endIndex!==e&&(r.__dirty=!0),r.__endIndex=e)}this.eachBuiltinLayer(function(e,t){e.__dirty=e.__used=!1});for(var r=null,o=0,n=0;n<e.length;n++){var i,a=e[n],s=this._singleCanvas?0:a.zlevel;a.isIncremental?((i=this.getLayer(s+.001)).isIncremental=!0,o=1):i=this.getLayer(0<s+o?.01:0),i.__builtin__||wt("ZLevel "+s+" has been used by unkown layer "+i.id),i!==r&&(i.__used=!0,i.__startIndex!==n&&(i.__dirty=!0),i.__startIndex=i.__drawIndex=n,t(n),r=i),i.__dirty=i.__dirty||a.__dirty}t(n),this.eachBuiltinLayer(function(e,t){!e.__used&&0<e.getElementCount()&&(e.__dirty=!0,e.__startIndex=e.__endIndex=e.__drawIndex=0)})},clear:function(){return this.eachBuiltinLayer(this._clearLayer),this},_clearLayer:function(e){e.clear()},configLayer:function(e,t){if(t){var r=this._layerConfig;r[e]?m(r[e],t,!0):r[e]=t;var o=this._layers[e];o&&m(o,r[e],!0)}},delLayer:function(e){var t=this._layers,r=this._zlevelList,o=t[e];o&&(o.dom.parentNode.removeChild(o.dom),delete t[e],r.splice(w(r,e),1))},resize:function(t,r){if(this._domRoot.style){var e=this._domRoot;e.style.display="none";var o=this._opts;if(null!=t&&(o.width=t),null!=r&&(o.height=r),t=this._getSize(0),r=this._getSize(1),e.style.display="",this._width!=t||r!=this._height){for(var n in e.style.width=t+"px",e.style.height=r+"px",this._layers)this._layers.hasOwnProperty(n)&&this._layers[n].resize(t,r);I(this._progressiveLayers,function(e){e.resize(t,r)}),this.refresh(!0)}this._width=t,this._height=r}else{if(null==t||null==r)return;this._width=t,this._height=r,this.getLayer(0).resize(t,r)}return this},clearLayer:function(e){var t=this._layers[e];t&&t.clear()},dispose:function(){this.root.innerHTML="",this.root=this.storage=this._domRoot=this._layers=null},getRenderedCanvas:function(e){if(e=e||{},this._singleCanvas)return this._layers[0].dom;var s=new tr("image",this,e.pixelRatio||this.dpr);s.initContext(),s.clearColor=e.backgroundColor,s.clear();var t,r=this.storage.getDisplayList(!0),o={},d=this;function n(e,t){var r,o=d._zlevelList;null==e&&(e=-1/0);for(var n=0;n<o.length;n++){var i=o[n],a=d._layers[i];if(!a.__builtin__&&e<i&&i<t){r=a;break}}r&&r.renderToCanvas&&(s.ctx.save(),r.renderToCanvas(s.ctx),s.ctx.restore())}for(var i=0;i<r.length;i++){var a=r[i];a.zlevel!==t&&(n(t,a.zlevel),t=a.zlevel),this._doPaintEl(a,s,!0,o)}return n(t,1/0),s.dom},getWidth:function(){return this._width},getHeight:function(){return this._height},_getSize:function(e){var t=this._opts,r=["width","height"][e],o=["clientWidth","clientHeight"][e],n=["paddingLeft","paddingTop"][e],i=["paddingRight","paddingBottom"][e];if(null!=t[r]&&"auto"!==t[r])return parseFloat(t[r]);var a=this.root,s=document.defaultView.getComputedStyle(a);return(a[o]||Xr(s[r])||Xr(a.style[r]))-(Xr(s[n])||0)-(Xr(s[i])||0)|0},pathToImage:function(e,t){t=t||this.dpr;var r=document.createElement("canvas"),o=r.getContext("2d"),n=e.getBoundingRect(),i=e.style,a=i.shadowBlur*t,s=i.shadowOffsetX*t,d=i.shadowOffsetY*t,l=i.hasStroke()?i.lineWidth:0,u=Math.max(l/2,-s+a),c=Math.max(l/2,s+a),p=Math.max(l/2,-d+a),h=Math.max(l/2,d+a),f=n.width+u+c,m=n.height+p+h;r.width=f*t,r.height=m*t,o.scale(t,t),o.clearRect(0,0,f,m),o.dpr=t;var g={position:e.position,rotation:e.rotation,scale:e.scale};e.position=[u-n.x,p-n.y],e.rotation=0,e.scale=[1,1],e.updateTransform(),e&&e.brush(o);var v=new Kr({style:{x:0,y:0,image:r}});return null!=g.position&&(v.position=e.position=g.position),null!=g.rotation&&(v.rotation=e.rotation=g.rotation),null!=g.scale&&(v.scale=e.scale=g.scale),v}};var Zr="undefined"!=typeof window&&!!window.addEventListener,eo=/^(?:mouse|pointer|contextmenu|drag|drop)|click/;function to(e,t,r,o){return r=r||{},o||!u.canvasSupported?ro(e,t,r):u.browser.firefox&&null!=t.layerX&&t.layerX!==t.offsetX?(r.zrX=t.layerX,r.zrY=t.layerY):null!=t.offsetX?(r.zrX=t.offsetX,r.zrY=t.offsetY):ro(e,t,r),r}function ro(e,t,r){var o,n=(o=e).getBoundingClientRect?o.getBoundingClientRect():{left:0,top:0};r.zrX=t.clientX-n.left,r.zrY=t.clientY-n.top}function oo(e,t,r){if(null!=(t=t||window.event).zrX)return t;var o=t.type;if(o&&0<=o.indexOf("touch")){var n="touchend"!=o?t.targetTouches[0]:t.changedTouches[0];n&&to(e,n,t,r)}else to(e,t,t,r),t.zrDelta=t.wheelDelta?t.wheelDelta/120:-(t.detail||0)/3;var i=t.button;return null==t.which&&void 0!==i&&eo.test(t.type)&&(t.which=1&i?1:2&i?3:4&i?2:0),t}var no=function(e){e=e||{},this.stage=e.stage||{},this.onframe=e.onframe||function(){},this._clips=[],this._running=!1,this._time,this._pausedTime,this._pauseStart,this._paused=!1,ue.call(this)};no.prototype={constructor:no,addClip:function(e){this._clips.push(e)},addAnimator:function(e){e.animation=this;for(var t=e.getClips(),r=0;r<t.length;r++)this.addClip(t[r])},removeClip:function(e){var t=w(this._clips,e);0<=t&&this._clips.splice(t,1)},removeAnimator:function(e){for(var t=e.getClips(),r=0;r<t.length;r++)this.removeClip(t[r]);e.animation=null},_update:function(){for(var e=(new Date).getTime()-this._pausedTime,t=e-this._time,r=this._clips,o=r.length,n=[],i=[],a=0;a<o;a++){var s=r[a],d=s.step(e,t);d&&(n.push(d),i.push(s))}for(a=0;a<o;)r[a]._needsRemove?(r[a]=r[o-1],r.pop(),o--):a++;o=n.length;for(a=0;a<o;a++)i[a].fire(n[a]);this._time=e,this.onframe(t),this.trigger("frame",t),this.stage.update&&this.stage.update()},_startLoop:function(){var t=this;this._running=!0,rr(function e(){t._running&&(rr(e),!t._paused&&t._update())})},start:function(){this._time=(new Date).getTime(),this._pausedTime=0,this._startLoop()},stop:function(){this._running=!1},pause:function(){this._paused||(this._pauseStart=(new Date).getTime(),this._paused=!0)},resume:function(){this._paused&&(this._pausedTime+=(new Date).getTime()-this._pauseStart,this._paused=!1)},clear:function(){this._clips=[]},animate:function(e,t){var r=new vt(e,(t=t||{}).loop,t.getter,t.setter);return this.addAnimator(r),r}},E(no,ue);var io=function(){this._track=[]};function ao(e){var t=e[1][0]-e[0][0],r=e[1][1]-e[0][1];return Math.sqrt(t*t+r*r)}io.prototype={constructor:io,recognize:function(e,t,r){return this._doTrack(e,t,r),this._recognize(e)},clear:function(){return this._track.length=0,this},_doTrack:function(e,t,r){var o=e.touches;if(o){for(var n={points:[],touches:[],target:t,event:e},i=0,a=o.length;i<a;i++){var s=o[i],d=to(r,s,{});n.points.push([d.zrX,d.zrY]),n.touches.push(s)}this._track.push(n)}},_recognize:function(e){for(var t in so)if(so.hasOwnProperty(t)){var r=so[t](this._track,e);if(r)return r}}};var so={pinch:function(e,t){var r=e.length;if(r){var o,n=(e[r-1]||{}).points,i=(e[r-2]||{}).points||n;if(i&&1<i.length&&n&&1<n.length){var a=ao(n)/ao(i);!isFinite(a)&&(a=1),t.pinchScale=a;var s=[((o=n)[0][0]+o[1][0])/2,(o[0][1]+o[1][1])/2];return t.pinchX=s[0],t.pinchY=s[1],{type:"pinch",target:e[0].target,event:t}}}}},lo=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],uo=["touchstart","touchend","touchmove"],co={pointerdown:1,pointerup:1,pointermove:1,pointerout:1},po=T(lo,function(e){var t=e.replace("mouse","pointer");return co[t]?t:e});function ho(e){return"mousewheel"===e&&u.browser.firefox?"DOMMouseScroll":e}function fo(e,t,r){var o=e._gestureMgr;"start"===r&&o.clear();var n=o.recognize(t,e.handler.findHover(t.zrX,t.zrY,null).target,e.dom);if("end"===r&&o.clear(),n){var i=n.type;t.gestureEvent=i,e.handler.dispatchToElement({target:n.target},i,n.event)}}function mo(e){e._touching=!0,clearTimeout(e._touchTimer),e._touchTimer=setTimeout(function(){e._touching=!1},700)}var go={mousemove:function(e){e=oo(this.dom,e),this.trigger("mousemove",e)},mouseout:function(e){var t=(e=oo(this.dom,e)).toElement||e.relatedTarget;if(t!=this.dom)for(;t&&9!=t.nodeType;){if(t===this.dom)return;t=t.parentNode}this.trigger("mouseout",e)},touchstart:function(e){(e=oo(this.dom,e)).zrByTouch=!0,this._lastTouchMoment=new Date,fo(this,e,"start"),go.mousemove.call(this,e),go.mousedown.call(this,e),mo(this)},touchmove:function(e){(e=oo(this.dom,e)).zrByTouch=!0,fo(this,e,"change"),go.mousemove.call(this,e),mo(this)},touchend:function(e){(e=oo(this.dom,e)).zrByTouch=!0,fo(this,e,"end"),go.mouseup.call(this,e),+new Date-this._lastTouchMoment<300&&go.click.call(this,e),mo(this)},pointerdown:function(e){go.mousedown.call(this,e)},pointermove:function(e){vo(e)||go.mousemove.call(this,e)},pointerup:function(e){go.mouseup.call(this,e)},pointerout:function(e){vo(e)||go.mouseout.call(this,e)}};function vo(e){var t=e.pointerType;return"pen"===t||"touch"===t}function yo(i){var o;function e(e,n){I(e,function(e){var t,r,o;t=i,r=ho(e),o=n._handlers[e],Zr?t.addEventListener(r,o):t.attachEvent("on"+r,o)},n)}ue.call(this),this.dom=i,this._touching=!1,this._touchTimer,this._gestureMgr=new io,this._handlers={},o=this,I(uo,function(e){o._handlers[e]=R(go[e],o)}),I(po,function(e){o._handlers[e]=R(go[e],o)}),I(lo,function(e){var t,r;o._handlers[e]=(t=go[e],r=o,function(){if(!r._touching)return t.apply(r,arguments)})}),u.pointerEventsSupported?e(po,this):(u.touchEventsSupported&&e(uo,this),e(lo,this))}I(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(t){go[t]=function(e){e=oo(this.dom,e),this.trigger(t,e)}});var bo=yo.prototype;bo.dispose=function(){for(var e,t,r,o=lo.concat(uo),n=0;n<o.length;n++){var i=o[n];e=this.dom,t=ho(i),r=this._handlers[i],Zr?e.removeEventListener(t,r):e.detachEvent("on"+t,r)}},bo.setCursor=function(e){this.dom.style.cursor=this.cursor||"default"},E(yo,ue);var _o=!u.canvasSupported,wo={canvas:$r},So={};function Eo(e,t){wo[e]=t}var Io=function(e,t,r){r=r||{},this.dom=t,this.id=e;var o=this,n=new qt,i=r.renderer;if(_o){if(!wo.vml)throw new Error("You need to require 'zrender/vml/vml' to support IE8");i="vml"}else i&&wo[i]||(i="canvas");var a=new wo[i](t,n,r);this.storage=n,this.painter=a;var s=u.node||u.worker?null:new yo(a.getViewportRoot());this.handler=new fe(n,a,s,a.root),this.animation=new no({stage:{update:R(this.flush,this)}}),this.animation.start(),this._needsRefresh;var d=n.delFromStorage,l=n.addToStorage;n.delFromStorage=function(e){d.call(n,e),e&&e.removeSelfFromZr(o)},n.addToStorage=function(e){l.call(n,e),e.addSelfToZr(o)}};Io.prototype={constructor:Io,getId:function(){return this.id},add:function(e){this.storage.addRoot(e),this._needsRefresh=!0},remove:function(e){this.storage.delRoot(e),this._needsRefresh=!0},configLayer:function(e,t){this.painter.configLayer(e,t),this._needsRefresh=!0},refreshImmediately:function(){this._needsRefresh=!1,this.painter.refresh(),this._needsRefresh=!1},refresh:function(){this._needsRefresh=!0},flush:function(){this._needsRefresh&&this.refreshImmediately(),this._needsRefreshHover&&this.refreshHoverImmediately()},addHover:function(e,t){this.painter.addHover&&(this.painter.addHover(e,t),this.refreshHover())},removeHover:function(e){this.painter.removeHover&&(this.painter.removeHover(e),this.refreshHover())},clearHover:function(){this.painter.clearHover&&(this.painter.clearHover(),this.refreshHover())},refreshHover:function(){this._needsRefreshHover=!0},refreshHoverImmediately:function(){this._needsRefreshHover=!1,this.painter.refreshHover&&this.painter.refreshHover()},resize:function(e){e=e||{},this.painter.resize(e.width,e.height),this.handler.resize()},clearAnimation:function(){this.animation.clear()},getWidth:function(){return this.painter.getWidth()},getHeight:function(){return this.painter.getHeight()},pathToImage:function(e,t){return this.painter.pathToImage(e,t)},setCursorStyle:function(e){this.handler.setCursorStyle(e)},findHover:function(e,t){return this.handler.findHover(e,t)},on:function(e,t,r){this.handler.on(e,t,r)},off:function(e,t){this.handler.off(e,t)},trigger:function(e,t){this.handler.trigger(e,t)},clear:function(){this.storage.delRoot(),this.painter.clear()},dispose:function(){var e;this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=this.storage=this.painter=this.handler=null,e=this.id,delete So[e]}};var To=Math.pow,Ro=Math.sqrt,Co=1e-8,Po=1e-4,Mo=Ro(3),xo=1/3,Ao=G(),ko=G(),Oo=G();function Uo(e){return-Co<e&&e<Co}function Lo(e){return Co<e||e<-Co}function Do(e,t,r,o,n){var i=1-n;return i*i*(i*e+3*n*t)+n*n*(n*o+3*i*r)}function No(e,t,r,o,n){var i=1-n;return 3*(((t-e)*i+2*(r-t)*n)*i+(o-r)*n*n)}function Bo(e,t,r,o,n){var i=6*r-12*t+6*e,a=9*t+3*o-3*e-9*r,s=3*t-3*e,d=0;if(Uo(a)){if(Lo(i))0<=(u=-s/i)&&u<=1&&(n[d++]=u)}else{var l=i*i-4*a*s;if(Uo(l))n[0]=-i/(2*a);else if(0<l){var u,c=Ro(l),p=(-i-c)/(2*a);0<=(u=(-i+c)/(2*a))&&u<=1&&(n[d++]=u),0<=p&&p<=1&&(n[d++]=p)}}return d}function jo(e,t,r,o,n,i){var a=(t-e)*n+e,s=(r-t)*n+t,d=(o-r)*n+r,l=(s-a)*n+a,u=(d-s)*n+s,c=(u-l)*n+l;i[0]=e,i[1]=a,i[2]=l,i[3]=c,i[4]=c,i[5]=u,i[6]=d,i[7]=o}function Vo(e,t,r,o){var n=1-o;return n*(n*e+2*o*t)+o*o*r}function Fo(e,t,r,o){return 2*((1-o)*(t-e)+o*(r-t))}function qo(e,t,r){var o=e+r-2*t;return 0===o?.5:(e-t)/o}function Go(e,t,r,o,n){var i=(t-e)*o+e,a=(r-t)*o+t,s=(a-i)*o+i;n[0]=e,n[1]=i,n[2]=s,n[3]=s,n[4]=a,n[5]=r}var Ho=Math.min,Wo=Math.max,Yo=Math.sin,zo=Math.cos,Ko=2*Math.PI,Xo=G(),Jo=G(),Qo=G();function $o(e,t,r,o,n,i){n[0]=Ho(e,r),n[1]=Ho(t,o),i[0]=Wo(e,r),i[1]=Wo(t,o)}var Zo=[],en=[];function tn(e,t,r,o,n,i,a,s,d,l){var u,c=Bo,p=Do,h=c(e,r,n,a,Zo);for(d[0]=1/0,d[1]=1/0,l[0]=-1/0,l[1]=-1/0,u=0;u<h;u++){var f=p(e,r,n,a,Zo[u]);d[0]=Ho(f,d[0]),l[0]=Wo(f,l[0])}for(h=c(t,o,i,s,en),u=0;u<h;u++){var m=p(t,o,i,s,en[u]);d[1]=Ho(m,d[1]),l[1]=Wo(m,l[1])}d[0]=Ho(e,d[0]),l[0]=Wo(e,l[0]),d[0]=Ho(a,d[0]),l[0]=Wo(a,l[0]),d[1]=Ho(t,d[1]),l[1]=Wo(t,l[1]),d[1]=Ho(s,d[1]),l[1]=Wo(s,l[1])}function rn(e,t,r,o,n,i,a,s,d){var l=ne,u=ie,c=Math.abs(n-i);if(c%Ko<1e-4&&1e-4<c)return s[0]=e-r,s[1]=t-o,d[0]=e+r,void(d[1]=t+o);if(Xo[0]=zo(n)*r+e,Xo[1]=Yo(n)*o+t,Jo[0]=zo(i)*r+e,Jo[1]=Yo(i)*o+t,l(s,Xo,Jo),u(d,Xo,Jo),(n%=Ko)<0&&(n+=Ko),(i%=Ko)<0&&(i+=Ko),i<n&&!a?i+=Ko:n<i&&a&&(n+=Ko),a){var p=i;i=n,n=p}for(var h=0;h<i;h+=Math.PI/2)n<h&&(Qo[0]=zo(h)*r+e,Qo[1]=Yo(h)*o+t,l(s,Qo,s),u(d,Qo,d))}var on={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7},nn=[],an=[],sn=[],dn=[],ln=Math.min,un=Math.max,cn=Math.cos,pn=Math.sin,hn=Math.sqrt,fn=Math.abs,mn="undefined"!=typeof Float32Array,gn=function(e){this._saveData=!e,this._saveData&&(this.data=[]),this._ctx=null};function vn(e,t,r,o,n,i,a){if(0===n)return!1;var s=n,d=0;if(t+s<a&&o+s<a||a<t-s&&a<o-s||e+s<i&&r+s<i||i<e-s&&i<r-s)return!1;if(e===r)return Math.abs(i-e)<=s/2;var l=(d=(t-o)/(e-r))*i-a+(e*o-r*t)/(e-r);return l*l/(d*d+1)<=s/2*s/2}function yn(e,t,r,o,n,i,a,s,d,l,u){if(0===d)return!1;var c=d;return!(t+c<u&&o+c<u&&i+c<u&&s+c<u||u<t-c&&u<o-c&&u<i-c&&u<s-c||e+c<l&&r+c<l&&n+c<l&&a+c<l||l<e-c&&l<r-c&&l<n-c&&l<a-c)&&function(e,t,r,o,n,i,a,s,d,l,u){var c,p,h,f,m,g=.005,v=1/0;Ao[0]=d,Ao[1]=l;for(var y=0;y<1;y+=.05)ko[0]=Do(e,r,n,a,y),ko[1]=Do(t,o,i,s,y),(f=re(Ao,ko))<v&&(c=y,v=f);v=1/0;for(var b=0;b<32&&!(g<Po);b++)p=c-g,h=c+g,ko[0]=Do(e,r,n,a,p),ko[1]=Do(t,o,i,s,p),f=re(ko,Ao),0<=p&&f<v?(c=p,v=f):(Oo[0]=Do(e,r,n,a,h),Oo[1]=Do(t,o,i,s,h),m=re(Oo,Ao),h<=1&&m<v?(c=h,v=m):g*=.5);return u&&(u[0]=Do(e,r,n,a,c),u[1]=Do(t,o,i,s,c)),Ro(v)}(e,t,r,o,n,i,a,s,l,u,null)<=c/2}function bn(e,t,r,o,n,i,a,s,d){if(0===a)return!1;var l=a;return!(t+l<d&&o+l<d&&i+l<d||d<t-l&&d<o-l&&d<i-l||e+l<s&&r+l<s&&n+l<s||s<e-l&&s<r-l&&s<n-l)&&function(e,t,r,o,n,i,a,s,d){var l,u=.005,c=1/0;Ao[0]=a,Ao[1]=s;for(var p=0;p<1;p+=.05)ko[0]=Vo(e,r,n,p),ko[1]=Vo(t,o,i,p),(g=re(Ao,ko))<c&&(l=p,c=g);c=1/0;for(var h=0;h<32&&!(u<Po);h++){var f=l-u,m=l+u;ko[0]=Vo(e,r,n,f),ko[1]=Vo(t,o,i,f);var g=re(ko,Ao);if(0<=f&&g<c)l=f,c=g;else{Oo[0]=Vo(e,r,n,m),Oo[1]=Vo(t,o,i,m);var v=re(Oo,Ao);m<=1&&v<c?(l=m,c=v):u*=.5}}return d&&(d[0]=Vo(e,r,n,l),d[1]=Vo(t,o,i,l)),Ro(c)}(e,t,r,o,n,i,s,d,null)<=l/2}gn.prototype={constructor:gn,_xi:0,_yi:0,_x0:0,_y0:0,_ux:0,_uy:0,_len:0,_lineDash:null,_dashOffset:0,_dashIdx:0,_dashSum:0,setScale:function(e,t){this._ux=fn(1/bt/e)||0,this._uy=fn(1/bt/t)||0},getContext:function(){return this._ctx},beginPath:function(e){return(this._ctx=e)&&e.beginPath(),e&&(this.dpr=e.dpr),this._saveData&&(this._len=0),this._lineDash&&(this._lineDash=null,this._dashOffset=0),this},moveTo:function(e,t){return this.addData(on.M,e,t),this._ctx&&this._ctx.moveTo(e,t),this._x0=e,this._y0=t,this._xi=e,this._yi=t,this},lineTo:function(e,t){var r=fn(e-this._xi)>this._ux||fn(t-this._yi)>this._uy||this._len<5;return this.addData(on.L,e,t),this._ctx&&r&&(this._needsDash()?this._dashedLineTo(e,t):this._ctx.lineTo(e,t)),r&&(this._xi=e,this._yi=t),this},bezierCurveTo:function(e,t,r,o,n,i){return this.addData(on.C,e,t,r,o,n,i),this._ctx&&(this._needsDash()?this._dashedBezierTo(e,t,r,o,n,i):this._ctx.bezierCurveTo(e,t,r,o,n,i)),this._xi=n,this._yi=i,this},quadraticCurveTo:function(e,t,r,o){return this.addData(on.Q,e,t,r,o),this._ctx&&(this._needsDash()?this._dashedQuadraticTo(e,t,r,o):this._ctx.quadraticCurveTo(e,t,r,o)),this._xi=r,this._yi=o,this},arc:function(e,t,r,o,n,i){return this.addData(on.A,e,t,r,r,o,n-o,0,i?0:1),this._ctx&&this._ctx.arc(e,t,r,o,n,i),this._xi=cn(n)*r+e,this._yi=pn(n)*r+e,this},arcTo:function(e,t,r,o,n){return this._ctx&&this._ctx.arcTo(e,t,r,o,n),this},rect:function(e,t,r,o){return this._ctx&&this._ctx.rect(e,t,r,o),this.addData(on.R,e,t,r,o),this},closePath:function(){this.addData(on.Z);var e=this._ctx,t=this._x0,r=this._y0;return e&&(this._needsDash()&&this._dashedLineTo(t,r),e.closePath()),this._xi=t,this._yi=r,this},fill:function(e){e&&e.fill(),this.toStatic()},stroke:function(e){e&&e.stroke(),this.toStatic()},setLineDash:function(e){if(e instanceof Array){this._lineDash=e;for(var t=this._dashIdx=0,r=0;r<e.length;r++)t+=e[r];this._dashSum=t}return this},setLineDashOffset:function(e){return this._dashOffset=e,this},len:function(){return this._len},setData:function(e){var t=e.length;this.data&&this.data.length==t||!mn||(this.data=new Float32Array(t));for(var r=0;r<t;r++)this.data[r]=e[r];this._len=t},appendPath:function(e){e instanceof Array||(e=[e]);for(var t=e.length,r=0,o=this._len,n=0;n<t;n++)r+=e[n].len();mn&&this.data instanceof Float32Array&&(this.data=new Float32Array(o+r));for(n=0;n<t;n++)for(var i=e[n].data,a=0;a<i.length;a++)this.data[o++]=i[a];this._len=o},addData:function(e){if(this._saveData){var t=this.data;this._len+arguments.length>t.length&&(this._expandData(),t=this.data);for(var r=0;r<arguments.length;r++)t[this._len++]=arguments[r];this._prevCmd=e}},_expandData:function(){if(!(this.data instanceof Array)){for(var e=[],t=0;t<this._len;t++)e[t]=this.data[t];this.data=e}},_needsDash:function(){return this._lineDash},_dashedLineTo:function(e,t){var r,o,n=this._dashSum,i=this._dashOffset,a=this._lineDash,s=this._ctx,d=this._xi,l=this._yi,u=e-d,c=t-l,p=hn(u*u+c*c),h=d,f=l,m=a.length;for(i<0&&(i=n+i),h-=(i%=n)*(u/=p),f-=i*(c/=p);0<u&&h<=e||u<0&&e<=h||0==u&&(0<c&&f<=t||c<0&&t<=f);)h+=u*(r=a[o=this._dashIdx]),f+=c*r,this._dashIdx=(o+1)%m,0<u&&h<d||u<0&&d<h||0<c&&f<l||c<0&&l<f||s[o%2?"moveTo":"lineTo"](0<=u?ln(h,e):un(h,e),0<=c?ln(f,t):un(f,t));u=h-e,c=f-t,this._dashOffset=-hn(u*u+c*c)},_dashedBezierTo:function(e,t,r,o,n,i){var a,s,d,l,u,c=this._dashSum,p=this._dashOffset,h=this._lineDash,f=this._ctx,m=this._xi,g=this._yi,v=Do,y=0,b=this._dashIdx,_=h.length,w=0;for(p<0&&(p=c+p),p%=c,a=0;a<1;a+=.1)s=v(m,e,r,n,a+.1)-v(m,e,r,n,a),d=v(g,t,o,i,a+.1)-v(g,t,o,i,a),y+=hn(s*s+d*d);for(;b<_&&!(p<(w+=h[b]));b++);for(a=(w-p)/y;a<=1;)l=v(m,e,r,n,a),u=v(g,t,o,i,a),b%2?f.moveTo(l,u):f.lineTo(l,u),a+=h[b]/y,b=(b+1)%_;b%2!=0&&f.lineTo(n,i),s=n-l,d=i-u,this._dashOffset=-hn(s*s+d*d)},_dashedQuadraticTo:function(e,t,r,o){var n=r,i=o;r=(r+2*e)/3,o=(o+2*t)/3,e=(this._xi+2*e)/3,t=(this._yi+2*t)/3,this._dashedBezierTo(e,t,r,o,n,i)},toStatic:function(){var e=this.data;e instanceof Array&&(e.length=this._len,mn&&(this.data=new Float32Array(e)))},getBoundingRect:function(){nn[0]=nn[1]=sn[0]=sn[1]=Number.MAX_VALUE,an[0]=an[1]=dn[0]=dn[1]=-Number.MAX_VALUE;for(var e,t,r,o,n,i,a,s,d,l,u,c,p,h,f=this.data,m=0,g=0,v=0,y=0,b=0;b<f.length;){var _=f[b++];switch(1==b&&(v=m=f[b],y=g=f[b+1]),_){case on.M:m=v=f[b++],g=y=f[b++],sn[0]=v,sn[1]=y,dn[0]=v,dn[1]=y;break;case on.L:$o(m,g,f[b],f[b+1],sn,dn),m=f[b++],g=f[b++];break;case on.C:tn(m,g,f[b++],f[b++],f[b++],f[b++],f[b],f[b+1],sn,dn),m=f[b++],g=f[b++];break;case on.Q:e=m,t=g,r=f[b++],o=f[b++],n=f[b],i=f[b+1],a=sn,s=dn,l=d=void 0,l=Vo,u=Wo(Ho((d=qo)(e,r,n),1),0),c=Wo(Ho(d(t,o,i),1),0),p=l(e,r,n,u),h=l(t,o,i,c),a[0]=Ho(e,n,p),a[1]=Ho(t,i,h),s[0]=Wo(e,n,p),s[1]=Wo(t,i,h),m=f[b++],g=f[b++];break;case on.A:var w=f[b++],S=f[b++],E=f[b++],I=f[b++],T=f[b++],R=f[b++]+T,C=(f[b++],1-f[b++]);1==b&&(v=cn(T)*E+w,y=pn(T)*I+S),rn(w,S,E,I,T,R,C,sn,dn),m=cn(R)*E+w,g=pn(R)*I+S;break;case on.R:$o(v=m=f[b++],y=g=f[b++],v+f[b++],y+f[b++],sn,dn);break;case on.Z:m=v,g=y}ne(nn,nn,sn),ie(an,an,dn)}return 0===b&&(nn[0]=nn[1]=an[0]=an[1]=0),new At(nn[0],nn[1],an[0]-nn[0],an[1]-nn[1])},rebuildPath:function(e){for(var t,r,o,n,i,a,s=this.data,d=this._ux,l=this._uy,u=this._len,c=0;c<u;){var p=s[c++];switch(1==c&&(t=o=s[c],r=n=s[c+1]),p){case on.M:t=o=s[c++],r=n=s[c++],e.moveTo(o,n);break;case on.L:i=s[c++],a=s[c++],(fn(i-o)>d||fn(a-n)>l||c===u-1)&&(e.lineTo(i,a),o=i,n=a);break;case on.C:e.bezierCurveTo(s[c++],s[c++],s[c++],s[c++],s[c++],s[c++]),o=s[c-2],n=s[c-1];break;case on.Q:e.quadraticCurveTo(s[c++],s[c++],s[c++],s[c++]),o=s[c-2],n=s[c-1];break;case on.A:var h=s[c++],f=s[c++],m=s[c++],g=s[c++],v=s[c++],y=s[c++],b=s[c++],_=s[c++],w=g<m?m:g,S=g<m?1:m/g,E=g<m?g/m:1,I=v+y;.001<Math.abs(m-g)?(e.translate(h,f),e.rotate(b),e.scale(S,E),e.arc(0,0,w,v,I,1-_),e.scale(1/S,1/E),e.rotate(-b),e.translate(-h,-f)):e.arc(h,f,w,v,I,1-_),1==c&&(t=cn(v)*m+h,r=pn(v)*g+f),o=cn(I)*m+h,n=pn(I)*g+f;break;case on.R:t=o=s[c],r=n=s[c+1],e.rect(s[c++],s[c++],s[c++],s[c++]);break;case on.Z:e.closePath(),o=t,n=r}}}},gn.CMD=on;var _n=2*Math.PI;function wn(e){return(e%=_n)<0&&(e+=_n),e}var Sn=2*Math.PI;function En(e,t,r,o,n,i,a,s,d){if(0===a)return!1;var l=a;s-=e,d-=t;var u=Math.sqrt(s*s+d*d);if(r<u-l||u+l<r)return!1;if(Math.abs(o-n)%Sn<1e-4)return!0;if(i){var c=o;o=wn(n),n=wn(c)}else o=wn(o),n=wn(n);n<o&&(n+=Sn);var p=Math.atan2(d,s);return p<0&&(p+=Sn),o<=p&&p<=n||o<=p+Sn&&p+Sn<=n}function In(e,t,r,o,n,i){if(t<i&&o<i||i<t&&i<o)return 0;if(o===t)return 0;var a=o<t?1:-1,s=(i-t)/(o-t);return 1!==s&&0!==s||(a=o<t?.5:-.5),n<s*(r-e)+e?a:0}var Tn=gn.CMD,Rn=2*Math.PI,Cn=1e-4;var Pn=[-1,-1,-1],Mn=[-1,-1];function xn(e,t,r,o,n,i,a,s,d,l){if(t<l&&o<l&&i<l&&s<l||l<t&&l<o&&l<i&&l<s)return 0;var u,c=function(e,t,r,o,n,i){var a=o+3*(t-r)-e,s=3*(r-2*t+e),d=3*(t-e),l=e-n,u=s*s-3*a*d,c=s*d-9*a*l,p=d*d-3*s*l,h=0;if(Uo(u)&&Uo(c))Uo(s)?i[0]=0:0<=(I=-d/s)&&I<=1&&(i[h++]=I);else{var f=c*c-4*u*p;if(Uo(f)){var m=c/u,g=-m/2;0<=(I=-s/a+m)&&I<=1&&(i[h++]=I),0<=g&&g<=1&&(i[h++]=g)}else if(0<f){var v=Ro(f),y=u*s+1.5*a*(-c+v),b=u*s+1.5*a*(-c-v);0<=(I=(-s-((y=y<0?-To(-y,xo):To(y,xo))+(b=b<0?-To(-b,xo):To(b,xo))))/(3*a))&&I<=1&&(i[h++]=I)}else{var _=(2*u*s-3*a*c)/(2*Ro(u*u*u)),w=Math.acos(_)/3,S=Ro(u),E=Math.cos(w),I=(-s-2*S*E)/(3*a),T=(g=(-s+S*(E+Mo*Math.sin(w)))/(3*a),(-s+S*(E-Mo*Math.sin(w)))/(3*a));0<=I&&I<=1&&(i[h++]=I),0<=g&&g<=1&&(i[h++]=g),0<=T&&T<=1&&(i[h++]=T)}}return h}(t,o,i,s,l,Pn);if(0===c)return 0;for(var p,h,f=0,m=-1,g=0;g<c;g++){var v=Pn[g],y=0===v||1===v?.5:1;Do(e,r,n,a,v)<d||(m<0&&(m=Bo(t,o,i,s,Mn),Mn[1]<Mn[0]&&1<m&&(void 0,u=Mn[0],Mn[0]=Mn[1],Mn[1]=u),p=Do(t,o,i,s,Mn[0]),1<m&&(h=Do(t,o,i,s,Mn[1]))),2==m?v<Mn[0]?f+=p<t?y:-y:v<Mn[1]?f+=h<p?y:-y:f+=s<h?y:-y:v<Mn[0]?f+=p<t?y:-y:f+=s<p?y:-y)}return f}function An(e,t,r,o,n,i,a,s){if(t<s&&o<s&&i<s||s<t&&s<o&&s<i)return 0;var d=function(e,t,r,o,n){var i=e-2*t+r,a=2*(t-e),s=e-o,d=0;if(Uo(i))Lo(a)&&0<=(u=-s/a)&&u<=1&&(n[d++]=u);else{var l=a*a-4*i*s;if(Uo(l))0<=(u=-a/(2*i))&&u<=1&&(n[d++]=u);else if(0<l){var u,c=Ro(l),p=(-a-c)/(2*i);0<=(u=(-a+c)/(2*i))&&u<=1&&(n[d++]=u),0<=p&&p<=1&&(n[d++]=p)}}return d}(t,o,i,s,Pn);if(0===d)return 0;var l=qo(t,o,i);if(0<=l&&l<=1){for(var u=0,c=Vo(t,o,i,l),p=0;p<d;p++){var h=0===Pn[p]||1===Pn[p]?.5:1;Vo(e,r,n,Pn[p])<a||(Pn[p]<l?u+=c<t?h:-h:u+=i<c?h:-h)}return u}h=0===Pn[0]||1===Pn[0]?.5:1;return Vo(e,r,n,Pn[0])<a?0:i<t?h:-h}function kn(e,t,r,o,n,i,a,s){if(r<(s-=t)||s<-r)return 0;var d=Math.sqrt(r*r-s*s);Pn[0]=-d,Pn[1]=d;var l=Math.abs(o-n);if(l<1e-4)return 0;if(l%Rn<1e-4){n=Rn;var u=i?1:-1;return a>=Pn[o=0]+e&&a<=Pn[1]+e?u:0}if(i){d=o;o=wn(n),n=wn(d)}else o=wn(o),n=wn(n);n<o&&(n+=Rn);for(var c=0,p=0;p<2;p++){var h=Pn[p];if(a<h+e){var f=Math.atan2(s,h);u=i?1:-1;f<0&&(f=Rn+f),(o<=f&&f<=n||o<=f+Rn&&f+Rn<=n)&&(f>Math.PI/2&&f<1.5*Math.PI&&(u=-u),c+=u)}}return c}function On(e,t,r,o,n){for(var i,a,s=0,d=0,l=0,u=0,c=0,p=0;p<e.length;){var h=e[p++];switch(h===Tn.M&&1<p&&(r||(s+=In(d,l,u,c,o,n))),1==p&&(u=d=e[p],c=l=e[p+1]),h){case Tn.M:d=u=e[p++],l=c=e[p++];break;case Tn.L:if(r){if(vn(d,l,e[p],e[p+1],t,o,n))return!0}else s+=In(d,l,e[p],e[p+1],o,n)||0;d=e[p++],l=e[p++];break;case Tn.C:if(r){if(yn(d,l,e[p++],e[p++],e[p++],e[p++],e[p],e[p+1],t,o,n))return!0}else s+=xn(d,l,e[p++],e[p++],e[p++],e[p++],e[p],e[p+1],o,n)||0;d=e[p++],l=e[p++];break;case Tn.Q:if(r){if(bn(d,l,e[p++],e[p++],e[p],e[p+1],t,o,n))return!0}else s+=An(d,l,e[p++],e[p++],e[p],e[p+1],o,n)||0;d=e[p++],l=e[p++];break;case Tn.A:var f=e[p++],m=e[p++],g=e[p++],v=e[p++],y=e[p++],b=e[p++],_=(e[p++],1-e[p++]),w=Math.cos(y)*g+f,S=Math.sin(y)*v+m;1<p?s+=In(d,l,w,S,o,n):(u=w,c=S);var E=(o-f)*v/g+f;if(r){if(En(f,m,v,y,y+b,_,t,E,n))return!0}else s+=kn(f,m,v,y,y+b,_,E,n);d=Math.cos(y+b)*g+f,l=Math.sin(y+b)*v+m;break;case Tn.R:u=d=e[p++],c=l=e[p++];w=u+e[p++],S=c+e[p++];if(r){if(vn(u,c,w,c,t,o,n)||vn(w,c,w,S,t,o,n)||vn(w,S,u,S,t,o,n)||vn(u,S,u,c,t,o,n))return!0}else s+=In(w,c,w,S,o,n),s+=In(u,S,u,c,o,n);break;case Tn.Z:if(r){if(vn(d,l,u,c,t,o,n))return!0}else s+=In(d,l,u,c,o,n);d=u,l=c}}return r||(i=l,a=c,Math.abs(i-a)<Cn)||(s+=In(d,l,u,c,o,n)||0),0!==s}var Un=$t.prototype.getCanvasPattern,Ln=Math.abs,Dn=new gn(!0);function Nn(e){zr.call(this,e),this.path=null}Nn.prototype={constructor:Nn,type:"path",__dirtyPath:!0,strokeContainThreshold:5,brush:function(e,t){var r,o=this.style,n=this.path||Dn,i=o.hasStroke(),a=o.hasFill(),s=o.fill,d=o.stroke,l=a&&!!s.colorStops,u=i&&!!d.colorStops,c=a&&!!s.image,p=i&&!!d.image;(o.bind(e,this,t),this.setTransform(e),this.__dirty)&&(l&&(r=r||this.getBoundingRect(),this._fillGradient=o.getGradient(e,s,r)),u&&(r=r||this.getBoundingRect(),this._strokeGradient=o.getGradient(e,d,r)));l?e.fillStyle=this._fillGradient:c&&(e.fillStyle=Un.call(s,e)),u?e.strokeStyle=this._strokeGradient:p&&(e.strokeStyle=Un.call(d,e));var h=o.lineDash,f=o.lineDashOffset,m=!!e.setLineDash,g=this.getGlobalScale();n.setScale(g[0],g[1]),this.__dirtyPath||h&&!m&&i?(n.beginPath(e),h&&!m&&(n.setLineDash(h),n.setLineDashOffset(f)),this.buildPath(n,this.shape,!1),this.path&&(this.__dirtyPath=!1)):(e.beginPath(),this.path.rebuildPath(e)),a&&n.fill(e),h&&m&&(e.setLineDash(h),e.lineDashOffset=f),i&&n.stroke(e),h&&m&&e.setLineDash([]),null!=o.text&&(this.restoreTransform(e),this.drawRectText(e,this.getBoundingRect()))},buildPath:function(e,t,r){},createPathProxy:function(){this.path=new gn},getBoundingRect:function(){var e=this._rect,t=this.style,r=!e;if(r){var o=this.path;o||(o=this.path=new gn),this.__dirtyPath&&(o.beginPath(),this.buildPath(o,this.shape,!1)),e=o.getBoundingRect()}if(this._rect=e,t.hasStroke()){var n=this._rectWithStroke||(this._rectWithStroke=e.clone());if(this.__dirty||r){n.copy(e);var i=t.lineWidth,a=t.strokeNoScale?this.getLineScale():1;t.hasFill()||(i=Math.max(i,this.strokeContainThreshold||4)),1e-10<a&&(n.width+=i/a,n.height+=i/a,n.x-=i/a/2,n.y-=i/a/2)}return n}return e},contain:function(e,t){var r=this.transformCoordToLocal(e,t),o=this.getBoundingRect(),n=this.style;if(e=r[0],t=r[1],o.contain(e,t)){var i=this.path.data;if(n.hasStroke()){var a=n.lineWidth,s=n.strokeNoScale?this.getLineScale():1;if(1e-10<s&&(n.hasFill()||(a=Math.max(a,this.strokeContainThreshold)),On(i,a/s,!0,e,t)))return!0}if(n.hasFill())return On(i,0,!1,e,t)}return!1},dirty:function(e){null==e&&(e=!0),e&&(this.__dirtyPath=e,this._rect=null),this.__dirty=!0,this.__zr&&this.__zr.refresh(),this.__clipTarget&&this.__clipTarget.dirty()},animateShape:function(e){return this.animate("shape",e)},attrKV:function(e,t){"shape"===e?(this.setShape(t),this.__dirtyPath=!0,this._rect=null):zr.prototype.attrKV.call(this,e,t)},setShape:function(e,t){var r=this.shape;if(r){if(x(e))for(var o in e)e.hasOwnProperty(o)&&(r[o]=e[o]);else r[e]=t;this.dirty(!0)}return this},getLineScale:function(){var e=this.transform;return e&&1e-10<Ln(e[0]-1)&&1e-10<Ln(e[3]-1)?Math.sqrt(Ln(e[0]*e[3]-e[2]*e[1])):1}},Nn.extend=function(n){var e=function(e){Nn.call(this,e),n.style&&this.style.extendFrom(n.style,!1);var t=n.shape;if(t){this.shape=this.shape||{};var r=this.shape;for(var o in t)!r.hasOwnProperty(o)&&t.hasOwnProperty(o)&&(r[o]=t[o])}n.init&&n.init.call(this,e)};for(var t in S(e,Nn),n)"style"!==t&&"shape"!==t&&(e.prototype[t]=n[t]);return e},S(Nn,zr);var Bn=gn.CMD,jn=[[],[],[]],Vn=Math.sqrt,Fn=Math.atan2,qn=function(e,t){var r,o,n,i,a,s=e.data,d=Bn.M,l=Bn.C,u=Bn.L,c=Bn.R,p=Bn.A,h=Bn.Q;for(i=n=0;n<s.length;){switch(r=s[n++],i=n,o=0,r){case d:case u:o=1;break;case l:o=3;break;case h:o=2;break;case p:var f=t[4],m=t[5],g=Vn(t[0]*t[0]+t[1]*t[1]),v=Vn(t[2]*t[2]+t[3]*t[3]),y=Fn(-t[1]/v,t[0]/g);s[n]*=g,s[n++]+=f,s[n]*=v,s[n++]+=m,s[n++]*=g,s[n++]*=v,s[n++]+=y,s[n++]+=y,i=n+=2;break;case c:b[0]=s[n++],b[1]=s[n++],oe(b,b,t),s[i++]=b[0],s[i++]=b[1],b[0]+=s[n++],b[1]+=s[n++],oe(b,b,t),s[i++]=b[0],s[i++]=b[1]}for(a=0;a<o;a++){var b;(b=jn[a])[0]=s[n++],b[1]=s[n++],oe(b,b,t),s[i++]=b[0],s[i++]=b[1]}}},Gn=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"],Hn=Math.sqrt,Wn=Math.sin,Yn=Math.cos,zn=Math.PI,Kn=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])},Xn=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(Kn(e)*Kn(t))},Jn=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(Xn(e,t))};function Qn(e,t,r,o,n,i,a,s,d,l,u){var c=d*(zn/180),p=Yn(c)*(e-r)/2+Wn(c)*(t-o)/2,h=-1*Wn(c)*(e-r)/2+Yn(c)*(t-o)/2,f=p*p/(a*a)+h*h/(s*s);1<f&&(a*=Hn(f),s*=Hn(f));var m=(n===i?-1:1)*Hn((a*a*(s*s)-a*a*(h*h)-s*s*(p*p))/(a*a*(h*h)+s*s*(p*p)))||0,g=m*a*h/s,v=m*-s*p/a,y=(e+r)/2+Yn(c)*g-Wn(c)*v,b=(t+o)/2+Wn(c)*g+Yn(c)*v,_=Jn([1,0],[(p-g)/a,(h-v)/s]),w=[(p-g)/a,(h-v)/s],S=[(-1*p-g)/a,(-1*h-v)/s],E=Jn(w,S);Xn(w,S)<=-1&&(E=zn),1<=Xn(w,S)&&(E=0),0===i&&0<E&&(E-=2*zn),1===i&&E<0&&(E+=2*zn),u.addData(l,y,b,a,s,_,E,c,i)}function $n(e,t){var r=function(e){if(!e)return[];var t,r=e.replace(/-/g," -").replace(/  /g," ").replace(/ /g,",").replace(/,,/g,",");for(t=0;t<Gn.length;t++)r=r.replace(new RegExp(Gn[t],"g"),"|"+Gn[t]);var o,n=r.split("|"),i=0,a=0,s=new gn,d=gn.CMD;for(t=1;t<n.length;t++){var l,u=n[t],c=u.charAt(0),p=0,h=u.slice(1).replace(/e,-/g,"e-").split(",");0<h.length&&""===h[0]&&h.shift();for(var f=0;f<h.length;f++)h[f]=parseFloat(h[f]);for(;p<h.length&&!isNaN(h[p])&&!isNaN(h[0]);){var m,g,v,y,b,_,w,S=i,E=a;switch(c){case"l":i+=h[p++],a+=h[p++],l=d.L,s.addData(l,i,a);break;case"L":i=h[p++],a=h[p++],l=d.L,s.addData(l,i,a);break;case"m":i+=h[p++],a+=h[p++],l=d.M,s.addData(l,i,a),c="l";break;case"M":i=h[p++],a=h[p++],l=d.M,s.addData(l,i,a),c="L";break;case"h":i+=h[p++],l=d.L,s.addData(l,i,a);break;case"H":i=h[p++],l=d.L,s.addData(l,i,a);break;case"v":a+=h[p++],l=d.L,s.addData(l,i,a);break;case"V":a=h[p++],l=d.L,s.addData(l,i,a);break;case"C":l=d.C,s.addData(l,h[p++],h[p++],h[p++],h[p++],h[p++],h[p++]),i=h[p-2],a=h[p-1];break;case"c":l=d.C,s.addData(l,h[p++]+i,h[p++]+a,h[p++]+i,h[p++]+a,h[p++]+i,h[p++]+a),i+=h[p-2],a+=h[p-1];break;case"S":m=i,g=a;var I=s.len(),T=s.data;o===d.C&&(m+=i-T[I-4],g+=a-T[I-3]),l=d.C,S=h[p++],E=h[p++],i=h[p++],a=h[p++],s.addData(l,m,g,S,E,i,a);break;case"s":m=i,g=a,I=s.len(),T=s.data,o===d.C&&(m+=i-T[I-4],g+=a-T[I-3]),l=d.C,S=i+h[p++],E=a+h[p++],i+=h[p++],a+=h[p++],s.addData(l,m,g,S,E,i,a);break;case"Q":S=h[p++],E=h[p++],i=h[p++],a=h[p++],l=d.Q,s.addData(l,S,E,i,a);break;case"q":S=h[p++]+i,E=h[p++]+a,i+=h[p++],a+=h[p++],l=d.Q,s.addData(l,S,E,i,a);break;case"T":m=i,g=a,I=s.len(),T=s.data,o===d.Q&&(m+=i-T[I-4],g+=a-T[I-3]),i=h[p++],a=h[p++],l=d.Q,s.addData(l,m,g,i,a);break;case"t":m=i,g=a,I=s.len(),T=s.data,o===d.Q&&(m+=i-T[I-4],g+=a-T[I-3]),i+=h[p++],a+=h[p++],l=d.Q,s.addData(l,m,g,i,a);break;case"A":v=h[p++],y=h[p++],b=h[p++],_=h[p++],w=h[p++],Qn(S=i,E=a,i=h[p++],a=h[p++],_,w,v,y,b,l=d.A,s);break;case"a":v=h[p++],y=h[p++],b=h[p++],_=h[p++],w=h[p++],Qn(S=i,E=a,i+=h[p++],a+=h[p++],_,w,v,y,b,l=d.A,s)}}"z"!==c&&"Z"!==c||(l=d.Z,s.addData(l)),o=l}return s.toStatic(),s}(e);return(t=t||{}).buildPath=function(e){if(e.setData){e.setData(r.data),(t=e.getContext())&&e.rebuildPath(t)}else{var t=e;r.rebuildPath(t)}},t.applyTransform=function(e){qn(r,e),this.dirty(!0)},t}var Zn=(Object.freeze||Object)({createFromString:function(e,t){return new Nn($n(e,t))},extendFromString:function(e,t){return Nn.extend($n(e,t))},mergePath:function(e,t){for(var r=[],o=e.length,n=0;n<o;n++){var i=e[n];i.path||i.createPathProxy(),i.__dirtyPath&&i.buildPath(i.path,i.shape,!0),r.push(i.path)}var a=new Nn(t);return a.createPathProxy(),a.buildPath=function(e){e.appendPath(r);var t=e.getContext();t&&e.rebuildPath(t)},a}}),ei=Nn.extend({type:"compound",shape:{paths:null},_updatePathDirty:function(){for(var e=this.__dirtyPath,t=this.shape.paths,r=0;r<t.length;r++)e=e||t[r].__dirtyPath;this.__dirtyPath=e,this.__dirty=this.__dirty||e},beforeBrush:function(){this._updatePathDirty();for(var e=this.shape.paths||[],t=this.getGlobalScale(),r=0;r<e.length;r++)e[r].path||e[r].createPathProxy(),e[r].path.setScale(t[0],t[1])},buildPath:function(e,t){for(var r=t.paths||[],o=0;o<r.length;o++)r[o].buildPath(e,r[o].shape,!0)},afterBrush:function(){for(var e=this.shape.paths||[],t=0;t<e.length;t++)e[t].__dirtyPath=!1},getBoundingRect:function(){return this._updatePathDirty(),Nn.prototype.getBoundingRect.call(this)}}),ti=function(e){zr.call(this,e)};function ri(e){zr.call(this,e),this._displayables=[],this._temporaryDisplayables=[],this._cursor=0,this._needsClear=!0}ti.prototype={constructor:ti,type:"text",brush:function(e,t){var r=this.style;this.__dirty&&xr(r),r.fill=r.stroke=r.shadowBlur=r.shadowColor=r.shadowOffsetX=r.shadowOffsetY=null;var o=r.text;null!=o&&(o+=""),r.bind(e,this,t),Hr(o,r)&&(this.setTransform(e),kr(this,e,o,r),this.restoreTransform(e))},getBoundingRect:function(){var e=this.style;if(this.__dirty&&xr(e),!this._rect){var t=e.text;null!=t?t+="":t="";var r=mr(e.text+"",e.font,e.textAlign,e.textVerticalAlign,e.textPadding,e.rich);if(r.x+=e.x||0,r.y+=e.y||0,Vr(e.textStroke,e.textStrokeWidth)){var o=e.textStrokeWidth;r.x-=o/2,r.y-=o/2,r.width+=o,r.height+=o}this._rect=r}return this._rect}},S(ti,zr),ri.prototype.isIncremental=!0,ri.prototype.needsClear=function(){return this._needsClear},ri.prototype.clearDisplaybles=function(){this._displayables=[],this._temporaryDisplayables=[],this._cursor=0,this.dirty(),this._needsClear=!0},ri.prototype.addDisplayable=function(e,t){t?this._temporaryDisplayables.push(e):this._displayables.push(e),this.dirty()},ri.prototype.addDisplayables=function(e,t){t=t||!1;for(var r=0;r<e.length;r++)this.addDisplayable(e[r],t)},ri.prototype.update=function(){this.updateTransform();for(var e=this._cursor;e<this._displayables.length;e++){(t=this._displayables[e]).parent=this,t.update(),t.parent=null}for(e=0;e<this._temporaryDisplayables.length;e++){var t;(t=this._temporaryDisplayables[e]).parent=this,t.update(),t.parent=null}},ri.prototype.brush=function(e,t){for(var r=this._cursor;r<this._displayables.length;r++)this._displayables[r].brush(e,r===this._cursor?null:this._displayables[r-1]);this._cursor=r;for(r=0;r<this._temporaryDisplayables.length;r++)this._temporaryDisplayables[r].brush(e,0===r?null:this._temporaryDisplayables[r-1]);this._temporaryDisplayables=[],this._needsClear=!1};var oi=[];ri.prototype.getBoundingRect=function(){if(!this._rect){for(var e=new At(1/0,1/0,-1/0,-1/0),t=0;t<this._displayables.length;t++){var r=this._displayables[t],o=r.getBoundingRect().clone();r.needLocalTransform()&&o.applyTransform(r.getLocalTransform(oi)),e.union(o)}this._rect=e}return this._rect},ri.prototype.contain=function(e,t){var r=this.transformCoordToLocal(e,t);if(this.getBoundingRect().contain(r[0],r[1]))for(var o=0;o<this._displayables.length;o++){if(this._displayables[o].contain(e,t))return!0}return!1},S(ri,zr);var ni=Nn.extend({type:"arc",shape:{cx:0,cy:0,r:0,startAngle:0,endAngle:2*Math.PI,clockwise:!0},style:{stroke:"#000",fill:null},buildPath:function(e,t){var r=t.cx,o=t.cy,n=Math.max(t.r,0),i=t.startAngle,a=t.endAngle,s=t.clockwise,d=Math.cos(i),l=Math.sin(i);e.moveTo(d*n+r,l*n+o),e.arc(r,o,n,i,a,!s)}}),ii=[];function ai(e,t,r){var o=e.cpx2,n=e.cpy2;return null===o||null===n?[(r?No:Do)(e.x1,e.cpx1,e.cpx2,e.x2,t),(r?No:Do)(e.y1,e.cpy1,e.cpy2,e.y2,t)]:[(r?Fo:Vo)(e.x1,e.cpx1,e.x2,t),(r?Fo:Vo)(e.y1,e.cpy1,e.y2,t)]}var si=Nn.extend({type:"bezier-curve",shape:{x1:0,y1:0,x2:0,y2:0,cpx1:0,cpy1:0,percent:1},style:{stroke:"#000",fill:null},buildPath:function(e,t){var r=t.x1,o=t.y1,n=t.x2,i=t.y2,a=t.cpx1,s=t.cpy1,d=t.cpx2,l=t.cpy2,u=t.percent;0!==u&&(e.moveTo(r,o),null==d||null==l?(u<1&&(Go(r,a,n,u,ii),a=ii[1],n=ii[2],Go(o,s,i,u,ii),s=ii[1],i=ii[2]),e.quadraticCurveTo(a,s,n,i)):(u<1&&(jo(r,a,d,n,u,ii),a=ii[1],d=ii[2],n=ii[3],jo(o,s,l,i,u,ii),s=ii[1],l=ii[2],i=ii[3]),e.bezierCurveTo(a,s,d,l,n,i)))},pointAt:function(e){return ai(this.shape,e,!1)},tangentAt:function(e){var t=ai(this.shape,e,!0);return $(t,t)}}),di=Nn.extend({type:"circle",shape:{cx:0,cy:0,r:0},buildPath:function(e,t,r){r&&e.moveTo(t.cx+t.r,t.cy),e.arc(t.cx,t.cy,t.r,0,2*Math.PI,!0)}}),li=Nn.extend({type:"droplet",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(e,t){var r=t.cx,o=t.cy,n=t.width,i=t.height;e.moveTo(r,o+n),e.bezierCurveTo(r+n,o+n,r+3*n/2,o-n/3,r,o-i),e.bezierCurveTo(r-3*n/2,o-n/3,r-n,o+n,r,o+n),e.closePath()}}),ui=Nn.extend({type:"ellipse",shape:{cx:0,cy:0,rx:0,ry:0},buildPath:function(e,t){var r=t.cx,o=t.cy,n=t.rx,i=t.ry,a=.5522848*n,s=.5522848*i;e.moveTo(r-n,o),e.bezierCurveTo(r-n,o-s,r-a,o-i,r,o-i),e.bezierCurveTo(r+a,o-i,r+n,o-s,r+n,o),e.bezierCurveTo(r+n,o+s,r+a,o+i,r,o+i),e.bezierCurveTo(r-a,o+i,r-n,o+s,r-n,o),e.closePath()}}),ci=Nn.extend({type:"heart",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(e,t){var r=t.cx,o=t.cy,n=t.width,i=t.height;e.moveTo(r,o),e.bezierCurveTo(r+n/2,o-2*i/3,r+2*n,o+i/3,r,o+i),e.bezierCurveTo(r-2*n,o+i/3,r-n/2,o-2*i/3,r,o)}}),pi=Math.PI,hi=Math.sin,fi=Math.cos,mi=Nn.extend({type:"isogon",shape:{x:0,y:0,r:0,n:0},buildPath:function(e,t){var r=t.n;if(r&&!(r<2)){var o=t.x,n=t.y,i=t.r,a=2*pi/r,s=-pi/2;e.moveTo(o+i*fi(s),n+i*hi(s));for(var d=0,l=r-1;d<l;d++)s+=a,e.lineTo(o+i*fi(s),n+i*hi(s));e.closePath()}}}),gi=Nn.extend({type:"line",shape:{x1:0,y1:0,x2:0,y2:0,percent:1},style:{stroke:"#000",fill:null},buildPath:function(e,t){var r=t.x1,o=t.y1,n=t.x2,i=t.y2,a=t.percent;0!==a&&(e.moveTo(r,o),a<1&&(n=r*(1-a)+n*a,i=o*(1-a)+i*a),e.lineTo(n,i))},pointAt:function(e){var t=this.shape;return[t.x1*(1-e)+t.x2*e,t.y1*(1-e)+t.y2*e]}});function vi(e,t,r,o,n,i,a){var s=.5*(r-e),d=.5*(o-t);return(2*(t-r)+s+d)*a+(-3*(t-r)-2*s-d)*i+s*n+t}function yi(e,t,r){var o=t.points,n=t.smooth;if(o&&2<=o.length){if(n&&"spline"!==n){var i=function(e,t,r,o){var n,i,a,s,d=[],l=[],u=[],c=[];if(o){a=[1/0,1/0],s=[-1/0,-1/0];for(var p=0,h=e.length;p<h;p++)ne(a,a,e[p]),ie(s,s,e[p]);ne(a,a,o[0]),ie(s,s,o[1])}for(p=0,h=e.length;p<h;p++){var f=e[p];if(r)n=e[p?p-1:h-1],i=e[(p+1)%h];else{if(0===p||p===h-1){d.push(H(e[p]));continue}n=e[p-1],i=e[p+1]}Y(l,i,n),Q(l,l,t);var m=Z(f,n),g=Z(f,i),v=m+g;0!==v&&(m/=v,g/=v),Q(u,l,-m),Q(c,l,g);var y=W([],f,u),b=W([],f,c);o&&(ie(y,y,a),ne(y,y,s),ie(b,b,a),ne(b,b,s)),d.push(y),d.push(b)}return r&&d.push(d.shift()),d}(o,n,r,t.smoothConstraint);e.moveTo(o[0][0],o[0][1]);for(var a=o.length,s=0;s<(r?a:a-1);s++){var d=i[2*s],l=i[2*s+1],u=o[(s+1)%a];e.bezierCurveTo(d[0],d[1],l[0],l[1],u[0],u[1])}}else{"spline"===n&&(o=function(e,t){for(var r=e.length,o=[],n=0,i=1;i<r;i++)n+=Z(e[i-1],e[i]);var a=n/2;a=a<r?r:a;for(i=0;i<a;i++){var s,d,l,u=i/(a-1)*(t?r:r-1),c=Math.floor(u),p=u-c,h=e[c%r];l=t?(s=e[(c-1+r)%r],d=e[(c+1)%r],e[(c+2)%r]):(s=e[0===c?c:c-1],d=e[r-2<c?r-1:c+1],e[r-3<c?r-1:c+2]);var f=p*p,m=p*f;o.push([vi(s[0],h[0],d[0],l[0],p,f,m),vi(s[1],h[1],d[1],l[1],p,f,m)])}return o}(o,r)),e.moveTo(o[0][0],o[0][1]);s=1;for(var c=o.length;s<c;s++)e.lineTo(o[s][0],o[s][1])}r&&e.closePath()}}var bi,_i=Nn.extend({type:"polygon",shape:{points:null,smooth:!1,smoothConstraint:null},buildPath:function(e,t){yi(e,t,!0)}}),wi=Nn.extend({type:"polyline",shape:{points:null,smooth:!1,smoothConstraint:null},style:{stroke:"#000",fill:null},buildPath:function(e,t){yi(e,t,!1)}}),Si=Nn.extend({type:"rect",shape:{r:0,x:0,y:0,width:0,height:0},buildPath:function(e,t){var r=t.x,o=t.y,n=t.width,i=t.height;t.r?Cr(e,t):e.rect(r,o,n,i),e.closePath()}}),Ei=Nn.extend({type:"ring",shape:{cx:0,cy:0,r:0,r0:0},buildPath:function(e,t){var r=t.cx,o=t.cy,n=2*Math.PI;e.moveTo(r+t.r,o),e.arc(r,o,t.r,0,n,!1),e.moveTo(r+t.r0,o),e.arc(r,o,t.r0,0,n,!0)}}),Ii=Nn.extend({type:"Arrowline",shape:{x1:0,y1:0,x2:0,y2:0,percent:1,arrowlength:10,arrowtype:1,points:[]},style:{stroke:"#000",fill:null},buildPath:function(e,t){var r=t.x1,o=t.y1,n=t.x2,i=t.y2,a=t.percent,s=t.arrowlength;if(0!==a)if(e.moveTo(r,o),a<1&&(n=r*(1-a)+n*a,i=o*(1-a)+i*a),e.lineTo(n,i),1==t.arrowtype);else{var d=[],l=Math.sqrt((n-r)*(n-r)+(i-o)*(i-o)),u=-(i-o)/l,c=(n-r)/l,p=s*(Math.cos(5*Math.PI/6)*c-Math.sin(5*Math.PI/6)*u),h=s*(Math.cos(5*Math.PI/6)*u+Math.sin(5*Math.PI/6)*c),f=r*(1-(a=1-s*(Math.cos(Math.PI/6)-.5)/l))+n*a,m=o*(1-a)+i*a,g=s*(Math.cos(7*Math.PI/6)*c-Math.sin(7*Math.PI/6)*u),v=s*(Math.cos(7*Math.PI/6)*u+Math.sin(7*Math.PI/6)*c),y=r*(1-(a=1-a))+n*a,b=o*(1-a)+i*a;3==t.arrowtype?(d.push([n,i]),d.push([n+p,i-h]),d.push([f,m]),d.push([n+g,i-v]),d.push([n,i])):2==t.arrowtype?(d.push([r,o]),d.push([r-p,o+h]),d.push([y,b]),d.push([r-g,o+v]),d.push([r,o])):4==t.arrowtype&&(d.push([n,i]),d.push([n+p,i-h]),d.push([f,m]),d.push([n+g,i-v]),d.push([n,i]),d.push([r,o]),d.push([r-p,o+h]),d.push([y,b]),d.push([r-g,o+v]),d.push([r,o])),t.points=d,yi(e,t,!0)}}}),Ti=Math.sin,Ri=Math.cos,Ci=Math.PI/180,Pi=Nn.extend({type:"rose",shape:{cx:0,cy:0,r:[],k:0,n:1},style:{stroke:"#000",fill:null},buildPath:function(e,t){var r,o,n,i=t.r,a=t.k,s=t.n,d=t.cx,l=t.cy;e.moveTo(d,l);for(var u=0,c=i.length;u<c;u++){n=i[u];for(var p=0;p<=360*s;p++)r=n*Ti(a/s*p%360*Ci)*Ri(p*Ci)+d,o=n*Ti(a/s*p%360*Ci)*Ti(p*Ci)+l,e.lineTo(r,o)}}}),Mi=[["shadowBlur",0],["shadowColor","#000"],["shadowOffsetX",0],["shadowOffsetY",0]],xi=Nn.extend({type:"sector",shape:{cx:0,cy:0,r0:0,r:0,startAngle:0,endAngle:2*Math.PI,clockwise:!0},brush:(bi=Nn.prototype.brush,u.browser.ie&&11<=u.browser.version?function(){var e,t=this.__clipPaths,r=this.style;if(t)for(var o=0;o<t.length;o++){var n=t[o],i=n&&n.shape,a=n&&n.type;if(i&&("sector"===a&&i.startAngle===i.endAngle||"rect"===a&&(!i.width||!i.height))){for(var s=0;s<Mi.length;s++)Mi[s][2]=r[Mi[s][0]],r[Mi[s][0]]=Mi[s][1];e=!0;break}}if(bi.apply(this,arguments),e)for(s=0;s<Mi.length;s++)r[Mi[s][0]]=Mi[s][2]}:bi),buildPath:function(e,t){var r=t.cx,o=t.cy,n=Math.max(t.r0||0,0),i=Math.max(t.r,0),a=t.startAngle,s=t.endAngle,d=t.clockwise,l=Math.cos(a),u=Math.sin(a);e.moveTo(l*n+r,u*n+o),e.lineTo(l*i+r,u*i+o),e.arc(r,o,i,a,s,!d),e.lineTo(Math.cos(s)*n+r,Math.sin(s)*n+o),0!==n&&e.arc(r,o,n,s,a,d),e.closePath()}}),Ai=Math.PI,ki=Math.cos,Oi=Math.sin,Ui=Nn.extend({type:"star",shape:{cx:0,cy:0,n:3,r0:null,r:0},buildPath:function(e,t){var r=t.n;if(r&&!(r<2)){var o=t.cx,n=t.cy,i=t.r,a=t.r0;null==a&&(a=4<r?i*ki(2*Ai/r)/ki(Ai/r):i/3);var s=Ai/r,d=-Ai/2,l=o+i*ki(d),u=n+i*Oi(d);d+=s,e.moveTo(l,u);for(var c,p=0,h=2*r-1;p<h;p++)c=p%2==0?a:i,e.lineTo(o+c*ki(d),n+c*Oi(d)),d+=s;e.closePath()}}}),Li=Math.cos,Di=Math.sin,Ni=Nn.extend({type:"trochoid",shape:{cx:0,cy:0,r:0,r0:0,d:0,location:"out"},style:{stroke:"#000",fill:null},buildPath:function(e,t){var r,o,n,i,a=t.r,s=t.r0,d=t.d,l=t.cx,u=t.cy,c="out"==t.location?1:-1;if(!(t.location&&a<=s)){var p,h=0,f=1;for(r=(a+c*s)*Li(0)-c*d*Li(0)+l,o=(a+c*s)*Di(0)-d*Di(0)+u,e.moveTo(r,o);s*++h%(a+c*s)!=0;);for(;p=Math.PI/180*f,n=(a+c*s)*Li(p)-c*d*Li((a/s+c)*p)+l,i=(a+c*s)*Di(p)-d*Di((a/s+c)*p)+u,e.lineTo(n,i),++f<=s*h/(a+c*s)*360;);}}}),Bi=function(e){this.colorStops=e||[]};Bi.prototype={constructor:Bi,addColorStop:function(e,t){this.colorStops.push({offset:e,color:t})}};var ji=function(e,t,r,o,n,i){this.x=null==e?0:e,this.y=null==t?0:t,this.x2=null==r?1:r,this.y2=null==o?0:o,this.type="linear",this.global=i||!1,Bi.call(this,n)};ji.prototype={constructor:ji},S(ji,Bi);var Vi=function(e,t,r,o,n){this.x=null==e?.5:e,this.y=null==t?.5:t,this.r=null==r?.5:r,this.type="radial",this.global=n||!1,Bi.call(this,o)};Vi.prototype={constructor:Vi},S(Vi,Bi);function Fi(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}var qi=gn.CMD,Gi=Array.prototype.join,Hi="none",Wi=Math.round,Yi=Math.sin,zi=Math.cos,Ki=Math.PI,Xi=2*Math.PI,Ji=180/Ki,Qi=1e-4;function $i(e){return Wi(1e4*e)/1e4}function Zi(e){return e<Qi&&-Qi<e}function ea(e,t){t&&ta(e,"transform","matrix("+Gi.call(t,",")+")")}function ta(e,t,r){(!r||"linear"!==r.type&&"radial"!==r.type)&&e.setAttribute(t,r)}function ra(e,t,r){if(n=t,null!=(i=r?n.textFill:n.fill)&&i!==Hi){var o=r?t.textFill:t.fill;o="transparent"===o?Hi:o,"none"!==e.getAttribute("clip-path")&&o===Hi&&(o="rgba(0, 0, 0, 0.002)"),ta(e,"fill",o),ta(e,"fill-opacity",t.opacity)}else ta(e,"fill",Hi);var n,i,a,s;if(a=t,null!=(s=r?a.textStroke:a.stroke)&&s!==Hi){var d=r?t.textStroke:t.stroke;ta(e,"stroke",d="transparent"===d?Hi:d),ta(e,"stroke-width",(r?t.textStrokeWidth:t.lineWidth)/(!r&&t.strokeNoScale?t.host.getLineScale():1)),ta(e,"paint-order","stroke"),ta(e,"stroke-opacity",t.opacity),t.lineDash?(ta(e,"stroke-dasharray",t.lineDash.join(",")),ta(e,"stroke-dashoffset",Wi(t.lineDashOffset||0))):ta(e,"stroke-dasharray",""),t.lineCap&&ta(e,"stroke-linecap",t.lineCap),t.lineJoin&&ta(e,"stroke-linejoin",t.lineJoin),t.miterLimit&&ta(e,"stroke-miterlimit",t.miterLimit)}else ta(e,"stroke",Hi)}var oa={};oa.brush=function(e){var t=e.style,r=e.__svgEl;r||(r=Fi("path"),e.__svgEl=r),e.path||e.createPathProxy();var o=e.path;if(e.__dirtyPath){o.beginPath(),e.buildPath(o,e.shape),e.__dirtyPath=!1;var n=function(e){for(var t=[],r=e.data,o=e.len(),n=0;n<o;){var i="",a=0;switch(r[n++]){case qi.M:i="M",a=2;break;case qi.L:i="L",a=2;break;case qi.Q:i="Q",a=4;break;case qi.C:i="C",a=6;break;case qi.A:var s=r[n++],d=r[n++],l=r[n++],u=r[n++],c=r[n++],p=r[n++],h=r[n++],f=r[n++],m=Math.abs(p),g=Zi(m%Xi)&&!Zi(m),v=!1;v=Xi<=m||!Zi(m)&&(-Ki<p&&p<0||Ki<p)==!!f;var y=$i(s+l*zi(c)),b=$i(d+u*Yi(c));g&&(p=f?Xi-1e-4:1e-4-Xi,v=!0,9===n&&t.push("M",y,b));var _=$i(s+l*zi(c+p)),w=$i(d+u*Yi(c+p));t.push("A",$i(l),$i(u),Wi(h*Ji),+v,+f,_,w);break;case qi.Z:i="Z";break;case qi.R:_=$i(r[n++]),w=$i(r[n++]);var S=$i(r[n++]),E=$i(r[n++]);t.push("M",_,w,"L",_+S,w,"L",_+S,w+E,"L",_,w+E,"L",_,w)}i&&t.push(i);for(var I=0;I<a;I++)t.push($i(r[n++]))}return t.join(" ")}(o);n.indexOf("NaN")<0&&ta(r,"d",n)}ra(r,t),ea(r,e.transform),null!=t.text&&sa(e,e.getBoundingRect())};var na={brush:function(e){var t=e.style,r=t.image;r instanceof HTMLImageElement&&(r=r.src);if(r){var o,n,i=t.x||0,a=t.y||0,s=t.width,d=t.height,l=e.__svgEl;l||(l=Fi("image"),e.__svgEl=l),r!==e.__imageSrc&&(o="href",n=r,l.setAttributeNS("http://www.w3.org/1999/xlink",o,n),e.__imageSrc=r),ta(l,"width",s),ta(l,"height",d),ta(l,"x",i),ta(l,"y",a),ea(l,e.transform),null!=t.text&&sa(e,e.getBoundingRect())}}},ia={},aa=new At,sa=function(e,t,r){var o=e.style;e.__dirty&&xr(o);var n=o.text;if(null!=n){n+="";var i,a,s=e.__textSvgEl;if(s||(s=Fi("text"),e.__textSvgEl=s),ra(s,o,!0),e instanceof ti||e.style.transformText)ea(s,e.transform);else if(e.transform)aa.copy(t),aa.applyTransform(e.transform),t=aa;else{var d=e.transformCoordToGlobal(t.x,t.y);t.x=d[0],t.y=d[1]}var l=o.textPosition,u=o.textDistance,c=o.textAlign||"left";"number"==typeof o.fontSize&&(o.fontSize+="px");var p=o.font||[o.fontStyle||"",o.fontWeight||"",o.fontSize||"",o.fontFamily||""].join(" ")||pr,h=da(o.textVerticalAlign),f=(r=mr(n,p,c,h)).lineHeight;if(l instanceof Array)i=t.x+l[0],a=t.y+l[1];else{var m=yr(l,t,u);i=m.x,a=m.y,h=da(m.textVerticalAlign),c=m.textAlign}ta(s,"alignment-baseline",h),p&&(s.style.font=p);var g=o.textPadding;ta(s,"x",i),ta(s,"y",a);var v=n.split("\n"),y=v.length,b=c;"left"===b?(b="start",g&&(i+=g[3])):"right"===b?(b="end",g&&(i-=g[1])):"center"===b&&(b="middle",g&&(i+=(g[3]-g[1])/2));var _=0;if("baseline"===h?(_=-r.height+f,g&&(_-=g[2])):"middle"===h?(_=(-r.height+f)/2,g&&(a+=(g[0]-g[2])/2)):g&&(_+=g[0]),e.__text!==n||e.__textFont!==p){var w=e.__tspanList||[];e.__tspanList=w;for(var S=0;S<y;S++){(I=w[S])?I.innerHTML="":(I=w[S]=Fi("tspan"),s.appendChild(I),ta(I,"alignment-baseline",h),ta(I,"text-anchor",b)),ta(I,"x",i),ta(I,"y",a+S*f+_),I.appendChild(document.createTextNode(v[S]))}for(;S<w.length;S++)s.removeChild(w[S]);w.length=y,e.__text=n,e.__textFont=p}else if(e.__tspanList.length){var E=e.__tspanList.length;for(S=0;S<E;++S){var I;(I=e.__tspanList[S])&&(ta(I,"x",i),ta(I,"y",a+S*f+_))}}}};function da(e){return"middle"===e?"middle":"bottom"===e?"baseline":"hanging"}function la(){}function ua(e,t,r,o){for(var n=0,i=t.length,a=0,s=0;n<i;n++){var d=t[n];if(d.removed){for(l=[],u=s;u<s+d.count;u++)l.push(u);d.indices=l,s+=d.count}else{for(var l=[],u=a;u<a+d.count;u++)l.push(u);d.indices=l,a+=d.count,d.added||(s+=d.count)}}return t}ia.drawRectText=sa,ia.brush=function(e){var t=e.style;null!=t.text&&(t.textPosition=[0,0],sa(e,{x:t.x||0,y:t.y||0,width:0,height:0},e.getBoundingRect()))},la.prototype={diff:function(d,l,e){e||(e=function(e,t){return e===t}),this.equals=e;var u=this;d=d.slice();var c=(l=l.slice()).length,p=d.length,h=1,t=c+p,f=[{newPos:-1,components:[]}],r=this.extractCommon(f[0],l,d,0);if(f[0].newPos+1>=c&&p<=r+1){for(var o=[],n=0;n<l.length;n++)o.push(n);return[{indices:o,count:l.length}]}function i(){for(var e=-1*h;e<=h;e+=2){var t,r=f[e-1],o=f[e+1],n=(o?o.newPos:0)-e;r&&(f[e-1]=void 0);var i=r&&r.newPos+1<c,a=o&&0<=n&&n<p;if(i||a){if(!i||a&&r.newPos<o.newPos?(t={newPos:(s=o).newPos,components:s.components.slice(0)},u.pushComponent(t.components,void 0,!0)):((t=r).newPos++,u.pushComponent(t.components,!0,void 0)),n=u.extractCommon(t,l,d,e),t.newPos+1>=c&&p<=n+1)return ua(u,t.components,l,d);f[e]=t}else f[e]=void 0}var s;h++}for(;h<=t;){var a=i();if(a)return a}},pushComponent:function(e,t,r){var o=e[e.length-1];o&&o.added===t&&o.removed===r?e[e.length-1]={count:o.count+1,added:t,removed:r}:e.push({count:1,added:t,removed:r})},extractCommon:function(e,t,r,o){for(var n=t.length,i=r.length,a=e.newPos,s=a-o,d=0;a+1<n&&s+1<i&&this.equals(t[a+1],r[s+1]);)a++,s++,d++;return d&&e.components.push({count:d}),e.newPos=a,s},tokenize:function(e){return e.slice()},join:function(e){return e.slice()}};var ca=new la;function pa(e,t,r,o){this._svgRoot=e,this._tagNames="string"==typeof t?[t]:t,this._markLabel=r,this._domName=o||"_dom",this.nextId=0}function ha(e){pa.call(this,e,["linearGradient","radialGradient"],"__gradient_in_use__")}function fa(e){pa.call(this,e,"clipPath","__clippath_in_use__")}function ma(e){pa.call(this,e,["filter"],"__filter_in_use__","_shadowDom")}function ga(e){return e&&(e.shadowBlur||e.shadowOffsetX||e.shadowOffsetY||e.textShadowBlur||e.textShadowOffsetX||e.textShadowOffsetY)}function va(e){return parseInt(e,10)}function ya(e,t){return t&&e&&t.parentNode!==e}function ba(e,t,r){if(ya(e,t)&&r){var o=r.nextSibling;o?e.insertBefore(t,o):e.appendChild(t)}}function _a(e,t){if(ya(e,t)){var r=e.firstChild;r?e.insertBefore(t,r):e.appendChild(t)}}function wa(e,t){t&&e&&t.parentNode===e&&e.removeChild(t)}function Sa(e){return e.__textSvgEl}function Ea(e){return e.__svgEl}pa.prototype.createElement=Fi,pa.prototype.getDefs=function(e){var t=this._svgRoot,o=this._svgRoot.getElementsByTagName("defs");return 0===o.length?e?((o=t.insertBefore(this.createElement("defs"),t.firstChild)).contains||(o.contains=function(e){var t=o.children;if(!t)return!1;for(var r=t.length-1;0<=r;--r)if(t[r]===e)return!0;return!1}),o):null:o[0]},pa.prototype.update=function(e,t){if(e){var r=this.getDefs(!1);if(e[this._domName]&&r.contains(e[this._domName]))"function"==typeof t&&t(e);else{var o=this.add(e);o&&(e[this._domName]=o)}}},pa.prototype.addDom=function(e){this.getDefs(!0).appendChild(e)},pa.prototype.removeDom=function(e){var t=this.getDefs(!1);t&&(t.removeChild(e[this._domName]),e[this._domName]=null)},pa.prototype.getDoms=function(){var r=this.getDefs(!1);if(!r)return[];var o=[];return I(this._tagNames,function(e){var t=r.getElementsByTagName(e);o=o.concat([].slice.call(t))}),o},pa.prototype.markAllUnused=function(){var e=this.getDoms(),t=this;I(e,function(e){e[t._markLabel]="0"})},pa.prototype.markUsed=function(e){e&&(e[this._markLabel]="1")},pa.prototype.removeUnused=function(){var t=this.getDefs(!1);if(t){var e=this.getDoms(),r=this;I(e,function(e){"1"!==e[r._markLabel]&&t.removeChild(e)})}},pa.prototype.getSvgProxy=function(e){return e instanceof Nn?oa:e instanceof Kr?na:e instanceof ti?ia:oa},pa.prototype.getTextSvgElement=function(e){return e.__textSvgEl},pa.prototype.getSvgElement=function(e){return e.__svgEl},S(ha,pa),ha.prototype.addWithoutUpdate=function(i,a){if(a&&a.style){var s=this;I(["fill","stroke"],function(e){if(a.style[e]&&("linear"===a.style[e].type||"radial"===a.style[e].type)){var t,r=a.style[e],o=s.getDefs(!0);r._dom?(t=r._dom,o.contains(r._dom)||s.addDom(t)):t=s.add(r),s.markUsed(a);var n=t.getAttribute("id");i.setAttribute(e,"url(#"+n+")")}})}},ha.prototype.add=function(e){var t;if("linear"===e.type)t=this.createElement("linearGradient");else{if("radial"!==e.type)return wt("Illegal gradient type."),null;t=this.createElement("radialGradient")}return e.id=e.id||this.nextId++,t.setAttribute("id","zr-gradient-"+e.id),this.updateDom(e,t),this.addDom(t),t},ha.prototype.update=function(r){var o=this;pa.prototype.update.call(this,r,function(){var e=r.type,t=r._dom.tagName;"linear"===e&&"linearGradient"===t||"radial"===e&&"radialGradient"===t?o.updateDom(r,r._dom):(o.removeDom(r),o.add(r))})},ha.prototype.updateDom=function(e,t){if("linear"===e.type)t.setAttribute("x1",e.x),t.setAttribute("y1",e.y),t.setAttribute("x2",e.x2),t.setAttribute("y2",e.y2);else{if("radial"!==e.type)return void wt("Illegal gradient type.");t.setAttribute("cx",e.x),t.setAttribute("cy",e.y),t.setAttribute("r",e.r)}e.global?t.setAttribute("gradientUnits","userSpaceOnUse"):t.setAttribute("gradientUnits","objectBoundingBox"),t.innerHTML="";for(var r=e.colorStops,o=0,n=r.length;o<n;++o){var i=this.createElement("stop");i.setAttribute("offset",100*r[o].offset+"%"),i.setAttribute("stop-color",r[o].color),t.appendChild(i)}e._dom=t},ha.prototype.markUsed=function(e){if(e.style){var t=e.style.fill;t&&t._dom&&pa.prototype.markUsed.call(this,t._dom),(t=e.style.stroke)&&t._dom&&pa.prototype.markUsed.call(this,t._dom)}},S(fa,pa),fa.prototype.update=function(e){var t=this.getSvgElement(e);t&&this.updateDom(t,e.__clipPaths,!1);var r=this.getTextSvgElement(e);r&&this.updateDom(r,e.__clipPaths,!0),this.markUsed(e)},fa.prototype.updateDom=function(e,t,r){if(t&&0<t.length){var o,n,i=this.getDefs(!0),a=t[0],s=r?"_textDom":"_dom";a[s]?(n=a[s].getAttribute("id"),o=a[s],i.contains(o)||i.appendChild(o)):(n="zr-clip-"+this.nextId,++this.nextId,(o=this.createElement("clipPath")).setAttribute("id",n),i.appendChild(o),a[s]=o);var d=this.getSvgProxy(a);if(a.transform&&a.parent.invTransform&&!r){var l=Array.prototype.slice.call(a.transform);_e(a.transform,a.parent.invTransform,a.transform),d.brush(a),a.transform=l}else d.brush(a);var u=this.getSvgElement(a);o.innerHTML="",o.appendChild(u.cloneNode()),e.setAttribute("clip-path","url(#"+n+")"),1<t.length&&this.updateDom(o,t.slice(1),r)}else e&&e.setAttribute("clip-path","none")},fa.prototype.markUsed=function(e){var t=this;e.__clipPaths&&0<e.__clipPaths.length&&I(e.__clipPaths,function(e){e._dom&&pa.prototype.markUsed.call(t,e._dom),e._textDom&&pa.prototype.markUsed.call(t,e._textDom)})},S(ma,pa),ma.prototype.addWithoutUpdate=function(e,t){if(t&&ga(t.style)){var r,o=t.style;if(o._shadowDom)r=o._shadowDom,this.getDefs(!0).contains(o._shadowDom)||this.addDom(r);else r=this.add(t);this.markUsed(t);var n=r.getAttribute("id");e.style.filter="url(#"+n+")"}},ma.prototype.add=function(e){var t=this.createElement("filter"),r=e.style;return r._shadowDomId=r._shadowDomId||this.nextId++,t.setAttribute("id","zr-shadow-"+r._shadowDomId),this.updateDom(e,t),this.addDom(t),t},ma.prototype.update=function(e,t){var r=t.style;if(ga(r)){var o=this;pa.prototype.update.call(this,t,function(e){o.updateDom(t,e._shadowDom)})}else this.remove(e,r)},ma.prototype.remove=function(e,t){null!=t._shadowDomId&&(this.removeDom(t),e.style.filter="")},ma.prototype.updateDom=function(e,t){var r=t.getElementsByTagName("feDropShadow");r=0===r.length?this.createElement("feDropShadow"):r[0];var o,n,i,a,s=e.style,d=e.scale&&e.scale[0]||1,l=e.scale&&e.scale[1]||1;if(s.shadowBlur||s.shadowOffsetX||s.shadowOffsetY)o=s.shadowOffsetX,n=s.shadowOffsetY,i=s.shadowBlur,a=s.shadowColor;else{if(!s.textShadowBlur)return void this.removeDom(t,s);o=s.textShadowOffsetX,n=s.textShadowOffsetY,i=s.textShadowBlur,a=s.textShadowColor}r.setAttribute("dx",o/d),r.setAttribute("dy",n/l),r.setAttribute("flood-color",a);var u=i/2/d+" "+i/2/l;r.setAttribute("stdDeviation",u),t.setAttribute("x","-100%"),t.setAttribute("y","-100%"),t.setAttribute("width",Math.ceil(i/2*200)+"%"),t.setAttribute("height",Math.ceil(i/2*200)+"%"),t.appendChild(r),s._shadowDom=t},ma.prototype.markUsed=function(e){var t=e.style;t&&t._shadowDom&&pa.prototype.markUsed.call(this,t._shadowDom)};var Ia=function(e,t,r){this.root=e,this.storage=t,this._opts=r=g({},r||{});var o=Fi("svg");o.setAttribute("xmlns","http://www.w3.org/2000/svg"),o.setAttribute("version","1.1"),o.setAttribute("baseProfile","full"),o.style.cssText="user-select:none;position:absolute;left:0;top:0;",this.gradientManager=new ha(o),this.clipPathManager=new fa(o),this.shadowManager=new ma(o);var n=document.createElement("div");n.style.cssText="overflow:hidden;position:relative",this._svgRoot=o,this._viewport=n,e.appendChild(n),n.appendChild(o),this.resize(r.width,r.height),this._visibleList=[]};Ia.prototype={constructor:Ia,getType:function(){return"svg"},getViewportRoot:function(){return this._viewport},getViewportRootOffset:function(){var e=this.getViewportRoot();if(e)return{offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}},refresh:function(){var e=this.storage.getDisplayList(!0);this._paintList(e)},_paintList:function(e){this.gradientManager.markAllUnused(),this.clipPathManager.markAllUnused(),this.shadowManager.markAllUnused();var t,r,o=this._svgRoot,n=this._visibleList,i=e.length,a=[];for(t=0;t<i;t++){var s=e[t],d=(r=s)instanceof Nn?oa:r instanceof Kr?na:r instanceof ti?ia:oa,l=Ea(s)||Sa(s);s.invisible||(s.__dirty&&(d&&d.brush(s),this.clipPathManager.update(s),s.style&&(this.gradientManager.update(s.style.fill),this.gradientManager.update(s.style.stroke),this.shadowManager.update(l,s)),s.__dirty=!1),a.push(s))}var u,c,p,h,f=(u=n,c=a,ca.diff(u,c,p));for(t=0;t<f.length;t++){if((v=f[t]).removed)for(var m=0;m<v.count;m++){l=Ea(s=n[v.indices[m]]);var g=Sa(s);wa(o,l),wa(o,g)}}for(t=0;t<f.length;t++){var v;if((v=f[t]).added)for(m=0;m<v.count;m++){l=Ea(s=a[v.indices[m]]),g=Sa(s);h?ba(o,l,h):_a(o,l),l?ba(o,g,l):h?ba(o,g,h):_a(o,g),ba(o,g,l),h=g||l||h,this.gradientManager.addWithoutUpdate(l,s),this.shadowManager.addWithoutUpdate(h,s),this.clipPathManager.markUsed(s)}else if(!v.removed)for(m=0;m<v.count;m++){h=l=Sa(s=a[v.indices[m]])||Ea(s)||h,this.gradientManager.markUsed(s),this.gradientManager.addWithoutUpdate(l,s),this.shadowManager.markUsed(s),this.shadowManager.addWithoutUpdate(l,s),this.clipPathManager.markUsed(s)}}this.gradientManager.removeUnused(),this.clipPathManager.removeUnused(),this.shadowManager.removeUnused(),this._visibleList=a},_getDefs:function(e){var o,t=this._svgRoot;return 0!==(o=this._svgRoot.getElementsByTagName("defs")).length?o[0]:e?((o=t.insertBefore(Fi("defs"),t.firstChild)).contains||(o.contains=function(e){var t=o.children;if(!t)return!1;for(var r=t.length-1;0<=r;--r)if(t[r]===e)return!0;return!1}),o):null},resize:function(e,t){var r=this._viewport;r.style.display="none";var o=this._opts;if(null!=e&&(o.width=e),null!=t&&(o.height=t),e=this._getSize(0),t=this._getSize(1),r.style.display="",this._width!==e&&this._height!==t){this._width=e,this._height=t;var n=r.style;n.width=e+"px",n.height=t+"px";var i=this._svgRoot;i.setAttribute("width",e),i.setAttribute("height",t)}},getWidth:function(){return this._width},getHeight:function(){return this._height},_getSize:function(e){var t=this._opts,r=["width","height"][e],o=["clientWidth","clientHeight"][e],n=["paddingLeft","paddingTop"][e],i=["paddingRight","paddingBottom"][e];if(null!=t[r]&&"auto"!==t[r])return parseFloat(t[r]);var a=this.root,s=document.defaultView.getComputedStyle(a);return(a[o]||va(s[r])||va(a.style[r]))-(va(s[n])||0)-(va(s[i])||0)|0},dispose:function(){this.root.innerHTML="",this._svgRoot=this._viewport=this.storage=null},clear:function(){this._viewport&&this.root.removeChild(this._viewport)},pathToSvg:function(){this.refresh();var e=this._svgRoot.outerHTML;return"data:img/svg+xml;utf-8,"+unescape(e)}},I(["getLayer","insertLayer","eachLayer","eachBuiltinLayer","eachOtherLayer","getLayers","modLayer","delLayer","clearLayer","toDataURL","pathToImage"],function(e){var t;Ia.prototype[e]=(t=e,function(){wt('In SVG mode painter not support method "'+t+'"')})}),Eo("svg",Ia);var Ta,Ra="urn:schemas-microsoft-com:vml",Ca="undefined"==typeof window?null:window,Pa=!1,Ma=Ca&&Ca.document;function xa(e){return Ta(e)}if(Ma&&!u.canvasSupported)try{!Ma.namespaces.zrvml&&Ma.namespaces.add("zrvml",Ra),Ta=function(e){return Ma.createElement("<zrvml:"+e+' class="zrvml">')}}catch(e){Ta=function(e){return Ma.createElement("<"+e+' xmlns="'+Ra+'" class="zrvml">')}}var Aa,ka=gn.CMD,Oa=Math.round,Ua=Math.sqrt,La=Math.abs,Da=Math.cos,Na=Math.sin,Ba=Math.max;if(!u.canvasSupported){var ja=",",Va="progid:DXImageTransform.Microsoft",Fa=21600,qa=Fa/2,Ga=function(e){e.style.cssText="position:absolute;left:0;top:0;width:1px;height:1px;",e.coordsize=Fa+","+Fa,e.coordorigin="0,0"},Ha=function(e,t,r){return"rgb("+[e,t,r].join(",")+")"},Wa=function(e,t){t&&e&&t.parentNode!==e&&e.appendChild(t)},Ya=function(e,t){t&&e&&t.parentNode===e&&e.removeChild(t)},za=function(e,t,r){return 1e5*(parseFloat(e)||0)+1e3*(parseFloat(t)||0)+r},Ka=function(e,t){return"string"==typeof e?0<=e.lastIndexOf("%")?parseFloat(e)/100*t:parseFloat(e):e},Xa=function(e,t,r){var o=Je(t);r=+r,isNaN(r)&&(r=1),o&&(e.color=Ha(o[0],o[1],o[2]),e.opacity=r*o[3])},Ja=function(e,t,r,o){var n,i,a="fill"==t,s=e.getElementsByTagName(t)[0];null!=r[t]&&"none"!==r[t]&&(a||!a&&r.lineWidth)?(e[a?"filled":"stroked"]="true",r[t]instanceof Bi&&Ya(e,s),s||(s=xa(t)),a?function(e,t,r){var o,n,i=t.fill;if(null!=i)if(i instanceof Bi){var a,s=0,d=[0,0],l=0,u=1,c=r.getBoundingRect(),p=c.width,h=c.height;if("linear"===i.type){a="gradient";var f=r.transform,m=[i.x*p,i.y*h],g=[i.x2*p,i.y2*h];f&&(oe(m,m,f),oe(g,g,f));var v=g[0]-m[0],y=g[1]-m[1];(s=180*Math.atan2(v,y)/Math.PI)<0&&(s+=360),s<1e-6&&(s=0)}else{a="gradientradial",m=[i.x*p,i.y*h],f=r.transform;var b=r.scale,_=p,w=h;d=[(m[0]-c.x)/_,(m[1]-c.y)/w],f&&oe(m,m,f),_/=b[0]*Fa,w/=b[1]*Fa;var S=Ba(_,w);l=0/S,u=2*i.r/S-l}var E=i.colorStops.slice();E.sort(function(e,t){return e.offset-t.offset});for(var I=E.length,T=[],R=[],C=0;C<I;C++){var P=E[C],M=(o=P.color,n=Je(o),[Ha(n[0],n[1],n[2]),n[3]]);R.push(P.offset*u+l+" "+M[0]),0!==C&&C!==I-1||T.push(M)}if(2<=I){var x=T[0][0],A=T[1][0],k=T[0][1]*t.opacity,O=T[1][1]*t.opacity;e.type=a,e.method="none",e.focus="100%",e.angle=s,e.color=x,e.color2=A,e.colors=R.join(","),e.opacity=O,e.opacity2=k}"radial"===a&&(e.focusposition=d.join(","))}else Xa(e,i,t.opacity)}(s,r,o):(n=s,null!=(i=r).lineDash&&(n.dashstyle=i.lineDash.join(" ")),null==i.stroke||i.stroke instanceof Bi||Xa(n,i.stroke,i.opacity)),Wa(e,s)):(e[a?"filled":"stroked"]="false",Ya(e,s))},Qa=[[],[],[]];Nn.prototype.brushVML=function(e){var t=this.style,r=this._vmlEl;r||(r=xa("shape"),Ga(r),this._vmlEl=r),Ja(r,"fill",t,this),Ja(r,"stroke",t,this);var o=this.transform,n=null!=o,i=r.getElementsByTagName("stroke")[0];if(i){var a=t.lineWidth;if(n&&!t.strokeNoScale){var s=o[0]*o[3]-o[1]*o[2];a*=Ua(La(s))}i.weight=a+"px"}var d=this.path||(this.path=new gn);this.__dirtyPath&&(d.beginPath(),this.buildPath(d,this.shape),d.toStatic(),this.__dirtyPath=!1),r.path=function(e,t){var r,o,n,i,a,s,d=ka.M,l=ka.C,u=ka.L,c=ka.A,p=ka.Q,h=[],f=e.data,m=e.len();for(i=0;i<m;){switch(o="",r=0,n=f[i++]){case d:o=" m ",r=1,a=f[i++],s=f[i++],Qa[0][0]=a,Qa[0][1]=s;break;case u:o=" l ",r=1,a=f[i++],s=f[i++],Qa[0][0]=a,Qa[0][1]=s;break;case p:case l:o=" c ",r=3;var g,v,y=f[i++],b=f[i++],_=f[i++],w=f[i++];n===p?(_=((g=_)+2*y)/3,w=((v=w)+2*b)/3,y=(a+2*y)/3,b=(s+2*b)/3):(g=f[i++],v=f[i++]),Qa[0][0]=y,Qa[0][1]=b,Qa[1][0]=_,Qa[1][1]=w,a=Qa[2][0]=g,s=Qa[2][1]=v;break;case c:var S=0,E=0,I=1,T=1,R=0;t&&(S=t[4],E=t[5],I=Ua(t[0]*t[0]+t[1]*t[1]),T=Ua(t[2]*t[2]+t[3]*t[3]),R=Math.atan2(-t[1]/T,t[0]/I));var C=f[i++],P=f[i++],M=f[i++],x=f[i++],A=f[i++]+R,k=f[i++]+A+R;i++;var O=f[i++],U=C+Da(A)*M,L=P+Na(A)*x,D=(y=C+Da(k)*M,b=P+Na(k)*x,O?" wa ":" at ");Math.abs(U-y)<1e-4&&(.01<Math.abs(k-A)?O&&(U+=.0125):Math.abs(L-P)<1e-4?O&&U<C||!O&&C<U?b-=.0125:b+=.0125:O&&L<P||!O&&P<L?y+=.0125:y-=.0125),h.push(D,Oa(((C-M)*I+S)*Fa-qa),ja,Oa(((P-x)*T+E)*Fa-qa),ja,Oa(((C+M)*I+S)*Fa-qa),ja,Oa(((P+x)*T+E)*Fa-qa),ja,Oa((U*I+S)*Fa-qa),ja,Oa((L*T+E)*Fa-qa),ja,Oa((y*I+S)*Fa-qa),ja,Oa((b*T+E)*Fa-qa)),a=y,s=b;break;case ka.R:var N=Qa[0],B=Qa[1];N[0]=f[i++],N[1]=f[i++],B[0]=N[0]+f[i++],B[1]=N[1]+f[i++],t&&(oe(N,N,t),oe(B,B,t)),N[0]=Oa(N[0]*Fa-qa),B[0]=Oa(B[0]*Fa-qa),N[1]=Oa(N[1]*Fa-qa),B[1]=Oa(B[1]*Fa-qa),h.push(" m ",N[0],ja,N[1]," l ",B[0],ja,N[1]," l ",B[0],ja,B[1]," l ",N[0],ja,B[1]);break;case ka.Z:h.push(" x ")}if(0<r){h.push(o);for(var j=0;j<r;j++){var V=Qa[j];t&&oe(V,V,t),h.push(Oa(V[0]*Fa-qa),ja,Oa(V[1]*Fa-qa),j<r-1?ja:"")}}}return h.join("")}(d,this.transform),r.style.zIndex=za(this.zlevel,this.z,this.z2),Wa(e,r),null!=t.text?this.drawRectText(e,this.getBoundingRect()):this.removeRectText(e)},Nn.prototype.onRemove=function(e){Ya(e,this._vmlEl),this.removeRectText(e)},Nn.prototype.onAdd=function(e){Wa(e,this._vmlEl),this.appendRectText(e)};Kr.prototype.brushVML=function(e){var t,r,o,n=this.style,i=n.image;if("object"==typeof(o=i)&&o.tagName&&"IMG"===o.tagName.toUpperCase()){var a=i.src;if(a===this._imageSrc)t=this._imageWidth,r=this._imageHeight;else{var s=i.runtimeStyle,d=s.width,l=s.height;s.width="auto",s.height="auto",t=i.width,r=i.height,s.width=d,s.height=l,this._imageSrc=a,this._imageWidth=t,this._imageHeight=r}i=a}else i===this._imageSrc&&(t=this._imageWidth,r=this._imageHeight);if(i){var u=n.x||0,c=n.y||0,p=n.width,h=n.height,f=n.sWidth,m=n.sHeight,g=n.sx||0,v=n.sy||0,y=f&&m,b=this._vmlEl;b||(b=Ma.createElement("div"),Ga(b),this._vmlEl=b);var _,w=b.style,S=!1,E=1,I=1;if(this.transform&&(_=this.transform,E=Ua(_[0]*_[0]+_[1]*_[1]),I=Ua(_[2]*_[2]+_[3]*_[3]),S=_[1]||_[2]),S){var T=[u,c],R=[u+p,c],C=[u,c+h],P=[u+p,c+h];oe(T,T,_),oe(R,R,_),oe(C,C,_),oe(P,P,_);var M=Ba(T[0],R[0],C[0],P[0]),x=Ba(T[1],R[1],C[1],P[1]),A=[];A.push("M11=",_[0]/E,ja,"M12=",_[2]/I,ja,"M21=",_[1]/E,ja,"M22=",_[3]/I,ja,"Dx=",Oa(u*E+_[4]),ja,"Dy=",Oa(c*I+_[5])),w.padding="0 "+Oa(M)+"px "+Oa(x)+"px 0",w.filter=Va+".Matrix("+A.join("")+", SizingMethod=clip)"}else _&&(u=u*E+_[4],c=c*I+_[5]),w.filter="",w.left=Oa(u)+"px",w.top=Oa(c)+"px";var k=this._imageEl,O=this._cropEl;k||(k=Ma.createElement("div"),this._imageEl=k);var U=k.style;if(y){if(t&&r)U.width=Oa(E*t*p/f)+"px",U.height=Oa(I*r*h/m)+"px";else{var L=new Image,D=this;L.onload=function(){L.onload=null,t=L.width,r=L.height,U.width=Oa(E*t*p/f)+"px",U.height=Oa(I*r*h/m)+"px",D._imageWidth=t,D._imageHeight=r,D._imageSrc=i},L.src=i}O||((O=Ma.createElement("div")).style.overflow="hidden",this._cropEl=O);var N=O.style;N.width=Oa((p+g*p/f)*E),N.height=Oa((h+v*h/m)*I),N.filter=Va+".Matrix(Dx="+-g*p/f*E+",Dy="+-v*h/m*I+")",O.parentNode||b.appendChild(O),k.parentNode!=O&&O.appendChild(k)}else U.width=Oa(E*p)+"px",U.height=Oa(I*h)+"px",b.appendChild(k),O&&O.parentNode&&(b.removeChild(O),this._cropEl=null);var B="",j=n.opacity;j<1&&(B+=".Alpha(opacity="+Oa(100*j)+") "),B+=Va+".AlphaImageLoader(src="+i+", SizingMethod=scale)",U.filter=B,b.style.zIndex=za(this.zlevel,this.z,this.z2),Wa(e,b),null!=n.text&&this.drawRectText(e,this.getBoundingRect())}},Kr.prototype.onRemove=function(e){Ya(e,this._vmlEl),this._vmlEl=null,this._cropEl=null,this._imageEl=null,this.removeRectText(e)},Kr.prototype.onAdd=function(e){Wa(e,this._vmlEl),this.appendRectText(e)};var $a,Za="normal",es={},ts=0,rs=document.createElement("div");Aa=function(e,t){var r=Ma;$a||(($a=r.createElement("div")).style.cssText="position:absolute;top:-20000px;left:0;padding:0;margin:0;border:none;white-space:pre;",Ma.body.appendChild($a));try{$a.style.font=t}catch(e){}return $a.innerHTML="",$a.appendChild(r.createTextNode(e)),{width:$a.offsetWidth}},hr["measureText"]=Aa;for(var os=new At,ns=function(e,t,r,o){var n=this.style;this.__dirty&&xr(n);var i=n.text;if(null!=i&&(i+=""),i){if(n.rich){var a=Tr(i,n);i=[];for(var s=0;s<a.lines.length;s++){for(var d=a.lines[s].tokens,l=[],u=0;u<d.length;u++)l.push(d[u].text);i.push(l.join(""))}i=i.join("\n")}var c,p,h=n.textAlign,f=n.textVerticalAlign,m=function(e){var t=es[e];if(!t){100<ts&&(ts=0,es={});var r,o=rs.style;try{o.font=e,r=o.fontFamily.split(",")[0]}catch(e){}t={style:o.fontStyle||Za,variant:o.fontVariant||Za,weight:o.fontWeight||Za,size:0|parseFloat(o.fontSize||12),family:r||"Microsoft YaHei"},es[e]=t,ts++}return t}(n.font),g=m.style+" "+m.variant+" "+m.weight+" "+m.size+'px "'+m.family+'"';r=r||mr(i,g,h,f);var v=this.transform;if(v&&!o&&(os.copy(t),os.applyTransform(v),t=os),o)c=t.x,p=t.y;else{var y=n.textPosition,b=n.textDistance;if(y instanceof Array)c=t.x+Ka(y[0],t.width),p=t.y+Ka(y[1],t.height),h=h||"left";else{var _=yr(y,t,b);c=_.x,p=_.y,h=h||_.textAlign,f=f||_.textVerticalAlign}}c=gr(c,r.width,h),p=vr(p,r.height,f),p+=r.height/2;var w,S,E,I=xa,T=this._textVmlEl;T?S=(w=(E=T.firstChild).nextSibling).nextSibling:(T=I("line"),w=I("path"),S=I("textpath"),E=I("skew"),S.style["v-text-align"]="left",Ga(T),w.textpathok=!0,S.on=!0,T.from="0 0",T.to="1000 0.05",Wa(T,E),Wa(T,w),Wa(T,S),this._textVmlEl=T);var R=[c,p],C=T.style;v&&o?(oe(R,R,v),E.on=!0,E.matrix=v[0].toFixed(3)+ja+v[2].toFixed(3)+ja+v[1].toFixed(3)+ja+v[3].toFixed(3)+",0,0",E.offset=(Oa(R[0])||0)+","+(Oa(R[1])||0),E.origin="0 0",C.left="0px",C.top="0px"):(E.on=!1,C.left=Oa(c)+"px",C.top=Oa(p)+"px"),S.string=String(i).replace(/&/g,"&amp;").replace(/"/g,"&quot;");try{S.style.font=g}catch(e){}Ja(T,"fill",{fill:n.textFill,opacity:n.opacity},this),Ja(T,"stroke",{stroke:n.textStroke,opacity:n.opacity,lineDash:n.lineDash},this),T.style.zIndex=za(this.zlevel,this.z,this.z2),Wa(e,T)}},is=function(e){Ya(e,this._textVmlEl),this._textVmlEl=null},as=function(e){Wa(e,this._textVmlEl)},ss=[Yr,zr,Kr,Nn,ti],ds=0;ds<ss.length;ds++){var ls=ss[ds].prototype;ls.drawRectText=ns,ls.removeRectText=is,ls.appendRectText=as}ti.prototype.brushVML=function(e){var t=this.style;null!=t.text?this.drawRectText(e,{x:t.x||0,y:t.y||0,width:0,height:0},this.getBoundingRect(),!0):this.removeRectText(e)},ti.prototype.onRemove=function(e){this.removeRectText(e)},ti.prototype.onAdd=function(e){this.appendRectText(e)}}function us(e){return parseInt(e,10)}function cs(e,t){!function(){if(!Pa&&Ma){Pa=!0;var e=Ma.styleSheets;e.length<31?Ma.createStyleSheet().addRule(".zrvml","behavior:url(#default#VML)"):e[0].addRule(".zrvml","behavior:url(#default#VML)")}}(),this.root=e,this.storage=t;var r=document.createElement("div"),o=document.createElement("div");r.style.cssText="display:inline-block;overflow:hidden;position:relative;width:300px;height:150px;",o.style.cssText="position:absolute;left:0;top:0;",e.appendChild(r),this._vmlRoot=o,this._vmlViewport=r,this.resize();var n=t.delFromStorage,i=t.addToStorage;t.delFromStorage=function(e){n.call(t,e),e&&e.onRemove&&e.onRemove(o)},t.addToStorage=function(e){e.onAdd&&e.onAdd(o),i.call(t,e)},this._firstPaint=!0}cs.prototype={constructor:cs,getType:function(){return"vml"},getViewportRoot:function(){return this._vmlViewport},getViewportRootOffset:function(){var e=this.getViewportRoot();if(e)return{offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}},refresh:function(){var e=this.storage.getDisplayList(!0,!0);this._paintList(e)},_paintList:function(e){for(var t=this._vmlRoot,r=0;r<e.length;r++){var o=e[r];o.invisible||o.ignore?(o.__alreadyNotVisible||o.onRemove(t),o.__alreadyNotVisible=!0):(o.__alreadyNotVisible&&o.onAdd(t),o.__alreadyNotVisible=!1,o.__dirty&&(o.beforeBrush&&o.beforeBrush(),(o.brushVML||o.brush).call(o,t),o.afterBrush&&o.afterBrush())),o.__dirty=!1}this._firstPaint&&(this._vmlViewport.appendChild(t),this._firstPaint=!1)},resize:function(e,t){e=null==e?this._getWidth():e,t=null==t?this._getHeight():t;if(this._width!=e||this._height!=t){this._width=e,this._height=t;var r=this._vmlViewport.style;r.width=e+"px",r.height=t+"px"}},dispose:function(){this.root.innerHTML="",this._vmlRoot=this._vmlViewport=this.storage=null},getWidth:function(){return this._width},getHeight:function(){return this._height},clear:function(){this._vmlViewport&&this.root.removeChild(this._vmlViewport)},_getWidth:function(){var e=this.root,t=e.currentStyle;return(e.clientWidth||us(t.width))-us(t.paddingLeft)-us(t.paddingRight)|0},_getHeight:function(){var e=this.root,t=e.currentStyle;return(e.clientHeight||us(t.height))-us(t.paddingTop)-us(t.paddingBottom)|0}},I(["getLayer","insertLayer","eachLayer","eachBuiltinLayer","eachOtherLayer","getLayers","modLayer","delLayer","clearLayer","toDataURL","pathToImage"],function(e){var t;cs.prototype[e]=(t=e,function(){wt('In IE8.0 VML mode painter not support method "'+t+'"')})}),Eo("vml",cs),e.version="3.7.4",e.init=function(e,t){var r=new Io(o(),e,t);return So[r.id]=r},e.dispose=function(e){if(e)e.dispose();else{for(var t in So)So.hasOwnProperty(t)&&So[t].dispose();So={}}return this},e.getInstance=function(e){return So[e]},e.registerPainter=Eo,e.matrix=Te,e.vector=ae,e.color=ot,e.path=Zn,e.util=F,e.Group=kt,e.Path=Nn,e.Image=Kr,e.CompoundPath=ei,e.Text=ti,e.IncrementalDisplayable=ri,e.Arc=ni,e.BezierCurve=si,e.Circle=di,e.Droplet=li,e.Ellipse=ui,e.Heart=ci,e.Isogon=mi,e.Line=gi,e.Polygon=_i,e.Polyline=wi,e.Rect=Si,e.Ring=Ei,e.Rose=Pi,e.Arrowline=Ii,e.Sector=xi,e.Star=Ui,e.Trochoid=Ni,e.LinearGradient=ji,e.RadialGradient=Vi,e.Pattern=$t,e.BoundingRect=At}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).mqtt=e()}}(function(){return function i(a,s,d){function l(t,e){if(!s[t]){if(!a[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(u)return u(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var n=s[t]={exports:{}};a[t][0].call(n.exports,function(e){return l(a[t][1][e]||e)},n,n.exports,i,a,s,d)}return s[t].exports}for(var u="function"==typeof require&&require,e=0;e<d.length;e++)l(d[e]);return l}({1:[function(v,y,e){(function(d,e){"use strict";var o=v("events"),i=v("./store"),l=v("mqtt-packet"),u=v("readable-stream").Writable,t=v("inherits"),r=v("reinterval"),h=v("./validations"),f=v("xtend"),m=e.setImmediate||function(e){d.nextTick(e)},a={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:3e4,clean:!0,resubscribe:!0},c={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",6:"User repeat login",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};function p(e,t,r){e.emit("packetsend",t),!l.writeToStream(t,e.stream,e.options)&&r?e.stream.once("drain",r):r&&r()}function n(t,r,o,n){t.outgoingStore.put(r,function(e){if(e)return o&&o(e);n(),p(t,r,o)})}function g(){}function s(e,t){var r,n=this;if(!(this instanceof s))return new s(e,t);for(r in this.options=t||{},a)void 0===this.options[r]?this.options[r]=a[r]:this.options[r]=t[r];this.options.clientId="string"==typeof t.clientId?t.clientId:"mqttjs_"+Math.random().toString(16).substr(2,8),this.options.customHandleAcks=5===t.protocolVersion&&t.customHandleAcks?t.customHandleAcks:function(){arguments[3](0)},this.streamBuilder=e,this.outgoingStore=t.outgoingStore||new i,this.incomingStore=t.incomingStore||new i,this.queueQoSZero=void 0===t.queueQoSZero||t.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this.nextId=Math.max(1,Math.floor(65535*Math.random())),this.outgoing={},this._firstConnection=!0,this.on("close",function(){this.connected=!1,clearTimeout(this.connackTimer)}),this.on("connect",function(){var o=this.queue;!function t(){var e,r=o.shift();r&&(e=r.packet,n._sendPacket(e,function(e){r.cb&&r.cb(e),t()}))}()}),this.on("close",function(){null!==n.pingTimer&&(n.pingTimer.clear(),n.pingTimer=null)}),this.on("close",this._setupReconnect),o.EventEmitter.call(this),this._setupStream()}t(s,o.EventEmitter),s.prototype._setupStream=function(){var e,r=this,t=new u,o=l.parser(this.options),n=null,i=[];function a(){if(i.length)d.nextTick(s);else{var e=n;n=null,e()}}function s(){var e=i.shift();if(e)r._handlePacket(e,a);else{var t=n;n=null,t&&t()}}if(this._clearReconnect(),this.stream=this.streamBuilder(this),o.on("packet",function(e){i.push(e)}),t._write=function(e,t,r){n=r,o.parse(e),s()},this.stream.pipe(t),this.stream.on("error",g),this.stream.on("close",function(){var t;(t=r.outgoing)&&Object.keys(t).forEach(function(e){t[e].volatile&&"function"==typeof t[e].cb&&(t[e].cb(new Error("Connection closed")),delete t[e])}),r.emit("close")}),(e=Object.create(this.options)).cmd="connect",p(this,e),o.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return this.emit("error",new Error("Packet has no Authentication Method")),this;if(this.options.properties.authenticationMethod&&this.options.authPacket&&"object"==typeof this.options.authPacket)p(this,f({cmd:"auth",reasonCode:0},this.options.authPacket))}this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(function(){r._cleanUp(!0)},this.options.connectTimeout)},s.prototype._handlePacket=function(e,t){var r=this.options;if(5===r.protocolVersion&&r.properties&&r.properties.maximumPacketSize&&r.properties.maximumPacketSize<e.length)return this.emit("error",new Error("exceeding packets size "+e.cmd)),this.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),this;switch(this.emit("packetreceive",e),e.cmd){case"publish":this._handlePublish(e,t);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":this._handleAck(e),t();break;case"pubrel":this._handlePubrel(e,t);break;case"connack":this._handleConnack(e),t();break;case"pingresp":this._handlePingresp(e),t();break;case"disconnect":this._handleDisconnect(e),t()}},s.prototype._checkDisconnecting=function(e){return this.disconnecting&&(e?e(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting},s.prototype.publish=function(e,t,r,o){var n,i=this.options;"function"==typeof r&&(o=r,r=null);if(r=f({qos:0,retain:!1,dup:!1},r),this._checkDisconnecting(o))return this;switch(n={cmd:"publish",topic:e,payload:t,qos:r.qos,retain:r.retain,messageId:this._nextId(),dup:r.dup},5===i.protocolVersion&&(n.properties=r.properties,(!i.properties&&n.properties&&n.properties.topicAlias||r.properties&&i.properties&&(r.properties.topicAlias&&i.properties.topicAliasMaximum&&r.properties.topicAlias>i.properties.topicAliasMaximum||!i.properties.topicAliasMaximum&&r.properties.topicAlias))&&delete n.properties.topicAlias),r.qos){case 1:case 2:this.outgoing[n.messageId]={volatile:!1,cb:o||g},this._storeProcessing?(this._packetIdsDuringStoreProcessing[n.messageId]=!1,this._storePacket(n,void 0,r.cbStorePut)):this._sendPacket(n,void 0,r.cbStorePut);break;default:this._storeProcessing?this._storePacket(n,o,r.cbStorePut):this._sendPacket(n,o,r.cbStorePut)}return this},s.prototype.subscribe=function(){for(var e,t=new Array(arguments.length),r=0;r<arguments.length;r++)t[r]=arguments[r];var o,n=[],i=t.shift(),a=i.resubscribe,s=t.pop()||g,d=t.pop(),l=this,u=this.options.protocolVersion;if(delete i.resubscribe,"string"==typeof i&&(i=[i]),"function"!=typeof s&&(d=s,s=g),null!==(o=h.validateTopics(i)))return m(s,new Error("Invalid topic "+o)),this;if(this._checkDisconnecting(s))return this;var c={qos:0};if(5===u&&(c.nl=!1,c.rap=!1,c.rh=0),d=f(c,d),Array.isArray(i)?i.forEach(function(e){if(!l._resubscribeTopics.hasOwnProperty(e)||l._resubscribeTopics[e].qos<d.qos||a){var t={topic:e,qos:d.qos};5===u&&(t.nl=d.nl,t.rap=d.rap,t.rh=d.rh,t.properties=d.properties),n.push(t)}}):Object.keys(i).forEach(function(e){if(!l._resubscribeTopics.hasOwnProperty(e)||l._resubscribeTopics[e].qos<i[e].qos||a){var t={topic:e,qos:i[e].qos};5===u&&(t.nl=i[e].nl,t.rap=i[e].rap,t.rh=i[e].rh,t.properties=d.properties),n.push(t)}}),e={cmd:"subscribe",subscriptions:n,qos:1,retain:!1,dup:!1,messageId:this._nextId()},d.properties&&(e.properties=d.properties),n.length){if(this.options.resubscribe){var p=[];n.forEach(function(e){if(0<l.options.reconnectPeriod){var t={qos:e.qos};5===u&&(t.nl=e.nl||!1,t.rap=e.rap||!1,t.rh=e.rh||0,t.properties=e.properties),l._resubscribeTopics[e.topic]=t,p.push(e.topic)}}),l.messageIdToTopic[e.messageId]=p}return this.outgoing[e.messageId]={volatile:!0,cb:function(e,t){if(!e)for(var r=t.granted,o=0;o<r.length;o+=1)n[o].qos=r[o];s(e,n)}},this._sendPacket(e),this}s(null,[])},s.prototype.unsubscribe=function(){for(var e={cmd:"unsubscribe",qos:1,messageId:this._nextId()},t=this,r=new Array(arguments.length),o=0;o<arguments.length;o++)r[o]=arguments[o];var n=r.shift(),i=r.pop()||g,a=r.pop();return"string"==typeof n&&(n=[n]),"function"!=typeof i&&(a=i,i=g),this._checkDisconnecting(i)||("string"==typeof n?e.unsubscriptions=[n]:"object"==typeof n&&n.length&&(e.unsubscriptions=n),this.options.resubscribe&&e.unsubscriptions.forEach(function(e){delete t._resubscribeTopics[e]}),"object"==typeof a&&a.properties&&(e.properties=a.properties),this.outgoing[e.messageId]={volatile:!0,cb:i},this._sendPacket(e)),this},s.prototype.end=function(){var e=this,t=arguments[0],r=arguments[1],o=arguments[2];function n(){e.disconnected=!0,e.incomingStore.close(function(){e.outgoingStore.close(function(){o&&o.apply(null,arguments),e.emit("end")})}),e._deferredReconnect&&e._deferredReconnect()}function i(){e._cleanUp(t,m.bind(null,n),r)}return null!=t&&"boolean"==typeof t||(o=r||g,r=t,t=!1,"object"!=typeof r&&(o=r,r=null,"function"!=typeof o&&(o=g))),"object"!=typeof r&&(o=r,r=null),o=o||g,this.disconnecting||(this._clearReconnect(),this.disconnecting=!0,!t&&0<Object.keys(this.outgoing).length?this.once("outgoingEmpty",setTimeout.bind(null,i,10)):i()),this},s.prototype.removeOutgoingMessage=function(e){var t=this.outgoing[e]?this.outgoing[e].cb:null;return delete this.outgoing[e],this.outgoingStore.del({messageId:e},function(){t(new Error("Message removed"))}),this},s.prototype.reconnect=function(e){var t=this,r=function(){e?(t.options.incomingStore=e.incomingStore,t.options.outgoingStore=e.outgoingStore):(t.options.incomingStore=null,t.options.outgoingStore=null),t.incomingStore=t.options.incomingStore||new i,t.outgoingStore=t.options.outgoingStore||new i,t.disconnecting=!1,t.disconnected=!1,t._deferredReconnect=null,t._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=r:r(),this},s.prototype._reconnect=function(){this.emit("reconnect"),this._setupStream()},s.prototype._setupReconnect=function(){var e=this;!e.disconnecting&&!e.reconnectTimer&&0<e.options.reconnectPeriod&&(this.reconnecting||(this.emit("offline"),this.reconnecting=!0),e.reconnectTimer=setInterval(function(){e._reconnect()},e.options.reconnectPeriod))},s.prototype._clearReconnect=function(){this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)},s.prototype._cleanUp=function(e,t){var r,o=arguments[2];if(t&&this.stream.on("close",t),e)0===this.options.reconnectPeriod&&this.options.clean&&(r=this.outgoing)&&Object.keys(r).forEach(function(e){"function"==typeof r[e].cb&&(r[e].cb(new Error("Connection closed")),delete r[e])}),this.stream.destroy();else{var n=f({cmd:"disconnect"},o);this._sendPacket(n,m.bind(null,this.stream.end.bind(this.stream)))}this.disconnecting||(this._clearReconnect(),this._setupReconnect()),null!==this.pingTimer&&(this.pingTimer.clear(),this.pingTimer=null),t&&!this.connected&&(this.stream.removeListener("close",t),t())},s.prototype._sendPacket=function(e,t,r){if(r=r||g,this.connected){switch(this._shiftPingInterval(),e.cmd){case"publish":break;case"pubrel":return void n(this,e,t,r);default:return void p(this,e,t)}switch(e.qos){case 2:case 1:n(this,e,t,r);break;case 0:default:p(this,e,t)}}else this._storePacket(e,t,r)},s.prototype._storePacket=function(e,t,r){r=r||g,0===(e.qos||0)&&this.queueQoSZero||"publish"!==e.cmd?this.queue.push({packet:e,cb:t}):0<e.qos?(t=this.outgoing[e.messageId]?this.outgoing[e.messageId].cb:null,this.outgoingStore.put(e,function(e){if(e)return t&&t(e);r()})):t&&t(new Error("No connection to broker"))},s.prototype._setupPingTimer=function(){var e=this;!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=r(function(){e._checkPing()},1e3*this.options.keepalive))},s.prototype._shiftPingInterval=function(){this.pingTimer&&this.options.keepalive&&this.options.reschedulePings&&this.pingTimer.reschedule(1e3*this.options.keepalive)},s.prototype._checkPing=function(){this.pingResp?(this.pingResp=!1,this._sendPacket({cmd:"pingreq"})):this._cleanUp(!0)},s.prototype._handlePingresp=function(){this.pingResp=!0},s.prototype._handleConnack=function(e){var t=this.options,r=5===t.protocolVersion?e.reasonCode:e.returnCode;if(clearTimeout(this.connackTimer),e.properties&&(e.properties.topicAliasMaximum&&(t.properties||(t.properties={}),t.properties.topicAliasMaximum=e.properties.topicAliasMaximum),e.properties.serverKeepAlive&&t.keepalive&&(t.keepalive=e.properties.serverKeepAlive,this._shiftPingInterval()),e.properties.maximumPacketSize&&(t.properties||(t.properties={}),t.properties.maximumPacketSize=e.properties.maximumPacketSize)),0===r)this.reconnecting=!1,this._onConnect(e);else if(0<r){var o=new Error("Connection refused: "+c[r]);o.code=r,this.emit("error",o)}},s.prototype._handlePublish=function(r,o){o=void 0!==o?o:g;var n=r.topic.toString(),i=r.payload,e=r.qos,a=r.messageId,s=this,t=this.options,d=[0,16,128,131,135,144,145,151,153];switch(e){case 2:t.customHandleAcks(n,i,r,function(e,t){return e instanceof Error||(t=e,e=null),e?s.emit("error",e):-1===d.indexOf(t)?s.emit("error",new Error("Wrong reason code for pubrec")):void(t?s._sendPacket({cmd:"pubrec",messageId:a,reasonCode:t},o):s.incomingStore.put(r,function(){s._sendPacket({cmd:"pubrec",messageId:a},o)}))});break;case 1:t.customHandleAcks(n,i,r,function(e,t){return e instanceof Error||(t=e,e=null),e?s.emit("error",e):-1===d.indexOf(t)?s.emit("error",new Error("Wrong reason code for puback")):(t||s.emit("message",n,i,r),void s.handleMessage(r,function(e){if(e)return o&&o(e);s._sendPacket({cmd:"puback",messageId:a,reasonCode:t},o)}))});break;case 0:this.emit("message",n,i,r),this.handleMessage(r,o)}},s.prototype.handleMessage=function(e,t){t()},s.prototype._handleAck=function(e){var t,r=e.messageId,o=e.cmd,n=null,i=this.outgoing[r]?this.outgoing[r].cb:null,a=this;if(i){switch(o){case"pubcomp":case"puback":var s=e.reasonCode;s&&0<s&&16!==s&&((t=new Error("Publish error: "+c[s])).code=s,i(t,e)),delete this.outgoing[r],this.outgoingStore.del(e,i);break;case"pubrec":n={cmd:"pubrel",qos:2,messageId:r};var d=e.reasonCode;d&&0<d&&16!==d?((t=new Error("Publish error: "+c[d])).code=d,i(t,e)):this._sendPacket(n);break;case"suback":delete this.outgoing[r];for(var l=0;l<e.granted.length;l++)if(0!=(128&e.granted[l])){var u=this.messageIdToTopic[r];u&&u.forEach(function(e){delete a._resubscribeTopics[e]})}i(null,e);break;case"unsuback":delete this.outgoing[r],i(null);break;default:a.emit("error",new Error("unrecognized packet type"))}this.disconnecting&&0===Object.keys(this.outgoing).length&&this.emit("outgoingEmpty")}},s.prototype._handlePubrel=function(e,r){r=void 0!==r?r:g;var t=e.messageId,o=this,n={cmd:"pubcomp",messageId:t};o.incomingStore.get(e,function(e,t){e?o._sendPacket(n,r):(o.emit("message",t.topic,t.payload,t),o.handleMessage(t,function(e){if(e)return r(e);o.incomingStore.del(t,g),o._sendPacket(n,r)}))})},s.prototype._handleDisconnect=function(e){this.emit("disconnect",e)},s.prototype._nextId=function(){var e=this.nextId++;return 65536===this.nextId&&(this.nextId=1),e},s.prototype.getLastMessageId=function(){return 1===this.nextId?65535:this.nextId-1},s.prototype._resubscribe=function(e){var t=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||5===this.options.protocolVersion&&!e.sessionPresent)&&0<t.length)if(this.options.resubscribe)if(5===this.options.protocolVersion)for(var r=0;r<t.length;r++){var o={};o[t[r]]=this._resubscribeTopics[t[r]],o.resubscribe=!0,this.subscribe(o,{properties:o[t[r]].properties})}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1},s.prototype._onConnect=function(i){if(this.disconnected)this.emit("connect",i);else{var a=this;this._setupPingTimer(),this._resubscribe(i),this.connected=!0,function r(){var t=a.outgoingStore.createStream();function o(){a._storeProcessing=!1,a._packetIdsDuringStoreProcessing={}}function n(){t.destroy(),t=null,o()}a.once("close",n),t.on("error",function(e){o(),a.removeListener("close",n),a.emit("error",e)}),t.on("end",function(){var e=!0;for(var t in a._packetIdsDuringStoreProcessing)if(!a._packetIdsDuringStoreProcessing[t]){e=!1;break}e?(o(),a.removeListener("close",n),a.emit("connect",i)):r()}),function r(){if(t){a._storeProcessing=!0;var o,e=t.read(1);e?a._packetIdsDuringStoreProcessing[e.messageId]?r():a.disconnecting||a.reconnectTimer?t.destroy&&t.destroy():(o=a.outgoing[e.messageId]?a.outgoing[e.messageId].cb:null,a.outgoing[e.messageId]={volatile:!1,cb:function(e,t){o&&o(e,t),r()}},a._packetIdsDuringStoreProcessing[e.messageId]=!0,a._sendPacket(e)):t.once("readable",r)}}()}()}},y.exports=s}).call(this,v("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./store":7,"./validations":8,_process:92,events:13,inherits:80,"mqtt-packet":84,"readable-stream":108,reinterval:109,xtend:121}],2:[function(e,t,r){(function(u){"use strict";var c,p,h,f=e("readable-stream").Transform,m=e("duplexify"),g=e("base64-js"),v=!1;t.exports=function(e,t){if(t.hostname=t.hostname||t.host,!t.hostname)throw new Error("Could not determine host. Specify host manually.");var r,o="MQIsdp"===t.protocolId&&3===t.protocolVersion?"mqttv3.1":"mqtt";(r=t).hostname||(r.hostname="localhost"),r.path||(r.path="/"),r.wsOptions||(r.wsOptions={});var n,i,a,s,d,l=(i=e,a="alis"===(n=t).protocol?"wss":"ws",s=a+"://"+n.hostname+n.path,n.port&&80!==n.port&&443!==n.port&&(s=a+"://"+n.hostname+":"+n.port+n.path),"function"==typeof n.transformWsUrl&&(s=n.transformWsUrl(s,n,i)),s);return(c=t.my).connectSocket({url:l,protocols:o}),(d=new f)._write=function(e,t,r){c.sendSocketMessage({data:e.buffer,success:function(){r()},fail:function(){r(new Error)}})},d._flush=function(e){c.closeSocket({success:function(){e()}})},p=d,h=m.obj(),v||(v=!0,c.onSocketOpen(function(){h.setReadable(p),h.setWritable(p),h.emit("connect")}),c.onSocketMessage(function(e){if("string"==typeof e.data){var t=g.toByteArray(e.data),r=u.from(t);p.push(r)}else{var o=new FileReader;o.addEventListener("load",function(){var e=o.result;e=e instanceof ArrayBuffer?u.from(e):u.from(e,"utf8"),p.push(e)}),o.readAsArrayBuffer(e.data)}}),c.onSocketClose(function(){h.end(),h.destroy()}),c.onSocketError(function(e){h.destroy(e)})),h}}).call(this,e("buffer").Buffer)},{"base64-js":10,buffer:12,duplexify:17,"readable-stream":108}],3:[function(e,t,r){"use strict";var n=e("net");t.exports=function(e,t){var r,o;return t.port=t.port||1883,t.hostname=t.hostname||t.host||"localhost",r=t.port,o=t.hostname,n.createConnection(r,o)}},{net:11}],4:[function(e,t,r){"use strict";var n=e("tls");t.exports=function(t,r){var o;function e(e){r.rejectUnauthorized&&t.emit("error",e),o.end()}return r.port=r.port||8883,r.host=r.hostname||r.host||"localhost",r.rejectUnauthorized=!1!==r.rejectUnauthorized,delete r.path,(o=n.connect(r)).on("secureConnect",function(){r.rejectUnauthorized&&!o.authorized?o.emit("error",new Error("TLS not authorized")):o.removeListener("error",e)}),o.on("error",e),o}},{tls:11}],5:[function(t,r,e){(function(e){"use strict";var d=t("websocket-stream"),o=t("url"),l=["rejectUnauthorized","ca","cert","key","pfx","passphrase"],u="browser"===e.title;function n(e,t){var r,o="MQIsdp"===t.protocolId&&3===t.protocolVersion?"mqttv3.1":"mqtt";(r=t).hostname||(r.hostname="localhost"),r.port||("wss"===r.protocol?r.port=443:r.port=80),r.path||(r.path="/"),r.wsOptions||(r.wsOptions={}),u||"wss"!==r.protocol||l.forEach(function(e){r.hasOwnProperty(e)&&!r.wsOptions.hasOwnProperty(e)&&(r.wsOptions[e]=r[e])});var n,i,a,s=(i=e,a=(n=t).protocol+"://"+n.hostname+":"+n.port+n.path,"function"==typeof n.transformWsUrl&&(a=n.transformWsUrl(a,n,i)),a);return d(s,[o],t.wsOptions)}r.exports=u?function(e,t){if(t.hostname||(t.hostname=t.host),!t.hostname){if("undefined"==typeof document)throw new Error("Could not determine host. Specify host manually.");var r=o.parse(document.URL);t.hostname=r.hostname,t.port||(t.port=r.port)}return n(e,t)}:function(e,t){return n(e,t)}}).call(this,t("_process"))},{_process:92,url:113,"websocket-stream":118}],6:[function(e,t,r){(function(c,p){"use strict";var h,f,m,g=e("readable-stream").Transform,v=e("duplexify");t.exports=function(e,t){if(t.hostname=t.hostname||t.host,!t.hostname)throw new Error("Could not determine host. Specify host manually.");var r,o="MQIsdp"===t.protocolId&&3===t.protocolVersion?"mqttv3.1":"mqtt";(r=t).hostname||(r.hostname="localhost"),r.path||(r.path="/"),r.wsOptions||(r.wsOptions={});var n,i,a,s,d,l=(i=e,a="wxs"===(n=t).protocol?"wss":"ws",s=a+"://"+n.hostname+n.path,n.port&&80!==n.port&&443!==n.port&&(s=a+"://"+n.hostname+":"+n.port+n.path),"function"==typeof n.transformWsUrl&&(s=n.transformWsUrl(s,n,i)),s);h=wx.connectSocket({url:l,protocols:o}),(d=new g)._write=function(e,t,r){h.send({data:e.buffer,success:function(){r()},fail:function(e){r(new Error(e))}})},d._flush=function(e){h.close({success:function(){e()}})},f=d,(m=v.obj())._destroy=function(e,t){h.close({success:function(){t&&t(e)}})};var u=m.destroy;return m.destroy=function(){m.destroy=u;var e=this;c.nextTick(function(){h.close({fail:function(){e._destroy(new Error)}})})}.bind(m),h.onOpen(function(){m.setReadable(f),m.setWritable(f),m.emit("connect")}),h.onMessage(function(e){var t=e.data;t=t instanceof ArrayBuffer?p.from(t):p.from(t,"utf8"),f.push(t)}),h.onClose(function(){m.end(),m.destroy()}),h.onError(function(e){m.destroy(new Error(e.errMsg))}),m}}).call(this,e("_process"),e("buffer").Buffer)},{_process:92,buffer:12,duplexify:17,"readable-stream":108}],7:[function(e,d,t){(function(n){"use strict";var t=e("xtend"),i=e("readable-stream").Readable,a={objectMode:!0},r={clean:!0},o=e("es6-map");function s(e){if(!(this instanceof s))return new s(e);this.options=e||{},this.options=t(r,e),this._inflights=new o}s.prototype.put=function(e,t){return this._inflights.set(e.messageId,e),t&&t(),this},s.prototype.createStream=function(){var e=new i(a),t=!1,r=[],o=0;return this._inflights.forEach(function(e,t){r.push(e)}),e._read=function(){!t&&o<r.length?this.push(r[o++]):this.push(null)},e.destroy=function(){if(!t){var e=this;t=!0,n.nextTick(function(){e.emit("close")})}},e},s.prototype.del=function(e,t){return(e=this._inflights.get(e.messageId))?(this._inflights.delete(e.messageId),t(null,e)):t&&t(new Error("missing packet")),this},s.prototype.get=function(e,t){return(e=this._inflights.get(e.messageId))?t(null,e):t&&t(new Error("missing packet")),this},s.prototype.close=function(e){this.options.clean&&(this._inflights=null),e&&e()},d.exports=s}).call(this,e("_process"))},{_process:92,"es6-map":67,"readable-stream":108,xtend:121}],8:[function(e,t,r){"use strict";function o(e){for(var t=e.split("/"),r=0;r<t.length;r++)if("+"!==t[r]){if("#"===t[r])return r===t.length-1;if(-1!==t[r].indexOf("+")||-1!==t[r].indexOf("#"))return!1}return!0}t.exports={validateTopics:function(e){if(0===e.length)return"empty_topic_list";for(var t=0;t<e.length;t++)if(!o(e[t]))return e[t];return null}}},{}],9:[function(o,n,e){(function(e){"use strict";var a=o("../client"),t=o("../store"),s=o("url"),d=o("xtend"),l={};function r(e,t){if("object"!=typeof e||t||(t=e,e=null),t=t||{},e){var r=s.parse(e,!0);if(null!=r.port&&(r.port=Number(r.port)),null===(t=d(r,t)).protocol)throw new Error("Missing protocol");t.protocol=t.protocol.replace(/:$/,"")}var o,n;if((o=t).auth&&((n=o.auth.match(/^(.+):(.+)$/))?(o.username=n[1],o.password=n[2]):o.username=o.auth),t.query&&"string"==typeof t.query.clientId&&(t.clientId=t.query.clientId),t.cert&&t.key){if(!t.protocol)throw new Error("Missing secure protocol key");if(-1===["mqtts","wss","wxs","alis"].indexOf(t.protocol))switch(t.protocol){case"mqtt":t.protocol="mqtts";break;case"ws":t.protocol="wss";break;case"wx":t.protocol="wxs";break;case"ali":t.protocol="alis";break;default:throw new Error('Unknown protocol for secure connection: "'+t.protocol+'"!')}}if(!l[t.protocol]){var i=-1!==["mqtts","wss"].indexOf(t.protocol);t.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter(function(e,t){return(!i||t%2!=0)&&"function"==typeof l[e]})[0]}if(!1===t.clean&&!t.clientId)throw new Error("Missing clientId for unclean clients");return t.protocol&&(t.defaultProtocol=t.protocol),new a(function(e){return t.servers&&(e._reconnectCount&&e._reconnectCount!==t.servers.length||(e._reconnectCount=0),t.host=t.servers[e._reconnectCount].host,t.port=t.servers[e._reconnectCount].port,t.protocol=t.servers[e._reconnectCount].protocol?t.servers[e._reconnectCount].protocol:t.defaultProtocol,t.hostname=t.host,e._reconnectCount++),l[t.protocol](e,t)},t)}"browser"!==e.title?(l.mqtt=o("./tcp"),l.tcp=o("./tcp"),l.ssl=o("./tls"),l.tls=o("./tls"),l.mqtts=o("./tls")):(l.wx=o("./wx"),l.wxs=o("./wx"),l.ali=o("./ali"),l.alis=o("./ali")),l.ws=o("./ws"),l.wss=o("./ws"),n.exports=r,n.exports.connect=r,n.exports.MqttClient=a,n.exports.Store=t}).call(this,o("_process"))},{"../client":1,"../store":7,"./ali":2,"./tcp":3,"./tls":4,"./ws":5,"./wx":6,_process:92,url:113,xtend:121}],10:[function(e,t,r){"use strict";r.byteLength=function(e){var t=h(e),r=t[0],o=t[1];return 3*(r+o)/4-o},r.toByteArray=function(e){for(var t,r=h(e),o=r[0],n=r[1],i=new p((l=o,u=n,3*(l+u)/4-u)),a=0,s=0<n?o-4:o,d=0;d<s;d+=4)t=c[e.charCodeAt(d)]<<18|c[e.charCodeAt(d+1)]<<12|c[e.charCodeAt(d+2)]<<6|c[e.charCodeAt(d+3)],i[a++]=t>>16&255,i[a++]=t>>8&255,i[a++]=255&t;var l,u;2===n&&(t=c[e.charCodeAt(d)]<<2|c[e.charCodeAt(d+1)]>>4,i[a++]=255&t);1===n&&(t=c[e.charCodeAt(d)]<<10|c[e.charCodeAt(d+1)]<<4|c[e.charCodeAt(d+2)]>>2,i[a++]=t>>8&255,i[a++]=255&t);return i},r.fromByteArray=function(e){for(var t,r=e.length,o=r%3,n=[],i=0,a=r-o;i<a;i+=16383)n.push(d(e,i,a<i+16383?a:i+16383));1===o?(t=e[r-1],n.push(s[t>>2]+s[t<<4&63]+"==")):2===o&&(t=(e[r-2]<<8)+e[r-1],n.push(s[t>>10]+s[t>>4&63]+s[t<<2&63]+"="));return n.join("")};for(var s=[],c=[],p="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,i=o.length;n<i;++n)s[n]=o[n],c[o.charCodeAt(n)]=n;function h(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function d(e,t,r){for(var o,n,i=[],a=t;a<r;a+=3)o=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),i.push(s[(n=o)>>18&63]+s[n>>12&63]+s[n>>6&63]+s[63&n]);return i.join("")}c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},{}],11:[function(e,t,r){},{}],12:[function(e,t,r){"use strict";var o=e("base64-js"),i=e("ieee754");r.Buffer=c,r.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},r.INSPECT_MAX_BYTES=50;var n=2147483647;function a(e){if(n<e)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=c.prototype,t}function c(e,t,r){if("number"!=typeof e)return s(e,t,r);if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return l(e)}function s(e,t,r){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!c.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|h(e,t),o=a(r),n=o.write(e,t);n!==r&&(o=o.slice(0,n));return o}(e,t);if(ArrayBuffer.isView(e))return u(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(D(e,ArrayBuffer)||e&&D(e.buffer,ArrayBuffer))return function(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var o;o=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r);return o.__proto__=c.prototype,o}(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var o=e.valueOf&&e.valueOf();if(null!=o&&o!==e)return c.from(o,t,r);var n=function(e){if(c.isBuffer(e)){var t=0|p(e.length),r=a(t);return 0===r.length||e.copy(r,0,0,t),r}if(void 0!==e.length)return"number"!=typeof e.length||N(e.length)?a(0):u(e);if("Buffer"===e.type&&Array.isArray(e.data))return u(e.data)}(e);if(n)return n;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return c.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function d(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function l(e){return d(e),a(e<0?0:0|p(e))}function u(e){for(var t=e.length<0?0:0|p(e.length),r=a(t),o=0;o<t;o+=1)r[o]=255&e[o];return r}function p(e){if(n<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return 0|e}function h(e,t){if(c.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||D(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,o=2<arguments.length&&!0===arguments[2];if(!o&&0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return O(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return U(e).length;default:if(n)return o?-1:O(e).length;t=(""+t).toLowerCase(),n=!0}}function f(e,t,r){var o=e[t];e[t]=e[r],e[r]=o}function m(e,t,r,o,n){if(0===e.length)return-1;if("string"==typeof r?(o=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),N(r=+r)&&(r=n?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(n)return-1;r=e.length-1}else if(r<0){if(!n)return-1;r=0}if("string"==typeof t&&(t=c.from(t,o)),c.isBuffer(t))return 0===t.length?-1:g(e,t,r,o,n);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):g(e,[t],r,o,n);throw new TypeError("val must be string, number or Buffer")}function g(e,t,r,o,n){var i,a=1,s=e.length,d=t.length;if(void 0!==o&&("ucs2"===(o=String(o).toLowerCase())||"ucs-2"===o||"utf16le"===o||"utf-16le"===o)){if(e.length<2||t.length<2)return-1;s/=a=2,d/=2,r/=2}function l(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(n){var u=-1;for(i=r;i<s;i++)if(l(e,i)===l(t,-1===u?0:i-u)){if(-1===u&&(u=i),i-u+1===d)return u*a}else-1!==u&&(i-=i-u),u=-1}else for(s<r+d&&(r=s-d),i=r;0<=i;i--){for(var c=!0,p=0;p<d;p++)if(l(e,i+p)!==l(t,p)){c=!1;break}if(c)return i}return-1}function v(e,t,r,o){r=Number(r)||0;var n=e.length-r;o?n<(o=Number(o))&&(o=n):o=n;var i=t.length;i/2<o&&(o=i/2);for(var a=0;a<o;++a){var s=parseInt(t.substr(2*a,2),16);if(N(s))return a;e[r+a]=s}return a}function y(e,t,r,o){return L(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,o)}function b(e,t,r){return 0===t&&r===e.length?o.fromByteArray(e):o.fromByteArray(e.slice(t,r))}function _(e,t,r){r=Math.min(e.length,r);for(var o=[],n=t;n<r;){var i,a,s,d,l=e[n],u=null,c=239<l?4:223<l?3:191<l?2:1;if(n+c<=r)switch(c){case 1:l<128&&(u=l);break;case 2:128==(192&(i=e[n+1]))&&127<(d=(31&l)<<6|63&i)&&(u=d);break;case 3:i=e[n+1],a=e[n+2],128==(192&i)&&128==(192&a)&&2047<(d=(15&l)<<12|(63&i)<<6|63&a)&&(d<55296||57343<d)&&(u=d);break;case 4:i=e[n+1],a=e[n+2],s=e[n+3],128==(192&i)&&128==(192&a)&&128==(192&s)&&65535<(d=(15&l)<<18|(63&i)<<12|(63&a)<<6|63&s)&&d<1114112&&(u=d)}null===u?(u=65533,c=1):65535<u&&(u-=65536,o.push(u>>>10&1023|55296),u=56320|1023&u),o.push(u),n+=c}return function(e){var t=e.length;if(t<=w)return String.fromCharCode.apply(String,e);var r="",o=0;for(;o<t;)r+=String.fromCharCode.apply(String,e.slice(o,o+=w));return r}(o)}r.kMaxLength=n,(c.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),c.poolSize=8192,c.from=function(e,t,r){return s(e,t,r)},c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,c.alloc=function(e,t,r){return n=t,i=r,d(o=e),o<=0?a(o):void 0!==n?"string"==typeof i?a(o).fill(n,i):a(o).fill(n):a(o);var o,n,i},c.allocUnsafe=function(e){return l(e)},c.allocUnsafeSlow=function(e){return l(e)},c.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function(e,t){if(D(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),D(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,o=t.length,n=0,i=Math.min(r,o);n<i;++n)if(e[n]!==t[n]){r=e[n],o=t[n];break}return r<o?-1:o<r?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var r;if(void 0===t)for(r=t=0;r<e.length;++r)t+=e[r].length;var o=c.allocUnsafe(t),n=0;for(r=0;r<e.length;++r){var i=e[r];if(D(i,Uint8Array)&&(i=c.from(i)),!c.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(o,n),n+=i.length}return o},c.byteLength=h,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)f(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)f(this,t,t+3),f(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)f(this,t,t+7),f(this,t+1,t+6),f(this,t+2,t+5),f(this,t+3,t+4);return this},c.prototype.toLocaleString=c.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?_(this,0,e):function(e,t,r){var o=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return I(this,t,r);case"utf8":case"utf-8":return _(this,t,r);case"ascii":return S(this,t,r);case"latin1":case"binary":return E(this,t,r);case"base64":return b(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,t,r);default:if(o)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",t=r.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},c.prototype.compare=function(e,t,r,o,n){if(D(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===o&&(o=0),void 0===n&&(n=this.length),t<0||r>e.length||o<0||n>this.length)throw new RangeError("out of range index");if(n<=o&&r<=t)return 0;if(n<=o)return-1;if(r<=t)return 1;if(this===e)return 0;for(var i=(n>>>=0)-(o>>>=0),a=(r>>>=0)-(t>>>=0),s=Math.min(i,a),d=this.slice(o,n),l=e.slice(t,r),u=0;u<s;++u)if(d[u]!==l[u]){i=d[u],a=l[u];break}return i<a?-1:a<i?1:0},c.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},c.prototype.indexOf=function(e,t,r){return m(this,e,t,r,!0)},c.prototype.lastIndexOf=function(e,t,r){return m(this,e,t,r,!1)},c.prototype.write=function(e,t,r,o){if(void 0===t)o="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)o=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===o&&(o="utf8")):(o=r,r=void 0)}var n=this.length-t;if((void 0===r||n<r)&&(r=n),0<e.length&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");o||(o="utf8");for(var i,a,s,d,l,u,c,p,h,f=!1;;)switch(o){case"hex":return v(this,e,t,r);case"utf8":case"utf-8":return p=t,h=r,L(O(e,(c=this).length-p),c,p,h);case"ascii":return y(this,e,t,r);case"latin1":case"binary":return y(this,e,t,r);case"base64":return d=this,l=t,u=r,L(U(e),d,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return a=t,s=r,L(function(e,t){for(var r,o,n,i=[],a=0;a<e.length&&!((t-=2)<0);++a)r=e.charCodeAt(a),o=r>>8,n=r%256,i.push(n),i.push(o);return i}(e,(i=this).length-a),i,a,s);default:if(f)throw new TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),f=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var w=4096;function S(e,t,r){var o="";r=Math.min(e.length,r);for(var n=t;n<r;++n)o+=String.fromCharCode(127&e[n]);return o}function E(e,t,r){var o="";r=Math.min(e.length,r);for(var n=t;n<r;++n)o+=String.fromCharCode(e[n]);return o}function I(e,t,r){var o=e.length;(!t||t<0)&&(t=0),(!r||r<0||o<r)&&(r=o);for(var n="",i=t;i<r;++i)n+=k(e[i]);return n}function T(e,t,r){for(var o=e.slice(t,r),n="",i=0;i<o.length;i+=2)n+=String.fromCharCode(o[i]+256*o[i+1]);return n}function R(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(r<e+t)throw new RangeError("Trying to access beyond buffer length")}function C(e,t,r,o,n,i){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(n<t||t<i)throw new RangeError('"value" argument is out of bounds');if(r+o>e.length)throw new RangeError("Index out of range")}function P(e,t,r,o,n,i){if(r+o>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function M(e,t,r,o,n){return t=+t,r>>>=0,n||P(e,0,r,4),i.write(e,t,r,o,23,4),r+4}function x(e,t,r,o,n){return t=+t,r>>>=0,n||P(e,0,r,8),i.write(e,t,r,o,52,8),r+8}c.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),t<e&&(t=e);var o=this.subarray(e,t);return o.__proto__=c.prototype,o},c.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);for(var o=this[e],n=1,i=0;++i<t&&(n*=256);)o+=this[e+i]*n;return o},c.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);for(var o=this[e+--t],n=1;0<t&&(n*=256);)o+=this[e+--t]*n;return o},c.prototype.readUInt8=function(e,t){return e>>>=0,t||R(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return e>>>=0,t||R(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return e>>>=0,t||R(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return e>>>=0,t||R(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return e>>>=0,t||R(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);for(var o=this[e],n=1,i=0;++i<t&&(n*=256);)o+=this[e+i]*n;return(n*=128)<=o&&(o-=Math.pow(2,8*t)),o},c.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||R(e,t,this.length);for(var o=t,n=1,i=this[e+--o];0<o&&(n*=256);)i+=this[e+--o]*n;return(n*=128)<=i&&(i-=Math.pow(2,8*t)),i},c.prototype.readInt8=function(e,t){return e>>>=0,t||R(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){e>>>=0,t||R(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt16BE=function(e,t){e>>>=0,t||R(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},c.prototype.readInt32LE=function(e,t){return e>>>=0,t||R(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return e>>>=0,t||R(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return e>>>=0,t||R(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return e>>>=0,t||R(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return e>>>=0,t||R(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return e>>>=0,t||R(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,r,o){(e=+e,t>>>=0,r>>>=0,o)||C(this,e,t,r,Math.pow(2,8*r)-1,0);var n=1,i=0;for(this[t]=255&e;++i<r&&(n*=256);)this[t+i]=e/n&255;return t+r},c.prototype.writeUIntBE=function(e,t,r,o){(e=+e,t>>>=0,r>>>=0,o)||C(this,e,t,r,Math.pow(2,8*r)-1,0);var n=r-1,i=1;for(this[t+n]=255&e;0<=--n&&(i*=256);)this[t+n]=e/i&255;return t+r},c.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,1,255,0),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},c.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeIntLE=function(e,t,r,o){if(e=+e,t>>>=0,!o){var n=Math.pow(2,8*r-1);C(this,e,t,r,n-1,-n)}var i=0,a=1,s=0;for(this[t]=255&e;++i<r&&(a*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+r},c.prototype.writeIntBE=function(e,t,r,o){if(e=+e,t>>>=0,!o){var n=Math.pow(2,8*r-1);C(this,e,t,r,n-1,-n)}var i=r-1,a=1,s=0;for(this[t+i]=255&e;0<=--i&&(a*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+r},c.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},c.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},c.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},c.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||C(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},c.prototype.writeFloatLE=function(e,t,r){return M(this,e,t,!0,r)},c.prototype.writeFloatBE=function(e,t,r){return M(this,e,t,!1,r)},c.prototype.writeDoubleLE=function(e,t,r){return x(this,e,t,!0,r)},c.prototype.writeDoubleBE=function(e,t,r){return x(this,e,t,!1,r)},c.prototype.copy=function(e,t,r,o){if(!c.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),o||0===o||(o=this.length),t>=e.length&&(t=e.length),t||(t=0),0<o&&o<r&&(o=r),o===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),e.length-t<o-r&&(o=e.length-t+r);var n=o-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,o);else if(this===e&&r<t&&t<o)for(var i=n-1;0<=i;--i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,o),t);return n},c.prototype.fill=function(e,t,r,o){if("string"==typeof e){if("string"==typeof t?(o=t,t=0,r=this.length):"string"==typeof r&&(o=r,r=this.length),void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!c.isEncoding(o))throw new TypeError("Unknown encoding: "+o);if(1===e.length){var n=e.charCodeAt(0);("utf8"===o&&n<128||"latin1"===o)&&(e=n)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var a=c.isBuffer(e)?e:c.from(e,o),s=a.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=a[i%s]}return this};var A=/[^+/0-9A-Za-z-_]/g;function k(e){return e<16?"0"+e.toString(16):e.toString(16)}function O(e,t){var r;t=t||1/0;for(var o=e.length,n=null,i=[],a=0;a<o;++a){if(55295<(r=e.charCodeAt(a))&&r<57344){if(!n){if(56319<r){-1<(t-=3)&&i.push(239,191,189);continue}if(a+1===o){-1<(t-=3)&&i.push(239,191,189);continue}n=r;continue}if(r<56320){-1<(t-=3)&&i.push(239,191,189),n=r;continue}r=65536+(n-55296<<10|r-56320)}else n&&-1<(t-=3)&&i.push(239,191,189);if(n=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function U(e){return o.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(A,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function L(e,t,r,o){for(var n=0;n<o&&!(n+r>=t.length||n>=e.length);++n)t[n+r]=e[n];return n}function D(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function N(e){return e!=e}},{"base64-js":10,ieee754:79}],13:[function(e,t,r){var d=Object.create||function(e){var t=function(){};return t.prototype=e,new t},a=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return r},i=Function.prototype.bind||function(e){var t=this;return function(){return t.apply(e,arguments)}};function o(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=d(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}((t.exports=o).EventEmitter=o).prototype._events=void 0,o.prototype._maxListeners=void 0;var n,s=10;try{var l={};Object.defineProperty&&Object.defineProperty(l,"x",{value:0}),n=0===l.x}catch(e){n=!1}function u(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,r,o){var n,i,a;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((i=e._events)?(i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),a=i[t]):(i=e._events=d(null),e._eventsCount=0),a){if("function"==typeof a?a=i[t]=o?[r,a]:[a,r]:o?a.unshift(r):a.push(r),!a.warned&&(n=u(e))&&0<n&&a.length>n){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+' "'+String(t)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');s.name="MaxListenersExceededWarning",s.emitter=e,s.type=t,s.count=a.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",s.name,s.message)}}else a=i[t]=r,++e._eventsCount;return e}function p(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var e=new Array(arguments.length),t=0;t<e.length;++t)e[t]=arguments[t];this.listener.apply(this.target,e)}}function h(e,t,r){var o={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=i.call(p,o);return n.listener=r,o.wrapFn=n}function f(e,t,r){var o=e._events;if(!o)return[];var n=o[t];return n?"function"==typeof n?r?[n.listener||n]:[n]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(n):g(n,n.length):[]}function m(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function g(e,t){for(var r=new Array(t),o=0;o<t;++o)r[o]=e[o];return r}n?Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||e!=e)throw new TypeError('"defaultMaxListeners" must be a positive number');s=e}}):o.defaultMaxListeners=s,o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(e){var t,r,o,n,i,a,s="error"===e;if(a=this._events)s=s&&null==a.error;else if(!s)return!1;if(s){if(1<arguments.length&&(t=arguments[1]),t instanceof Error)throw t;var d=new Error('Unhandled "error" event. ('+t+")");throw d.context=t,d}if(!(r=a[e]))return!1;var l="function"==typeof r;switch(o=arguments.length){case 1:!function(e,t,r){if(t)e.call(r);else for(var o=e.length,n=g(e,o),i=0;i<o;++i)n[i].call(r)}(r,l,this);break;case 2:!function(e,t,r,o){if(t)e.call(r,o);else for(var n=e.length,i=g(e,n),a=0;a<n;++a)i[a].call(r,o)}(r,l,this,arguments[1]);break;case 3:!function(e,t,r,o,n){if(t)e.call(r,o,n);else for(var i=e.length,a=g(e,i),s=0;s<i;++s)a[s].call(r,o,n)}(r,l,this,arguments[1],arguments[2]);break;case 4:!function(e,t,r,o,n,i){if(t)e.call(r,o,n,i);else for(var a=e.length,s=g(e,a),d=0;d<a;++d)s[d].call(r,o,n,i)}(r,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(o-1),i=1;i<o;i++)n[i-1]=arguments[i];!function(e,t,r,o){if(t)e.apply(r,o);else for(var n=e.length,i=g(e,n),a=0;a<n;++a)i[a].apply(r,o)}(r,l,this,n)}return!0},o.prototype.on=o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,h(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,h(this,e,t)),this},o.prototype.removeListener=function(e,t){var r,o,n,i,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(o=this._events))return this;if(!(r=o[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=d(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,i=r.length-1;0<=i;i--)if(r[i]===t||r[i].listener===t){a=r[i].listener,n=i;break}if(n<0)return this;0===n?r.shift():function(e,t){for(var r=t,o=r+1,n=e.length;o<n;r+=1,o+=1)e[r]=e[o];e.pop()}(r,n),1===r.length&&(o[e]=r[0]),o.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.removeAllListeners=function(e){var t,r,o;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=d(null),this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=d(null):delete r[e]),this;if(0===arguments.length){var n,i=a(r);for(o=0;o<i.length;++o)"removeListener"!==(n=i[o])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=d(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)for(o=t.length-1;0<=o;o--)this.removeListener(e,t[o]);return this},o.prototype.listeners=function(e){return f(this,e,!0)},o.prototype.rawListeners=function(e){return f(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},o.prototype.listenerCount=m,o.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],14:[function(e,t,r){(function(e){function t(e){return Object.prototype.toString.call(e)}r.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===t(e)},r.isBoolean=function(e){return"boolean"==typeof e},r.isNull=function(e){return null===e},r.isNullOrUndefined=function(e){return null==e},r.isNumber=function(e){return"number"==typeof e},r.isString=function(e){return"string"==typeof e},r.isSymbol=function(e){return"symbol"==typeof e},r.isUndefined=function(e){return void 0===e},r.isRegExp=function(e){return"[object RegExp]"===t(e)},r.isObject=function(e){return"object"==typeof e&&null!==e},r.isDate=function(e){return"[object Date]"===t(e)},r.isError=function(e){return"[object Error]"===t(e)||e instanceof Error},r.isFunction=function(e){return"function"==typeof e},r.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},r.isBuffer=e.isBuffer}).call(this,{isBuffer:e("../../is-buffer/index.js")})},{"../../is-buffer/index.js":81}],15:[function(e,t,r){"use strict";var o,i=e("es5-ext/object/copy"),n=e("es5-ext/object/normalize-options"),a=e("es5-ext/object/valid-callable"),s=e("es5-ext/object/map"),d=e("es5-ext/object/valid-callable"),l=e("es5-ext/object/valid-value"),u=Function.prototype.bind,c=Object.defineProperty,p=Object.prototype.hasOwnProperty;o=function(e,t,r){var o,n=l(t)&&d(t.value);return delete(o=i(t)).writable,delete o.value,o.get=function(){return!r.overwriteDefinition&&p.call(this,e)?n:(t.value=u.call(n,r.resolveContext?r.resolveContext(this):this),c(this,e,t),this[e])},o},t.exports=function(e){var r=n(arguments[1]);return null!=r.resolveContext&&a(r.resolveContext),s(e,function(e,t){return o(t,e,r)})}},{"es5-ext/object/copy":39,"es5-ext/object/map":48,"es5-ext/object/normalize-options":49,"es5-ext/object/valid-callable":54,"es5-ext/object/valid-value":55}],16:[function(e,t,r){"use strict";var s=e("es5-ext/object/assign"),d=e("es5-ext/object/normalize-options"),l=e("es5-ext/object/is-callable"),u=e("es5-ext/string/#/contains");(t.exports=function(e,t){var r,o,n,i,a;return arguments.length<2||"string"!=typeof e?(i=t,t=e,e=null):i=arguments[2],null==e?(r=n=!0,o=!1):(r=u.call(e,"c"),o=u.call(e,"e"),n=u.call(e,"w")),a={value:t,configurable:r,enumerable:o,writable:n},i?s(d(i),a):a}).gs=function(e,t,r){var o,n,i,a;return"string"!=typeof e?(i=r,r=t,t=e,e=null):i=arguments[3],null==t?t=void 0:l(t)?null==r?r=void 0:l(r)||(i=r,r=void 0):(i=t,t=r=void 0),n=null==e?!(o=!0):(o=u.call(e,"c"),u.call(e,"e")),a={get:t,set:r,configurable:o,enumerable:n},i?s(d(i),a):a}},{"es5-ext/object/assign":36,"es5-ext/object/is-callable":42,"es5-ext/object/normalize-options":49,"es5-ext/string/#/contains":56}],17:[function(u,c,e){(function(n,e){var a=u("readable-stream"),s=u("end-of-stream"),t=u("inherits"),r=u("stream-shift"),o=e.from&&e.from!==Uint8Array.from?e.from([0]):new e([0]),i=function(e,t){e._corked?e.once("uncork",t):t()},d=function(o,n){return function(e){var t,r;e?(t=o,r="premature close"===e.message?null:e,t._autoDestroy&&t.destroy(r)):n&&!o._ended&&o.end()}},l=function(e,t,r){if(!(this instanceof l))return new l(e,t,r);a.Duplex.call(this,r),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!r||!1!==r.autoDestroy,this._forwardDestroy=!r||!1!==r.destroy,this._forwardEnd=!r||!1!==r.end,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,e&&this.setWritable(e),t&&this.setReadable(t)};t(l,a.Duplex),l.obj=function(e,t,r){return r||(r={}),r.objectMode=!0,r.highWaterMark=16,new l(e,t,r)},l.prototype.cork=function(){1==++this._corked&&this.emit("cork")},l.prototype.uncork=function(){this._corked&&0==--this._corked&&this.emit("uncork")},l.prototype.setWritable=function(e){if(this._unwrite&&this._unwrite(),this.destroyed)e&&e.destroy&&e.destroy();else if(null!==e&&!1!==e){var t=this,r=s(e,{writable:!0,readable:!1},d(this,this._forwardEnd)),o=function(){var e=t._ondrain;t._ondrain=null,e&&e()};this._unwrite&&n.nextTick(o),this._writable=e,this._writable.on("drain",o),this._unwrite=function(){t._writable.removeListener("drain",o),r()},this.uncork()}else this.end()},l.prototype.setReadable=function(e){if(this._unread&&this._unread(),this.destroyed)e&&e.destroy&&e.destroy();else{if(null===e||!1===e)return this.push(null),void this.resume();var t,r=this,o=s(e,{writable:!1,readable:!0},d(this)),n=function(){r._forward()},i=function(){r.push(null)};this._drained=!0,this._readable=e,this._readable2=e._readableState?e:(t=e,new a.Readable({objectMode:!0,highWaterMark:16}).wrap(t)),this._readable2.on("readable",n),this._readable2.on("end",i),this._unread=function(){r._readable2.removeListener("readable",n),r._readable2.removeListener("end",i),o()},this._forward()}},l.prototype._read=function(){this._drained=!0,this._forward()},l.prototype._forward=function(){if(!this._forwarding&&this._readable2&&this._drained){var e;for(this._forwarding=!0;this._drained&&null!==(e=r(this._readable2));)this.destroyed||(this._drained=this.push(e));this._forwarding=!1}},l.prototype.destroy=function(e){if(!this.destroyed){this.destroyed=!0;var t=this;n.nextTick(function(){t._destroy(e)})}},l.prototype._destroy=function(e){if(e){var t=this._ondrain;this._ondrain=null,t?t(e):this.emit("error",e)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")},l.prototype._write=function(e,t,r){return this.destroyed?r():this._corked?i(this,this._write.bind(this,e,t,r)):e===o?this._finish(r):this._writable?void(!1===this._writable.write(e)?this._ondrain=r:r()):r()},l.prototype._finish=function(r){var o=this;this.emit("preend"),i(this,function(){var e,t;e=o._forwardEnd&&o._writable,t=function(){!1===o._writableState.prefinished&&(o._writableState.prefinished=!0),o.emit("prefinish"),i(o,r)},e?e._writableState&&e._writableState.finished?t():e._writableState?e.end(t):(e.end(),t()):t()})},l.prototype.end=function(e,t,r){return"function"==typeof e?this.end(null,null,e):"function"==typeof t?this.end(e,null,t):(this._ended=!0,e&&this.write(e),this._writableState.ending||this.write(o),a.Writable.prototype.end.call(this,r))},c.exports=l}).call(this,u("_process"),u("buffer").Buffer)},{_process:92,buffer:12,"end-of-stream":18,inherits:80,"readable-stream":108,"stream-shift":111}],18:[function(e,t,r){var g=e("once"),v=function(){},y=function(t,e,r){if("function"==typeof e)return y(t,null,e);e||(e={}),r=g(r||v);var o,n,i=t._writableState,a=t._readableState,s=e.readable||!1!==e.readable&&t.readable,d=e.writable||!1!==e.writable&&t.writable,l=function(){t.writable||u()},u=function(){d=!1,s||r.call(t)},c=function(){s=!1,d||r.call(t)},p=function(e){r.call(t,e?new Error("exited with error code: "+e):null)},h=function(e){r.call(t,e)},f=function(){return(!s||a&&a.ended)&&(!d||i&&i.ended)?void 0:r.call(t,new Error("premature close"))},m=function(){t.req.on("finish",u)};return(o=t).setHeader&&"function"==typeof o.abort?(t.on("complete",u),t.on("abort",f),t.req?m():t.on("request",m)):d&&!i&&(t.on("end",l),t.on("close",l)),(n=t).stdio&&Array.isArray(n.stdio)&&3===n.stdio.length&&t.on("exit",p),t.on("end",c),t.on("finish",u),!1!==e.error&&t.on("error",h),t.on("close",f),function(){t.removeListener("complete",u),t.removeListener("abort",f),t.removeListener("request",m),t.req&&t.req.removeListener("finish",u),t.removeListener("end",l),t.removeListener("close",l),t.removeListener("finish",u),t.removeListener("exit",p),t.removeListener("end",c),t.removeListener("error",h),t.removeListener("close",f)}};t.exports=y},{once:90}],19:[function(e,t,r){"use strict";var o=e("../../object/valid-value");t.exports=function(){return o(this).length=0,this}},{"../../object/valid-value":55}],20:[function(e,t,r){"use strict";var i=e("../../number/is-nan"),a=e("../../number/to-pos-integer"),s=e("../../object/valid-value"),d=Array.prototype.indexOf,l=Object.prototype.hasOwnProperty,u=Math.abs,c=Math.floor;t.exports=function(e){var t,r,o,n;if(!i(e))return d.apply(this,arguments);for(r=a(s(this).length),o=arguments[1],t=o=isNaN(o)?0:0<=o?c(o):a(this.length)-c(u(o));t<r;++t)if(l.call(this,t)&&(n=this[t],i(n)))return t;return-1}},{"../../number/is-nan":30,"../../number/to-pos-integer":34,"../../object/valid-value":55}],21:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Array.from:e("./shim")},{"./is-implemented":22,"./shim":23}],22:[function(e,t,r){"use strict";t.exports=function(){var e,t,r=Array.from;return"function"==typeof r&&(t=r(e=["raz","dwa"]),Boolean(t&&t!==e&&"dwa"===t[1]))}},{}],23:[function(e,t,r){"use strict";var h=e("es6-symbol").iterator,f=e("../../function/is-arguments"),m=e("../../function/is-function"),g=e("../../number/to-pos-integer"),v=e("../../object/valid-callable"),y=e("../../object/valid-value"),b=e("../../object/is-value"),_=e("../../string/is-string"),w=Array.isArray,S=Function.prototype.call,E={configurable:!0,enumerable:!0,writable:!0,value:null},I=Object.defineProperty;t.exports=function(e){var t,r,o,n,i,a,s,d,l,u,c=arguments[1],p=arguments[2];if(e=Object(y(e)),b(c)&&v(c),this&&this!==Array&&m(this))t=this;else{if(!c){if(f(e))return 1!==(i=e.length)?Array.apply(null,e):((n=new Array(1))[0]=e[0],n);if(w(e)){for(n=new Array(i=e.length),r=0;r<i;++r)n[r]=e[r];return n}}n=[]}if(!w(e))if(void 0!==(l=e[h])){for(s=v(l).call(e),t&&(n=new t),d=s.next(),r=0;!d.done;)u=c?S.call(c,p,d.value,r):d.value,t?(E.value=u,I(n,r,E)):n[r]=u,d=s.next(),++r;i=r}else if(_(e)){for(i=e.length,t&&(n=new t),o=r=0;r<i;++r)u=e[r],r+1<i&&55296<=(a=u.charCodeAt(0))&&a<=56319&&(u+=e[++r]),u=c?S.call(c,p,u,o):u,t?(E.value=u,I(n,o,E)):n[o]=u,++o;i=o}if(void 0===i)for(i=g(e.length),t&&(n=new t(i)),r=0;r<i;++r)u=c?S.call(c,p,e[r],r):e[r],t?(E.value=u,I(n,r,E)):n[r]=u;return t&&(E.value=null,n.length=i),n}},{"../../function/is-arguments":24,"../../function/is-function":25,"../../number/to-pos-integer":34,"../../object/is-value":44,"../../object/valid-callable":54,"../../object/valid-value":55,"../../string/is-string":59,"es6-symbol":73}],24:[function(e,t,r){"use strict";var o=Object.prototype.toString,n=o.call(function(){return arguments}());t.exports=function(e){return o.call(e)===n}},{}],25:[function(e,t,r){"use strict";var o=Object.prototype.toString,n=o.call(e("./noop"));t.exports=function(e){return"function"==typeof e&&o.call(e)===n}},{"./noop":26}],26:[function(e,t,r){"use strict";t.exports=function(){}},{}],27:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Math.sign:e("./shim")},{"./is-implemented":28,"./shim":29}],28:[function(e,t,r){"use strict";t.exports=function(){var e=Math.sign;return"function"==typeof e&&(1===e(10)&&-1===e(-20))}},{}],29:[function(e,t,r){"use strict";t.exports=function(e){return e=Number(e),isNaN(e)||0===e?e:0<e?1:-1}},{}],30:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Number.isNaN:e("./shim")},{"./is-implemented":31,"./shim":32}],31:[function(e,t,r){"use strict";t.exports=function(){var e=Number.isNaN;return"function"==typeof e&&(!e({})&&e(NaN)&&!e(34))}},{}],32:[function(e,t,r){"use strict";t.exports=function(e){return e!=e}},{}],33:[function(e,t,r){"use strict";var o=e("../math/sign"),n=Math.abs,i=Math.floor;t.exports=function(e){return isNaN(e)?0:0!==(e=Number(e))&&isFinite(e)?o(e)*i(n(e)):e}},{"../math/sign":27}],34:[function(e,t,r){"use strict";var o=e("./to-integer"),n=Math.max;t.exports=function(e){return n(0,o(e))}},{"./to-integer":33}],35:[function(e,t,r){"use strict";var s=e("./valid-callable"),d=e("./valid-value"),l=Function.prototype.bind,u=Function.prototype.call,c=Object.keys,p=Object.prototype.propertyIsEnumerable;t.exports=function(i,a){return function(r,o){var e,n=arguments[2],t=arguments[3];return r=Object(d(r)),s(o),e=c(r),t&&e.sort("function"==typeof t?l.call(t,r):void 0),"function"!=typeof i&&(i=e[i]),u.call(i,e,function(e,t){return p.call(r,e)?u.call(o,n,r[e],e,r,t):a})}}},{"./valid-callable":54,"./valid-value":55}],36:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Object.assign:e("./shim")},{"./is-implemented":37,"./shim":38}],37:[function(e,t,r){"use strict";t.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},{}],38:[function(e,t,r){"use strict";var a=e("../keys"),s=e("../valid-value"),d=Math.max;t.exports=function(t,r){var o,e,n,i=d(arguments.length,2);for(t=Object(s(t)),n=function(e){try{t[e]=r[e]}catch(e){o||(o=e)}},e=1;e<i;++e)r=arguments[e],a(r).forEach(n);if(void 0!==o)throw o;return t}},{"../keys":45,"../valid-value":55}],39:[function(e,t,r){"use strict";var i=e("../array/from"),a=e("./assign"),s=e("./valid-value");t.exports=function(t){var e=Object(s(t)),r=arguments[1],o=Object(arguments[2]);if(e!==t&&!r)return e;var n={};return r?i(r,function(e){(o.ensure||e in t)&&(n[e]=t[e])}):a(n,t),n}},{"../array/from":21,"./assign":36,"./valid-value":55}],40:[function(e,t,r){"use strict";var o,n,i,a,s=Object.create;e("./set-prototype-of/is-implemented")()||(o=e("./set-prototype-of/shim")),t.exports=o?1!==o.level?s:(a={configurable:(i={},!1),enumerable:(n={},!1),writable:!0,value:void 0},Object.getOwnPropertyNames(Object.prototype).forEach(function(e){i[e]="__proto__"!==e?a:{configurable:!0,enumerable:!1,writable:!0,value:void 0}}),Object.defineProperties(n,i),Object.defineProperty(o,"nullPolyfill",{configurable:!1,enumerable:!1,writable:!1,value:n}),function(e,t){return s(null===e?n:e,t)}):s},{"./set-prototype-of/is-implemented":52,"./set-prototype-of/shim":53}],41:[function(e,t,r){"use strict";t.exports=e("./_iterate")("forEach")},{"./_iterate":35}],42:[function(e,t,r){"use strict";t.exports=function(e){return"function"==typeof e}},{}],43:[function(e,t,r){"use strict";var o=e("./is-value"),n={function:!0,object:!0};t.exports=function(e){return o(e)&&n[typeof e]||!1}},{"./is-value":44}],44:[function(e,t,r){"use strict";var o=e("../function/noop")();t.exports=function(e){return e!==o&&null!==e}},{"../function/noop":26}],45:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Object.keys:e("./shim")},{"./is-implemented":46,"./shim":47}],46:[function(e,t,r){"use strict";t.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},{}],47:[function(e,t,r){"use strict";var o=e("../is-value"),n=Object.keys;t.exports=function(e){return n(o(e)?Object(e):e)}},{"../is-value":44}],48:[function(e,t,r){"use strict";var o=e("./valid-callable"),s=e("./for-each"),d=Function.prototype.call;t.exports=function(e,n){var i={},a=arguments[2];return o(n),s(e,function(e,t,r,o){i[t]=d.call(n,a,e,t,r,o)}),i}},{"./for-each":41,"./valid-callable":54}],49:[function(e,t,r){"use strict";var o=e("./is-value"),n=Array.prototype.forEach,i=Object.create;t.exports=function(e){var t=i(null);return n.call(arguments,function(e){o(e)&&function(e,t){var r;for(r in e)t[r]=e[r]}(Object(e),t)}),t}},{"./is-value":44}],50:[function(e,t,r){"use strict";var o=Array.prototype.forEach,n=Object.create;t.exports=function(e){var t=n(null);return o.call(arguments,function(e){t[e]=!0}),t}},{}],51:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Object.setPrototypeOf:e("./shim")},{"./is-implemented":52,"./shim":53}],52:[function(e,t,r){"use strict";var o=Object.create,n=Object.getPrototypeOf,i={};t.exports=function(){var e=Object.setPrototypeOf,t=arguments[0]||o;return"function"==typeof e&&n(e(t(null),i))===i}},{}],53:[function(e,t,r){"use strict";var n,o,i,a,s=e("../is-object"),d=e("../valid-value"),l=Object.prototype.isPrototypeOf,u=Object.defineProperty,c={configurable:!0,enumerable:!1,writable:!0,value:void 0};n=function(e,t){if(d(e),null===t||s(t))return e;throw new TypeError("Prototype must be null or an object")},t.exports=(o=function(){var e,t=Object.create(null),r={},o=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__");if(o){try{(e=o.set).call(t,r)}catch(e){}if(Object.getPrototypeOf(t)===r)return{set:e,level:2}}return t.__proto__=r,Object.getPrototypeOf(t)===r?{level:2}:((t={}).__proto__=r,Object.getPrototypeOf(t)===r&&{level:1})}())?(i=2===o.level?o.set?(a=o.set,function(e,t){return a.call(n(e,t),t),e}):function(e,t){return n(e,t).__proto__=t,e}:function e(t,r){var o;return n(t,r),(o=l.call(e.nullPolyfill,t))&&delete e.nullPolyfill.__proto__,null===r&&(r=e.nullPolyfill),t.__proto__=r,o&&u(e.nullPolyfill,"__proto__",c),t},Object.defineProperty(i,"level",{configurable:!1,enumerable:!1,writable:!1,value:o.level})):null,e("../create")},{"../create":40,"../is-object":43,"../valid-value":55}],54:[function(e,t,r){"use strict";t.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},{}],55:[function(e,t,r){"use strict";var o=e("./is-value");t.exports=function(e){if(!o(e))throw new TypeError("Cannot use null or undefined");return e}},{"./is-value":44}],56:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?String.prototype.contains:e("./shim")},{"./is-implemented":57,"./shim":58}],57:[function(e,t,r){"use strict";var o="razdwatrzy";t.exports=function(){return"function"==typeof o.contains&&(!0===o.contains("dwa")&&!1===o.contains("foo"))}},{}],58:[function(e,t,r){"use strict";var o=String.prototype.indexOf;t.exports=function(e){return-1<o.call(this,e,arguments[1])}},{}],59:[function(e,t,r){"use strict";var o=Object.prototype.toString,n=o.call("");t.exports=function(e){return"string"==typeof e||e&&"object"==typeof e&&(e instanceof String||o.call(e)===n)||!1}},{}],60:[function(e,t,r){"use strict";var o,n=e("es5-ext/object/set-prototype-of"),i=e("es5-ext/string/#/contains"),a=e("d"),s=e("es6-symbol"),d=e("./"),l=Object.defineProperty;o=t.exports=function(e,t){if(!(this instanceof o))throw new TypeError("Constructor requires 'new'");d.call(this,e),t=t?i.call(t,"key+value")?"key+value":i.call(t,"key")?"key":"value":"value",l(this,"__kind__",a("",t))},n&&n(o,d),delete o.prototype.constructor,o.prototype=Object.create(d.prototype,{_resolve:a(function(e){return"value"===this.__kind__?this.__list__[e]:"key+value"===this.__kind__?[e,this.__list__[e]]:e})}),l(o.prototype,s.toStringTag,a("c","Array Iterator"))},{"./":63,d:16,"es5-ext/object/set-prototype-of":51,"es5-ext/string/#/contains":56,"es6-symbol":73}],61:[function(e,t,r){"use strict";var c=e("es5-ext/function/is-arguments"),p=e("es5-ext/object/valid-callable"),h=e("es5-ext/string/is-string"),f=e("./get"),m=Array.isArray,g=Function.prototype.call,v=Array.prototype.some;t.exports=function(e,t){var r,o,n,i,a,s,d,l,u=arguments[2];if(m(e)||c(e)?r="array":h(e)?r="string":e=f(e),p(t),n=function(){i=!0},"array"!==r)if("string"!==r)for(o=e.next();!o.done;){if(g.call(t,u,o.value,n),i)return;o=e.next()}else for(s=e.length,a=0;a<s&&(d=e[a],a+1<s&&55296<=(l=d.charCodeAt(0))&&l<=56319&&(d+=e[++a]),g.call(t,u,d,n),!i);++a);else v.call(e,function(e){return g.call(t,u,e,n),i})}},{"./get":62,"es5-ext/function/is-arguments":24,"es5-ext/object/valid-callable":54,"es5-ext/string/is-string":59}],62:[function(e,t,r){"use strict";var o=e("es5-ext/function/is-arguments"),n=e("es5-ext/string/is-string"),i=e("./array"),a=e("./string"),s=e("./valid-iterable"),d=e("es6-symbol").iterator;t.exports=function(e){return"function"==typeof s(e)[d]?e[d]():o(e)?new i(e):n(e)?new a(e):new i(e)}},{"./array":60,"./string":65,"./valid-iterable":66,"es5-ext/function/is-arguments":24,"es5-ext/string/is-string":59,"es6-symbol":73}],63:[function(e,t,r){"use strict";var o,n=e("es5-ext/array/#/clear"),i=e("es5-ext/object/assign"),a=e("es5-ext/object/valid-callable"),s=e("es5-ext/object/valid-value"),d=e("d"),l=e("d/auto-bind"),u=e("es6-symbol"),c=Object.defineProperty,p=Object.defineProperties;t.exports=o=function(e,t){if(!(this instanceof o))throw new TypeError("Constructor requires 'new'");p(this,{__list__:d("w",s(e)),__context__:d("w",t),__nextIndex__:d("w",0)}),t&&(a(t.on),t.on("_add",this._onAdd),t.on("_delete",this._onDelete),t.on("_clear",this._onClear))},delete o.prototype.constructor,p(o.prototype,i({_next:d(function(){var e;if(this.__list__)return this.__redo__&&void 0!==(e=this.__redo__.shift())?e:this.__nextIndex__<this.__list__.length?this.__nextIndex__++:void this._unBind()}),next:d(function(){return this._createResult(this._next())}),_createResult:d(function(e){return void 0===e?{done:!0,value:void 0}:{done:!1,value:this._resolve(e)}}),_resolve:d(function(e){return this.__list__[e]}),_unBind:d(function(){this.__list__=null,delete this.__redo__,this.__context__&&(this.__context__.off("_add",this._onAdd),this.__context__.off("_delete",this._onDelete),this.__context__.off("_clear",this._onClear),this.__context__=null)}),toString:d(function(){return"[object "+(this[u.toStringTag]||"Object")+"]"})},l({_onAdd:d(function(r){r>=this.__nextIndex__||(++this.__nextIndex__,this.__redo__?(this.__redo__.forEach(function(e,t){r<=e&&(this.__redo__[t]=++e)},this),this.__redo__.push(r)):c(this,"__redo__",d("c",[r])))}),_onDelete:d(function(r){var e;r>=this.__nextIndex__||(--this.__nextIndex__,this.__redo__&&(-1!==(e=this.__redo__.indexOf(r))&&this.__redo__.splice(e,1),this.__redo__.forEach(function(e,t){r<e&&(this.__redo__[t]=--e)},this)))}),_onClear:d(function(){this.__redo__&&n.call(this.__redo__),this.__nextIndex__=0})}))),c(o.prototype,u.iterator,d(function(){return this}))},{d:16,"d/auto-bind":15,"es5-ext/array/#/clear":19,"es5-ext/object/assign":36,"es5-ext/object/valid-callable":54,"es5-ext/object/valid-value":55,"es6-symbol":73}],64:[function(e,t,r){"use strict";var o=e("es5-ext/function/is-arguments"),n=e("es5-ext/object/is-value"),i=e("es5-ext/string/is-string"),a=e("es6-symbol").iterator,s=Array.isArray;t.exports=function(e){return!!n(e)&&(!!s(e)||(!!i(e)||(!!o(e)||"function"==typeof e[a])))}},{"es5-ext/function/is-arguments":24,"es5-ext/object/is-value":44,"es5-ext/string/is-string":59,"es6-symbol":73}],65:[function(e,t,r){"use strict";var o,n=e("es5-ext/object/set-prototype-of"),i=e("d"),a=e("es6-symbol"),s=e("./"),d=Object.defineProperty;o=t.exports=function(e){if(!(this instanceof o))throw new TypeError("Constructor requires 'new'");e=String(e),s.call(this,e),d(this,"__length__",i("",e.length))},n&&n(o,s),delete o.prototype.constructor,o.prototype=Object.create(s.prototype,{_next:i(function(){if(this.__list__)return this.__nextIndex__<this.__length__?this.__nextIndex__++:void this._unBind()}),_resolve:i(function(e){var t,r=this.__list__[e];return this.__nextIndex__===this.__length__?r:55296<=(t=r.charCodeAt(0))&&t<=56319?r+this.__list__[this.__nextIndex__++]:r})}),d(o.prototype,a.toStringTag,i("c","String Iterator"))},{"./":63,d:16,"es5-ext/object/set-prototype-of":51,"es6-symbol":73}],66:[function(e,t,r){"use strict";var o=e("./is-iterable");t.exports=function(e){if(!o(e))throw new TypeError(e+" is not iterable");return e}},{"./is-iterable":64}],67:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Map:e("./polyfill")},{"./is-implemented":68,"./polyfill":72}],68:[function(e,t,r){"use strict";t.exports=function(){var e,t;if("function"!=typeof Map)return!1;try{e=new Map([["raz","one"],["dwa","two"],["trzy","three"]])}catch(e){return!1}return"[object Map]"===String(e)&&(3===e.size&&("function"==typeof e.clear&&("function"==typeof e.delete&&("function"==typeof e.entries&&("function"==typeof e.forEach&&("function"==typeof e.get&&("function"==typeof e.has&&("function"==typeof e.keys&&("function"==typeof e.set&&("function"==typeof e.values&&(!1===(t=e.entries().next()).done&&(!!t.value&&("raz"===t.value[0]&&"one"===t.value[1])))))))))))))}},{}],69:[function(e,t,r){"use strict";t.exports="undefined"!=typeof Map&&"[object Map]"===Object.prototype.toString.call(new Map)},{}],70:[function(e,t,r){"use strict";t.exports=e("es5-ext/object/primitive-set")("key","value","key+value")},{"es5-ext/object/primitive-set":50}],71:[function(e,t,r){"use strict";var o,n=e("es5-ext/object/set-prototype-of"),i=e("d"),a=e("es6-iterator"),s=e("es6-symbol").toStringTag,d=e("./iterator-kinds"),l=Object.defineProperties,u=a.prototype._unBind;o=t.exports=function(e,t){if(!(this instanceof o))return new o(e,t);a.call(this,e.__mapKeysData__,e),t&&d[t]||(t="key+value"),l(this,{__kind__:i("",t),__values__:i("w",e.__mapValuesData__)})},n&&n(o,a),o.prototype=Object.create(a.prototype,{constructor:i(o),_resolve:i(function(e){return"value"===this.__kind__?this.__values__[e]:"key"===this.__kind__?this.__list__[e]:[this.__list__[e],this.__values__[e]]}),_unBind:i(function(){this.__values__=null,u.call(this)}),toString:i(function(){return"[object Map Iterator]"})}),Object.defineProperty(o.prototype,s,i("c","Map Iterator"))},{"./iterator-kinds":70,d:16,"es5-ext/object/set-prototype-of":51,"es6-iterator":63,"es6-symbol":73}],72:[function(e,t,r){"use strict";var n,o=e("es5-ext/array/#/clear"),i=e("es5-ext/array/#/e-index-of"),a=e("es5-ext/object/set-prototype-of"),s=e("es5-ext/object/valid-callable"),d=e("es5-ext/object/valid-value"),l=e("d"),u=e("event-emitter"),c=e("es6-symbol"),p=e("es6-iterator/valid-iterable"),h=e("es6-iterator/for-of"),f=e("./lib/iterator"),m=e("./is-native-implemented"),g=Function.prototype.call,v=Object.defineProperties,y=Object.getPrototypeOf;t.exports=n=function(){var r,o,e,t=arguments[0];if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");return e=m&&a&&Map!==n?a(new Map,y(this)):this,null!=t&&p(t),v(e,{__mapKeysData__:l("c",r=[]),__mapValuesData__:l("c",o=[])}),t&&h(t,function(e){var t=d(e)[0];e=e[1],-1===i.call(r,t)&&(r.push(t),o.push(e))},e),e},m&&(a&&a(n,Map),n.prototype=Object.create(Map.prototype,{constructor:l(n)})),u(v(n.prototype,{clear:l(function(){this.__mapKeysData__.length&&(o.call(this.__mapKeysData__),o.call(this.__mapValuesData__),this.emit("_clear"))}),delete:l(function(e){var t=i.call(this.__mapKeysData__,e);return-1!==t&&(this.__mapKeysData__.splice(t,1),this.__mapValuesData__.splice(t,1),this.emit("_delete",t,e),!0)}),entries:l(function(){return new f(this,"key+value")}),forEach:l(function(e){var t,r,o=arguments[1];for(s(e),r=(t=this.entries())._next();void 0!==r;)g.call(e,o,this.__mapValuesData__[r],this.__mapKeysData__[r],this),r=t._next()}),get:l(function(e){var t=i.call(this.__mapKeysData__,e);if(-1!==t)return this.__mapValuesData__[t]}),has:l(function(e){return-1!==i.call(this.__mapKeysData__,e)}),keys:l(function(){return new f(this,"key")}),set:l(function(e,t){var r,o=i.call(this.__mapKeysData__,e);return-1===o&&(o=this.__mapKeysData__.push(e)-1,r=!0),this.__mapValuesData__[o]=t,r&&this.emit("_add",o,e),this}),size:l.gs(function(){return this.__mapKeysData__.length}),values:l(function(){return new f(this,"value")}),toString:l(function(){return"[object Map]"})})),Object.defineProperty(n.prototype,c.iterator,l(function(){return this.entries()})),Object.defineProperty(n.prototype,c.toStringTag,l("c","Map"))},{"./is-native-implemented":69,"./lib/iterator":71,d:16,"es5-ext/array/#/clear":19,"es5-ext/array/#/e-index-of":20,"es5-ext/object/set-prototype-of":51,"es5-ext/object/valid-callable":54,"es5-ext/object/valid-value":55,"es6-iterator/for-of":61,"es6-iterator/valid-iterable":66,"es6-symbol":73,"event-emitter":78}],73:[function(e,t,r){"use strict";t.exports=e("./is-implemented")()?Symbol:e("./polyfill")},{"./is-implemented":74,"./polyfill":76}],74:[function(e,t,r){"use strict";var o={object:!0,symbol:!0};t.exports=function(){var e;if("function"!=typeof Symbol)return!1;e=Symbol("test symbol");try{String(e)}catch(e){return!1}return!!o[typeof Symbol.iterator]&&(!!o[typeof Symbol.toPrimitive]&&!!o[typeof Symbol.toStringTag])}},{}],75:[function(e,t,r){"use strict";t.exports=function(e){return!!e&&("symbol"==typeof e||!!e.constructor&&("Symbol"===e.constructor.name&&"Symbol"===e[e.constructor.toStringTag]))}},{}],76:[function(e,t,r){"use strict";var o,n,i,a,s=e("d"),d=e("./validate-symbol"),l=Object.create,u=Object.defineProperties,c=Object.defineProperty,p=Object.prototype,h=l(null);if("function"==typeof Symbol){o=Symbol;try{String(o()),a=!0}catch(e){}}var f,m=(f=l(null),function(e){for(var t,r,o=0;f[e+(o||"")];)++o;return f[e+=o||""]=!0,c(p,t="@@"+e,s.gs(null,function(e){r||(r=!0,c(this,t,s(e)),r=!1)})),t});i=function(e){if(this instanceof i)throw new TypeError("Symbol is not a constructor");return n(e)},t.exports=n=function e(t){var r;if(this instanceof e)throw new TypeError("Symbol is not a constructor");return a?o(t):(r=l(i.prototype),t=void 0===t?"":String(t),u(r,{__description__:s("",t),__name__:s("",m(t))}))},u(n,{for:s(function(e){return h[e]?h[e]:h[e]=n(String(e))}),keyFor:s(function(e){var t;for(t in d(e),h)if(h[t]===e)return t}),hasInstance:s("",o&&o.hasInstance||n("hasInstance")),isConcatSpreadable:s("",o&&o.isConcatSpreadable||n("isConcatSpreadable")),iterator:s("",o&&o.iterator||n("iterator")),match:s("",o&&o.match||n("match")),replace:s("",o&&o.replace||n("replace")),search:s("",o&&o.search||n("search")),species:s("",o&&o.species||n("species")),split:s("",o&&o.split||n("split")),toPrimitive:s("",o&&o.toPrimitive||n("toPrimitive")),toStringTag:s("",o&&o.toStringTag||n("toStringTag")),unscopables:s("",o&&o.unscopables||n("unscopables"))}),u(i.prototype,{constructor:s(n),toString:s("",function(){return this.__name__})}),u(n.prototype,{toString:s(function(){return"Symbol ("+d(this).__description__+")"}),valueOf:s(function(){return d(this)})}),c(n.prototype,n.toPrimitive,s("",function(){var e=d(this);return"symbol"==typeof e?e:e.toString()})),c(n.prototype,n.toStringTag,s("c","Symbol")),c(i.prototype,n.toStringTag,s("c",n.prototype[n.toStringTag])),c(i.prototype,n.toPrimitive,s("c",n.prototype[n.toPrimitive]))},{"./validate-symbol":77,d:16}],77:[function(e,t,r){"use strict";var o=e("./is-symbol");t.exports=function(e){if(!o(e))throw new TypeError(e+" is not a symbol");return e}},{"./is-symbol":75}],78:[function(e,t,r){"use strict";var n,o,i,a,s,d,l,u=e("d"),c=e("es5-ext/object/valid-callable"),p=Function.prototype.apply,h=Function.prototype.call,f=Object.create,m=Object.defineProperty,g=Object.defineProperties,v=Object.prototype.hasOwnProperty,y={configurable:!0,enumerable:!1,writable:!0};o=function(e,t){var r,o;return c(t),n.call(o=this,e,r=function(){i.call(o,e,r),p.call(t,this,arguments)}),r.__eeOnceListener__=t,this},s={on:n=function(e,t){var r;return c(t),v.call(this,"__ee__")?r=this.__ee__:(r=y.value=f(null),m(this,"__ee__",y),y.value=null),r[e]?"object"==typeof r[e]?r[e].push(t):r[e]=[r[e],t]:r[e]=t,this},once:o,off:i=function(e,t){var r,o,n,i;if(c(t),!v.call(this,"__ee__"))return this;if(!(r=this.__ee__)[e])return this;if("object"==typeof(o=r[e]))for(i=0;n=o[i];++i)n!==t&&n.__eeOnceListener__!==t||(2===o.length?r[e]=o[i?0:1]:o.splice(i,1));else o!==t&&o.__eeOnceListener__!==t||delete r[e];return this},emit:a=function(e){var t,r,o,n,i;if(v.call(this,"__ee__")&&(n=this.__ee__[e]))if("object"==typeof n){for(r=arguments.length,i=new Array(r-1),t=1;t<r;++t)i[t-1]=arguments[t];for(n=n.slice(),t=0;o=n[t];++t)p.call(o,this,i)}else switch(arguments.length){case 1:h.call(n,this);break;case 2:h.call(n,this,arguments[1]);break;case 3:h.call(n,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,i=new Array(r-1),t=1;t<r;++t)i[t-1]=arguments[t];p.call(n,this,i)}}},d={on:u(n),once:u(o),off:u(i),emit:u(a)},l=g({},d),t.exports=r=function(e){return null==e?f(l):g(Object(e),d)},r.methods=s},{d:16,"es5-ext/object/valid-callable":54}],79:[function(e,t,r){r.read=function(e,t,r,o,n){var i,a,s=8*n-o-1,d=(1<<s)-1,l=d>>1,u=-7,c=r?n-1:0,p=r?-1:1,h=e[t+c];for(c+=p,i=h&(1<<-u)-1,h>>=-u,u+=s;0<u;i=256*i+e[t+c],c+=p,u-=8);for(a=i&(1<<-u)-1,i>>=-u,u+=o;0<u;a=256*a+e[t+c],c+=p,u-=8);if(0===i)i=1-l;else{if(i===d)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,o),i-=l}return(h?-1:1)*a*Math.pow(2,i-o)},r.write=function(e,t,r,o,n,i){var a,s,d,l=8*i-n-1,u=(1<<l)-1,c=u>>1,p=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,h=o?0:i-1,f=o?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(d=Math.pow(2,-a))<1&&(a--,d*=2),2<=(t+=1<=a+c?p/d:p*Math.pow(2,1-c))*d&&(a++,d/=2),u<=a+c?(s=0,a=u):1<=a+c?(s=(t*d-1)*Math.pow(2,n),a+=c):(s=t*Math.pow(2,c-1)*Math.pow(2,n),a=0));8<=n;e[r+h]=255&s,h+=f,s/=256,n-=8);for(a=a<<n|s,l+=n;0<l;e[r+h]=255&a,h+=f,a/=256,l-=8);e[r+h-f]|=128*m}},{}],80:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],81:[function(e,t,r){function o(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}t.exports=function(e){return null!=e&&(o(e)||"function"==typeof(t=e).readFloatLE&&"function"==typeof t.slice&&o(t.slice(0,0))||!!e._isBuffer);var t}},{}],82:[function(e,t,r){"use strict";var i=e("safe-buffer").Buffer,a=t.exports;for(var o in a.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},a.codes={},a.types){var n=a.types[o];a.codes[n]=o}for(var s in a.CMD_SHIFT=4,a.CMD_MASK=240,a.DUP_MASK=8,a.QOS_MASK=3,a.QOS_SHIFT=1,a.RETAIN_MASK=1,a.LENGTH_MASK=127,a.LENGTH_FIN_MASK=128,a.SESSIONPRESENT_MASK=1,a.SESSIONPRESENT_HEADER=i.from([a.SESSIONPRESENT_MASK]),a.CONNACK_HEADER=i.from([a.codes.connack<<a.CMD_SHIFT]),a.USERNAME_MASK=128,a.PASSWORD_MASK=64,a.WILL_RETAIN_MASK=32,a.WILL_QOS_MASK=24,a.WILL_QOS_SHIFT=3,a.WILL_FLAG_MASK=4,a.CLEAN_SESSION_MASK=2,a.CONNECT_HEADER=i.from([a.codes.connect<<a.CMD_SHIFT]),a.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},a.propertiesCodes={},a.properties){var d=a.properties[s];a.propertiesCodes[d]=s}function l(n){return[0,1,2].map(function(o){return[0,1].map(function(r){return[0,1].map(function(e){var t=new i(1);return t.writeUInt8(a.codes[n]<<a.CMD_SHIFT|(r?a.DUP_MASK:0)|o<<a.QOS_SHIFT|e,0,!0),t})})})}a.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int32",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"},a.PUBLISH_HEADER=l("publish"),a.SUBSCRIBE_HEADER=l("subscribe"),a.SUBSCRIBE_OPTIONS_QOS_MASK=3,a.SUBSCRIBE_OPTIONS_NL_MASK=1,a.SUBSCRIBE_OPTIONS_NL_SHIFT=2,a.SUBSCRIBE_OPTIONS_RAP_MASK=1,a.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,a.SUBSCRIBE_OPTIONS_RH_MASK=3,a.SUBSCRIBE_OPTIONS_RH_SHIFT=4,a.SUBSCRIBE_OPTIONS_RH=[0,16,32],a.SUBSCRIBE_OPTIONS_NL=4,a.SUBSCRIBE_OPTIONS_RAP=8,a.SUBSCRIBE_OPTIONS_QOS=[0,1,2],a.UNSUBSCRIBE_HEADER=l("unsubscribe"),a.ACKS={unsuback:l("unsuback"),puback:l("puback"),pubcomp:l("pubcomp"),pubrel:l("pubrel"),pubrec:l("pubrec")},a.SUBACK_HEADER=i.from([a.codes.suback<<a.CMD_SHIFT]),a.VERSION3=i.from([3]),a.VERSION4=i.from([4]),a.VERSION5=i.from([5]),a.QOS=[0,1,2].map(function(e){return i.from([e])}),a.EMPTY={pingreq:i.from([a.codes.pingreq<<4,0]),pingresp:i.from([a.codes.pingresp<<4,0]),disconnect:i.from([a.codes.disconnect<<4,0])}},{"safe-buffer":110}],83:[function(e,t,r){"use strict";var a=e("safe-buffer").Buffer,o=e("./writeToStream"),n=e("events").EventEmitter;function i(){this._array=new Array(20),this._i=0}e("inherits")(i,n),i.prototype.write=function(e){return this._array[this._i++]=e,!0},i.prototype.concat=function(){var e,t,r=0,o=new Array(this._array.length),n=this._array,i=0;for(e=0;e<n.length&&void 0!==n[e];e++)"string"!=typeof n[e]?o[e]=n[e].length:o[e]=a.byteLength(n[e]),r+=o[e];for(t=a.allocUnsafe(r),e=0;e<n.length&&void 0!==n[e];e++)"string"!=typeof n[e]?n[e].copy(t,i):t.write(n[e],i),i+=o[e];return t},t.exports=function(e,t){var r=new i;return o(e,r,t),r.concat()}},{"./writeToStream":89,events:13,inherits:80,"safe-buffer":110}],84:[function(e,t,r){"use strict";r.parser=e("./parser"),r.generate=e("./generate"),r.writeToStream=e("./writeToStream")},{"./generate":83,"./parser":88,"./writeToStream":89}],85:[function(e,t,r){var o=e("readable-stream/duplex"),n=e("util"),p=e("safe-buffer").Buffer;function i(e){if(!(this instanceof i))return new i(e);if(this._bufs=[],this.length=0,"function"==typeof e){this._callback=e;var t=function(e){this._callback&&(this._callback(e),this._callback=null)}.bind(this);this.on("pipe",function(e){e.on("error",t)}),this.on("unpipe",function(e){e.removeListener("error",t)})}else this.append(e);o.call(this)}n.inherits(i,o),i.prototype._offset=function(e){var t,r=0,o=0;if(0===e)return[0,0];for(;o<this._bufs.length;o++){if(e<(t=r+this._bufs[o].length)||o==this._bufs.length-1)return[o,e-r];r=t}},i.prototype.append=function(e){var t=0;if(p.isBuffer(e))this._appendBuffer(e);else if(Array.isArray(e))for(;t<e.length;t++)this.append(e[t]);else if(e instanceof i)for(;t<e._bufs.length;t++)this.append(e._bufs[t]);else null!=e&&("number"==typeof e&&(e=e.toString()),this._appendBuffer(p.from(e)));return this},i.prototype._appendBuffer=function(e){this._bufs.push(e),this.length+=e.length},i.prototype._write=function(e,t,r){this._appendBuffer(e),"function"==typeof r&&r()},i.prototype._read=function(e){if(!this.length)return this.push(null);e=Math.min(e,this.length),this.push(this.slice(0,e)),this.consume(e)},i.prototype.end=function(e){o.prototype.end.call(this,e),this._callback&&(this._callback(null,this.slice()),this._callback=null)},i.prototype.get=function(e){return this.slice(e,e+1)[0]},i.prototype.slice=function(e,t){return"number"==typeof e&&e<0&&(e+=this.length),"number"==typeof t&&t<0&&(t+=this.length),this.copy(null,0,e,t)},i.prototype.copy=function(e,t,r,o){if(("number"!=typeof r||r<0)&&(r=0),("number"!=typeof o||o>this.length)&&(o=this.length),r>=this.length)return e||p.alloc(0);if(o<=0)return e||p.alloc(0);var n,i,a=!!e,s=this._offset(r),d=o-r,l=d,u=a&&t||0,c=s[1];if(0===r&&o==this.length){if(!a)return 1===this._bufs.length?this._bufs[0]:p.concat(this._bufs,this.length);for(i=0;i<this._bufs.length;i++)this._bufs[i].copy(e,u),u+=this._bufs[i].length;return e}if(l<=this._bufs[s[0]].length-c)return a?this._bufs[s[0]].copy(e,t,c,c+l):this._bufs[s[0]].slice(c,c+l);for(a||(e=p.allocUnsafe(d)),i=s[0];i<this._bufs.length;i++){if(!((n=this._bufs[i].length-c)<l)){this._bufs[i].copy(e,u,c,c+l);break}this._bufs[i].copy(e,u,c),u+=n,l-=n,c&&(c=0)}return e},i.prototype.shallowSlice=function(e,t){e=e||0,t=t||this.length,e<0&&(e+=this.length),t<0&&(t+=this.length);var r=this._offset(e),o=this._offset(t),n=this._bufs.slice(r[0],o[0]+1);return 0==o[1]?n.pop():n[n.length-1]=n[n.length-1].slice(0,o[1]),0!=r[1]&&(n[0]=n[0].slice(r[1])),new i(n)},i.prototype.toString=function(e,t,r){return this.slice(t,r).toString(e)},i.prototype.consume=function(e){for(;this._bufs.length;){if(!(e>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},i.prototype.duplicate=function(){for(var e=0,t=new i;e<this._bufs.length;e++)t.append(this._bufs[e]);return t},i.prototype.destroy=function(){this._bufs.length=0,this.length=0,this.push(null)},function(){var r={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};for(var e in r)!function(t){i.prototype[t]=function(e){return this.slice(e,e+r[t])[t](0)}}(e)}(),t.exports=i},{"readable-stream/duplex":97,"safe-buffer":110,util:117}],86:[function(e,t,r){"use strict";var a=e("safe-buffer").Buffer,o={};function n(e){var t=a.allocUnsafe(2);return t.writeUInt8(e>>8,0),t.writeUInt8(255&e,1),t}t.exports={cache:o,generateCache:function(){for(var e=0;e<65536;e++)o[e]=n(e)},generateNumber:n,genBufVariableByteInt:function(e){for(var t,r=0,o=0,n=0<=(t=e)&&t<128?1:128<=t&&t<16384?2:16384<=t&&t<2097152?3:2097152<=t&&t<268435456?4:0,i=a.allocUnsafe(n);r=e%128|0,0<(e=e/128|0)&&(r|=128),i.writeUInt8(r,o++),0<e;);return{data:i,length:n}},generate4ByteBuffer:function(e){var t=a.allocUnsafe(4);return t.writeUInt32BE(e,0),t}}},{"safe-buffer":110}],87:[function(e,t,r){t.exports=function(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}},{}],88:[function(e,t,r){"use strict";var o=e("bl"),n=e("inherits"),i=e("events").EventEmitter,a=e("./packet"),u=e("./constants");function s(e){if(!(this instanceof s))return new s(e);this.settings=e||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState()}n(s,i),s.prototype._resetState=function(){this.packet=new a,this.error=null,this._list=o(),this._stateCounter=0},s.prototype.parse=function(e){for(this.error&&this._resetState(),this._list.append(e);(-1!==this.packet.length||0<this._list.length)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,this._stateCounter>=this._states.length&&(this._stateCounter=0);return this._list.length},s.prototype._parseHeader=function(){var e=this._list.readUInt8(0);return this.packet.cmd=u.types[e>>u.CMD_SHIFT],this.packet.retain=0!=(e&u.RETAIN_MASK),this.packet.qos=e>>u.QOS_SHIFT&u.QOS_MASK,this.packet.dup=0!=(e&u.DUP_MASK),this._list.consume(1),!0},s.prototype._parseLength=function(){var e=this._parseVarByteNum(!0);return e&&(this.packet.length=e.value,this._list.consume(e.bytes)),!!e},s.prototype._parsePayload=function(){var e=!1;if(0===this.packet.length||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}e=!0}return e},s.prototype._parseConnect=function(){var e,t,r,o,n,i,a={},s=this.packet;if(null===(e=this._parseString()))return this._emitError(new Error("Cannot parse protocolId"));if("MQTT"!==e&&"MQIsdp"!==e)return this._emitError(new Error("Invalid protocolId"));if(s.protocolId=e,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(s.protocolVersion=this._list.readUInt8(this._pos),3!==s.protocolVersion&&4!==s.protocolVersion&&5!==s.protocolVersion)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(a.username=this._list.readUInt8(this._pos)&u.USERNAME_MASK,a.password=this._list.readUInt8(this._pos)&u.PASSWORD_MASK,a.will=this._list.readUInt8(this._pos)&u.WILL_FLAG_MASK,a.will&&(s.will={},s.will.retain=0!=(this._list.readUInt8(this._pos)&u.WILL_RETAIN_MASK),s.will.qos=(this._list.readUInt8(this._pos)&u.WILL_QOS_MASK)>>u.WILL_QOS_SHIFT),s.clean=0!=(this._list.readUInt8(this._pos)&u.CLEAN_SESSION_MASK),this._pos++,s.keepalive=this._parseNum(),-1===s.keepalive)return this._emitError(new Error("Packet too short"));if(5===s.protocolVersion){var d=this._parseProperties();Object.getOwnPropertyNames(d).length&&(s.properties=d)}if(null===(t=this._parseString()))return this._emitError(new Error("Packet too short"));if(s.clientId=t,a.will){if(5===s.protocolVersion){var l=this._parseProperties();Object.getOwnPropertyNames(l).length&&(s.will.properties=l)}if(null===(r=this._parseString()))return this._emitError(new Error("Cannot parse will topic"));if(s.will.topic=r,null===(o=this._parseBuffer()))return this._emitError(new Error("Cannot parse will payload"));s.will.payload=o}if(a.username){if(null===(i=this._parseString()))return this._emitError(new Error("Cannot parse username"));s.username=i}if(a.password){if(null===(n=this._parseBuffer()))return this._emitError(new Error("Cannot parse password"));s.password=n}return this.settings=s},s.prototype._parseConnack=function(){var e=this.packet;if(this._list.length<2)return null;if(e.sessionPresent=!!(this._list.readUInt8(this._pos++)&u.SESSIONPRESENT_MASK),5===this.settings.protocolVersion?e.reasonCode=this._list.readUInt8(this._pos++):e.returnCode=this._list.readUInt8(this._pos++),-1===e.returnCode||-1===e.reasonCode)return this._emitError(new Error("Cannot parse return code"));if(5===this.settings.protocolVersion){var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}},s.prototype._parsePublish=function(){var e=this.packet;if(e.topic=this._parseString(),null===e.topic)return this._emitError(new Error("Cannot parse topic"));if(!(0<e.qos)||this._parseMessageId()){if(5===this.settings.protocolVersion){var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}e.payload=this._list.slice(this._pos,e.length)}},s.prototype._parseSubscribe=function(){var e,t,r,o,n,i,a,s=this.packet;if(1!==s.qos)return this._emitError(new Error("Wrong subscribe header"));if(s.subscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var d=this._parseProperties();Object.getOwnPropertyNames(d).length&&(s.properties=d)}for(;this._pos<s.length;){if(null===(e=this._parseString()))return this._emitError(new Error("Cannot parse topic"));r=(t=this._parseByte())&u.SUBSCRIBE_OPTIONS_QOS_MASK,i=0!=(t>>u.SUBSCRIBE_OPTIONS_NL_SHIFT&u.SUBSCRIBE_OPTIONS_NL_MASK),n=0!=(t>>u.SUBSCRIBE_OPTIONS_RAP_SHIFT&u.SUBSCRIBE_OPTIONS_RAP_MASK),o=t>>u.SUBSCRIBE_OPTIONS_RH_SHIFT&u.SUBSCRIBE_OPTIONS_RH_MASK,a={topic:e,qos:r},5===this.settings.protocolVersion&&(a.nl=i,a.rap=n,a.rh=o),s.subscriptions.push(a)}}},s.prototype._parseSuback=function(){var e=this.packet;if(this.packet.granted=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}for(;this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}},s.prototype._parseUnsubscribe=function(){var e=this.packet;if(e.unsubscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}for(;this._pos<e.length;){var r;if(null===(r=this._parseString()))return this._emitError(new Error("Cannot parse topic"));e.unsubscriptions.push(r)}}},s.prototype._parseUnsuback=function(){var e=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if(5===this.settings.protocolVersion){var t=this._parseProperties();for(Object.getOwnPropertyNames(t).length&&(e.properties=t),e.granted=[];this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}},s.prototype._parseConfirmation=function(){var e=this.packet;if(this._parseMessageId(),5===this.settings.protocolVersion&&2<e.length){e.reasonCode=this._parseByte();var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}return!0},s.prototype._parseDisconnect=function(){var e=this.packet;if(5===this.settings.protocolVersion){e.reasonCode=this._parseByte();var t=this._parseProperties();Object.getOwnPropertyNames(t).length&&(e.properties=t)}return!0},s.prototype._parseAuth=function(){var e=this.packet;if(5!==this.settings.protocolVersion)return this._emitError(new Error("Not supported auth packet for this version MQTT"));e.reasonCode=this._parseByte();var t=this._parseProperties();return Object.getOwnPropertyNames(t).length&&(e.properties=t),!0},s.prototype._parseMessageId=function(){var e=this.packet;return e.messageId=this._parseNum(),null!==e.messageId||(this._emitError(new Error("Cannot parse messageId")),!1)},s.prototype._parseString=function(e){var t,r=this._parseNum(),o=r+this._pos;return-1===r||o>this._list.length||o>this.packet.length?null:(t=this._list.toString("utf8",this._pos,o),this._pos+=r,t)},s.prototype._parseStringPair=function(){return{name:this._parseString(),value:this._parseString()}},s.prototype._parseBuffer=function(){var e,t=this._parseNum(),r=t+this._pos;return-1===t||r>this._list.length||r>this.packet.length?null:(e=this._list.slice(this._pos,r),this._pos+=t,e)},s.prototype._parseNum=function(){if(this._list.length-this._pos<2)return-1;var e=this._list.readUInt16BE(this._pos);return this._pos+=2,e},s.prototype._parse4ByteNum=function(){if(this._list.length-this._pos<4)return-1;var e=this._list.readUInt32BE(this._pos);return this._pos+=4,e},s.prototype._parseVarByteNum=function(e){for(var t,r=0,o=1,n=0,i=!0,a=this._pos?this._pos:0;r<5&&(n+=o*((t=this._list.readUInt8(a+r++))&u.LENGTH_MASK),o*=128,0!=(t&u.LENGTH_FIN_MASK));)if(this._list.length<=r){i=!1;break}return a&&(this._pos+=r),i=!!i&&(e?{bytes:r,value:n}:n)},s.prototype._parseByte=function(){var e=this._list.readUInt8(this._pos);return this._pos++,e},s.prototype._parseByType=function(e){switch(e){case"byte":return 0!==this._parseByte();case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}},s.prototype._parseProperties=function(){for(var e=this._parseVarByteNum(),t=this._pos+e,r={};this._pos<t;){var o=this._parseByte(),n=u.propertiesCodes[o];if(!n)return this._emitError(new Error("Unknown property")),!1;if("userProperties"!==n)r[n]=this._parseByType(u.propertiesTypes[n]);else{r[n]||(r[n]={});var i=this._parseByType(u.propertiesTypes[n]);r[n][i.name]=i.value}}return r},s.prototype._newPacket=function(){return this.packet&&(this._list.consume(this.packet.length),this.emit("packet",this.packet)),this.packet=new a,!(this._pos=0)},s.prototype._emitError=function(e){this.error=e,this.emit("error",e)},t.exports=s},{"./constants":82,"./packet":87,bl:85,events:13,inherits:80}],89:[function(e,t,r){"use strict";var R=e("./constants"),C=e("safe-buffer").Buffer,h=C.allocUnsafe(0),l=C.from([0]),o=e("./numbers"),n=e("process-nextick-args").nextTick,i=o.cache,a=o.generateNumber,s=o.generateCache,d=o.genBufVariableByteInt,u=o.generate4ByteBuffer,P=g,c=!0;function p(e,t,r){switch(t.cork&&(t.cork(),n(f,t)),c&&(c=!1,s()),e.cmd){case"connect":return function(e,t,r){var o=e||{},n=o.protocolId||"MQTT",i=o.protocolVersion||4,a=o.will,s=o.clean,d=o.keepalive||0,l=o.clientId||"",u=o.username,c=o.password,p=o.properties;void 0===s&&(s=!0);var h=0;{if(!n||"string"!=typeof n&&!C.isBuffer(n))return t.emit("error",new Error("Invalid protocolId")),!1;h+=n.length+2}{if(3!==i&&4!==i&&5!==i)return t.emit("error",new Error("Invalid protocol version")),!1;h+=1}if("string"!=typeof l&&!C.isBuffer(l)||!l&&4!==i||!l&&!s){if(i<4)return t.emit("error",new Error("clientId must be supplied before 3.1.1")),!1;if(1*s==0)return t.emit("error",new Error("clientId must be given if cleanSession set to 0")),!1}else h+=l.length+2;{if("number"!=typeof d||d<0||65535<d||d%1!=0)return t.emit("error",new Error("Invalid keepalive")),!1;h+=2}if(h+=1,5===i){var f=A(t,p);h+=f.length}if(a){if("object"!=typeof a)return t.emit("error",new Error("Invalid will")),!1;if(!a.topic||"string"!=typeof a.topic)return t.emit("error",new Error("Invalid will topic")),!1;if(h+=C.byteLength(a.topic)+2,a.payload){if(!(0<=a.payload.length))return t.emit("error",new Error("Invalid will payload")),!1;"string"==typeof a.payload?h+=C.byteLength(a.payload)+2:h+=a.payload.length+2;var m={};5===i&&(m=A(t,a.properties),h+=m.length)}}var g=!1;if(null!=u){if(!S(u))return t.emit("error",new Error("Invalid username")),!1;g=!0,h+=C.byteLength(u)+2}if(null!=c){if(!g)return t.emit("error",new Error("Username is required to use password")),!1;if(!S(c))return t.emit("error",new Error("Invalid password")),!1;h+=w(c)+2}t.write(R.CONNECT_HEADER),M(t,h),y(t,n),t.write(4===i?R.VERSION4:5===i?R.VERSION5:R.VERSION3);var v=0;v|=null!=u?R.USERNAME_MASK:0,v|=null!=c?R.PASSWORD_MASK:0,v|=a&&a.retain?R.WILL_RETAIN_MASK:0,v|=a&&a.qos?a.qos<<R.WILL_QOS_SHIFT:0,v|=a?R.WILL_FLAG_MASK:0,v|=s?R.CLEAN_SESSION_MASK:0,t.write(C.from([v])),P(t,d),5===i&&f.write();y(t,l),a&&(5===i&&m.write(),x(t,a.topic),y(t,a.payload));null!=u&&y(t,u);null!=c&&y(t,c);return!0}(e,t);case"connack":return function(e,t,r){var o=r?r.protocolVersion:4,n=e||{},i=5===o?n.reasonCode:n.returnCode,a=n.properties,s=2;if("number"!=typeof i)return t.emit("error",new Error("Invalid return code")),!1;var d=null;5===o&&(d=A(t,a),s+=d.length);t.write(R.CONNACK_HEADER),M(t,s),t.write(n.sessionPresent?R.SESSIONPRESENT_HEADER:l),t.write(C.from([i])),null!=d&&d.write();return!0}(e,t,r);case"publish":return function(e,t,r){var o=r?r.protocolVersion:4,n=e||{},i=n.qos||0,a=n.retain?R.RETAIN_MASK:0,s=n.topic,d=n.payload||h,l=n.messageId,u=n.properties,c=0;if("string"==typeof s)c+=C.byteLength(s)+2;else{if(!C.isBuffer(s))return t.emit("error",new Error("Invalid topic")),!1;c+=s.length+2}C.isBuffer(d)?c+=d.length:c+=C.byteLength(d);{if(i&&"number"!=typeof l)return t.emit("error",new Error("Invalid messageId")),!1;i&&(c+=2)}var p=null;5===o&&(p=A(t,u),c+=p.length);t.write(R.PUBLISH_HEADER[i][n.dup?1:0][a?1:0]),M(t,c),P(t,w(s)),t.write(s),0<i&&P(t,l);null!=p&&p.write();return t.write(d)}(e,t,r);case"puback":case"pubrec":case"pubrel":case"pubcomp":return function(e,t,r){var o=r?r.protocolVersion:4,n=e||{},i=n.cmd||"puback",a=n.messageId,s=n.dup&&"pubrel"===i?R.DUP_MASK:0,d=0,l=n.reasonCode,u=n.properties,c=5===o?3:2;"pubrel"===i&&(d=1);if("number"!=typeof a)return t.emit("error",new Error("Invalid messageId")),!1;var p=null;if(5===o){if(!(p=b(t,u,r,c)))return!1;c+=p.length}t.write(R.ACKS[i][d][s][0]),M(t,c),P(t,a),5===o&&t.write(C.from([l]));null!==p&&p.write();return!0}(e,t,r);case"subscribe":return function(e,t,r){var o=r?r.protocolVersion:4,n=e||{},i=n.dup?R.DUP_MASK:0,a=n.messageId,s=n.subscriptions,d=n.properties,l=0;{if("number"!=typeof a)return t.emit("error",new Error("Invalid messageId")),!1;l+=2}var u=null;5===o&&(u=A(t,d),l+=u.length);{if("object"!=typeof s||!s.length)return t.emit("error",new Error("Invalid subscriptions")),!1;for(var c=0;c<s.length;c+=1){var p=s[c].topic,h=s[c].qos;if("string"!=typeof p)return t.emit("error",new Error("Invalid subscriptions - invalid topic")),!1;if("number"!=typeof h)return t.emit("error",new Error("Invalid subscriptions - invalid qos")),!1;if(5===o){var f=s[c].nl||!1;if("boolean"!=typeof f)return t.emit("error",new Error("Invalid subscriptions - invalid No Local")),!1;var m=s[c].rap||!1;if("boolean"!=typeof m)return t.emit("error",new Error("Invalid subscriptions - invalid Retain as Published")),!1;var g=s[c].rh||0;if("number"!=typeof g||2<g)return t.emit("error",new Error("Invalid subscriptions - invalid Retain Handling")),!1}l+=C.byteLength(p)+2+1}}t.write(R.SUBSCRIBE_HEADER[1][i?1:0][0]),M(t,l),P(t,a),null!==u&&u.write();for(var v=!0,y=0;y<s.length;y++){var b,_=s[y],w=_.topic,S=_.qos,E=+_.nl,I=+_.rap,T=_.rh;x(t,w),b=R.SUBSCRIBE_OPTIONS_QOS[S],5===o&&(b|=E?R.SUBSCRIBE_OPTIONS_NL:0,b|=I?R.SUBSCRIBE_OPTIONS_RAP:0,b|=T?R.SUBSCRIBE_OPTIONS_RH[T]:0),v=t.write(C.from([b]))}return v}(e,t,r);case"suback":return function(e,t,r){var o=r?r.protocolVersion:4,n=e||{},i=n.messageId,a=n.granted,s=n.properties,d=0;{if("number"!=typeof i)return t.emit("error",new Error("Invalid messageId")),!1;d+=2}{if("object"!=typeof a||!a.length)return t.emit("error",new Error("Invalid qos vector")),!1;for(var l=0;l<a.length;l+=1){if("number"!=typeof a[l])return t.emit("error",new Error("Invalid qos vector")),!1;d+=1}}var u=null;if(5===o){if(!(u=b(t,s,r,d)))return!1;d+=u.length}t.write(R.SUBACK_HEADER),M(t,d),P(t,i),null!==u&&u.write();return t.write(C.from(a))}(e,t,r);case"unsubscribe":return function(e,t,r){var o=r?r.protocolVersion:4,n=e||{},i=n.messageId,a=n.dup?R.DUP_MASK:0,s=n.unsubscriptions,d=n.properties,l=0;{if("number"!=typeof i)return t.emit("error",new Error("Invalid messageId")),!1;l+=2}{if("object"!=typeof s||!s.length)return t.emit("error",new Error("Invalid unsubscriptions")),!1;for(var u=0;u<s.length;u+=1){if("string"!=typeof s[u])return t.emit("error",new Error("Invalid unsubscriptions")),!1;l+=C.byteLength(s[u])+2}}var c=null;5===o&&(c=A(t,d),l+=c.length);t.write(R.UNSUBSCRIBE_HEADER[1][a?1:0][0]),M(t,l),P(t,i),null!==c&&c.write();for(var p=!0,h=0;h<s.length;h++)p=x(t,s[h]);return p}(e,t,r);case"unsuback":return function(e,t,r){var o=r?r.protocolVersion:4,n=e||{},i=n.messageId,a=n.dup?R.DUP_MASK:0,s=n.granted,d=n.properties,l=n.cmd,u=2;if("number"!=typeof i)return t.emit("error",new Error("Invalid messageId")),!1;if(5===o){if("object"!=typeof s||!s.length)return t.emit("error",new Error("Invalid qos vector")),!1;for(var c=0;c<s.length;c+=1){if("number"!=typeof s[c])return t.emit("error",new Error("Invalid qos vector")),!1;u+=1}}var p=null;if(5===o){if(!(p=b(t,d,r,u)))return!1;u+=p.length}t.write(R.ACKS[l][0][a][0]),M(t,u),P(t,i),null!==p&&p.write();5===o&&t.write(C.from(s));return!0}(e,t,r);case"pingreq":case"pingresp":return o=e,t.write(R.EMPTY[o.cmd]);case"disconnect":return function(e,t,r){var o=r?r.protocolVersion:4,n=e||{},i=n.reasonCode,a=n.properties,s=5===o?1:0,d=null;if(5===o){if(!(d=b(t,a,r,s)))return!1;s+=d.length}t.write(C.from([R.codes.disconnect<<4])),M(t,s),5===o&&t.write(C.from([i]));null!==d&&d.write();return!0}(e,t,r);case"auth":return function(e,t,r){var o=r?r.protocolVersion:4,n=e||{},i=n.reasonCode,a=n.properties,s=5===o?1:0;5!==o&&t.emit("error",new Error("Invalid mqtt version for auth packet"));var d=b(t,a,r,s);if(!d)return!1;s+=d.length,t.write(C.from([R.codes.auth<<4])),M(t,s),t.write(C.from([i])),null!==d&&d.write();return!0}(e,t,r);default:return t.emit("error",new Error("Unknown command")),!1}var o}function f(e){e.uncork()}Object.defineProperty(p,"cacheNumbers",{get:function(){return P===g},set:function(e){P=e?(i&&0!==Object.keys(i).length||(c=!0),g):(c=!1,v)}});var m={};function M(e,t){var r=m[t];r||(r=d(t).data,t<16384&&(m[t]=r)),e.write(r)}function x(e,t){var r=C.byteLength(t);P(e,r),e.write(t,"utf8")}function g(e,t){return e.write(i[t])}function v(e,t){return e.write(a(t))}function y(e,t){"string"==typeof t?x(e,t):t?(P(e,t.length),e.write(t)):P(e,0)}function A(n,i){if("object"!=typeof i||null!=i.length)return{length:1,write:function(){_(n,{},0)}};var e=0;function t(e){var t=R.propertiesTypes[e],r=i[e],o=0;switch(t){case"byte":if("boolean"!=typeof r)return n.emit("error",new Error("Invalid "+e)),!1;o+=2;break;case"int8":if("number"!=typeof r)return n.emit("error",new Error("Invalid "+e)),!1;o+=2;break;case"binary":if(r&&null===r)return n.emit("error",new Error("Invalid "+e)),!1;o+=1+C.byteLength(r)+2;break;case"int16":if("number"!=typeof r)return n.emit("error",new Error("Invalid "+e)),!1;o+=3;break;case"int32":if("number"!=typeof r)return n.emit("error",new Error("Invalid "+e)),!1;o+=5;break;case"var":if("number"!=typeof r)return n.emit("error",new Error("Invalid "+e)),!1;o+=1+d(r).length;break;case"string":if("string"!=typeof r)return n.emit("error",new Error("Invalid "+e)),!1;o+=3+C.byteLength(r.toString());break;case"pair":if("object"!=typeof r)return n.emit("error",new Error("Invalid "+e)),!1;o+=Object.getOwnPropertyNames(r).reduce(function(e,t){return e+=3+C.byteLength(t.toString())+2+C.byteLength(r[t].toString())},0);break;default:return n.emit("error",new Error("Invalid property "+e)),!1}return o}if(i)for(var r in i){var o=t(r);if(!o)return!1;e+=o}return{length:d(e).length+e,write:function(){_(n,i,e)}}}function b(e,t,r,o){var n=["reasonString","userProperties"],i=r&&r.properties&&r.properties.maximumPacketSize?r.properties.maximumPacketSize:0,a=A(e,t);if(i)for(;o+a.length>i;){var s=n.shift();if(!s||!t[s])return!1;delete t[s],a=A(e,t)}return a}function _(n,e,t){for(var i in M(n,t),e)if(e.hasOwnProperty(i)&&null!==e[i]){var a=e[i];switch(R.propertiesTypes[i]){case"byte":n.write(C.from([R.properties[i]])),n.write(C.from([+a]));break;case"int8":n.write(C.from([R.properties[i]])),n.write(C.from([a]));break;case"binary":n.write(C.from([R.properties[i]])),y(n,a);break;case"int16":n.write(C.from([R.properties[i]])),P(n,a);break;case"int32":n.write(C.from([R.properties[i]])),r=a,n.write(u(r));break;case"var":n.write(C.from([R.properties[i]])),M(n,a);break;case"string":n.write(C.from([R.properties[i]])),x(n,a);break;case"pair":Object.getOwnPropertyNames(a).forEach(function(e){var t,r,o;n.write(C.from([R.properties[i]])),t=n,r=e.toString(),o=a[e].toString(),x(t,r),x(t,o)});break;default:return n.emit("error",new Error("Invalid property "+i)),!1}}var r}function w(e){return e?e instanceof C?e.length:C.byteLength(e):0}function S(e){return"string"==typeof e||e instanceof C}t.exports=p},{"./constants":82,"./numbers":86,"process-nextick-args":91,"safe-buffer":110}],90:[function(e,t,r){var o=e("wrappy");function n(e){var t=function(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))};return t.called=!1,t}function i(e){var t=function(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)},r=e.name||"Function wrapped with `once`";return t.onceError=r+" shouldn't be called more than once",t.called=!1,t}t.exports=o(n),t.exports.strict=o(i),n.proto=n(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return n(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return i(this)},configurable:!0})})},{wrappy:120}],91:[function(e,t,r){(function(s){"use strict";!s.version||0===s.version.indexOf("v0.")||0===s.version.indexOf("v1.")&&0!==s.version.indexOf("v1.8.")?t.exports={nextTick:function(e,t,r,o){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var n,i,a=arguments.length;switch(a){case 0:case 1:return s.nextTick(e);case 2:return s.nextTick(function(){e.call(null,t)});case 3:return s.nextTick(function(){e.call(null,t,r)});case 4:return s.nextTick(function(){e.call(null,t,r,o)});default:for(n=new Array(a-1),i=0;i<n.length;)n[i++]=arguments[i];return s.nextTick(function(){e.apply(null,n)})}}}:t.exports=s}).call(this,e("_process"))},{_process:92}],92:[function(e,t,r){var o,n,i=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function d(t){if(o===setTimeout)return setTimeout(t,0);if((o===a||!o)&&setTimeout)return o=setTimeout,setTimeout(t,0);try{return o(t,0)}catch(e){try{return o.call(null,t,0)}catch(e){return o.call(this,t,0)}}}!function(){try{o="function"==typeof setTimeout?setTimeout:a}catch(e){o=a}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var l,u=[],c=!1,p=-1;function h(){c&&l&&(c=!1,l.length?u=l.concat(u):p=-1,u.length&&f())}function f(){if(!c){var e=d(h);c=!0;for(var t=u.length;t;){for(l=u,u=[];++p<t;)l&&l[p].run();p=-1,t=u.length}l=null,c=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new m(e,t)),1!==u.length||c||d(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],93:[function(e,k,O){(function(A){!function(e){var t="object"==typeof O&&O&&!O.nodeType&&O,r="object"==typeof k&&k&&!k.nodeType&&k,o="object"==typeof A&&A;o.global!==o&&o.window!==o&&o.self!==o||(e=o);var n,i,v=2147483647,y=36,b=1,_=26,a=38,s=700,w=72,S=128,E="-",d=/^xn--/,l=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,c={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=y-b,I=Math.floor,T=String.fromCharCode;function R(e){throw new RangeError(c[e])}function h(e,t){for(var r=e.length,o=[];r--;)o[r]=t(e[r]);return o}function f(e,t){var r=e.split("@"),o="";return 1<r.length&&(o=r[0]+"@",e=r[1]),o+h((e=e.replace(u,".")).split("."),t).join(".")}function C(e){for(var t,r,o=[],n=0,i=e.length;n<i;)55296<=(t=e.charCodeAt(n++))&&t<=56319&&n<i?56320==(64512&(r=e.charCodeAt(n++)))?o.push(((1023&t)<<10)+(1023&r)+65536):(o.push(t),n--):o.push(t);return o}function P(e){return h(e,function(e){var t="";return 65535<e&&(t+=T((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=T(e)}).join("")}function M(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function x(e,t,r){var o=0;for(e=r?I(e/s):e>>1,e+=I(e/t);p*_>>1<e;o+=y)e=I(e/p);return I(o+(p+1)*e/(e+a))}function m(e){var t,r,o,n,i,a,s,d,l,u,c,p=[],h=e.length,f=0,m=S,g=w;for((r=e.lastIndexOf(E))<0&&(r=0),o=0;o<r;++o)128<=e.charCodeAt(o)&&R("not-basic"),p.push(e.charCodeAt(o));for(n=0<r?r+1:0;n<h;){for(i=f,a=1,s=y;h<=n&&R("invalid-input"),c=e.charCodeAt(n++),(y<=(d=c-48<10?c-22:c-65<26?c-65:c-97<26?c-97:y)||d>I((v-f)/a))&&R("overflow"),f+=d*a,!(d<(l=s<=g?b:g+_<=s?_:s-g));s+=y)a>I(v/(u=y-l))&&R("overflow"),a*=u;g=x(f-i,t=p.length+1,0==i),I(f/t)>v-m&&R("overflow"),m+=I(f/t),f%=t,p.splice(f++,0,m)}return P(p)}function g(e){var t,r,o,n,i,a,s,d,l,u,c,p,h,f,m,g=[];for(p=(e=C(e)).length,t=S,i=w,a=r=0;a<p;++a)(c=e[a])<128&&g.push(T(c));for(o=n=g.length,n&&g.push(E);o<p;){for(s=v,a=0;a<p;++a)t<=(c=e[a])&&c<s&&(s=c);for(s-t>I((v-r)/(h=o+1))&&R("overflow"),r+=(s-t)*h,t=s,a=0;a<p;++a)if((c=e[a])<t&&++r>v&&R("overflow"),c==t){for(d=r,l=y;!(d<(u=l<=i?b:i+_<=l?_:l-i));l+=y)m=d-u,f=y-u,g.push(T(M(u+m%f,0))),d=I(m/f);g.push(T(M(d,0))),i=x(r,h,o==n),r=0,++o}++r,++t}return g.join("")}if(n={version:"1.4.1",ucs2:{decode:C,encode:P},decode:m,encode:g,toASCII:function(e){return f(e,function(e){return l.test(e)?"xn--"+g(e):e})},toUnicode:function(e){return f(e,function(e){return d.test(e)?m(e.slice(4).toLowerCase()):e})}},t&&r)if(k.exports==t)r.exports=n;else for(i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);else e.punycode=n}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],94:[function(e,t,r){"use strict";t.exports=function(e,t,r,o){t=t||"&",r=r||"=";var n={};if("string"!=typeof e||0===e.length)return n;var i=/\+/g;e=e.split(t);var a=1e3;o&&"number"==typeof o.maxKeys&&(a=o.maxKeys);var s,d,l=e.length;0<a&&a<l&&(l=a);for(var u=0;u<l;++u){var c,p,h,f,m=e[u].replace(i,"%20"),g=m.indexOf(r);p=0<=g?(c=m.substr(0,g),m.substr(g+1)):(c=m,""),h=decodeURIComponent(c),f=decodeURIComponent(p),s=n,d=h,Object.prototype.hasOwnProperty.call(s,d)?v(n[h])?n[h].push(f):n[h]=[n[h],f]:n[h]=f}return n};var v=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],95:[function(e,t,r){"use strict";var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(r,o,n,e){return o=o||"&",n=n||"=",null===r&&(r=void 0),"object"==typeof r?s(d(r),function(e){var t=encodeURIComponent(i(e))+n;return a(r[e])?s(r[e],function(e){return t+encodeURIComponent(i(e))}).join(o):t+encodeURIComponent(i(r[e]))}).join(o):e?encodeURIComponent(i(e))+n+encodeURIComponent(i(r)):""};var a=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function s(e,t){if(e.map)return e.map(t);for(var r=[],o=0;o<e.length;o++)r.push(t(e[o],o));return r}var d=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}},{}],96:[function(e,t,r){"use strict";r.decode=r.parse=e("./decode"),r.encode=r.stringify=e("./encode")},{"./decode":94,"./encode":95}],97:[function(e,t,r){t.exports=e("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":98}],98:[function(e,t,r){"use strict";var o=e("process-nextick-args"),n=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};t.exports=c;var i=e("core-util-is");i.inherits=e("inherits");var a=e("./_stream_readable"),s=e("./_stream_writable");i.inherits(c,a);for(var d=n(s.prototype),l=0;l<d.length;l++){var u=d[l];c.prototype[u]||(c.prototype[u]=s.prototype[u])}function c(e){if(!(this instanceof c))return new c(e);a.call(this,e),s.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",p)}function p(){this.allowHalfOpen||this._writableState.ended||o.nextTick(h,this)}function h(e){e.end()}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),c.prototype._destroy=function(e,t){this.push(null),this.end(),o.nextTick(t,e)}},{"./_stream_readable":100,"./_stream_writable":102,"core-util-is":14,inherits:80,"process-nextick-args":91}],99:[function(e,t,r){"use strict";t.exports=i;var o=e("./_stream_transform"),n=e("core-util-is");function i(e){if(!(this instanceof i))return new i(e);o.call(this,e)}n.inherits=e("inherits"),n.inherits(i,o),i.prototype._transform=function(e,t,r){r(null,e)}},{"./_stream_transform":101,"core-util-is":14,inherits:80}],100:[function(O,U,e){(function(g,e){"use strict";var v=O("process-nextick-args");U.exports=p;var a,y=O("isarray");p.ReadableState=i;O("events").EventEmitter;var b=function(e,t){return e.listeners(t).length},n=O("./internal/streams/stream"),l=O("safe-buffer").Buffer,u=e.Uint8Array||function(){};var t=O("core-util-is");t.inherits=O("inherits");var r=O("util"),_=void 0;_=r&&r.debuglog?r.debuglog("stream"):function(){};var s,d=O("./internal/streams/BufferList"),o=O("./internal/streams/destroy");t.inherits(p,n);var c=["error","close","destroy","pause","resume"];function i(e,t){e=e||{};var r=t instanceof(a=a||O("./_stream_duplex"));this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var o=e.highWaterMark,n=e.readableHighWaterMark,i=this.objectMode?16:16384;this.highWaterMark=o||0===o?o:r&&(n||0===n)?n:i,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new d,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(s||(s=O("string_decoder/").StringDecoder),this.decoder=new s(e.encoding),this.encoding=e.encoding)}function p(e){if(a=a||O("./_stream_duplex"),!(this instanceof p))return new p(e);this._readableState=new i(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),n.call(this)}function h(e,t,r,o,n){var i,a,s,d=e._readableState;null===t?(d.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,S(e)}(e,d)):(n||(i=function(e,t){var r;o=t,l.isBuffer(o)||o instanceof u||"string"==typeof t||void 0===t||e.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));var o;return r}(d,t)),i?e.emit("error",i):d.objectMode||t&&0<t.length?("string"==typeof t||d.objectMode||Object.getPrototypeOf(t)===l.prototype||(a=t,t=l.from(a)),o?d.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):f(e,d,t,!0):d.ended?e.emit("error",new Error("stream.push() after EOF")):(d.reading=!1,d.decoder&&!r?(t=d.decoder.write(t),d.objectMode||0!==t.length?f(e,d,t,!1):I(e,d)):f(e,d,t,!1))):o||(d.reading=!1));return!(s=d).ended&&(s.needReadable||s.length<s.highWaterMark||0===s.length)}function f(e,t,r,o){t.flowing&&0===t.length&&!t.sync?(e.emit("data",r),e.read(0)):(t.length+=t.objectMode?1:r.length,o?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&S(e)),I(e,t)}Object.defineProperty(p.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),p.prototype.destroy=o.destroy,p.prototype._undestroy=o.undestroy,p.prototype._destroy=function(e,t){this.push(null),t(e)},p.prototype.push=function(e,t){var r,o=this._readableState;return o.objectMode?r=!0:"string"==typeof e&&((t=t||o.defaultEncoding)!==o.encoding&&(e=l.from(e,t),t=""),r=!0),h(this,e,t,!1,r)},p.prototype.unshift=function(e){return h(this,e,null,!0,!1)},p.prototype.isPaused=function(){return!1===this._readableState.flowing},p.prototype.setEncoding=function(e){return s||(s=O("string_decoder/").StringDecoder),this._readableState.decoder=new s(e),this._readableState.encoding=e,this};var m=8388608;function w(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=(m<=(r=e)?r=m:(r--,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r++),r)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0));var r}function S(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(_("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?v.nextTick(E,e):E(e))}function E(e){_("emit readable"),e.emit("readable"),P(e)}function I(e,t){t.readingMore||(t.readingMore=!0,v.nextTick(T,e,t))}function T(e,t){for(var r=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(_("maybeReadMore read 0"),e.read(0),r!==t.length);)r=t.length;t.readingMore=!1}function R(e){_("readable nexttick read 0"),e.read(0)}function C(e,t){t.reading||(_("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),P(e),t.flowing&&!t.reading&&e.read(0)}function P(e){var t=e._readableState;for(_("flow",t.flowing);t.flowing&&null!==e.read(););}function M(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):r=function(e,t,r){var o;e<t.head.data.length?(o=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):o=e===t.head.data.length?t.shift():r?function(e,t){var r=t.head,o=1,n=r.data;e-=n.length;for(;r=r.next;){var i=r.data,a=e>i.length?i.length:e;if(a===i.length?n+=i:n+=i.slice(0,e),0===(e-=a)){a===i.length?(++o,r.next?t.head=r.next:t.head=t.tail=null):(t.head=r).data=i.slice(a);break}++o}return t.length-=o,n}(e,t):function(e,t){var r=l.allocUnsafe(e),o=t.head,n=1;o.data.copy(r),e-=o.data.length;for(;o=o.next;){var i=o.data,a=e>i.length?i.length:e;if(i.copy(r,r.length-e,0,a),0===(e-=a)){a===i.length?(++n,o.next?t.head=o.next:t.head=t.tail=null):(t.head=o).data=i.slice(a);break}++n}return t.length-=n,r}(e,t);return o}(e,t.buffer,t.decoder),r);var r}function x(e){var t=e._readableState;if(0<t.length)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,v.nextTick(A,t,e))}function A(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function k(e,t){for(var r=0,o=e.length;r<o;r++)if(e[r]===t)return r;return-1}p.prototype.read=function(e){_("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return _("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?x(this):S(this),null;if(0===(e=w(e,t))&&t.ended)return 0===t.length&&x(this),null;var o,n=t.needReadable;return _("need readable",n),(0===t.length||t.length-e<t.highWaterMark)&&_("length less than watermark",n=!0),t.ended||t.reading?_("reading or ended",n=!1):n&&(_("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=w(r,t))),null===(o=0<e?M(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&x(this)),null!==o&&this.emit("data",o),o},p.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},p.prototype.pipe=function(r,e){var o=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=r;break;case 1:n.pipes=[n.pipes,r];break;default:n.pipes.push(r)}n.pipesCount+=1,_("pipe count=%d opts=%j",n.pipesCount,e);var t=(!e||!1!==e.end)&&r!==g.stdout&&r!==g.stderr?a:m;function i(e,t){_("onunpipe"),e===o&&t&&!1===t.hasUnpiped&&(t.hasUnpiped=!0,_("cleanup"),r.removeListener("close",h),r.removeListener("finish",f),r.removeListener("drain",d),r.removeListener("error",p),r.removeListener("unpipe",i),o.removeListener("end",a),o.removeListener("end",m),o.removeListener("data",c),l=!0,!n.awaitDrain||r._writableState&&!r._writableState.needDrain||d())}function a(){_("onend"),r.end()}n.endEmitted?v.nextTick(t):o.once("end",t),r.on("unpipe",i);var s,d=(s=o,function(){var e=s._readableState;_("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&b(s,"data")&&(e.flowing=!0,P(s))});r.on("drain",d);var l=!1;var u=!1;function c(e){_("ondata"),(u=!1)!==r.write(e)||u||((1===n.pipesCount&&n.pipes===r||1<n.pipesCount&&-1!==k(n.pipes,r))&&!l&&(_("false write response, pause",o._readableState.awaitDrain),o._readableState.awaitDrain++,u=!0),o.pause())}function p(e){_("onerror",e),m(),r.removeListener("error",p),0===b(r,"error")&&r.emit("error",e)}function h(){r.removeListener("finish",f),m()}function f(){_("onfinish"),r.removeListener("close",h),m()}function m(){_("unpipe"),o.unpipe(r)}return o.on("data",c),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?y(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(r,"error",p),r.once("close",h),r.once("finish",f),r.emit("pipe",o),n.flowing||(_("pipe resume"),o.resume()),r},p.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var o=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<n;i++)o[i].emit("unpipe",this,r);return this}var a=k(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},p.prototype.addListener=p.prototype.on=function(e,t){var r=n.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var o=this._readableState;o.endEmitted||o.readableListening||(o.readableListening=o.needReadable=!0,o.emittedReadable=!1,o.reading?o.length&&S(this):v.nextTick(R,this))}return r},p.prototype.resume=function(){var e,t,r=this._readableState;return r.flowing||(_("resume"),r.flowing=!0,e=this,(t=r).resumeScheduled||(t.resumeScheduled=!0,v.nextTick(C,e,t))),this},p.prototype.pause=function(){return _("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(_("pause"),this._readableState.flowing=!1,this.emit("pause")),this},p.prototype.wrap=function(t){var r=this,o=this._readableState,n=!1;for(var e in t.on("end",function(){if(_("wrapped end"),o.decoder&&!o.ended){var e=o.decoder.end();e&&e.length&&r.push(e)}r.push(null)}),t.on("data",function(e){(_("wrapped data"),o.decoder&&(e=o.decoder.write(e)),o.objectMode&&null==e)||(o.objectMode||e&&e.length)&&(r.push(e)||(n=!0,t.pause()))}),t)void 0===this[e]&&"function"==typeof t[e]&&(this[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e));for(var i=0;i<c.length;i++)t.on(c[i],this.emit.bind(this,c[i]));return this._read=function(e){_("wrapped _read",e),n&&(n=!1,t.resume())},this},Object.defineProperty(p.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),p._fromList=M}).call(this,O("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":98,"./internal/streams/BufferList":103,"./internal/streams/destroy":104,"./internal/streams/stream":105,_process:92,"core-util-is":14,events:13,inherits:80,isarray:106,"process-nextick-args":91,"safe-buffer":110,"string_decoder/":107,util:11}],101:[function(e,t,r){"use strict";t.exports=i;var o=e("./_stream_duplex"),n=e("core-util-is");function i(e){if(!(this instanceof i))return new i(e);o.call(this,e),this._transformState={afterTransform:function(e,t){var r=this._transformState;r.transforming=!1;var o=r.writecb;if(!o)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,(r.writecb=null)!=t&&this.push(t),o(e);var n=this._readableState;n.reading=!1,(n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",a)}function a(){var r=this;"function"==typeof this._flush?this._flush(function(e,t){s(r,e,t)}):s(this,null,null)}function s(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}n.inherits=e("inherits"),n.inherits(i,o),i.prototype.push=function(e,t){return this._transformState.needTransform=!1,o.prototype.push.call(this,e,t)},i.prototype._transform=function(e,t,r){throw new Error("_transform() is not implemented")},i.prototype._write=function(e,t,r){var o=this._transformState;if(o.writecb=r,o.writechunk=e,o.writeencoding=t,!o.transforming){var n=this._readableState;(o.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}},i.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},i.prototype._destroy=function(e,t){var r=this;o.prototype._destroy.call(this,e,function(e){t(e),r.emit("close")})}},{"./_stream_duplex":98,"core-util-is":14,inherits:80}],102:[function(E,I,e){(function(e,t,r){"use strict";var v=E("process-nextick-args");function c(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,r){var o=e.entry;e.entry=null;for(;o;){var n=o.callback;t.pendingcb--,n(r),o=o.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}I.exports=u;var s,p=!e.browser&&-1<["v0.10","v0.9."].indexOf(e.version.slice(0,5))?r:v.nextTick;u.WritableState=l;var o=E("core-util-is");o.inherits=E("inherits");var n={deprecate:E("util-deprecate")},i=E("./internal/streams/stream"),y=E("safe-buffer").Buffer,b=t.Uint8Array||function(){};var a,d=E("./internal/streams/destroy");function _(){}function l(e,t){s=s||E("./_stream_duplex"),e=e||{};var r=t instanceof s;this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var o=e.highWaterMark,n=e.writableHighWaterMark,i=this.objectMode?16:16384;this.highWaterMark=o||0===o?o:r&&(n||0===n)?n:i,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var a=(this.destroyed=!1)===e.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,o=r.sync,n=r.writecb;if(c=r,c.writing=!1,c.writecb=null,c.length-=c.writelen,c.writelen=0,t)a=e,s=r,d=o,l=t,u=n,--s.pendingcb,d?(v.nextTick(u,l),v.nextTick(S,a,s),a._writableState.errorEmitted=!0,a.emit("error",l)):(u(l),a._writableState.errorEmitted=!0,a.emit("error",l),S(a,s));else{var i=m(r);i||r.corked||r.bufferProcessing||!r.bufferedRequest||f(e,r),o?p(h,e,r,i,n):h(e,r,i,n)}var a,s,d,l,u;var c}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new c(this)}function u(e){if(s=s||E("./_stream_duplex"),!(a.call(u,this)||this instanceof s))return new u(e);this._writableState=new l(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),i.call(this)}function w(e,t,r,o,n,i,a){t.writelen=o,t.writecb=a,t.writing=!0,t.sync=!0,r?e._writev(n,t.onwrite):e._write(n,i,t.onwrite),t.sync=!1}function h(e,t,r,o){var n,i;r||(n=e,0===(i=t).length&&i.needDrain&&(i.needDrain=!1,n.emit("drain"))),t.pendingcb--,o(),S(e,t)}function f(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var o=t.bufferedRequestCount,n=new Array(o),i=t.corkedRequestsFree;i.entry=r;for(var a=0,s=!0;r;)(n[a]=r).isBuf||(s=!1),r=r.next,a+=1;n.allBuffers=s,w(e,t,!0,t.length,n,"",i.finish),t.pendingcb++,t.lastBufferedRequest=null,i.next?(t.corkedRequestsFree=i.next,i.next=null):t.corkedRequestsFree=new c(t),t.bufferedRequestCount=0}else{for(;r;){var d=r.chunk,l=r.encoding,u=r.callback;if(w(e,t,!1,t.objectMode?1:d.length,d,l,u),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function m(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function g(t,r){t._final(function(e){r.pendingcb--,e&&t.emit("error",e),r.prefinished=!0,t.emit("prefinish"),S(t,r)})}function S(e,t){var r,o,n=m(t);return n&&(r=e,(o=t).prefinished||o.finalCalled||("function"==typeof r._final?(o.pendingcb++,o.finalCalled=!0,v.nextTick(g,r,o)):(o.prefinished=!0,r.emit("prefinish"))),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),n}o.inherits(u,i),l.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(l.prototype,"buffer",{get:n.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(a=Function.prototype[Symbol.hasInstance],Object.defineProperty(u,Symbol.hasInstance,{value:function(e){return!!a.call(this,e)||this===u&&(e&&e._writableState instanceof l)}})):a=function(e){return e instanceof this},u.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},u.prototype.write=function(e,t,r){var o,n,i,a,s,d,l,u,c,p,h,f=this._writableState,m=!1,g=!f.objectMode&&(o=e,y.isBuffer(o)||o instanceof b);return g&&!y.isBuffer(e)&&(n=e,e=y.from(n)),"function"==typeof t&&(r=t,t=null),g?t="buffer":t||(t=f.defaultEncoding),"function"!=typeof r&&(r=_),f.ended?(c=this,p=r,h=new Error("write after end"),c.emit("error",h),v.nextTick(p,h)):(g||(i=this,a=f,d=r,u=!(l=!0),null===(s=e)?u=new TypeError("May not write null values to stream"):"string"==typeof s||void 0===s||a.objectMode||(u=new TypeError("Invalid non-string/buffer chunk")),u&&(i.emit("error",u),v.nextTick(d,u),l=!1),l))&&(f.pendingcb++,m=function(e,t,r,o,n,i){if(!r){var a=function(e,t,r){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=y.from(t,r));return t}(t,o,n);o!==a&&(r=!0,n="buffer",o=a)}var s=t.objectMode?1:o.length;t.length+=s;var d=t.length<t.highWaterMark;d||(t.needDrain=!0);if(t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest={chunk:o,encoding:n,isBuf:r,callback:i,next:null},l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else w(e,t,!1,s,o,n,i);return d}(this,f,g,e,t,r)),m},u.prototype.cork=function(){this._writableState.corked++},u.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||f(this,e))},u.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),u.prototype._write=function(e,t,r){r(new Error("_write() is not implemented"))},u.prototype._writev=null,u.prototype.end=function(e,t,r){var o=this._writableState;"function"==typeof e?(r=e,t=e=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),o.corked&&(o.corked=1,this.uncork()),o.ending||o.finished||function(e,t,r){t.ending=!0,S(e,t),r&&(t.finished?v.nextTick(r):e.once("finish",r));t.ended=!0,e.writable=!1}(this,o,r)},Object.defineProperty(u.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),u.prototype.destroy=d.destroy,u.prototype._undestroy=d.undestroy,u.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,E("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},E("timers").setImmediate)},{"./_stream_duplex":98,"./internal/streams/destroy":104,"./internal/streams/stream":105,_process:92,"core-util-is":14,inherits:80,"process-nextick-args":91,"safe-buffer":110,timers:112,"util-deprecate":115}],103:[function(e,t,r){"use strict";var s=e("safe-buffer").Buffer,o=e("util");t.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};0<this.length?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r},e.prototype.concat=function(e){if(0===this.length)return s.alloc(0);if(1===this.length)return this.head.data;for(var t,r,o,n=s.allocUnsafe(e>>>0),i=this.head,a=0;i;)t=i.data,r=n,o=a,t.copy(r,o),a+=i.data.length,i=i.next;return n},e}(),o&&o.inspect&&o.inspect.custom&&(t.exports.prototype[o.inspect.custom]=function(){var e=o.inspect({length:this.length});return this.constructor.name+" "+e})},{"safe-buffer":110,util:11}],104:[function(e,t,r){"use strict";var i=e("process-nextick-args");function a(e,t){e.emit("error",t)}t.exports={destroy:function(e,t){var r=this,o=this._readableState&&this._readableState.destroyed,n=this._writableState&&this._writableState.destroyed;return o||n?t?t(e):!e||this._writableState&&this._writableState.errorEmitted||i.nextTick(a,this,e):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(i.nextTick(a,r,e),r._writableState&&(r._writableState.errorEmitted=!0)):t&&t(e)})),this},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},{"process-nextick-args":91}],105:[function(e,t,r){t.exports=e("events").EventEmitter},{events:13}],106:[function(e,t,r){var o={}.toString;t.exports=Array.isArray||function(e){return"[object Array]"==o.call(e)}},{}],107:[function(e,t,r){"use strict";var o=e("safe-buffer").Buffer,n=o.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function i(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(o.isEncoding===n||!n(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=d,this.end=l,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=u,this.end=c,t=3;break;default:return this.write=p,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=o.allocUnsafe(t)}function a(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function s(e){var t=this.lastTotal-this.lastNeed,r=function(e,t,r){if(128!=(192&t[0]))return e.lastNeed=0,"";if(1<e.lastNeed&&1<t.length){if(128!=(192&t[1]))return e.lastNeed=1,"";if(2<e.lastNeed&&2<t.length&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function d(e,t){if((e.length-t)%2!=0)return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1);var r=e.toString("utf16le",t);if(r){var o=r.charCodeAt(r.length-1);if(55296<=o&&o<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}function l(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function u(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function c(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function p(e){return e.toString(this.encoding)}function h(e){return e&&e.length?this.write(e):""}(r.StringDecoder=i).prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},i.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},i.prototype.text=function(e,t){var r=function(e,t,r){var o=t.length-1;if(o<r)return 0;var n=a(t[o]);if(0<=n)return 0<n&&(e.lastNeed=n-1),n;if(--o<r||-2===n)return 0;if(0<=(n=a(t[o])))return 0<n&&(e.lastNeed=n-2),n;if(--o<r||-2===n)return 0;if(0<=(n=a(t[o])))return 0<n&&(2===n?n=0:e.lastNeed=n-3),n;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var o=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,o),e.toString("utf8",t,o)},i.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},{"safe-buffer":110}],108:[function(e,t,r){(((r=t.exports=e("./lib/_stream_readable.js")).Stream=r).Readable=r).Writable=e("./lib/_stream_writable.js"),r.Duplex=e("./lib/_stream_duplex.js"),r.Transform=e("./lib/_stream_transform.js"),r.PassThrough=e("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":98,"./lib/_stream_passthrough.js":99,"./lib/_stream_readable.js":100,"./lib/_stream_transform.js":101,"./lib/_stream_writable.js":102}],109:[function(e,t,r){"use strict";function o(e,t,r){var o=this;this._callback=e,this._args=r,this._interval=setInterval(e,t,this._args),this.reschedule=function(e){e||(e=o._interval),o._interval&&clearInterval(o._interval),o._interval=setInterval(o._callback,e,o._args)},this.clear=function(){o._interval&&(clearInterval(o._interval),o._interval=void 0)},this.destroy=function(){o._interval&&clearInterval(o._interval),o._callback=void 0,o._interval=void 0,o._args=void 0}}t.exports=function(){if("function"!=typeof arguments[0])throw new Error("callback needed");if("number"!=typeof arguments[1])throw new Error("interval needed");var e;if(0<arguments.length){e=new Array(arguments.length-2);for(var t=0;t<e.length;t++)e[t]=arguments[t+2]}return new o(arguments[0],arguments[1],e)}},{}],110:[function(e,t,r){var o=e("buffer"),n=o.Buffer;function i(e,t){for(var r in e)t[r]=e[r]}function a(e,t,r){return n(e,t,r)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?t.exports=o:(i(o,r),r.Buffer=a),i(n,a),a.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return n(e,t,r)},a.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var o=n(e);return void 0!==t?"string"==typeof r?o.fill(t,r):o.fill(t):o.fill(0),o},a.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n(e)},a.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o.SlowBuffer(e)}},{buffer:12}],111:[function(e,t,r){t.exports=function(e){var t=e._readableState;return t?t.objectMode?e.read():e.read((r=t,r.buffer.length?r.buffer.head?r.buffer.head.data.length:r.buffer[0].length:r.length)):null;var r}},{}],112:[function(d,e,l){(function(e,t){var o=d("process/browser.js").nextTick,r=Function.prototype.apply,n=Array.prototype.slice,i={},a=0;function s(e,t){this._id=e,this._clearFn=t}l.setTimeout=function(){return new s(r.call(setTimeout,window,arguments),clearTimeout)},l.setInterval=function(){return new s(r.call(setInterval,window,arguments),clearInterval)},l.clearTimeout=l.clearInterval=function(e){e.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(window,this._id)},l.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},l.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},l._unrefActive=l.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},l.setImmediate="function"==typeof e?e:function(e){var t=a++,r=!(arguments.length<2)&&n.call(arguments,1);return i[t]=!0,o(function(){i[t]&&(r?e.apply(null,r):e.call(null),l.clearImmediate(t))}),t},l.clearImmediate="function"==typeof t?t:function(e){delete i[e]}}).call(this,d("timers").setImmediate,d("timers").clearImmediate)},{"process/browser.js":92,timers:112}],113:[function(e,t,r){"use strict";var O=e("punycode"),U=e("./util");function C(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}r.parse=i,r.resolve=function(e,t){return i(e,!1,!0).resolve(t)},r.resolveObject=function(e,t){return e?i(e,!1,!0).resolveObject(t):t},r.format=function(e){U.isString(e)&&(e=i(e));return e instanceof C?e.format():C.prototype.format.call(e)},r.Url=C;var L=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,D=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,n=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),N=["'"].concat(n),B=["%","/","?",";","#"].concat(N),j=["/","?","#"],V=/^[+a-z0-9A-Z_-]{0,63}$/,F=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,q={javascript:!0,"javascript:":!0},G={javascript:!0,"javascript:":!0},H={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},W=e("querystring");function i(e,t,r){if(e&&U.isObject(e)&&e instanceof C)return e;var o=new C;return o.parse(e,t,r),o}C.prototype.parse=function(e,t,r){if(!U.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),n=-1!==o&&o<e.indexOf("#")?"?":"#",i=e.split(n);i[0]=i[0].replace(/\\/g,"/");var a=e=i.join(n);if(a=a.trim(),!r&&1===e.split("#").length){var s=D.exec(a);if(s)return this.path=a,this.href=a,this.pathname=s[1],s[2]?(this.search=s[2],this.query=t?W.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var d=L.exec(a);if(d){var l=(d=d[0]).toLowerCase();this.protocol=l,a=a.substr(d.length)}if(r||d||a.match(/^\/\/[^@\/]+@[^@\/]+/)){var u="//"===a.substr(0,2);!u||d&&G[d]||(a=a.substr(2),this.slashes=!0)}if(!G[d]&&(u||d&&!H[d])){for(var c,p,h=-1,f=0;f<j.length;f++){-1!==(m=a.indexOf(j[f]))&&(-1===h||m<h)&&(h=m)}-1!==(p=-1===h?a.lastIndexOf("@"):a.lastIndexOf("@",h))&&(c=a.slice(0,p),a=a.slice(p+1),this.auth=decodeURIComponent(c)),h=-1;for(f=0;f<B.length;f++){var m;-1!==(m=a.indexOf(B[f]))&&(-1===h||m<h)&&(h=m)}-1===h&&(h=a.length),this.host=a.slice(0,h),a=a.slice(h),this.parseHost(),this.hostname=this.hostname||"";var g="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!g)for(var v=this.hostname.split(/\./),y=(f=0,v.length);f<y;f++){var b=v[f];if(b&&!b.match(V)){for(var _="",w=0,S=b.length;w<S;w++)127<b.charCodeAt(w)?_+="x":_+=b[w];if(!_.match(V)){var E=v.slice(0,f),I=v.slice(f+1),T=b.match(F);T&&(E.push(T[1]),I.unshift(T[2])),I.length&&(a="/"+I.join(".")+a),this.hostname=E.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),g||(this.hostname=O.toASCII(this.hostname));var R=this.port?":"+this.port:"",C=this.hostname||"";this.host=C+R,this.href+=this.host,g&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==a[0]&&(a="/"+a))}if(!q[l])for(f=0,y=N.length;f<y;f++){var P=N[f];if(-1!==a.indexOf(P)){var M=encodeURIComponent(P);M===P&&(M=escape(P)),a=a.split(P).join(M)}}var x=a.indexOf("#");-1!==x&&(this.hash=a.substr(x),a=a.slice(0,x));var A=a.indexOf("?");if(-1!==A?(this.search=a.substr(A),this.query=a.substr(A+1),t&&(this.query=W.parse(this.query)),a=a.slice(0,A)):t&&(this.search="",this.query={}),a&&(this.pathname=a),H[l]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){R=this.pathname||"";var k=this.search||"";this.path=R+k}return this.href=this.format(),this},C.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",o=this.hash||"",n=!1,i="";this.host?n=e+this.host:this.hostname&&(n=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&U.isObject(this.query)&&Object.keys(this.query).length&&(i=W.stringify(this.query));var a=this.search||i&&"?"+i||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||H[t])&&!1!==n?(n="//"+(n||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):n||(n=""),o&&"#"!==o.charAt(0)&&(o="#"+o),a&&"?"!==a.charAt(0)&&(a="?"+a),t+n+(r=r.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(a=a.replace("#","%23"))+o},C.prototype.resolve=function(e){return this.resolveObject(i(e,!1,!0)).format()},C.prototype.resolveObject=function(e){if(U.isString(e)){var t=new C;t.parse(e,!1,!0),e=t}for(var r=new C,o=Object.keys(this),n=0;n<o.length;n++){var i=o[n];r[i]=this[i]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var a=Object.keys(e),s=0;s<a.length;s++){var d=a[s];"protocol"!==d&&(r[d]=e[d])}return H[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!H[e.protocol]){for(var l=Object.keys(e),u=0;u<l.length;u++){var c=l[u];r[c]=e[c]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||G[e.protocol])r.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),r.pathname=p.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var h=r.pathname||"",f=r.search||"";r.path=h+f}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var m=r.pathname&&"/"===r.pathname.charAt(0),g=e.host||e.pathname&&"/"===e.pathname.charAt(0),v=g||m||r.host&&e.pathname,y=v,b=r.pathname&&r.pathname.split("/")||[],_=(p=e.pathname&&e.pathname.split("/")||[],r.protocol&&!H[r.protocol]);if(_&&(r.hostname="",r.port=null,r.host&&(""===b[0]?b[0]=r.host:b.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),v=v&&(""===p[0]||""===b[0])),g)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,b=p;else if(p.length)b||(b=[]),b.pop(),b=b.concat(p),r.search=e.search,r.query=e.query;else if(!U.isNullOrUndefined(e.search)){if(_)r.hostname=r.host=b.shift(),(T=!!(r.host&&0<r.host.indexOf("@"))&&r.host.split("@"))&&(r.auth=T.shift(),r.host=r.hostname=T.shift());return r.search=e.search,r.query=e.query,U.isNull(r.pathname)&&U.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!b.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var w=b.slice(-1)[0],S=(r.host||e.host||1<b.length)&&("."===w||".."===w)||""===w,E=0,I=b.length;0<=I;I--)"."===(w=b[I])?b.splice(I,1):".."===w?(b.splice(I,1),E++):E&&(b.splice(I,1),E--);if(!v&&!y)for(;E--;E)b.unshift("..");!v||""===b[0]||b[0]&&"/"===b[0].charAt(0)||b.unshift(""),S&&"/"!==b.join("/").substr(-1)&&b.push("");var T,R=""===b[0]||b[0]&&"/"===b[0].charAt(0);_&&(r.hostname=r.host=R?"":b.length?b.shift():"",(T=!!(r.host&&0<r.host.indexOf("@"))&&r.host.split("@"))&&(r.auth=T.shift(),r.host=r.hostname=T.shift()));return(v=v||r.host&&b.length)&&!R&&b.unshift(""),b.length?r.pathname=b.join("/"):(r.pathname=null,r.path=null),U.isNull(r.pathname)&&U.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},C.prototype.parseHost=function(){var e=this.host,t=o.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{"./util":114,punycode:93,querystring:96}],114:[function(e,t,r){"use strict";t.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},{}],115:[function(e,t,r){(function(r){function o(e){try{if(!r.localStorage)return!1}catch(e){return!1}var t=r.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}t.exports=function(e,t){if(o("noDeprecation"))return e;var r=!1;return function(){if(!r){if(o("throwDeprecation"))throw new Error(t);o("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],116:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],117:[function(p,e,C){(function(o,n){var s=/%[sdj%]/g;C.format=function(e){if(!_(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(d(arguments[r]));return t.join(" ")}r=1;for(var o=arguments,n=o.length,i=String(e).replace(s,function(e){if("%%"===e)return"%";if(n<=r)return e;switch(e){case"%s":return String(o[r++]);case"%d":return Number(o[r++]);case"%j":try{return JSON.stringify(o[r++])}catch(e){return"[Circular]"}default:return e}}),a=o[r];r<n;a=o[++r])y(a)||!u(a)?i+=" "+a:i+=" "+d(a);return i},C.deprecate=function(e,t){if(w(n.process))return function(){return C.deprecate(e,t).apply(this,arguments)};if(!0===o.noDeprecation)return e;var r=!1;return function(){if(!r){if(o.throwDeprecation)throw new Error(t);o.traceDeprecation?console.trace(t):console.error(t),r=!0}return e.apply(this,arguments)}};var e,i={};function d(e,t){var r={seen:[],stylize:l};return 3<=arguments.length&&(r.depth=arguments[2]),4<=arguments.length&&(r.colors=arguments[3]),v(t)?r.showHidden=t:t&&C._extend(r,t),w(r.showHidden)&&(r.showHidden=!1),w(r.depth)&&(r.depth=2),w(r.colors)&&(r.colors=!1),w(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=a),h(r,e,r.depth)}function a(e,t){var r=d.styles[t];return r?"["+d.colors[r][0]+"m"+e+"["+d.colors[r][1]+"m":e}function l(e,t){return e}function h(t,r,o){if(t.customInspect&&r&&T(r.inspect)&&r.inspect!==C.inspect&&(!r.constructor||r.constructor.prototype!==r)){var e=r.inspect(o,t);return _(e)||(e=h(t,e,o)),e}var n=function(e,t){if(w(t))return e.stylize("undefined","undefined");if(_(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(b(t))return e.stylize(""+t,"number");if(v(t))return e.stylize(""+t,"boolean");if(y(t))return e.stylize("null","null")}(t,r);if(n)return n;var i,a=Object.keys(r),s=(i={},a.forEach(function(e,t){i[e]=!0}),i);if(t.showHidden&&(a=Object.getOwnPropertyNames(r)),I(r)&&(0<=a.indexOf("message")||0<=a.indexOf("description")))return f(r);if(0===a.length){if(T(r)){var d=r.name?": "+r.name:"";return t.stylize("[Function"+d+"]","special")}if(S(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(E(r))return t.stylize(Date.prototype.toString.call(r),"date");if(I(r))return f(r)}var l,u="",c=!1,p=["{","}"];(g(r)&&(c=!0,p=["[","]"]),T(r))&&(u=" [Function"+(r.name?": "+r.name:"")+"]");return S(r)&&(u=" "+RegExp.prototype.toString.call(r)),E(r)&&(u=" "+Date.prototype.toUTCString.call(r)),I(r)&&(u=" "+f(r)),0!==a.length||c&&0!=r.length?o<0?S(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special"):(t.seen.push(r),l=c?function(t,r,o,n,e){for(var i=[],a=0,s=r.length;a<s;++a)R(r,String(a))?i.push(m(t,r,o,n,String(a),!0)):i.push("");return e.forEach(function(e){e.match(/^\d+$/)||i.push(m(t,r,o,n,e,!0))}),i}(t,r,o,s,a):a.map(function(e){return m(t,r,o,s,e,c)}),t.seen.pop(),function(e,t,r){if(60<e.reduce(function(e,t){return 0,0<=t.indexOf("\n")&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0))return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(l,u,p)):p[0]+u+p[1]}function f(e){return"["+Error.prototype.toString.call(e)+"]"}function m(e,t,r,o,n,i){var a,s,d;if((d=Object.getOwnPropertyDescriptor(t,n)||{value:t[n]}).get?s=d.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):d.set&&(s=e.stylize("[Setter]","special")),R(o,n)||(a="["+n+"]"),s||(e.seen.indexOf(d.value)<0?-1<(s=y(r)?h(e,d.value,null):h(e,d.value,r-1)).indexOf("\n")&&(s=i?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),w(a)){if(i&&n.match(/^\d+$/))return s;a=(a=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),e.stylize(a,"string"))}return a+": "+s}function g(e){return Array.isArray(e)}function v(e){return"boolean"==typeof e}function y(e){return null===e}function b(e){return"number"==typeof e}function _(e){return"string"==typeof e}function w(e){return void 0===e}function S(e){return u(e)&&"[object RegExp]"===t(e)}function u(e){return"object"==typeof e&&null!==e}function E(e){return u(e)&&"[object Date]"===t(e)}function I(e){return u(e)&&("[object Error]"===t(e)||e instanceof Error)}function T(e){return"function"==typeof e}function t(e){return Object.prototype.toString.call(e)}function r(e){return e<10?"0"+e.toString(10):e.toString(10)}C.debuglog=function(t){if(w(e)&&(e=o.env.NODE_DEBUG||""),t=t.toUpperCase(),!i[t])if(new RegExp("\\b"+t+"\\b","i").test(e)){var r=o.pid;i[t]=function(){var e=C.format.apply(C,arguments);console.error("%s %d: %s",t,r,e)}}else i[t]=function(){};return i[t]},(C.inspect=d).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},d.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},C.isArray=g,C.isBoolean=v,C.isNull=y,C.isNullOrUndefined=function(e){return null==e},C.isNumber=b,C.isString=_,C.isSymbol=function(e){return"symbol"==typeof e},C.isUndefined=w,C.isRegExp=S,C.isObject=u,C.isDate=E,C.isError=I,C.isFunction=T,C.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},C.isBuffer=p("./support/isBuffer");var c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function R(e,t){return Object.prototype.hasOwnProperty.call(e,t)}C.log=function(){var e,t;console.log("%s - %s",(e=new Date,t=[r(e.getHours()),r(e.getMinutes()),r(e.getSeconds())].join(":"),[e.getDate(),c[e.getMonth()],t].join(" ")),C.format.apply(C,arguments))},C.inherits=p("inherits"),C._extend=function(e,t){if(!t||!u(t))return e;for(var r=Object.keys(t),o=r.length;o--;)e[r[o]]=t[r[o]];return e}}).call(this,p("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":116,_process:92,inherits:80}],118:[function(e,t,r){(function(g,v){"use strict";var y=e("readable-stream").Transform,b=e("duplexify"),_=e("ws"),w=e("safe-buffer").Buffer;t.exports=function(e,t,r){var o,n,i="browser"===g.title,a=!!v.WebSocket,s=i?function e(t,r,o){if(n.bufferedAmount>h)return void setTimeout(e,f,t,r,o);m&&"string"==typeof t&&(t=w.from(t,"utf8"));try{n.send(t)}catch(e){return o(e)}o()}:function(e,t,r){if(n.readyState!==n.OPEN)return void r();m&&"string"==typeof e&&(e=w.from(e,"utf8"));n.send(e,r)};t&&!Array.isArray(t)&&"object"==typeof t&&(r=t,t=null,("string"==typeof r.protocol||Array.isArray(r.protocol))&&(t=r.protocol));r||(r={});void 0===r.objectMode&&(r.objectMode=!(!0===r.binary||void 0===r.binary));var d=(l=r,u=s,c=function(e){n.close(),e()},p=new y({objectMode:l.objectMode}),p._write=u,p._flush=c,p);var l,u,c,p;r.objectMode||(d._writev=function(e,t){for(var r=new Array(e.length),o=0;o<e.length;o++)"string"==typeof e[o].chunk?r[o]=w.from(e[o],"utf8"):r[o]=e[o].chunk;this._write(w.concat(r),"binary",t)});var h=r.browserBufferSize||524288,f=r.browserBufferTimeout||1e3;"object"==typeof e?n=e:(n=a&&i?new _(e,t):new _(e,t,r)).binaryType="arraybuffer";n.readyState===n.OPEN?o=d:(o=b.obj(),n.onopen=function(){o.setReadable(d),o.setWritable(d),o.emit("connect")});(o.socket=n).onclose=function(){o.end(),o.destroy()},n.onerror=function(e){o.destroy(e)},n.onmessage=function(e){var t=e.data;t=t instanceof ArrayBuffer?w.from(t):w.from(t,"utf8");d.push(t)},d.on("close",function(){n.close()});var m=!r.objectMode;return o}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:92,duplexify:17,"readable-stream":108,"safe-buffer":110,ws:119}],119:[function(e,t,r){var o=null;"undefined"!=typeof WebSocket?o=WebSocket:"undefined"!=typeof MozWebSocket?o=MozWebSocket:"undefined"!=typeof window&&(o=window.WebSocket||window.MozWebSocket),t.exports=o},{}],120:[function(e,t,r){t.exports=function e(n,t){if(n&&t)return e(n)(t);if("function"!=typeof n)throw new TypeError("need wrapper function");Object.keys(n).forEach(function(e){r[e]=n[e]});return r;function r(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];var r=n.apply(this,e),o=e[e.length-1];return"function"==typeof r&&r!==o&&Object.keys(o).forEach(function(e){r[e]=o[e]}),r}}},{}],121:[function(e,t,r){t.exports=function(){for(var e={},t=0;t<arguments.length;t++){var r=arguments[t];for(var o in r)n.call(r,o)&&(e[o]=r[o])}return e};var n=Object.prototype.hasOwnProperty},{}]},{},[9])(9)}),function(n,c){"use strict";var p="function",i="undefined",h="object",a="string",s="model",e="name",t="type",d="vendor",l="version",u="architecture",r="console",o="mobile",f="tablet",m="smarttv",g="wearable",v="Amazon",y="BlackBerry",b="Browser",_="Chrome",w="Firefox",S="Google",E="Microsoft",I="Opera",T="Samsung",R=function(e){for(var t={},r=0;r<e.length;r++)t[e[r].toUpperCase()]=e[r];return t},C=function(e,t){return typeof e===a&&-1!==P(t).indexOf(P(e))},P=function(e){return e.toLowerCase()},M=function(e,t){if(typeof e===a)return e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),typeof t===i?e:e.substring(0,255)},x=function(e,t){for(var r,o,n,i,a,s,d=0;d<t.length&&!a;){var l=t[d],u=t[d+1];for(r=o=0;r<l.length&&!a;)if(a=l[r++].exec(e))for(n=0;n<u.length;n++)s=a[++o],typeof(i=u[n])===h&&0<i.length?2===i.length?typeof i[1]==p?this[i[0]]=i[1].call(this,s):this[i[0]]=i[1]:3===i.length?typeof i[1]!==p||i[1].exec&&i[1].test?this[i[0]]=s?s.replace(i[1],i[2]):c:this[i[0]]=s?i[1].call(this,s,i[2]):c:4===i.length&&(this[i[0]]=s?i[3].call(this,s.replace(i[1],i[2])):c):this[i]=s||c;d+=2}},A=function(e,t){for(var r in t)if(typeof t[r]===h&&0<t[r].length){for(var o=0;o<t[r].length;o++)if(C(t[r][o],e))return"?"===r?c:r}else if(C(t[r],e))return"?"===r?c:r;return e},k={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},O={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[l,[e,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[l,[e,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[e,l],[/opios[\/ ]+([\w\.]+)/i],[l,[e,I+" Mini"]],[/\bopr\/([\w\.]+)/i],[l,[e,I]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[e,l],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[l,[e,"UC"+b]],[/\bqbcore\/([\w\.]+)/i],[l,[e,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[l,[e,"WeChat"]],[/konqueror\/([\w\.]+)/i],[l,[e,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[l,[e,"IE"]],[/yabrowser\/([\w\.]+)/i],[l,[e,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[e,/(.+)/,"$1 Secure "+b],l],[/\bfocus\/([\w\.]+)/i],[l,[e,w+" Focus"]],[/\bopt\/([\w\.]+)/i],[l,[e,I+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[l,[e,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[l,[e,"Dolphin"]],[/coast\/([\w\.]+)/i],[l,[e,I+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[l,[e,"MIUI "+b]],[/fxios\/([-\w\.]+)/i],[l,[e,w]],[/\bqihu|(qi?ho?o?|360)browser/i],[[e,"360 "+b]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[e,/(.+)/,"$1 "+b],l],[/(comodo_dragon)\/([\w\.]+)/i],[[e,/_/g," "],l],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[e,l],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[e],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[e,"Facebook"],l],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[e,l],[/\bgsa\/([\w\.]+) .*safari\//i],[l,[e,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[l,[e,_+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[e,_+" WebView"],l],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[l,[e,"Android "+b]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[e,l],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[l,[e,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[l,e],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[e,[l,A,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[e,l],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[e,"Netscape"],l],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[l,[e,w+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[e,l]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[u,"amd64"]],[/(ia32(?=;))/i],[[u,P]],[/((?:i[346]|x)86)[;\)]/i],[[u,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[u,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[u,"armhf"]],[/windows (ce|mobile); ppc;/i],[[u,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[u,/ower/,"",P]],[/(sun4\w)[;\)]/i],[[u,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[u,P]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[s,[d,T],[t,f]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[s,[d,T],[t,o]],[/\((ip(?:hone|od)[\w ]*);/i],[s,[d,"Apple"],[t,o]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[s,[d,"Apple"],[t,f]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[s,[d,"Huawei"],[t,f]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[s,[d,"Huawei"],[t,o]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[s,/_/g," "],[d,"Xiaomi"],[t,o]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[s,/_/g," "],[d,"Xiaomi"],[t,f]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[s,[d,"OPPO"],[t,o]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[s,[d,"Vivo"],[t,o]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[s,[d,"Realme"],[t,o]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[s,[d,"Motorola"],[t,o]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[s,[d,"Motorola"],[t,f]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[s,[d,"LG"],[t,f]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[s,[d,"LG"],[t,o]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[s,[d,"Lenovo"],[t,f]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[s,/_/g," "],[d,"Nokia"],[t,o]],[/(pixel c)\b/i],[s,[d,S],[t,f]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[s,[d,S],[t,o]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[s,[d,"Sony"],[t,o]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[s,"Xperia Tablet"],[d,"Sony"],[t,f]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[s,[d,"OnePlus"],[t,o]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[s,[d,v],[t,f]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[s,/(.+)/g,"Fire Phone $1"],[d,v],[t,o]],[/(playbook);[-\w\),; ]+(rim)/i],[s,d,[t,f]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[s,[d,y],[t,o]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[s,[d,"ASUS"],[t,f]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[s,[d,"ASUS"],[t,o]],[/(nexus 9)/i],[s,[d,"HTC"],[t,f]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[d,[s,/_/g," "],[t,o]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[s,[d,"Acer"],[t,f]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[s,[d,"Meizu"],[t,o]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[s,[d,"Sharp"],[t,o]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[d,s,[t,o]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[d,s,[t,f]],[/(surface duo)/i],[s,[d,E],[t,f]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[s,[d,"Fairphone"],[t,o]],[/(u304aa)/i],[s,[d,"AT&T"],[t,o]],[/\bsie-(\w*)/i],[s,[d,"Siemens"],[t,o]],[/\b(rct\w+) b/i],[s,[d,"RCA"],[t,f]],[/\b(venue[\d ]{2,7}) b/i],[s,[d,"Dell"],[t,f]],[/\b(q(?:mv|ta)\w+) b/i],[s,[d,"Verizon"],[t,f]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[s,[d,"Barnes & Noble"],[t,f]],[/\b(tm\d{3}\w+) b/i],[s,[d,"NuVision"],[t,f]],[/\b(k88) b/i],[s,[d,"ZTE"],[t,f]],[/\b(nx\d{3}j) b/i],[s,[d,"ZTE"],[t,o]],[/\b(gen\d{3}) b.+49h/i],[s,[d,"Swiss"],[t,o]],[/\b(zur\d{3}) b/i],[s,[d,"Swiss"],[t,f]],[/\b((zeki)?tb.*\b) b/i],[s,[d,"Zeki"],[t,f]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[d,"Dragon Touch"],s,[t,f]],[/\b(ns-?\w{0,9}) b/i],[s,[d,"Insignia"],[t,f]],[/\b((nxa|next)-?\w{0,9}) b/i],[s,[d,"NextBook"],[t,f]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[d,"Voice"],s,[t,o]],[/\b(lvtel\-)?(v1[12]) b/i],[[d,"LvTel"],s,[t,o]],[/\b(ph-1) /i],[s,[d,"Essential"],[t,o]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[s,[d,"Envizen"],[t,f]],[/\b(trio[-\w\. ]+) b/i],[s,[d,"MachSpeed"],[t,f]],[/\btu_(1491) b/i],[s,[d,"Rotor"],[t,f]],[/(shield[\w ]+) b/i],[s,[d,"Nvidia"],[t,f]],[/(sprint) (\w+)/i],[d,s,[t,o]],[/(kin\.[onetw]{3})/i],[[s,/\./g," "],[d,E],[t,o]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[s,[d,"Zebra"],[t,f]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[s,[d,"Zebra"],[t,o]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[d,s,[t,r]],[/droid.+; (shield) bui/i],[s,[d,"Nvidia"],[t,r]],[/(playstation [345portablevi]+)/i],[s,[d,"Sony"],[t,r]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[s,[d,E],[t,r]],[/smart-tv.+(samsung)/i],[d,[t,m]],[/hbbtv.+maple;(\d+)/i],[[s,/^/,"SmartTV"],[d,T],[t,m]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[d,"LG"],[t,m]],[/(apple) ?tv/i],[d,[s,"Apple TV"],[t,m]],[/crkey/i],[[s,_+"cast"],[d,S],[t,m]],[/droid.+aft(\w)( bui|\))/i],[s,[d,v],[t,m]],[/\(dtv[\);].+(aquos)/i],[s,[d,"Sharp"],[t,m]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[d,M],[s,M],[t,m]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[t,m]],[/((pebble))app/i],[d,s,[t,g]],[/droid.+; (glass) \d/i],[s,[d,S],[t,g]],[/droid.+; (wt63?0{2,3})\)/i],[s,[d,"Zebra"],[t,g]],[/(quest( 2)?)/i],[s,[d,"Facebook"],[t,g]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[d,[t,"embedded"]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[s,[t,o]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[s,[t,f]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[t,f]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[t,o]],[/(android[-\w\. ]{0,9});.+buil/i],[s,[d,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[l,[e,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[l,[e,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[e,l],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[l,e]],os:[[/microsoft (windows) (vista|xp)/i],[e,l],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[e,[l,A,k]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[e,"Windows"],[l,A,k]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[l,/_/g,"."],[e,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[e,"Mac OS"],[l,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[l,e],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[e,l],[/\(bb(10);/i],[l,[e,y]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[l,[e,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[l,[e,w+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[l,[e,"webOS"]],[/crkey\/([\d\.]+)/i],[l,[e,_+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[e,"Chromium OS"],l],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[e,l],[/(sunos) ?([\w\.\d]*)/i],[[e,"Solaris"],l],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[e,l]]},U=function(e,t){if(typeof e===h&&(t=e,e=c),!(this instanceof U))return new U(e,t).getResult();var r=e||(typeof n!==i&&n.navigator&&n.navigator.userAgent?n.navigator.userAgent:""),o=t?function(e,t){var r={};for(var o in e)t[o]&&t[o].length%2==0?r[o]=t[o].concat(e[o]):r[o]=e[o];return r}(O,t):O;return this.getBrowser=function(){var e,t={};return t.name=c,t[l]=c,x.call(t,r,o.browser),t.major=typeof(e=t.version)===a?e.replace(/[^\d\.]/g,"").split(".")[0]:c,t},this.getCPU=function(){var e={};return e[u]=c,x.call(e,r,o.cpu),e},this.getDevice=function(){var e={};return e[d]=c,e[s]=c,e.type=c,x.call(e,r,o.device),e},this.getEngine=function(){var e={};return e.name=c,e[l]=c,x.call(e,r,o.engine),e},this.getOS=function(){var e={};return e.name=c,e[l]=c,x.call(e,r,o.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return r},this.setUA=function(e){return r=typeof e===a&&255<e.length?M(e,255):e,this},this.setUA(r),this};U.VERSION="0.7.31",U.BROWSER=R([e,l,"major"]),U.CPU=R([u]),U.DEVICE=R([s,d,t,r,o,m,f,g,"embedded"]),U.ENGINE=U.OS=R([e,l]),typeof exports!==i?(typeof module!==i&&module.exports&&(exports=module.exports=U),exports.UAParser=U):typeof define===p&&define.amd?define(function(){return U}):typeof n!==i&&(n.UAParser=U);var L=typeof n!==i&&(n.jQuery||n.Zepto);if(L&&!L.ua){var D=new U;L.ua=D.getResult(),L.ua.get=function(){return D.getUA()},L.ua.set=function(e){D.setUA(e);var t=D.getResult();for(var r in t)L.ua[r]=t[r]}}}("object"==typeof window?window:this);var ErrorConstant={check_webrtc_supported:{code:2e3,message:"WebRTC"},not_support_mediaStreamTrack:{code:2001,message:"MediaStreamTrack."},screen_sharing_plugin_not_accessible:{code:2003,message:""},screen_sharing_response_is_null:{code:2004,message:""},not_join_room:{code:2005,message:""},navigatorUserMediaError_notSupportedError:{code:2010,message:"https"},navigatorUserMediaError_overconstrainedError:{code:2011,message:""},navigatorUserMediaError_trackStartError:{code:2012,message:""},navigatorUserMediaError_notAllowedError:{code:2013,message:""},navigatorUserMediaError_typeError:{code:2014,message:""},navigatorUserMediaError_unknown:{code:2015,message:""},navigatorUserMediaError_notFoundError:{code:2016,message:"/"},navigatorDisplayMediaError_notSupportedError:{code:2030,message:"https"},navigatorDisplayMediaError_overconstrainedError:{code:2031,message:""},navigatorDisplayMediaError_notAllowedError:{code:2033,message:""},navigatorDisplayMediaError_unknown:{code:2035,message:""},cameraId_does_not_exist:{code:2017,message:"ID"},closeVideo_before_operation_warnings:{code:2018,message:""},open_device_no_response:{code:2019,message:""},websock_create_error:{code:2020,message:"Websocket"},websock_catch_exception:{code:2021,message:"Websocket"},join_room_timeout:{code:1014,message:""},oemname_notfound:{code:1017,message:"OEM"},avdEngine_init_failed:{code:1018,message:"sdk"},userId_format:{code:1309,message:"userId_"},userId_required:{code:1300,message:"userId"},mulLanding_error:{code:1301,message:"userId"},roomId_required:{code:1302,message:"roomId"},params_require:{code:1303,message:"params"},userAddress_require:{code:1304,message:"userAddress"},ft_no_authorization:{code:1305,message:"."},exporter_parameter_type_error:{code:1401,message:""},exporter_parameter_number_error:{code:1402,message:"x,y,width,height0 - 1 "},exporter_parameter_number1_error:{code:1403,message:"zorder0 - 10 "},exporter_parameter_lack_error:{code:1404,message:""},video_not_exporter_error:{code:1405,message:""},video_has_exporter_error:{code:1406,message:""},exporter_mix_start_error:{code:1407,message:""},video_and_userId_error:{code:1408,message:"IdId"},exporter_has_stop_error:{code:1409,message:""},mqtt_topic_reservedword_error:{code:1500,message:"topic"}},FTConstant={datachannel:{name:"",value:"ft_datachannel"},chat:{name:"",value:"ft_chat"},audio:{name:"",value:"ft_audio"},video:{name:"",value:"ft_video"},video_hd:{name:"",value:"ft_video_hd"},screen:{name:"",value:"ft_screen"},annotation:{name:"",value:"ft_annotation"},p2p:{name:"P2P",value:"ft_p2p"},avei:{name:"",value:"ft_avei"},h265:{name:"H265",value:"ft_h265"},client_record_audio:{name:"",value:"ft_client_record_audio"},client_record_video:{name:"",value:"ft_client_record_video"},clinet_livebroadcast:{name:"",value:"ft_clinet_livebroadcast"},record_audio:{name:"",value:"ft_record_audio"},record_video:{name:"",value:"ft_record_video"},outgoing:{name:"rtsph323sip",value:"ft_outgoing"},livebroadcast:{name:"",value:"ft_livebroadcast"},platform_android:{name:"Android",value:"ft_platform_android"},platform_ios:{name:"ios",value:"ft_platform_ios"},platform_win:{name:"windows",value:"ft_platform_win"},platform_mac:{name:"mac ox",value:"ft_platform_mac"},platform_linux:{name:"linux",value:"ft_platform_linux"},platform_web:{name:"web js",value:"ft_platform_web"},server_platform_linux:{name:"linux",value:"ft_server_platform_linux"},server_platform_win:{name:"windows",value:"ft_server_platform_win"},server_platform_linux_cluster:{name:"linux",value:"ft_server_platform_linux_cluster"}},USER_AGENT_AVD_DEFAULT="web",USER_AGENT_AVD_VIDEO_TRANSCODING="avd_video_transcoding",USER_AGENT_AVD_IOS="web_ios",USER_AGENT_AVD_MEDIA_MIXER="avd_media_mixer",USER_AGENT_AVD_MEDIA_MIXER_ADMIN="avd_media_mixer_admin",USER_AGENT_AVD_THROWING_SCREEN_ANONYM="avd_throwing_screen_anonym",ModulesEnum={avdEngine:"AVDEngine",browserDetect:"BrowserDetect",video:"Video",audio:"Audio",error:"Error",annotation:"Annotation",client:"Client"},Appender={alert:1,inpage:2,popup:3,browserConsole:4},LogLevel={all:1,trace:2,debug:3,info:4,warn:5,error:6,fatal:7,off:8},SignalType={websocket:"websocket",dataChannel:"dataChannel"},RoomTypeEnum={join_host_first:"join.host.first",net_acc:"net.acc",host_control:"host.control",free_speech:"free.speech"},roomTypePrivilige={join_host_first:2,net_acc:4,host_control:8},EngineCallback={room_join_success:"room.join.success",room_join_error:"room.join.error",room_join_websocket_reconnection_success:"room.join.websocket.reconnection.success",pub_roomresourcemsg_rep_success:"pub.roomresourcemsg.rep.success",pub_roomresourcemsg_rep_error:"pub.roomresourcemsg.rep.error",sub_roomresourcemsg_rep_success:"sub.roomresourcemsg.rep.success",sub_roomresourcemsg_rep_error:"sub.roomresourcemsg.rep.error",unsub_roomresourcemsg_rep_success:"unsub.roomresourcemsg.rep.success",unsub_roomresourcemsg_rep_error:"unsub.roomresourcemsg.rep.error"},DataCryptoType={AES128:1,AES256:2,SM4:3},VideoCodingType={VP8:0,VP9:1,H264:2},AudioCodingType={ISAC_16k:0,ISAC_32k:1,opus:2,G722:3,PCMA:4,PCMU:5},Resolution={"1920*1280":{width:1920,height:1280,order:16},"1920*1080":{width:1920,height:1080,order:15},"1280*1024":{width:1280,height:1024,order:14},"1280*720":{width:1280,height:720,order:13},"960*720":{width:960,height:720,order:12},"640*1024":{width:640,height:1024,order:11},"640*960":{width:640,height:960,order:10},"640*480":{width:640,height:480,order:9},"640*360":{width:640,height:360,order:8},"508*360":{width:508,height:360,order:7},"480*854":{width:480,height:854,order:6},"480*800":{width:480,height:800,order:5},"320*480":{width:320,height:480,order:4},"320*240":{width:320,height:240,order:3},"320*180":{width:320,height:180,order:2},"160*120":{width:160,height:120,order:1}},ResolutionSetType={exact:0,ideal:1},ConnectionStatus={init:0,connecting:1,connected:2,connectFailed:3,reJoinRoomTimeOut:4,reJoinConnected:5,reconnected:6},MCUPeerConnectionStatus={failed:0,completed:1},RoomStatus={scheduled:0,opening:1,locked:2,closed:3};StreamStatus={none:0,init:1,published:2,muted:3,forbided:4,subed:5,opened:6},CameraType={unknown:0,front:1,back:2},VideoQualityType={high:4,normal:3,low:2};var RoomCallback={connection_status:"connection.status",connection_indicator:"connection.indicator",room_status_notify:"room.status.notify",app_data_notify:"app.data.notify",user_data_notify:"user.data.notify",user_name_notify:"user.name.notify",public_data:"public.data",private_data:"private.data",public_message:"public.message ",private_message:"private.message",user_join_notify:"user.join.notify",user_leave_notify:"user.leave.notify",leave_indication:"leave.indication",close_room_result:"close.room.result",close_room_notify:"close.room.notify",screen_sharing_ended:"screen.sharing.ended",mcu_peerconnection_completed:"mcu.peerconnection.completed",outgoing_invite_status_notify:"outgoing.invite.status.notify",room_control_change_notify:"room.control.change.notify",mediaplay_started_notify:"mediaplay.started.notify",mediaplay_stoped_notify:"mediaplay.stoped.notify",mediaplay_progress_notify:"mediaplay.progress.notify",stream_keep_alive_timeout_notify:"stream.keep.alive.timeout.notify"},UserCallback={microphone_status_notify:"microphone.status.notify",camera_status_notify:"camera.status.notify",screen_status_notify:"screen.status.notify",camera_data_notify:"camera.data.notify",screen_data_notify:"screen.data.notify",publish_camera_notify:"publish.camera.notify",unpublish_camera_notify:"unpublish.camera.notify",subscrible_camera_result:"subscrible.camera.result",unsubscrible_camera_result:"unsubscrible.camera.result",publish_screen_notify:"publish.screen.notify",unpublish_screen_notify:"unpublish.screen.notify",subscrible_screen_result:"subscrible.screen.result",unsubscrible_screen_result:"unsubscrible.screen.result",publish_microphone_notify:"publish.microphone.notify",unpublish_microphone_notify:"unpublish.microphone.notify",subscrible_microphone_result:"subscrible.microphone.result",unsubscrible_microphone_result:"unsubscrible.microphone.result",board_add_result:"board.add.result",board_update_result:"board.update.result",board_remove_result:"board.remove.result",board_share_result:"board.share.result",board_close_result:"board.close.result",room_set_stream_name_rep_success:"room.set.stream.name.rep.success",room_set_stream_name_rep_error:"room.set.stream.name.rep.error"},ExporderCallBack={stop_stream_rep_success:"stop.stream.rep.success",stop_stream_rep_error:"stop.stream.rep.error",pause_stream_rep_error:"pause.stream.rep.error",pause_stream_rep_success:"pause.stream.rep.success",mix_media_rep_error:"mix.media.rep.error",mix_media_rep_success:"mix.media.rep.success",select_stream_rep_success:"select.stream.rep.success",select_stream_rep_error:"select.stream.rep.error",create_server_recorder_rep_success:"create.server.recorder.rep.success",create_server_recorder_rep_error:"create.server.recorder.rep.error",bind_audio2video_rep_success:"bind.audio2video.rep.success",bind_audio2video_rep_error:"bind.audio2video.rep.error",set_focus_video_rep_success:"set.focus.video.rep.success",set_focus_video_rep_error:"set.focus.video.rep.error",get_exporter_info_rep_success:"get.exporter.info.rep.success",get_exporter_info_rep_error:"get.exporter.info.rep.error"};OperType={add:1,remove:2,update:3,share:4,close:5};var RecordEnum={VideoType:{novideo:0,mainflow:1,auxiliaryflow1:2,auxiliaryflow2:3},AudioType:{noaudio:0,singleuser:1,allusers:2},FileType:{mp4:0,webM:1}},LiveEnum={VideoType:{novideo:0,mainflow:1,auxiliaryflow1:2,auxiliaryflow2:3},AudioType:{noaudio:0,singleuser:1,allusers:2}},shapeTypeEnum={mouse:1,line:2,rect:3,ellipse:4,polyline:5,hlight_point:7,hlight_texttag:8,eraser:9,rhomb:11,arrow:12,success:13,failure:14,clear:17},boardStatusEnum={close:0,open:1},annoSelectTypeEnum={mouse:1,draw:2,eraser:3},canvasTypeEnum={mouse:1,line:2,rect:3,ellipse:4,polyline:5,hlight_point:7,hlight_texttag:8,eraser:9,rhomb:11,arrow:12,success:13,failure:14,clear:17},fillTypeEnum={none:1,full:2},arrowTypeEnum={none:1,begin:2,end:3,double:4},connectionEventTypeEnum={sendVideo:1,recvVideo:2,sendAudio:3,recvAudio:4,conndidate:5},exporterTypeEnum={record:0,record_real_time:1,liver:2,avc_media_mixer:7},viewLayoutModeEnum={fixation:0,auto:1,auto_orato:2},exporterStatusEnum={stop:0,live:1,pause:2},recorderAudioEnum={AVD_userId_allUser:"userId2allUser",AVD_userId_allUserWithoutMe:"userId2withoutMe",AVD_userId_noneUser:"userId2None"},appDataKeyEnum={lecturer:"meeting_lecturer",voiceActivated:"voice_activated"},arrayUtil={intersection:function(e,t){for(var r=new Object,o=0,n=e.length;o<n;o++)r[e[o]]=e[o];for(o=0,n=t.length;o<n;o++)r[t[o]]=t[o];var i=new Array;o=0;for(var a in r)i[o++]=r[a];return i},chaji:function(e,t){for(var r=new Object,o=0,n=e.length;o<n;o++)r[e[o]]=1;for(o=0,n=t.length;o<n;o++)r[t[o]]=r[t[o]]?2:1;var i=new Array;o=0;for(var a in r)1==r[a]&&(i[o++]=a);return i},chajiObject:function(e,t){for(var r=new Object,o=0,n=e.length;o<n;o++)r[e[o].nodeId]=1;for(o=0,n=t.length;o<n;o++)r[t[o].nodeId]=r[t[o].nodeId]?2:1;var i=new Array;o=0;for(var a in r)1==r[a]&&(i[o++]=a);return i},inANotInB:function(e,t){for(var r=new Object,o=0,n=e.length;o<n;o++)r[e[o]]=1;for(o=0,n=t.length;o<n;o++)r.hasOwnProperty(t[o])&&(r[t[o]]=void 0);var i=new Array;o=0;for(var a in r)r[a]&&(i[o++]=a);return i},baseSplice:function(e,t){for(var r,o=0;o<e.length;o++){if(e[o]==t){r=o;break}}-1<r&&e.splice(r,1)},objectSplice:function(e,t){for(var r,o=0;o<e.length;o++){if(e[o].id==t){r=o;break}}-1<r&&e.splice(r,1)},userIdSplice:function(e,t){for(var r,o=0;o<e.length;o++){if(e[o].userId==t){r=o;break}}-1<r&&e.splice(r,1)},userIdAndNodeIdSplice:function(e,t,r){for(var o,n=0;n<e.length;n++){var i=e[n];if(i.id==t&&i.nodeId==r){o=n;break}}-1<o&&e.splice(o,1)}};function getRandomNum(e,t){var r=t-e,o=Math.random();return e+Math.round(o*r)}var typeConversionUtil={String2ArrayBuffer:function(e){e=btoa(unescape(encodeURIComponent(e)));for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),o=0,n=e.length;o<n;o++)r[o]=e.charCodeAt(o);return t},ArrayBuffer2String:function(e){var t=String.fromCharCode.apply(null,new Uint8Array(e));return decodeURIComponent(escape(atob(t)))},Uint8ArrayToString:function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},stringToUint8Array:function(e){for(var t=[],r=0,o=e.length;r<o;++r)t.push(e.charCodeAt(r));return new Uint8Array(t)}};function resizeVideo(e,t,r){doResizeVideo(e,t,r,!1)}function resizeRealVideo(e,t,r){doResizeVideo(e,t,r,!0)}function doResizeVideo(o,n,i,a){n||(n=window.innerWidth),i||(i=window.innerHeight),o.addEventListener("loadedmetadata",function(e){var t=this.videoWidth,r=this.videoHeight;positionLarge(o,t,r,n,i,a)})}function positionLarge(e,t,r,o,n,i){var a,s=(a=i?getCameraRealVideoSize(t,r,o,n):getCameraVideoSize(t,r,o,n))[0],d=a[1],l=getCameraVideoPosition(s,d,o,n),u=l[0],c=l[1];i?positionRealVideo(e,s,d,u,c):positionVideo(e,s,d,u,c)}function getCameraVideoSize(e,t,r,o){var n=e/t;return(r=Math.max(e,r))/n<(o=Math.max(t,o))&&(r=(o=o)*n),o*n<r&&(o=(r=r)/n),[r,o]}function getCameraRealVideoSize(e,t,r,o){var n=e/t,i=Math.max(e,r),a=Math.max(t,o);e<=i&&t<=a?r/o<n?o=(r=r)/n:r=(o=o)*n:((o=a)<(r=i)/n&&(r=(o=o)*n),r<o*n&&(o=(r=r)/n));return[r,o]}function getCameraVideoPosition(e,t,r,o){return[(r-e)/2,(o-t)/2]}function positionVideo(e,t,r,o,n){e.setAttribute("width",t),e.setAttribute("height",r)}function positionRealVideo(e,t,r,o,n){e.setAttribute("width",t),e.setAttribute("height",r);var i=e.parentNode;i.style.top=n+"px",i.style.bottom=n+"px",i.style.left=o+"px",i.style.right=o+"px"}function fullScreenInit(){document.cancelFullScreen=document.webkitCancelFullScreen||document.mozCancelFullScreen||document.cancelFullScreen,document.body.requestFullScreen=document.body.webkitRequestFullScreen||document.body.mozRequestFullScreen||document.body.requestFullScreen,document.onfullscreenchange=document.onwebkitfullscreenchange=document.onmozfullscreenchange=displayFullScreenStatus,displayFullScreenStatus()}function doFullScreen(e,t){e.requestFullScreen=e.webkitRequestFullScreen||e.mozRequestFullScreen||e.requestFullScreen,isFullScreen()&&t.target!==e||fullScreenElement()===e?document.cancelFullScreen():(t.target,e.requestFullScreen())}function displayFullScreenStatus(){isFullScreen()}function isFullScreen(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.isFullScreen)}function fullScreenElement(){return document.webkitFullScreenElement||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.fullScreenElement}function doFullScreenInIE(e){window.innerWidth?winWidth=window.innerWidth:document.body&&document.body.clientWidth&&(winWidth=document.body.clientWidth),window.innerHeight?winHeight=window.innerHeight:document.body&&document.body.clientHeight&&(winHeight=document.body.clientHeight),document.documentElement&&document.documentElement.clientHeight&&document.documentElement.clientWidth&&(winHeight=document.documentElement.clientHeight,winWidth=document.documentElement.clientWidth);var t=window.createPopup(),r=t.document.body;r.style.backgroundColor="lime",r.style.border="solid black 1px",r.innerHTML="";var o=t.document.createElement("object");if(Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(window,"ActiveXObject")||"ActiveXObject"in window){var n=t.document.createElement("param");n.setAttribute("name","windowless"),n.setAttribute("value",!0),o.appendChild(n),o.setAttribute("classid","CLSID:7FD49E23-C8D7-4C4F-93A1-F7EACFA1EC53")}else o.setAttribute("type","application/avd-plugin");o.setAttribute("id","fullScreen"),o.setAttribute("width",winWidth),o.setAttribute("height",winHeight),o.src=e,r.appendChild(o),t.show(0,0,winWidth,winHeight,document.body)}function getLocalClientIP(){var n=when.defer(),e=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;return e?function(){var t=new e({iceServers:[]});t.createDataChannel("",{reliable:!1}),t.onicecandidate=function(e){e.candidate&&r("a="+e.candidate.candidate)},t.createOffer(function(e){r(e.sdp),t.setLocalDescription(e)},function(e){console.warn("offer failed",e)});var o=Object.create(null);function i(e){if(!(e in o)){o[e]=!0;for(var t=Object.keys(o).filter(function(e){return o[e]}),r=0;r<t.length;r++)16<t[r].length&&(t.splice(r,1),r--);n.resolve(t[0])}}function r(e){e.split("\r\n").forEach(function(e,t,r){if(~e.indexOf("a=candidate")){var o=(n=e.split(" "))[4];"host"===n[7]&&i(o)}else if(~e.indexOf("c=")){var n;i(o=(n=e.split(" "))[2])}})}o["0.0.0.0"]=!1}():n.reject(""),n.promise}function getEffectiveType(){return navigator.connection.effectiveType}if(function(){var n={},s={},i=function(){},e={define:function(e,t,r){if(!n[e]){var o={name:e,dependencies:t,factory:r};n[e]=o}return n[e]},use:function(e){var t=n[e];if(!t)return null;if(!t.entity){for(var r=[],o=0;o<t.dependencies.length;o++)n[t.dependencies[o]].entity?r.push(n[t.dependencies[o]].entity):r.push(this.use(t.dependencies[o]));t.entity=t.factory.apply(i,r)}return t.entity},require:function(r,o){for(var e=0;e<r.length;e++){var t=r[e];if(!s[t]){var n=document.getElementsByTagName("head")[0],i=document.createElement("script");i.type="text/javascript",i.async="true",i.src=t+".js",i.onload=function(){s[t]=!0,n.removeChild(i),a()},n.appendChild(i)}}function a(){for(var e=!0,t=0;t<r.length;t++)if(!s[r[t]]){e=!1;break}e&&o()}}};window.ModuleBase=e}(),ModuleBase.define("Error",[],function(){var e=function(e,t){"object"==typeof e&&void 0===t?(this.code=e.code,this.message=e.message):(this.code=e,this.message=t)};return e.prototype.errorShow=function(){return"error code:"+this.code+"; error message:"+this.message},e}),dcodeIO)var dcodeIO=dcodeIO.ProtoBuf;else var dcodeIO=module.exports;var cmdBuilder=dcodeIO.newBuilder({}).import({package:"room_pdu",messages:[{name:"Packet",fields:[{rule:"required",type:"RoomPduType",name:"type",id:1},{rule:"required",type:"int32",name:"priority",id:2,options:{default:0}},{rule:"required",type:"int32",name:"src",id:3},{rule:"required",type:"int32",name:"dst",id:4,options:{default:0}},{rule:"optional",type:"bytes",name:"body",id:5}]},{name:"MultiPacket",fields:[{rule:"repeated",type:"Packet",name:"packets",id:1}]},{name:"Webcam",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"optional",type:"int32",name:"level",id:5},{rule:"optional",type:"string",name:"description",id:6},{rule:"optional",type:"CameraType",name:"ctype",id:7},{rule:"optional",type:"string",name:"stream_nick_name",id:8},{rule:"optional",type:"string",name:"stream_name",id:9}]},{name:"Speaker",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"optional",type:"int32",name:"level",id:5},{rule:"optional",type:"string",name:"description",id:6}]},{name:"Desktop",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"optional",type:"int32",name:"level",id:5},{rule:"optional",type:"string",name:"description",id:6},{rule:"optional",type:"string",name:"stream_nick_name",id:7},{rule:"optional",type:"string",name:"stream_name",id:8}]},{name:"DocFile",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"required",type:"ResourceStatus",name:"status",id:3},{rule:"required",type:"SessionType",name:"type",id:4},{rule:"required",type:"string",name:"uri",id:5}]},{name:"AddWebcamMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"Webcam",name:"webcam",id:2}]},{name:"RemoveWebcamMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2}]},{name:"AddSpeakerMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"Speaker",name:"speaker",id:2}]},{name:"RemoveSpeakerMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2}]},{name:"AddDocFileMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"DocFile",name:"docfile",id:2}]},{name:"RemoveDocFileMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2}]},{name:"RoomResourceInfo",fields:[{rule:"required",type:"string",name:"resource_id",id:1},{rule:"required",type:"int32",name:"owner_id",id:2},{rule:"optional",type:"MediaStream",name:"stream",id:3},{rule:"optional",type:"MediaStream",name:"stream_assist1",id:4},{rule:"optional",type:"MediaStream",name:"stream_assist2",id:5},{rule:"optional",type:"int32",name:"publishQualities",id:6},{rule:"optional",type:"string",name:"rtmp_play_url",id:7},{rule:"optional",type:"int32",name:"keep_alive_time",id:8}]},{name:"RoomInfo",fields:[{rule:"repeated",type:"RoomResourceInfo",name:"resource_infos",id:1},{rule:"required",type:"RoomStatus",name:"room_status",id:2,options:{default:"init_room"}}]},{name:"UserPolicy",fields:[{rule:"optional",type:"bool",name:"join_chat",id:1},{rule:"optional",type:"bool",name:"join_audio",id:2},{rule:"optional",type:"bool",name:"join_video",id:3}]},{name:"JoinInfo",fields:[{rule:"repeated",type:"Webcam",name:"webcams",id:1},{rule:"repeated",type:"Speaker",name:"speakers",id:2},{rule:"optional",type:"string",name:"user_agent",id:3},{rule:"required",type:"UserPolicy",name:"user_policy",id:4},{rule:"optional",type:"string",name:"user_resources",id:5}]},{name:"UserInfo",fields:[{rule:"optional",type:"string",name:"user_id",id:1},{rule:"required",type:"string",name:"user_name",id:2},{rule:"required",type:"UserRole",name:"role",id:3},{rule:"required",type:"int32",name:"privileges",id:4},{rule:"required",type:"UserStatus",name:"status",id:5},{rule:"repeated",type:"Webcam",name:"webcams",id:6},{rule:"repeated",type:"Speaker",name:"speakers",id:7},{rule:"optional",type:"string",name:"user_agent",id:8},{rule:"required",type:"int32",name:"node_id",id:9},{rule:"optional",type:"UserPolicy",name:"user_policy",id:10},{rule:"repeated",type:"Desktop",name:"desktops",id:11},{rule:"optional",type:"string",name:"user_data",id:12}]},{name:"MediaStream",fields:[{rule:"required",type:"string",name:"stream_name",id:1},{rule:"required",type:"MediaType",name:"type",id:2},{rule:"optional",type:"string",name:"sdp",id:3},{rule:"optional",type:"int32",name:"width",id:4},{rule:"optional",type:"int32",name:"height",id:5},{rule:"optional",type:"int32",name:"frame_rate",id:6},{rule:"optional",type:"int32",name:"payload",id:7},{rule:"optional",type:"uint32",name:"sdp_version",id:8}]},{name:"MediaStreamInfo",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"stream_id",id:2},{rule:"required",type:"MediaStream",name:"stream",id:3}]},{name:"ResourceIndiction",fields:[{rule:"required",type:"string",name:"resource_id",id:1},{rule:"required",type:"ResourceOpt",name:"opt",id:2},{rule:"required",type:"int32",name:"owner_id",id:3},{rule:"required",type:"int32",name:"operator_id",id:4},{rule:"optional",type:"string",name:"host_tocken",id:5}]},{name:"AddDesktopMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"Desktop",name:"desktop",id:2}]},{name:"UpdateSpeakerMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2},{rule:"required",type:"Speaker",name:"speaker",id:3}]},{name:"UpdateWebcamMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2},{rule:"required",type:"Webcam",name:"webcam",id:3}]},{name:"UpdateDesktopMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"resource_id",id:2},{rule:"required",type:"Desktop",name:"desktop",id:3}]},{name:"JoinReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"version",id:2},{rule:"required",type:"string",name:"room_tocken",id:3},{rule:"optional",type:"string",name:"user_id",id:4},{rule:"required",type:"string",name:"user_name",id:5},{rule:"optional",type:"JoinInfo",name:"join_info",id:6},{rule:"optional",type:"string",name:"password",id:7}]},{name:"JoinRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"RoomInfo",name:"room_info",id:4},{rule:"optional",type:"int32",name:"node_id",id:5},{rule:"optional",type:"UserInfo",name:"user_info",id:6}]},{name:"LeaveMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"int32",name:"reason",id:2}]},{name:"UpdateRoomStatusMsg",fields:[{rule:"required",type:"RoomStatus",name:"status",id:1}]},{name:"PubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1},{rule:"optional",type:"int32",name:"id",id:2}]},{name:"UnpubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1}]},{name:"SubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1},{rule:"required",type:"int32",name:"sub_node_id",id:2},{rule:"optional",type:"int32",name:"id",id:3},{rule:"optional",type:"int32",name:"video_level",id:4}]},{name:"UnsubRoomResourceMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1},{rule:"required",type:"int32",name:"sub_node_id",id:2},{rule:"optional",type:"int32",name:"id",id:3}]},{name:"PubResourceReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"RoomResourceInfo",name:"info",id:2}]},{name:"PubResourceRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"RepResultType",name:"type",id:2},{rule:"optional",type:"int32",name:"reason",id:3}]},{name:"RoomKV",fields:[{rule:"required",type:"string",name:"key",id:1},{rule:"required",type:"string",name:"value",id:2}]},{name:"RoomDataInfo",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"repeated",type:"RoomKV",name:"kvs",id:2}]},{name:"PubRoomResourceMsgRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"SubRoomResourceMsgRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"RoomResourceInfos",fields:[{rule:"repeated",type:"RoomResourceInfo",name:"resource_infos",id:1},{rule:"optional",type:"string",name:"room_id",id:2}]},{name:"UpdateStreamSsrcMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"stream_id",id:2},{rule:"required",type:"uint32",name:"old_ssrc",id:3},{rule:"required",type:"uint32",name:"new_ssrc",id:4}]},{name:"ClientTranceInfo",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"level",id:2},{rule:"required",type:"string",name:"msg",id:3}]},{name:"CloseRoomReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"node_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3}]},{name:"CloseRoomRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"StartVideoDataMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1}]},{name:"StopVideoDataMsg",fields:[{rule:"required",type:"RoomResourceInfo",name:"info",id:1}]},{name:"ModifyResourceReq",fields:[{rule:"optional",type:"string",name:"id",id:1},{rule:"required",type:"RoomResourceInfo",name:"info",id:2},{rule:"optional",type:"int32",name:"video_level",id:3}]},{name:"ModifyResourceRep",fields:[{rule:"optional",type:"string",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3}]},{name:"UnsubRoomResourceMsgRep",fields:[{rule:"optional",type:"string",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2}]},{name:"GetMiniProgramStreamUrlReq",fields:[{rule:"optional",type:"int32",name:"id",id:1}]},{name:"GetMiniProgramStreamUrlRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"required",type:"string",name:"url",id:3}]},{name:"BindAudioToVideoReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"audio_resource_id",id:2},{rule:"required",type:"string",name:"video_resouce_id",id:3}]},{name:"BindAudioToVideoRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2}]},{name:"TextMsg",fields:[{rule:"required",type:"string",name:"content",id:1},{rule:"optional",type:"int32",name:"timestamp",id:2}]},{name:"DATA",fields:[{rule:"required",type:"bytes",name:"content",id:1}]},{name:"UserInfoMsg",fields:[{rule:"repeated",type:"UserInfo",name:"user",id:1}]},{name:"UserMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"UserMsgOpt",name:"opt",id:2},{rule:"optional",type:"int32",name:"reason",id:3},{rule:"optional",type:"int32",name:"opt_node_id",id:4}]},{name:"UpdateUserRolePriviledgeMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"int32",name:"old",id:2},{rule:"required",type:"int32",name:"new",id:3}]},{name:"UpdateUserStatusMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"UserStatus",name:"old",id:2},{rule:"required",type:"UserStatus",name:"new",id:3}]},{name:"UpdateUserRoleMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"UserRole",name:"old",id:2},{rule:"required",type:"UserRole",name:"new",id:3}]},{name:"UserIndiction",fields:[{rule:"required",type:"int32",name:"operator_id",id:1},{rule:"required",type:"RoomPduType",name:"type",id:2},{rule:"optional",type:"bytes",name:"body",id:3}]},{name:"UpdateUserDataMsg",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"required",type:"string",name:"user_data",id:2}]},{name:"RejoinRoomMsg",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"optional",type:"int32",name:"reason",id:2}]},{name:"CloseRoomMsg",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"optional",type:"int32",name:"reason",id:2}]},{name:"UpdateUserName",fields:[{rule:"required",type:"int32",name:"node_id",id:1},{rule:"optional",type:"string",name:"new_name",id:2}]},{name:"ChangeHost",fields:[{rule:"required",type:"int32",name:"host_node_id",id:1},{rule:"optional",type:"int32",name:"newhost_node_id",id:2}]},{name:"OfferReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"sdp",id:2},{rule:"required",type:"int32",name:"node_id",id:3}]},{name:"OfferRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"sdp",id:4},{rule:"optional",type:"int32",name:"node_id",id:5}]},{name:"CandidateMsg",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"int32",name:"sdp_mline_index",id:2},{rule:"required",type:"string",name:"sdp_mid",id:3},{rule:"required",type:"int32",name:"node_id",id:4}]},{name:"SubRoomResourceReq",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"RoomResourceInfo",name:"info",id:2},{rule:"required",type:"int32",name:"sub_node_id",id:3}]},{name:"SubRoomResourceRep",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"RoomResourceInfo",name:"info",id:4}]},{name:"OpenReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"access_tocken",id:2},{rule:"optional",type:"string",name:"signal_tocken",id:3},{rule:"optional",type:"string",name:"version",id:4},{rule:"optional",type:"string",name:"thread_id",id:5},{rule:"optional",type:"int32",name:"is_cluster",id:6},{rule:"optional",type:"string",name:"audio_codec_payload_map",id:7}]},{name:"OpenRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"signal_tocken",id:4},{rule:"optional",type:"int32",name:"ping_timeout",id:5},{rule:"optional",type:"int32",name:"ping_interval",id:6},{rule:"optional",type:"string",name:"version",id:7}]},{name:"InviteRoomReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"sdp",id:3},{rule:"optional",type:"int32",name:"node_id",id:4}]},{name:"InviteRoomReq1",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"version",id:3},{rule:"required",type:"string",name:"access_tocken",id:4},{rule:"optional",type:"string",name:"user_id",id:5},{rule:"required",type:"string",name:"user_name",id:6},{rule:"optional",type:"JoinInfo",name:"join_info",id:7},{rule:"optional",type:"string",name:"password",id:8},{rule:"optional",type:"int32",name:"node_id",id:9},{rule:"optional",type:"bool",name:"is_dtls",id:10},{rule:"optional",type:"string",name:"user_data",id:11},{rule:"optional",type:"string",name:"ice_ufrag",id:12},{rule:"optional",type:"string",name:"ice_pwd",id:13},{rule:"optional",type:"bytes",name:"routes_json",id:20},{rule:"optional",type:"int32",name:"media_connect_type",id:21},{rule:"optional",type:"DataCryptoType",name:"crypto_type",id:22}]},{name:"RoomInfo1",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"string",name:"topic",id:2},{rule:"optional",type:"string",name:"owner_id",id:3},{rule:"optional",type:"string",name:"host_id",id:4},{rule:"optional",type:"bool",name:"has_pwd",id:5},{rule:"optional",type:"string",name:"description",id:6},{rule:"optional",type:"int32",name:"timezone",id:7},{rule:"optional",type:"int32",name:"start_time",id:8},{rule:"optional",type:"int32",name:"end_time",id:9},{rule:"optional",type:"RoomMode",name:"room_mode",id:10},{rule:"optional",type:"int32",name:"attendee_max",id:11},{rule:"optional",type:"int32",name:"bandwidth",id:12},{rule:"optional",type:"int32",name:"max_audio",id:13},{rule:"optional",type:"int32",name:"max_video",id:14},{rule:"optional",type:"string",name:"room_extend_id",id:15},{rule:"optional",type:"RoomStatus",name:"room_status",id:16,options:{default:"init_room"}},{rule:"optional",type:"int32",name:"attributes",id:17},{rule:"optional",type:"string",name:"is_host_room",id:18},{rule:"optional",type:"int32",name:"room_index_id",id:19}]},{name:"InviteRoomRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"room_tocken",id:4},{rule:"optional",type:"string",name:"sdp",id:5},{rule:"optional",type:"RoomInfo1",name:"room_info",id:6}]},{name:"InviteRoomRep1",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"description",id:3},{rule:"optional",type:"string",name:"room_tocken",id:4},{rule:"optional",type:"RoomInfo1",name:"room_info",id:5},{rule:"optional",type:"string",name:"finger_print",id:6},{rule:"optional",type:"int32",name:"node_id",id:7},{rule:"optional",type:"int32",name:"ping_timeout",id:8},{rule:"optional",type:"int32",name:"ping_interval",id:9},{rule:"optional",type:"string",name:"ice_ufrag",id:10},{rule:"optional",type:"string",name:"ice_pwd",id:11},{rule:"optional",type:"UserRole",name:"role",id:12},{rule:"optional",type:"string",name:"setup",id:13,options:{default:"active"}},{rule:"optional",type:"string",name:"candidate_string",id:14}]},{name:"CandidateMsg1",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"int32",name:"sdp_mline_index",id:2},{rule:"required",type:"string",name:"sdp_mid",id:3},{rule:"required",type:"string",name:"room_tocken",id:4}]},{name:"CloseMsg",fields:[{rule:"required",type:"string",name:"room_tocken",id:1}]},{name:"IceRestartMsg",fields:[{rule:"required",type:"string",name:"candidate",id:1},{rule:"required",type:"int32",name:"sdp_mline_index",id:2},{rule:"required",type:"string",name:"sdp_mid",id:3},{rule:"required",type:"string",name:"room_tocken",id:4}]},{name:"OutgoingInviteStatusNotify",fields:[{rule:"required",type:"OutgoingInviteType",name:"type",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"sip_addr",id:3},{rule:"required",type:"int32",name:"status",id:4},{rule:"required",type:"string",name:"msg",id:5}]},{name:"RoomControl",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"string",name:"attributes",id:2}]},{name:"RoomAttributeChangeNotify",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"string",name:"attributes",id:2}]},{name:"RoomAvcControl",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"int32",name:"handler",id:2}]},{name:"RoomAvcControlRep",fields:[{rule:"required",type:"int32",name:"ret",id:1},{rule:"required",type:"string",name:"msg",id:2}]},{name:"RoomSetStreamNameReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"string",name:"video_resource_id",id:4},{rule:"optional",type:"string",name:"stream_name",id:5},{rule:"optional",type:"string",name:"stream_nick_name",id:6}]},{name:"RoomSetStreamNameRsp",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"string",name:"video_resource_id",id:4},{rule:"optional",type:"int32",name:"ret",id:6},{rule:"optional",type:"string",name:"msg",id:7}]},{name:"RoomStreamNameChangedNotify",fields:[{rule:"required",type:"string",name:"room_id",id:1},{rule:"required",type:"string",name:"user_id",id:2},{rule:"required",type:"string",name:"video_resource_id",id:3},{rule:"optional",type:"string",name:"stream_name",id:4},{rule:"optional",type:"string",name:"stream_nick_name",id:5}]},{name:"UserActionEventsReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"string",name:"events",id:4}]},{name:"UserActionEventsRsp",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"optional",type:"int32",name:"ret",id:4},{rule:"optional",type:"string",name:"msg",id:5},{rule:"optional",type:"string",name:"rsp_data",id:6}]},{name:"UserSetKeepAliveTimeReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"int32",name:"keepAliveTime",id:4}]},{name:"UserSetKeepAliveTimeRsp",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"int32",name:"ret",id:4},{rule:"required",type:"string",name:"msg",id:5}]},{name:"UserStreamActive",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"user_id",id:3},{rule:"required",type:"string",name:"resource_id",id:4},{rule:"optional",type:"StreamActiveStatus",name:"active_base",id:5,options:{default:"StreamActiveStatusUnchanged"}},{rule:"optional",type:"StreamActiveStatus",name:"active_ass1",id:6,options:{default:"StreamActiveStatusUnchanged"}},{rule:"optional",type:"StreamActiveStatus",name:"active_ass2",id:7,options:{default:"StreamActiveStatusUnchanged"}}]},{name:"MediaPlayEventNotify",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"string",name:"play_id",id:3},{rule:"required",type:"MediaPlayEvents",name:"event",id:4},{rule:"required",type:"string",name:"user_id",id:5},{rule:"optional",type:"string",name:"file_path",id:6}]},{name:"StreamKeepAliveTimeoutNotify",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"required",type:"int32",name:"onwer_id",id:3},{rule:"required",type:"uint32",name:"ssrc",id:4},{rule:"required",type:"string",name:"resource_id",id:5},{rule:"required",type:"MediaType",name:"media_type",id:6}]},{name:"Point",fields:[{rule:"required",type:"int32",name:"x",id:1},{rule:"required",type:"int32",name:"y",id:2}]},{name:"color",fields:[{rule:"required",type:"int32",name:"a",id:1},{rule:"required",type:"int32",name:"r",id:2},{rule:"required",type:"int32",name:"g",id:3},{rule:"required",type:"int32",name:"b",id:4}]},{name:"Rect",fields:[{rule:"required",type:"int32",name:"left",id:1},{rule:"required",type:"int32",name:"right",id:2},{rule:"required",type:"int32",name:"top",id:3},{rule:"required",type:"int32",name:"bottom",id:4}]},{name:"AnnotationObject",fields:[{rule:"required",type:"string",name:"objectId",id:1},{rule:"required",type:"string",name:"annotationId",id:2},{rule:"required",type:"int32",name:"ownerNodeId",id:3},{rule:"required",type:"string",name:"ownerUserId",id:4},{rule:"required",type:"AnnotationType",name:"type",id:5},{rule:"required",type:"LineArrow",name:"arrow",id:6},{rule:"required",type:"int32",name:"lineWidth",id:7},{rule:"required",type:"color",name:"lineColor",id:8},{rule:"required",type:"color",name:"fillColor",id:9},{rule:"required",type:"Rect",name:"objectRect",id:10}]},{name:"Annotation2Point",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"required",type:"Point",name:"start",id:2},{rule:"required",type:"Point",name:"end",id:3}]},{name:"AnnotationMultiPoint",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"repeated",type:"Point",name:"points",id:2}]},{name:"AnnotationList",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"repeated",type:"string",name:"eraserIds",id:2}]},{name:"ImgInfo",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"x",id:2},{rule:"required",type:"int32",name:"y",id:3},{rule:"required",type:"int32",name:"w",id:4},{rule:"required",type:"int32",name:"h",id:5},{rule:"required",type:"int32",name:"layer",id:6},{rule:"required",type:"int32",name:"boder",id:7},{rule:"required",type:"bool",name:"has_select",id:8},{rule:"required",type:"int32",name:"rotate",id:9},{rule:"required",type:"bytes",name:"file",id:10},{rule:"optional",type:"bytes",name:"data",id:11}]},{name:"AnnotationImg",fields:[{rule:"required",type:"AnnotationObject",name:"objectBase",id:1},{rule:"required",type:"ImgInfo",name:"im",id:2}]},{name:"Txt",fields:[{rule:"required",type:"int32",name:"line",id:1},{rule:"required",type:"string",name:"content",id:2}]},{name:"TextInfo",fields:[{rule:"required",type:"uint32",name:"fontSize",id:1},{rule:"repeated",type:"Txt",name:"txs",id:2},{rule:"required",type:"color",name:"fontColor",id:3},{rule:"optional",type:"uint32",name:"oneHeight",id:4},{rule:"optional",type:"uint32",name:"oneWidth",id:5},{rule:"optional",type:"uint32",name:"fontUnit",id:6},{rule:"optional",type:"string",name:"fontStyle",id:7},{rule:"optional",type:"string",name:"fontWeight",id:8},{rule:"optional",type:"string",name:"fontFamily",id:9},{rule:"optional",type:"string",name:"extendData",id:10}]},{name:"AnnotationTxt",fields:[{rule:"required",type:"Annotation2Point",name:"objectBase",id:1},{rule:"required",type:"TextInfo",name:"txi",id:2}]},{name:"AnnotationMsgInternal",fields:[{rule:"required",type:"uint32",name:"msg_type",id:1},{rule:"optional",type:"bytes",name:"annotation",id:2},{rule:"optional",type:"string",name:"annotationId",id:3},{rule:"optional",type:"int32",name:"srcNodeId",id:4},{rule:"optional",type:"int32",name:"dstNodeId",id:5}]},{name:"AnnotationMsg",fields:[{rule:"required",type:"uint32",name:"msg_type",id:1},{rule:"optional",type:"bytes",name:"annotation",id:2}]},{name:"UpdateAnnotationMsg",fields:[{rule:"required",type:"uint32",name:"operType",id:1},{rule:"required",type:"string",name:"objectId",id:2},{rule:"required",type:"uint32",name:"annotationType",id:3},{rule:"optional",type:"string",name:"annotationId",id:4},{rule:"required",type:"int32",name:"operNodeId",id:5},{rule:"required",type:"string",name:"operUserId",id:6},{rule:"optional",type:"Annotation2Point",name:"ann2pt",id:7},{rule:"optional",type:"AnnotationMultiPoint",name:"annMutlipt",id:8},{rule:"optional",type:"AnnotationList",name:"annList",id:9},{rule:"optional",type:"AnnotationImg",name:"Img",id:10},{rule:"optional",type:"AnnotationTxt",name:"txt",id:11}]},{name:"BoardObject",fields:[{rule:"required",type:"string",name:"objectId",id:1},{rule:"required",type:"int32",name:"ownerNodeId",id:2},{rule:"required",type:"string",name:"ownerUserId",id:3},{rule:"required",type:"int32",name:"width",id:4},{rule:"required",type:"int32",name:"height",id:5},{rule:"optional",type:"color",name:"bgColor",id:6},{rule:"optional",type:"string",name:"bgImage",id:7},{rule:"repeated",type:"AnnotationObject",name:"annotations",id:8},{rule:"optional",type:"string",name:"title",id:9},{rule:"optional",type:"string",name:"description",id:10},{rule:"optional",type:"string",name:"extendData",id:11}]},{name:"UpdateBoardMsg",fields:[{rule:"required",type:"uint32",name:"operType",id:1},{rule:"required",type:"int32",name:"operNodeId",id:2},{rule:"required",type:"string",name:"operUserId",id:3},{rule:"optional",type:"string",name:"boardId",id:4},{rule:"optional",type:"BoardObject",name:"board",id:5}]},{name:"BoardsInfoMsg",fields:[{rule:"repeated",type:"BoardObject",name:"boards",id:2}]},{name:"OutgoingCreateLiver",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"liver_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"creator_id",id:4},{rule:"optional",type:"string",name:"liver_name",id:8},{rule:"optional",type:"string",name:"app_data",id:9}]},{name:"OutgoingCreateLiverRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"liver_id",id:4},{rule:"optional",type:"string",name:"publish_url",id:5},{rule:"optional",type:"string",name:"rtmp_url",id:6},{rule:"optional",type:"string",name:"hls_url",id:7}]},{name:"OutgoingSelectMediaLive",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"liver_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"video_user_id",id:4},{rule:"optional",type:"string",name:"video_resource_id",id:5},{rule:"optional",type:"string",name:"audio_user_id",id:6}]},{name:"OutgoingSelectMediaLiveRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"liver_id",id:4}]},{name:"OutgoingVideoInfo",fields:[{rule:"required",type:"string",name:"owner_user_id",id:1},{rule:"required",type:"int32",name:"zoder",id:2},{rule:"optional",type:"float",name:"x",id:5},{rule:"optional",type:"float",name:"y",id:6},{rule:"optional",type:"float",name:"w",id:7},{rule:"optional",type:"float",name:"h",id:8},{rule:"optional",type:"string",name:"video_resource_id",id:9},{rule:"optional",type:"string",name:"video_data",id:10}]},{name:"OutgoingMixMediaLive",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"liver_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"OutGoingViewLayoutMode",name:"layoutMode",id:4},{rule:"repeated",type:"OutgoingVideoInfo",name:"videos",id:5},{rule:"optional",type:"int32",name:"viewWidth",id:6},{rule:"optional",type:"int32",name:"viewHeight",id:7},{rule:"optional",type:"string",name:"audio_user_id",id:8}]},{name:"OutgoingMixMediaLiveRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"liver_id",id:4}]},{name:"OutgoingDestroyLiver",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"liver_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3}]},{name:"OutgoingDestroyLiverRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"liver_id",id:4}]},{name:"OutgoingPauseResumeLive",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"liver_id",id:2},{rule:"required",type:"string",name:"room_id",id:3},{rule:"required",type:"bool",name:"pause_resume",id:4}]},{name:"OutgoingPauseResumeLiveRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"liver_id",id:4}]},{name:"OutgoingGetLivers",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"liver_id",id:3}]},{name:"OutGoingLiverInfo",fields:[{rule:"required",type:"string",name:"liver_id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"optional",type:"string",name:"creator_id",id:3},{rule:"optional",type:"string",name:"createTime",id:4},{rule:"optional",type:"string",name:"duration",id:5},{rule:"optional",type:"string",name:"room_id",id:6},{rule:"optional",type:"LiveStatus",name:"status",id:7},{rule:"optional",type:"string",name:"publish_url",id:8},{rule:"optional",type:"string",name:"rtmp_url",id:9},{rule:"optional",type:"string",name:"hls_url",id:10}]},{name:"OutgoingGetLiversRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"count",id:2},{rule:"repeated",type:"OutGoingLiverInfo",name:"liverInfos",id:3}]},{name:"OutgoingCreateRecord",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"record_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"creator_id",id:4},{rule:"optional",type:"string",name:"record_name",id:5},{rule:"optional",type:"string",name:"app_data",id:6},{rule:"optional",type:"int32",name:"file_type",id:7}]},{name:"OutgoingCreateRecordRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"record_id",id:4},{rule:"optional",type:"string",name:"play_url",id:5}]},{name:"OutgoingSelectMediaRecord",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"record_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"video_user_id",id:4},{rule:"optional",type:"string",name:"video_resource_id",id:5},{rule:"optional",type:"string",name:"audio_user_id",id:6}]},{name:"OutgoingSelectMediaRecordRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"record_id",id:4}]},{name:"OutgoingMixMediaRecord",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"liver_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"OutGoingViewLayoutMode",name:"layoutMode",id:4},{rule:"repeated",type:"OutgoingVideoInfo",name:"videos",id:5},{rule:"optional",type:"int32",name:"viewWidth",id:6},{rule:"optional",type:"int32",name:"viewHeight",id:7},{rule:"optional",type:"string",name:"audio_user_id",id:8}]},{name:"OutgoingMixMediaRecordRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"record_id",id:4}]},{name:"OutgoingDestroyRecord",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"record_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3}]},{name:"OutgoingDestroyRecordRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"record_id",id:4}]},{name:"OutgoingPauseResumeRecord",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"record_id",id:2},{rule:"required",type:"string",name:"room_id",id:3},{rule:"required",type:"bool",name:"pause_resume",id:4}]},{name:"OutgoingPauseResumeRecordRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"record_id",id:4}]},{name:"OutgoingGetRecords",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"record_id",id:3}]},{name:"OutGoingRecordInfo",fields:[{rule:"required",type:"string",name:"record_id",id:1},{rule:"optional",type:"string",name:"name",id:2},{rule:"optional",type:"string",name:"creator_id",id:3},{rule:"optional",type:"MediaFileType",name:"file_type",id:4},{rule:"optional",type:"string",name:"url",id:5},{rule:"optional",type:"int64",name:"file_size",id:6},{rule:"optional",type:"string",name:"create_time",id:7},{rule:"optional",type:"int64",name:"duration",id:8},{rule:"optional",type:"string",name:"room_id",id:9},{rule:"optional",type:"RecordStatus",name:"status",id:10}]},{name:"OutgoingGetRecordsRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"count",id:2},{rule:"repeated",type:"OutGoingRecordInfo",name:"recordInfos",id:3}]},{name:"OutgoingCreateStreamsExporterReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"exporter_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"creator_id",id:4},{rule:"optional",type:"string",name:"exporter_name",id:5},{rule:"optional",type:"ExporterType",name:"exporter_type",id:6},{rule:"optional",type:"int32",name:"viewWidth",id:7},{rule:"optional",type:"int32",name:"viewHeight",id:8},{rule:"optional",type:"int32",name:"outBitrate",id:9},{rule:"optional",type:"int32",name:"outFps",id:10},{rule:"optional",type:"string",name:"app_data",id:11},{rule:"optional",type:"bool",name:"auto_close",id:12},{rule:"optional",type:"int32",name:"view_bg_color",id:13},{rule:"optional",type:"int32",name:"view_bg_image",id:14},{rule:"optional",type:"string",name:"main_video_resource_id",id:15},{rule:"optional",type:"string",name:"exporter_nick_name",id:16},{rule:"optional",type:"int32",name:"max_video_number",id:17},{rule:"optional",type:"string",name:"pulish_urls",id:18}]},{name:"OutgoingCreateStreamsExporterRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4},{rule:"optional",type:"ExporterType",name:"exporter_type",id:5},{rule:"optional",type:"string",name:"play_urls",id:6},{rule:"optional",type:"string",name:"exporter_name",id:7}]},{name:"OutgoingSelectStreamReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"exporter_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"string",name:"video_user_id",id:4},{rule:"optional",type:"string",name:"video_resource_id",id:5},{rule:"optional",type:"string",name:"audio_user_id",id:6},{rule:"optional",type:"string",name:"stream_name",id:7},{rule:"optional",type:"ExporterType",name:"exporter_type",id:8}]},{name:"OutgoingSelectStreamRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4},{rule:"optional",type:"ExporterType",name:"exporter_type",id:5}]},{name:"OutgoingMixStreamsReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"exporter_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"OutGoingViewLayoutMode",name:"layoutMode",id:4},{rule:"repeated",type:"OutgoingVideoInfo",name:"videos",id:5},{rule:"optional",type:"string",name:"audio_user_id",id:6},{rule:"optional",type:"ExporterType",name:"exporter_type",id:7}]},{name:"OutgoingMixStreamsRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4}]},{name:"OutgoingDestroyExporterReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"exporter_id",id:2},{rule:"optional",type:"string",name:"room_id",id:3},{rule:"optional",type:"ExporterType",name:"exporter_type",id:4}]},{name:"OutgoingDestroyExporterRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4}]},{name:"OutgoingPauseResumeExporterReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"exporter_id",id:2},{rule:"required",type:"string",name:"room_id",id:3},{rule:"required",type:"bool",name:"pause_resume",id:4},{rule:"optional",type:"ExporterType",name:"exporter_type",id:5}]},{name:"OutgoingPauseResumeExporterRep",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4}]},{name:"OutgoingExporterErrorNotify",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"int32",name:"error_no",id:2},{rule:"optional",type:"string",name:"msg",id:3},{rule:"optional",type:"string",name:"exporter_id",id:4}]},{name:"OutgoingExporterSetFocusVideoReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"exporter_id",id:3},{rule:"optional",type:"string",name:"video_resource_id",id:4},{rule:"optional",type:"ExporterType",name:"exporter_type",id:5}]},{name:"OutgoingExporterSetFocusVideoRsp",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"exporter_id",id:3},{rule:"optional",type:"int32",name:"ret",id:4},{rule:"optional",type:"string",name:"msg",id:5}]},{name:"OutgoingGetExporterInfoReq",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"exporter_id",id:3},{rule:"optional",type:"ExporterType",name:"exporter_type",id:4}]},{name:"OutgoingGetExporterInfoRsp",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"room_id",id:2},{rule:"optional",type:"string",name:"view_stream_id",id:3},{rule:"optional",type:"string",name:"view_name",id:4},{rule:"optional",type:"int32",name:"view_bitrate",id:5},{rule:"optional",type:"int32",name:"view_fps",id:6},{rule:"optional",type:"int32",name:"view_width",id:7},{rule:"optional",type:"int32",name:"view_height",id:8},{rule:"optional",type:"int32",name:"view_bg_color",id:9},{rule:"optional",type:"int32",name:"view_bg_image",id:10},{rule:"repeated",type:"OutgoingVideoInfo",name:"videos",id:11},{rule:"optional",type:"OutGoingViewLayoutMode",name:"layoutMode",id:12},{rule:"optional",type:"string",name:"focus_video_resource_id",id:13},{rule:"optional",type:"string",name:"exporter_name",id:14},{rule:"optional",type:"string",name:"exporter_nick_name",id:15},{rule:"optional",type:"int32",name:"max_video_number",id:16},{rule:"optional",type:"int32",name:"ret",id:17},{rule:"optional",type:"string",name:"msg",id:18}]},{name:"MouseParams",fields:[{rule:"optional",type:"string",name:"paramStr",id:1},{rule:"optional",type:"int32",name:"paramInt",id:2}]},{name:"MouseMsg",fields:[{rule:"required",type:"uint32",name:"mouseT",id:1},{rule:"required",type:"int32",name:"x_pos",id:2},{rule:"required",type:"int32",name:"y_pos",id:3},{rule:"repeated",type:"MouseParams",name:"params",id:4}]},{name:"KeyCtrl",fields:[{rule:"required",type:"uint32",name:"keyC",id:1}]},{name:"KeyValue",fields:[{rule:"required",type:"uint32",name:"keyV",id:1}]},{name:"KeyBoardMsg",fields:[{rule:"repeated",type:"KeyCtrl",name:"cc",id:1},{rule:"repeated",type:"KeyValue",name:"vv",id:2}]},{name:"RequestCtrl",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"CmdType",name:"cmtype",id:2},{rule:"required",type:"ClientType",name:"client",id:3},{rule:"required",type:"string",name:"bectrluserId",id:4},{rule:"required",type:"string",name:"ctrluserid",id:5},{rule:"required",type:"int64",name:"timestamp",id:6}]},{name:"RespondCtrl",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"required",type:"CmdType",name:"cmtype",id:3},{rule:"required",type:"string",name:"token",id:4},{rule:"required",type:"string",name:"ctruserId",id:5},{rule:"required",type:"string",name:"beCtrleduserId",id:6},{rule:"optional",type:"int32",name:"desk_width",id:7},{rule:"optional",type:"int32",name:"desk_height",id:8},{rule:"optional",type:"int64",name:"timestamp",id:9}]},{name:"RespondCtrlAsk",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"required",type:"CmdType",name:"cmtype",id:3},{rule:"required",type:"string",name:"token",id:4},{rule:"optional",type:"string",name:"ctruserId",id:5},{rule:"optional",type:"string",name:"beCtrleduserId",id:6},{rule:"optional",type:"int64",name:"timestamp",id:7}]},{name:"RequestInvite",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"string",name:"token",id:2},{rule:"required",type:"string",name:"ctruserId",id:3},{rule:"required",type:"string",name:"beCtrleduserId",id:4},{rule:"required",type:"int32",name:"desk_width",id:5},{rule:"required",type:"int32",name:"desk_height",id:6},{rule:"optional",type:"int64",name:"timestamp",id:7}]},{name:"RespondInvite",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"required",type:"string",name:"token",id:3},{rule:"required",type:"string",name:"ctruserId",id:4},{rule:"required",type:"string",name:"beCtrleduserId",id:5},{rule:"optional",type:"int64",name:"timestamp",id:6}]},{name:"RequestTermialCtrl",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"string",name:"ctruserId",id:2},{rule:"required",type:"string",name:"beCtrleduserId",id:3},{rule:"optional",type:"int64",name:"timestamp",id:4}]},{name:"RespondTermialCtrl",fields:[{rule:"required",type:"int32",name:"requId",id:1},{rule:"required",type:"int32",name:"result",id:2},{rule:"required",type:"string",name:"ctruserId",id:3},{rule:"required",type:"string",name:"beCtrleduserId",id:4},{rule:"optional",type:"int64",name:"timestamp",id:5}]},{name:"CmdCtrlMsg",fields:[{rule:"required",type:"int32",name:"otype",id:1},{rule:"required",type:"string",name:"token",id:2},{rule:"required",type:"int32",name:"requestid",id:3},{rule:"required",type:"MouseMsg",name:"mouseV",id:4},{rule:"required",type:"KeyBoardMsg",name:"keyV",id:5}]},{name:"CmdCtrlMsgRespond",fields:[{rule:"required",type:"int32",name:"requestid",id:1},{rule:"required",type:"int32",name:"result",id:3}]}],enums:[{name:"RoomPduType",values:[{name:"RoomPduType_Unkonw",id:0},{name:"PING",id:1},{name:"PONG",id:2},{name:"MULTI_PACKET",id:10},{name:"ADD_WEBCAM_MSG",id:1001},{name:"REMOVE_WEBCAM_MSG",id:1002},{name:"ADD_SPEAKER_MSG",id:1003},{name:"REMOVE_SPEAKER_MSG",id:1004},{name:"ADD_DOC_MSG",id:1005},{name:"REMOVE_DOC_MSG",id:1006},{name:"VIDEO_INDICTION",id:1007},{name:"AUDIO_INDICTION",id:1008},{name:"ADD_DESKTOP_MSG",id:1009},{name:"UPDATE_SPEAKER_MSG",id:1010},{name:"UPDATE_WEBCAM_MSG",id:1011},{name:"UPDATE_DESKTOP_MSG",id:1012},{name:"JOIN_REQ",id:2001},{name:"JOIN_REP",id:2002},{name:"LEAVE_MSG",id:2003},{name:"UPDATE_ROOM_STATUS_MSG",id:2004},{name:"PUB_ROOM_RESOURCE_MSG",id:2005},{name:"UNPUB_ROOM_RESOURCE_MSG",id:2006},{name:"SUB_ROOM_RESOURCE_MSG",id:2007},{name:"UNSUB_ROOM_RESOURCE_MSG",id:2008},{name:"PUB_VIDEO_REQ",id:2009},{name:"PUB_AUDIO_REQ",id:2010},{name:"PUB_VIDEO_REP",id:2011},{name:"PUB_AUDIO_REP",id:2012},{name:"ROOM_DATA_INFO",id:2013},{name:"PUB_ROOM_RESOURCE_MSG_REP",id:2014},{name:"SUB_ROOM_RESOURCE_MSG_REP",id:2015},{name:"ROOM_RESOURCE_INFOS",id:2016},{name:"UPDATE_STREAM_SSRC_MSG",id:2017},{name:"CLIENT_TRACE_INFO",id:2018},{name:"CLOSE_ROOM_REQ",id:2019},{name:"CLOSE_ROOM_REP",id:2020},{name:"START_VIDEO_DATA_MSG",id:2021},{name:"STOP_VIDEO_DATA_MSG",id:2022},{name:"MODIFY_RESOURCE_REQ",id:2023},{name:"MODIFY_RESOURCE_REP",id:2024},{name:"UNSUB_ROOM_RESOURCE_MSG_REP",id:2025},{name:"GET_MINI_PROGRAM_STREAM_URL_REQ",id:2026},{name:"GET_MINI_PROGRAM_STREAM_URL_REP",id:2027},{name:"BIND_AUDIO_TO_VIDEO_REQ",id:2028},{name:"BIND_AUDIO_TO_VIDEO_REP",id:2029},{name:"PUBLIC_TEXT_MSG",id:3001},{name:"PRIVATE_TEXT_MSG",id:3002},{name:"PUBLIC_DATA",id:3003},{name:"PRIVATE_DATA",id:3004},{name:"USER_INFO_MSG",id:2051},{name:"USER_MSG",id:2052},{name:"UPDATA_USER_ROLE_PRIVILEDGE_MSG",id:2053},{name:"UPDATE_USER_STATUS_MSG",id:2054},{name:"UPDATE_USER_ROLE_MSG",id:2055},{name:"USER_INDICTION",id:2056},{name:"UPDATE_USER_DATA_MSG",id:2057},{name:"REJOIN_ROOM_MSG",id:2058},{name:"CLOSE_ROOM_MSG",id:2059},{name:"UPDATE_USER_NAME",id:2060},{name:"CHANGE_HOST",id:2061},{name:"OFFER_REQ",id:6001},{name:"OFFER_REP",id:6002},{name:"CANDIDATE_MSG",id:6003},{name:"SUB_ROOM_RESOURCE_REQ",id:6004},{name:"SUB_ROOM_RESOURCE_REP",id:6005},{name:"OPEN_REQ",id:7001},{name:"OPEN_REP",id:7002},{name:"INVITE_ROOM_REQ",id:7003},{name:"INVITE_ROOM_REQ1",id:7020},{name:"INVITE_ROOM_REP",id:7004},{name:"INVITE_ROOM_REP1",id:7021},{name:"CANDIDATE_MSG1",id:7005},{name:"CLOSE_MSG",id:7006},{name:"ICE_RESTART_MSG",id:7007},{name:"OUTGOING_INVITE_STATUS_NOTIFY",id:7008},{name:"ROOM_CONTROL",id:7009},{name:"ROOM_ATTRIBUTE_CHANGE_NOTIFY",id:7022},{name:"ROOM_START_AVC_MIXER_MEDIA",id:7023},{name:"ROOM_START_AVC_MIXER_MEDIA_REP",id:7024},{name:"ROOM_SET_STREAM_NAME_REQ",id:7025},{name:"ROOM_SET_STREAM_NAME_RSP",id:7026},{name:"ROOM_STREAM_NAME_CHANGED_NOTIFY",id:7027},{name:"USER_ACTION_EVENTS_REQ",id:7028},{name:"USER_ACTION_EVENTS_Rsp",id:7029},{name:"USER_SET_KEEP_ALIVE_TIME_REQ",id:7030},{name:"USER_SET_KEEP_ALIVE_TIME_RSP",id:7031},{name:"USER_STREAM_ACTIVE",id:7032},{name:"MEDIA_PLAY_EVENT_NOTIFY",id:7033},{name:"STREAM_KEEP_ALIVE_TIMEOUT_NOTIFY",id:7034},{name:"ANNOTATION_MSG",id:2100},{name:"UPDATE_ANNOTATION_MSG",id:2101},{name:"UPDATE_BOARD_MSG",id:2102},{name:"BOARDS_INFO_PDU",id:2103},{name:"OUTGOING_CREATE_LIVER",id:9001},{name:"OUTGOING_CREATE_LIVER_REP",id:9002},{name:"OUTGOING_SELECT_MEDIA_LIVE",id:9003},{name:"OUTGOING_SELECT_MEDIA_LIVE_REP",id:9004},{name:"OUTGOING_MIX_MEDIA_LIVE",id:9005},{name:"OUTGOING_MIX_MEDIA_LIVE_REP",id:9006},{name:"OUTGOING_DESTROY_LIVER",id:9007},{name:"OUTGOING_DESTROY_LIVER_REP",id:9008},{name:"OUTGOING_PAUSE_RESUME_LIVE",id:9009},{name:"OUTGOING_PAUSE_RESUME_LIVE_REP",id:9010},{name:"OUTGOING_GET_LIVERS",id:9011},{name:"OUTGOING_GET_LIVERS_REP",id:9012},{name:"OUTGOING_CREATE_RECORD",id:9013},{name:"OUTGOING_CREATE_RECORD_REP",id:9014},{name:"OUTGOING_SELECT_MEDIA_RECORD",id:9015},{name:"OUTGOING_SELECT_MEDIA_RECORD_REP",id:9016},{name:"OUTGOING_MIX_MEDIA_RECORD",id:9017},{name:"OUTGOING_MIX_MEDIA_RECORD_REP",id:9018},{name:"OUTGOING_DESTROY_RECORD",id:9019},{name:"OUTGOING_DESTROY_RECORD_REP",id:9020},{name:"OUTGOING_PAUSE_RESUME_RECORD",id:9021},{name:"OUTGOING_PAUSE_RESUME_RECORD_REP",id:9022},{name:"OUTGOING_GET_RECORDS",id:9023},{name:"OUTGOING_GET_RECORDS_REP",id:9024},{name:"OUTGOING_CREATE_STREAMS_EXPORTER_REQ",id:9025},{name:"OUTGOING_CREATE_STREAMS_EXPORTER_REP",id:9026},{name:"OUTGOING_SELECT_STREAM_REQ",id:9027},{name:"OUTGOING_SELECT_STREAM_REP",id:9028},{name:"OUTGOING_MIX_STREAMS_REQ",id:9029},{name:"OUTGOING_MIX_STREAMS_REP",id:9030},{name:"OUTGOING_DESTROY_EXPORTER_REQ",id:9031},{name:"OUTGOING_DESTROY_EXPORTER_REP",id:9032},{name:"OUTGOING_PAUSE_RESUME_EXPORTER_REQ",id:9033},{name:"OUTGOING_PAUSE_RESUME_EXPORTER_REP",id:9034},{name:"OUTGOING_EXPORTER_ERROR_NOTIFY",id:9035},{name:"OUTGOING_EXPORTER_SET_FOCUS_VIDEO_REQ",id:9036},{name:"OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP",id:9037},{name:"OUTGOING_GET_EXPORTER_INFO_REQ",id:9038},{name:"OUTGOING_GET_EXPORTER_INFO_RSP",id:9039},{name:"REQUEST_CTRL",id:20001},{name:"RESPOND_CTRL",id:20002},{name:"RESPOND_CTRL_ASK",id:20003},{name:"REQUEST_INVITE",id:20004},{name:"RESPOND_INVITE",id:20005},{name:"REQUEST_TERMIAL_CTRL",id:20006},{name:"RESPOND_TERMIAL_CTRL",id:20007},{name:"CMD_CTRL_MSG",id:20008},{name:"CMD_CTRL_MSG_RESPOND",id:20009}]},{name:"RoomStatus",values:[{name:"init_room",id:1},{name:"open_room",id:2},{name:"locked_room",id:3},{name:"closed_room",id:4}]},{name:"ResourceOpt",values:[{name:"pub",id:1},{name:"unpub",id:2},{name:"sub",id:3},{name:"unsub",id:4},{name:"mute",id:5},{name:"unmute",id:6},{name:"forbid",id:7},{name:"unforbid",id:8}]},{name:"ResourceStatus",values:[{name:"init",id:1},{name:"published",id:2},{name:"muted",id:3},{name:"forbided",id:4},{name:"subed",id:5}]},{name:"CameraType",values:[{name:"unknown",id:0},{name:"front",id:1},{name:"back",id:2}]},{name:"UserStatus",values:[{name:"online",id:0},{name:"offline",id:1}]},{name:"UserRole",values:[{name:"host",id:1},{name:"presenter",id:2},{name:"attendee",id:3}]},{name:"MediaType",values:[{name:"video",id:1},{name:"audio",id:2},{name:"desktop",id:3}]},{name:"SessionType",values:[{name:"Chat",id:1},{name:"Audio",id:2},{name:"Video",id:3},{name:"ShareScreen",id:4},{name:"ShareDoc",id:5},{name:"WhiteBoard",id:6}]},{name:"RepResultType",values:[{name:"allowed",id:1},{name:"rejected",id:2}]},{name:"UserMsgOpt",values:[{name:"leave",id:1},{name:"kickoff",id:2},{name:"server_kickoff",id:3},{name:"timeout",id:4}]},{name:"DataCryptoType",values:[{name:"DataCryptoTypeAES128",id:1},{name:"DataCryptoTypeAES256",id:2},{name:"DataCryptoTypeSM4",id:3}]},{name:"RoomMode",values:[{name:"free",id:1},{name:"host1",id:2},{name:"p2pfree",id:3},{name:"p2phost",id:4}]},{name:"OutgoingInviteType",values:[{name:"OutgoingInviteTypeSIP",id:1},{name:"OutgoingInviteTypeH323",id:2},{name:"OutgoingInviteTypeRTSP",id:3}]},{name:"StreamActiveStatus",values:[{name:"StreamActiveStatusUnchanged",id:0},{name:"StreamActiveStatusUnActive",id:1},{name:"StreamActiveStatusActive",id:2}]},{name:"MediaPlayEvents",values:[{name:"MediaPlayEventsStarted",id:0},{name:"MediaPlayEventsStoped",id:1}]},{name:"LineArrow",values:[{name:"none",id:1},{name:"begin",id:2},{name:"end",id:3},{name:"arrow2",id:4}]},{name:"AnnotationType",values:[{name:"annotation_tool_mouse",id:1},{name:"annotation_tool_line",id:2},{name:"annotation_tool_rectangle",id:3},{name:"annotation_tool_ellipse",id:4},{name:"annotation_tool_polyline",id:5},{name:"annotation_tool_polygon",id:6},{name:"annotation_tool_hlight_point",id:7},{name:"annotation_tool_hlight_texttag",id:8},{name:"annotation_tool_eraser_line",id:9},{name:"annotation_tool_eraser_rectangle",id:10},{name:"annotation_tool_rhomb",id:11},{name:"annotation_tool_arrow",id:12},{name:"annotation_tool_success",id:13},{name:"annotation_tool_failure",id:14},{name:"annotation_tool_undo",id:15},{name:"annotation_tool_redo",id:16},{name:"annotation_tool_clear",id:17},{name:"annotation_tool_img",id:18},{name:"annotation_tool_hlight_cricle",id:19},{name:"annotation_tool_txt",id:20}]},{name:"OutGoingViewLayoutMode",values:[{name:"Outgoing_View_Layout_Fixation",id:0},{name:"Outgoing_View_Layout_Auto",id:1},{name:"Outgoing_View_Layout_Auto_Orato",id:2}]},{name:"LiveStatus",values:[{name:"LIVE_STATUS_LIVEING",id:0},{name:"LIVE_STATUS_PAUSED",id:1}]},{name:"RecordStatus",values:[{name:"RECORD_STATUS_LIVEING",id:0},{name:"RECORD_STATUS_PAUSED",id:1}]},{name:"MediaFileType",values:[{name:"TbMediaFormat_AVI",id:0},{name:"TbMediaFormat_WEBM",id:1},{name:"TbMediaFormat_MP4",id:2},{name:"TbMediaFormat_WAV",id:3}]},{name:"ExporterType",values:[{name:"EXPORTER_TYPE_RECORD",id:0},{name:"EXPORTER_TYPE_RECORD_REAL_TIME",id:1},{name:"EXPORTER_TYPE_LIVER",id:2},{name:"EXPORTER_TYPE_RECORD_AUTO",id:3},{name:"EXPORTER_TYPE_LIVER_AUTO",id:4},{name:"EXPORTER_TYPE_LIVER_AUTO_VIEW",id:5},{name:"EXPORTER_TYPE_RECORD_AUTO_VIEW",id:6},{name:"EXPORTER_TYPE_AVC_MEDIA_MIXER",id:7},{name:"EXPORTER_TYPE_RECORD_ONLY_DESKTOP_AUTO",id:9},{name:"EXPORTER_TYPE_LIVE_ONLY_DESKTOP_AUTO",id:10},{name:"EXPORTER_TYPE_RECORD_ONLY_DESKTOP",id:11},{name:"EXPORTER_TYPE_LIVE_ONLY_DESKTOP",id:12}]},{name:"CmdType",values:[{name:"ctrl",id:1},{name:"cancle_ctr",id:2},{name:"extend_ctr1",id:3}]},{name:"ClientType",values:[{name:"Win_pc",id:1},{name:"android",id:2},{name:"ios",id:3}]},{name:"CmdResult",values:[{name:"allow",id:1},{name:"notallow",id:2},{name:"terminal",id:3}]}]}).build(),rtmBuilder=dcodeIO.newBuilder({}).import({package:"signal_pdu",messages:[{name:"signal_header",fields:[{rule:"required",type:"string",name:"version",id:1},{rule:"required",type:"signal_group_type",name:"group_type",id:2},{rule:"required",type:"signal_cmd_type",name:"cmd_type",id:3},{rule:"required",type:"uint32",name:"timestamp",id:4},{rule:"required",type:"string",name:"from",id:5},{rule:"required",type:"string",name:"to",id:6},{rule:"required",type:"bytes",name:"content",id:7}]},{name:"Invite",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"options",id:2}]},{name:"InviteCancel",fields:[{rule:"required",type:"int32",name:"id",id:1}]},{name:"InviteOk",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"options",id:2}]},{name:"InviteReject",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"reson",id:2}]},{name:"InviteRinging",fields:[{rule:"required",type:"int32",name:"id",id:1}]},{name:"InviteTimeOut",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"reson",id:2}]},{name:"InviteBye",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"reson",id:2}]},{name:"MsgData",fields:[{rule:"required",type:"string",name:"msg_id",id:1},{rule:"required",type:"SessionType",name:"session_type",id:2},{rule:"required",type:"string",name:"session_id",id:3},{rule:"required",type:"uint32",name:"create_time",id:4},{rule:"required",type:"MsgType",name:"msg_type",id:5},{rule:"required",type:"bytes",name:"msg_content",id:6}]},{name:"MsgDataDelivered",fields:[{rule:"required",type:"string",name:"msg_id",id:1},{rule:"required",type:"SessionType",name:"session_type",id:2},{rule:"required",type:"string",name:"session_id",id:3}]},{name:"MsgDataRead",fields:[{rule:"required",type:"string",name:"msg_id",id:1},{rule:"required",type:"SessionType",name:"session_type",id:2},{rule:"required",type:"string",name:"session_id",id:3}]},{name:"MsgDataRecalled",fields:[{rule:"required",type:"string",name:"msg_id",id:1},{rule:"required",type:"SessionType",name:"session_type",id:2},{rule:"required",type:"string",name:"session_id",id:3}]},{name:"MouseEvents",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"int32",name:"video_x",id:2},{rule:"optional",type:"int32",name:"video_y",id:3},{rule:"optional",type:"int32",name:"video_w",id:4},{rule:"optional",type:"int32",name:"video_h",id:5},{rule:"optional",type:"mouse_events_type",name:"eventsType",id:6}]},{name:"KeyBoardEvents",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"repeated",type:"int32",name:"keyc",id:2},{rule:"repeated",type:"int32",name:"keyv",id:3},{rule:"optional",type:"keyboard_events_type",name:"eventsType",id:4}]},{name:"RpcCallRequest",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"rpc_data",id:2}]},{name:"RpcCallResponse",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"rpc_data",id:2}]},{name:"RpcNotification",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"required",type:"string",name:"rpc_data",id:2}]}],enums:[{name:"signal_group_type",values:[{name:"SIGNALE_GROUP_TYPE_SYS",id:0},{name:"SIGNALE_GROUP_TYPE_MESSAGE",id:1},{name:"SIGNALE_GROUP_TYPE_INVITE",id:3},{name:"SIGNALE_GROUP_TYPE_RPC",id:4},{name:"SIGNALE_GROUP_TYPE_ADDRESS_BOOK",id:5},{name:"SIGNALE_GROUP_TYPE_REMOTE_CONTROL",id:6}]},{name:"signal_cmd_type",values:[{name:"SIGNALE_CMD_TYPE_INVITE",id:0},{name:"SIGNALE_CMD_TYPE_INVITE_CANCEL",id:1},{name:"SIGNALE_CMD_TYPE_INVITE_RINGING",id:2},{name:"SIGNALE_CMD_TYPE_INVITE_OK",id:3},{name:"SIGNALE_CMD_TYPE_INVITE_REJECT",id:4},{name:"SIGNALE_CMD_TYPE_INVITE_TIMEOUT",id:5},{name:"SIGNALE_CMD_TYPE_INVITE_BYE",id:6},{name:"SIGNALE_CMD_TYPE_RC_MOUSE_EVENTS",id:32},{name:"SIGNALE_CMD_TYPE_RC_KEYBOARD_EVENTS",id:33},{name:"SIGNALE_CMD_TYPE_MESSAGE_DATA",id:48},{name:"SIGNALE_CMD_TYPE_MESSAGE_RECEIVED",id:49},{name:"SIGNALE_CMD_TYPE_MESSAGE_READ",id:50},{name:"SIGNALE_CMD_TYPE_MESSAGE_RECALLED",id:51},{name:"SIGNALE_CMD_TYPE_RPC_CALL_REQUEST",id:64},{name:"SIGNALE_CMD_TYPE_RPC_CALL_RESPONSE",id:65},{name:"SIGNALE_CMD_TYPE_RPC_NOTIFICATION",id:66}]},{name:"SessionType",values:[{name:"SESSION_TYPE_PEERS",id:1},{name:"SESSION_TYPE_GROUP",id:2},{name:"SESSION_TYPE_CHATROOM",id:3}]},{name:"MsgType",values:[{name:"MSG_TYPE_TEXT",id:1},{name:"MSG_TYPE_IMAGE",id:2},{name:"MSG_TYPE_FILE",id:3},{name:"MSG_TYPE_AUDIO",id:4},{name:"MSG_TYPE_VIDEO",id:5},{name:"MSG_TYPE_LOCATION",id:6}]},{name:"MsgStatus",values:[{name:"MSG_STAT_DELIVERING",id:1},{name:"MSG_STAT_DELIVERED",id:2},{name:"MSG_STAT_READ",id:3},{name:"MSG_STAT_FAILED",id:4},{name:"MSG_TYPE_RECALLED",id:5}]},{name:"mouse_events_type",values:[{name:"WM_MOUSEMOVE",id:512},{name:"WM_LBUTTONDOWN",id:513},{name:"WM_LBUTTONUP",id:514},{name:"WM_LBUTTONDBLCLK",id:515},{name:"WM_RBUTTONDOWN",id:516},{name:"WM_RBUTTONUP",id:517},{name:"WM_RBUTTONDBLCLK",id:518},{name:"WM_MBUTTONDOWN",id:519},{name:"WM_MBUTTONUP",id:520},{name:"WM_MBUTTONDBLCLK",id:521},{name:"WM_MOUSEWHEEL",id:522}]},{name:"keyboard_events_type",values:[{name:"WM_KEYDOWN",id:256},{name:"WM_KEYUP",id:257},{name:"WM_CHAR",id:258}]},{name:"keyboard_vk_type",values:[{name:"VK_BACK",id:8},{name:"VK_TAB",id:9},{name:"VK_SHIFT",id:16},{name:"VK_CONTROL",id:17},{name:"VK_MENU",id:18},{name:"VK_PAUSE",id:19},{name:"VK_CAPITAL",id:20},{name:"VK_KANA",id:21},{name:"VK_JUNJA",id:23},{name:"VK_FINAL",id:24},{name:"VK_HANJA",id:25},{name:"VK_KANJI",id:25},{name:"VK_ESCAPE",id:27},{name:"VK_CONVERT",id:28},{name:"VK_NONCONVERT",id:29},{name:"VK_ACCEPT",id:30},{name:"VK_MODECHANGE",id:31},{name:"VK_SPACE",id:32},{name:"VK_PRIOR",id:33},{name:"VK_NEXT",id:34},{name:"VK_END",id:35},{name:"VK_HOME",id:36},{name:"VK_LEFT",id:37},{name:"VK_UP",id:38},{name:"VK_RIGHT",id:39},{name:"VK_DOWN",id:40},{name:"VK_SELECT",id:41},{name:"VK_PRINT",id:42},{name:"VK_EXECUTE",id:43},{name:"VK_SNAPSHOT",id:44},{name:"VK_INSERT",id:45},{name:"VK_DELETE",id:46},{name:"VK_HELP",id:47}]}]}).build();ModuleBase.define("CmdProtobufCoded",[],function(){var y,e=function(){y=cmdBuilder.room_pdu};return e.prototype.getRoomPduTypeEnum=function(){return y.RoomPduType},e.prototype.getRoomStatusEnum=function(){return y.RoomStatus},e.prototype.getResourceOptEnum=function(){return y.ResourceOpt},e.prototype.getResourceStatusEnum=function(){return y.ResourceStatus},e.prototype.getCameraTypeEnum=function(){return y.CameraType},e.prototype.getUserStatusEnum=function(){return y.UserStatus},e.prototype.getUserRoleEnum=function(){return y.UserRole},e.prototype.getMediaTypeEnum=function(){return y.MediaType},e.prototype.getSessionTypeEnum=function(){return y.SessionType},e.prototype.getRepResultTypeEnum=function(){return y.RepResultType},e.prototype.getUserMsgOptEnum=function(){return y.UserMsgOpt},e.prototype.getRoomModeEnum=function(){return y.RoomMode},e.prototype.getLineArrowEnum=function(){return y.LineArrow},e.prototype.getAnnotationTypeEnum=function(){return y.AnnotationType},e.prototype.getExporterTypeEnum=function(){return y.ExporterType},e.prototype.getOutgoingInviteTypeEnum=function(){return y.OutgoingInviteType},e.prototype.getMediaPlayEventsEnum=function(){return y.MediaPlayEvents},e.prototype.getDataCryptoTypeEnum=function(){return y.DataCryptoType},e.prototype.getOutGoingViewLayoutMode=function(){return y.OutGoingViewLayoutMode},e.prototype.newWebcam=function(){return new y.Webcam},e.prototype.newWebcam=function(e,t,r,o){return new y.Webcam(e,t,r,o)},e.prototype.newSpeaker=function(){return new y.Speaker},e.prototype.newSpeaker=function(e,t,r,o){return new y.Speaker(e,t,r,o)},e.prototype.newDesktop=function(){return new y.Desktop},e.prototype.newDesktop=function(e,t,r,o){return new y.Desktop(e,t,r,o)},e.prototype.newDocFile=function(){return new y.DocFile},e.prototype.newDocFile=function(e,t,r,o,n){return new y.DocFile(e,t,r,o,n)},e.prototype.newAddWebcamMsg=function(){return new y.AddWebcamMsg},e.prototype.newAddWebcamMsg=function(e,t){return new y.AddWebcamMsg(e,t)},e.prototype.newRemoveWebcamMsg=function(){return new y.RemoveWebcamMsg},e.prototype.newRemoveWebcamMsg=function(e,t){return new y.RemoveWebcamMsg(e,t)},e.prototype.newAddSpeakerMsg=function(){return new y.AddSpeakerMsg},e.prototype.newAddSpeakerMsg=function(e,t){return new y.AddSpeakerMsg(e,t)},e.prototype.newRemoveSpeakerMsg=function(){return new y.RemoveSpeakerMsg},e.prototype.newRemoveSpeakerMsg=function(e,t){return new y.RemoveSpeakerMsg(e,t)},e.prototype.newAddDocFileMsg=function(){return new y.AddDocFileMsg},e.prototype.newAddDocFileMsg=function(e,t){return new y.AddDocFileMsg(e,t)},e.prototype.newRemoveDocFileMsg=function(){return new y.RemoveDocFileMsg},e.prototype.newRemoveDocFileMsg=function(e,t){return new y.RemoveDocFileMsg(e,t)},e.prototype.newRoomResourceInfo=function(){return new y.RoomResourceInfo},e.prototype.newRoomResourceInfo=function(e,t,r){return new y.RoomResourceInfo(e,t,r)},e.prototype.newRoomInfo=function(){return new y.RoomInfo},e.prototype.newRoomInfo=function(e,t){return new y.RoomInfo(e,t)},e.prototype.newUserPolicy=function(){return new y.UserPolicy},e.prototype.newUserPolicy=function(e,t,r){return new y.UserPolicy(e,t,r)},e.prototype.newJoinInfo=function(){return new y.JoinInfo},e.prototype.newJoinInfo=function(e,t,r,o,n){return new y.JoinInfo(e,t,r,o,n)},e.prototype.newUserInfo=function(){return new y.UserInfo},e.prototype.newUserInfo=function(e,t,r,o,n,i,a,s,d,l,u,c){return new y.UserInfo(e,t,r,o,n,i,a,s,d,l,u,c)},e.prototype.newMediaStream=function(){return new y.MediaStream},e.prototype.newMediaStream=function(e,t,r,o,n,i,a){var s=new y.MediaStream;return s.stream_name=e,s.type=t,s.sdp=r,void 0!==o&&o&&0!=o&&(s.width=o),void 0!==n&&n&&0!=n&&(s.height=n),void 0!==i&&i&&0!=i&&(s.frame_rate=i),void 0!==a&&(s.payload=a),s},e.prototype.newMediaStreamInfo=function(){return new y.MediaStreamInfo},e.prototype.newMediaStreamInfo=function(e,t,r){return new y.MediaStreamInfo(e,t,r)},e.prototype.newResourceIndiction=function(){return new y.ResourceIndiction},e.prototype.newResourceIndiction=function(e,t,r,o,n){return new y.ResourceIndiction(e,t,r,o,n)},e.prototype.newAddDesktopMsg=function(){return new y.AddDesktopMsg},e.prototype.newAddDesktopMsg=function(e,t){return new y.AddDesktopMsg(e,t)},e.prototype.newRemoveDesktopMsg=function(){return new y.RemoveDesktopMsg},e.prototype.newRemoveDesktopMsg=function(e,t){return new y.RemoveDesktopMsg},e.prototype.newUpdateWebcamMsg=function(){return new y.UpdateWebcamMsg},e.prototype.newUpdateWebcamMsg=function(e,t,r){return new y.UpdateWebcamMsg(e,t,r)},e.prototype.newUpdateSpeakerMsg=function(){return new y.UpdateSpeakerMsg},e.prototype.newUpdateSpeakerMsg=function(e,t,r){return new y.UpdateSpeakerMsg(e,t,r)},e.prototype.newUpdateDesktopMsg=function(){return new y.UpdateDesktopMsg},e.prototype.newUpdateDesktopMsg=function(e,t,r){return new y.UpdateDesktopMsg(e,t,r)},e.prototype.newLeaveMsg=function(){return new y.LeaveMsg},e.prototype.newLeaveMsg=function(e,t){return new y.LeaveMsg(e,t)},e.prototype.newUpdateRoomStatusMsg=function(){return new y.UpdateRoomStatusMsg},e.prototype.newUpdateRoomStatusMsg=function(e){return new y.UpdateRoomStatusMsg(e)},e.prototype.newPubRoomResourceMsg=function(){return new y.PubRoomResourceMsg},e.prototype.newPubRoomResourceMsg=function(e,t){return new y.PubRoomResourceMsg(e,t)},e.prototype.newUnpubRoomResourceMsg=function(){return new y.UnpubRoomResourceMsg},e.prototype.newUnpubRoomResourceMsg=function(e){return new y.UnpubRoomResourceMsg(e)},e.prototype.newSubRoomResourceMsg=function(){return new y.SubRoomResourceMsg},e.prototype.newSubRoomResourceMsg=function(e,t,r){return new y.SubRoomResourceMsg(e,t,r)},e.prototype.newSubRoomResourceMsg=function(e,t,r,o){return new y.SubRoomResourceMsg(e,t,r,o)},e.prototype.newUnsubRoomResourceMsg=function(){return new y.UnsubRoomResourceMsg},e.prototype.newUnsubRoomResourceMsg=function(e,t,r){return new y.UnsubRoomResourceMsg(e,t,r)},e.prototype.newPubResourceReq=function(){return new y.PubResourceReq},e.prototype.newPubResourceReq=function(e,t){return new y.PubResourceReq(e,t)},e.prototype.newPubResourceRep=function(){return new y.PubResourceRep},e.prototype.newPubResourceRep=function(e,t,r){return new y.PubResourceRep(e,t,r)},e.prototype.newCloseRoomReq=function(){return new y.CloseRoomReq},e.prototype.newCloseRoomReq=function(e,t,r){return new y.CloseRoomReq(e,t,r)},e.prototype.newCloseRoomRep=function(){return new y.CloseRoomRep},e.prototype.newCloseRoomRep=function(e,t,r){return new y.CloseRoomRep(e,t,r)},e.prototype.newUpdateUserName=function(){return new y.UpdateUserName},e.prototype.newUpdateUserName=function(e,t){return new y.UpdateUserName(e,t)},e.prototype.newStartVideoDataMsg=function(){return new y.StartVideoDataMsg},e.prototype.newStartVideoDataMsg=function(e){return new y.StartVideoDataMsg(e)},e.prototype.newStopVideoDataMsg=function(){return new y.StopVideoDataMsg},e.prototype.newStopVideoDataMsg=function(e){return new y.StopVideoDataMsg(e)},e.prototype.newModifyResourceReq=function(){return new y.ModifyResourceReq},e.prototype.newModifyResourceReq=function(e,t,r){return new y.ModifyResourceReq(e,t,r)},e.prototype.newModifyResourceRep=function(){return new y.ModifyResourceRep},e.prototype.newModifyResourceRep=function(e,t,r){return new y.ModifyResourceRep(e,t,r)},e.prototype.newRoomKV=function(){return new y.RoomKV},e.prototype.newRoomKV=function(e,t){return new y.RoomKV(e,t)},e.prototype.newRoomDataInfo=function(){return new y.RoomDataInfo},e.prototype.newRoomDataInfo=function(e,t){return new y.RoomDataInfo(e,t)},e.prototype.newTextMsg=function(){return new y.TextMsg},e.prototype.newTextMsg=function(e,t){return new y.TextMsg(e,t)},e.prototype.newData=function(){return new y.DATA},e.prototype.newData=function(e){return new y.DATA(e)},e.prototype.newUserInfoMsg=function(){return new y.UserInfoMsg},e.prototype.newUserInfoMsg=function(e){return new y.UserInfoMsg(e)},e.prototype.newUserMsg=function(){return new y.UserMsg},e.prototype.newUserMsg=function(e,t,r){return new y.UserMsg(e,t,r)},e.prototype.newUpdateUserRolePriviledgeMsg=function(){return new y.UpdateUserRolePriviledgeMsg},e.prototype.newUpdateUserRolePriviledgeMsg=function(e,t,r){return new y.UpdateUserRolePriviledgeMsg(e,t,r)},e.prototype.newUpdateUserStatusMsg=function(){return new y.UpdateUserStatusMsg},e.prototype.newUpdateUserStatusMsg=function(e,t,r){return new y.UpdateUserStatusMsg(e,t,r)},e.prototype.newUpdateUserRoleMsg=function(){return new y.UpdateUserRoleMsg},e.prototype.newUpdateUserRoleMsg=function(e,t,r){return new y.UpdateUserRoleMsg(e,t,r)},e.prototype.newUserIndiction=function(){return new y.UserIndiction},e.prototype.newUserIndiction=function(e,t,r){return new y.UserIndiction(e,t,r)},e.prototype.newUpdateUserDataMsg=function(){return new y.UpdateUserDataMsg},e.prototype.newUpdateUserDataMsg=function(e,t){return new y.UpdateUserDataMsg(e,t)},e.prototype.newCloseRoomMsg=function(){return new y.CloseRoomMsg},e.prototype.newCloseRoomMsg=function(e,t){return new y.CloseRoomMsg(e,t)},e.prototype.newOfferReq=function(){return new y.OfferReq},e.prototype.newOfferReq=function(e,t,r){return new y.OfferReq(e,t,r)},e.prototype.newOfferRep=function(){return new y.OfferRep},e.prototype.newOfferRep=function(e,t,r,o,n){return new y.OfferRep(e,t,r,o,n)},e.prototype.newCandidateMsg=function(){return new y.CandidateMsg},e.prototype.newCandidateMsg=function(e,t,r,o){return new y.CandidateMsg(e,t,r,o)},e.prototype.newSubRoomResourceReq=function(){return new y.SubRoomResourceReq},e.prototype.newSubRoomResourceReq=function(e,t,r){return new y.SubRoomResourceReq(e,t,r)},e.prototype.newSubRoomResourceRep=function(){return new y.SubRoomResourceRep},e.prototype.newSubRoomResourceRep=function(e,t,r,o){return new y.SubRoomResourceRep(e,t,r,o)},e.prototype.newOpenReq=function(){return new y.OpenReq},e.prototype.newOpenReq=function(e,t,r,o,n,i,a){return new y.OpenReq(e,t,r,o,n,i,a)},e.prototype.newInviteRoomReq=function(){return new y.InviteRoomReq},e.prototype.newInviteRoomReq=function(e,t,r,o){return new y.InviteRoomReq(e,t,r,o)},e.prototype.newInviteRoomReq1=function(){return new y.InviteRoomReq1},e.prototype.newInviteRoomReq1=function(e,t,r,o,n,i,a,s,d,l,u,c){var p=new y.InviteRoomReq1(e,t,r,o,n,i,a,s,d,!0,l);return p.media_connect_type=u,p.crypto_type=c,p},e.prototype.newCandidateMsg1=function(){return new y.CandidateMsg1},e.prototype.newCandidateMsg1=function(e,t,r,o){return new y.CandidateMsg1(e,t,r,o)},e.prototype.newCloseMsg=function(){return new y.CloseMsg},e.prototype.newCloseMsg=function(e){return new y.CloseMsg(e)},e.prototype.newPoint=function(){return new y.Point},e.prototype.newPoint=function(e,t){return new y.Point(e,t)},e.prototype.newcolor=function(){return new y.color},e.prototype.newcolor=function(e,t,r,o){return new y.color(e,t,r,o)},e.prototype.newRect=function(){return new y.Rect},e.prototype.newRect=function(e,t,r,o){return new y.Rect(e,t,r,o)},e.prototype.newAnnotationObject=function(){return new y.AnnotationObject},e.prototype.newAnnotationObject=function(e,t,r,o,n,i,a,s,d,l){return new y.AnnotationObject(e,t,r,o,n,i,a,s,d,l)},e.prototype.newAnnotation2Point=function(){return new y.Annotation2Point},e.prototype.newAnnotation2Point=function(e,t,r){return new y.Annotation2Point(e,t,r)},e.prototype.newAnnotationMultiPoint=function(){return new y.AnnotationMultiPoint},e.prototype.newAnnotationMultiPoint=function(e,t){return new y.AnnotationMultiPoint(e,t)},e.prototype.newAnnotationList=function(){return new y.AnnotationList},e.prototype.newAnnotationList=function(e,t){return new y.AnnotationList(e,t)},e.prototype.newUpdateAnnotationMsg=function(e,t,r,o,n,i,a,s,d){return new y.UpdateAnnotationMsg(e,t,r,o,n,i,a,s,d)},e.prototype.newAnnotationMsg=function(){return new y.AnnotationMsg},e.prototype.newAnnotationMsg=function(e,t){return new y.AnnotationMsg(e,t)},e.prototype.newBoardObject=function(){return new y.BoardObject},e.prototype.newBoardObject=function(e,t,r,o,n,i,a,s,d,l,u){return new y.BoardObject(e,t,r,o,n,i,a,s,d,l,u)},e.prototype.newUpdateBoardMsg=function(){return new y.UpdateBoardMsg},e.prototype.newUpdateBoardMsg=function(e,t,r,o,n){return new y.UpdateBoardMsg(e,t,r,o,n)},e.prototype.newBoardsInfoMsg=function(){return new y.BoardsInfoMsg},e.prototype.newBoardsInfoMsg=function(e){return new y.BoardsInfoMsg(e)},e.prototype.newBindAudioToVideoReq=function(e,t,r){return new y.BindAudioToVideoReq(e,t,r)},e.prototype.serverVersionCompatible=function(e){var t=new ArrayBuffer(10),r=new Int8Array(t);r[0]=88,r[1]="3".charCodeAt(),r[2]="t".charCodeAt(),r[3]="e".charCodeAt(),r[4]="e".charCodeAt(),r[5]="a".charCodeAt(),r[6]="v".charCodeAt(),r[7]="d".charCodeAt(),r[8]=2,r[9]=1;for(var o=new Int8Array(e),n=10+o.length,i=new ArrayBuffer(n),a=new Int8Array(i),s=0;s<10;s++)a[s]=r[s];for(var d=0;d<o.length;d++){a[d+10]=o[d]}return i},e.prototype.encodedPacket=function(e,t,r,o,n){var i=y.Packet,a=null;n&&(a=n.toArrayBuffer());var s=new i(e,t,r,o,a).toArrayBuffer();return e==this.getRoomPduTypeEnum().OPEN_REQ&&(s=this.serverVersionCompatible(s)),s},e.prototype.decodePacket=function(e){return y.Packet.decode(e)},e.prototype.decodeUserMsg=function(e){return y.UserMsg.decode(e)},e.prototype.decodeAnnotationMultiPoint=function(e){return y.AnnotationMultiPoint.decode(e)},e.prototype.decodeAnnotation2Point=function(e){return y.Annotation2Point.decode(e)},e.prototype.decodeAnnotationList=function(e){return y.AnnotationList.decode(e)},e.prototype.decodeOutgoingVideoInfo=function(e){return y.OutgoingVideoInfo.decode(e)},e.prototype.newOutgoingCreateStreamsExporterReq=function(){return new y.OutgoingCreateStreamsExporterReq},e.prototype.newOutgoingCreateStreamsExporterReq=function(e,t,r,o,n,i,a,s,d,l,u,c,p,h,f,m,g,v){return new y.OutgoingCreateStreamsExporterReq(e,t,r,o,n,i,a,s,d,l,u,c,p,h,f,m,g,v)},e.prototype.newOutgoingSelectStreamReq=function(){return new y.OutgoingSelectStreamReq},e.prototype.newOutgoingSelectStreamReq=function(e,t,r,o,n,i,a,s){return new y.OutgoingSelectStreamReq(e,t,r,o,n,i,a,s)},e.prototype.newOutgoingMixStreamsReq=function(){return new y.OutgoingMixStreamsReq},e.prototype.newOutgoingMixStreamsReq=function(e,t,r,o,n,i,a){return new y.OutgoingMixStreamsReq(e,t,r,o,n,i,a)},e.prototype.newOutgoingVideoInfo=function(){return new y.OutgoingVideoInfo},e.prototype.newOutgoingVideoInfo=function(e,t,r,o,n,i,a,s){return new y.OutgoingVideoInfo(e,t,r,o,n,i,a,s)},e.prototype.newOutgoingDestroyExporterReq=function(){return new y.OutgoingDestroyExporterReq},e.prototype.newOutgoingDestroyExporterReq=function(e,t,r,o){return new y.OutgoingDestroyExporterReq(e,t,r,o)},e.prototype.newOutgoingPauseResumeExporterReq=function(){return new y.OutgoingPauseResumeExporterReq},e.prototype.newOutgoingPauseResumeExporterReq=function(e,t,r,o,n){return new y.OutgoingPauseResumeExporterReq(e,t,r,o,n)},e.prototype.newRoomControl=function(e,t){return new y.RoomControl(e,t)},e.prototype.newRoomAvcControl=function(e,t){return new y.RoomAvcControl(e,t)},e.prototype.newRoomSetStreamNameReq=function(e,t,r,o,n){return new y.RoomSetStreamNameReq(e,t,r,o,n)},e.prototype.newOutgoingExporterSetFocusVideoReq=function(e,t,r,o,n){return new y.OutgoingExporterSetFocusVideoReq(e,t,r,o,n)},e.prototype.newOutgoingGetExporterInfoReq=function(e,t,r,o){return new y.OutgoingGetExporterInfoReq(e,t,r,o)},e.prototype.decodeBody=function(e){var t=y.RoomPduType,r=y.Packet.decode(e),o=r.type;if(o==t.OPEN_REP)return y.OpenRep.decode(r.body);if(o==t.INVITE_ROOM_REP1)return y.InviteRoomRep1.decode(r.body);if(o==t.ROOM_RESOURCE_INFOS)return y.RoomResourceInfos.decode(r.body);if(o==t.CANDIDATE_MSG1)return y.CandidateMsg1.decode(r.body);if(o==t.ICE_RESTART_MSG)return y.IceRestartMsg.decode(r.body);if(o==t.PUB_RESOURCE_REP)return y.PubResourceRep.decode(r.body);if(o==t.PRIVATE_TEXT_MSG)return y.TextMsg.decode(r.body);if(o==t.PUBLIC_TEXT_MSG)return y.TextMsg.decode(r.body);if(o==t.PRIVATE_DATA)return e=y.DATA.decode(r.body);if(o==t.PUBLIC_DATA)return e=y.DATA.decode(r.body);if(o==t.ROOM_DATA_INFO)return y.RoomDataInfo.decode(r.body);if(o==t.UPDATE_USER_DATA_MSG)return y.UpdateUserDataMsg.decode(r.body);if(o!=t.USER_INFO_MSG)return o==t.USER_MSG?y.UserMsg.decode(r.body):o==t.USER_INDICTION?y.UserIndiction.decode(r.body):o==t.UPDATA_USER_ROLE_PRIVILEDGE_MSG?y.UpdateUserRolePriviledgeMsg.decode(r.body):o==t.ADD_WEBCAM_MSG?y.AddWebcamMsg.decode(r.body):o==t.ADD_SPEAKER_MSG?y.AddSpeakerMsg.decode(r.body):o==t.ADD_DESKTOP_MSG?y.AddDesktopMsg.decode(r.body):o==t.REMOVE_WEBCAM_MSG?y.RemoveWebcamMsg.decode(r.body):o==t.REMOVE_SPEAKER_MSG?y.RemoveSpeakerMsg.decode(r.body):o==t.UPDATE_SPEAKER_MSG?y.UpdateSpeakerMsg.decode(r.body):o==t.UPDATE_WEBCAM_MSG?y.UpdateWebcamMsg.decode(r.body):o==t.UPDATE_DESKTOP_MSG?y.UpdateDesktopMsg.decode(r.body):o==t.PUB_ROOM_RESOURCE_MSG?y.PubRoomResourceMsg.decode(r.body):o==t.PUB_ROOM_RESOURCE_MSG_REP?y.PubRoomResourceMsgRep.decode(r.body):o==t.SUB_ROOM_RESOURCE_MSG_REP?y.SubRoomResourceMsgRep.decode(r.body):o==t.UNPUB_ROOM_RESOURCE_MSG?y.UnpubRoomResourceMsg.decode(r.body):o==t.UNSUB_ROOM_RESOURCE_MSG_REP?y.UnsubRoomResourceMsgRep.decode(r.body):o==t.PUB_VIDEO_REQ||o==t.PUB_AUDIO_REQ?y.PubResourceReq.decode(r.body):o==t.PUB_VIDEO_REP||o==t.PUB_AUDIO_REP?y.PubResourceRep.decode(r.body):o==t.VIDEO_INDICTION?y.ResourceIndiction.decode(r.body):o==t.AUDIO_INDICTION?y.ResourceIndiction.decode(r.body):o==t.OFFER_REQ?y.OfferReq.decode(r.body):o==t.OFFER_REP?y.OfferRep.decode(r.body):o==t.CANDIDATE_MSG?y.CandidateMsg.decode(r.body):o==t.SUB_ROOM_RESOURCE_REQ?y.SubRoomResourceReq.decode(r.body):o==t.SUB_ROOM_RESOURCE_REP?y.SubRoomResourceRep.decode(r.body):o==t.SUB_ROOM_RESOURCE_MSG?y.SubRoomResourceMsg.decode(r.body):o==t.UNSUB_ROOM_RESOURCE_MSG?y.UnsubRoomResourceMsg.decode(r.body):o==t.CLOSE_ROOM_REP?y.CloseRoomRep.decode(r.body):o==t.CLOSE_ROOM_MSG?y.CloseRoomMsg.decode(r.body):o==t.UPDATE_USER_NAME?y.UpdateUserName.decode(r.body):o==t.START_VIDEO_DATA_MSG?y.StartVideoDataMsg.decode(r.body):o==t.STOP_VIDEO_DATA_MSG?y.StopVideoDataMsg.decode(r.body):o==t.MODIFY_RESOURCE_REQ?y.ModifyResourceReq.decode(r.body):o==t.MODIFY_RESOURCE_REP?y.ModifyResourceRep.decode(r.body):o==t.UPDATE_BOARD_MSG?y.UpdateBoardMsg.decode(r.body):o==t.BOARDS_INFO_PDU?y.BoardsInfoMsg.decode(r.body):o==t.UPDATE_ANNOTATION_MSG?y.UpdateAnnotationMsg.decode(r.body):o==t.BIND_AUDIO_TO_VIDEO_REP?y.BindAudioToVideoRep.decode(r.body):o==t.OUTGOING_CREATE_STREAMS_EXPORTER_REP?y.OutgoingCreateStreamsExporterRep.decode(r.body):o==t.OUTGOING_SELECT_STREAM_REP?y.OutgoingSelectStreamRep.decode(r.body):o==t.OUTGOING_MIX_STREAMS_REP?y.OutgoingMixStreamsRep.decode(r.body):o==t.OUTGOING_DESTROY_EXPORTER_REP?y.OutgoingDestroyExporterRep.decode(r.body):o==t.OUTGOING_PAUSE_RESUME_EXPORTER_REP?y.OutgoingPauseResumeExporterRep.decode(r.body):o==t.OUTGOING_EXPORTER_ERROR_NOTIFY?y.OutgoingExporterErrorNotify.decode(r.body):o==t.OUTGOING_INVITE_STATUS_NOTIFY?y.OutgoingInviteStatusNotify.decode(r.body):o==t.ROOM_ATTRIBUTE_CHANGE_NOTIFY?y.RoomAttributeChangeNotify.decode(r.body):o==t.ROOM_START_AVC_MIXER_MEDIA_REP?y.RoomAvcControlRep.decode(r.body):o==t.ROOM_SET_STREAM_NAME_RSP?y.RoomSetStreamNameRsp.decode(r.body):o==t.ROOM_STREAM_NAME_CHANGED_NOTIFY?y.RoomStreamNameChangedNotify.decode(r.body):o==t.OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP?y.OutgoingExporterSetFocusVideoRsp.decode(r.body):o==t.OUTGOING_GET_EXPORTER_INFO_RSP?y.OutgoingGetExporterInfoRsp.decode(r.body):o==t.USER_STREAM_ACTIVE?y.UserStreamActive.decode(r.body):o==t.MEDIA_PLAY_EVENT_NOTIFY?y.MediaPlayEventNotify.decode(r.body):o==t.STREAM_KEEP_ALIVE_TIMEOUT_NOTIFY?y.StreamKeepAliveTimeoutNotify.decode(r.body):void 0;var n=y.UserInfoMsg;return r.body?n.decode(r.body):null},e});var connectionQualityValues={98:"18px",81:"15px",64:"11px",47:"7px",30:"3px",0:"0px"},trackId2audioConnection={},trackId2videoConnection={},trackId2devicePacketsLost={},roomConnectionStats={bytesSentPrev:0,bytesReceivedPrev:0,packetsSentPrev:0,packetsReceivedPrev:0,timestampPrev:null},roomPacketsLostConnectionStats={uploadPacketsLost:0,downloadPacketsLost:0,uploadPacket:0,downloadPacket:0,timestampPrev:null},ssrc2deviceStats={},ssrc2devicePacketsLostStats={},connectionIndicator={room:{localAddress:"",localPort:0,localProtocol:"",remoteAddress:"",remotePort:0,remoteProtocol:"",uploadBitrate:0,downloadBitrate:0,uploadPacket:0,downloadPacket:0,uploadPacketLost:0,downloadPacketLost:0,uploadPacketLossRate:0,downloadPacketLossRate:0},getRoomConnection:function(){return connectionIndicator.room},getVideoConnection:function(e,t){var r=room.getUser(e);if(r){var o=r.getVideo(t);if(o&&o.track){var n=o.track.id,i=trackId2videoConnection[n],a=trackId2devicePacketsLost[n];return a||(a=0),i&&(i.packetsLost=a),i}}},getAudioConnection:function(e){var t=room.getUser(e);if(t&&t.audio&&t.audio.track){var r=t.audio.track.id,o=trackId2audioConnection[r],n=trackId2devicePacketsLost[r];return n||(n=0),o&&(o.packetsLost=n),o}},getScreenConnection:function(e){var t=room.getUser(e);if(t&&t.screen&&t.screen.track){var r=t.screen.track.id,o=trackId2videoConnection[r],n=trackId2devicePacketsLost[r];return n||(n=0),o&&(o.packetsLost=n),o}}};function ConnectionInfoCollector(e,t){this.peerconnection=e,this.statsInterval=t,this.statsIntervalId=null}function setRoomStats(e,t){var r,o,n,i,a=t.timestamp;if(!room.avdEngine.isFirefox&&"transport"===t.type){var s=t.bytesSent,d=t.bytesReceived,l=t.packetsSent,u=t.packetsReceived;if(roomConnectionStats.timestampPrev&&(s&&(r=8*(s-roomConnectionStats.bytesSentPrev)/(a-roomConnectionStats.timestampPrev),r=Math.floor(r)),d&&(o=8*(d-roomConnectionStats.bytesReceivedPrev)/(a-roomConnectionStats.timestampPrev),o=Math.floor(o)),l&&(n=(l-roomConnectionStats.packetsSentPrev)/((a-roomConnectionStats.timestampPrev)/1e3),n=Math.floor(n)),u&&(i=(u-roomConnectionStats.packetsReceivedPrev)/((a-roomConnectionStats.timestampPrev)/1e3),i=Math.floor(i))),roomConnectionStats.bytesSentPrev=s,roomConnectionStats.bytesReceivedPrev=d,roomConnectionStats.packetsSentPrev=l,roomConnectionStats.packetsReceivedPrev=u,roomConnectionStats.timestampPrev=a,activeCandidatePair=e.get(t.selectedCandidatePairId),activeCandidatePair&&activeCandidatePair.localCandidateId)(c=e.get(activeCandidatePair.localCandidateId))&&(c.address&&(connectionIndicator.room.localAddress=c.address),c.ip&&(connectionIndicator.room.localAddress=c.ip),c.ipAddress&&(connectionIndicator.room.localAddress=c.ipAddress),c.port&&(connectionIndicator.room.localPort=c.port),c.portNumber&&(connectionIndicator.room.localPort=c.portNumber),c.protocol&&(connectionIndicator.room.localProtocol=c.protocol));if(activeCandidatePair&&activeCandidatePair.remoteCandidateId)(p=e.get(activeCandidatePair.remoteCandidateId))&&(p.address&&(connectionIndicator.room.remoteAddress=p.address),p.ip&&(connectionIndicator.room.remoteAddress=p.ip),p.ipAddress&&(connectionIndicator.room.remoteAddress=p.ipAddress),p.port&&(connectionIndicator.room.remotePort=p.port),p.portNumber&&(connectionIndicator.room.remotePort=p.portNumber),p.port&&(connectionIndicator.room.remoteProtocol=p.protocol));void 0!==r?r+="Kbps":r="--Kbps",connectionIndicator.room.uploadBitrate=r,void 0!==o?o+="Kbps":o="--Kbps",connectionIndicator.room.downloadBitrate=o,connectionIndicator.room.uploadPacket=void 0!==n?n:"0",connectionIndicator.room.downloadPacket=void 0!==i?i:"0"}if(room.avdEngine.isFirefox&&"candidate-pair"===t.type&&t.nominated&&t.selected){var c,p;s=t.bytesSent,d=t.bytesReceived;roomConnectionStats.timestampPrev&&(s&&(r=8*(s-roomConnectionStats.bytesSentPrev)/(a-roomConnectionStats.timestampPrev),r=Math.floor(r)),d&&(o=8*(d-roomConnectionStats.bytesReceivedPrev)/(a-roomConnectionStats.timestampPrev),o=Math.floor(o))),roomConnectionStats.bytesSentPrev=s,roomConnectionStats.bytesReceivedPrev=d,roomConnectionStats.timestampPrev=a,(c=e.get(t.localCandidateId))&&(c.address&&(connectionIndicator.room.localAddress=c.address),c.port&&(connectionIndicator.room.localPort=c.port),c.protocol&&(connectionIndicator.room.localProtocol=c.protocol)),(p=e.get(t.remoteCandidateId))&&(p.address&&(connectionIndicator.room.remoteAddress=p.address),p.port&&(connectionIndicator.room.remotePort=p.port),p.port&&(connectionIndicator.room.remoteProtocol=p.protocol)),void 0!==r?r+="Kbps":r="--Kbps",connectionIndicator.room.uploadBitrate=r,void 0!==o?o+="Kbps":o="--Kbps",connectionIndicator.room.downloadBitrate=o,connectionIndicator.room.uploadPacket=void 0!==n?n:"--",connectionIndicator.room.downloadPacket=void 0!==i?i:"--"}}function setDeviceStat(e,t){var r,o,n,i,a,s=t.timestamp;if(!room.avdEngine.isFirefox&&("outbound-rtp"===t.type||"inbound-rtp"===t.type)){var d,l=t.ssrc,u=t.bytesSent,c=t.bytesReceived,p=t.packetsSent,h=t.packetsReceived;if(room.avdEngine.isSafari&&(p&&(p=Math.abs(p)),h&&(h=Math.abs(h))),"inbound-rtp"===t.type&&room.avdEngine.isChrome&&room.avdEngine.majorVersion<86)(w=e.get(t.trackId))&&(d=w.framesReceived);if(room.avdEngine.isSafari)(w=e.get(t.trackId))&&("inbound-rtp"===t.type?d=w.framesReceived:"outbound-rtp"===t.type&&(d=w.framesSent));var f=ssrc2deviceStats[l];if(f&&f.timestampPrev&&(u&&(r=8*(u-f.bytesSentPrev)/(s-f.timestampPrev),r=Math.floor(r)),c&&(o=8*(c-f.bytesReceivedPrev)/(s-f.timestampPrev),o=Math.floor(o)),p&&(n=(p-f.packetsSentPrev)/((s-f.timestampPrev)/1e3),n=Math.floor(n)),h&&(i=(h-f.packetsReceivedPrev)/((s-f.timestampPrev)/1e3),i=Math.floor(i)),d&&d>f.framesReceivedPrev&&(a=(d-f.framesReceivedPrev)/((s-f.timestampPrev)/1e3),a=Math.floor(a))),f)f.bytesSentPrev=u,f.bytesReceivedPrev=c,f.packetsSentPrev=p,f.packetsReceivedPrev=h,f.trackIdPrev=t.trackId,f.framesReceivedPrev=d,f.timestampPrev=s;else{var m={};m.bytesSentPrev=u,m.bytesReceivedPrev=c,m.packetsSentPrev=p,m.timestampPrev=s,m.trackIdPrev=t.trackId,m.framesReceivedPrev=d,ssrc2deviceStats[l]=m}var g,v,y,b={};if(b.ssrc=l,"outbound-rtp"===t.type){if(room.avdEngine.isChrome&&83<=room.avdEngine.majorVersion)g=t.frameWidth,v=t.frameHeight,y=t.framesPerSecond;else if(room.avdEngine.isChrome&&room.avdEngine.majorVersion<83){var _=e.get(t.mediaSourceId);_&&_.width&&(g=_.width),_&&_.height&&(v=_.height),_&&_.framesPerSecond&&(y=_.framesPerSecond)}}else if("inbound-rtp"===t.type)if(room.avdEngine.isChrome&&86<=room.avdEngine.majorVersion)g=t.frameWidth,v=t.frameHeight,y=t.framesPerSecond;else if(room.avdEngine.isChrome&&room.avdEngine.majorVersion<86){var w;(w=e.get(t.trackId))&&w.frameWidth&&(g=w.frameWidth),w&&w.frameHeight&&(v=w.frameHeight),a&&(y=a)}if(room.avdEngine.isSafari)(w=e.get(t.trackId))&&w.frameWidth&&(g=w.frameWidth),w&&w.frameHeight&&(v=w.frameHeight),a&&(y=a);g&&(b.resolution=g+"X"+v,b.resolutionWidth=g),v&&(b.resolutionHeight=v),b.frameRate=void 0!==y?y+"fps":"--fps",b.uploadBitrate=void 0!==r?r+"Kbps":"--Kbps",b.downloadBitrate=void 0!==o?o+"Kbps":"--Kbps",b.uploadPacket=void 0!==n?n:"0",b.downloadPacket=void 0!==i?i:"0";var S=e.get(t.codecId);if(S){var E=S.payloadType,I=S.mimeType,T=S.clockRate;b.payloadType=E,b.mimeType=I,b.clockRate=T}var R=e.get(t.trackId);if(R){var C=R.trackIdentifier;b.trackId=C,(0<r||0<o)&&("video"===t.mediaType?trackId2videoConnection[C]=b:"audio"===t.mediaType&&(trackId2audioConnection[C]=b))}}room.avdEngine.isFirefox}function setDevicePacketsLost(e,t){var r=0,o=t.timestamp;if("remote-inbound-rtp"===t.type||"remote-outbound-rtp"===t.type){var n=t.ssrc,i=t.packetsLost,a=ssrc2devicePacketsLostStats[n];if(a&&a.timestampPrev)if(i){var s=i-a.packetsLostPrev,d=o-a.timestampPrev;r=0<d&&0<s?(r=s/(d/1e3),Math.floor(r)):0}else r=0;if(a)a.packetsLostPrev=i,a.timestampPrev=o;else{var l={};l.packetsLostPrev=i,l.timestampPrev=o,ssrc2devicePacketsLostStats[n]=l}var u=ssrc2deviceStats[n];if(u){var c=u.trackIdPrev;if(c){var p=e.get(c);if(p){var h=p.trackIdentifier;trackId2devicePacketsLost[h]=r}}}}}function ConnectionStatistics(e){this.peerconnection=e,this.getPeerStatusTimer=null,this.trace_id=connectionStatisticsConfig.trace_id?connectionStatisticsConfig.trace_id:"",this.samplingRate=connectionStatisticsConfig.sampling_rate?connectionStatisticsConfig.sampling_rate:3,this.logHttpServerAddr=connectionStatisticsConfig.http_server_addr,this.logHttpsServerAddr=connectionStatisticsConfig.https_server_addr,this.sendRate=1,this.app_id=connectionStatisticsConfig.app_id?connectionStatisticsConfig.app_id:"jh",this.user_agent=navigator.userAgent,this.client_type=1,this.ssrc2number={},this.report_mode=connectionStatisticsConfig.report_mode?connectionStatisticsConfig.report_mode:0,this.myDB={name:"3teeDB",version:1,db:null},this.url="";var t=document.location.protocol;"http:"==t?this.url=this.logHttpServerAddr:"https:"!=t&&"httpsionic:"!=t||(this.url=this.logHttpsServerAddr),this.sendVideoMap={bytesSent:"bytesSent",codecImplementationName:"codecImplementationName",framesEncoded:"framesEncoded",mediaType:"mediaType",packetsLost:"packetsLost",packetsSent:"packetsSent",qpSum:"qpSum",ssrc:"ssrc",transportId:"transportId",googAdaptationChanges:"googAdaptationChanges",googAvgEncodeMs:"googAvgEncodeMs",googBandwidthLimitedResolution:"googBandwidthLimitedResolution",googCodecName:"googCodecName",googContentType:"googContentType",googCpuLimitedResolution:"googCpuLimitedResolution",googEncodeUsagePercent:"googEncodeUsagePercent",googFirsReceived:"googFirsReceived",googFrameHeightSent:"googFrameHeightSent",googFrameRateInput:"googFrameRateInput",googFrameRateSent:"googFrameRateSent",googFrameWidthSent:"googFrameWidthSent",googHasEnteredLowResolution:"googHasEnteredLowResolution",hugeFramesSent:"hugeFramesSent",googNacksReceived:"googNacksReceived",googPlisReceived:"googPlisReceived",googRtt:"googRtt",googTrackId:"googTrackId"},this.recvVideoMap={bytesReceived:"bytesReceived",codecImplementationName:"codecImplementationName",framesDecoded:"framesDecoded",mediaType:"mediaType",packetsLost:"packetsLost",packetsReceived:"packetsReceived",qpSum:"qpSum",ssrc:"ssrc",transportId:"transportId",googCaptureStartNtpTimeMs:"googCaptureStartNtpTimeMs",googCodecName:"googCodecName",googContentType:"googContentType",googCurrentDelayMs:"googCurrentDelayMs",googDecodeMs:"googDecodeMs",googFirsSent:"googFirsSent",googFrameHeightReceived:"googFrameHeightReceived",googFrameRateDecoded:"googFrameRateDecoded",googFrameRateOutput:"googFrameRateOutput",googFrameRateReceived:"googFrameRateReceived",googFrameWidthReceived:"googFrameWidthReceived",googInterframeDelayMax:"googInterframeDelayMax",googJitterBufferMs:"googJitterBufferMs",googMaxDecodeMs:"googMaxDecodeMs",googMinPlayoutDelayMs:"googMinPlayoutDelayMs",googNacksSent:"googNacksSent",googPlisSent:"googPlisSent",googRenderDelayMs:"googRenderDelayMs",googTargetDelayMs:"googTargetDelayMs",googTrackId:"googTrackId"},this.sendAudioMap={audioInputLevel:"audioInputLevel",bytesSent:"bytesSent",mediaType:"mediaType",packetsSent:"packetsSent",ssrc:"ssrc",totalAudioEnergy:"totalAudioEnergy",totalSamplesDuration:"totalSamplesDuration",transportId:"transportId",googCodecName:"googCodecName",googTrackId:"googTrackId",googTypingNoiseState:"googTypingNoiseState"},this.recvAudioMap={audioOutputLevel:"audioOutputLevel",bytesReceived:"bytesReceived",mediaType:"mediaType",packetsLost:"packetsLost",packetsReceived:"packetsReceived",ssrc:"ssrc",totalAudioEnergy:"totalAudioEnergy",totalSamplesDuration:"totalSamplesDuration",transportId:"transportId",googAccelerateRate:"googAccelerateRate",googCodecName:"googCodecName",googCurrentDelayMs:"googCurrentDelayMs",googDecodingCNG:"googDecodingCNG",googDecodingCTN:"googDecodingCTN",googDecodingCTSG:"googDecodingCTSG",googDecodingMuted:"googDecodingMuted",googDecodingNormal:"googDecodingNormal",googDecodingPLC:"googDecodingPLC",googDecodingPLCCNG:"googDecodingPLCCNG",googExpandRate:"googExpandRate",googJitterBufferMs:"googJitterBufferMs",googJitterReceived:"googJitterReceived",googPreemptiveExpandRate:"googPreemptiveExpandRate",googPreferredJitterBufferMs:"googPreferredJitterBufferMs",googSecondaryDecodedRate:"googSecondaryDecodedRate",googSecondaryDiscardedRate:"googSecondaryDiscardedRate",googSpeechExpandRate:"googSpeechExpandRate",googTrackId:"googTrackId"},this.candidateMap={googActiveConnection:"googActiveConnection",bytesReceived:"bytesReceived",bytesSent:"bytesSent",packetsSent:"packetSent",googReadable:"googReadable",requestsSent:"requestSent",consentRequestsSent:"consentRequestsSent",responsesSent:"responsesSent",requestsReceived:"requestsReceived",responsesReceived:"responsesReceived",googLocalAddress:"googLocalAddress",localCandidateId:"localCandidateId",googLocalCandidateType:"googLocalCandidateType",googRemoteAddress:"googRemoteAddress",remoteCandidateId:"remoteCandidateId",googRemoteCandidateType:"googRemoteCandidateType",googRtt:"googRtt",packetsDiscardedOnSend:"packetsDiscardedOnSend",googTransportType:"googTransportType",googWritable:"googWritable"}}function AudioLevel(){this.audioLevelsIntervalId=null}ConnectionInfoCollector.prototype.start=function(e){var t=this;e&&(this.statsInterval=e),this.statsIntervalId=setInterval(function(){"closed"!=t.peerconnection.iceConnectionState&&t.peerconnection.getStats(null).then(function(e){t.dumpStats(e)},t.errorCallback)},this.statsInterval)},ConnectionInfoCollector.prototype.dumpStats=function(n){var i=0,a=0,s=0,d=0;if(n.forEach(function(e){if(setRoomStats(n,e),setDeviceStat(n,e),setDevicePacketsLost(n,e),!room.avdEngine.isFirefox){var t,r,o;if("transport"===e.type&&(i=e.packetsSent,a=e.packetsReceived),"remote-inbound-rtp"===e.type)if(t=ssrc2deviceStats[e.ssrc])if(r=t.trackIdPrev)(o=n.get(r))&&!o.ended&&(s+=e.packetsLost);if("remote-outbound-rtp"===e.type)if(t=ssrc2deviceStats[e.ssrc])if(r=t.trackIdPrev)(o=n.get(r))&&!o.ended&&(d+=e.packetsLost)}}),!room.avdEngine.isFirefox){var e=new Date;if(roomPacketsLostConnectionStats.timestampPrev){var t=s-roomPacketsLostConnectionStats.uploadPacketsLost,r=d-roomPacketsLostConnectionStats.downloadPacketsLost,o=i-roomPacketsLostConnectionStats.uploadPacket,l=a-roomPacketsLostConnectionStats.downloadPacket,u=Math.round(t/o*100),c=Math.round(r/l*100);connectionIndicator.room.uploadPacketLost=t,connectionIndicator.room.downloadPacketLost=r,connectionIndicator.room.uploadPacketLossRate=u?u+"%":"0%",connectionIndicator.room.downloadPacketLossRate=c?c+"%":"0%",roomPacketsLostConnectionStats.uploadPacketsLost=s,roomPacketsLostConnectionStats.downloadPacketsLost=d,roomPacketsLostConnectionStats.uploadPacket=i,roomPacketsLostConnectionStats.downloadPacket=a,roomPacketsLostConnectionStats.timestampPrev=e}else roomPacketsLostConnectionStats.uploadPacketsLost=s,roomPacketsLostConnectionStats.downloadPacketsLost=d,roomPacketsLostConnectionStats.uploadPacket=i,roomPacketsLostConnectionStats.downloadPacket=a,roomPacketsLostConnectionStats.timestampPrev=e,connectionIndicator.room.uploadPacketLost=0,connectionIndicator.room.downloadPacketLost=0,connectionIndicator.room.uploadPacketLossRate="0%",connectionIndicator.room.downloadPacketLossRate="0%"}room.avdEngine.isFirefox&&(connectionIndicator.room.uploadPacketLost="--",connectionIndicator.room.downloadPacketLost="--",connectionIndicator.room.uploadPacketLossRate="--%",connectionIndicator.room.downloadPacketLossRate="--%"),null!=room?room.eventEmitter.emit(RoomCallback.connection_indicator,connectionIndicator):this.stop()},ConnectionInfoCollector.prototype.errorCallback=function(e){log.error("===ConnectionInfoCollector(),getStats().errorCallback().error:",e),this.stop()},ConnectionInfoCollector.prototype.stop=function(){this.statsIntervalId&&(clearInterval(this.statsIntervalId),this.statsIntervalId=null)},ConnectionStatistics.prototype.start2Log=function(o){var e=this;o=o||5;var n=0,i=0;clearInterval(e.getPeerStatusTimer),e.getPeerStatusTimer=setInterval(function(){e.getPeerStatus().then(function(e){e.forEach(function(e){switch(e.event_type){case connectionEventTypeEnum.sendVideo:log.info("stream sendVideo device_id:"+e.device_id+" [ "+e.googCodecName+" "+e.googFrameWidthSent+"x"+e.googFrameHeightSent+" "+e.googFrameRateInput+" ] ");break;case connectionEventTypeEnum.recvVideo:log.info("stream recvVideo device_id:"+e.device_id+" [ "+e.googCodecName+" "+e.googFrameWidthReceived+"x"+e.googFrameHeightReceived+" "+e.googFrameRateOutput+" ] ");break;case connectionEventTypeEnum.sendAudio:log.info("stream sendAudio device_id:"+e.device_id+" [ "+e.googCodecName+" "+e.audioInputLevel+" ] ");break;case connectionEventTypeEnum.recvAudio:log.info("stream recvAudio device_id:"+e.device_id+" [ "+e.googCodecName+" "+e.audioOutputLevel+" ] ");break;case connectionEventTypeEnum.conndidate:var t=parseInt((e.bytesSent-n)/o),r=parseInt((e.bytesReceived-i)/o);log.info("room ["+e.googTransportType+" "+e.googLocalAddress+" -> "+e.googRemoteAddress+" ] [ "+t+","+r+" ] "),n=parseInt(e.bytesSent),i=parseInt(e.bytesReceived)}})})},1e3*o)},ConnectionStatistics.prototype.start=function(){var t=this;if(log.debug("===ConnectionStatistics.start(),url:"+t.url),t.url){var r=1,o=[];t.openDB(),clearInterval(t.getPeerStatusTimer),t.getPeerStatusTimer=setInterval(function(){t.getPeerStatus().then(function(e){o=o.concat(e),r==t.sendRate&&(t.sendData(o),o=[],r=0),r++})},1e3*t.samplingRate)}},ConnectionStatistics.prototype.stop=function(){clearInterval(this.getPeerStatusTimer)},ConnectionStatistics.prototype.sendData=function(e){var t={data:{trace_id:this.trace_id,app_id:this.app_id,user_id:room.selfUser.id,user_name:room.selfUser.name,room_id:room.id,user_agent:this.user_agent,client_type:this.client_type,data_infos:e}};0==parseInt(this.report_mode)?this.fetchPost(this.url,t).then(function(e){}).catch(function(e){}):this.addData(t)},ConnectionStatistics.prototype.getPeerStatus=function(){var t=when.defer(),o=this,n=[];return o.peerconnection.getStats(function(e){e.result().forEach(function(e){var t={};if(t.timestamp=Date.parse(e.timestamp),"ssrc"==e.type){if(o.ssrc2number[e.stat("ssrc")]?o.ssrc2number[e.stat("ssrc")]++:o.ssrc2number[e.stat("ssrc")]=1,t.seq_num=o.ssrc2number[e.stat("ssrc")],room.videoSsrc2user[e.stat("ssrc")]&&room.videoSsrc2user[e.stat("ssrc")].id==room.selfUser.id){for(var r in t.event_type=connectionEventTypeEnum.sendVideo,t.device_id=room.videoSsrc2deviceId[e.stat("ssrc")],o.sendVideoMap)t[r]=e.stat(r);n.push(t)}else if(room.videoSsrc2user[e.stat("ssrc")]&&room.videoSsrc2user[e.stat("ssrc")].id!=room.selfUser.id){for(var r in t.event_type=connectionEventTypeEnum.recvVideo,t.device_id=room.videoSsrc2deviceId[e.stat("ssrc")],o.recvVideoMap)t[r]=e.stat(r);n.push(t)}else if(room.audioSsrc2user[e.stat("ssrc")]&&room.audioSsrc2user[e.stat("ssrc")].id==room.selfUser.id){for(var r in t.event_type=connectionEventTypeEnum.sendAudio,t.device_id=room.audioSsrc2user[e.stat("ssrc")].audio.id,o.sendAudioMap)t[r]=e.stat(r);n.push(t)}else if(room.audioSsrc2user[e.stat("ssrc")]&&room.audioSsrc2user[e.stat("ssrc")].id!=room.selfUser.id){for(var r in t.event_type=connectionEventTypeEnum.recvAudio,t.device_id=room.audioSsrc2user[e.stat("ssrc")].audio.id,o.recvAudioMap)t[r]=e.stat(r);n.push(t)}}else if("googCandidatePair"==e.type&&"true"==e.stat("googActiveConnection")){for(var r in t.event_type=connectionEventTypeEnum.conndidate,o.candidateMap)t[r]=e.stat(r);n.push(t)}}),t.resolve(n)}),t.promise},ConnectionStatistics.prototype.fetchPost=function(e,t){return new Promise(function(r,o){axios.post(e,t,{headers:{"Content-Type":"application/json"}}).then(function(e){if(0===e.data.ret)r(e.data);else{var t={code:e.data.ret,message:e.data.msg};o(t)}}).catch(function(e){if(e.response){var t=new Error(e.response.status,e.response.data);o(t)}else{t=new Error(1e4,e.message);o(t)}o(e)})})},ConnectionStatistics.prototype.openDB=function(){var t=this,r=r||1,e=window.indexedDB.open(t.myDB.name,t.myDB.version);e.onerror=function(e){log.error("===ConnectionStatistics.openDB(), error:"+e.currentTarget.error.message)},e.onsuccess=function(e){t.myDB.db=e.target.result,log.debug("===ConnectionStatistics.openDB(),")},e.onupgradeneeded=function(e){var t=e.target.result;if(!t.objectStoreNames.contains("body_content"))t.createObjectStore("body_content",{autoIncrement:!0});log.debug("===ConnectionStatistics.openDB(),DB version changed to:"+r)}},ConnectionStatistics.prototype.addData=function(e){this.myDB.db.transaction("body_content","readwrite").objectStore("body_content").add(e)},ConnectionStatistics.prototype.deleteDataByKey=function(e){this.myDB.db.transaction("body_content","readwrite").objectStore("body_content").delete(e)},ConnectionStatistics.prototype.fetchStoreByCursor=function(){var r=this;r.myDB.db.transaction("body_content").objectStore("body_content").openCursor().onsuccess=function(e){var t=e.target.result;t&&(r.deleteDataByKey(t.key),t.continue(),r.fetchPost(r.url,t.value).then(function(e){}).catch(function(e){}))}},ConnectionStatistics.prototype.sendDBData=function(){this.fetchStoreByCursor()},AudioLevel.prototype.start=function(r){var e=when.defer();return clearInterval(this.audioLevelsIntervalId),this.audioLevelsIntervalId=setInterval(function(){room&&room.getParticipants().forEach(function(e){if(e&&e.audio){if(e.audio.track&&!e.audio.isMonitorAudioLevel){e.audio.isMonitorAudioLevel=!0;var t=new MediaStream;t.addTrack(e.audio.track),monitorAudioLevelBySteam(t,e.audio,r)}e.audio.track&&!e.audio.track.enabled&&(e.audio.audioLevel=0),e.audio.track||(e.audio.setAudioLevel(0),e.audio.isMonitorAudioLevel=!1,e.audio.monitorAudioLevelIntervalId&&(clearInterval(e.audio.monitorAudioLevelIntervalId),e.audio.monitorAudioLevelIntervalId=null))}}),e.resolve()},300),e.promise},AudioLevel.prototype.stop=function(){var e=when.defer();return this.audioLevelsIntervalId?(clearInterval(this.audioLevelsIntervalId),this.audioLevelsIntervalId=null,room&&room.getParticipants().forEach(function(e){e&&e.audio&&(e.audio.setAudioLevel(0),e.audio.isMonitorAudioLevel=!1,e.audio.monitorAudioLevelIntervalId&&(clearInterval(e.audio.monitorAudioLevelIntervalId),e.audio.monitorAudioLevelIntervalId=null))}),e.resolve()):e.reject(),e.promise};var WEBAUDIO_ANALYZER_FFT_SIZE=2048,WEBAUDIO_ANALYZER_SMOOTING_TIME=.8;window.AudioContext=window.AudioContext||window.webkitAudioContext;var context=null;function timeDomainDataToAudioLevel(e){for(var t=0,r=e.length,o=0;o<r;o++)t<e[o]&&(t=e[o]);return parseFloat(((t-127)/128).toFixed(3))}function animateLevel(e,t){var r=0,o=t-e;return r=.2<o?t-.2:o<-.4?t+.4:e,parseFloat(r.toFixed(3))}function LocalStatsCollector(e,t,r){this.stream=e,this.intervalId=null,this.intervalMilis=t,this.audioLevel=0,this.callback=r}function monitorAudioLevelBySteam(e,r,t){var o,n=0;if(window.AudioContext&&!context&&(context=new AudioContext).suspend(),context){context.resume();var i=context.createAnalyser();i.smoothingTimeConstant=WEBAUDIO_ANALYZER_SMOOTING_TIME,i.fftSize=WEBAUDIO_ANALYZER_FFT_SIZE,context.createMediaStreamSource(e).connect(i);r.monitorAudioLevelIntervalId=setInterval(function(){var e=new Uint8Array(i.frequencyBinCount);i.getByteTimeDomainData(e);var t=timeDomainDataToAudioLevel(e);t!=n&&(n=animateLevel(t,n),1===(o=audioLevelFullRange(8e4*n))&&(o=0),r.audioLevel=o)},t)}}function LoggerReport(){this.httpServerAddr="",this.httpsServerAddr="",this.reportMode=0,this.traceId="",this.appId="jh",this.reportLogLevel=1,this.userAgent=navigator.userAgent,this.clientType=1,this.reportUrl="",this.openLogger=!1,this.myDB={name:"3teeDB_logger",version:1,db:null},this.myDBOnsuccess=!1,this.sendDataCache=[],LoggerReport.prototype.start=function(){console.log("===LoggerReport.start()"),this.httpServerAddr=loggerReportConfig.http_server_addr,this.httpsServerAddr=loggerReportConfig.https_server_addr,this.reportMode=loggerReportConfig.report_mode?loggerReportConfig.report_mode:0,this.traceId=loggerReportConfig.trace_id?loggerReportConfig.trace_id:"",this.appId=loggerReportConfig.app_id?loggerReportConfig.app_id:"jh",this.reportLogLevel=loggerReportConfig.log_level?loggerReportConfig.log_level:1,this.reportUrl=this.httpServerAddr,"https:"==protocolStr&&(this.reportUrl=this.httpsServerAddr),this.openDB(),this.openLogger=!0},LoggerReport.prototype.stop=function(){console.log("===LoggerReport.stop()"),this.openLogger=!1},LoggerReport.prototype.debug=function(e){this.baseLevel(e,1)},LoggerReport.prototype.info=function(e){this.baseLevel(e,2)},LoggerReport.prototype.error=function(e){this.baseLevel(e,3)},LoggerReport.prototype.baseLevel=function(e,t){if(this.openLogger&&t>=this.reportLogLevel){var r=[],o={},n=new Date;if(o.timestamp=n.getTime(),o.log_content=e,o.log_level=t,r.push(o),room&&room.selfUser&&room.selfUser.id&&this.myDBOnsuccess){for(;0<this.sendDataCache.length;){var i=this.sendDataCache.pop();this.sendData(i)}this.sendData(r)}else this.sendDataCache.unshift(r)}},LoggerReport.prototype.sendData=function(e){var t="";room&&room.selfUser&&room.selfUser.id&&(t=room.selfUser.id);var r="";room&&room.selfUser&&room.selfUser.name&&(r=room.selfUser.name);var o="";room&&room.id&&(o=room.id);var n={data:{app_id:this.appId,user_id:t,user_name:r,room_id:o,user_agent:this.userAgent,client_type:this.clientType,trace_id:this.traceId,log_infos:e}};0==parseInt(this.reportMode)?this.fetchPost(this.reportUrl,n).then(function(e){}).catch(function(e){}):this.addData(n)},LoggerReport.prototype.fetchPost=function(e,t){return new Promise(function(r,o){axios.post(e,t,{headers:{"Content-Type":"application/json"}}).then(function(e){if(0===e.data.ret)r(e.data);else{var t={code:e.data.ret,message:e.data.msg};o(t)}}).catch(function(e){if(e.response){var t=new Error(e.response.status,e.response.data);o(t)}else{t=new Error(1e4,e.message);o(t)}o(e)})})},LoggerReport.prototype.openDB=function(){console.log("===LoggerReport.openDB()");var t=this,r=r||1,e=window.indexedDB.open(t.myDB.name,t.myDB.version);e.onerror=function(e){console.log(e.currentTarget.error.message)},e.onsuccess=function(e){t.myDB.db=e.target.result,console.log(""),t.myDBOnsuccess=!0},e.onupgradeneeded=function(e){var t=e.target.result;if(!t.objectStoreNames.contains("body_content"))t.createObjectStore("body_content",{autoIncrement:!0});console.log("DB version changed to "+r)}},LoggerReport.prototype.addData=function(e){this.myDB.db.transaction("body_content","readwrite").objectStore("body_content").add(e)},LoggerReport.prototype.deleteDataByKey=function(e){this.myDB.db.transaction("body_content","readwrite").objectStore("body_content").delete(e)},LoggerReport.prototype.fetchStoreByCursor=function(){var r=this;r.myDB.db.transaction("body_content").objectStore("body_content").openCursor().onsuccess=function(e){var t=e.target.result;t&&(r.deleteDataByKey(t.key),t.continue(),r.fetchPost(r.reportUrl,t.value).then(function(e){}).catch(function(e){}))}},LoggerReport.prototype.sendDBData=function(){this.fetchStoreByCursor()}}LocalStatsCollector.prototype.start=function(){if(window.AudioContext&&!context&&(context=new AudioContext).suspend(),context){context.resume();var o=context.createAnalyser();o.smoothingTimeConstant=WEBAUDIO_ANALYZER_SMOOTING_TIME,o.fftSize=WEBAUDIO_ANALYZER_FFT_SIZE,context.createMediaStreamSource(this.stream).connect(o);var n=this;this.intervalId=setInterval(function(){var e=new Uint8Array(o.frequencyBinCount);o.getByteTimeDomainData(e);var t=timeDomainDataToAudioLevel(e);if(t!=n.audioLevel){n.audioLevel=animateLevel(t,n.audioLevel);var r=audioLevelFullRange(8e4*n.audioLevel);1===r&&(r=0),n.callback(r)}},this.intervalMilis)}},LocalStatsCollector.prototype.stop=function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},audioLevelFullRange=function(e){var t=parseInt(e/1e3);0==t&&250<e&&(t=1);var r=[0,1,2,3,4,4,5,5,5,5,6,6,6,6,6,7,7,7,7,8,8,8,9,9,9,9,9,9,9,9,9,9,9][t];return r||(r=0),r},function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(e,t){var r,o,n=a,i=[];if(t=t||n.length,e)for(r=0;r<e;r++)i[r]=n[0|Math.random()*t];else for(i[8]=i[13]=i[18]=i[23]="",i[14]="4",r=0;r<36;r++)i[r]||(o=0|16*Math.random(),i[r]=n[19==r?3&o|8:o]);return i.join("")},Math.uuidFast=function(){for(var e,t=a,r=new Array(36),o=0,n=0;n<36;n++)8==n||13==n||18==n||23==n?r[n]="-":14==n?r[n]="4":(o<=2&&(o=33554432+16777216*Math.random()|0),e=15&o,o>>=4,r[n]=t[19==n?3&e|8:e]);return r.join("")},Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}}(),ModuleBase.define("BrowserInfo",[],function(e){return(e=function(){}).prototype.getBrowserInfo=function(){navigator.appVersion;var e,t,r=navigator.userAgent,o=navigator.appName,n=""+parseFloat(navigator.appVersion),i="",a="";-1!=(c=r.indexOf("OPR/"))?(o="Opera",n=r.substring(c+4)):-1!==(c=r.indexOf("Opera"))?(o="Opera",n=r.substring(c+6),-1!==(c=r.indexOf("Version"))&&(n=r.substring(c+8))):-1!==(c=r.indexOf("MSIE"))?(o="IE",n=r.substring(c+5)):-1!==(c=r.indexOf("FingerBrowser"))?(o="FingerBrowser",n=r.substring(c+14)):-1!==(c=r.indexOf("Chrome"))?(o="Chrome",n=r.substring(c+7)):-1!==(c=r.indexOf("Safari"))?(o="Safari",n=r.substring(c+7),-1!==(c=r.indexOf("Version"))&&(n=r.substring(c+8))):-1!==(c=r.indexOf("MicroMessenger"))?(o="MicroMessenger",n=r.substring(c+15,c+20)):-1!==(c=r.indexOf("UCBrowser"))?(o="UCBrowser",n=r.substring(c+10)):-1!==(c=r.indexOf("baiduboxapp"))?(o="Baiduboxapp",n=r.substring(c+12)):-1!==(c=r.indexOf("Firefox"))?(o="Firefox",n=r.substring(c+8)):-1!==(c=r.indexOf("HeyTapBrowser"))?(o="HeyTapBrowser",n=r.substring(c+8)):(e=r.lastIndexOf(" ")+1)<(c=r.lastIndexOf("/"))&&(o=r.substring(e,c),n=r.substring(c+1),o.toLowerCase()===o.toUpperCase()&&(o=navigator.appName));var s=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveOrOpenBlob&&!navigator.msSaveBlob);/rv:([^\)]+)\) like Gecko/.test(navigator.userAgent)&&(o="IE",n=RegExp.$1);var d=/QQBrowser/.test(navigator.userAgent),l=function(e,t){var r=window.external||{};for(var o in r)if(e.test(t?r[o]:o))return!0;return!1}(/^liebao/i,0),u=/3Tee/.test(navigator.userAgent);if(s){o="Edge";var c=r.indexOf("Edge");a=r.substring(c+5)}if(d){i="QQ";c=r.indexOf("QQBrowser");a=r.substring(c+10)}if(l&&(i="Liebao",a=""),u){i="3Tee";c=r.indexOf("3Tee");a=r.substring(c+5)}return-1!==(t=n.indexOf(";"))&&(n=n.substring(0,t)),-1!==(t=n.indexOf(" "))&&(n=n.substring(0,t)),{name:o,fullVersion:n,shellName:i,shellFullVersion:a,is3Tee:u}},e}),ModuleBase.define("OSInfo",[],function(e){return(e=function(){}).prototype.getOSInfo=function(){var e="Unknown OS",t={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return t.Android()||t.BlackBerry()||t.iOS()||t.Opera()||t.Windows()},getOsName:function(){var e="Unknown OS";return t.Android()&&(e="Android"),t.BlackBerry()&&(e="BlackBerry"),t.iOS()&&(e="iOS"),t.Opera()&&(e="Opera Mini"),t.Windows()&&(e="Windows"),e}};return t.any()?e=t.getOsName():(-1!==navigator.appVersion.indexOf("Win")&&(e="Windows"),-1!==navigator.appVersion.indexOf("Mac")&&(e="OSX"),-1!==navigator.appVersion.indexOf("X11")&&(e="UNIX"),-1!==navigator.appVersion.indexOf("Linux")&&(e="Linux")),e},e}),ModuleBase.define("CheckGetUserMedia",[],function(e){return(e=function(){}).prototype.getUserMediaSupport=function(){var e=!1;return void 0!==navigator.webkitGetUserMedia||void 0!==navigator.mozGetUserMedia?e=!0:navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(e=!0),e},e}),ModuleBase.define("CheckRTCPeerConnection",[],function(e){return(e=function(){}).prototype.RTCPeerConnectionSupport=function(){var e=!1;try{e=["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection"].some(function(e){return e in window})}catch(e){}return e},e}),ModuleBase.define("CheckDataChannel",[],function(e){return(e=function(){}).prototype.dataChannelSupport=function(){var e=!1;try{var t=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;if(t){var r=new t(null);e="createDataChannel"in r,r.close()}}catch(e){}return e},e}),ModuleBase.define("BrowserDetect",["BrowserInfo","OSInfo","CheckGetUserMedia","CheckRTCPeerConnection","CheckDataChannel"],function(i,a,s,d,l){var e=function(){this.detect={};location.protocol;var e=new i;this.detect.browser=e.getBrowserInfo(),this.detect.browser["is"+this.detect.browser.name]=!0;this.detect.browser.fullVersion.split(".")[0];var t=new a;this.detect.osName=t.getOSInfo();var r=new s;this.detect.getUserMediaSupport=r.getUserMediaSupport();var o=new d;this.detect.RTCPeerConnectionSupport=o.RTCPeerConnectionSupport();var n=new l;this.detect.dataChannelSupport=n.dataChannelSupport(),this.detect.WebSocketSupport="WebSocket"in window&&2===window.WebSocket.CLOSING,this.detect.screenSharingSupport=!1,navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia&&(this.detect.screenSharingSupport=!0),this.detect.ORTCSupport="undefined"!=typeof RTCIceGatherer,this.detect.isChrome=this.detect.browser.isChrome,this.detect.isOpera=this.detect.browser.isOpera,this.detect.isIE=this.detect.browser.isIE,this.detect.isFirefox=this.detect.browser.isFirefox,this.detect.isSafari=this.detect.browser.isSafari,this.detect.isMicroMessenger=this.detect.browser.isMicroMessenger,this.detect.isUCBrowser=this.detect.browser.isUCBrowser,this.detect.isBaiduboxapp=this.detect.browser.isBaiduboxapp,this.detect.isFingerBrowser=this.detect.browser.isFingerBrowser};return e.prototype.checkBrowserSupport=function(){var e=this.detect.browser.isChrome,t=this.detect.browser.isOpera,r=(this.detect.browser.isIE,this.detect.browser.isFirefox),o=this.detect.browser.isSafari,n=this.detect.browser.isMicroMessenger,i=this.detect.browser.isUCBrowser,a=this.detect.browser.isBaiduboxapp,s=this.detect.browser.isFingerBrowser,d=this.detect.browser.fullVersion.split(".")[0],l=e&&73<=Number(d)||t&&30<=Number(d);return"Android"==this.detect.osName&&(l=e&&73<=Number(d)),r&&86<=Number(d)&&(l=!0),o&&12<=Number(d)&&(l=!0),n&&7<=Number(d)&&(l=!0),i&&(l=!1),a&&5<=Number(d)&&(l=!0),s&&3<=Number(d)&&(l=!0),"iOS"==this.detect.osName&&e&&(console.log("===iphoneChrome"),l=!1),"Android"==this.detect.osName&&-1!==navigator.userAgent.indexOf("Alitephone")&&(console.log("===android360Alitephone Browser"),l=!1),"Android"==this.detect.osName&&-1!==navigator.userAgent.indexOf("LieBaoFast")&&(console.log("===androidLieBaoFast"),l=!1),"Android"!=this.detect.osName&&"iOS"!=this.detect.osName||-1===navigator.userAgent.indexOf("Mb2345Browser")||(console.log("===2345"),l=!1),"Android"==this.detect.osName&&-1!==navigator.userAgent.indexOf("HeyTapBrowser")&&(console.log("===oppoHeyTapBrowser,Chrome,vidoeSDK"),l=!1),!!(l&&this.detect.getUserMediaSupport&&this.detect.RTCPeerConnectionSupport&&this.detect.WebSocketSupport)},e.prototype.checkBrowserPluginSupport=function(){var e=!1,t=(this.detect.browser.isChrome,this.detect.browser.isOpera,this.detect.browser.isIE),r=(this.detect.browser.isFirefox,this.detect.browser.isSafari,this.detect.browser.isMicroMessenger,this.detect.browser.isUCBrowser,this.detect.browser.isBaiduboxapp,this.detect.browser.isFingerBrowser,this.detect.browser.fullVersion.split(".")[0]);return 1==t&&10<=Number(r)&&(e=!0),e},e.prototype.checkChromeSupportH264=function(){var e=!1,t=this.detect.browser.isChrome,r=(this.detect.browser.name,this.detect.browser.fullVersion.split(".")[0]);return 1==(1==t&&52<=Number(r))&&(e=!0),e},e.prototype.isChrome=function(){},e}),ModuleBase.define("Base",[],function(){var e=function(e,t){this.id=e,this.name=t,this.status=StreamStatus.init,this.element=null,this.resourceInfo=null,this.ownerId=null,this.track=null,this.mid=null,this.RTCRtpSender=null,this.ssrcStr=null,this.publishKeepAliveTime=null};return e.prototype.setPublishKeepAliveTime=function(e){e&&(this.publishKeepAliveTime=e,log.debug("===Base.setPublishKeepAliveTime(),id:"+this.id+",keepAliveTime:"+e))},e.prototype.getNewStreamByTrack=function(){var e=null;return this.track&&(e=new MediaStream).addTrack(this.track),e},e}),ModuleBase.define("Video",["Base","Error"],function(r,n){var s,e=function(e,t){r.call(this,e,t),this.level,this.description,this.resolutionSelect,this.resolution={width:room.avdEngine.defaultVideoParamsWidth,height:room.avdEngine.defaultVideoParamsHeight},this.setType=room.avdEngine.defaultVideoParamsResolutionSetType,this.frameRate=room.avdEngine.defaultVideoParamsFrameRate,this.aspectRatio=0,this.cameraType,this.maxBandwidth=null,this.clientSetMaxBandwidth=null,this.streamName,this.streamNickName,this.isPubState=!1,this.rtcRtpSenderIntervalId=null,this.spatialLayerActiveList=[],this.spatialLayerActiveDoing=!1,this.currentVideoQuality=null,this.changePublishVideoQualityInterval=null};(e.prototype=new r).setLevel=function(e){log.debug("===video.setLevel(),videoId:"+this.id+",level:"+e),this.level=e},e.prototype.setDescription=function(e){log.debug("===video.setDescription(),videoId:"+this.id+",description:"+e),this.description=e},e.prototype.setStreamName=function(e){log.debug("===video.setStreamName(),videoId:"+this.id+",streamName:"+e),this.streamName=e},e.prototype.setStreamNickName=function(e){log.debug("===video.setStreamNickName(),videoId:"+this.id+",streamNickName:"+e),this.streamNickName=e},e.prototype.setResolution=function(e,t){log.debug("===video.setResolution(),videoId:"+this.id+",resolution:"+e+",resolutionSetType:"+t),this.resolutionSelect=e,this.resolution=Resolution[e],t&&(this.setType=t)},e.prototype.setResolutionWH=function(e,t,r){log.debug("===video.setResolutionWH(),videoId:"+this.id+",width:"+e+",height:"+t+",resolutionSetType:"+r),this.resolutionSelect=e;var o={order:1};o.width=e,o.height=t,this.resolution=o,r&&(this.setType=r)},e.prototype.setFrameRate=function(e){log.debug("===video.setFrameRate(),videoId:"+this.id+",frameRate:"+e),"string"==typeof e&&(e=Number(e)),this.frameRate=e},e.prototype.setAspectRatio=function(e){log.debug("===video.setAspectRatio(),videoId:"+this.id+",aspectRatio:"+e),"string"==typeof e&&(e=Number(e)),this.aspectRatio=e},e.prototype.applyConstraints=function(){if(this.track){var e=getApplyConstraints(this);this.track.applyConstraints(e)}},e.prototype.setBandwidth=function(t){log.debug("===video.setBandwidth(),maxBandwidth:"+t+",videoId:"+this.id+",userId:"+this.ownerId);var e=this;if("RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype){var r=e.RTCRtpSender;if(r){var o=r.getParameters();if(o.encodings?o.encodings==[]&&(o.encodings[0]={}):o.encodings=[{}],t&&0!=t){var n;if(!room.avdEngine.isFirefox)1==(n=o.encodings.length)?o.encodings[0].maxBitrate=1e3*t:2==n?(o.encodings[0].maxBitrate=500*t,o.encodings[1].maxBitrate=1e3*t):3==n&&(o.encodings[0].maxBitrate=250*t,o.encodings[1].maxBitrate=500*t,o.encodings[2].maxBitrate=1e3*t);if(room.avdEngine.isFirefox)1==(n=o.encodings.length)?o.encodings[0].maxBitrate=1e3*t:2==n?(o.encodings[0].maxBitrate=1e3*t,o.encodings[1].maxBitrate=500*t):3==n&&(o.encodings[0].maxBitrate=1e3*t,o.encodings[1].maxBitrate=500*t,o.encodings[2].maxBitrate=250*t)}else for(var i=0;i<o.encodings.length;i++)delete o.encodings[i].maxBitrate;r.setParameters(o).then(function(){e.clientSetMaxBandwidth=t,log.debug("===video.setBandwidth(),,clientSetMaxBandwidth:"+t+",videoId:"+this.id+",userId:"+this.ownerId)}).catch(function(e){log.debug("===video.setBandwidth(),,clientSetMaxBandwidth:"+t+",videoId:"+this.id+",userId:"+this.ownerId+",error:",e)})}else e.clientSetMaxBandwidth=t,log.debug("===video.setBandwidth(),RTCRtpSender is null,clientSetMaxBandwidth:"+t+",videoId:"+this.id+",userId:"+this.ownerId)}},e.prototype.preview=function(t){log.info("===video.preview()");var e,r=when.defer(),o=this;if(e=doFsCheck(FTConstant.video,n))return r.reject(e),r.promise;if(640<parseInt(o.resolutionSelect)&&(e=doFsCheck(FTConstant.video_hd,n)))return r.reject(e),r.promise;return o.track?(o.status!=StreamStatus.published&&(o.status=StreamStatus.opened),(o.element=t).srcObject=o.getNewStreamByTrack(),r.resolve()):obtainUserMedia(null,o).then(function(e){o.track=e.videoStream.getVideoTracks()[0],null==room.selfUser.stream?room.selfUser.stream=e.videoStream:room.selfUser.stream.addTrack(o.track),o.status=StreamStatus.opened,(o.element=t).srcObject=o.getNewStreamByTrack(),r.resolve()}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.unpreview=function(){log.info("===video.unpreview()");this.element&&(this.element.srcObject=null,this.element=null),this.status=StreamStatus.init},e.prototype.publish=function(){log.info("===video.publish()");var t=when.defer(),r=this;return r.isPubState?(log.debug("===video publish(),isPubState =true to return"),t.resolve()):(r.isPubState=!0,this.publishHandle().then(function(){log.info("===video publish(),,Id:"+r.id+",name"+r.name+",ownerId:"+r.ownerId),loggerReport.info("video publish(),,Id:"+r.id+""+r.name+",ownerId:"+r.ownerId),t.resolve()}).otherwise(function(e){r.isPubState=!1,log.error("===video publish(),,Id:"+r.id+",name"+r.name+",ownerId:"+r.ownerId+",Error:"+e),loggerReport.error("video publish(),,Id:"+r.id+",name"+r.name+",ownerId:"+r.ownerId+",Error:"+e),t.reject(e)})),t.promise},e.prototype.previewAndPublish=function(e){log.info("===video.previewAndPublish()");var t,r=when.defer(),o=this;if(loggerReport.debug("previewAndPublish()..."),t=doFsCheck(FTConstant.video,n))return log.error(t),r.reject(t),r.promise;if(640<parseInt(this.resolutionSelect)&&(t=doFsCheck(FTConstant.video_hd,n)))return log.error("===video.previewAndPublish(),error:",t),r.reject(t),r.promise;return o.isPubState?(log.debug("===video previewAndPublish(),isPubState =true to return"),r.resolve()):(o.isPubState=!0,this.publishHandle(e).then(function(){log.info("===video previewAndPublish(),,videoId:"+o.id+",videoName"+o.name+",userId:"+o.ownerId),loggerReport.info("video previewAndPublish(),,videoId:"+o.id+",videoName"+o.name+",userId:"+o.ownerId),r.resolve()}).otherwise(function(e){o.isPubState=!1,log.error("===video previewAndPublish(),,videoId:"+o.id+",videoName"+o.name+",userId:"+o.ownerId+",error:"+JSON.stringify(e)),loggerReport.error("video previewAndPublish(),,videoId:"+o.id+",videoName"+o.name+",userId:"+o.ownerId+",error:"+JSON.stringify(e)),r.reject(e)})),r.promise},e.prototype.publishHandle=function(o){var n=when.defer(),i=getRandomNum(1,1500),a=this,e=room.calInitVideoBitrate(a.resolution.width,a.resolution.height);if(a.maxBandwidth=e.maxBit,a.status==StreamStatus.init)if(a.track){var t=room.setDeviceIdByUUID(0,a.id),r=a.getNewStreamByTrack();room.masterServer.videoPublishHandle(t,r,i),clearTimeout(s),s=setTimeout(function(){a.isPubState=!1,log.debug("===video publishHandle(status == StreamStatus.init,track!=null),pub_roomresourcemsg_rep timeout")},3e3),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(clearTimeout(s),null!=o&&(a.status=StreamStatus.opened,(a.element=o).srcObject=r),a.status=StreamStatus.published,room.hasObject(room.pubVideos,a)||room.pubVideos.push(a),log.info("===video previewAndPublish(),callback camera_status_notify,self.track != null, status:"+a.status+",videoId:"+a.id+",videoName"+a.name+",userId:"+a.ownerId),room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,a.status,a.id,a.name,room.selfUser.id),n.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&(clearTimeout(s),n.reject(e))})}else obtainUserMedia(null,a).then(function(e){a.track=e.videoStream.getVideoTracks()[0],null==room.selfUser.stream?room.selfUser.stream=e.videoStream:room.selfUser.stream.addTrack(a.track),a.status=StreamStatus.opened;var t=a.getNewStreamByTrack(),r=room.setDeviceIdByUUID(0,a.id);room.masterServer.videoPublishHandle(r,t,i),clearTimeout(s),s=setTimeout(function(){a.isPubState=!1,log.debug("===video publishHandle(status == StreamStatus.init,track==null),pub_roomresourcemsg_rep timeout")},3e3),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(clearTimeout(s),null!=o&&(a.status=StreamStatus.opened,(a.element=o).srcObject=t),a.status=StreamStatus.published,room.hasObject(room.pubVideos,a)||room.pubVideos.push(a),log.info("===video previewAndPublish(),callback camera_status_notify,self.track= null, status:"+a.status+",videoId:"+a.id+",videoName"+a.name+",userId:"+a.ownerId),room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,a.status,a.id,a.name,room.selfUser.id),n.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&(clearTimeout(s),n.reject(e))})}).otherwise(function(e){n.reject(e)});else if(a.status==StreamStatus.opened)if(a.track){t=room.setDeviceIdByUUID(0,a.id);room.masterServer.videoPublishHandle(t,a.getNewStreamByTrack(),i),clearTimeout(s),s=setTimeout(function(){a.isPubState=!1,log.debug("===video publishHandle(status == StreamStatus.opened,track!=null),pub_roomresourcemsg_rep timeout")},3e3),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(clearTimeout(s),a.status=StreamStatus.published,room.hasObject(room.pubVideos,a)||room.pubVideos.push(a),room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,a.status,a.id,a.name,room.selfUser.id),n.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&(clearTimeout(s),n.reject(e))})}else obtainUserMedia(null,a).then(function(e){a.track=e.videoStream.getVideoTracks()[0],null==room.selfUser.stream?room.selfUser.stream=e.videoStream:room.selfUser.stream.addTrack(a.track),a.status=StreamStatus.published;var t=room.setDeviceIdByUUID(0,a.id);room.masterServer.videoPublishHandle(t,a.getNewStreamByTrack(),i),clearTimeout(s),s=setTimeout(function(){a.isPubState=!1,log.debug("===video publishHandle(status == StreamStatus.opened,track==null),pub_roomresourcemsg_rep timeout")},3e3),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(clearTimeout(s),room.hasObject(room.pubVideos,a)||room.pubVideos.push(a),room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,a.status,a.id,a.name,room.selfUser.id),n.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&(clearTimeout(s),n.reject(e))})}).otherwise(function(e){n.reject(e)});else if(a.status==StreamStatus.published&&0<room.reconnectionCount){log.debug("===TTTTTTTTT00000000000000");t=room.setDeviceIdByUUID(0,a.id);room.masterServer.videoPublishHandle(t,a.getNewStreamByTrack(),i),clearTimeout(s),s=setTimeout(function(){a.isPubState=!1,log.debug("===video publishHandle(status == StreamStatus.opened,&& room.reconnectionCount > 0),pub_roomresourcemsg_rep timeout")},3e3),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==i&&(clearTimeout(s),room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,a.status,a.id,a.name,room.selfUser.id),n.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==i&&(clearTimeout(s),n.reject(e))})}return n.promise},e.prototype.unpublish=function(){log.info("===video.unpublish()");var t=this;if(t.maxBandwidth=null,this.status==StreamStatus.published||this.status==StreamStatus.init&&(this.track||null!=this.track)){t.isPubState=!1,arrayUtil.objectSplice(room.pubVideos,this.id),this.status=StreamStatus.init,room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,this.status,this.id,this.name,room.selfUser.id);var e=room.setDeviceIdByUUID(0,this.id);room.masterServer.videoUnpublishHandle(e,this.getNewStreamByTrack());var r=room.selfUser.stream;if(r&&r.getTracks().forEach(function(e){e.id==t.track.id&&e.stop()}),t.element){var o=t.element.srcObject;o&&o.getTracks().forEach(function(e){e.stop()}),t.element.srcObject=null,t.element=null}t.track.stop(),t.track=null,room.currBandwidth=null,log.info("===video unpublish(),,videoId:"+t.id+",videoName"+t.name+",userId:"+t.ownerId),loggerReport.info("video unpublish(),,videoId:"+t.id+",videoName"+t.name+",userId:"+t.ownerId)}};return e.prototype.subscrible=function(e){log.info("===video subscrible(),,videoId:"+this.id+",userId:"+this.ownerId+",videoQuality:"+e),loggerReport.info("video subscrible(),,videoId:"+this.id+",userId:"+this.ownerId+",videoQuality:"+e);var t=getRandomNum(15010,3e4);e?room.masterServer.videoSubscribleHandle(this.resourceInfo,e,t):room.masterServer.videoSubscribleHandle(this.resourceInfo,VideoQualityType.high,t)},e.prototype.unsubscrible=function(){log.info("===video unsubscrible(),,videoId:"+this.id+",userId:",this.ownerId),loggerReport.info("video unsubscrible(),,videoId:"+this.id+",userId:",this.ownerId);var e=getRandomNum(11e3,12e3);room.masterServer.videoUnsubscribleHandle(this.resourceInfo,e)},e.prototype.muteCamera=function(){log.info("===video.muteCamera()");var t=this;if(this.status==StreamStatus.published){if(this.status=StreamStatus.muted,room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,this.status,this.id,this.name,room.selfUser.id),room.selfUser.stream.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!1)}),t.element){var e=t.element.srcObject;e&&e.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!1)})}t.track&&(t.track.enabled=!1);var r=room.setDeviceIdByUUID(0,this.id);room.masterServer.updateWebcamMsg(room.selfUser.nodeId,r,this),log.info("===video muteCamera(),. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status),loggerReport.info("video muteCamera(),. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status)}},e.prototype.unmuteCamera=function(){log.info("===video.unmuteCamera()");var t=this;if(this.status==StreamStatus.muted){if(this.status=StreamStatus.published,room.selfUser.eventEmitter.emit(UserCallback.camera_status_notify,this.status,this.id,this.name,room.selfUser.id),room.selfUser.stream.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!0)}),t.element){var e=t.element.srcObject;e&&e.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!0)})}t.track&&(t.track.enabled=!0);var r=room.setDeviceIdByUUID(0,this.id);room.masterServer.updateWebcamMsg(room.selfUser.nodeId,r,this),log.info("===videe unmuteCamera(),. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status),loggerReport.info("video unmuteCamera(),. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status)}},Audio.prototype.ismuteCamera=function(){var e=!1;return this.status==StreamStatus.muted&&(e=!0),e},e.prototype.changeSubscribedVideoQuality=function(e){room.selfUser.id==this.ownerId?log.debug("===video changeSubscribedVideoQuality(),id:"+this.id+",ownerId:"+this.ownerId+",quality:"+e):(log.debug("===video changeSubscribedVideoQuality(),,id:"+this.id+",ownerId:"+this.ownerId+",quality:"+e),loggerReport.debug("video changeSubscribedVideoQuality(),,id:"+this.id+",ownerId:"+this.ownerId+",quality:"+e),room.masterServer.changeSubscribedVideoQuality(this.resourceInfo,this.quality2Level(e)))},e.prototype.changePublishVideoQuality=function(e){log.info("===video.changePublishVideoQuality(),videoId:"+this.id+",userId:"+this.ownerId+",level:"+e);var t=this;t.currentVideoQuality=e,t.changePublishVideoQualityInterval&&(clearInterval(t.changePublishVideoQualityInterval),t.changePublishVideoQualityInterval=null),t.changePublishVideoQualityInterval=setInterval(function(){t.currentVideoQuality&&room&&(t.changePublishVideoQualityHandle(t.currentVideoQuality),t.currentVideoQuality=null,clearInterval(t.changePublishVideoQualityInterval),t.changePublishVideoQualityInterval=null)},1e3)},e.prototype.changePublishVideoQualityHandle=function(t){var r=this,e=this.level2Quality(t);log.debug("===video.changePublishVideoQualityHandle(),userName:"+room.selfUser.name+",videoId:"+this.id+",level:"+t+",resolution.width:"+this.resolution.width+",resolution.height:"+this.resolution.height);var o=null;if(o=this.clientSetMaxBandwidth?this.clientSetMaxBandwidth:this.maxBandwidth){var n=0;if(e==VideoQualityType.high?n=o:e==VideoQualityType.normal?n=parseInt(o/2):e==VideoQualityType.low&&(n=parseInt(o/4)),"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype){var i=this.RTCRtpSender;if(i){var a=i.getParameters();a.encodings?a.encodings==[]&&(a.encodings[0]={}):a.encodings=[{}],o&&0!=o?a.encodings[0].maxBitrate=1e3*n:delete a.encodings[0].maxBitrate,i.setParameters(a).then(function(){log.debug("===video.changePublishVideoQualityHandle(),userName:"+room.selfUser.name+",videoId:"+r.id+",level:"+t+",,maxBandwidth:"+n)}).catch(function(e){log.debug("===video.changePublishVideoQualityHandle(),userName:"+room.selfUser.name+",videoId:"+r.id+",level:"+t+",,maxBandwidth:"+n+",error:",e)})}}}},e.prototype.quality2Level=function(e){var t=3;return e==VideoQualityType.high?t=4:e==VideoQualityType.normal?t=3:e==VideoQualityType.low&&(t=2),t},e.prototype.level2Quality=function(e){VideoQualityType.normal;return 4<=e?VideoQualityType.high:3==e?VideoQualityType.normal:VideoQualityType.low},e.prototype.updateCameraData=function(e,t){log.debug("===video.updateCameraData(),level:"+e+",description:"+t),this.level=e,this.description=t;var r=room.setDeviceIdByUUID(0,this.id);room&&room.selfUser&&(room.selfUser.reJoinVideoId2Description[this.id]||(room.selfUser.reJoinVideoId2Description[this.id]=t),room.masterServer.updateWebcamMsg(room.selfUser.nodeId,r,this))},e.prototype.updateExporterStreamName=function(e,t){var r=when.defer();return this.streamName=e,this.streamNickName=t,room.masterServer.updateExporterStreamName(this).then(function(){r.resolve()}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.setMaxSpatialLayer=function(r){if(simulcastEnabled){if(this.RTCRtpSender){var e=this.RTCRtpSender.getParameters();e.encodings.forEach(function(e,t){log.debug("===video.setMaxSpatialLayer(),spatialLayer:"+r+",idx:"+t),e.active=t<r}),this.RTCRtpSender.setParameters(e)}}else log.debug("===video.setMaxSpatialLayer()simulcastEnabled=false")},e.prototype.setSpatialLayerActive=function(e,t,r){if(room.avdEngine.isChrome&&73<=room.avdEngine.majorVersion&&room.avdEngine.majorVersion<=76)log.debug("===video.setSpatialLayerActive(),chrome73-76active/unactive");else{var i=this;if(log.debug("===video.setSpatialLayerActive(),baseActive:"+e+",ass1Active:"+t+",ass2Active:"+r),simulcastEnabled){var o={};o.baseActive=e,o.ass1Active=t,o.ass2Active=r,i.spatialLayerActiveList.push(o),setTimeout(function(){if(!i.spatialLayerActiveDoing){i.spatialLayerActiveDoing=!0;var r=0,o=0,n=0;i.spatialLayerActiveList.forEach(function(e){0!=e.baseActive&&(r=e.baseActive),0!=e.ass1Active&&(o=e.ass1Active),0!=e.ass2Active&&(n=e.ass2Active)}),log.debug("===video.setSpatialLayerActive(),baseActiveNew:"+r+",ass1ActiveNew:"+o+",ass2ActiveNew:"+n),i.RTCRtpSender&&(log.debug("===video.setSpatialLayerActive(),RTCRtpSender != null"),i.rtcRtpSenderIntervalId=setInterval(function(){var e=i.RTCRtpSender.getParameters();0<e.encodings.length&&(log.debug("===video.setSpatialLayerActive(),parameters.encodings:",JSON.stringify(e.encodings)),clearInterval(i.rtcRtpSenderIntervalId),i.rtcRtpSenderIntervalId=null,e.encodings.forEach(function(e,t){0==t&&(2==r?(log.debug("===video.setSpatialLayerActive(),baseActive active to true"),e.active=!0):1==r&&(log.debug("===video.setSpatialLayerActive(),baseActive  active to false"),e.active=!1)),1==t&&(2==o?(log.debug("===video.setSpatialLayerActive(),ass1Active active to true"),e.active=!0):1==o&&(log.debug("===video.setSpatialLayerActive(),ass1Active active to false"),e.active=!1)),2==t&&(2==n?(log.debug("===video.setSpatialLayerActive(),ass2Active active to true"),e.active=!0):1==n&&(log.debug("===video.setSpatialLayerActive(),ass2Active active to false"),e.active=!1))}),i.RTCRtpSender.setParameters(e),i.spatialLayerActiveDoing=!1)},200))}},1e3)}else log.debug("===video.setSpatialLayerActive()simulcastEnabled=false")}},e.prototype.attachVideoElementMediaStream=function(e,t){null!=t&&(this.element=e),e&&(e.srcObject=t)},e}),ModuleBase.define("Audio",["Base","Error"],function(r,s){var d,e=function(e,t){r.call(this,e,t),this.audioLevel=0,this.isPubState=!1,this.isMonitorAudioLevel=!1,this.monitorAudioLevelIntervalId=null};return(e.prototype=new r).openMicrophone=function(o){log.info("===audio.openMicrophone()");var n=when.defer(),i=this,e=doFsCheck(FTConstant.audio,s);if(e)return n.reject(e),n.promise;var a=getRandomNum(30001,6e3);if(i.track){var t=room.setDeviceIdByUUID(2,i.id),r=i.getNewStreamByTrack();if(i.isPubState){if(i.status==StreamStatus.published)return log.debug("===audio openMicrophone(self.track!=null),isPubState =true && self.status == StreamStatus.published to return"),n.resolve(),n.promise;if(i.status==StreamStatus.muted)return log.debug("===audio openMicrophone(self.track!=null),isPubState =true && self.status == StreamStatus.muted to audio.unmuteMicrophone()"),i.unmuteMicrophone(),n.resolve(),n.promise}if(i.isPubState)return log.debug("===audio openMicrophone(self.track!=null),isPubState =true  to return"),n.resolve(),n.promise;i.isPubState=!0,room.masterServer.audioPublishHandle(t,r,a),clearTimeout(d),d=setTimeout(function(){i.isPubState=!1,log.debug("===audio openMicrophone(self.track!=null),pub_roomresourcemsg_rep timeout")},3e3),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==a&&(clearTimeout(d),i.state=StreamStatus.opened,void 0!==o&&o&&""!=o&&((i.element=o).srcObject=r),i.status=StreamStatus.published,room.hasObject(room.pubAudios,i)||room.pubAudios.push(i),log.info("===audio openMicrophone(),,callback microphone_status_notify  (self.track!=null),status:"+i.status+",audioId:"+i.id+",userId:"+i.ownerId),loggerReport.info("audio openMicrophone(),,(self.track!=null),audioId:"+i.id+",userId:"+i.ownerId),room.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,i.status,i.id,i.name,room.selfUser.id),n.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==a&&(clearTimeout(d),i.isPubState=!1,log.error("===audio openMicrophone(),,(self.track!=null),audioId:"+i.id+",userId:"+i.ownerId+",error:"+JSON.stringify(e)),loggerReport.error("audio openMicrophone(),,(self.track!=null),audioId:"+i.id+",userId:"+i.ownerId+",error:"+JSON.stringify(e)),n.reject(e))})}else obtainUserMedia(i,null).then(function(e){i.track=e.audioStream.getAudioTracks()[0],null==room.selfUser.stream?room.selfUser.stream=e.audioStream:room.selfUser.stream.addTrack(i.track),i.state=StreamStatus.opened;var t=room.setDeviceIdByUUID(2,i.id),r=i.getNewStreamByTrack();if(i.isPubState)return log.debug("===audio openMicrophone(self.track=null),isPubState =true  to return"),n.resolve(),n.promise;i.isPubState=!0,room.masterServer.audioPublishHandle(t,r,a),clearTimeout(d),d=setTimeout(function(){i.isPubState=!1,log.debug("===audio openMicrophone(self.track==null),pub_roomresourcemsg_rep timeout")},3e3),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==a&&(clearTimeout(d),void 0!==o&&o&&""!=o&&((i.element=o).srcObject=r),i.status=StreamStatus.published,room.hasObject(room.pubAudios,i)||room.pubAudios.push(i),log.info("===audio openMicrophone(),,callback microphone_status_notify (self.track==null),status:"+i.status+",audioId:"+i.id+",userId:"+i.ownerId),loggerReport.info("audio openMicrophone(),,(self.track==null),audioId:"+i.id+",userId:"+i.ownerId),room.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,i.status,i.id,i.name,room.selfUser.id),n.resolve())}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==a&&(clearTimeout(d),i.isPubState=!1,log.error("===audio openMicrophone(),,(self.track==null),audioId:"+i.id+",userId:"+i.ownerId+",error:"+JSON.stringify(e)),loggerReport.error("audio openMicrophone(),,(self.track==null),audioId:"+i.id+",userId:"+i.ownerId+",error:"+JSON.stringify(e)),n.reject(e))})}).otherwise(function(e){n.reject(e)});return n.promise},e.prototype.closeMicrophone=function(){log.info("===audio.closeMicrophone()");var t=this;if(t.status==StreamStatus.published||t.status==StreamStatus.muted){t.isPubState=!1,arrayUtil.objectSplice(room.pubAudios,this.id),t.status=StreamStatus.init,room.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,t.status,t.id,t.name,room.selfUser.id);var e=room.setDeviceIdByUUID(2,t.id),r=t.getNewStreamByTrack();room.masterServer.audioUnpublishHandle(e,r),this.setAudioLevel(0);var o=room.selfUser.stream;if(o&&o.getTracks().forEach(function(e){e.id==t.track.id&&e.stop()}),t.element){var n=t.element.srcObject;n&&n.getTracks().forEach(function(e){e.stop()}),t.element.srcObject=null,t.element=null}t.track.stop(),t.track=null,room.avdEngine.safariInitAudioStream=null,log.info("===audio closeMicrophone(),.audioId:"+t.id+",userId:"+t.ownerId),loggerReport.info("audio closeMicrophone(),.audioId:"+t.id+",userId:"+t.ownerId)}},e.prototype.subscrible=function(){log.info("===audio subscrible(),, audioId:"+this.id+",userId:"+this.ownerId),loggerReport.info("audio subscrible(),, audioId:"+this.id+",userId:"+this.ownerId);var e=getRandomNum(12001,13e3);room.masterServer.audioSubscribleHandle(this.resourceInfo,e)},e.prototype.unsubscrible=function(){log.info("===audio unsubscrible(),audioId:"+this.id+",userId:"+this.ownerId),loggerReport.info("audio unsubscrible(),audioId:"+this.id+",userId:"+this.ownerId);var e=getRandomNum(13001,14e3);console.log("===audio unsubscrible(),this.resourceInfo.stream.stream_name:"+this.resourceInfo.stream.stream_name),room.masterServer.audioUnsubscribleHandle(this.resourceInfo,e)},e.prototype.muteMicrophone=function(){log.info("===audio.muteMicrophone()");var t=this;if(this.status==StreamStatus.published){if(this.status=StreamStatus.muted,room.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,this.status,this.id,this.name,room.selfUser.id),room.selfUser.stream.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!1)}),t.element){var e=t.element.srcObject;e&&e.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!1)})}t.track&&(t.track.enabled=!1);var r=room.setDeviceIdByUUID(2,this.id);room.masterServer.updateSpeakerMsg(room.selfUser.nodeId,r,this),log.info("===audio muteMicrophone(),. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status),loggerReport.info("audio muteMicrophone(),. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status)}},e.prototype.unmuteMicrophone=function(){log.info("===audio.unmuteMicrophone()");var t=this;if(this.status==StreamStatus.muted){if(this.status=StreamStatus.published,room.selfUser.eventEmitter.emit(UserCallback.microphone_status_notify,this.status,this.id,this.name,room.selfUser.id),room.selfUser.stream.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!0)}),t.element){var e=t.element.srcObject;e&&e.getTracks().forEach(function(e){e.id==t.track.id&&(e.enabled=!0)})}t.track&&(t.track.enabled=!0);var r=room.setDeviceIdByUUID(2,this.id);room.masterServer.updateSpeakerMsg(room.selfUser.nodeId,r,this),log.info("===audio unmuteMicrophone(),. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status),loggerReport.info("audio unmuteMicrophone(),. Id:"+t.id+",ownerId:"+t.ownerId+",status:"+t.status)}},e.prototype.ismuteMicrophone=function(){var e=!1;return this.status==StreamStatus.muted&&(e=!0),e},e.prototype.setAudioLevel=function(e){this.audioLevel=e},e.prototype.getAudioLevel=function(){return this.audioLevel},e}),ModuleBase.define("Screen",["Base","Error"],function(r,i){var s,e=function(e,t){r.call(this,e,t),this.level,this.description,this.resolution={width:room.avdEngine.defaultScreenParamsMaxWidth,height:room.avdEngine.defaultScreenParamsMaxHeight},this.frameRate={min:room.avdEngine.defaultScreenParamsMinFrameRate,max:room.avdEngine.defaultScreenParamsMaxFrameRate},this.maxBandwidth=null,this.clientSetMaxBandwidth=null,this.extensionFlag,this.ipc=null};return(e.prototype=new r).setLevel=function(e){this.level=e},e.prototype.setDescription=function(e){this.description=e},e.prototype.setResolution=function(e,t){var r={};r.width=e,r.height=t,this.resolution=r},e.prototype.setFrameRate=function(e,t){var r={};r.min=e,r.max=t,this.frameRate=r},e.prototype.preview=function(e){log.info("===screen.preview()");e&&(this.element=e,this.element.srcObject=this.getNewStreamByTrack())},e.prototype.publish=function(){log.info("===screen.publish()");var o=when.defer(),n=this,e=doFsCheck(FTConstant.screen,i);if(e)return o.reject(e),o.promise;if(this.status==StreamStatus.published)o.resolve();else if(navigator.mediaDevices.getDisplayMedia){var t={video:!0};room.avdEngine.isChrome&&96<=room.avdEngine.majorVersion&&(t.preferCurrentTab=!0),log.debug("===screen.publish(),displayMediaConstrains:"+JSON.stringify(t)),navigator.mediaDevices.getDisplayMedia(t).then(function(e){if(e){var t=e.getTracks()[0];void 0!==t.onended?t.addEventListener("ended",function(){log.debug("===screen track.ended,ownerId:"+n.ownerId),n.unpublish(),room.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,n.status,n.id,n.name,room.selfUser.id),room.eventEmitter.emit(RoomCallback.screen_sharing_ended)},!1):void 0!==t.oninactive?t.addEventListener("inactive",function(){log.debug("===screen track.inactive,ownerId:"+n.ownerId),n.unpublish(),room.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,n.status,n.id,n.name,room.selfUser.id),room.eventEmitter.emit(RoomCallback.screen_sharing_ended)},!1):void 0!==e.onended?e.addEventListener("ended",function(e){log.debug("===screen stream.ended,ownerId:"+n.ownerId),n.unpublish(),room.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,n.status,n.id,n.name,room.selfUser.id),room.eventEmitter.emit(RoomCallback.screen_sharing_ended)},!1):void 0!==e.oninactive&&e.addEventListener("inactive",function(e){log.debug("===screen stream.inactive,ownerId:"+n.ownerId),n.unpublish(),room.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,n.status,n.id,n.name,room.selfUser.id),room.eventEmitter.emit(RoomCallback.screen_sharing_ended)},!1),n.publishHandleInner(n,e,"",o)}o.resolve()}).catch(function(e){log.error("===screen.publish(),Unable to acquire screen capture",e.name+",ownerId:"+n.ownerId);var t,r=ModuleBase.use(ModulesEnum.error);t="NotSupportedError"==e.name?new r(ErrorConstant.navigatorDisplayMediaError_notSupportedError):"OverconstrainedError"==e.name?new r(ErrorConstant.navigatorDisplayMediaError_overconstrainedError):"NotAllowedError"==e.name?new r(ErrorConstant.navigatorDisplayMediaError_notAllowedError):new r(ErrorConstant.navigatorDisplayMediaError_unknown),o.reject(t)})}else log.debug("===screen.publish(), navigator.mediaDevices.getDisplayMedia."),loggerReport.error("===screen.publish(), navigator.mediaDevices.getDisplayMedia.");return o.promise},e.prototype.electronPublish=function(e,t,r){log.info("===screen.electronPublish()");var o=when.defer();return(this.ipc=e)&&this.registerElectronIPCInner(),room.avdEngine.electronManager.getDesktopSources(t,r).then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)}),o.promise},e.prototype.electronPrimaryDisplayPublish=function(){var t=when.defer(),e=this,r=room.avdEngine.electronManager.getPrimaryDisplay();log.debug("===electronPrimaryDisplayPublish(),primaryDisplay:",r);var o="screen:"+r.id;return"win32"==require("os").platform()&&(o="screen:0:0"),log.debug("===electronPrimaryDisplayPublish(),primaryDisplaySourceId:",o),this.publishHandle(o).then(function(){log.info("===screen electronPrimaryDisplayPublish(),,Id:"+e.id+",name"+e.name+",ownerId:"+e.ownerId),t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},e.prototype.registerElectronIPCInner=function(){var r=this;this.ipc.on("selectScreenSourceId",function(e,t){room.selfUser.getScreen().publishHandle(t).then(function(){log.info("===screen registerElectronIPCInner(),,Id:"+r.id+",name"+r.name+",ownerId:"+r.ownerId)}).otherwise(function(e){})}),this.ipc.on("stopScreenSharing",function(e){room.selfUser.getScreen().unpublish()})},e.prototype.unpublish=function(){log.info("===screen.unpublish()");this.maxBandwidth=null,this.status==StreamStatus.published&&(this.status=StreamStatus.init,room.masterServer.screenUnpublishHandle(this.id,this.getNewStreamByTrack()),arrayUtil.objectSplice(room.pubScreens,this.id),this.track.stop(),this.track=null,room.isMcu()||(this.stream=null),log.info("===screen unpublish(),,screenId:"+this.id+",screenName"+this.name+",userId:"+this.ownerId),loggerReport.info("screen unpublish(),,screenId:"+this.id+",screenName"+this.name+",userId:"+this.ownerId))},e.prototype.subscrible=function(){log.info("===screen subscrible(),,screenId:"+this.id+",userId:",this.ownerId),loggerReport.info("srceen subscrible(),,screenId:"+this.id+",userId:",this.ownerId);var e=getRandomNum(14001,15e3);room.masterServer.screenSubscribleHandle(this.resourceInfo,e)},e.prototype.unsubscrible=function(){log.info("===screen unsubscrible(),,screenId:"+this.id+",userId:"+this.ownerId),loggerReport.info("screen unsubscrible(),,screenId:"+this.id+",userId:"+this.ownerId);var e=getRandomNum(15001,16e3);room.masterServer.screenUnsubscribleHandle(this.resourceInfo,e)},e.prototype.setBandwidth=function(t){var e=this;if("RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype){var r=e.RTCRtpSender;if(r){var o=r.getParameters();console.log("===screen.setBandwidth(),parameters:",o),o.encodings?o.encodings==[]&&(o.encodings[0]={}):o.encodings=[{}],t&&0!=t?o.encodings[0].maxBitrate=1e3*t:delete o.encodings[0].maxBitrate,r.setParameters(o).then(function(){e.clientSetMaxBandwidth=t,log.debug("===screen.setBandwidth(),,clientSetMaxBandwidth:"+t)}).catch(function(e){log.debug("===screen.setBandwidth(),,clientSetMaxBandwidth:"+t+",error:",e)})}else e.clientSetMaxBandwidth=t,log.debug("===screen.setBandwidth(),RTCRtpSender is null,clientSetMaxBandwidth:"+t)}},e.prototype.updateScreenData=function(e,t){log.debug("===screen.updateScreenData(),level:"+e+",description:"+t),this.level=e,this.description=t,room&&room.selfUser&&(room.selfUser.reJoinScreenDescription=t,room.masterServer.updateScreenIdMsg(room.selfUser.nodeId,this.id,this))},e.prototype.publishHandle=function(r){log.debug("===Screen publishHandle(),streamId :",r);var o=when.defer(),n=this;return navigator.webkitGetUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxWidth:n.resolution.width,maxHeight:n.resolution.height,minFrameRate:n.frameRate.min,maxFrameRate:n.frameRate.max}}},function(e){if(log.debug("gotShareStream.stream:",e),e&&e.getTracks()){var t=e.getTracks()[0];void 0!==t.onended?t.onended=function(){log.debug("screen.publish(),track.onended"),n.track&&(n.unpublish(),room.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,n.status,n.id,n.name,room.selfUser.id)),room.eventEmitter.emit(RoomCallback.screen_sharing_ended)}:void 0!==e.onended?e.onended=function(){log.debug("===screen.publish(),stream.onended"),n.track&&(n.unpublish(),room.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,n.status,n.id,n.name,room.selfUser.id)),room.eventEmitter.emit(RoomCallback.screen_sharing_ended)}:e.oninactive=function(){log.debug("===screen.publish(),stream.oninactive"),n.track&&(n.unpublish(),room.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,n.status,n.id,n.name,room.selfUser.id)),room.eventEmitter.emit(RoomCallback.screen_sharing_ended)}}n.publishHandleInner(n,e,r,o)},function(e){log.debug("An error occurred: "+e);e=new i(ErrorConstant.screen_sharing_plugin_not_accessible);o.reject(e)}),o.promise},e.prototype.publishHandleInner=function(r,e,t,o){var n=getRandomNum(6001,9e3),i=room.calInitVideoBitrate(r.resolution.width,r.resolution.height);r.maxBandwidth=i.maxBit,r.track=e.getVideoTracks()[0],null==room.selfUser.stream?room.selfUser.stream=e:room.selfUser.stream.addTrack(r.track),r.status=StreamStatus.published;var a=r.getNewStreamByTrack();room.masterServer.screenPublishHandle(r.id,a,n),clearTimeout(s),s=setTimeout(function(){log.debug("===screen publish,pub_roomresourcemsg_rep_success  timeout")},3e3),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==n&&(clearTimeout(s),room.pubScreens.push(r),log.info("===screen publishHandleInner(),,Id:"+r.id+",name"+r.name+",ownerId:"+r.ownerId),room.selfUser.eventEmitter.emit(UserCallback.screen_status_notify,r.status,r.id,r.name,room.selfUser.id),o.resolve(t))}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==n&&(clearTimeout(s),log.info("===screen publishHandleInner(),,Id:"+r.id+",name"+r.name+",ownerId:"+r.ownerId+"error:",e),o.reject(e))})},e.prototype.attachScreenElementMediaStream=function(e,t){null!=t&&(this.element=e),e&&(e.srcObject=t)},e});var currentVideoParameter={videoWidth:!1,videoHeight:!1,frameRate:!1,aspectRatio:!1};function isAndroid(){return-1!=navigator.userAgent.indexOf("Android")}function getPreviousResolution(e){if(!Resolutions[e])return null;var t=Resolutions[e].order,r=null,o=null;for(var n in Resolutions){var i=Resolutions[n];(null==r||r.order<i.order&&i.order<t)&&(o=n,r=i)}return o}function getConstraints(e,t){var r={audio:!1,video:!1};return e&&(r.audio={mandatory:{},optional:[]}),t&&(r.video={width:{},height:{},frameRate:{}}),r.audio&&(r.audio.optional.push({googEchoCancellation:!0},{googAutoGainControl:!0},{googNoiseSuppression:!0},{googHighpassFilter:!0},{googNoisesuppression2:!0},{googEchoCancellation2:!0},{googAutoGainControl2:!0}),e.id&&(r.audio.mandatory.sourceId=e.id)),r.video&&t.id&&(r.video.deviceId=t.id),t&&(t.resolution&&setResolutionConstraints(r,t.resolution,t.setType),t.frameRate&&setFrameRateConstraints(r,t.frameRate),0<t.aspectRatio&&setAspectRatioConstraints(r,t.aspectRatio)),r}function getApplyConstraints(e){var t={};return e&&(t={width:{},height:{},frameRate:{}}),t&&e.id&&(t.deviceId=e.id),e&&(e.resolution&&setApplyResolutionConstraints(t,e.resolution,e.setType),e.frameRate&&setApplyFrameRateConstraints(t,e.frameRate),0<e.aspectRatio&&setApplyAspectRatioConstraints(t,e.aspectRatio)),t}function setResolutionConstraints(e,t,r){t&&(r==ResolutionSetType.ideal?(e.video.width={ideal:t.width},e.video.height={ideal:t.height}):(e.video.width={exact:t.width},e.video.height={exact:t.height}),currentVideoParameter.videoWidth=t.width,currentVideoParameter.videoHeight=t.height)}function setApplyResolutionConstraints(e,t,r){t&&(r==ResolutionSetType.ideal?(e.width={ideal:t.width},e.height={ideal:t.height}):(e.width={exact:t.width},e.height={exact:t.height}),currentVideoParameter.videoWidth=t.width,currentVideoParameter.videoHeight=t.height)}function setFrameRateConstraints(e,t){e.video.frameRate={ideal:t},currentVideoParameter.frameRate=t}function setApplyFrameRateConstraints(e,t){e.frameRate={ideal:t},currentVideoParameter.frameRate=t}function setAspectRatioConstraints(e,t){e.video.aspectRatio={exact:t},currentVideoParameter.aspectRatio=t}function setApplyAspectRatioConstraints(e,t){e.aspectRatio={exact:t},currentVideoParameter.aspectRatio=t}function obtainUserMedia(e,t){var r=when.defer();return getUserMediaWithConstraints(e,t).then(function(e){r.resolve(handleLocalStream(e))}).otherwise(function(e){r.reject(e)}),r.promise}function getUserMediaWithConstraints(t,r){var o=when.defer(),e=getConstraints(t,r);return log.info("===streamUtil.getUserMediaWithConstraints(),constraints:"+JSON.stringify(e)),r&&log.debug("===streamUtil.getUserMediaWithConstraints(),video getUserMedia Start"),t&&log.debug("===streamUtil.getUserMediaWithConstraints(),audio getUserMedia Start"),navigator.mediaDevices.getUserMedia(e).then(function(e){r&&log.debug("===streamUtil.getUserMediaWithConstraints(),video getUserMedia opened"),t&&log.debug("===streamUtil.getUserMediaWithConstraints(),audio getUserMedia opened"),o.resolve(e)}).catch(function(e){var t,r=ModuleBase.use(ModulesEnum.error);t="NotSupportedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new r(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new r(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notFoundError):new r(ErrorConstant.navigatorUserMediaError_unknown),o.reject(t)}),o.promise}function handleLocalStream(e){var t,r;if(t=new MediaStream,r=new MediaStream,e){for(var o=e.getAudioTracks(),n=0;n<o.length;n++)t.addTrack(o[n]);var i=e.getVideoTracks();for(n=0;n<i.length;n++)r.addTrack(i[n])}return{audioStream:t,videoStream:r}}var fakeVideoConstraints={video:!0,fake:!0},fakeAudioConstraints={audio:!0,fake:!0},mcuServerUrl,clusterRestAddr,roomServerUrl,iceServers,stunUrl,trunUrl,iceusername,iceCredential;function getFakeVideoStream(t){navigator.mediaDevices.getUserMedia(fakeVideoConstraints).then(function(e){t(e)}).catch(function(e){})}function getFakeAudioStream(t){navigator.mediaDevices.getUserMedia(fakeAudioConstraints).then(function(e){t(e)}).catch(function(e){})}function getAllAudioVideoDevices(t,e){if(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=navigator.mediaDevices.enumerateDevices.bind(navigator)),navigator.enumerateDevices){var n=[],i=[],a=[],s=[],d=[],l=[];navigator.enumerateDevices(function(e){e.forEach(function(e){var t,r={};for(var o in e)r[o]=e[o];n.forEach(function(e){e.id===r.id&&(t=!0)}),t||("audio"===r.kind&&(r.kind="audioinput"),"video"===r.kind&&(r.kind="videoinput"),r.deviceId||(r.deviceId=r.id),r.id||(r.id=r.deviceId),r.label||(r.label="Please invoke getUserMedia once."),"audioinput"!==r.kind&&"audio"!==r.kind||s.push(r),"audiooutput"===r.kind&&d.push(r),"videoinput"!==r.kind&&"video"!==r.kind||l.push(r),-1!==r.kind.indexOf("audio")&&i.push(r),-1!==r.kind.indexOf("video")&&a.push(r),n.push(r))}),t&&t({allMdiaDevices:n,allVideoDevices:a,allAudioDevices:i,videoInputDevices:l,audioInputDevices:s,audioOutputDevices:d})})}else e(null,"Neither navigator.mediaDevices.enumerateDevices NOR MediaStreamTrack.getSources are available.")}function captureUserMedia(e,t,r){navigator.mediaDevices.getUserMedia(e).then(t)}navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=function(e){navigator.mediaDevices.enumerateDevices().then(e)});var is_cluster=!1,protocolStr=document.location.protocol;"httpsionic:"==protocolStr&&(protocolStr="https:"),"http:"!=protocolStr&&"https:"!=protocolStr&&"httpsionic:"!=protocolStr&&(protocolStr="http:");var fsCheck={isCheck:!1,content:{}},connectionStatisticsConfig=null,loggerReportConfig=null,loggerReport=null,doFsCheck=function(e,t){var r=null;1==fsCheck.isCheck&&(1!=fsCheck.content[e.value]&&(r=new t(ErrorConstant.ft_no_authorization.code,e.name+ErrorConstant.ft_no_authorization.message)));return r};function saveLog(e,t,r){var o=document.location.protocol;"httpsionic:"==o&&(o="https:");var n=o+"//"+logAjax.server+"/write?db="+logAjax.db+"&u="+logAjax.userName+"&p="+logAjax.password;"undefined"!=typeof returnCitySN&&(cip=returnCitySN.cip);(new Date).getTime();var i="",a="",s="",d="",l=0;room&&(room.id&&(i=room.id),room.selfUser&&(room.selfUser.name&&(a=room.selfUser.name),room.selfUser.id&&(s=room.selfUser.id))),browserDetect&&browserDetect.detect&&browserDetect.detect.browser&&(browserDetect.detect.browser.name&&(d=browserDetect.detect.browser.name),browserDetect.detect.browser.fullVersion&&(l=browserDetect.detect.browser.fullVersion));var u='js_log host_ip="'+cip+'",roomId="'+i+'",userName="'+a+'",userId="'+s+'",browserName="'+d+'",browserVersion="'+l+'",level="'+e+'",msg="'+t+'" ';$.ajax({type:"post",url:n,timeout:5e3,data:u,success:function(e){},error:function(e,t,r){}})}ModuleBase.define("RestServer",["Error"],function(Error){var RestServer=function(e){e&&(protocolStr=e)},tee3Axios=axios.create({baseURL:"",timeout:1e4,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}});return RestServer.prototype.getServerinfo=function(serverURI,accessToken,isUseCascade){var deferred=when.defer();mcuServerUrl=serverURI,"httpsionic:"==protocolStr&&(protocolStr="https:");var url=protocolStr+"//"+serverURI+"/sdk/config/serverinfo",params={params:{uri_encode:"yes",client_info:{access_tocken:accessToken},is_use_cascade:isUseCascade}};return this.fetchGet(url,params).then(function(serverinfo){log.debug("===restServer.getServerinfo(),serverinfo:"+JSON.stringify(serverinfo));var fuValue=serverinfo.ft_value;if(fuValue&&(fsCheck.isCheck=!0,"object"==typeof fuValue?fsCheck.content=fuValue:"string"==typeof fuValue&&(fsCheck.content=eval("("+fuValue+")"))),""!==fuValue&&"{}"!==fuValue&&"{}"!==JSON.stringify(fuValue)){var error=doFsCheck(FTConstant.platform_web,Error);if(error)return deferred.reject(error),deferred.promise}connectionStatisticsConfig=serverinfo.statistic_config?serverinfo.statistic_config:{},connectionStatisticsConfig.open_statistic=serverinfo.open_statistic?serverinfo.open_statistic:0,connectionStatisticsConfig.trace_id=serverinfo.trace_id?serverinfo.trace_id:"",loggerReportConfig=serverinfo.logger_config?serverinfo.logger_config:{},loggerReportConfig.open_logger=serverinfo.open_logger?serverinfo.open_logger:0,loggerReportConfig.trace_id=serverinfo.trace_id?serverinfo.trace_id:"",roomServerUrl=serverinfo.room_server.uri,iceServers=serverinfo.ice_servers,iceServers&&0<iceServers.length&&(stunUrl=iceServers[0].url,trunUrl=iceServers[1].url,iceusername=iceServers[1].username,iceCredential=iceServers[1].credential),serverinfo.is_cluster&&("true"!=serverinfo.is_cluster&&1!=serverinfo.is_cluster||(is_cluster=!0)),deferred.resolve()}).catch(function(e){e=new Error(e.code,e.message);return deferred.reject(e),!1}),deferred.promise},RestServer.prototype.getMcu=function(e,t,r){var o=when.defer();loggerReport.info(":"+mcuServerUrl),"httpsionic:"==protocolStr&&(protocolStr="https:");var n=protocolStr+"//"+mcuServerUrl+"/sdk/get_mcu",i={params:{room_id:e,token:t,is_use_cascade:r}};return log.info("===restServer.getMcu(),room.avdEngine.mcuClusterRouteParams:"+room.avdEngine.mcuClusterRouteParams),room.avdEngine.mcuClusterRouteParams&&(i.params.options=room.avdEngine.mcuClusterRouteParams,log.info("===restServer.getMcu(), getMcuUrl(mcuClusterRouteParams):"+i.params.options)),this.fetchGet(n,i).then(function(e){log.debug("===restServer.getMcu(),mcuAddr:"+JSON.stringify(e));var t=e.ret;if(0==t)roomServerUrl=e.addr,clusterRestAddr=e.cluster_rest_addr,log.info("===restServer.getMcu(),mcuAddr.addr:"+e.addr),loggerReport.info("===restServer.getMcu(),mcuAddr.cluster_rest_addr:"+e.cluster_rest_addr),o.resolve();else{var r=new Error(t,e.msg);o.reject(r)}}).catch(function(e){console.log(e);e=new Error(e.code,e.message);return o.reject(e),!1}),o.promise},RestServer.prototype.getMcuWithOEM=function(e,t){var o=when.defer();"httpsionic:"==protocolStr&&(protocolStr="https:");var r=protocolStr+"//"+mcuServerUrl+"/sdk/get_mcu",n={params:{room_id:e,access_token:t}};return this.fetchGet(r,n).then(function(e){var t=e.ret;if(0==t)roomServerUrl=e.addr,clusterRestAddr=e.cluster_rest_addr,room.avdEngine.accessToken=e.access_token,log.info("===restServer.getMcuWithOEM(), roomServerUrl:"+e.addr+",accessToken"+e.access_token),o.resolve();else{var r=new Error(t,e.msg);o.reject(r)}}).catch(function(e){e=new Error(e.code,e.message);return o.reject(e),!1}),o.promise},RestServer.prototype.getMqttWSAddr=function(e,t){var n=when.defer();"httpsionic:"==protocolStr&&(protocolStr="https:");var r=protocolStr+"//"+e+"/sdk/mqtt/serverinfo",o={params:{token:t}};return this.fetchGet(r,o).then(function(e){var t=e.ret;if(0==t){var r=e.data.mqtt_ws_addr;log.info("===restServer.getMqttWSAddr(), mqttWSAddr:"+r),n.resolve(r)}else{var o=new Error(t,e.msg);n.reject(o)}}).catch(function(e){e=new Error(e.code,e.message);return n.reject(e),!1}),n.promise},RestServer.prototype.fetchGet=function(e,t){return new Promise(function(r,o){tee3Axios.get(e,t).then(function(e){if(0===e.data.ret)r(e.data);else{var t={code:e.data.ret,message:e.data.msg};o(t)}}).catch(function(e){if(e.response){var t=new Error(e.response.status,e.response.data);o(t)}else{t=new Error(1e4,e.message);o(t)}o(e)})})},RestServer}),ModuleBase.define("MasterServer",["CmdProtobufCoded","TraceablePeerConnection","Error"],function(t,r,T){var e=function(e){this.signalingChannel=e,this.cmdProtobufCoded=new t,this.roomPduType=this.cmdProtobufCoded.getRoomPduTypeEnum(),this.mediaType=this.cmdProtobufCoded.getMediaTypeEnum(),this.sessionType=this.cmdProtobufCoded.getSessionTypeEnum(),this.resourceStatus=this.cmdProtobufCoded.getResourceStatusEnum(),this.resourceOpt=this.cmdProtobufCoded.getResourceOptEnum(),this.userMsgOpt=this.cmdProtobufCoded.getUserMsgOptEnum(),this.cameraType=this.cmdProtobufCoded.getCameraTypeEnum(),this.lineArrow=this.cmdProtobufCoded.getLineArrowEnum(),this.annotationType=this.cmdProtobufCoded.getAnnotationTypeEnum(),this.exporterType=this.cmdProtobufCoded.getExporterTypeEnum(),this.dataCryptoType=this.cmdProtobufCoded.getDataCryptoTypeEnum(),this.outGoingViewLayoutMode=this.cmdProtobufCoded.getOutGoingViewLayoutMode(),this.traceablePeerConnection=new r,room.traceablePeerConnection=this.traceablePeerConnection,this.traceablePeerConnection.getToMCUPeerConnection()};function P(e,t){var r=t.payloads.split(" ");for(var o in e){var n=e[o];for(var i in t.rtp){var a=t.rtp[i];if(a.codec==n){var s=a.payload;for(var d in delete t.rtp[i],r){r[d]==s&&arrayUtil.baseSplice(r,s)}for(var l in t.fmtp){var u=t.fmtp[l];u.config!="apt="+s&&u.payload!=s||arrayUtil.baseSplice(t.fmtp,u)}if(t.rtcpFb)for(i=0;i<t.rtcpFb.length;i++){var c=t.rtcpFb[i];c.payload==s&&(arrayUtil.baseSplice(t.rtcpFb,c),i--)}}}}return t.payloads=r.join(" "),t}function s(){var e=0;return is_cluster&&(e=1),e}return e.prototype.openReqSend=function(){var a=this;if(room.versionToServer&&room.audioCodecPayloadMap){room.answerRemoteSdp=room.remoteSdpTemplate;var e=s();log.debug("===masterServer.openReqSend(),000000,is_cluster:"+e);loggerReportConfig&&loggerReportConfig.trace_id&&loggerReportConfig.trace_id;var t=a.cmdProtobufCoded.newOpenReq(10,room.avdEngine.accessToken,"",room.versionToServer,"",e,room.audioCodecPayloadMap),r=a.cmdProtobufCoded.encodedPacket(a.roomPduType.OPEN_REQ,0,0,0,t);log.info("===masterServer.openReqSend(),000000,Send PDU OPEN_REQ"),loggerReport.info("masterServer.openReqSend(),000000,Send PDU OPEN_REQ"),a.signalingChannel.send(r)}else(function(){var I=when.defer(),T=["red","ulpfec","rtx","flexfec-03"],R=["red","telephone-event"],C=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"}),e={offerToReceiveAudio:1,offerToReceiveVideo:1};room.avdEngine.isFirefox||(C.addTransceiver("audio",{direction:"inactive"}),C.addTransceiver("video",{direction:"inactive"}),e={});return C.createOffer(e).then(function(e){log.debug("===masterServer.sdpPretreatment(),createOffer sessionDescription.sdp:"+e.sdp);var t=getIceInfoBySDP(e.sdp);log.debug("===masterServer.sdpPretreatment(), ice-ufrag:"+t.ufrag+",ice-pwd:"+t.pwd),room.iceUfrag=t.ufrag,room.icePwd=t.pwd,e.sdp=e.sdp.replace(/packetization-mode=0/g,"packetization-mode=1");var r=(new SDPTransform).parse(e.sdp);for(var o in r.media)if("video"==(g=r.media[o]).type)for(var n in room.codecPayloadVP8=[],room.codecPayloadVP9=[],room.codecPayloadH264=[],room.codecPayloadAV1=[],g.rtp)"VP8"==(i=g.rtp[n]).codec?room.codecPayloadVP8.push(i.payload):"VP9"==i.codec?room.codecPayloadVP9.push(i.payload):"H264"==i.codec?room.codecPayloadH264.push(i.payload):"AV1"==i.codec&&room.codecPayloadAV1.push(i.payload);else if("audio"==g.type)for(var n in room.codecPayloadOpus=[],room.codecPayloadISAC_16K=[],room.codecPayloadISAC_32K=[],room.codecPayloadG722=[],room.codecPayloadPCMU=[],room.codecPayloadPCMA=[],room.codecPayloadCN_8k=[],room.codecPayloadCN_16k=[],room.codecPayloadCN_32k=[],g.rtp){var i;"opus"==(i=g.rtp[n]).codec?room.codecPayloadOpus.push(i.payload):"ISAC"==i.codec&&16e3==i.rate?room.codecPayloadISAC_16K.push(i.payload):"ISAC"==i.codec&&32e3==i.rate?room.codecPayloadISAC_32K.push(i.payload):"G722"==i.codec?room.codecPayloadG722.push(i.payload):"PCMU"==i.codec?room.codecPayloadPCMU.push(i.payload):"PCMA"==i.codec?room.codecPayloadPCMA.push(i.payload):"CN"==i.codec&&8e3==i.rate?room.codecPayloadCN_8k.push(i.payload):"CN"==i.codec&&16e3==i.rate?room.codecPayloadCN_16k.push(i.payload):"CN"==i.codec&&32e3==i.rate&&room.codecPayloadCN_32k.push(i.payload)}var a="102",s=getPayloadByProfileLevel(e.sdp);s&&(a=s),log.debug("===masterServer.sdpPretreatment(), currpayloadH264:"+a);var d=0;if(room.codecPayloadH264&&0<room.codecPayloadH264.length){for(var l=0;l<room.codecPayloadH264.length;l++)if(room.codecPayloadH264[l]==a){d=l;break}if(0<d){var u=room.codecPayloadH264[0];room.codecPayloadH264[0]=a,room.codecPayloadH264[d]=u}}var c="js_v"+avdVersion+" ";if(room.codecPayloadVP8&&0<room.codecPayloadVP8.length)for(l=0;l<room.codecPayloadVP8.length;l++)c=c+"vp8:"+room.codecPayloadVP8[l]+",";if(room.codecPayloadVP9&&0<room.codecPayloadVP9.length)for(l=0;l<room.codecPayloadVP9.length;l++)c=c+"vp9:"+room.codecPayloadVP9[l]+",";if(room.codecPayloadH264&&0<room.codecPayloadH264.length)for(l=0;l<room.codecPayloadH264.length;l++){var p=",";l==room.codecPayloadH264.length-1&&(p=""),c=c+"h264:"+room.codecPayloadH264[l]+p}var h="";if(room.codecPayloadISAC_16K&&0<room.codecPayloadISAC_16K.length)for(l=0;l<room.codecPayloadISAC_16K.length;l++)h=h+"isac_16k:"+room.codecPayloadISAC_16K[l]+",";if(room.codecPayloadISAC_32K&&0<room.codecPayloadISAC_32K.length)for(l=0;l<room.codecPayloadISAC_32K.length;l++)h=h+"isac_32k:"+room.codecPayloadISAC_32K[l]+",";if(room.codecPayloadOpus&&0<room.codecPayloadOpus.length)for(l=0;l<room.codecPayloadOpus.length;l++)h=h+"opus:"+room.codecPayloadOpus[l]+",";if(room.codecPayloadG722&&0<room.codecPayloadG722.length)for(l=0;l<room.codecPayloadG722.length;l++)h=h+"g722:"+room.codecPayloadG722[l]+",";if(room.codecPayloadPCMU&&0<room.codecPayloadPCMU.length)for(l=0;l<room.codecPayloadPCMU.length;l++)h=h+"pcmu:"+room.codecPayloadPCMU[l]+",";if(room.codecPayloadPCMA&&0<room.codecPayloadPCMA.length)for(l=0;l<room.codecPayloadPCMA.length;l++)h=h+"pcma:"+room.codecPayloadPCMA[l]+",";if(room.codecPayloadCN_8k&&0<room.codecPayloadCN_8k.length)for(l=0;l<room.codecPayloadCN_8k.length;l++)h=h+"cn_8k:"+room.codecPayloadCN_8k[l]+",";if(room.codecPayloadCN_16k&&0<room.codecPayloadCN_16k.length)for(l=0;l<room.codecPayloadCN_16k.length;l++)h=h+"cn_16k:"+room.codecPayloadCN_16k[l]+",";if(room.codecPayloadCN_32k&&0<room.codecPayloadCN_32k.length)for(l=0;l<room.codecPayloadCN_32k.length;l++)p=",",l==room.codecPayloadCN_32k.length-1&&(p=""),h=h+"cn_32k:"+room.codecPayloadCN_32k[l]+p;var f=new SDPTransform,m=f.parse(e.sdp);for(var o in m.media){var g;if("video"==(g=m.media[o]).type){g.ext=[],g.ext.push({value:2,uri:"urn:ietf:params:rtp-hdrext:toffset"}),g.ext.push({value:3,uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),g.ext.push({value:5,uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),P(T,g);var v=g.payloads.split(" ");for(var y in v){var b=v[y];videoCoding==VideoCodingType.VP8?S=room.codecPayloadVP8[0]:videoCoding==VideoCodingType.VP9?S=room.codecPayloadVP9[0]:videoCoding==VideoCodingType.H264&&(S=a),b==S&&(w=y)}var _=v[0];v[0]=S,v[w]=_,g.payloads=v.join(" "),g.ssrcs=[],room.videoMediaTemplate=g}else if("audio"==g.type){var w;for(var y in g.ext=[],g.ext.push({value:1,uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"}),P(R,g),v=g.payloads.split(" ")){var S;b=v[y],audioCoding==AudioCodingType.opus?S=room.codecPayloadOpus[0]:audioCoding==AudioCodingType.ISAC_16k?S=room.codecPayloadISAC_16K[0]:audioCoding==AudioCodingType.ISAC_32k?S=room.codecPayloadISAC_32K[0]:audioCoding==AudioCodingType.G722?S=room.codecPayloadG722[0]:audioCoding==AudioCodingType.PCMA?S=room.codecPayloadPCMA[0]:audioCoding==AudioCodingType.PCMU&&(S=room.codecPayloadPCMU[0]),b==S&&(w=y)}_=v[0],v[0]=S,v[w]=_,g.payloads=v.join(" "),g.ssrcs=[],room.audioMediaTemplate=g}}e.sdp=f.writer(m),room.remoteSdpTemplate=e.sdp,C.close();var E={version:room.versionToServer=c,audioCodecPayloadMap:room.audioCodecPayloadMap=h};I.resolve(E)}).catch(function(e){log.error("===masterServer.sdpPretreatment(),temp PC createOffer error:"+e.toString()),I.reject(e)}),I.promise})().then(function(e){var t=e.version,r=e.audioCodecPayloadMap;log.info("===masterServer.openReqSend(),version:"+t),log.info("===masterServer.openReqSend(),audioCodecPayloadMap:"+r),room.answerRemoteSdp=room.remoteSdpTemplate;var o=s();log.debug("===masterServer.openReqSend(),is_cluster:"+o);loggerReportConfig&&loggerReportConfig.trace_id&&loggerReportConfig.trace_id;var n=a.cmdProtobufCoded.newOpenReq(10,room.avdEngine.accessToken,"",t,"",o,r),i=a.cmdProtobufCoded.encodedPacket(a.roomPduType.OPEN_REQ,0,0,0,n);log.info("===masterServer.openReqSend(), Send PDU OPEN_REQ"),loggerReport.info("masterServer.openReqSend(), Send PDU OPEN_REQ"),a.signalingChannel.send(i)}).otherwise(function(e){log.error("===masterServer.openReqSend(),sdpPretreatment() error:",e)})},e.prototype.openReqReconnectionSend=function(){var e=s();log.debug("===masterServer.openReqReconnectionSend(),is_cluster:"+e);var t=this.cmdProtobufCoded.newOpenReq(10,room.avdEngine.accessToken,room.signalTocken,room.versionToServer,"",e,room.audioCodecPayloadMap),r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OPEN_REQ,0,0,0,t);log.info("===masterServer.openReqReconnectionSend(),Send PDU OPEN_REQ"),loggerReport.info("masterServer.openReqReconnectionSend(),Send PDU OPEN_REQ"),this.signalingChannel.send(r)},e.prototype.pingIntervalHandle=function(){var e=this;room.pingIntervalId=setInterval(function(){room&&(room.pingCountTime+=room.pingInterval,packetArray=e.cmdProtobufCoded.encodedPacket(e.roomPduType.PING,room.lastPDUSeq,0,0,null),e.signalingChannel.send(packetArray))},room.pingInterval)},e.prototype.pingTimeoutHandle=function(){var e=this,t=3*room.pingInterval;room.pingTimeoutId=setInterval(function(){room&&room.pingCountTime>=t&&(room.reconnectionState||(log.info("===webSocketmasterServer.pingTimeoutHandle(),Ping"+t+"websocket"),loggerReport.info("webSocketmasterServer.pingTimeoutHandle(),Ping"+t+"websocket"),room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connecting),e.pingInit(),room.reconnectionHandle()))},1e3)},e.prototype.pingInit=function(){room.pingCountTime=0,clearInterval(room.pingIntervalId),clearInterval(room.pingTimeoutId),room.pingIntervalId=null,room.pingTimeoutId=null},e.prototype.inviteRoomReqSend=function(){var e=null;0<room.reconnectionCount&&(e=room.selfUser.nodeId);var t=this.cmdProtobufCoded.newUserPolicy(!0,!0,!0),r=room.userAgent;for(var o in room.avdEngine.clientResource.cameras){var n=room.avdEngine.clientResource.cameras[o];n.id=room.setDeviceIdByUUID(0,n.id)}for(var o in room.avdEngine.clientResource.microphones){var i=room.avdEngine.clientResource.microphones[o];i.id=room.setDeviceIdByUUID(2,i.id)}for(var o in room.avdEngine.clientResource.speakers){var a=room.avdEngine.clientResource.speakers[o];a.id=room.setDeviceIdByUUID(1,a.id)}var s=JSON.stringify(room.avdEngine.clientResource);log.debug("===masterServer.inviteRoomReqSend(),userResources:"+s);var d=this.cmdProtobufCoded.newJoinInfo([],[],r,t,s),l=this.dataCryptoType.DataCryptoTypeAES128;dataCrypto==DataCryptoType.AES128?l=this.dataCryptoType.DataCryptoTypeAES128:dataCrypto==DataCryptoType.AES256?l=this.dataCryptoType.DataCryptoTypeAES256:dataCrypto==DataCryptoType.SM4&&(l=this.dataCryptoType.DataCryptoTypeSM4),log.debug("===masterServer.inviteRoomReqSend(),dataCryptoType:"+l);var u=this.cmdProtobufCoded.newInviteRoomReq1(20,room.id,"",room.avdEngine.accessToken,room.selfUser.id,room.selfUser.name,d,room.roomPassword,e,room.selfUser.data,mediaConnectType,l);u.user_data=room.selfUser.data,u.ice_ufrag=room.iceUfrag,u.ice_pwd=room.icePwd,log.info("===masterServer.inviteRoomReqSend(),Send PDU INVITE_ROOM_REQ1"),loggerReport.info("masterServer.inviteRoomReqSend(),Send PDU INVITE_ROOM_REQ1");var c=this.cmdProtobufCoded.encodedPacket(this.roomPduType.INVITE_ROOM_REQ1,0,0,0,u);this.signalingChannel.send(c)},e.prototype.sendAnswer=function(){var e=this;this.traceablePeerConnection.doSetRemoteDescription().then(function(){e.traceablePeerConnection.doSetLocalDescription()})},e.prototype.setAddIcecandidate=function(e){if(roomServerUrl){var t=roomServerUrl.split("/")[0];if(t){var r=t.split(":");0<r.size&&(t=r[0])}e.candidate=e.candidate.replace("127.0.0.1",t)}log.debug("===masterServer.setAddIcecandidate(),mcu server send candidate:"+e.candidate),this.traceablePeerConnection.doAddIceCandidate(e)},e.prototype.addWebcamMsg=function(e,t){var r=this.cmdProtobufCoded.newWebcam(e,t.name,t.status,this.sessionType.Video);r.ctype=this.cameraType.unknown,r.level=t.level,r.description=t.description;var o=this.cmdProtobufCoded.newAddWebcamMsg(room.selfUser.nodeId,r),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ADD_WEBCAM_MSG,0,room.selfUser.nodeId,0,o);this.signalingChannel.send(n)},e.prototype.removeWebcamMsg=function(e){var t=this.cmdProtobufCoded.newRemoveWebcamMsg(room.selfUser.nodeId,e),r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.REMOVE_WEBCAM_MSG,0,room.selfUser.nodeId,0,t);this.signalingChannel.send(r)},e.prototype.addScreenMsg=function(e,t){var r=this.cmdProtobufCoded.newDesktop(e,t.name,t.status,this.sessionType.ShareScreen);r.level=t.level,r.description=t.description;var o=this.cmdProtobufCoded.newAddDesktopMsg(room.selfUser.nodeId,r),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ADD_DESKTOP_MSG,0,room.selfUser.nodeId,0,o);this.signalingChannel.send(n)},e.prototype.addSpeakerMsg=function(e,t){var r=this.cmdProtobufCoded.newSpeaker(e,t.name,t.status,this.sessionType.Audio),o=this.cmdProtobufCoded.newAddSpeakerMsg(room.selfUser.nodeId,r),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ADD_SPEAKER_MSG,0,room.selfUser.nodeId,0,o);this.signalingChannel.send(n)},e.prototype.removeSpeakerMsg=function(e){var t=this.cmdProtobufCoded.newRemoveSpeakerMsg(room.selfUser.nodeId,e),r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.REMOVE_SPEAKER_MSG,0,room.selfUser.nodeId,0,t);this.signalingChannel.send(r)},e.prototype.updateUserName=function(e,t){var r=this.cmdProtobufCoded.newUpdateUserName(e,t),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_USER_NAME,0,room.selfUser.nodeId,0,r);this.signalingChannel.send(o)},e.prototype.updateUserDataMsg=function(e){var t=this.cmdProtobufCoded.newUpdateUserDataMsg(room.selfUser.nodeId,e),r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_USER_DATA_MSG,0,room.selfUser.nodeId,0,t);this.signalingChannel.send(r)},e.prototype.roomDataInfo=function(e,t){var r=this.cmdProtobufCoded.newRoomKV(e,t),o=[];o.push(r);var n=this.cmdProtobufCoded.newRoomDataInfo(room.id,o),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ROOM_DATA_INFO,0,room.selfUser.nodeId,0,n);this.signalingChannel.send(i)},e.prototype.pubRoomResourceMsg=function(e,t,r,o,n,i){var a,s=100;if(videoCoding==VideoCodingType.VP8?s=100:videoCoding==VideoCodingType.VP9?s=101:videoCoding==VideoCodingType.H264&&(s=107),"video"==e)a=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.video,r,currentVideoParameter.videoWidth,currentVideoParameter.videoHeight,currentVideoParameter.frameRate,s);else if("audio"==e){var d=parseInt(audioCoding);a=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.audio,r,0,0,0,d)}else"screen"==e&&(a=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.desktop,r,1920,1080,5,s));if(null!=a){a.sdp_version=3;var l=this.cmdProtobufCoded.newRoomResourceInfo(o,room.selfUser.nodeId,a);if(l.keep_alive_time=i,"video"==e){var u=room.getDeviceIdByUUID(0,o),c=room.selfUser.getVideo(u);c&&(c.resourceInfo=l)}log.info("==="+e+" send PUB_ROOM_RESOURCE_MSG,orderId:"+n+",resource_id:"+l.resource_id+",owner_id:"+l.owner_id+",keep_alive_time:"+l.keep_alive_time);var p=this.cmdProtobufCoded.newPubRoomResourceMsg(l,n),h=this.cmdProtobufCoded.encodedPacket(this.roomPduType.PUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,0,p);this.signalingChannel.send(h),this.signalingChannel.send("")}},e.prototype.subRoomResourceMsg=function(e,t,r,o,n){var i;if(1==t){log.info("==="+e+" send SUB_ROOM_RESOURCE_MSG,updateType:"+t+",orderId:"+n+",resource_id:"+r.resource_id+",owner_id:"+r.owner_id);var a=this.cmdProtobufCoded.newSubRoomResourceMsg(r,room.selfUser.nodeId,n,o);i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,0,a)}else if(0==t){log.info("==="+e+" send UNSUB_ROOM_RESOURCE_MSG,updateType:"+t+",orderId:"+n+",resource_id:",r.resource_id+",owner_id:"+r.owner_id);var s=this.cmdProtobufCoded.newUnsubRoomResourceMsg(r,room.selfUser.nodeId,n);i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UNSUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,0,s)}this.signalingChannel.send(i),this.signalingChannel.send("")},e.prototype.unpubRoomResourceMsg=function(e,t,r){var o,n;if("video"==e){var i=room.getDeviceIdByUUID(0,r);log.debug("===masterServer.unpubRoomResourceMsg(),video deviceId:",i),o=(s=room.selfUser.getVideo(i)).ssrcStr,log.debug("===masterServer.unpubRoomResourceMsg(),video sdp:",o),n=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.video,o)}else"audio"==e?(o=room.selfUser.audio.ssrcStr,log.debug("===masterServer.unpubRoomResourceMsg(),audio sdp:",o),n=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.audio,o)):"screen"==e&&(o=room.selfUser.screen.ssrcStr,log.debug("===masterServer.unpubRoomResourceMsg(),screen sdp:",o),n=this.cmdProtobufCoded.newMediaStream(t,this.mediaType.desktop,o));n&&(n.sdp_version=3);var a=this.cmdProtobufCoded.newRoomResourceInfo(r,room.selfUser.nodeId,n);if("video"==e){var s;i=room.getDeviceIdByUUID(0,r);(s=room.selfUser.getVideo(i))&&(s.resourceInfo=a)}var d=this.cmdProtobufCoded.newUnpubRoomResourceMsg(a);log.info("==="+e+" send UNPUB_ROOM_RESOURCE_MSG,resource_id:",a.resource_id+",owner_id:"+a.owner_id);var l=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UNPUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,0,d);this.signalingChannel.send(l),this.signalingChannel.send("")},e.prototype.updateSpeakerMsg=function(e,t,r){var o=room.setDeviceIdByUUID(2,r.id),n=this.cmdProtobufCoded.newSpeaker(o,r.name,r.status,this.sessionType.Audio),i=this.cmdProtobufCoded.newUpdateSpeakerMsg(e,t,n),a=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_SPEAKER_MSG,0,room.selfUser.nodeId,0,i);this.signalingChannel.send(a),this.signalingChannel.send("")},e.prototype.updateWebcamMsg=function(e,t,r){var o=room.setDeviceIdByUUID(0,r.id),n=r.status;r.status!=StreamStatus.none&&r.status!=StreamStatus.opened||(n=1);var i=this.cmdProtobufCoded.newWebcam(o,r.name,n,this.sessionType.Video);i.level=r.level,i.description=r.description;var a=this.cmdProtobufCoded.newUpdateWebcamMsg(e,t,i),s=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_WEBCAM_MSG,0,room.selfUser.nodeId,0,a);this.signalingChannel.send(s),this.signalingChannel.send("")},e.prototype.updateScreenIdMsg=function(e,t,r){var o=this.cmdProtobufCoded.newDesktop(r.id,r.name,r.status,this.sessionType.ShareScreen);o.level=r.level,o.description=r.description;var n=this.cmdProtobufCoded.newUpdateDesktopMsg(e,t,o),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_DESKTOP_MSG,0,room.selfUser.nodeId,0,n);this.signalingChannel.send(i),this.signalingChannel.send("")},e.prototype.videoIndiction=function(e,t,r){var o=this.resourceOpt.pub;e||(o=this.resourceOpt.unpub);var n=this.cmdProtobufCoded.newResourceIndiction(t,o,r,room.selfUser.nodeId,"host_tocken"),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.VIDEO_INDICTION,0,room.selfUser.nodeId,r,n);this.signalingChannel.send(i)},e.prototype.audioIndiction=function(e,t,r){var o=this.resourceOpt.pub;"pub"==e?o=this.resourceOpt.pub:"unpub"==e?o=this.resourceOpt.unpub:"mute"==e?o=this.resourceOpt.mute:"unmute"==e&&(o=this.resourceOpt.unmute);var n=this.cmdProtobufCoded.newResourceIndiction(t,o,r,room.selfUser.nodeId,"host_tocken"),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.AUDIO_INDICTION,0,room.selfUser.nodeId,r,n);this.signalingChannel.send(i)},e.prototype.sendMessage=function(e,t){var r=new Date;r.setMinutes(r.getMinutes()+r.getTimezoneOffset());var o=r.getTime();o=Math.round(o/1e3);var n=this.cmdProtobufCoded.newTextMsg(e,o),i=this.roomPduType.PUBLIC_TEXT_MSG,a=0;if(void 0!==t&&null!=t&&""!=t){var s=room.getNodeId(t);if(null==s)return!1;a=s,i=this.roomPduType.PRIVATE_TEXT_MSG}var d=this.cmdProtobufCoded.encodedPacket(i,0,room.selfUser.nodeId,a,n);this.signalingChannel.send(d)},e.prototype.sendData=function(e,t){var r=this.cmdProtobufCoded.newData(e),o=this.roomPduType.PUBLIC_DATA,n=0;if(void 0!==t&&null!=t&&""!=t){var i=room.getNodeId(t);null!=i&&(n=i,o=this.roomPduType.PRIVATE_DATA)}var a=this.cmdProtobufCoded.encodedPacket(o,0,room.selfUser.nodeId,n,r);this.signalingChannel.send(a)},e.prototype.userIndiction=function(e,t){var r=room.getNodeId(t),o=this.cmdProtobufCoded.newUserMsg(r,this.userMsgOpt.kickoff,e),n=this.cmdProtobufCoded.newUserIndiction(room.selfUser.nodeId,this.roomPduType.USER_MSG,o.toArrayBuffer()),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.USER_INDICTION,0,room.selfUser.nodeId,r,n);this.signalingChannel.send(i)},e.prototype.userMsg=function(e,t){var r=this.userMsgOpt.leave;if(t&&(r=this.userMsgOpt.kickoff),room&&room.selfUser&&room.selfUser.nodeId){var o=this.cmdProtobufCoded.newUserMsg(room.selfUser.nodeId,r,e),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.USER_MSG,0,room.selfUser.nodeId,0,o);this.signalingChannel.send(n)}},e.prototype.closeRoom=function(e){var t=this.cmdProtobufCoded.newCloseRoomReq(50,room.getNodeId(e),room.getRoomId()),r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.CLOSE_ROOM_REQ,0,room.selfUser.nodeId,0,t);this.signalingChannel.send(r)},e.prototype.videoPublishHandle=function(e,t,r){room.isMcu()?room.traceablePeerConnection.addSdp("video",e,t,r):this.pubRoomResourceMsg("video",t.id,null,e,r)},e.prototype.videoUnpublishHandle=function(e,t){room.isMcu()?room.traceablePeerConnection.reduceSdp("video",e,t):this.unpublishHandleP2P("video",room.selfUser.subMyVideosP2P,t,e)},e.prototype.videoSubscribleHandle=function(e,t,r){room.isMcu()?room.traceablePeerConnection.updateSdp("video",1,e,t,r):this.subscribleHandleP2P(e)},e.prototype.videoUnsubscribleHandle=function(e,t){room.isMcu()?room.traceablePeerConnection.updateSdp("video",0,e,null,t):this.unsubscribleHandleP2P("video",e)},e.prototype.changeSubscribedVideoQuality=function(e,t){if(room.isMcu()){var r=this.cmdProtobufCoded.newModifyResourceReq("60",e,t),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.MODIFY_RESOURCE_REQ,0,room.selfUser.nodeId,0,r);this.signalingChannel.send(o)}},e.prototype.screenPublishHandle=function(e,t,r){room.isMcu()?room.traceablePeerConnection.addSdp("screen",e,t,r):this.pubRoomResourceMsg("screen",t.id,null,e,r)},e.prototype.screenUnpublishHandle=function(e,t){room.isMcu()?room.traceablePeerConnection.reduceSdp("screen",e,t):this.unpublishHandleP2P("screen",room.selfUser.subMyScreensP2P,t,e)},e.prototype.screenSubscribleHandle=function(e,t){room.isMcu()?room.traceablePeerConnection.updateSdp("screen",1,e,null,t):this.subscribleHandleP2P(e)},e.prototype.screenUnsubscribleHandle=function(e,t){room.isMcu()?room.traceablePeerConnection.updateSdp("screen",0,e,null,t):this.unsubscribleHandleP2P("screen",e)},e.prototype.audioPublishHandle=function(e,t,r){room.isMcu()?room.traceablePeerConnection.addSdp("audio",e,t,r):this.pubRoomResourceMsg("audio",t.id,null,e,r)},e.prototype.audioUnpublishHandle=function(e,t){room.isMcu()?room.traceablePeerConnection.reduceSdp("audio",e,t):this.unpublishHandleP2P("audio",room.selfUser.subMyAudiosP2P,t,e)},e.prototype.audioBatchSubscribleHandle=function(e){room.traceablePeerConnection.audioBatchSdp(e)},e.prototype.audioSubscribleHandle=function(e,t){room.isMcu()?room.traceablePeerConnection.updateSdp("audio",1,e,null,t):this.subscribleHandleP2P(e)},e.prototype.audioUnsubscribleHandle=function(e,t){room.isMcu()?room.traceablePeerConnection.updateSdp("audio",0,e,null,t):this.unsubscribleHandleP2P("audio",e)},e.prototype.bindAudioToVideo=function(e,t,r){var o=this.cmdProtobufCoded.newBindAudioToVideoReq(e,t,r),n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.BIND_AUDIO_TO_VIDEO_REQ,0,room.selfUser.nodeId,0,o);this.signalingChannel.send(n)},e.prototype.sendOfferP2P=function(e,t){log.debug("===sendOfferP2P(),OFFER_REQ");var r=this.cmdProtobufCoded.newOfferReq(0,e,room.selfUser.nodeId),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OFFER_REQ,0,room.selfUser.nodeId,t,r);this.signalingChannel.send(o)},e.prototype.setRemoteP2P=function(e,t){log.debug("===masterServer.setRemoteP2P(),OFFER_REP");var r=this.cmdProtobufCoded.newOfferRep(0,1,"",e,room.selfUser.nodeId),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OFFER_REP,0,room.selfUser.nodeId,t,r);this.signalingChannel.send(o)},e.prototype.sendCandidateMsgP2P=function(e,t){var r=this.cmdProtobufCoded.newCandidateMsg(e.candidate,e.sdpMLineIndex,e.sdpMid,room.selfUser.nodeId),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.CANDIDATE_MSG,0,room.selfUser.nodeId,t,r);this.signalingChannel.send(o)},e.prototype.sendSubSdpOfferP2P=function(e,t,r){var o,n=e.info;if(n.stream.sdp=t,"offerSub"==r)log.debug("===masterServer.sendSubSdpOfferP2P(),send P2P SUB_ROOM_RESOURCE_REQ: "+room.selfUser.nodeId+"------\x3e"+n.owner_id),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REQ,0,room.selfUser.nodeId,n.owner_id,e);else if("answerSub"==r){log.debug("===masterServer.sendSubSdpOfferP2P(),send P2P SUB_ROOM_RESOURCE_REP: "+room.selfUser.nodeId+"------\x3e"+e.sub_node_id);var i=this.cmdProtobufCoded.newSubRoomResourceRep(0,1,"",n);o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REP,0,room.selfUser.nodeId,e.sub_node_id,i)}this.signalingChannel.send(o),this.signalingChannel.send("")},e.prototype.sendSubSdpAnswerP2P=function(e,t,r,o){var n;if(t.stream.sdp=r,"offerSub"==e){var i=this.cmdProtobufCoded.newSubRoomResourceRep(0,1,"",t);n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REP,0,room.selfUser.nodeId,o,i)}else if("answerSub"==e){var a=this.cmdProtobufCoded.newSubRoomResourceMsg(t,room.selfUser.nodeId,1);n=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,o,a)}this.signalingChannel.send(n),this.signalingChannel.send("")},e.prototype.subscribleHandleP2P=function(e){if(room.selfUser.nodeId>e.owner_id){e.stream.sdp="";var t=this.cmdProtobufCoded.newSubRoomResourceReq(0,e,room.selfUser.nodeId);log.info("===masterServer.subscribleHandleP2P(),SUB_ROOM_RESOURCE_REQ");var r=this.cmdProtobufCoded.encodedPacket(this.roomPduType.SUB_ROOM_RESOURCE_REQ,0,room.selfUser.nodeId,e.owner_id,t);this.signalingChannel.send(r),this.signalingChannel.send("")}else{t=this.cmdProtobufCoded.newSubRoomResourceReq(0,e,room.selfUser.nodeId);room.traceableP2PPeerConnection.sendSubSdpOfferP2P("offerSub",t)}},e.prototype.unpublishHandleP2P=function(e,t,r,o){if(null!=t&&0<t.length)for(var n=0;n<t.length;n++){var i=t[n];room.traceableP2PPeerConnection.removeStreamP2P(e,i,r),room.selfUser.nodeId>i?room.traceableP2PPeerConnection.sendUnSubSdpAnswerP2P("unpubAnswer",e,i,null):room.traceableP2PPeerConnection.sendUnSubSdpOfferP2P("unpubOffer",e,i,null)}var a;"video"==e?(a=this.mediaType.video,log.debug("===masterServer.unpublishHandleP2P(),send  video  UNPUB_ROOM_RESOURCE_MSG: "+room.selfUser.nodeId+"------\x3eservice")):"audio"==e?(a=this.mediaType.audio,log.debug("===masterServer.unpublishHandleP2P(),send  audio  UNPUB_ROOM_RESOURCE_MSG: "+room.selfUser.nodeId+"------\x3eservice")):"screen"==e&&(a=this.mediaType.desktop,log.debug("===masterServer.unpublishHandleP2P(),send  screen  UNPUB_ROOM_RESOURCE_MSG: "+room.selfUser.nodeId+"------\x3eservice"));var s=this.cmdProtobufCoded.newMediaStream(r.id,a,null),d=this.cmdProtobufCoded.newRoomResourceInfo(o,room.selfUser.nodeId,s),l=this.cmdProtobufCoded.newUnpubRoomResourceMsg(d),u=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UNPUB_ROOM_RESOURCE_MSG,0,room.selfUser.nodeId,0,l);this.signalingChannel.send(u),this.signalingChannel.send("")},e.prototype.unsubscribleHandleP2P=function(e,t){room.selfUser.nodeId>t.owner_id?room.traceableP2PPeerConnection.sendUnSubSdpAnswerP2P("unsubAnswer",e,t.owner_id,t):room.traceableP2PPeerConnection.sendUnSubSdpOfferP2P("unsubOffer",e,t.owner_id,t)},e.prototype.setRoomControl=function(e,t){var r=this.cmdProtobufCoded.newRoomControl(e,t),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ROOM_CONTROL,0,room.selfUser.nodeId,0,r);this.signalingChannel.send(o),this.signalingChannel.send("")},e.prototype.addBoardMsg=function(e,t){var r=t.backgroundColor.split(","),o=this.cmdProtobufCoded.newcolor(parseInt(255*parseFloat(r[3])),parseInt(r[0]),parseInt(r[1]),parseInt(r[2])),n=t.width,i=t.height;t.width!=t.outputWidth&&(n=t.outputWidth),t.height!=t.outputHeight&&(i=t.outputHeight),log.debug("===masterServer.addBoardMsg(),boardWidth:",n+",boardHeight:",i);var a=this.cmdProtobufCoded.newBoardObject(t.id,room.selfUser.nodeId,room.selfUser.id,n,i,o,t.backgroundImage,null,t.title,t.description,t.extendData),s=this.cmdProtobufCoded.newUpdateBoardMsg(e,room.selfUser.nodeId,room.selfUser.id,t.id,a),d=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_BOARD_MSG,0,room.selfUser.nodeId,0,s);this.signalingChannel.send(d),this.signalingChannel.send("")},e.prototype.removeBoardMsg=function(e,t){var r=this.cmdProtobufCoded.newUpdateBoardMsg(e,room.selfUser.nodeId,room.selfUser.id,t,null),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_BOARD_MSG,0,room.selfUser.nodeId,0,r);this.signalingChannel.send(o),this.signalingChannel.send("")},e.prototype.closeBoardMsg=function(e,t){var r=this.cmdProtobufCoded.newUpdateBoardMsg(e,room.selfUser.nodeId,room.selfUser.id,t,null),o=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_BOARD_MSG,0,room.selfUser.nodeId,0,r);this.signalingChannel.send(o),this.signalingChannel.send("")},e.prototype.shareBoardMsg=function(e,t,r){log.debug("===masterServer.shareBoardMsg operType: ",e," boardId: ",t);var o=r.backgroundColor.split(","),n=this.cmdProtobufCoded.newcolor(parseInt(255*parseFloat(o[3])),parseInt(o[0]),parseInt(o[1]),parseInt(o[2])),i=r.width,a=r.height;r.width!=r.outputWidth&&(i=r.outputWidth),r.height!=r.outputHeight&&(a=r.outputHeight);var s=this.cmdProtobufCoded.newBoardObject(r.id,room.selfUser.nodeId,room.selfUser.id,i,a,n,r.backgroundImage,null,r.title,r.description,r.extendData),d=this.cmdProtobufCoded.newUpdateBoardMsg(e,room.selfUser.nodeId,room.selfUser.id,t,s),l=this.cmdProtobufCoded.encodedPacket(this.roomPduType.UPDATE_BOARD_MSG,0,room.selfUser.nodeId,0,d);this.signalingChannel.send(l),this.signalingChannel.send("")},e.prototype.sendAddAnnotationMessage=function(e,t,r,o,n,i,a){var s=null,d=null,l=OperType.add,u=t._rectWithStroke?t._rectWithStroke:{},c=t.shape?t.shape:{},p=t.id,h=parseInt(u.x)?parseInt(u.x):0,f=parseInt(u.y)?parseInt(u.y):0,m=parseInt(u.x+u.width)?parseInt(u.x+u.width):0,g=parseInt(u.y+u.height)?parseInt(u.y+u.height):0,v={type:"",start:null,end:null,pointArray:[]},y=i,b=this.annotationType.annotation_tool_mouse;if(r==shapeTypeEnum.line)b=this.annotationType.annotation_tool_line,v.type="Annotation2Point",v.start=[parseInt(c.x1),parseInt(c.y1)],v.end=[parseInt(c.x2),parseInt(c.y2)];else if(r==shapeTypeEnum.rhomb){b=this.annotationType.annotation_tool_rhomb,v.type="Annotation2Point";var _=parseInt(c.points[0][0]),w=parseInt(c.points[3][1]),S=parseInt(c.points[2][0]),E=parseInt(c.points[1][1]);v.start=[_,w],v.end=[S,E]}else if(r==shapeTypeEnum.polyline)b=this.annotationType.annotation_tool_polyline,v.type="AnnotationMultiPoint",v.pointArray=c.points;else if(r==shapeTypeEnum.ellipse){b=this.annotationType.annotation_tool_ellipse,v.type="Annotation2Point";_=parseInt(c.cx-c.rx),w=parseInt(c.cy-c.ry),S=parseInt(c.cx+c.rx),E=parseInt(c.cy+c.ry);v.start=[_,w],v.end=[S,E]}else r==shapeTypeEnum.rect?(b=this.annotationType.annotation_tool_rectangle,v.type="Annotation2Point",v.start=[parseInt(c.x),parseInt(c.y)],v.end=[parseInt(c.x+c.width),parseInt(c.y+c.height)]):r==shapeTypeEnum.arrow?(b=this.annotationType.annotation_tool_arrow,v.type="Annotation2Point",v.start=[parseInt(c.x),parseInt(c.y)],v.end=[parseInt(c.x+c.width),parseInt(c.y+c.height)]):r==shapeTypeEnum.hlight_texttag?(b=this.annotationType.annotation_tool_hlight_texttag,v.type="Annotation2Point",v.start=[parseInt(c.x),parseInt(c.y)],v.end=[parseInt(c.x+c.width),parseInt(c.y+c.height)]):r==shapeTypeEnum.success?(b=this.annotationType.annotation_tool_success,v.type="Annotation2Point",v.start=[parseInt(c.x),parseInt(c.y)],v.end=[parseInt(c.x+c.width),parseInt(c.y+c.height)]):r==shapeTypeEnum.failure?(b=this.annotationType.annotation_tool_failure,v.type="Annotation2Point",v.start=[parseInt(c.x),parseInt(c.y)],v.end=[parseInt(c.x+c.width),parseInt(c.y+c.height)]):r==shapeTypeEnum.hlight_point&&(b=this.annotationType.annotation_tool_hlight_point,v.type="Annotation2Point",v.start=[parseInt(t.position[0]+t.style.width/2),parseInt(t.position[1]+t.style.height/2)],v.end=[parseInt(t.position[0]+t.style.width/2),parseInt(t.position[1]+t.style.height/2)]);var I=function(e){var t=e.split("(")[1].split(")")[0].split(",");4<=t.length||(t[3]=1);return t}(o),T=(o=this.cmdProtobufCoded.newcolor(parseInt(255*parseFloat(I[3])),parseInt(I[0]),parseInt(I[1]),parseInt(I[2])),null);a==fillTypeEnum.none?T=this.cmdProtobufCoded.newcolor(0,255,255,255):a==fillTypeEnum.full&&(T=o),log.debug("===masterServer.sendAddAnnotationMessage(),room.boardOutputXRati:"+room.boardOutputXRatio+",room.boardOutputYRatio:"+room.boardOutputYRatio),log.debug("===masterServer.sendAddAnnotationMessage(),minY:",f+",maxY:",g+",minX:"+h+",maxX:"+m);var R=Math.round(f*room.boardOutputYRatio),C=Math.round(g*room.boardOutputYRatio),P=Math.round(h*room.boardOutputXRatio),M=Math.round(m*room.boardOutputXRatio);log.debug("===masterServer.sendAddAnnotationMessage(),outputMinY:",R+",outputMaxY:",C+",outputMinX:"+P+",outputMaxX:"+M);var x=this.cmdProtobufCoded.newRect(R,C,P,M),A=this.cmdProtobufCoded.newAnnotationObject(e,p,room.selfUser.nodeId,room.selfUser.id,b,y,n,o,T,x);if("Annotation2Point"==v.type){_=v.start[0],w=v.start[1],S=v.end[0],E=v.end[1];log.debug("===masterServer.sendAddAnnotationMessage(),Annotation2Point startX:"+_+",startY:"+w+",endX:"+S+",endY:"+E);var k=Math.round(_*room.boardOutputXRatio),O=Math.round(w*room.boardOutputYRatio),U=Math.round(S*room.boardOutputXRatio),L=Math.round(E*room.boardOutputYRatio);log.debug("===masterServer.sendAddAnnotationMessage(),Annotation2Point outputStartX:"+k+",outputStartY:"+O+",outputEndX:"+U+",outputEndY:"+L);var D=this.cmdProtobufCoded.newPoint(k,O),N=this.cmdProtobufCoded.newPoint(U,L);s=this.cmdProtobufCoded.newAnnotation2Point(A,D,N)}else if("AnnotationMultiPoint"==v.type){var B=[];log.debug("===masterServer.sendAddAnnotationMessage(),pointObj.pointArray ",v.pointArray);for(var j=0;j<v.pointArray.length;j++){var V=v.pointArray[j];log.debug("===masterServer.sendAddAnnotationMessage(),pointValue:",V);var F=parseInt(V[0]),q=parseInt(V[1]);if(log.debug("===masterServer.sendAddAnnotationMessage(),AnnotationMultiPoint x:"+F+",y:"+q),F&&q){var G=Math.round(F*room.boardOutputXRatio),H=Math.round(q*room.boardOutputYRatio);log.debug("===masterServer.sendAddAnnotationMessage(),AnnotationMultiPoint outputX:"+G+",outputY:"+H);var W=this.cmdProtobufCoded.newPoint(G,H);B.push(W)}}d=this.cmdProtobufCoded.newAnnotationMultiPoint(A,B)}var Y=this.cmdProtobufCoded.newUpdateAnnotationMsg(l,e,r,p,room.selfUser.nodeId,room.selfUser.id,s,d,null);room.addAnnotationMsg(Y,!0);var z=this.roomPduType.UPDATE_ANNOTATION_MSG,K=this.cmdProtobufCoded.encodedPacket(z,0,room.selfUser.nodeId,0,Y);this.signalingChannel.send(K)},e.prototype.sendRemoveAnnotationMessage=function(e,t,r){var o=r,n=OperType.remove;t==shapeTypeEnum.clear&&(o=null);var i=this.cmdProtobufCoded.newUpdateAnnotationMsg(n,e,t,o,room.selfUser.nodeId,room.selfUser.id);t==shapeTypeEnum.clear?room.addAnnotationMsg(i,!0,!0):room.addAnnotationMsg(i,!0);var a=this.roomPduType.UPDATE_ANNOTATION_MSG,s=this.cmdProtobufCoded.encodedPacket(a,0,room.selfUser.nodeId,0,i);this.signalingChannel.send(s)},e.prototype.createServerRecorder=function(e,t,r,o,n,i,a,s,d,l,u,c){var p,h=when.defer(),f=getRandomNum(2e3,8e3);switch(n){case exporterTypeEnum.record:p=this.exporterType.EXPORTER_TYPE_RECORD;break;case exporterTypeEnum.record_real_time:p=this.exporterType.EXPORTER_TYPE_RECORD_REAL_TIME;break;case exporterTypeEnum.liver:p=this.exporterType.EXPORTER_TYPE_LIVER;break;case exporterTypeEnum.avc_media_mixer:p=this.exporterType.EXPORTER_TYPE_AVC_MEDIA_MIXER}var m=this.cmdProtobufCoded.newOutgoingCreateStreamsExporterReq(f,e,t,r,o,p,i,a,s,d,u,!0,0,0,"","",l,c),g=this.roomPduType.OUTGOING_CREATE_STREAMS_EXPORTER_REQ;log.debug("===masterServer.createServerRecorder(),outgoingCreateStreamsExporterReq:",m);var v=this.cmdProtobufCoded.encodedPacket(g,0,room.selfUser.nodeId,0,m);this.signalingChannel.send(v);var y=setTimeout(function(){var e=new T(1e4,"createServerRecorder time out");h.reject(e)},5e3);return room.addCallback(ExporderCallBack.create_server_recorder_rep_success,function(e,t,r,o){if(e==f){var n={exporter_id:t,exporter_name:r,play_urls:o};h.resolve(n),clearTimeout(y)}}),room.addCallback(ExporderCallBack.create_server_recorder_rep_error,function(e,t){t==f&&(h.reject(e),clearTimeout(y))}),h.promise},e.prototype.selectStream4Exporter=function(e,t,r,o,n,i,a){var s=when.defer(),d=getRandomNum(2e3,8e3),l=this.cmdProtobufCoded.newOutgoingSelectStreamReq(d,e,t,r,o,n,i,a),u=this.roomPduType.OUTGOING_SELECT_STREAM_REQ,c=this.cmdProtobufCoded.encodedPacket(u,0,room.selfUser.nodeId,0,l);this.signalingChannel.send(c);var p=setTimeout(function(){var e=new T(1e4,"selectStream4Exporter time out");s.reject(e)},5e3);return room.addCallback(ExporderCallBack.select_stream_rep_success,function(e,t){if(e==d){var r={exporter_id:t};s.resolve(r),clearTimeout(p)}}),room.addCallback(ExporderCallBack.select_stream_rep_error,function(e,t){t==d&&(s.reject(e),clearTimeout(p))}),s.promise},e.prototype.mixMedia4Exporter=function(e,t,r,o,n,i){log.debug("===masterServer.mixMedia4Exporter(),videoItems:",o);var a,s=when.defer(),d=getRandomNum(2e3,8e3),l=[];if(log.debug("===masterServer.mixMedia4Exporter(),videoItems:",o),o&&0<o.length)for(var u=0;u<o.length;u++){var c=o[u];log.debug("===masterServer.mixMedia4Exporter(),videoItem:",c);var p=c.userId,h=c.zorder,f=c.x,m=c.y,g=c.width,v=c.height,y=c.deviceId,b=c.videoData,_=this.cmdProtobufCoded.newOutgoingVideoInfo(p,h,f,m,g,v,y,b);log.debug("===masterServer.mixMedia4Exporter(),videoInfo:",_),l.push(_)}r==viewLayoutModeEnum.fixation?a=this.outGoingViewLayoutMode.Outgoing_View_Layout_Fixation:r==viewLayoutModeEnum.auto?a=this.outGoingViewLayoutMode.Outgoing_View_Layout_Auto:r==viewLayoutModeEnum.auto_orato&&(a=this.outGoingViewLayoutMode.Outgoing_View_Layout_Auto_Orato);var w=this.cmdProtobufCoded.newOutgoingMixStreamsReq(d,e,t,a,l,n,i);log.debug("===masterServer.mixMedia4Exporter(),mixStreamsReq:",w);var S=this.roomPduType.OUTGOING_MIX_STREAMS_REQ,E=this.cmdProtobufCoded.encodedPacket(S,0,room.selfUser.nodeId,0,w);this.signalingChannel.send(E);var I=setTimeout(function(){var e=new T(1e4,"mixMedia4Exporter time out");s.reject(e)},5e3);return room.addCallback(ExporderCallBack.mix_media_rep_success,function(e,t){if(e==d){var r={exporter_id:t};s.resolve(r),clearTimeout(I)}}),room.addCallback(ExporderCallBack.mix_media_rep_error,function(e,t){t==d&&(s.reject(e),clearTimeout(I))}),s.promise},e.prototype.pauseResumeExporter=function(e,t,r,o){var n=when.defer(),i=getRandomNum(2e3,8e3),a=this.cmdProtobufCoded.newOutgoingPauseResumeExporterReq(i,e,t,r,o),s=this.roomPduType.OUTGOING_PAUSE_RESUME_EXPORTER_REQ,d=this.cmdProtobufCoded.encodedPacket(s,0,room.selfUser.nodeId,0,a);this.signalingChannel.send(d);var l=setTimeout(function(){var e=new T(1e4,"pauseResumeExporter time out");n.reject(e)},5e3);return room.addCallback(ExporderCallBack.pause_stream_rep_success,function(e,t){if(e==i){var r={exporter_id:t};n.resolve(r),clearTimeout(l)}}),room.addCallback(ExporderCallBack.pause_stream_rep_error,function(e,t){t==i&&(n.reject(e),clearTimeout(l))}),n.promise},e.prototype.destroyExporter=function(e,t,r){var o=when.defer(),n=getRandomNum(2e3,8e3),i=this.cmdProtobufCoded.newOutgoingDestroyExporterReq(n,e,t,r),a=this.roomPduType.OUTGOING_DESTROY_EXPORTER_REQ,s=this.cmdProtobufCoded.encodedPacket(a,0,room.selfUser.nodeId,0,i);this.signalingChannel.send(s);var d=setTimeout(function(){var e=new T(1e4,"destroyExporter time out");o.reject(e)},5e3);return room.addCallback(ExporderCallBack.stop_stream_rep_success,function(e,t){if(e==n){var r={exporter_id:t};o.resolve(r),clearTimeout(d)}}),room.addCallback(ExporderCallBack.stop_stream_rep_error,function(e,t){t==n&&(o.reject(e),clearTimeout(d))}),o.promise},e.prototype.updateExporterStreamName=function(e){var r=when.defer(),o=getRandomNum(1e4,12e3),t=room.setDeviceIdByUUID(0,e.id),n=this.cmdProtobufCoded.newRoomSetStreamNameReq(o,room.id,e.ownerId,t,e.streamName,e.streamNickName),i=this.cmdProtobufCoded.encodedPacket(this.roomPduType.ROOM_SET_STREAM_NAME_REQ,0,room.selfUser.nodeId,0,n);this.signalingChannel.send(i),this.signalingChannel.send("");var a=setTimeout(function(){var e=new T(1e4,"updateExporterStreamName time out");r.reject(e)},5e3);return room.addCallback(UserCallback.room_set_stream_name_rep_success,function(e){e==o&&(r.resolve(),clearTimeout(a))}),room.addCallback(UserCallback.room_set_stream_name_rep_error,function(e,t){t==o&&(r.reject(e),clearTimeout(a))}),r.promise},e.prototype.outgoingExporterSetFocusVideo=function(e,t,r){var o=when.defer(),n=getRandomNum(1e4,12e3),i=this.cmdProtobufCoded.newOutgoingExporterSetFocusVideoReq(n,room.id,e,t,r),a=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OUTGOING_EXPORTER_SET_FOCUS_VIDEO_REQ,0,room.selfUser.nodeId,0,i);this.signalingChannel.send(a),this.signalingChannel.send("");var s=setTimeout(function(){var e=new T(1e4,"outgoingExporterSetFocusVideo time out");o.reject(e)},5e3);return room.addCallback(ExporderCallBack.set_focus_video_rep_success,function(e){e==n&&(o.resolve(),clearTimeout(s))}),room.addCallback(ExporderCallBack.set_focus_video_rep_error,function(e,t){t==n&&(o.reject(e),clearTimeout(s))}),o.promise},e.prototype.outgoingGetExporterInfo=function(e,t,r){var o=when.defer(),n=getRandomNum(1e4,12e3),i=this.cmdProtobufCoded.newOutgoingGetExporterInfoReq(n,e,t,r);log.debug("===masterServer.outgoingGetExporterInfo(),outgoingGetExporterInfoReq:",i);var a=this.cmdProtobufCoded.encodedPacket(this.roomPduType.OUTGOING_GET_EXPORTER_INFO_REQ,0,room.selfUser.nodeId,0,i);this.signalingChannel.send(a),this.signalingChannel.send("");var s=setTimeout(function(){var e=new T(1e4,"outgoingGetExporterInfo time out");o.reject(e)},5e3);return room.addCallback(ExporderCallBack.get_exporter_info_rep_success,function(e,t,r){e==n&&(o.resolve(t,r),clearTimeout(s))}),room.addCallback(ExporderCallBack.get_exporter_info_rep_error,function(e,t){t==n&&(o.reject(e),clearTimeout(s))}),o.promise},e}),ModuleBase.define("P2PServer",["TraceableP2PPeerConnection"],function(e){var t=function(){this.selfNodeIntervalId=null,this.traceableP2PPeerConnection=new e,room.traceableP2PPeerConnection=this.traceableP2PPeerConnection};function r(e){room.selfUser.nodeId<e&&(null!=this.selfNodeIntervalId&&(clearInterval(this.selfNodeIntervalId),this.selfNodeIntervalId=null),room.traceableP2PPeerConnection.getToP2PPeerConnection(e))}return t.prototype.createP2PPeerConnection=function(e){null!=room.selfUser&&null!=room.selfUser.nodeId?r(e):this.selfNodeIntervalId=setInterval(function(){null!=room.selfUser&&null!=room.selfUser.nodeId&&r(e)},200)},t});var log=log4javascript.getLogger(),room,rooms=[],browserDetect,videoCoding=VideoCodingType.VP8,audioCoding=AudioCodingType.PCMU,audioAutoSub=!0,audioBatchEnabled=!1,clientIsUseCascade=!1,mediaConnectType=0,simulcastEnabled=!1,dataCrypto=DataCryptoType.AES128,bugout=null,_levelValue=log4javascript.Level.INFO.level,_appSign=null,_appFunName=null,avdVersion="4.0.4.1",setRemoteDescriptionSuccess=!1,setRemoteDescriptionSuccessForFirefox=!1,addIcecandidateList=[],remoteSDPInit;function getFingerPrint(e){var t=null;console.log(e);for(var r=e.split("\r\n"),o=0;o<r.length;o++)if(-1<r[o].indexOf("a=fingerprint")){t=r[o].split(" ")[1];break}return console.log(t),t}function updateSDPFingerPrint(e,t){var r=preferLineSdp(e,"a=","fingerprint");if(null!=r&&0<r.length)for(var o=0;o<r.length;o++){var n=r[o];e=e.replace(n,"a=fingerprint:sha-1 "+t)}return e}function updateSDPIceUfrag(e,t){var r=preferLineSdp(e,"a=","ice-ufrag");if(null!=r&&0<r.length)for(var o=0;o<r.length;o++){var n=r[o];e=e.replace(n,"a=ice-ufrag:"+t)}return e}function updateSDPIcePwd(e,t){var r=preferLineSdp(e,"a=","ice-pwd");if(null!=r&&0<r.length)for(var o=0;o<r.length;o++){var n=r[o];e=e.replace(n,"a=ice-pwd:"+t)}return e}function updateSDPSetup(e,t){var r=preferLineSdp(e,"a=","setup");if(null!=r&&0<r.length)for(var o=0;o<r.length;o++){var n=r[o];e=e.replace(n,"a=setup:"+t)}return e}function preferLineSdp(e,t,r){var o=[],n=e.split("\r\n"),i=findLine(n,t,r);if(null!=i&&0<i.length)for(var a=0;a<i.length;a++)o.push(n[i[a]]);return o}function findLine(e,t,r){return findLineInRange(e,0,-1,t,r)}function findLineInRange(e,t,r,o,n){for(var i=[],a=-1!==r?r:e.length,s=t;s<a;++s)0===e[s].indexOf(o)&&(n&&-1===e[s].toLowerCase().indexOf(n.toLowerCase())||i.push(s));return i}function findLine1(e,t,r){return findLineInRange1(e,0,-1,t,r)}function findLineInRange1(e,t,r,o,n){for(var i=-1!==r?r:e.length,a=t;a<i;++a)if(0===e[a].indexOf(o)&&(!n||-1!==e[a].toLowerCase().indexOf(n.toLowerCase())))return a;return null}function preferBitRate(e,t,r){if(null==t||t<=0)return-1===e.indexOf("b=AS:")||(e=e.replace(/b=AS:.*\r\n/,"").replace(/b=TIAS:.*\r\n/,"")),e;var o=e.split("\r\n"),n=findLine1(o,"m=",r);if(null===n)return trace("Failed to add bandwidth line to sdp, as no m-line found"),e;var i=findLineInRange1(o,n+1,-1,"m=");null===i&&(i=o.length);var a=findLineInRange1(o,n+1,i,"c=");if(null===a)return trace("Failed to add bandwidth line to sdp, as no c-line found"),e;var s=findLineInRange1(o,a+1,i,"b=AS");s&&o.splice(s,1);var d="b=AS:"+t;return o.splice(a+1,0,d),e=o.join("\r\n")}function addAudioNack(e,t){var r=e.split("\r\n"),o=findLine(r,"m=","audio");if(null===o)return console.log("addAudioNack(),Failed to add audio nack line to sdp, as no m-line found"),e;var n=findLineInRange1(r,o+1,-1,"m=");null===n&&(n=r.length);for(var i,a=!1,s=null,d=o;d<n;++d)if(0<=r[d].indexOf(t)){s=r[d].split(" ")[0].split(":")[1],i=d;break}if(s){var l="a=rtcp-fb:"+s+" nack";for(d=o;d<n;++d)if(0<=r[d].indexOf(l)){a=!0;break}a||(r.splice(i+1,0,l),e=r.join("\r\n"))}return e}ModuleBase.define("AVDEngine",["Room","RestServer","Error","BrowserDetect","Record","Live","Outgoing","StreamExporterManager","ElectronManager","RtmManager","InviteManager"],function(t,i,d,e,r,o,n,a,s,l,u){var c=function(){this.accessToken,this.cameraMap={},this.microphoneMap={},this.speakerMap={},this.hasCamera=!1,this.hasMicrophone=!1,this.hasSpeaker=!1,this.checkVideoStream=null,this.checkAudioStream=null,this.checkAudioLocalStatsCollector=null,this.checkMicrophoneId=null,this.checkMicrophoneName=null,this.mcuClusterRouteParams=null,this.defaultVideoParamsWidth=640,this.defaultVideoParamsHeight=480,this.defaultVideoParamsResolutionSetType=ResolutionSetType.ideal,this.defaultVideoParamsFrameRate=20,this.defaultScreenParamsMaxWidth=1920,this.defaultScreenParamsMaxHeight=1080,this.defaultScreenParamsMinFrameRate=5,this.defaultScreenParamsMaxFrameRate=10,this.defaultMediaPublishKeepAliveTime=15e3,this.detect=this.getBrowserDetect(),this.browserName=this.detect.browser.name,this.fullVersion=this.detect.browser.fullVersion,this.majorVersion=this.fullVersion.split(".")[0],this.browserOsName=this.detect.osName,this.isChrome=this.detect.isChrome,this.isOpera=this.detect.isOpera,this.isIE=this.detect.isIE,this.isFirefox=this.detect.isFirefox,this.isSafari=this.detect.isSafari,this.isMicroMessenger=this.detect.isMicroMessenger,this.isUCBrowser=this.detect.isUCBrowser,this.clientResource=new Object,this.applyToElectron=!1,this.electronProtocol="http:",this.electronManager=null,this.appender=new log4javascript.BrowserConsoleAppender,this.appender.setThreshold(log4javascript.Level.INFO),p(this.appender),loggerReport=new LoggerReport};function p(e){var t=new log4javascript.PatternLayout("%d{yyyy-MM-dd HH:mm:ss SSS} %-5p - %m{1}%n");e.setLayout(t),log.addAppender(e)}return c.prototype.getVersion=function(){return"cn.tee3.avd-"+avdVersion},c.prototype.setApplyToElectron=function(e,t){log.info("===avdEngine.setApplyToElectron(),islectron:"+e+",protocolStr:"+t),loggerReport.info("avdEngine.setApplyToElectron(),islectron:"+e+",protocolStr:"+t),e&&(this.applyToElectron=e),t&&(this.electronProtocol=t)},c.prototype.getElectronManager=function(){return this.electronManager=new s,this.electronManager},c.prototype.setSimulcastEnabled=function(e){this.isChrome&&this.majorVersion<73?(simulcastEnabled=!1,log.info("===avdEngine.setSimulcastEnabled(),Chromer73"),loggerReport.info("avdEngine.setSimulcastEnabled(),Chromer73")):this.isFirefox?(simulcastEnabled=!1,log.info("===avdEngine.setSimulcastEnabled(),firefox")):(simulcastEnabled=e,log.info("===avdEngine.setSimulcastEnabled(),:"+e),loggerReport.info("avdEngine.setSimulcastEnabled(),:"+e))},c.prototype.setAudioBatchEnabled=function(e){audioBatchEnabled=e,log.info("===avdEngine.setAudioBatchEnabled(),,:"+e),loggerReport.info("avdEngine.setAudioBatchEnabled(),,:"+e)},c.prototype.getBrowserDetect=function(){return(new e).detect},c.prototype.checkBrowserSupport=function(){return(new e).checkBrowserSupport()},c.prototype.checkBrowserPluginSupport=function(){return(new e).checkBrowserPluginSupport()},c.prototype.setLog=function(e,t){e==Appender.alert?this.appender=new log4javascript.AlertAppender:e==Appender.inpage?this.appender=new log4javascript.InPageAppender:e==Appender.popup?this.appender=new log4javascript.PopUpAppender:Appender.browserConsole,t==LogLevel.all?(_levelValue=log4javascript.Level.ALL.level,this.appender.setThreshold(log4javascript.Level.ALL)):t==LogLevel.trace?(_levelValue=log4javascript.Level.TRACE.level,this.appender.setThreshold(log4javascript.Level.TRACE)):t==LogLevel.debug?(_levelValue=log4javascript.Level.DEBUG.level,this.appender.setThreshold(log4javascript.Level.DEBUG)):t==LogLevel.info?(_levelValue=log4javascript.Level.INFO.level,this.appender.setThreshold(log4javascript.Level.INFO)):t==LogLevel.warn?(_levelValue=log4javascript.Level.WARN.level,this.appender.setThreshold(log4javascript.Level.WARN)):t==LogLevel.error?(_levelValue=log4javascript.Level.ERROR.level,this.appender.setThreshold(log4javascript.Level.ERROR)):t==LogLevel.fatal?(_levelValue=log4javascript.Level.FATAL.level,this.appender.setThreshold(log4javascript.Level.FATAL)):t==LogLevel.off&&(_levelValue=log4javascript.Level.OFF.level,this.appender.setThreshold(log4javascript.Level.OFF)),p(this.appender)},c.prototype.setBugout=function(e){(bugout=new debugout).realTimeLoggingOn=!1,bugout.useTimestamps=!0,e&&(bugout.logFilename=e,log.info("===avdEngine.setBugout(),logFilename:"+e),loggerReport.info("avdEngine.setBugout(),logFilename:"+e))},c.prototype.setReportLogger=function(e,t){"string"==typeof e?"function"==typeof t?(_appSign=e,_appFunName=t):log.error("===avdEngine.setReportLogger(),appFunName setting invalid"):log.error("===avdEngine.setReportLogger(),appSign setting invalid")},c.prototype.setVideoCoding=function(e){void 0===e?log.error("===avdEngine.setVideoCoding(),videoCodingType"+e):(videoCoding=e,log.info("===avdEngine.setVideoCoding(),:"+videoCoding),loggerReport.info("avdEngine.setVideoCoding(),:"+videoCoding))},c.prototype.getVideoCoding=function(){return videoCoding},c.prototype.setAudioCoding=function(e){void 0===e?log.error("===avdEngine.setAudioCoding(),audioCodingType"+e):(audioCoding=e,log.info("===avdEngine.setAudioCoding(),:"+audioCoding),loggerReport.info("avdEngine.setAudioCoding(),:"+audioCoding))},c.prototype.getAudioCoding=function(){return audioCoding},c.prototype.setAudioAutoSub=function(e){audioAutoSub=e,log.info("===avdEngine.setAudioAutoSub(),:"+e),loggerReport.info("avdEngine.setAudioAutoSub(),:"+e)},c.prototype.getAudioAutoSub=function(){return audioAutoSub},c.prototype.setMediaConnectType=function(e){mediaConnectType=e,log.info("===avdEngine.setMediaConnectType(),:"+mediaConnectType),loggerReport.info("avdEngine.setMediaConnectType(),:"+mediaConnectType)},c.prototype.getMediaConnectType=function(){return mediaConnectType},c.prototype.setDataCryptoType=function(e){void 0===e?log.error("===avdEngine.setDataCryptoType(),dataCryptoType"+e):(dataCrypto=e,log.info("===avdEngine.setDataCryptoType(),:"+dataCrypto),loggerReport.info("avdEngine.setDataCryptoType(),:"+dataCrypto))},c.prototype.getDataCryptoType=function(){return dataCrypto},c.prototype.getResolutionEnum=function(){var e=when.defer();return e.resolve(Resolution),e.promise},c.prototype.setMcuClusterRouteParams=function(e){this.mcuClusterRouteParams=e},c.prototype.setDefaultVideoParams=function(e,t,r,o){e&&(this.defaultVideoParamsWidth=e),t&&(this.defaultVideoParamsHeight=t),r&&(this.defaultVideoParamsResolutionSetType=r),o&&(this.defaultVideoParamsFrameRate=o),log.info("===avdEngine.setDefaultVideoParams(),,:"+e+",:"+t+",:"+r+",:"+o),loggerReport.info("avdEngine.setDefaultVideoParams(),,:"+e+",:"+t+",:"+r+",:"+o)},c.prototype.setDefaultScreenParams=function(e,t,r,o){e&&(this.defaultScreenParamsMaxWidth=e),t&&(this.defaultScreenParamsMaxHeight=t),r&&(this.defaultScreenParamsMinFrameRate=r),o&&(this.defaultScreenParamsMaxFrameRate=o),log.info("===avdEngine.setDefaultScreenParams(),,:"+e+",:"+t+",:"+r+",:"+o),loggerReport.info("avdEngine.setDefaultScreenParams(),,:"+e+",:"+t+",:"+r+",:"+o)},c.prototype.setDefaultMediaPublishKeepAliveTime=function(e){e&&(this.defaultMediaPublishKeepAliveTime=e),log.info("===avdEngine.setDefaultMediaPublishKeepAliveTime(),(),keepAliveTime:"+e)},c.prototype.init=function(e,t,r){void 0===r&&(r=!1),clientIsUseCascade=r;var a=when.defer();log.info("===avdEngine.init(),, serverURI:"+e+",accessToken:"+t+",isUseCascade:"+r),loggerReport.info("avdEngine.init(),,serverURI:"+e+",accessToken:"+t+",isUseCascade:"+r);var s=this;if(!t||!e){var o=new d(ErrorConstant.avdEngine_init_failed);return a.reject(o),a.promise}var n=null;return n=this.applyToElectron?new i(this.electronProtocol):new i,this.accessToken=t.replace(/%3D%3D/g,"=="),this.accessToken=this.accessToken.replace(/%3d%3d/g,"=="),n.getServerinfo(e,t,r).then(function(){loggerReportConfig.open_logger&&1==parseInt(loggerReportConfig.open_logger)&&loggerReport.start(),log.info("===avdEngine.init(),"),loggerReport.info("");var e=s.getVersion();log.info("===avdEngine.init(),JS SDK "+e),loggerReport.info("JS SDK "+e),log.info("===avdEngine.init(),"+s.browserName+",:"+s.fullVersion+",:"+s.browserOsName),loggerReport.info(""+s.browserName+",:"+s.fullVersion+",:"+s.browserOsName),s.isFirefox&&"Android"==s.browserOsName&&videoCoding==VideoCodingType.VP8&&(log.info("===avdEngine.init(), Android FirefoxVP8, H264"),videoCoding=VideoCodingType.H264),log.info("===avdEngine.init(),:"+videoCoding),loggerReport.info(":"+videoCoding),log.info("===avdEngine.init(),:"+audioCoding),loggerReport.info(":"+audioCoding);var t={},r=new UAParser(navigator.userAgent);if(r){var o=r.getOS();o&&(s.clientResource.os=o.name+"_"+o.version);var n=r.getBrowser();n&&(t.browser=n.name+"_"+n.version)}if(s.detect.browser.is3Tee&&(t.browserShell=s.detect.browser.shellName+"_"+s.detect.browser.shellFullVersion),s.clientResource.endpoint=t,void 0!==navigator.Promise&&getLocalClientIP().then(function(e){log.debug("===avdEngine.init(),localClientIP:",e),s.clientResource.ips=e}),void 0!==navigator.connection){var i=getEffectiveType();log.debug("===avdEngine.init(),effectiveType:"+i),s.clientResource.net=i}a.resolve()}).otherwise(function(e){if(loggerReport.error("===avdEngine.init(),error:"+e.message),e)a.reject(e);else{var t=new d(ErrorConstant.avdEngine_init_failed);a.reject(t)}}),a.promise},c.prototype.initWithOEM=function(e,t){var r=when.defer();if(log.info("===avdEngine.initWithOEM(), OEM  init begin"),"qiniu.com"!=t){var o=new d(ErrorConstant.oemname_notfound);r.reject(o)}else roomServerUrl=mcuServerUrl=e,is_cluster=!0,r.resolve();return r.promise},c.prototype.obtainRoom=function(e){return null==(room=function(e){for(var t=null,r=0;r<rooms.length;r++){var o=rooms[r];if(o.roomId==e){t=o;break}}return t}(e))&&((room=new t(e)).avdEngine=this,rooms.push(room)),"Android"==this.browserOsName&&(room.userAgent=USER_AGENT_AVD_VIDEO_TRANSCODING),room},c.prototype.getAllDevices=function(){var t=when.defer();if(void 0!==navigator.mediaDevices)log.debug("===avdEngine.getAllDevices(), by navigator.mediaDevices.enumerateDevices()"),navigator.mediaDevices.enumerateDevices().then(function(e){t.resolve(e)});else if("undefined"!=typeof MediaStreamTrack)if(void 0!==MediaStreamTrack.getSources)log.debug("===avdEngine.getAllDevices(),by MediaStreamTrack.getSources"),MediaStreamTrack.getSources(function(e){t.resolve(e)});else{var e=new d(ErrorConstant.navigatorUserMediaError_notSupportedError);t.reject(e)}else{e=new d(ErrorConstant.not_support_mediaStreamTrack);t.reject(e)}return t.promise},c.prototype.initDevice=function(){var o=when.defer(),r=this;if(log.info("===avdEngine.initDevice():Camera and Microphone begin..."),r.isChrome&&r.majorVersion<81)r.initDeviceHandler().then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)});else if(r.isFirefox){var e={audio:{deviceId:"undefined"},video:{deviceId:"undefined"}};log.debug("===avdEngine.initDevice(),firefox constraints:"+JSON.stringify(e)),navigator.mediaDevices.getUserMedia(e).then(function(t){r.initDeviceHandler().then(function(e){t&&(t.getTracks().forEach(function(e){e.stop()}),t=null),o.resolve(e)}).otherwise(function(e){o.reject(e)})}).catch(function(e){log.error("===avdEngine.initDevice(),navigator.MediaDevices.getUserMedia of firfox error: ",e.message,e.name);var t,r=ModuleBase.use(ModulesEnum.error);t="NotSupportedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new r(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new r(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notFoundError):new r(ErrorConstant.navigatorUserMediaError_unknown),o.reject(t)})}else r.checkDevice().then(function(e){if(e.deviceIdIsUndefined){log.debug("===AVDEngine.initDevice(),chrome Version >= 81 or Other browsers ,deviceId is Undefined");var t={};if(e.video&&(t.video={deviceId:"undefined"}),e.audio&&(t.audio={deviceId:"undefined"}),log.debug("===avdEngine.initDevice(),chrome version>=81 or Other browsers,constraints:"+JSON.stringify(t)),!e.video&&!e.audio)return o.resolve(1),o.promise;navigator.mediaDevices.getUserMedia(t).then(function(e){e&&(e.getTracks().forEach(function(e){e.stop()}),e=null),r.initDeviceHandler().then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)})}).catch(function(e){log.error("===avdEngine.initDevice(),navigator.MediaDevices.getUserMedia error: ",e.message,e.name);var t,r=ModuleBase.use(ModulesEnum.error);t="NotSupportedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new r(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new r(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notFoundError):new r(ErrorConstant.navigatorUserMediaError_unknown),o.reject(t)})}else log.debug("===AVDEngine.initDevice(),chrome Version >= 81 or Other browsers,deviceId is not Undefined"),r.initDeviceHandler().then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)})}).otherwise(function(e){o.reject(e)});return o.promise},c.prototype.initDeviceHandler=function(){var v=when.defer(),y=this;return this.getAllDevices().then(function(e){for(var t={},r=0,o={},n=0,i=null,a={},s=0,d=null,l=0;l!=e.length;++l){var u=e[l],c=u.deviceId||u.id;"videoinput"===u.kind||"video"===u.kind?(y.hasCamera=!0,r+=1,t[c]=u.label||"camera"+r):"audioinput"===u.kind||"audio"===u.kind?(y.hasMicrophone=!0,"default"==u.deviceId?(n+=1,o[c]=u.label||"microphone"+n,i=u.groupId):u.groupId!=i&&(n+=1,o[c]=u.label||"microphone"+n)):"audiooutput"===u.kind&&(y.hasSpeaker=!0,"default"==u.deviceId?(s+=1,a[c]=u.label||"speaker"+s,d=u.groupId):u.groupId!=d&&(s+=1,a[c]=u.label||"speaker"+s))}for(var p in y.cameraMap=t,log.info("===avdEngine.initDevice(),Camera finish,cameraMap:",JSON.stringify(t)),y.clientResource.cameras=[],t){var h=t[p],f=new Object;f.id=p,f.name=h,y.clientResource.cameras.push(f)}for(var p in y.microphoneMap=o){h=o[p];y.checkMicrophoneId=p,y.checkMicrophoneName=h;break}for(var p in log.info("===avdEngine.initDevice(),Microphone finish,microphoneMap:",JSON.stringify(o)),y.clientResource.microphones=[],o){h=o[p];var m=new Object;m.id=p,m.name=h,y.clientResource.microphones.push(m)}for(var p in y.speakerMap=a,log.info("===avdEngine.initDevice(),Speaker finish,speakerMap:",JSON.stringify(a)),y.clientResource.speakers=[],a){h=a[p];var g=new Object;g.id=p,g.name=h,y.clientResource.speakers.push(g)}v.resolve(1)}).otherwise(function(e){log.error("===avdEngine.initDevice() error, code:"+e.code+"; message:"+e.message),v.reject(e)}),v.promise},c.prototype.refreshDevice=function(){var e=when.defer(),f=this,m=[];for(key in f.microphoneMap)m.push(key);var g=[];for(key in f.cameraMap)g.push(key);return this.getAllDevices().then(function(e){for(var t={},r=0,o={},n=0,i=null,a={},s=0,d=null,l=0;l!=e.length;++l){var u=e[l],c=u.deviceId||u.id;"videoinput"===u.kind||"video"===u.kind?(r+=1,t[c]=u.label||"camera"+r):"audioinput"===u.kind||"audio"===u.kind?"default"==u.deviceId?(n+=1,o[c]=u.label||"microphone"+n,i=u.groupId):u.groupId!=i&&(n+=1,o[c]=u.label||"microphone"+n):"audiooutput"===u.kind&&("default"==u.deviceId?(s+=1,a[c]=u.label||"speaker"+s,d=u.groupId):u.groupId!=d&&(s+=1,a[c]=u.label||"speaker"+s))}for(var p in function(e,t,r,o){var n=[];for(var i in t)n.push(i);var a=arrayUtil.inANotInB(n,e),s=arrayUtil.inANotInB(e,n);if(0==s.length&&0==a.length)return;{if(this.isSafari)return;for(var d=0;d<r.length;d++){var l=r[d];if(l.selfUser){if(0<a.length)for(var u=0;u<a.length;u++){var c=t[a[u]];o[a[u]]=c,l.selfUser.initVideo(a[u],c)}if(0<s.length)for(var u=0;u<s.length;u++)delete o[s[u]],l.selfUser.deleteVideo(s[u])}}}}(g,t,this.rooms,f.cameraMap),o){var h=o[p];f.checkMicrophoneId=p,f.checkMicrophoneName=h;break}!function(e,t,r,o){var n=[];for(var i in t)n.push(i);var a=arrayUtil.inANotInB(n,e),s=arrayUtil.inANotInB(e,n);if(0==s.length&&0==a.length)return;for(var d=0;d<this.rooms.length;d++){var l=r[d];if(l.selfUser){if(0<a.length)for(var u=0;u<a.length;u++){var c=t[a[u]];o[a[u]]=c}if(0<s.length)for(var u=0;u<s.length;u++){var c=o[s[u]];s[u]==self.checkMicrophoneId&&l.selfUser.deleteAudio(s[u]),delete o[s[u]]}}}}(m,o,this.rooms,f.microphoneMap),f.speakerMap=a}).otherwise(function(e){log.error("===avdEngine.refreshDevice(),get device error!error code:"+e.code+"; error message:"+e.message)}),setTimeout(function(){e.resolve()},2e3),e.promise},c.prototype.setRecordingMicrophone=function(t){var r=this,o=room.selfUser.audio;if(null==o){var e=r.microphoneMap[t];room.selfUser.initAudio(t,e)}else if(t!=o.id)if(o.status==StreamStatus.init){room.selfUser.deleteAudio(o.id);e=r.microphoneMap[t];room.selfUser.initAudio(t,e)}else if(o.status==StreamStatus.published||o.status==StreamStatus.muted){var n=o.element;o.closeMicrophone(),setTimeout(function(){room.selfUser.deleteAudio(o.id);var e=r.microphoneMap[t];room.selfUser.initAudio(t,e),room.selfUser.audio.openMicrophone(n)},500)}},c.prototype.checkDevice=function(){var n=when.defer();return this.getAllDevices().then(function(e){for(var t={video:!1,audio:!1,speaker:!1,deviceIdIsUndefined:!1},r=0;r!=e.length;++r){var o=e[r];o.deviceId||o.id||(t.deviceIdIsUndefined=!0),"videoinput"===o.kind||"video"===o.kind?t.video=!0:"audioinput"===o.kind||"audio"===o.kind?t.audio=!0:"audiooutput"===o.kind&&(t.speaker=!0)}n.resolve(t)}).otherwise(function(e){n.reject(e)}),n.promise},c.prototype.checkOpenVideo=function(e,t,r){var o=when.defer(),n=this;n.checkCloseVideo();var i={video:{},audio:!1};if(e&&(i.video.deviceId={exact:e}),t){var a=Resolution[t];i.video.width={},i.video.height={},i.video.width.min=a.width,i.video.height.min=a.height,i.video.width.max=a.width,i.video.height.max=a.height}r&&(n.isChrome||n.isOpera)&&("string"==typeof r&&(r=Number(r)),i.video.frameRate={},i.video.frameRate.min=r,i.video.frameRate.max=r);try{navigator.mediaDevices.getUserMedia(i).then(function(e){n.checkVideoStream=e,o.resolve(e)}).catch(function(e){var t,r=ModuleBase.use(ModulesEnum.error);t="NotSupportedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new r(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new r(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notFoundError):new r(ErrorConstant.navigatorUserMediaError_unknown),o.reject(t)})}catch(e){var s=new(ModuleBase.use(ModulesEnum.error))(ErrorConstant.navigatorUserMediaError_unknown);o.reject(s)}return o.promise},c.prototype.checkOpenAudio=function(e){var o=when.defer(),t=this;t.checkCloseAudio();var r={video:!1,audio:!0};e&&(r.audio.deviceId={exact:e});try{navigator.mediaDevices.getUserMedia(r).then(function(e){t.checkAudioStream=e,o.resolve(e)}).catch(function(e){var t,r=ModuleBase.use(ModulesEnum.error);t="NotSupportedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new r(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new r(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notFoundError):new r(ErrorConstant.navigatorUserMediaError_unknown),o.reject(t)})}catch(e){var n=new(ModuleBase.use(ModulesEnum.error))(ErrorConstant.navigatorUserMediaError_unknown);o.reject(n)}return o.promise},c.prototype.checkOpenVideoAndAudio=function(e,t,r,o){var s=when.defer(),d=this;d.checkCloseVideo(),d.checkCloseAudio();var n={video:!0,audio:!0};if(e&&(n.video.deviceId={exact:e}),t&&(n.audio.deviceId={exact:t}),r){var i=Resolution[r];n.video.width={},n.video.height={},n.video.width.min=i.width,n.video.height.min=i.height,n.video.width.max=i.width,n.video.height.max=i.height}o&&(d.isChrome||d.isOpera)&&("string"==typeof o&&(o=Number(o)),n.video.frameRate={},n.video.frameRate.min=o,n.video.frameRate.max=o);try{navigator.mediaDevices.getUserMedia(n).then(function(e){var t=new MediaStream,r=new MediaStream;if(e){for(var o=e.getAudioTracks(),n=0;n<o.length;n++)t.addTrack(o[n]);var i=e.getVideoTracks();for(n=0;n<i.length;n++)r.addTrack(i[n])}var a={audioStream:t,videoStream:r};d.checkVideoStream=a.videoStream,d.checkAudioStream=a.audioStream,s.resolve(a)}).catch(function(e){var t,r=ModuleBase.use(ModulesEnum.error);t="NotSupportedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notSupportedError):"OverconstrainedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_overconstrainedError):"TrackStartError"==e.name||"NotReadableError"==e.name?new r(ErrorConstant.navigatorUserMediaError_trackStartError):"NotAllowedError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notAllowedError):"TypeError"==e.name?new r(ErrorConstant.navigatorUserMediaError_typeError):"NotFoundError"==e.name?new r(ErrorConstant.navigatorUserMediaError_notFoundError):new r(ErrorConstant.navigatorUserMediaError_unknown),s.reject(t)})}catch(e){var a=new(ModuleBase.use(ModulesEnum.error))(ErrorConstant.navigatorUserMediaError_unknown);s.reject(a)}return s.promise},c.prototype.checkAudioLevel=function(e,t){this.checkAudioStream&&(checkAudioLocalStatsCollector=new LocalStatsCollector(this.checkAudioStream,e,t),checkAudioLocalStatsCollector.start())},c.prototype.checkCloseVideo=function(){this.checkVideoStream&&this.checkVideoStream.getTracks().forEach(function(e){e.stop()}),this.checkVideoStream=null},c.prototype.checkCloseAudio=function(){this.checkAudioLocalStatsCollector&&this.checkAudioLocalStatsCollector.stop(),this.checkAudioLocalStatsCollector=null,this.checkAudioStream&&this.checkAudioStream.getTracks().forEach(function(e){e.stop()}),this.checkAudioStream=null},c.prototype.obtainRecord=function(e){return new r(e)},c.prototype.obtainLive=function(e){return new o(e)},c.prototype.obtainOutgoing=function(e){return new n(e)},c.prototype.getStreamExporterManager=function(){return new a},c}),ModuleBase.define("Room",["SignalFactory","RestServer","MasterServer","P2PServer","User","Error"],function(d,a,r,e,s,l){var t=function(e){this.id=e,this.roomTocken=null,this.signalTocken=null,this.outgoingAddr=null,this.userAgent=USER_AGENT_AVD_DEFAULT,this.roomPassword=null,this.pingTimeout,this.pingInterval,this.pingCountTime=0,this.pingIntervalId=null,this.pingTimeoutId=null,this.webocketStatusIntervalId=null,this.lastPDUSeq=0,this.roomInfo=null,this.status=RoomStatus.opening,this.appData={},this.selfUser=null,this.participants=[],this.muteSpeakerFlag=!1,this.avdEngine=null,this.masterServer=null,this.p2pServer=null,this.cmdProtobufCoded=null,this.traceablePeerConnection=null,this.traceableP2PPeerConnection=null,this.eventEmitter=new EventEmitter,this.fingerPrint,this.setup,this.iceUfrag,this.icePwd,this.codecPayloadVP8=null,this.codecPayloadVP9=null,this.codecPayloadH264=null,this.codecPayloadAV1=null,this.codecPayloadISAC_16K=null,this.codecPayloadISAC_32K=null,this.codecPayloadOpus=null,this.codecPayloadG722=null,this.codecPayloadPCMU=null,this.codecPayloadPCMA=null,this.codecPayloadCN_8k=null,this.codecPayloadCN_16k=null,this.codecPayloadCN_32k=null,this.versionToServer,this.audioCodecPayloadMap,this.remoteSdpTemplate,this.videoMediaTemplate,this.audioMediaTemplate,this.remoteDescriptionSDP,this.midNum=1,this.midObjSet=[{mid:0,type:"audio",isReceiver:!1,isSender:!1,receiverInfo:{trackId:"",nodeId:"",deviceId:""}},{mid:1,type:"video",isReceiver:!1,isSender:!1,receiverInfo:{trackId:"",nodeId:"",deviceId:""}}],this.audioMediaSDPInit,this.videoMediaSDPInit,this.mediaMid=0,this.connectionInfoCollector=null,this.audioLevel=null,this.connectionStatistics=null,this.baselineReconnectionTime,this.reconnectionTime,this.reconnectionCount=0,this.reconnectionState=!1,this.reconnectionOpenRep402=!1,this.toMCUReconnectionPC=null,this.webSocketOncloseEvents=[],this.isExistReJoinState=!1,this.reJoinRoomTimeOutCount=3,this.reJoinRoomCount=0,this.reJoinAfterTimer=null,this.reJoinAfterUsers=[],this.pubVideos=[],this.pubAudios=[],this.pubScreens=[],this.baselineJoinTime=null,this.joinTimeoutIntervalId=null,this.joinTimeout=1e4,this.joinTimeoutState=!1,this.currMinBandwidth=null,this.currMaxBandwidth=null,this.currScreenMinBandwidth=1200,this.currScreenMaxBandwidth=3200,this.currScreenHandle=!1,this.updateMinBandwidth=null,this.videoSsrc2user={},this.audioSsrc2user={},this.screenSsrc2user={},this.videoSsrc2deviceId={},this.addSdpLocalStates=0,log.debug("===DDDDDDDDDDDDD init this.addSdpLocalStates:"+this.addSdpLocalStates),this.boardId2userId={},this.annotation2boardId={},this.isDoPDUSeq=0,this.videoSsrc=null,this.audioSsrc=null,this.updateTimer=null,this.boardOutputXRatio=1,this.boardOutputYRatio=1,this.boardInputXRatio=1,this.boardInputYRatio=1,this.baseMediaPalyEventStopTime=null,this.mediaPalyEventStopIntervalId=null,this.cameraId2uuid={},this.microphoneId2uuid={},this.speakerId2uuid={},this.mp4ImporterUserAudioStateIntervalId=null,this.mp4ImporterUserAudioRtpPacketTemp=0,this.mp4ImporterUserAudioRtpPacketReal=0,this.mp4ImporterUserAudioRate=20,this.websocketConnectTime=0};function o(){var d=this;clearInterval(d.statsIntervalId),d.statsIntervalId=setInterval(function(){if(room){var t={},e=0,r="",o=room.getParticipants(),n=room.getAppData(appDataKeyEnum.lecturer)?room.getAppData(appDataKeyEnum.lecturer):"",i=0;for(var a in o.forEach(function(e){e.audio&&(t[e.id]=e.audio.getAudioLevel())}),t)try{var s=t[a];a==n&&(i=s),e<s&&(e=s,r=a)}catch(e){log.error(e)}n!=r&&i<4&&3<=e-i&&(log.debug("===audioLevelHandler()id:"+r+","+e),room.updateAppData(appDataKeyEnum.lecturer,r))}else clearInterval(d.statsIntervalId)},3e3)}function u(e){log.debug("===room.openReqSend()...");var t=when.defer();return room.masterServer=new r(e),room.masterServer.openReqSend(),room.addCallback(EngineCallback.room_join_success,function(e){t.resolve(e)}),room.addCallback(EngineCallback.room_join_error,function(e){t.reject(e)}),t.promise}return t.prototype.setUserAgent=function(e){this.userAgent=e},t.prototype.join=function(e,t,r,o){var n=when.defer();(void 0===r&&(r=""),void 0===o&&(o=""),is_cluster)?(log.info("===room.join(),"),loggerReport.info("room.join(),"),(new a).getMcu(room.id,room.avdEngine.accessToken,clientIsUseCascade).then(function(){room.doJoin(e,t,r,o,n)}).otherwise(function(e){n.reject(e)})):(log.info("===room.join(),"),loggerReport.info("room.join(),"),room.doJoin(e,t,r,o,n));if(!room.isMcu()){var i=doFsCheck(FTConstant.p2p,l);if(i)return n.reject(i),n.promise}return n.promise},t.prototype.joinWithOEM=function(e,t,r,o,n){var i=when.defer();return(new a).getMcuWithOEM(room.id,n).then(function(){room.doJoin(e,t,r,o,i)}).otherwise(function(e){i.reject(e)}),i.promise},t.prototype.doJoin=function(e,t,r,o,n){if(null==e||""==e){var i=new l(ErrorConstant.userId_required);n.reject(i)}else if(0<e.indexOf("_")){i=new l(ErrorConstant.userId_format);n.reject(i)}else{null==room.baselineJoinTime&&(room.baselineJoinTime=new Date),room.joinTimeoutIntervalId=setInterval(function(){if(new Date-room.baselineJoinTime>=room.joinTimeout){room.joinTimeoutIntervalId&&(clearInterval(room.joinTimeoutIntervalId),room.joinTimeoutIntervalId=null,room.baselineJoinTime=null),room.joinTimeoutState=!0,log.debug("===room.doJoin(),"+ErrorConstant.join_room_timeout.code),loggerReport.debug("room.doJoin(),.");var e=new l(ErrorConstant.join_room_timeout);n.reject(e)}},500),this.roomPassword=o,this.selfUser=new s(e,t,r),this.selfUser.userAgent=this.userAgent,(new d).getDataChannel(SignalType.websocket).connect().then(u).then(function(e){log.info("===room.doJoin(),doJoin websokcet(one) success"),e.joinTimeoutIntervalId&&(clearInterval(e.joinTimeoutIntervalId),e.joinTimeoutIntervalId=null,e.baselineJoinTime=null),n.resolve(e)}).otherwise(function(e){log.error("===doJoin websokcet(one) error",e.errorShow()),room.joinTimeoutIntervalId&&(clearInterval(room.joinTimeoutIntervalId),room.joinTimeoutIntervalId=null,room.baselineJoinTime=null,room.masterServer.pingInit()),n.reject(e)})}room.addCallback(EngineCallback.room_join_websocket_reconnection_success,function(e){u(e).then(function(e){log.info("===room.doJoin(),doJoin websokcet(reconnection) success"),e.joinTimeoutIntervalId&&(clearInterval(e.joinTimeoutIntervalId),e.joinTimeoutIntervalId=null,e.baselineJoinTime=null),n.resolve(e)}).otherwise(function(e){log.error("===room.doJoin(),doJoin websokcet(reconnection) error",e.errorShow()),room.joinTimeoutIntervalId&&(clearInterval(room.joinTimeoutIntervalId),room.joinTimeoutIntervalId=null,room.baselineJoinTime=null,room.masterServer.pingInit()),n.reject(e)})})},t.prototype.reJoin=function(){if(log.info("===room.reJoin()"),room.isDoPDUSeq=0,room&&room.participants&&0<room.participants.length&&room.participants.forEach(function(e){e.id!=room.selfUser.id&&arrayUtil.objectSplice(room.participants,e.id)}),this.selfUser.reJoinPubVideoIds&&0<this.selfUser.reJoinPubVideoIds.length);else{this.selfUser.reJoinPubVideoIds=[],this.selfUser.reJoinPubVideoElements=[];var e=this.pubVideos;if(e&&0<e.length){log.debug("===room.reJoin(),videospubunpubroom.pubVideos.length:"+e.length);for(var t=0;t<e.length;t++)if(e[t].ownerId==this.selfUser.id){var r=this.selfUser.getVideo(e[t].id);this.selfUser.reJoinPubVideoIds.push(e[t].id),this.selfUser.reJoinPubVideoElements.push(r.element),r&&(log.debug("===room.reJoin(),videospubunpub,selfUser.video.id:"+e[t].id),r.unpublish())}}}if(this.selfUser.reJoinPubAudioId&&""!=this.selfUser.reJoinPubAudioId);else{this.selfUser.reJoinPubAudioId="";var o=this.pubAudios;if(o&&0<o.length){log.debug("===room.reJoin(),audiopubunpub,room.pubAudios.length:"+o.length);for(t=0;t<o.length;t++)if(o[t].ownerId==this.selfUser.id){var n=this.selfUser.getAudio(o[t].id);this.selfUser.reJoinPubAudioId=o[t].id,n&&(n.status===StreamStatus.muted&&(log.debug("===room.reJoin(),audiopubunpub,audioMute"),this.selfUser.reJoinPubAudioButMute=!0),log.debug("===room.reJoin(),audiopubunpub,selfUser.audio.id:"+o[t].id),n.closeMicrophone())}}}var i=this.pubScreens;if(i&&0<i.length){log.debug("===room.reJoin(),screenpubunpub,room.pubScreens.length:"+i.length);for(t=0;t<i.length;t++)if(i[t].ownerId==this.selfUser.id){var a=this.selfUser.getScreen(i[t].id);a&&(log.debug("===room.reJoin(),audiopubunpub,selfUser.screen.id:"+i[t].id),a.unpublish())}}if(clearTimeout(room.reJoinAfterTimer),room.reJoinAfterUsers=[],this.selfUser&&this.selfUser.toMCUPC&&(this.selfUser.toMCUPC.msgQueue=[],this.selfUser.toMCUPC.close(),this.selfUser.toMCUPC=null),log.debug("===room.reJoin(),subsubVideoIds:"+JSON.stringify(this.selfUser.subVideoIds)),this.selfUser.reJoinSubVideoIds=this.selfUser.subVideoIds,log.debug("===room.reJoin(),subsubAudioIds:"+JSON.stringify(this.selfUser.subAudioIds)),this.selfUser.reJoinSubAudioIds=this.selfUser.subAudioIds,log.debug("===room.reJoin(),subsubScreenIds:"+JSON.stringify(this.selfUser.subScreenIds)),this.selfUser.reJoinSubScreenIds=this.selfUser.subScreenIds,this.selfUser.init(),!(room.reJoinRoomCount<room.reJoinRoomTimeOutCount))return log.error("===room.reJoin(),,"),loggerReport.error("room.reJoin(),,"),void room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.reJoinRoomTimeOut);room.reJoinRoomCount++,log.info("===room.reJoin(),"+this.reJoinRoomCount+""),loggerReport.info("room.reJoin(),"+this.reJoinRoomCount+"");var s=when.defer();return this.toMCUReconnectionPC&&(room.traceablePeerConnection.close(this.toMCUReconnectionPC),this.toMCUReconnectionPC.msgQueue=[],this.toMCUReconnectionPC=null),room.webocketStatusIntervalId=setInterval(function(){room&&room.masterServer&&(room.masterServer.signalingChannel.readyState==WebSocket.CLOSING||room.masterServer.signalingChannel.readyState==WebSocket.CLOSED)?(clearInterval(room.webocketStatusIntervalId),room.webocketStatusIntervalId=null,(new d).getDataChannel(SignalType.websocket).connect().then(u).then(function(e){room.pingTimeout=e.pingTimeout,room.pingInterval=e.pingInterval,room.signalTocken=e.signalTocken,room.masterServer=e.masterServer,room.pubVideos=[],room.pubAudios=[],room.pubScreens=[],room.midNum=1,room.midObjSet=[{mid:0,type:"audio",isReceiver:!1,isSender:!1,receiverInfo:{trackId:"",nodeId:"",deviceId:""}},{mid:1,type:"video",isReceiver:!1,isSender:!1,receiverInfo:{trackId:"",nodeId:"",deviceId:""}}],s.resolve(room)}).otherwise(function(e){s.reject(e)})):room.masterServer.signalingChannel.close()},500),s.promise},t.prototype.continuousReJoin=function(){(log.info("===room.continuousReJoin(),"),this.reconnectionCount=0,this.reconnectionState=!1,this.reconnectionOpenRep402=!0,setRemoteDescriptionSuccess=!1,this.addSdpLocalStates=0,log.debug("===DDDDDDD0000000000,room.continuousReJoin(),this.addSdpLocalStates:",this.addSdpLocalStates),addIcecandidateList=[],this.reJoinRoomCount=0,this.reJoinAfterTimer=null,this.reJoinAfterUsers=[],is_cluster)?(new a).getMcu(room.id,room.avdEngine.accessToken).then(function(){room.reJoin()}).otherwise(function(e){room.reJoin()}):room.reJoin()},t.prototype.reconnectionHandle=function(){this.reconnectionState=!0,this.reconnectionCount+=1,log.info("===WebSocket,room.reconnectionHandle(),"+this.reconnectionCount+""),loggerReport.info("===WebSocket,room.reconnectionHandle(),"+this.reconnectionCount+""),(new d).getDataChannel(SignalType.websocket).connect().then(function(e){var t=new Date;t-room.websocketConnectTime<=2e3?log.info("===WebSocket,room.reconnectionHandle() return"):(room.websocketConnectTime=t,room.joinTimeoutIntervalId?(log.info("===WebSocket,room.reconnectionHandle(),,websocket"),room.reconnectionState=!1,room.webSocketOncloseEvents=[],room.reconnectionCount=0,room.eventEmitter.emit(EngineCallback.room_join_websocket_reconnection_success,e)):(log.debug("===WebSocket,room.reconnectionHandle(),,websocket"),room.webSocketOncloseEvents=[],room.reconnectionCount=0,room.joinTimeoutState=!1,room.masterServer.pingInit(),room.masterServer.signalingChannel=e,log.debug("===WebSocket,room.reconnectionHandle(),to masterServer.openReqReconnectionSend()"),room.masterServer.openReqReconnectionSend()))})},t.prototype.getMcuByReJoin=function(){var e=when.defer();return(new a).getMcu(room.id,room.avdEngine.accessToken).then(function(){log.debug("===room.getMcuByReJoin(),  getMcu success"),room.reJoin()}).otherwise(function(e){log.error("===room.getMcuByReJoin(), getMcu error,code:"+e.code+",message:"+e.message),room.reJoin()}),e.promise},t.prototype.getRoomId=function(){return room.roomInfo.room_id},t.prototype.getRoomTopic=function(){return room.roomInfo.topic},t.prototype.getOwnerId=function(){return room.roomInfo.owner_id},t.prototype.isMcu=function(){var e=!0;if(null==room.roomInfo)return e;var t=room.roomInfo.room_mode;return 3!=t&&4!=t||(e=!1),e},t.prototype.getRoomType=function(e){var t=!1;if(room.roomInfo&&room.roomInfo.room_type){var r=room.roomInfo.room_type.toString(2);e==RoomTypeEnum.join_host_first?t=room.isHasPrivilige(roomTypePrivilige.join_host_first,r):e==RoomTypeEnum.net_acc?t=room.isHasPrivilige(roomTypePrivilige.net_acc,r):e==RoomTypeEnum.host_control?t=room.isHasPrivilige(roomTypePrivilige.host_control,r):e==RoomTypeEnum.free_speech&&(t=!room.isHasPrivilige(roomTypePrivilige.host_control,r))}return t},t.prototype.isHasPrivilige=function(e,t){var r=!1;return 0<(e&t)&&(r=!0),r},t.prototype.getMaxAudio=function(){return room.roomInfo.max_audio},t.prototype.getMaxVideo=function(){return room.roomInfo.max_video},t.prototype.getMaxAttendee=function(){return room.roomInfo.attendee_max},t.prototype.getUsableVideo=function(){var e=this.getMaxVideo()-this.pubVideos.length;return e<0&&(e=0),e},t.prototype.getUsableAudio=function(){var e=this.getMaxAudio()-this.pubAudios.length;return e<0&&(e=0),e},t.prototype.updateRoomStatus=function(e){this.status=e},t.prototype.getRoomStatus=function(){return this.status},t.prototype.getSelfUser=function(){return room.selfUser},t.prototype.getSelfUserId=function(){return room.selfUser.id},t.prototype.getParticipants=function(){return this.participants},t.prototype.getUser=function(e){for(var t,r=0;r<this.participants.length;r++){var o=this.participants[r];if(o.id==e){t=o;break}}return t},t.prototype.getUserByUserIdAndNodeId=function(e,t){for(var r,o=0;o<this.participants.length;o++){var n=this.participants[o];if(n.id==e&&n.nodeId==t){r=n;break}}return r},t.prototype.hasUser=function(e){for(var t=!1,r=0;r<this.participants.length;r++){if(this.participants[r].id==e){t=!0;break}}return t},t.prototype.hasUserByUserIdAndNodeId=function(e,t){for(var r=!1,o=0;o<this.participants.length;o++){var n=this.participants[o];if(n.id==e&&n.nodeId==t){r=!0;break}}return r},t.prototype.localICERestart=function(){log.info("===room.localICERestart(),PeerConnection createOffer ICE Restart");room.selfUser.toMCUPC.createOffer({iceRestart:!0}).then(function(e){return e.sdp=updateSDPIcePwd(e.sdp,room.icePwd),log.debug("===room.localICERestart(),LocalDescription:"+e.sdp),room.selfUser.toMCUPC.setLocalDescription(e)})},t.prototype.remoteICERestart=function(e){e.candidate&&(log.info("===room.remoteICERestart(),candidate:"+e.candidate),room.masterServer.traceablePeerConnection.doAddIceCandidate(e),room.localICERestart())},t.prototype.getPublishedCameraCount=function(){return this.pubVideos.length},t.prototype.getPublishedCamera=function(){return this.pubVideos},t.prototype.getPublishedScreenCount=function(){return this.pubScreens.length},t.prototype.getPublishedScreen=function(){return this.pubScreens},t.prototype.addUser=function(e){this.hasUser(e.id)||this.participants.push(e)},t.prototype.addUserByUserIdAndUserId=function(e){this.hasUserByUserIdAndNodeId(e.id,e.nodeId)||this.participants.push(e)},t.prototype.removeUser=function(e){this.participants&&0<this.participants.length&&arrayUtil.objectSplice(this.participants,e)},t.prototype.removeUserByUserIdAndNodeId=function(e,t){this.participants&&0<this.participants.length&&arrayUtil.userIdAndNodeIdSplice(this.participants,e,t)},t.prototype.getUserByNodeId=function(e){for(var t,r=0;r<this.participants.length;r++){var o=this.participants[r];if(o.nodeId==e){t=o;break}}return t},t.prototype.getNodeId=function(e){var t=null,r=this.getUser(e);return r&&(t=r.nodeId),t},t.prototype.getUserId=function(e){var t=null,r=this.getUserByNodeId(e);return r&&(t=r.id),t},t.prototype.sendPublicMessage=function(e){var t=when.defer(),r=doFsCheck(FTConstant.chat,l);return null==r?(this.masterServer.sendMessage(e),t.resolve()):t.reject(r),t.promise},t.prototype.sendPrivateMessage=function(e,t){var r=when.defer(),o=doFsCheck(FTConstant.chat,l);return null==o?(this.masterServer.sendMessage(e,t),r.resolve()):r.reject(o),r.promise},t.prototype.sendPublicData=function(e){var t=when.defer(),r=doFsCheck(FTConstant.datachannel,l);return null==r?(this.masterServer.sendData(e),t.resolve()):t.reject(r),t.promise},t.prototype.sendPrivateData=function(e,t){var r=when.defer(),o=doFsCheck(FTConstant.datachannel,l);return null==o?(this.masterServer.sendData(e,t),r.resolve()):r.reject(o),r.promise},t.prototype.updateAppData=function(e,t){this.appData[e]=t,this.masterServer.roomDataInfo(e,t)},t.prototype.getAppData=function(e){return void 0===e||null==e||""==e?this.appData:this.appData[e]},t.prototype.setCameraResolutionOrFrameRate=function(e,t,r,o,n){log.info("===room.setCameraResolutionOrFrameRate(),cameraId:"+e+",resolution:"+t+",frameRate:"+r+",resolutionSetType:"+o+",aspectRatio:"+n);var i=when.defer();if(640<parseInt(t)&&(s=doFsCheck(FTConstant.video_hd,l)))return i.reject(s),i.promise;var a=room.selfUser.getVideo(e);if(a)"string"==typeof r&&(r=Number(r)),"string"==typeof n&&(n=Number(n)),a.resolution==Resolution[t]&&a.setType==o&&a.frameRate==r&&a.aspectRatio==n||(a.setResolution(t,o),a.setFrameRate(r),a.setAspectRatio(n),a.track&&a.applyConstraints(),i.resolve());else{var s=new l(ErrorConstant.cameraId_does_not_exist);i.reject(s)}return i.promise},t.prototype.setCameraResolutionWHOrFrameRate=function(e,t,r,o,n,i){log.info("===room.setCameraResolutionWHOrFrameRate(),cameraId:"+e+",resolutionWidth:"+t+",resolutionHeight:"+r+",frameRate:"+o+",resolutionSetType:"+n+",aspectRatio:"+i);var a=when.defer();if(640<parseInt(t)&&(d=doFsCheck(FTConstant.video_hd,l)))return a.reject(d),a.promise;var s=room.selfUser.getVideo(e);if(s)"string"==typeof o&&(o=Number(o)),"string"==typeof i&&(i=Number(i)),void 0===s.resolution?(s.setResolutionWH(t,r,n),s.setFrameRate(o),a.resolve()):s.resolution.width==t&&s.resolution.height==r&&s.setType==n&&s.frameRate==o&&s.aspectRatio==i||(s.setResolutionWH(t,r,n),s.setFrameRate(o),s.setAspectRatio(i),s.track&&s.applyConstraints(),a.resolve());else{var d=new l(ErrorConstant.cameraId_does_not_exist);a.reject(d)}return a.promise},t.prototype.muteSpeaker=function(){this.muteSpeakerFlag=!0,this.participants.forEach(function(e){if(e.id!=room.selfUser.id){var t=e.audio.track;t&&(t.enabled=!1)}})},t.prototype.unmuteSpeaker=function(){this.muteSpeakerFlag=!1,this.participants.forEach(function(e){if(e.id!=room.selfUser.id){var t=e.audio.track;t&&(t.enabled=!0)}})},t.prototype.ismuteSpeaker=function(){return this.muteSpeakerFlag},t.prototype.hasObject=function(e,t){for(var r=!1,o=0;o<e.length;o++){var n=e[o];if(n.id==t.id&&n.ownerId==t.ownerId){r=!0;break}}return r},t.prototype.kickoffUser=function(e,t){log.info("===room.kickoffUser(),reason:"+e+",userId:"+t),this.masterServer.userIndiction(e,t)},t.prototype.leave=function(e,t){log.info("===room.leave(),reason:"+e+",kickoffOpt:"+t);var r=this,o=when.defer();return r.mp4ImporterUserAudioRtpPacketTemp=0,r.mp4ImporterUserAudioRtpPacketReal=0,r.mp4ImporterUserAudioStateIntervalId&&(clearInterval(r.mp4ImporterUserAudioStateIntervalId),r.mp4ImporterUserAudioStateIntervalId=null),r.userClearInfo(),setTimeout(function(){r.masterServer.userMsg(e,t),room&&(room.masterServer.signalingChannel.close(),room.connectionInfoCollector&&room.connectionInfoCollector.stop(),room.connectionStatistics&&room.connectionStatistics.stop(),room=null),o.resolve()},1e3),o.promise},t.prototype.closeRoom=function(e){log.info("===room.closeRoom(),userId:",e),this.mp4ImporterUserAudioRtpPacketTemp=0,this.mp4ImporterUserAudioRtpPacketReal=0,this.mp4ImporterUserAudioStateIntervalId&&(clearInterval(this.mp4ImporterUserAudioStateIntervalId),this.mp4ImporterUserAudioStateIntervalId=null),this.userClearInfo(),this.masterServer.closeRoom(e),setTimeout(function(){room&&(room.masterServer.signalingChannel.close(),room.connectionInfoCollector&&room.connectionInfoCollector.stop(),room.connectionStatistics&&room.connectionStatistics.stop(),room=null)},1e3)},t.prototype.userClearInfo=function(){var e=room.selfUser.videos;if(e&&0<e.length)for(key in e){var t=e[key];t.status==StreamStatus.published&&(t.unpreview(),t.unpublish())}var r=room.selfUser.audio;r&&r.status==StreamStatus.published&&r.closeMicrophone();var o=room.selfUser.screen;o&&o.status==StreamStatus.published&&o.unpublish(),this.pingIntervalId&&(clearInterval(this.pingIntervalId),this.pingIntervalId=null),this.pingTimeoutId&&(clearInterval(this.pingTimeoutId),this.pingTimeoutId=null),this.selfUser.changePublishVideoQualityInterval&&(clearInterval(this.selfUser.changePublishVideoQualityInterval),this.selfUser.changePublishVideoQualityInterval=null),this.selfUser&&this.selfUser.toMCUPC&&(this.selfUser.toMCUPC.msgQueue=[],this.selfUser.toMCUPC.close(),this.selfUser.toMCUPC=null),setRemoteDescriptionSuccess=!1,addIcecandidateList=[]},t.prototype.addCallback=function(e,t){this.eventEmitter.addListener(e,t)},t.prototype.getRoomControl=function(){return this.roomControl},t.prototype.setRoomControl=function(e){this.masterServer.setRoomControl(this.id,e)},t.prototype.setDeviceIdByUUID=function(e,t){if(0==e){var r=this.cameraId2uuid[t];return r||(room.selfUser&&room.selfUser.screen&&room.selfUser.screen.id==t?r=t:(r=Math.uuid(),this.cameraId2uuid[t]=r)),r}if(1==e){var o=this.speakerId2uuid[t];return o||(o=Math.uuid(),this.speakerId2uuid[t]=o),o}if(2==e){var n=this.microphoneId2uuid[t];return n||(n=Math.uuid(),this.microphoneId2uuid[t]=n),n}},t.prototype.getDeviceIdByUUID=function(e,t){var r=t;if(0==e){for(key in room.cameraId2uuid){if(room.cameraId2uuid[key]==t){r=key;break}}return r}if(1==e){for(key in room.speakerId2uuid){if(room.speakerId2uuid[key]==t){r=key;break}}return r}if(2==e){for(key in room.microphoneId2uuid){if(room.microphoneId2uuid[key]==t){r=key;break}}return r}},t.prototype.calInitVideoBitrate=function(e,t){var r=e*t,o=Math.sqrt(r),n=Math.log10(r),i=Math.log10(o),a=n*o/Math.pow(i,2)/10;1280<e&&(a*=Math.sqrt(e/1280));var s=2*parseInt(8*a);return{startBit:s,minBit:s/2,maxBit:2*s}},t.prototype.sendAddAnnotation=function(e,t,r,o,n,i,a){log.debug("===Room.sendAddAnnotation(),objectId:"+e+",shapeType:"+r+"arrowtype:"+i+",fillType:"+a),this.masterServer.sendAddAnnotationMessage(e,t,r,o,n,i,a)},t.prototype.sendRemoveAnnotation=function(e,t,r){log.debug("===Room.sendRemoveAnnotation(),objectId:"+e+",annotationType:"+t+",eraserIds:"+r),this.masterServer.sendRemoveAnnotationMessage(e,t,r)},t.prototype.initFakeVideoStream=function(e){for(var t=0;t<e;t++)getFakeVideoStream(function(e){room.fakeVideoStreams.push(e)})},t.prototype.initFakeAudioStream=function(e){for(var t=0;t<e;t++)getFakeAudioStream(function(e){room.fakeAudioStreams.push(e)})},t.prototype.addAnnotationMsg=function(e,t,r){if(log.debug("===room.addAnnotationMsg, updateAnnotationMsg: ",e.objectId," isSelf: ",t," isClear: ",r),room.annotation2boardId[e.objectId]){var o=room.annotation2boardId[e.objectId].storageArr,n=room.annotation2boardId[e.objectId].queueArr;if(e.annotationType!=shapeTypeEnum.hlight_point)if(0<o.length){for(var i=!1,a=0;a<o.length;a++)o[a].annotationId==e.annotationId&&(o[a].operType!=e.operType&&e.operType==OperType.remove&&(log.debug("===room.addAnnotationMsg, updateAnnotationMsg.remove, remove annotation from annotation2BoardId"),o.splice(a,1)),i=!0);i||e.operType==OperType.remove||o.push(e)}else o.push(e);t||n.push(e)}else room.annotation2boardId[e.objectId]={storageArr:[],queueArr:[]},e.annotationType!=shapeTypeEnum.hlight_point&&room.annotation2boardId[e.objectId].storageArr.push(e),t||room.annotation2boardId[e.objectId].queueArr.push(e);if(r&&room.annotation2boardId[e.objectId]&&0<room.annotation2boardId[e.objectId].storageArr.length)for(a=0;a<room.annotation2boardId[e.objectId].storageArr.length;a++){var s=room.annotation2boardId[e.objectId].storageArr[a];s.operUserId==room.selfUser.id&&s.operType==OperType.add&&(room.annotation2boardId[e.objectId].storageArr.splice(a,1),a--)}},t.prototype.updateAnnotationDrow=function(e){log.debug("===room.updateAnnotationDrow, annotations: ",e);for(var t=this;0<e.length;){var r=e[0],o=room.getUser(room.boardId2userId[r.objectId]);if(!o)break;var n=o.getBoard(r.objectId);if(!n.annotation){clearTimeout(t.updateTimer),t.updateTimer=setTimeout(function(){t.updateAnnotationDrow(e)},100);break}switch(e.shift(),r.operType){case OperType.add:r.annotationType==shapeTypeEnum.line||r.annotationType==shapeTypeEnum.ellipse||r.annotationType==shapeTypeEnum.rect||r.annotationType==shapeTypeEnum.arrow||r.annotationType==shapeTypeEnum.success||r.annotationType==shapeTypeEnum.failure||r.annotationType==shapeTypeEnum.rhomb||r.annotationType==shapeTypeEnum.hlight_texttag||r.annotationType==shapeTypeEnum.hlight_point?n.annotation.drawToBoard(r.ann2pt):r.annotationType==shapeTypeEnum.polyline&&n.annotation.drawToBoard(r.annMutlipt);break;case OperType.remove:n.annotation.removeToBoard(r);break;case OperType.update:}}},t.prototype.voiceActivatedHandler=function(){room.audioLevel&&room.audioLevel.start(500).then(o)},t.prototype.mp4ImporterUserAudioStateStart=function(e){log.debug("===room.mp4ImporterUserAudioStateStart()");var i=this;room&&(clearInterval(i.mp4ImporterUserAudioStateIntervalId),i.mp4ImporterUserAudioStateIntervalId=setInterval(function(){var e=function(){var e=null;if(room){var t=room.participants.length;if(0<t)for(var r=0;r<t;r++){var o=room.participants[r];if("avd_mp4_importer"==o.userAgent){o.audio&&o.audio.track&&(e=o.audio.track.id);break}}}return e}();if(e&&room){for(var t,r=room.traceablePeerConnection.getToMCUPeerConnection().getReceivers(),o=0;o<r.length;o++){var n=r[o];if(n&&n.track&&n.track.id&&n.track.id==e){t=n;break}}t&&t.getStats().then(function(e){e.forEach(function(e){if("inbound-rtp"===e.type){var t=e.packetsLost,r=e.packetsReceived;i.mp4ImporterUserAudioRtpPacketTemp=t+r;var o=(i.mp4ImporterUserAudioRtpPacketTemp-i.mp4ImporterUserAudioRtpPacketReal)*i.mp4ImporterUserAudioRate;room.eventEmitter.emit(RoomCallback.mediaplay_progress_notify,o)}})})}else i.mp4ImporterUserAudioRtpPacketTemp=0,i.mp4ImporterUserAudioRtpPacketReal=0},e))},t.prototype.mp4ImporterUserAudioStateStop=function(){this.mp4ImporterUserAudioRtpPacketReal=this.mp4ImporterUserAudioRtpPacketTemp,this.mp4ImporterUserAudioStateIntervalId&&(clearInterval(this.mp4ImporterUserAudioStateIntervalId),this.mp4ImporterUserAudioStateIntervalId=null)},t}),sdpLines=function(e){return e.split("\r\n").filter(function(e){return 0<e.length})},sdpMline=function(e){for(var t=e.substr(2).split(" "),r={media:t[0],port:t[1],proto:t[2],formats:[]},o=3;o<t.length;o++)t[o]&&r.formats.push(t[o]);return r},findLineInFirefox=function(e,t,r){for(var o=e.length,n=0;n<t.length;n++)if(t[n].substr(0,o)===e)return t[n];if(!r)return!1;for(var i=0;i<r.length;i++)if(r[i].substr(0,o)===e)return r[i];return!1},findLinesInFirefox=function(e,t,r){for(var o=[],n=e.length,i=0;i<t.length;i++)t[i].substr(0,n)===e&&o.push(t[i]);if(o.length||!r)return o;for(var a=0;a<r.length;a++)r[a].substr(0,n)===e&&o.push(r[a]);return o},rtpmap=function(e){var t=e.substr(9).split(" "),r={id:t.shift()};return t=t[0].split("/"),r.name=t[0],r.clockrate=t[1],r.channels=3==t.length?t[2]:"1",r},sctpmap=function(e){var t=e.substr(10).split(" ");return{number:t.shift(),protocol:t.shift(),streams:t.shift()}},fmtp=function(e){for(var t,r,o,n=e.substr(e.indexOf(" ")+1).split(";"),i=[],a=0;a<n.length;a++)r=(t=n[a].split("="))[0].trim(),o=t[1],r&&o?i.push({key:r,value:o}):r&&i.push({key:"",value:r});return i},crypto=function(e){var t=e.substr(9).split(" ");return{tag:t[0],cipherSuite:t[1],keyParams:t[2],sessionParams:t.slice(3).join(" ")}},fingerprint=function(e){var t=e.substr(14).split(" ");return{hash:t[0],value:t[1]}},extmap=function(e){var t=e.substr(9).split(" "),r={},o=t.shift(),n=o.indexOf("/");return 0<=n?(r.id=o.substr(0,n),r.senders=o.substr(n+1)):(r.id=o,r.senders="sendrecv"),r.uri=t.shift()||"",r},rtcpfb=function(e){var t=e.substr(10).split(" "),r={};return r.id=t.shift(),r.type=t.shift(),"trr-int"===r.type?r.value=t.shift():r.subtype=t.shift()||"",r.parameters=t,r},sdpCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:t[1],protocol:t[2].toLowerCase(),priority:t[3],ip:t[4],port:t[5],type:t[7],generation:"0"},o=8;o<t.length;o+=2)"raddr"===t[o]?r.relAddr=t[o+1]:"rport"===t[o]?r.relPort=t[o+1]:"generation"===t[o]?r.generation=t[o+1]:"tcptype"===t[o]&&(r.tcpType=t[o+1]);return r.network="1",r},sourceGroups=function(e){for(var t=[],r=0;r<e.length;r++){var o=e[r].substr(13).split(" ");t.push({semantics:o.shift(),sources:o})}return t},sources=function(e){for(var t=[],r={},o=0;o<e.length;o++){var n=e[o].substr(7).split(" "),i=n.shift();if(!r[i]){var a={ssrc:i,parameters:[]};t.push(a),r[i]=a}var s=(n=n.join(" ").split(":")).shift(),d=n.join(":")||null;r[i].parameters.push({key:s,value:d})}return t},groups=function(e){for(var t,r=[],o=0;o<e.length;o++)t=e[o].substr(8).split(" "),r.push({semantics:t.shift(),contents:t});return r},msidSemantics=function(e){for(var t,r=[],o=0;o<e.length;o++)t=e[o].substr(17).split(" "),r.push({semantics:t.shift(),contents:t});return r},bandwidth=function(e){var t=e.substr(2).split(":"),r={};return r.type=t.shift(),r.bandwidth=t.shift(),r},getSsrcBySdp=function(e){for(var t,r=e.split("\r\n"),o=0,n=0;n<r.length;n++)0<=r[n].indexOf("a=ssrc-group:SIM")&&(o=n);return 0<o?t=r[o].split(" ")[1]:(r[0]&&(t=r[0].split(" ")[0].split(":")[1]),t)},getCodecPayloadType=function(e,t){for(var r=[],o=e.split("\r\n"),n=findLine(o,"a=rtpmap",t),i=0;i<n.length;i++)r[i]=n?getCodecPayloadTypeFromLine(o[n[i]]):null;return r},getIceInfoBySDP=function(e){var t=e.split("\r\n"),r={},o=findLine(t,"a=","ice-ufrag");if(o&&0<o.length){var n=t[o[0]];r.ufrag=n.split(":")[1]}var i=findLine(t,"a=","ice-pwd");if(i&&0<i.length){n=t[i[0]];r.pwd=n.split(":")[1]}return r},getPayloadByProfileLevel=function(e){var t="",r=e.split("\r\n"),o=findLine(r,"a=fmtp","profile-level-id=42e01f");o&&0<o.length&&(t=r[o[0]].split(" ")[0].split(":")[1]);return t},getCodecPayloadTypeFromLine=function(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),r=e.match(t);return r&&2===r.length?r[1]:null},setReplaceCoding=function(e,t,r){var o=e.join(" "),n=t.split("\r\n"),i=findLine(n,"m=",r),a=n[i].split(" ").slice(0,3);a.push(o);var s=a.join(" ");return t=t.replace(n[i],s)},setReplaceMediaPayloads=function(e,t,r){var o=e.join(" "),n=t.split("\r\n"),i=findLine(n,"m=",r);if(0==i.length)return t;var a=n[i].split(" "),s=a.slice(0,3);s.push(o);var d=s.join(" ");t=t.replace(n[i],d);var l=a.slice(3,a.length),u=diff(l,e);t=(t=(t=setDeletedMediaPayloads(u,t)).replace(/a=setup:actpass/g,"a=setup:active")).replace(/a=recvonly/g,"a=sendrecv");for(var c=0;c<e.length;c++){t=t+"a=fmtp:"+e[c]+" x-google-max-bitrate=10000; x-google-min-bitrate=300; x-google-start-bitrate=645\r\n"}return t},setDeletedMediaPayloads=function(e,t){for(var r=0;r<e.length;r++)for(var o=t.split("\r\n"),n=findLine(o,"a=",":"+e[r]+" "),i=0;i<n.length;i++)t=t.replace(o[n[i]]+"\r\n","");return t},diff=function(e,t){for(var r=[],o=0;o<e.length;o++)-1===t.indexOf(e[o])&&r.push(e[o]);for(var n=[],i=0;i<t.length;i++)-1===e.indexOf(t[i])&&n.push(t[i]);return r.concat(n)};var idCounter=Math.random();if(_setIdCounter=function(e){idCounter=e},toSessionJSON=function(e,t){var r,o=t.creators||[],n=t.role||"initiator",i=t.direction||"outgoing",a=e.split("\r\nm=");for(r=1;r<a.length;r++)a[r]="m="+a[r],r!==a.length-1&&(a[r]+="\r\n");var s=a.shift()+"\r\n",d=sdpLines(s),l={},u=[];for(r=0;r<a.length;r++)u.push(toMediaJSON(a[r],s,{role:n,direction:i,creator:o[r]||"initiator"}));l.contents=u;var c=findLinesInFirefox("a=group:",d);c.length&&(l.groups=groups(c));var p=findLinesInFirefox("a=msid-semantic:",d);return p.length&&(l.msidSemantics=msidSemantics(p)),l},toMediaJSON=function(e,t,r){var o=r.creator||"initiator",n=r.role||"initiator",i=r.direction||"outgoing",a=sdpLines(e),s=sdpLines(t),d=sdpMline(a[0]),l={creator:o,role:n,direction:i,name:d.media,description:{descType:"rtp",media:d.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transType:"iceUdp",candidates:[],fingerprints:[]}};"application"==d.media&&(l.description={descType:"datachannel"},l.transport.sctp=[]);var u=l.description,c=l.transport,p=findLineInFirefox("a=mid:",a);if(p&&(l.name=p.substr(6)),findLineInFirefox("a=sendrecv",a,s)?l.senders="both":findLineInFirefox("a=sendonly",a,s)?l.senders=SENDERS[n][i].sendonly:findLineInFirefox("a=recvonly",a,s)?l.senders=SENDERS[n][i].recvonly:findLineInFirefox("a=inactive",a,s)&&(l.senders="none"),"rtp"==u.descType){var h=findLineInFirefox("b=",a);h&&(u.bandwidth=h(h));var f=findLineInFirefox("a=msid:",a);if(f.length){var m=f.substr(7).split(" "),g={};g.msid=f,g.streamId=m[0],g.trackId=m[1],u.msid=g}var v=findLineInFirefox("a=ssrc:",a);v&&(u.ssrc=v.substr(7).split(" ")[0]),findLinesInFirefox("a=rtpmap:",a).forEach(function(e){var t=rtpmap(e);t.parameters=[],t.feedback=[],findLinesInFirefox("a=fmtp:"+t.id,a).forEach(function(e){t.parameters=fmtp(e)}),findLinesInFirefox("a=rtcp-fb:"+t.id,a).forEach(function(e){t.feedback.push(rtcpfb(e))}),u.payloads.push(t)}),findLinesInFirefox("a=crypto:",a,s).forEach(function(e){u.encryption.push(crypto(e))}),findLineInFirefox("a=rtcp-mux",a)&&(u.mux=!0),findLinesInFirefox("a=rtcp-fb:*",a).forEach(function(e){u.feedback.push(rtcpfb(e))}),findLinesInFirefox("a=extmap:",a).forEach(function(e){var t=extmap(e);t.senders=SENDERS[n][i][t.senders],u.headerExtensions.push(t)});var y=findLinesInFirefox("a=ssrc-group:",a);u.sourceGroups=sourceGroups(y||[]);var b=findLinesInFirefox("a=ssrc:",a);u.sources=sources(b||[]),findLineInFirefox("a=x-google-flag:conference",a,s)&&(u.googConferenceFlag=!0)}var _=findLinesInFirefox("a=fingerprint:",a,s),w=findLineInFirefox("a=setup:",a,s);_.forEach(function(e){var t=fingerprint(e);w&&(t.setup=w.substr(8)),c.fingerprints.push(t)});var S=findLineInFirefox("a=ice-ufrag:",a,s),E=findLineInFirefox("a=ice-pwd:",a,s);S&&E&&(c.ufrag=S.substr(12),c.pwd=E.substr(10),c.candidates=[],findLinesInFirefox("a=candidate:",a,s).forEach(function(e){c.candidates.push(toCandidateJSON(e))}));"datachannel"==u.descType&&findLinesInFirefox("a=sctpmap:",a).forEach(function(e){var t=sctpmap(e);c.sctp.push(t)});return l},toCandidateJSON=function(e){var t=sdpCandidate(e.split("\r\n")[0]);return t.id=(idCounter++).toString(36).substr(0,12),t},toSessionSDP=function(e,t){t.role,t.direction;var r=["v=0","o=- "+(t.sid||e.sid||Date.now())+" "+(t.time||Date.now())+" IN IP4 0.0.0.0","s=-","t=0 0"];return(e.groups||[]).forEach(function(e){r.push("a=group:"+e.semantics+" "+e.contents.join(" "))}),(e.msidSemantics||[]).forEach(function(e){navigator.mozGetUserMedia?r.push("a=msid-semantic:"+e.semantics+" "+e.contents.join(" ")):r.push("a=msid-semantic: "+e.semantics+" "+e.contents.join(" "))}),(e.contents||[]).forEach(function(e){r.push(toMediaSDP(e,t))}),r.join("\r\n")+"\r\n"},toMediaSDP=function(e,t){var n=[],r=t.role||"initiator",o=t.direction||"outgoing",i=e.description,a=e.transport,s=i.payloads||[],d=a&&a.fingerprints||[],l=[];if("datachannel"==i.descType?(l.push("application"),l.push("1"),l.push("DTLS/SCTP"),a.sctp&&a.sctp.forEach(function(e){l.push(e.number)})):(l.push(i.media),l.push("1"),i.encryption&&0<i.encryption.length||0<d.length?l.push("RTP/SAVPF"):l.push("RTP/AVPF"),s.forEach(function(e){l.push(e.id)})),n.push("m="+l.join(" ")),n.push("c=IN IP4 0.0.0.0"),i.bandwidth&&i.bandwidth.type&&i.bandwidth.bandwidth&&n.push("b="+i.bandwidth.type+":"+i.bandwidth.bandwidth),"rtp"==i.descType&&n.push("a=rtcp:1 IN IP4 0.0.0.0"),a){a.ufrag&&n.push("a=ice-ufrag:"+a.ufrag),a.pwd&&n.push("a=ice-pwd:"+a.pwd);d.forEach(function(e){n.push("a=fingerprint:"+e.hash+" "+e.value),e.setup&&n.push("a=setup:"+e.setup)}),a.sctp&&a.sctp.forEach(function(e){n.push("a=sctpmap:"+e.number+" "+e.protocol+" "+e.streams)})}return"rtp"==i.descType&&n.push("a="+(SENDERS[r][o][e.senders]||"sendrecv")),n.push("a=mid:"+e.name),i.msid&&n.push(i.msid.msid),i.mux&&n.push("a=rtcp-mux"),(i.encryption||[]).forEach(function(e){n.push("a=crypto:"+e.tag+" "+e.cipherSuite+" "+e.keyParams+(e.sessionParams?" "+e.sessionParams:""))}),i.googConferenceFlag&&n.push("a=x-google-flag:conference"),s.forEach(function(t){var e="a=rtpmap:"+t.id+" "+t.name+"/"+t.clockrate;if(t.channels&&"1"!=t.channels&&(e+="/"+t.channels),n.push(e),t.parameters&&t.parameters.length){var r=["a=fmtp:"+t.id],o=[];t.parameters.forEach(function(e){o.push((e.key?e.key+"=":"")+e.value)}),r.push(o.join(";")),n.push(r.join(" "))}t.feedback&&t.feedback.forEach(function(e){"trr-int"===e.type?n.push("a=rtcp-fb:"+t.id+" trr-int "+e.value?e.value:"0"):n.push("a=rtcp-fb:"+t.id+" "+e.type+(e.subtype?" "+e.subtype:""))})}),i.feedback&&i.feedback.forEach(function(e){"trr-int"===e.type?n.push((e.value,e.value)):n.push("a=rtcp-fb:* "+e.type+(e.subtype?" "+e.subtype:""))}),(i.headerExtensions||[]).forEach(function(e){n.push("a=extmap:"+e.id+(e.senders?"/"+SENDERS[r][o][e.senders]:"")+" "+e.uri)}),(i.sourceGroups||[]).forEach(function(e){n.push("a=ssrc-group:"+e.semantics+" "+e.sources.join(" "))}),(i.sources||[]).forEach(function(e){for(var t=0;t<e.parameters.length;t++){var r=e.parameters[t];n.push("a=ssrc:"+(e.ssrc||i.ssrc)+" "+r.key+(r.value?":"+r.value:""))}}),(a.candidates||[]).forEach(function(e){n.push(toCandidateSDP(e))}),n.join("\r\n")},toCandidateSDP=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"srflx"!==r&&"prflx"!==r&&"relay"!==r||e.relAddr&&e.relPort&&(t.push("raddr"),t.push(e.relAddr),t.push("rport"),t.push(e.relPort)),e.tcpType&&"TCP"==e.protocol.toUpperCase()&&(t.push("tcptype"),t.push(e.tcpType)),t.push("generation"),t.push(e.generation||"0"),"a=candidate:"+t.join(" ")},ModuleBase.define("TraceableWebsocket",["MessageManager","Error"],function(a,s){var e=function(){};return e.prototype.connect=function(){var t=when.defer();try{var e=document.location.protocol;"httpsionic:"==e&&(e="https:"),"http:"!=e&&"https:"!=e&&"httpsionic:"!=e&&(e="http:"),room.avdEngine.applyToElectron&&(e=room.avdEngine.electronProtocol);var r="ws://";"https:"==e&&(r="wss://");var o=r+roomServerUrl+"/ws";log.info("===webSocket,connect(), websocket URL:"+o),loggerReport.info("websocket,connect(), websocket url:"+o);var n=new WebSocket(o);n.binaryType="arraybuffer",n.readyState==WebSocket.CONNECTING&&(log.info("===webSocket,connect(),..."),loggerReport.info("webSocket,connect(),...")),n.onopen=function(){n.readyState==WebSocket.OPEN&&(log.info("===webSocket,onopen()!"),loggerReport.info("webSocket,onopen(),!")),t.resolve(n)},n.onmessage=function(e){(new a).OnWebSocketMessage(e.data)},n.onclose=function(e){if(room){var t=Date.parse(new Date);-1<room.webSocketOncloseEvents.indexOf(t)||-1<room.webSocketOncloseEvents.indexOf(t-1e3)||-1<room.webSocketOncloseEvents.indexOf(t-2e3)?log.info("===webSocket,onclose(),"+e.code+","):(room.webSocketOncloseEvents.push(t),log.info("===webSocket,onclose(),"+e.code+","),loggerReport.info("webSocket,onclose(),"+e.code+""),n.close(),n.readyState==WebSocket.CLOSED&&setTimeout(function(){room&&1==room.reconnectionState&&(log.info("===webSocket,onclose(),websocket"),loggerReport.info("webSocket,onclose(),websocket"),room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connecting),room.masterServer.pingInit(),room.reconnectionHandle())},3e3))}},n.onerror=function(e){log.info("===webSocket,onerror(),"),loggerReport.info("webSocket,onerror(),")}}catch(e){log.info("===websocket Operation  failed. with exception:"+e);var i=new s(ErrorConstant.websock_catch_exception);t.reject(i)}return t.promise},e}),ModuleBase.define("TraceablePeerConnection",["Error"],function(e){var t=function(){iceServers&&0<iceServers.length?this.iceConfig={iceServers:[{url:stunUrl},{url:trunUrl,credential:iceCredential,username:iceusername}]}:this.iceConfig={iceServers:[]},this.pcConstraints={optional:[{googCpuOveruseDetection:!1}]},this.constraints={}};t.prototype.getToMCUPeerConnection=function(){return 0<room.reconnectionCount?(null==room.toMCUReconnectionPC&&(room.toMCUReconnectionPC=this.createMCUPeerConnection()),room.toMCUReconnectionPC):(null==room.selfUser.toMCUPC&&(room.selfUser.toMCUPC=this.createMCUPeerConnection()),room.selfUser.toMCUPC)},t.prototype.createMCUPeerConnection=function(){var e=new RTCPeerConnection(this.iceConfig,this.pcConstraints);return this.handleMCUPeerConnection(e),"getConfiguration"in window.RTCPeerConnection.prototype&&log.debug("===createPeerConnectionInner(),PeerConnection Configuration:"+JSON.stringify(e.getConfiguration())),e},t.prototype.handleMCUPeerConnection=function(r){var o=when.defer();return r.msgQueue=[],r.forLog=!1,r.onicecandidate=function(e){},r.onopen=function(){},r.ontrack=function(e){log.debug("===pc.ontrack()")},r.oniceconnectionstatechange=function(e){var t=e.target.iceConnectionState;switch(log.info("===oniceconnectionstatechange(),MCU iceConnectionState:"+t),loggerReport.info("===Peerconnection iceConnectionState:"+t),t){case"disconnected":room.connectionInfoCollector&&room.connectionInfoCollector.stop(),setTimeout(function(){if(room&&room.traceablePeerConnection&&"disconnected"==room.traceablePeerConnection.getToMCUPeerConnection().iceConnectionState){if(room&&room.reconnectionOpenRep402&&0<room.reJoinRoomCount)return;var e="===PeerConnection iceConnectionState disconnected.";log.debug(e),o.reject(e),room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connecting),room.masterServer.pingInit(),room.reconnectionHandle()}},2e3);break;case"failed":case"completed":break;case"connected":room.reconnectionOpenRep402=!1,room.connectionInfoCollector=new ConnectionInfoCollector(r,1e3),room.eventEmitter.emit(RoomCallback.mcu_peerconnection_completed,MCUPeerConnectionStatus.completed)}},r.onsignalingstatechange=function(e){log.debug("===onsignalingstatechange(),MCU signalingState:"+e.target.signalingState),"stable"==e.target.signalingState?0==r.forLog&&(r.forLog=!0,r.intervalSet(r)):"closed"==e.target.signalingState&&room.connectionInfoCollector&&(log.debug("===PC.onsignalingstatechange(),signalingState=closed,Peerconnection"),room.connectionInfoCollector.stop())},r.intervalSet=function(e){window.setInterval(function(){e.processSignalingMessage(e)},100)},r.processSignalingMessage=function(e){if(room&&0!=room.addSdpLocalStates&&log.debug("===DDDDDDD9999999999999,pc.processSignalingMessage(),room.addSdpLocalStates:"+room.addSdpLocalStates),room&&0==room.addSdpLocalStates&&0==room.reconnectionCount&&"stable"==e.signalingState&&0==room.pingCountTime&&0<e.msgQueue.length){var t=e.msgQueue.pop();"add"==t.operationType?(log.debug("===:operationType:add,resourceType:"+t.para1+",resourceId:"+t.para2),function(b,_,e,w){room.addSdpLocalStates=1,log.debug("===DDDDDDD11111111111111,addSdpHandle(),room.addSdpLocalStates:"+room.addSdpLocalStates),clearTimeout(T),T=setTimeout(function(){room.addSdpLocalStates=0,log.debug("===DDDDDDD22222222222222,addSdpHandle(),setTimeout room.addSdpLocalStates:"+room.addSdpLocalStates)},3e3);for(var S,t,n=null,r=0;r<room.midObjSet.length;r++){var o=room.midObjSet[r];if(o.type==b&&!o.isSender){n=o;break}}if("audio"==b){var i=room.getDeviceIdByUUID(2,_);S=room.selfUser.getAudio(i),t=room.audioMediaTemplate}else if("video"==b){var i=room.getDeviceIdByUUID(0,_);S=room.selfUser.getVideo(i),t=room.videoMediaTemplate}else"screen"==b&&(S=room.selfUser.getScreen(_),t=room.videoMediaTemplate);t.fingerprint&&(t.fingerprint.type="sha-1",t.fingerprint.hash=room.fingerPrint);var a=e.getTracks()[0],E=null,s=null,I=new SDPTransform;if(n){s=P(n.mid),log.debug("===addSdpHandle(),currMidObj.mid:"+n.mid+",currTransceiver:",s),s.sender.replaceTrack(a),void 0!==s.sender.setStreams&&s.sender.setStreams(room.selfUser.stream),n.isReceiver?s.direction="sendrecv":s.direction="sendonly",n.isSender=!0,S.RTCRtpSender=s.sender,S.mid=s.mid;var d=I.parse(room.remoteDescriptionSDP);for(var l in d.media){var u=d.media[l];u.mid==n.mid&&(n.isReceiver?u.direction="sendrecv":u.direction="recvonly")}room.remoteDescriptionSDP=I.writer(d)}else{room.midNum=room.midNum+1;var c={mid:room.midNum,type:b,isReceiver:!1,isSender:!0,receiverInfo:{trackId:"",nodeId:"",deviceId:""}};room.midObjSet.push(c),t.mid=room.midNum,t.direction="recvonly";var p=I.mediaWriter(t);room.remoteDescriptionSDP=room.remoteDescriptionSDP+p;var d=I.parse(room.remoteDescriptionSDP);d.groups[0].mids=d.groups[0].mids+" "+room.midNum,room.remoteDescriptionSDP=I.writer(d)}var h={};h.sdp=room.remoteDescriptionSDP,h.type="offer",log.debug("===addSdpHandle(),resourceType:"+b+",remote offer description:"+h.sdp);var f=new RTCSessionDescription(h);room.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(f).then(function(){if(log.info("===addSdpHandle(),resourceType:"+b+",success to add remote description"),!n){var e=P(room.midNum);log.debug("===addSdpHandle(),room.midNum:"+room.midNum+",transceiver:",e),e.sender.replaceTrack(a),void 0!==e.sender.setStreams&&e.sender.setStreams(room.selfUser.stream),e.direction="sendonly",S.RTCRtpSender=e.sender,S.mid=e.mid}if(simulcastEnabled&&room.avdEngine.isFirefox&&"video"==b){var t=S.RTCRtpSender,r={},o=M(S)+1;1==o?r.encodings=[{rid:"high",active:!0,priority:"high",scaleResolutionDownBy:1}]:2==o?r.encodings=[{rid:"high",active:!0,priority:"high",scaleResolutionDownBy:1},{rid:"medium",active:!0,priority:"medium",scaleResolutionDownBy:2}]:3==o&&(r.encodings=[{rid:"high",active:!0,priority:"high",scaleResolutionDownBy:1},{rid:"medium",active:!0,priority:"medium",scaleResolutionDownBy:2},{rid:"low",active:!0,priority:"low",scaleResolutionDownBy:4}]),t.setParameters(r)}room.traceablePeerConnection.getToMCUPeerConnection().createAnswer(this.constraints).then(function(t){t.sdp=updateSDPIceUfrag(t.sdp,room.iceUfrag),t.sdp=updateSDPIcePwd(t.sdp,room.icePwd);var e="",r=I.parse(t.sdp);for(var o in r.media){var n=r.media[o];if(simulcastEnabled&&!room.avdEngine.isFirefox&&"video"==b&&"video"==n.type&&n.ssrcs&&0<n.ssrcs.length){for(var i=null,a=0;a<room.selfUser.videos.length;a++){var s=room.selfUser.videos[a];if(n.mid==s.mid){i=M(s);break}}i&&x(n,i)}var d=b;if("screen"==d&&(d="video"),log.debug("===addSdpHandle(),mediaObj.type:"+n.type+",mediaType:"+d+",mediaObj.mid:"+n.mid+",media.mid:"+S.mid),n.type==d&&n.mid==S.mid){var l=n.msid;if(l)log.debug("===addSdpHandle(),msid:"+l),E=l.split(" ")[1];else for(var u in n.ssrcs){var c=n.ssrcs[u];if("msid"==c.attribute){var p=c.value;p&&(E=p.split(" ")[1])}}if(e=I.ssrcGroupsAndSsrcsWriter(n.ssrcGroups,n.ssrcs),room.avdEngine.isFirefox){var h=l.split(" "),f=h[0],m=h[1];if(simulcastEnabled){var g="a=ssrc-group:SIM";for(var o in n.ssrcs){var c=n.ssrcs[o],v=c.id;g=g+" "+v,e=(e=(e=e+"a=ssrc:"+v+" msid:"+l)+"\r\na=ssrc:"+v+" mslabel:"+f)+"\r\na=ssrc:"+v+" label:"+m,o<n.ssrcs.length&&(e+="\r\n")}e=g+"\r\n"+e}else if(1==n.ssrcs.length){var v=n.ssrcs[0].id;e=(e=(e=e+"a=ssrc:"+v+" msid:"+l)+"\r\na=ssrc:"+v+" mslabel:"+f)+"\r\na=ssrc:"+v+" label:"+m}}S.ssrcStr=e}}log.debug("===addSdpHandle(),resourceType:"+b+",trackId:"+E+",ssrc:"+e);var y=S.publishKeepAliveTime;y||(y=room.avdEngine.defaultMediaPublishKeepAliveTime),room.masterServer.pubRoomResourceMsg(b,E,e,_,w,y),t.sdp=I.writer(r),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){clearTimeout(T),e==w&&(log.debug("===addSdpHandle(),resourceType:"+b+",local answer description:"+t.sdp),room.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(t).then(function(){if(room.addSdpLocalStates=0,log.debug("===DDDDDDD333333333,addSdpHandle() pub_roomresourcemsg_rep_success,room.addSdpLocalStates:"+room.addSdpLocalStates),log.info("===addSdpHandle(),resourceType:"+b+",success to add local description"),"audio"!=b&&"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype){var e=S.RTCRtpSender;if(e){var t=e.getParameters();t.encodings?t.encodings==[]&&(t.encodings[0]={}):t.encodings=[{}];var r=null,o=!1;if(S.clientSetMaxBandwidth?(r=S.clientSetMaxBandwidth,o=!0):r=S.maxBandwidth,r&&0!=r){if(!room.avdEngine.isFirefox){var n=t.encodings.length;1==n?t.encodings[0].maxBitrate=1e3*r:2==n?(t.encodings[0].maxBitrate=500*r,t.encodings[1].maxBitrate=1e3*r):3==n&&(t.encodings[0].maxBitrate=250*r,t.encodings[1].maxBitrate=500*r,t.encodings[2].maxBitrate=1e3*r)}if(room.avdEngine.isFirefox){var n=t.encodings.length;1==n?t.encodings[0].maxBitrate=1e3*r:2==n?(t.encodings[0].maxBitrate=1e3*r,t.encodings[1].maxBitrate=500*r):3==n&&(t.encodings[0].maxBitrate=1e3*r,t.encodings[1].maxBitrate=500*r,t.encodings[2].maxBitrate=250*r)}}else for(var i=0;i<t.encodings.length;i++)delete t.encodings[i].maxBitrate;e.setParameters(t).then(function(){log.debug("===addSdpHandle(),resourceType:"+b+",:"+o+",,maxBitrate:"+r+",id:"+S.id)}).catch(function(e){log.error("===addSdpHandle(),resourceType:"+b+",:"+o+",,maxBitrate:"+r+",error:",e)})}}}).catch(function(e){room.addSdpLocalStates=0,log.debug("===DDDDDDD4444444444,addSdpHandle() pub_roomresourcemsg_rep_success  error,room.addSdpLocalStates:"+room.addSdpLocalStates),log.error("===addSdpHandle(), resourceType:"+b+",Failed to add local description: "+e.toString())}))}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){clearTimeout(T),room.addSdpLocalStates=0,log.debug("===DDDDDDD5555555555,addSdpHandle() pub_roomresourcemsg_rep_error  room.addSdpLocalStates:"+room.addSdpLocalStates),log.error("===addSdpHandle(),resourceType:"+b+",Failed to pub, by acception PUB_ROOM_RESOURCE_MSG_REP result !=0.")})}).catch(C)}).catch(function(e){log.error("===addSdpHandle(),resourceType:"+b+", Failed to add remote description: "+e.toString())})}(t.para1,t.para2,t.para3,t.para4)):"update"==t.operationType?(log.debug("===:operationType:update,resourceType:"+t.para1+",updateType:"+t.para2+",resourceId:"+t.resourceId),function(e,v,y,b,r,_){if(!b)return;room.addSdpLocalStates=1,log.debug("===DDDDDDD666666666,updateSdpHandle(),room.addSdpLocalStates:"+room.addSdpLocalStates+",resourceType:"+v+",updateType:"+y+",resourceId:"+e),clearTimeout(R),R=setTimeout(function(){room.addSdpLocalStates=0,log.debug("===DDDDDDD69696969696969,updateSdpHandle(),setTimeout room.addSdpLocalStates:"+room.addSdpLocalStates)},3e3);var w,S=b.stream.stream_name,t=null;if(0==y){for(var o=0;o<room.midObjSet.length;o++){var E=room.midObjSet[o];if(E.type==v&&E.receiverInfo&&E.receiverInfo.trackId==S){t=E;break}}var n="null";t&&(n=JSON.stringify(t)),log.debug("===updateSdpHandle(),updateType:0,resourceType:"+v+",ownerId:"+b.owner_id+",trackId:"+S+",currMidObj:"+n),t&&(w=t.mid,u=P(t.mid),t.isSender?u.direction="sendonly":u.direction="recvonly",t.isReceiver=!1);var i=new SDPTransform,a=i.parse(room.remoteDescriptionSDP),s=i.parse(b.stream.sdp);for(var d in a.media){var l=a.media[d];if(t&&l.mid==t.mid){l.ssrcGroups=[],l.ssrcs=[],"audio"==v?t.isSender?l.direction="recvonly":l.direction="sendonly":l.direction="sendrecv";break}}room.remoteDescriptionSDP=i.writer(a)}else if(1==y){for(var t=null,o=0;o<room.midObjSet.length;o++){var E=room.midObjSet[o];if(E.type==v&&!E.isReceiver&&E.receiverInfo&&""==E.receiverInfo.trackId){t=E;break}}var n="null";t&&(n=JSON.stringify(t)),log.debug("===updateSdpHandle(),updateType:1,resourceType:"+v+",ownerId:"+b.owner_id+",trackId:"+S+",currMidObj:"+n);var u=null;if(t)w=t.mid,u=P(t.mid),t.isSender?u.direction="sendrecv":u.direction="recvonly",t.isReceiver=!0,t.receiverInfo={trackId:S,nodeId:b.owner_id,deviceId:b.resource_id},log.debug("===updateSdpHandle(),updateType:1,resourceType:"+v+",ownerId:"+b.owner_id+",trackId:"+S+",currMidObj != null,trackId:"+S+",currMidObj:"+JSON.stringify(t));else{room.midNum=room.midNum+1,w=room.midNum;var c={mid:room.midNum,type:v,isReceiver:!0,isSender:!1,receiverInfo:{trackId:S,nodeId:b.owner_id,deviceId:b.resource_id}};log.debug("===updateSdpHandle(),updateType:1,resourceType:"+v+",ownerId:"+b.owner_id+",trackId:"+S+",currMidObj = null,trackId:"+S+",newMidObj:"+JSON.stringify(c)),room.midObjSet.push(c)}var i=new SDPTransform;if(t){var a=i.parse(room.remoteDescriptionSDP),s=i.parse(b.stream.sdp);for(var d in a.media){var l=a.media[d];if(l.mid==t.mid){l.ssrcGroups=s.ssrcGroups,l.ssrcs=s.ssrcs,s.msid&&(l.msid=s.msid),t.isSender?l.direction="sendrecv":l.direction="sendonly";break}}if(s.msid){var p=s.msid.split(" ")[0];a.msidSemantic.token=a.msidSemantic.token+" "+p}room.remoteDescriptionSDP=i.writer(a)}else{var h;"audio"==v?h=room.audioMediaTemplate:"video"!=v&&"screen"!=v||(h=room.videoMediaTemplate),h.fingerprint&&(h.fingerprint.type="sha-1",h.fingerprint.hash=room.fingerPrint),h.mid=room.midNum,h.direction="sendonly";var f=i.mediaWriter(h);room.remoteDescriptionSDP=room.remoteDescriptionSDP+f+b.stream.sdp;var m=i.parse(room.remoteDescriptionSDP);m.groups[0].mids=m.groups[0].mids+" "+room.midNum,room.remoteDescriptionSDP=i.writer(m)}}var g={};g.sdp=room.remoteDescriptionSDP,g.type="offer";var I=new RTCSessionDescription(g);log.debug("===updateSdpHandle(),updateType:"+y+",resourceType:"+v+",remote offer description:"+g.sdp),room.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(I).then(function(){log.info("===updateSdpHandle(),updateType:"+y+",resourceType:"+v+",success to add remote description"),room.traceablePeerConnection.getToMCUPeerConnection().createAnswer(this.constraints).then(function(e){e.sdp=updateSDPIceUfrag(e.sdp,room.iceUfrag),e.sdp=updateSDPIcePwd(e.sdp,room.icePwd),log.debug("===updateSdpHandle(),updateType:"+y+",resourceType:"+v+",local answer description:"+e.sdp),room.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(e).then(function(){room.addSdpLocalStates=0,log.debug("===DDDDDDD121212121212121212,updateSdpHandle(),room.addSdpLocalStates:"+room.addSdpLocalStates),log.info("===updateSdpHandle(),updateType:"+y+",resourceType:"+v+",success to add local description"),room.masterServer.subRoomResourceMsg(v,y,b,r,_);var e=EngineCallback.sub_roomresourcemsg_rep_success,t=EngineCallback.sub_roomresourcemsg_rep_error;0==y&&(e=EngineCallback.unsub_roomresourcemsg_rep_success,t=EngineCallback.unsub_roomresourcemsg_rep_error),room.addCallback(e,function(e){if(clearTimeout(R),e==_){for(var t=room.getUserByNodeId(b.owner_id),r=null,o=0;o<room.midObjSet.length;o++)if(E.type==v&&E.mid==w){r=E;break}var n,i=P(w);if(i&&(n=i.receiver.track),t&&"audio"==v){var a=t.getAudio(b.resource_id);if(a)if(1==y){var s=!1;for(var d in room.selfUser.subAudioIds)room.selfUser.subAudioIds[d]==a.id&&(s=!0);s||room.selfUser.subAudioIds.push(a.id),a.track=n;var l=new MediaStream;l.addTrack(n),log.info("===audio updateSdpHandle() add, callback subscrible_microphone_result userId:"+t.id+",userName:"+t.name+",resourceId:"+b.resource_id),t.eventEmitter.emit(UserCallback.subscrible_microphone_result,l,t.id,t.name)}else 0==y&&(arrayUtil.baseSplice(room.selfUser.subAudioIds,a.id),a.track=null,log.info("===audio updateSdpHandle() remove,callback unsubscrible_microphone_result userId:"+t.id+",userName:"+t.name),t.eventEmitter.emit(UserCallback.unsubscrible_microphone_result,t.id,t.name),r&&(r.receiverInfo={trackId:"",nodeId:"",deviceId:""}))}else if(t&&"video"==v){var u=t.getVideo(b.resource_id);if(u)if(1==y){var s=!1;for(var d in room.selfUser.subVideoIds)room.selfUser.subVideoIds[d]==u.id&&(s=!0);s||room.selfUser.subVideoIds.push(u.id),u.track=n;var c=new MediaStream;c.addTrack(n),log.info("===video updateSdpHandle add,callback subscrible_camera_result userId:"+t.id+",userName:"+t.name+",resourceId:"+b.resource_id),t.eventEmitter.emit(UserCallback.subscrible_camera_result,c,t.id,t.name,b.resource_id)}else if(0==y){arrayUtil.baseSplice(room.selfUser.subVideoIds,u.id),u.track=null;var p="null";r&&(p=r.mid),log.info("===video updateSdpHandle remove,callback unsubscrible_camera_result userId:"+t.id+",userName:"+t.name+",videoId:"+b.resource_id+",trackId:"+S+",tempMidObjMid:"+p),t.eventEmitter.emit(UserCallback.unsubscrible_camera_result,t.id,t.name,b.resource_id),r&&(r.receiverInfo={trackId:"",nodeId:"",deviceId:""})}}else if(t&&"screen"==v){var h=t.getScreen(b.resource_id);if(h)if(1==y){var f=!1;for(var d in room.selfUser.subScreenIds)room.selfUser.subScreenIds[d]==h.id&&(f=!0);f||room.selfUser.subScreenIds.push(h.id),h.track=n;var m=new MediaStream;m.addTrack(n);var g=b.stream;log.info("===screen updateSdpHandle add,callback subscrible_screen_result userId:"+t.id+",userName:"+t.name+",resourceId:"+b.resource_id),t.eventEmitter.emit(UserCallback.subscrible_screen_result,m,t.id,t.name,b.resource_id,g.width,g.height,g.frame_rate)}else 0==y&&(arrayUtil.baseSplice(room.selfUser.subScreenIds,h.id),h.track=null,log.info("===screen updateSdpHandle remove,callback unsubscrible_screen_result  userId:"+t.id+",userName:"+t.name),t.eventEmitter.emit(UserCallback.unsubscrible_screen_result,t.id,t.name,b.resource_id),r&&(r.receiverInfo={trackId:"",nodeId:"",deviceId:""}))}}}),room.addCallback(t,function(e,t){clearTimeout(R),room.addSdpLocalStates=0,1==y?(log.debug("===DDDDDDD678678678678678678,upateSdpHandle() sub_roomresourcemsg_rep_error  room.addSdpLocalStates:"+room.addSdpLocalStates),log.error("===updateSdpHandle(), resourceType:"+v+",updateType:"+y+",Failed to sub, by acception SUB_ROOM_RESOURCE_MSG_REP result !=0.")):(log.debug("===DDDDDDD678678678678678678,upateSdpHandle() unsub_roomresourcemsg_rep_error  room.addSdpLocalStates:"+room.addSdpLocalStates),log.error("===updateSdpHandle(), resourceType:"+v+",updateType:"+y+",Failed to sub, by acception UNSUB_ROOM_RESOURCE_MSG_REP result !=0."))})}).catch(function(e){room.addSdpLocalStates=0,log.debug("===DDDDDDD1313131313,updateSdpHandle() error,room.addSdpLocalStates:"+room.addSdpLocalStates),log.error("===updateSdpHandle(),resourceType:"+v+",Failed to add local description,error:"+e.toString())})}).catch(C)}).catch(function(e){log.error("===updateSdpHandle(),resourceType:"+v+",Failed to add remote description,error:"+e.toString())})}(t.resourceId,t.para1,t.para2,t.para3,t.para4,t.para5)):"reduce"==t.operationType?(log.debug("===:operationType:reduce,resourceType:"+t.para1+",resourceId:"+t.para2),function(r,o,n){var e;if(room.addSdpLocalStates=1,log.debug("===DDDDDDD1010101010101010,reduceSdpHandle(),room.addSdpLocalStates:"+room.addSdpLocalStates),"audio"==r)e=room.selfUser.audio;else if("video"==r){var t=room.getDeviceIdByUUID(0,o);e=room.selfUser.getVideo(t)}else"screen"==r&&(e=room.selfUser.screen);e&&e.RTCRtpSender&&room.traceablePeerConnection.getToMCUPeerConnection().removeTrack(e.RTCRtpSender);for(var i=null,a=0;a<room.midObjSet.length;a++){var s=room.midObjSet[a];if(s.type==r&&s.mid==e.mid){i=s;break}}i.isSender=!1,P(e.mid).direction="recvonly";var d=new SDPTransform,l=d.parse(room.remoteDescriptionSDP);for(var u in l.media){var c=l.media[u];c.mid==e.mid&&(c.direction="sendonly")}room.remoteDescriptionSDP=d.writer(l);var p={};p.sdp=room.remoteDescriptionSDP,p.type="offer",log.debug("===reduceSdpHandle(),resourceType:"+r+",remote offer description:"+p.sdp);var h=new RTCSessionDescription(p);room.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(h).then(function(){log.info("===reduceSdpHandle(),resourceType:"+r+",success to add remote description"),room.traceablePeerConnection.getToMCUPeerConnection().createAnswer(this.constraints).then(function(e){e.sdp=updateSDPIceUfrag(e.sdp,room.iceUfrag),e.sdp=updateSDPIcePwd(e.sdp,room.icePwd),log.debug("===reduceSdpHandle(),resourceType:"+r+",local answer description:"+e.sdp);var t=n.getTracks()[0];room.masterServer.unpubRoomResourceMsg(r,t.id,o),room.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(e).then(function(){room.addSdpLocalStates=0,log.debug("===DDDDDDD121212121212121212,reduceSdpHandle(),room.addSdpLocalStates:"+room.addSdpLocalStates),log.info("===reduceSdpHandle(),resourceType:"+r+",success to add local description")}).catch(function(e){room.addSdpLocalStates=0,log.debug("===DDDDDDD1313131313,reduceSdpHandle() error,room.addSdpLocalStates:"+room.addSdpLocalStates),log.error("===reduceSdpHandle(),resourceType:"+r+",Failed to add local description,error:"+e.toString())})}).catch(C)}).catch(function(e){log.error("===reduceSdpHandle(),resourceType:"+r+",Failed to add remote description,error:"+e.toString())})}(t.para1,t.para2,t.para3)):"audioBatch"==t.operationType&&(log.debug("===:operationType:audioBatch"),function(r){if(!r)return;for(p in room.addSdpLocalStates=1,log.debug("===DDDDDDD31313131313131,audioBatchSdpHandle(),room.addSdpLocalStates:"+room.addSdpLocalStates),clearTimeout(_),_=setTimeout(function(){room.addSdpLocalStates=0,log.debug("===DDDDDDD39393939393939,audioBatchSdpHandle(),setTimeout room.addSdpLocalStates:"+room.addSdpLocalStates)},3e3),r){for(var e=r[p],t=e.stream.stream_name,o=e.owner_id,n=null,i=0;i<room.midObjSet.length;i++){var a=room.midObjSet[i];if("audio"==a.type&&!a.isReceiver){n=a;break}}log.debug("===audioBatchSdpHandle(),ownerId:"+o+",currMidObj:",n);var s=null;if(n)n.mid,s=P(n.mid),n.isSender?s.direction="sendrecv":s.direction="recvonly",n.isReceiver=!0,n.receiverInfo={trackId:t,nodeId:o,deviceId:e.resource_id};else{room.midNum=room.midNum+1,room.midNum;var d={mid:room.midNum,type:"audio",isReceiver:!0,isSender:!1,receiverInfo:{trackId:t,nodeId:o,deviceId:e.resource_id}};room.midObjSet.push(d)}var l=new SDPTransform;if(n){var u=l.parse(room.remoteDescriptionSDP),c=l.parse(e.stream.sdp);for(var p in u.media){var h=u.media[p];if(h.mid==n.mid){h.ssrcGroups=c.ssrcGroups,h.ssrcs=c.ssrcs,c.msid&&(h.msid=c.msid),n.isSender?h.direction="sendrecv":h.direction="sendonly";break}}if(c.msid){var f=c.msid.split(" ")[0];u.msidSemantic.token=u.msidSemantic.token+" "+f}room.remoteDescriptionSDP=l.writer(u)}else{var m=room.audioMediaTemplate;m.fingerprint&&(m.fingerprint.type="sha-1",m.fingerprint.hash=room.fingerPrint),m.mid=room.midNum,m.direction="sendonly";var g=l.mediaWriter(m);room.remoteDescriptionSDP=room.remoteDescriptionSDP+g+e.stream.sdp;var v=l.parse(room.remoteDescriptionSDP);v.groups[0].mids=v.groups[0].mids+" "+room.midNum,room.remoteDescriptionSDP=l.writer(v)}}var y={};y.sdp=room.remoteDescriptionSDP,y.type="offer";var b=new RTCSessionDescription(y);log.debug("===audioBatchSdpHandle(),remote offer description:"+y.sdp),room.traceablePeerConnection.getToMCUPeerConnection().setRemoteDescription(b).then(function(){log.info("===audioBatchSdpHandle(),success to add remote description"),room.traceablePeerConnection.getToMCUPeerConnection().createAnswer(this.constraints).then(function(e){e.sdp=updateSDPIceUfrag(e.sdp,room.iceUfrag),e.sdp=updateSDPIcePwd(e.sdp,room.icePwd),log.debug("===audioBatchSdpHandle(),local answer description:"+e.sdp),room.traceablePeerConnection.getToMCUPeerConnection().setLocalDescription(e).then(function(){room.addSdpLocalStates=0,log.debug("===DDDDDDD3232323232323232,audioBatchSdpHandle(),room.addSdpLocalStates:"+room.addSdpLocalStates),log.info("===audioBatchSdpHandle(),success to add local description");var c=[];for(p in r)!function(){var l=r[p],u=getRandomNum(1e4,13e3);room.masterServer.subRoomResourceMsg("audio",1,l,null,u);var e=EngineCallback.sub_roomresourcemsg_rep_success,t=EngineCallback.sub_roomresourcemsg_rep_error;room.addCallback(e,function(e){if(clearTimeout(_),!c.includes(e)&&e==u){c.push(e);for(var t=null,r=0;r<room.midObjSet.length;r++){var o=room.midObjSet[r];if("audio"==o.type&&o.receiverInfo.nodeId==l.owner_id){t=o.mid;break}}var n,i=P(t);i&&(n=i.receiver.track);var a=room.getUserByNodeId(l.owner_id),s=a.getAudio(l.resource_id);if(s){s.track=n;var d=new MediaStream;d.addTrack(n),log.info("===audio audioBatchSdpHandle() add, callback subscrible_microphone_result userId:"+a.id+",userName:"+a.name+",resourceId:"+l.resource_id),a.eventEmitter.emit(UserCallback.subscrible_microphone_result,d,a.id,a.name)}}}),room.addCallback(t,function(e,t){clearTimeout(_),room.addSdpLocalStates=0,log.debug("===DDDDDDD789789789789789,upateSdpHandle() sub_roomresourcemsg_rep_error  room.addSdpLocalStates:"+room.addSdpLocalStates),log.error("===audioBatchSdpHandle(),Failed to sub, by acception SUB_ROOM_RESOURCE_MSG_REP result !=0.")})}()}).catch(function(e){room.addSdpLocalStates=0,log.debug("===DDDDDDD333333333333333,audioBatchSdpHandle() error,room.addSdpLocalStates:"+room.addSdpLocalStates),log.error("===audioBatchSdpHandle(),Failed to add local description,error:"+e.toString())})}).catch(C)}).catch(function(e){log.error("===audioBatchSdpHandle(),Failed to add remote description,error:"+e.toString())})}(t.para1))}},o.promise},t.prototype.close=function(e){e&&"closed"!=e.signalingState&&e.close()},t.prototype.doSetLocalDescription=function(){var i=this,a=when.defer();return i.getToMCUPeerConnection().createAnswer(this.constraints).then(function(e){var t=e.sdp;t=updateSDPIcePwd(t=updateSDPIceUfrag(t,room.iceUfrag),room.icePwd);var r="active";"active"==room.setup&&(r="passive"),t=updateSDPSetup(t,r),log.debug("===doSetLocalDescription(),local answer description:"+t);var o={};o.sdp=t,o.type="answer";var n=new RTCSessionDescription(o);i.getToMCUPeerConnection().setLocalDescription(n).then(function(){log.info("===doSetLocalDescription(), set local sessionDescription success"),a.resolve()}).catch(function(e){log.error("===doSetLocalDescription(), set local sessionDescription error: "+e.toString()),a.reject(e)})}).catch(C),a.promise},t.prototype.doSetRemoteDescription=function(){var r=when.defer(),e=updateSDPFingerPrint(room.remoteSdpTemplate,room.fingerPrint);e=updateSDPSetup(e=updateSDPIcePwd(e=updateSDPIceUfrag(e,room.iceUfrag),room.icePwd),"actpass"),room.remoteDescriptionSDP=e;var t={};t.sdp=e,t.type="offer",log.debug("===doSetRemoteDescription, remote sessionDescription:"+e);var o=new RTCSessionDescription(t);return this.getToMCUPeerConnection().setRemoteDescription(o).then(function(){if(log.info("===doSetRemoteDescription(), set remote sessionDescription success"),setRemoteDescriptionSuccess=!0,null!=addIcecandidateList&&0<addIcecandidateList.length){for(var e=0;e<addIcecandidateList.length;e++){var t=addIcecandidateList[e];room.masterServer.setAddIcecandidate(t)}addIcecandidateList=[]}r.resolve()}).catch(function(e){log.error("===doSetRemoteDescription(), setRemoteDescription error:"+e),r.reject(e)}),r.promise},t.prototype.doAddIceCandidate=function(e){var t="";-1<e.candidate.indexOf("=")&&(t=e.candidate.split("=")[1]);var r=new RTCIceCandidate({sdpMLineIndex:e.sdp_mline_index,sdpMid:"0",candidate:t});log.info("===pc.addIceCandidate,audio:"+r.candidate),loggerReport.info("PeerConnection add audio IceCandidate:"+r.candidate),this.getToMCUPeerConnection().addIceCandidate(r).then(function(){log.info("===PeerConnection.addIceCandidate,audio Success to add remote candidate["+r.candidate+"]")}).catch(function(e){log.error("===PeerConnection.addIceCandidate,audio Failed to add remote candidate["+r.candidate+"],"+e.toString())});var o=new RTCIceCandidate({sdpMLineIndex:1,sdpMid:"1",candidate:t});log.info("===pc.addIceCandidate,video:"+o.candidate),loggerReport.info("PeerConnection add video IceCandidate"+r.candidate),this.getToMCUPeerConnection().addIceCandidate(o).then(function(){log.info("===PeerConnection.addIceCandidate,video Success to add remote candidate["+o.candidate+"]")}).catch(function(e){log.error("===PeerConnection.addIceCandidate,video Failed to add remote candidate["+o.candidate+"],"+e.toString())})},t.prototype.addSdp=function(e,t,r,o){log.debug("===traceablePeerConnection.addSdp(),resourceType:"+e+",resourceId:"+t+",orderId:"+o),a(i("add",t,e,t,r,o))},t.prototype.updateSdp=function(e,t,r,o,n){log.debug("===traceablePeerConnection.updateSdp(),resourceType:"+e+",updateType:"+t+",ownerId:"+r.owner_id+",resourceId:"+r.resource_id+",sdp:"+r.stream.sdp),a(i("update",r.resource_id,e,t,r,o,n))},t.prototype.reduceSdp=function(e,t,r){log.debug("===traceablePeerConnection.reduceSdp(),resourceType:"+e+",resourceId:"+t),a(i("reduce",t,e,t,r))},t.prototype.audioBatchSdp=function(e){log.debug("===traceablePeerConnection.audioBatchSdp(),resourceInfosLength:"+e.length),a(i("audioBatch",null,e))},t.prototype.isContainsReconnectionSub=function(e,t){var r=!1;if(null!=t&&0<t.length)for(var o=0;o<t.length;o++){if(e==t[o]){r=!0;break}}return r};var T,R,_;function i(e,t,r,o,n,i,a){var s={};return s.operationType=e,s.resourceId=t,s.para1=r,s.para2=o,s.para3=n,s.para4=i,s.para5=a,s}function C(e){room.addSdpLocalStates=0,log.debug("===DDDDDDDDDD252525252525,onCreateSessionDescriptionError(),room.addSdpLocalStates:"+room.addSdpLocalStates),log.error("===onCreateSessionDescriptionError(),Failed to add local description,error:"+e.toString())}function a(e){if(e){var t=room.traceablePeerConnection.getToMCUPeerConnection().msgQueue,r=e.operationType;if("audioBatch"==r)return log.debug("===msgQueue insertQueueHandle(),operationType=audioBatch"),void t.unshift(e);if("update"==r){var o=e.resourceId,n=e.para1,i=e.para2;return s(o)?void function(e,t,r){var o,n;log.debug("===msgQueue updateHandle(),resourceId:"+e+",updateType:"+t);for(var i=room.traceablePeerConnection.getToMCUPeerConnection().msgQueue,a=0;a<i.length;a++){var s=i[a];"update"==s.operationType&&s.resourceId==e&&(o=s.para2,n=a)}log.debug("===msgQueue updateHandle(),existUpdateType="+o+",resourceId:"+e),0==o||1==o?(log.debug("===msgQueue updateHandle(),existUpdateType11111111111111"),1==t?0==o?(log.debug("===msgQueue updateHandle(),operationType==update,updateType==1existUpdateType == 0,resourceId:"+e),i.splice(n,1)):log.debug("===msgQueue updateHandle(),operationType==update,updateType==1existUpdateType == 1,resourceId:"+e):1==o?(log.debug("===msgQueue updateHandle(),operationType==update,updateType==0existUpdateType == 1,resourceId:"+e),i.splice(n,1)):log.debug("===msgQueue updateHandle(),operationType==update,updateType==0existUpdateType == 0,resourceId:"+e)):(log.debug("===msgQueue updateHandle(),existUpdateType000000000000000"),i.unshift(r))}(o,i,e):(log.debug("===msgQueue insertQueueHandle(),operationType=update,isExist=false,resourceType:"+n+",updateType:"+i+",resourceId:"+o),void t.unshift(e))}if("add"==r||"reduce"==r){o=e.resourceId,n=e.para1;return s(o)?void function(e,t,r){var o,n,i,a;log.debug("===msgQueue addOrReduceHandle(),operationType:"+e+",resourceId:"+t);for(var s=room.traceablePeerConnection.getToMCUPeerConnection().msgQueue,d=0;d<s.length;d++){var l=s[d];l.resourceId==t&&("add"==l.operationType?(o=!0,i=d):"reduce"==l.operationType&&(n=!0,a=d))}{if(!o&&!n)return s.unshift(r);if("add"==e){if(n)return log.debug("===msgQueue addOrReduceHandle(),operationType==add || reduce ,operationType==addexistReduceOperationType == true,resourceId:"+t),s.splice(a,1);if(o)return log.debug("===msgQueue addOrReduceHandle(),operationType==add || reduce ,operationType==addexistAddOperationType == true,resourceId:"+t)}if("reduce"==e){if(o)return log.debug("===msgQueue addOrReduceHandle(),operationType==add || reduce ,operationType==reduceexistAddOperationType == true,resourceId:"+t),s.splice(i,1);if(n)log.debug("===msgQueue addOrReduceHandle(),operationType==add || reduce ,operationType==reduceexistReduceOperationType == true,resourceId:"+t)}}}(r,o,e):(log.debug("===msgQueue insertQueueHandle(),operationType=="+r+",isExist == false,resourceType:"+n+",resourceId:"+o),void t.unshift(e))}}}function s(e){for(var t=!1,r=room.traceablePeerConnection.getToMCUPeerConnection().msgQueue,o=0;o<r.length;o++){if(r[o].resourceId==e){t=!0;break}}return t}function P(e){for(var t=null,r=room.traceablePeerConnection.getToMCUPeerConnection().getTransceivers(),o=0;o<r.length;o++){var n=r[o];if(n.mid==e){t=n;break}}return t}function M(e){var t=0,r=e.resolution.width,o=e.resolution.height;if(log.debug("===getMockssrcNume(),resolution Width:",r+",Height:"+o),e.track){var n=e.track.getSettings(),i=n.width,a=n.height;log.debug("===getMockssrcNume(), trackSetting Width:",i+",Height:"+a);var s=i;i<a&&(s=a),s<480?t=0:640<=s&&s<960?t=1:960<=s&&(t=2)}else log.debug("===getMockssrcNume(), media.track is null");return log.debug("===getMockssrcNume(), mockNume:",t),t}function x(e,t){for(var r=(n=e.ssrcs)[0].id,o=n.length-1;0<=o;o--){(p=n[o]).id!=r&&n.splice(o,1)}var n=[r],i=r+2e3,a=r+4e3,s=h(e.ssrcs),d=h(e.ssrcs);if(1<=t){var l=!1;for(var u in e.ssrcs){if((p=e.ssrcs[u]).id==i){l=!0;break}}if(!l){for(var u in s){(p=s[u]).id=i,e.ssrcs.push(p)}n.push(i)}}if(2<=t){var c=!1;for(var u in e.ssrcs){if((p=e.ssrcs[u]).id==a){c=!0;break}}if(!c){for(var u in d){var p;(p=d[u]).id=a,e.ssrcs.push(p)}n.push(a)}}e.ssrcGroups=[],e.ssrcGroups.push({semantics:"SIM",ssrcs:n.join(" ")})}function h(e){var t;if(e instanceof Array){t=[];for(var r=e.length;r--;)t[r]=h(e[r]);return t}if(e instanceof Object){for(var o in t={},e)t[o]=h(e[o]);return t}return e}return t}),ModuleBase.define("TraceableP2PPeerConnection",["Error"],function(e){var t=function(){iceServers&&0<iceServers.length?this.iceConfig={iceServers:[{url:stunUrl},{url:trunUrl,credential:iceCredential,username:iceusername}]}:this.iceConfig={iceServers:[]},this.pcConstraints={optional:[{googImprovedWifiBwe:!0}]},this.constraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!1}};t.prototype.getToP2PPeerConnection=function(e){var t=room.selfUser.toP2PPCs[e];return null==t&&(t=this.createP2PPeerConnection(e),room.selfUser.toP2PPCs[e]=t,room.selfUser.nodeId<e&&this.sendOfferP2P(t,e)),t},t.prototype.createP2PPeerConnection=function(e){var t=new RTCPeerConnection(this.iceConfig,this.pcConstraints);return this.handleP2PPeerConnection(e,t),t},t.prototype.sendOfferP2P=function(t,r,e){var o=this.constraints;o.iceRestart=1==e;var n=this;t.createOffer(function(e){log.debug("sendOfferP2P(): P2P  local sessionDescription:"+e.sdp),t.setLocalDescription(e,l,f),room.masterServer.sendOfferP2P(e.sdp,r),n.constraints.iceRestart=!1},function(e){},o)},t.prototype.setRemoteP2P=function(t){var e={};e.sdp=t.sdp,e.type="offer";var r=new RTCSessionDescription(e);room.sdp=e.sdp,log.debug("setRemoteP2P(): P2P  session Description:"+e.sdp);var o=this.getToP2PPeerConnection(t.node_id);o.setRemoteDescription(r,function(){log.info("setRemoteP2P(): P2P  Set remote session description success."),o.createAnswer(function(e){log.debug("setRemoteP2P(): createAnswer  P2P  local sessionDescription:"+e.sdp),o.setLocalDescription(e,l,f),room.masterServer.setRemoteP2P(e.sdp,t.node_id)},function(e){log.error("setRemoteP2P(): createAnswer  P2P  local sessionDescription false.event:"+e)},this.constraints)},function(e){log.error("setRemoteP2P(): P2P  Set remote session description false.event:"+e)})},t.prototype.setAnswerP2P=function(e){var t={};t.sdp=e.sdp,t.type="answer";var r=new RTCSessionDescription(t);log.debug("setAnswerP2P():  P2P  session Description:"+t.sdp),this.getToP2PPeerConnection(e.node_id).setRemoteDescription(r,function(){log.debug("setAnswerP2P(): P2P  Set remote session description success.")},function(e){log.error("setAnswerP2P(): P2P  Set remote session description false.event:"+e)})},t.prototype.addIceCandidateP2P=function(e){var t=this.getToP2PPeerConnection(e.node_id);log.debug("addIceCandidateP2P(), P2P candidate:"+e.candidate);var r=new RTCIceCandidate({sdpMLineIndex:e.sdp_mline_index,sdpMid:e.sdp_mid,candidate:e.candidate});t.addIceCandidate(r,o,n)},t.prototype.addStreamP2P=function(e){var t=this.getToP2PPeerConnection(e.sub_node_id),r=e.info.resource_id;if(1==e.info.stream.type){var o=room.selfUser.getVideo(r).stream;null!=o&&(t.addStream(o),room.selfUser.subMyVideosP2P.push(e.sub_node_id))}else if(2==e.info.stream.type){var n=room.selfUser.getAudio(r).stream;null!=n&&(t.addStream(n),room.selfUser.subMyAudiosP2P.push(e.sub_node_id))}else if(3==e.info.stream.type){var i=room.selfUser.getScreen(r).stream;null!=i&&(t.addStream(i),room.selfUser.subMyScreensP2P.push(e.sub_node_id))}},t.prototype.sendSubSdpOfferP2P=function(e,t){var r;"offerSub"==e?r=this.getToP2PPeerConnection(t.info.owner_id):"answerSub"==e&&(r=this.getToP2PPeerConnection(t.sub_node_id)),r.msgQueue.unshift(i("sub",r,e,t,null))},t.prototype.sendSubSdpAnswerP2P=function(r,o,n,e,i,a){var s=i.stream.sdp,t={};t.sdp=s,t.type="offer";var d=new RTCSessionDescription(t);log.debug("sendSubSdpAnswerP2P(), P2P remote sessionDescription:"+t.sdp),log.debug("sendSubSdpAnswerP2P(): P2P  signalingState: "+o.signalingState),o.setRemoteDescription(d,function(){log.debug("sendSubSdpAnswerP2P(): P2P  Set remote session description success.");var e,t=new SdpSerializer(room.selfUser.sdpP2PMap[i.owner_id]=s);"video"==n?(e=u(e=t._inner.video.ssrcStr,i.stream.stream_name),log.debug("sendSubSdpAnswerP2P(), new add video sdp:"+e),room.selfUser.videoSdpSsrcMapP2PMap[i.owner_id]=e):"audio"==n?(e=t._inner.audio.ssrcStr,log.debug("sendSubSdpAnswerP2P(), new add audio sdp:"+e),room.selfUser.audioSdpSsrcP2PMap[i.owner_id]=e):"desktop"==n&&(e=u(e=t._inner.video.ssrcStr,i.stream.stream_name),log.debug("sendSubSdpAnswerP2P(), new add screen sdp:"+e),room.selfUser.screenSdpSsrcP2PMap[i.owner_id]=e),o.createAnswer(function(e){log.debug("sendSubSdpAnswerP2P(), P2P local sessionDescription:"+e.sdp),o.setLocalDescription(e,l,f),room.masterServer.sendSubSdpAnswerP2P(r,i,e.sdp,a)},h,this.constraints)},function(e){log.error(e)})},t.prototype.getSubSdpAnswerP2P=function(e){var t={};t.sdp=e.info.stream.sdp,t.type="answer";var r=new RTCSessionDescription(t);log.debug("getSubSdpAnswerP2P(): P2P  session Description:"+t.sdp),room.selfUser.sdpP2PMap[e.info.owner_id]=e.info.stream.sdp,this.getToP2PPeerConnection(e.sub_node_id).setRemoteDescription(r,function(){log.info("getSubSdpAnswerP2P(): P2P  Set remote session description success.")},function(e){log.error("getSubSdpAnswerP2P(): P2P  Set remote session description false.event:"+e)})},t.prototype.getSubSdpAnswerP2PByRep=function(e){var t={};t.sdp=e.info.stream.sdp,t.type="answer";var r=new RTCSessionDescription(t);log.debug("getSubSdpAnswerP2PByRep(): P2P  session Description:"+t.sdp),room.selfUser.sdpP2PMap[e.info.owner_id]=e.info.stream.sdp,this.getToP2PPeerConnection(e.info.owner_id).setRemoteDescription(r,function(){log.info("getSubSdpAnswerP2PByRep(): P2P  Set remote session description success.")},function(e){log.error("getSubSdpAnswerP2PByRep(): P2P  Set remote session description false.event:"+e)})},t.prototype.removeStreamP2P=function(e,t,r){var o=this.getToP2PPeerConnection(t);"video"==e?null!=o&&"closed"!=o.signalingState&&null!=r&&(o.removeStream(r),log.debug("removeStreamP2P(): P2P  remove video  stream")):"audio"==e?null!=o&&"closed"!=o.signalingState&&null!=r&&(o.removeStream(r),log.debug("removeStreamP2P(): P2P  remove audio  stream")):"screen"==e&&null!=o&&"closed"!=o.signalingState&&null!=r&&(o.removeStream(r),log.debug("removeStreamP2P(): P2P  remove screen  stream"))},t.prototype.sendUnSubSdpOfferP2P=function(e,t,r,o){var n=this.getToP2PPeerConnection(r);null!=n&&"closed"!=n.signalingState&&n.msgQueue.unshift(i("unsub",n,e,t,o))},t.prototype.sendUnSubSdpAnswerP2P=function(e,t,r,o){var n,i=this.getToP2PPeerConnection(r),a={};if("unsubAnswer"==e){var s,d=o.stream.stream_name;"video"==t?s=room.selfUser.videoSdpSsrcMapP2PMap[o.owner_id]:"audio"==t?s=room.selfUser.audioSdpSsrcP2PMap[o.owner_id]:"screen"==t&&(s=room.selfUser.screenSdpSsrcP2PMap[o.owner_id]);for(var l=room.selfUser.sdpP2PMap[o.owner_id],u=s.split("\r\n"),c=0;c<u.length;c++){var p=u[c]+"\r\n";l=l.replace(p,"")}0<l.indexOf(d)&&(l=l.replace(d,"")),room.selfUser.sdpP2PMap[o.owner_id]=l,a.sdp=l,a.type="offer",n=new RTCSessionDescription(a)}else"unpubAnswer"==e&&(a.sdp=i.remoteDescription.sdp,a.type="offer",n=new RTCSessionDescription(a));log.debug("sendUnSubSdpAnswerP2P(): P2P  Remote sessionDescription:"+n.sdp),i.setRemoteDescription(n,function(){log.info("sendUnSubSdpAnswerP2P(): P2P  Set remote session description success.")},function(e){log.error(e)}),i.createAnswer(function(e){room.sdp=e.sdp,log.debug("sendUnSubSdpAnswerP2P(): P2P  local sessionDescription:"+room.sdp),i.setLocalDescription(e,function(){log.info("sendUnSubSdpAnswerP2P(): P2P  Set local session description success.")},f)},h,this.constraints)},t.prototype.handleP2PPeerConnection=function(t,r){var e=when.defer();return r.msgQueue=[],r.forLog=!1,r.nodeId=t,r.onicecandidate=function(e){e.candidate?(log.debug("onicecandidate(),P2P event.candidate.candidate :"+e.candidate.candidate),room.masterServer.sendCandidateMsgP2P(e.candidate,t)):log.debug("P2P  End of candidates.")},r.onopen=function(){},r.onaddstream=function(e){if(log.debug("onaddstream(), P2P  stream id:"+e.stream.id),"default"!=e.stream.id)if(0<e.stream.getVideoTracks().length){var t=room.selfUser.subVideoStream2ResourceInfo[e.stream.id],r=room.selfUser.subScreenStream2ResourceInfo[e.stream.id];if(null!=t){log.debug("onaddstream(), P2P  stream type: video");(o=room.selfUser.getUserByVideoStreamLabel(e.stream.id)).getVideo(t.resource_id);o.eventEmitter.emit(UserCallback.subscrible_camera_result,e.stream,o.id,o.name,t.resource_id)}if(null!=r){log.debug("onaddstream(), P2P  stream type: screen");(o=room.selfUser.getUserByScreenStreamLabel(e.stream.id)).getScreen(r.resource_id);o.eventEmitter.emit(UserCallback.subscrible_screen_result,e.stream,o.id,o.name,r.resource_id)}}else if(0<e.stream.getAudioTracks().length){log.debug("onaddstream(), P2P  stream type: audio");var o;t=room.selfUser.subAudioStream2ResourceInfo[e.stream.id];(o=room.selfUser.getUserByAudioStreamLabel(e.stream.id)).getAudio(t.resource_id).stream=e.stream,o.eventEmitter.emit(UserCallback.subscrible_microphone_result,e.stream,o.id,o.name)}},r.onremovestream=function(e){!function(e){if("default"!=e.id){var t=room.selfUser.subVideoStream2ResourceInfo[e.id],r=room.selfUser.getUserByVideoStreamLabel(e.id);null!=r&&(delete room.selfUser.subVideoStream2ResourceInfo[e.id],r.eventEmitter.emit(UserCallback.unsubscrible_camera_result,r.id,r.name,t.resource_id));var o=room.selfUser.subScreenStream2ResourceInfo[e.id],n=room.selfUser.getUserByScreenStreamLabel(e.id);null!=n&&(delete room.selfUser.subScreenStream2ResourceInfo[e.id],n.eventEmitter.emit(UserCallback.unsubscrible_screen_result,n.id,n.name,o.resource_id));var i=room.selfUser.subAudioStream2ResourceInfo[e.id],a=room.selfUser.getUserByAudioStreamLabel(e.id);if(null!=a){var s=a.getAudio(i.resource_id);s.stream=null,delete room.selfUser.subAudioStream2ResourceInfo[e.id],a.eventEmitter.emit(UserCallback.unsubscrible_microphone_result,a.id,a.name)}}}(e.stream)},r.ondatachannel=function(e){},r.oniceconnectionstatechange=function(e){var t=e.target.iceConnectionState;switch(log.info("oniceconnectionstatechange(),P2P iceConnectionState :"+t),t){case"disconnected":room.isMcu()||room.selfUser.nodeId<r.nodeId&&(log.debug("=======PeerConnection reconnectionsend off.  self user nodeId:"+room.selfUser.nodeId+" ----\x3e download user nodeId:"+r.nodeId),room.traceableP2PPeerConnection.sendOfferP2P(r,r.nodeId,!0))}},r.onsignalingstatechange=function(e){log.debug("onsignalingstatechange(), P2P signalingState :"+e.target.signalingState),"stable"==e.target.signalingState&&0==r.forLog&&(r.forLog=!0,r.intervalSet(r))},r.intervalSet=function(e){window.setInterval(function(){e.processSignalingMessage(e)},400)},r.processSignalingMessage=function(e){if("stable"==e.signalingState&&0<e.msgQueue.length){var t=e.msgQueue.pop();log.debug("P2P :"+t.operationType),"sub"==t.operationType?room.traceableP2PPeerConnection.sendSubSdpOfferP2PHandle(t.para1,t.para2,t.para3,t.para4):"unsub"==t.operationType&&room.traceableP2PPeerConnection.sendUnSubSdpOfferP2PHandle(t.para1,t.para2,t.para3,t.para4)}},e.promise},t.prototype.sendSubSdpOfferP2PHandle=function(t,r,o){t.createOffer(function(e){log.debug("sendSubSdpOfferP2P():  P2P  local sessionDescription:"+e.sdp),room.sdp=e.sdp,t.setLocalDescription(e,l,f),room.masterServer.sendSubSdpOfferP2P(o,e.sdp,r)},h,this.constraints)},t.prototype.sendUnSubSdpOfferP2PHandle=function(l,u,c,p){l.createOffer(function(e){log.debug("sendUnSubSdpOfferP2PHandle(): P2P  local sessionDescription:"+e.sdp),l.setLocalDescription(e,function(){log.info("sendUnSubSdpOfferP2PHandle(): P2P  Set local session description success.");var e={};if("unpubOffer"==u){log.debug("sendUnSubSdpOfferP2PHandle(): offerType:unpubOffer"),e.sdp=l.remoteDescription.sdp,e.type="answer";var t=new RTCSessionDescription(e)}else if("unsubOffer"==u){log.debug("sendUnSubSdpOfferP2PHandle(): offerType:unsubOffer");var r,o=l.remoteDescription.sdp,n=new SdpSerializer(o);"video"==c?r=n._inner.video.ssrcStr:"audio"==c?r=n._inner.audio.ssrcStr:"screen"==c&&(r=n._inner.video.ssrcStr);for(var i=r.split("\r\n"),a=0;a<i.length;a++){var s=i[a]+"\r\n";o=o.replace(s,"")}var d=p.stream.stream_name;0<o.indexOf(d)&&(o=o.replace(d,"")),e.sdp=o,e.type="answer",t=new RTCSessionDescription(e)}log.debug("sendUnSubSdpOfferP2PHandle(): P2P  remote  sessionDescription:"+e.sdp),l.setRemoteDescription(t,function(){log.info("sendUnSubSdpOfferP2PHandle(): P2P  Set remote session description success.")},function(e){log.error("sendUnSubSdpOfferP2PHandle(): P2P  Set remote session description false.event:"+e)})},f)},h,this.constraints)};var h=function(){};function l(){}function f(){}var o=function(){},n=function(e){log.error("onAddIceCandidateError(),Failed to add remote  P2P  candidate: "+e.toString())};function u(e,t){var r=e,o=r.split("\r\n");if(9<o.length){var n="";if(0<o[4].indexOf(t))for(var i=0;i<9;i++)""==n?n=o[i]:n+="\r\n"+o[i];else for(i=9;i<18;i++)""==n?n=o[i]:n+="\r\n"+o[i];return n}return r}function i(e,t,r,o,n){var i={};return i.operationType=e,i.para1=t,i.para2=r,i.para3=o,i.para4=n,i}return t}),ModuleBase.define("SignalFactory",["TraceableWebsocket"],function(r){var e=function(){};return e.prototype.getDataChannel=function(e){var t;switch(e){case SignalType.websocket:t=new r}return t},e}),ModuleBase.define("MessageManager",["CmdProtobufCoded","User","Board","Error"],function(rt,ot,nt,it){var e=function(){};function at(e,t){var r=room.getUserByNodeId(e),o=new Object,n=new Date(1e3*t.timestamp);n.setMinutes(n.getMinutes()-n.getTimezoneOffset());var i=n.getTime();return o.timestamp=i,o.fromId=r.id,o.fromName=r.name,o.message=t.content,o}return e.prototype.OnWebSocketMessage=function(e){var t;room&&null==room.cmdProtobufCoded?(t=new rt,room.cmdProtobufCoded=t):t=room.cmdProtobufCoded;var r=t.getRoomPduTypeEnum(),o=t.getMediaTypeEnum(),n=t.getResourceStatusEnum(),i=t.getResourceOptEnum(),a=t.getMediaPlayEventsEnum(),s=t.decodePacket(e),d=s.type,l=s.priority;if(d==r.INVITE_ROOM_REP1&&0<l&&(room.isDoPDUSeq=1),1==room.isDoPDUSeq&&d!=r.PONG&&d!=r.OPEN_REP&&d!=r.INVITE_ROOM_REP1){if(l<=room.lastPDUSeq)return;if(room.reconnectionState)return;room.lastPDUSeq=l}switch(d){case r.OPEN_REP:log.debug("===acception OPEN_REP init"),loggerReport.info("acception OPEN_REP init");var u=t.decodeBody(e);if(room.selfUser.toMCUPC&&"disconnected"==room.selfUser.toMCUPC.iceConnectionState&&(log.info("===acception OPEN_REP, openRep.result"+u.result+" PeerConnectioniceConnectionStatedisconnected402"),u.result=402),room.selfUser.toMCUPC&&!room.selfUser.toMCUPC.iceConnectionState&&(log.info("===acception OPEN_REP, openRep.result"+u.result+" PeerConnectioniceConnectionState402"),u.result=402),0==u.result)log.info("===acception OPEN_REP result=0"),room.reconnectionState?(room.reconnectionState=!1,room.masterServer.pingIntervalHandle(),room.masterServer.pingTimeoutHandle(),room.addSdpLocalStates=0,log.debug("===DDDDDDDXXXXXXXXXXXXX,room.addSdpLocalStates:"+room.addSdpLocalStates),log.debug("===acception OPEN_REP ,room.addSdpLocalStates:",room.addSdpLocalStates),room.selfUser.audio&&log.debug("===acception OPEN_REP ,room.selfUser.audio.status:",room.selfUser.audio.status),room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.reconnected)):(room.pingInterval=u.ping_interval,room.pingTimeout=u.ping_timeout,room.signalTocken=u.signal_tocken,log.info("===acception OPEN_REP,room.pingInterval:"+room.pingInterval+",room.pingTimeout:"+room.pingTimeout+",room.signalTocken:"+room.signalTocken),room.masterServer.pingInit(),room.reconnectionOpenRep402?(room.lastPDUSeq=0,room.isExistReJoinState=!0,log.debug("===acception OPEN_REP ,room.addSdpLocalStates:",room.addSdpLocalStates),room.selfUser.audio&&log.debug("===acception OPEN_REP ,room.selfUser.audio.status:",room.selfUser.audio.status),setTimeout(function(){for(var e in room.selfUser.boards){var t=room.selfUser.boards[e];room.selfUser.shareBoardById(t.id,!0)}room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.reJoinConnected)},500)):(room.isExistReJoinState=!1,log.debug("===acception OPEN_REP ,room.addSdpLocalStates:"+room.addSdpLocalStates),room.selfUser.audio&&log.debug("===acception OPEN_REP ,room.selfUser.audio.status:"+room.selfUser.audio.status),room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connected)),room.reconnectionOpenRep402=!1,room.joinTimeoutState=!1,room.masterServer.pingIntervalHandle(),room.masterServer.pingTimeoutHandle(),room.masterServer.inviteRoomReqSend());else if(402==u.result)log.info("===acception OPEN_REP result=402"),loggerReport.error("acception OPEN_REP result=402"),clearInterval(room.webocketStatusIntervalId),room.webocketStatusIntervalId=null,room.masterServer.signalingChannel.readyState!=WebSocket.CLOSED&&room.masterServer.signalingChannel.close(),room.joinTimeoutState=!1,room.reconnectionCount=0,room.reconnectionState=!1,room.reconnectionOpenRep402=!0,setRemoteDescriptionSuccess=!1,room.addSdpLocalStates=0,log.debug("===DDDDDDD1717171717,openRep.result=402 room.addSdpLocalStates:"+room.addSdpLocalStates),addIcecandidateList=[],room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connectFailed),room&&room.connectionInfoCollector&&room.connectionInfoCollector.stop(),room&&room.connectionStatistics&&room.connectionStatistics.stop(),room.reJoin();else if(436==u.result){log.info("===acception OPEN_REP result:"+u.result+",description:"+u.description),loggerReport.info("acception OPEN_REP result:"+u.result+",description:"+u.description),room.reconnectionState=!1;var c=new it(u.result,"");room.eventEmitter.emit(EngineCallback.room_join_error,c)}else{log.error("===acception OPEN_REP result:"+u.result+",description:"+u.description),loggerReport.error("acception OPEN_REP result:"+u.result+",description:"+u.description),room.reconnectionState=!1;c=new it(u.result,u.description);room.eventEmitter.emit(EngineCallback.room_join_error,c)}break;case r.PONG:room.pingCountTime=0;break;case r.INVITE_ROOM_REP1:log.debug("===acception INVITE_ROOM_REP1 init"),loggerReport.info("acception INVITE_ROOM_REP1 init");var p=t.decodeBody(e);if(0==p.result){if(room.fingerPrint=p.finger_print,room.setup=p.setup,room.roomTocken=p.room_tocken,room.roomInfo=p.room_info,room.iceUfrag=p.ice_ufrag,room.icePwd=p.ice_pwd,log.debug("===acception INVITE_ROOM_REP1,iceUfrag:"+p.ice_ufrag+",icePwd:"+p.ice_pwd+", fingerPrint:"+p.finger_print),room.roomInfo.room_id!=room.id&&(room.outgoingAddr=room.id,room.id=room.roomInfo.room_id),room.setRemoteDescriptionSuccess=!1,room.masterServer.sendAnswer(),0==room.reconnectionCount){room.selfUser.nodeId=p.node_id,room.selfUser.role=1,null!=p.role&&(room.selfUser.role=p.role);var h=room.avdEngine.cameraMap;for(var f in h){var m=h[f];m&&room.selfUser.initVideo(f,m)}if(null!=room.avdEngine.checkMicrophoneId&&room.selfUser.initAudio(room.avdEngine.checkMicrophoneId,room.avdEngine.checkMicrophoneName),room.selfUser.initScreen(),room.addUser(room.selfUser),room.reJoinRoomCount=0,room.audioLevel=new AudioLevel,log.info("===acception INVITE_ROOM_REP1 join room  Success, roomId:"+room.id+",nodeId:"+room.selfUser.nodeId+",userId:"+room.selfUser.id+", userName:"+room.selfUser.name),loggerReport.info("acception INVITE_ROOM_REP1 :"+room.id+",nodeId:"+room.selfUser.nodeId+",userId:"+room.selfUser.id+",userName:"+room.selfUser.name),null!=room.selfUser.reJoinPubVideoIds&&0<room.selfUser.reJoinPubVideoIds.length){for(var g=0;g<room.selfUser.reJoinPubVideoIds.length;g++){var v=room.selfUser.getVideo(room.selfUser.reJoinPubVideoIds[g]);room.selfUser.reJoinPubVideoElements[g]?v.previewAndPublish(room.selfUser.reJoinPubVideoElements[g]).then(function(){log.debug("===402pubpub,videoId:"+v.id)}).otherwise(function(e){log.debug("===402pubpub,videoId:"+v.id+",pub error:"+e)}):v.publish().then(function(){log.debug("===402pubpub,videoId:"+v.id)}).otherwise(function(e){log.debug("===402pubpubvideoId:"+v.id+",pub error:"+e)})}room.selfUser.reJoinPubVideoIds=[],room.selfUser.reJoinPubVideoElements=[]}if(room.selfUser.reJoinPubAudioId){var y=room.selfUser.getAudio(room.selfUser.reJoinPubAudioId);log.debug("===acception INVITE_ROOM_REP1 402audioId:"+y.id),y.openMicrophone().then(function(){room.selfUser.reJoinPubAudioId="",room.selfUser.reJoinPubAudioButMute&&(log.debug("===acception INVITE_ROOM_REP1 402"),y.muteMicrophone(),delete room.selfUser.reJoinPubAudioButMute)}).otherwise(function(e){log.debug("===acception INVITE_ROOM_REP1 402audioId:"+y.id+",pub error:"+e)})}room.isExistReJoinState&&(clearTimeout(room.reJoinAfterTimer),room.reJoinAfterTimer=setTimeout(function(){if(room&&room.participants){var e=arrayUtil.chajiObject(room.participants,room.reJoinAfterUsers);if(null!=e&&0<e.length)for(var t=0;t<e.length;t++){var r=e[t];if(r!=room.selfUser.nodeId){var o=room.getUserByNodeId(r);null!=o&&(log.debug("===acception INVITE_ROOM_REP1 nodeId:"+r+"name:"+o.name),room.removeUser(o.id),room.eventEmitter.emit(RoomCallback.user_leave_notify,1,null,o))}}room.reJoinAfterUsers=[]}},3e4))}room.eventEmitter.emit(EngineCallback.room_join_success,room);break}if(402==p.result)log.info("===INVITE_ROOM_REP1,inviteRoomRep1.result402"),loggerReport.error("INVITE_ROOM_REP1 Result402"),clearInterval(room.webocketStatusIntervalId),room.webocketStatusIntervalId=null,room.masterServer.signalingChannel.readyState!=WebSocket.CLOSED&&room.masterServer.signalingChannel.close(),room.joinTimeoutState=!1,room.reconnectionCount=0,room.reconnectionState=!1,room.reconnectionOpenRep402=!0,setRemoteDescriptionSuccess=!1,room.addSdpLocalStates=0,log.debug("===DDDDDDD18181818,inviteRoomRep1.result=402 room.addSdpLocalStates:"+room.addSdpLocalStates),addIcecandidateList=[],room.eventEmitter.emit(RoomCallback.connection_status,ConnectionStatus.connectFailed),room.reJoin();else{loggerReport.error("INVITE_ROOM_REP1 Result Error,result:"+p.result+",description:"+p.description),log.info("===INVITE_ROOM_REP1,Result Error,inviteRoomRep1.result: "+p.result+",inviteRoomRep1.description:"+p.description);c=new it(p.result,p.description);room.eventEmitter.emit(EngineCallback.room_join_error,c)}break;case r.CANDIDATE_MSG1:log.debug("===acception CANDIDATE_MSG1 init");var b=t.decodeBody(e);log.info("===acception CANDIDATE_MSG1,candidateMsg:"+b.candidate),setRemoteDescriptionSuccess?room.masterServer.setAddIcecandidate(b):addIcecandidateList.push(b);break;case r.ICE_RESTART_MSG:log.debug("===acception ICE_RESTART_MSG init");var _=t.decodeBody(e);room.remoteICERestart(_);break;case r.ROOM_RESOURCE_INFOS:log.debug("===acception ROOM_RESOURCE_INFOS init");var w=t.decodeBody(e).resource_infos;log.debug("===acception ROOM_RESOURCE_INFOS,resourceInfos:",w);var S=[];for(var f in w){if(!(j=w[f]))break;if(!j.stream)break;switch(j.stream.type){case o.video:if(log.info("===acception ROOM_RESOURCE_INFOS video, resourceInfo.owner_id: "+j.owner_id+",room.selfUser.nodeI:"+room.selfUser.nodeId+",resourceInfo.resource_id:"+j.resource_id),room.traceablePeerConnection.isContainsReconnectionSub(j.resource_id,room.selfUser.reJoinSubVideoIds)){if(log.debug("===ROOM_RESOURCE_INFOS,video contains true,resourceInfo.resource_id:"+j.resource_id),(ie=room.getUserByNodeId(j.owner_id))&&ie.id!=room.selfUser.id)(v=ie.getVideo(j.resource_id)).resourceInfo=j,v.subscrible()}else if(log.debug("===ROOM_RESOURCE_INFOS,video contains false,resourceInfo.resource_id:"+j.resource_id),(ie=room.getUserByNodeId(j.owner_id))&&ie.id!=room.selfUser.id)null==(v=ie.getVideo(j.resource_id))&&(v=ie.createVideo(j.resource_id,"")),v.resourceInfo=j,v.ownerId=ie.id,room.hasObject(room.pubVideos,v)?log.debug("===ROOM_RESOURCE_INFOS,video contains false,room.pubVideos not to push ,videoId:"+v.id):(log.debug("===ROOM_RESOURCE_INFOS,video contains false,room.pubVideos to push, videoId:"+v.id),room.pubVideos.push(v)),(V=[]).push(v),log.info("===ROOM_RESOURCE_INFOS,video contains falsecallback camera_status_notify,userId:"+ie.id+",videoId:"+v.id),ie.eventEmitter.emit(UserCallback.camera_status_notify,v.status,v.id,v.name,ie.id),log.info("===ROOM_RESOURCE_INFOS,video contains falsecallback publish_camera_notify,userId:"+ie.id+",videoId:"+v.id),ie.eventEmitter.emit(UserCallback.publish_camera_notify,V);break;case o.audio:if(log.info("===acception ROOM_RESOURCE_INFOS audio,resourceInfo.owner_id: "+j.owner_id+",room.selfUser.nodeId:"+room.selfUser.nodeId),room.traceablePeerConnection.isContainsReconnectionSub(j.resource_id,room.selfUser.reJoinSubAudioIds))if(log.debug("===ROOM_RESOURCE_INFOS,audio contains true,nodeId:"+j.owner_id),log.info("===audio subscrible(),,resourceId:"+j.resource_id+",ownerId:",j.owner_id),loggerReport.info("===audio subscrible(),,resourceId:"+j.resource_id+",ownerId:",j.owner_id),audioBatchEnabled)S.push(j);else{var E=getRandomNum(16001,16500);room.masterServer.audioSubscribleHandle(j,E)}else if(log.debug("===ROOM_RESOURCE_INFOS,audio contains false,nodeId:"+j.owner_id),(ie=room.getUserByNodeId(j.owner_id))&&ie.id!=room.selfUser.id){if(null==(y=ie.getAudio(j.resource_id))&&(y=ie.createAudio(j.resource_id,"")),y.resourceInfo=j,room.hasObject(room.pubAudios,y)||room.pubAudios.push(y),(F=[]).push(y),audioAutoSub)if(room.selfUser.subAudioIds.push(y.id),audioBatchEnabled)S.push(j);else{log.info("===audio subscrible(),,audioAutoSub=true,audioBatchEnabled=false,resourceId:"+j.resource_id+",ownerId:",j.owner_id),loggerReport.info("===audio subscrible(),,audioAutoSub=true,audioBatchEnabled=false,resourceId:"+j.resource_id+",ownerId:",j.owner_id);E=getRandomNum(16501,17e3);room.masterServer.audioSubscribleHandle(j,E)}else ie.eventEmitter.emit(UserCallback.publish_microphone_notify,F);log.info("===ROOM_RESOURCE_INFOS,audio contains false,callback microphone_status_notify,userId:"+ie.id+",audioId:"+y.id),ie.eventEmitter.emit(UserCallback.microphone_status_notify,y.status,y.id,y.name,ie.id)}break;case o.desktop:if(log.info("===acception ROOM_RESOURCE_INFOS desktop, resourceInfo.owner_id: "+j.owner_id+",room.selfUser.nodeId:"+room.selfUser.nodeId),room.traceablePeerConnection.isContainsReconnectionSub(j.resource_id,room.selfUser.reJoinSubScreenIds)){if(log.debug("===ROOM_RESOURCE_INFOS,screen contains true,nodeId:"+j.owner_id),(ie=room.getUserByNodeId(j.owner_id))&&ie.id!=room.selfUser.id)(J=ie.getScreen(j.resource_id)).resourceInfo=j,J.subscrible()}else if(log.debug("===ROOM_RESOURCE_INFOS,screen contains false,nodeId:"+j.owner_id),(ie=room.getUserByNodeId(j.owner_id))&&ie.id!=room.selfUser.id)null==(J=ie.getScreen(j.resource_id))&&(J=ie.createScreen(j.resource_id,"")),J.resourceInfo=j,J.ownerId=ie.id,room.pubScreens.push(J),(q=[]).push(J),log.info("===ROOM_RESOURCE_INFOS,screen contains false,callback screen_status_notify,userId:"+ie.id+",screenId:"+J.id),ie.eventEmitter.emit(UserCallback.screen_status_notify,J.status,J.id,J.name,ie.id),ie.eventEmitter.emit(UserCallback.publish_screen_notify,q)}}0<S.length&&(log.debug("===audio batchSubscrible(),acception ROOM_RESOURCE_INFOS ,,SDP. audioResourceInfoBatch.length:"+S.length),room.masterServer.audioBatchSubscribleHandle(S));break;case r.USER_INFO_MSG:log.debug("===acception USER_INFO_MSG init");var I=t.decodeBody(e);if(null==I)return;var T=[];I.user.forEach(function(e){var r=new ot(e.user_id,e.user_name,null,null);r.nodeId=e.node_id,r.role=e.role,r.userAgent=e.user_agent,r.data=e.user_data,log.info("===acception USER_INFO_MSG userId:"+e.user_id+",userName:"+e.user_name+",nodeId:"+r.nodeId),room.reJoinAfterUsers.push(r),e.webcams.forEach(function(e){var t=r.createVideo(e.id,e.name);t.status=e.status,t.cameraType=e.ctype,t.level=e.level,t.description=e.description,t.streamName=e.stream_name,t.streamNickName=e.stream_nick_name}),e.speakers.forEach(function(e){r.createAudio(e.id,e.name).status=e.status}),e.desktops.forEach(function(e){var t=r.createScreen(e.id,e.name);t.status=e.status,t.level=e.level,t.description=e.description});var t=room.getUser(e.user_id);t?t.waitingDelete?(log.debug("===acception USER_INFO_MSG,tempUser !=null,tempUser.waitingDelete= true,to add user. userId:"+r.id+",nodeId:"+r.nodeId+",userName:"+r.name),room.addUserByUserIdAndUserId(r),T.push(r)):(log.debug("===acception USER_INFO_MSG,tempUser!=null,tempUser.waitingDelete=false. 402nodeId.userId:"+r.id+",nodeId:"+e.node_id+",userName:"+r.name),room.getUser(r.id).nodeId=e.node_id):(log.debug("===acception USER_INFO_MSG,tempUser =null,to add user. userId:"+r.id+",nodeId:"+r.nodeId+",userName:"+r.name),room.addUser(r),T.push(r)),room.isMcu()||room.p2pServer.createP2PPeerConnection(r.nodeId)}),log.info("===acception USER_INFO_MSG, callback user_join_notify,usersLength:"+T.length),room.eventEmitter.emit(RoomCallback.user_join_notify,T);break;case r.ADD_WEBCAM_MSG:log.debug("===acception ADD_WEBCAM_MSG init");var R=t.decodeBody(e);if(ie=room.getUserByNodeId(R.node_id)){var C=R.webcam;(v=ie.createVideo(C.id,C.name)).status=C.status,v.cameraType=C.ctype,v.level=C.level,v.description=C.description,v.streamName=C.stream_name,v.streamNickName=C.stream_nick_name,log.info("===acception ADD_WEBCAM_MSGk,callback camera_status_notify, webcamStatus:"+C.status+",webcamId:"+C.id+",webcamName:"+C.name+",userId:"+ie.id),ie.eventEmitter.emit(UserCallback.camera_status_notify,C.status,C.id,C.name,ie.id)}break;case r.ADD_SPEAKER_MSG:log.debug("===acception ADD_SPEAKER_MSG init");var P=t.decodeBody(e);if(ie=room.getUserByNodeId(P.node_id)){var M=P.speaker;(y=ie.createAudio(M.id,M.name)).status=M.status,log.info("===acception ADD_SPEAKER_MSG,callback microphone_status_notify, speakerStatus:"+M.status+",speakerId:"+M.id+",speakerName:"+M.name+",userId:"+ie.id),ie.eventEmitter.emit(UserCallback.microphone_status_notify,M.status,M.id,M.name,ie.id)}break;case r.ADD_DESKTOP_MSG:log.debug("===acception ADD_DESKTOP_MSG init");var x=t.decodeBody(e);if(ie=room.getUserByNodeId(x.node_id)){var A=x.desktop;(J=ie.createScreen(A.id,A.name)).status=A.status,J.level=A.level,J.description=A.description,log.info("===acception ADD_DESKTOP_MSG, callback screen_status_notify,desktopStatus:"+A.status+",desktopId:"+A.id+",desktopName:"+A.name+",userId:"+ie.id),ie.eventEmitter.emit(UserCallback.screen_status_notify,A.status,A.id,A.name,ie.id)}break;case r.REMOVE_WEBCAM_MSG:log.debug("===acception REMOVE_WEBCAM_MSG init");var k=t.decodeBody(e);if(ie=room.getUserByNodeId(k.node_id)){var O=ie.getVideo(k.resource_id);log.info("===acception REMOVE_WEBCAM_MSG, callback camera_status_notify voideoStatus:"+O.status+",voideoId:"+O.id+",videoName:"+O.name+",userId:"+ie.id),ie.eventEmitter.emit(UserCallback.camera_status_notify,StreamStatus.none,O.id,O.name,ie.id),arrayUtil.objectSplice(ie.videos,k.resource_id)}break;case r.REMOVE_SPEAKER_MSG:log.debug("===acception REMOVE_SPEAKER_MSG init");var U=t.decodeBody(e);(ie=room.getUserByNodeId(U.node_id))&&(log.info("===acception REMOVE_SPEAKER_MSG,callback microphone_status_notify, audioStatus:"+ie.audio.status+",audioId:"+ie.audio.id+",audioName:"+ie.audio.name+",userId:"+ie.id),ie.eventEmitter.emit(UserCallback.microphone_status_notify,StreamStatus.none,ie.audio.id,ie.audio.name,ie.id),ie.audio.id==U.resource_id&&(ie.audio=null));break;case r.REMOVE_DESKTOP_MSG:log.debug("===acception REMOVE_DESKTOP_MSG init");var L=t.decodeBody(e);(ie=room.getUserByNodeId(L.node_id))&&(log.info("===acception REMOVE_DESKTOP_MSG, callback screen_status_notify, screenStatus:"+ie.screen.status+",screenId:"+ie.screen.id+",screenName:"+ie.screen.name+",userId:"+ie.id),ie.eventEmitter.emit(UserCallback.screen_status_notify,StreamStatus.none,ie.screen.id,ie.screen.name,ie.id),ie.screen.id==L.resource_id&&(ie.screen=null));break;case r.UPDATE_SPEAKER_MSG:log.debug("===acception UPDATE_SPEAKER_MSG init");var D=t.decodeBody(e);if(ie=room.getUserByNodeId(D.node_id))(y=ie.getAudio(D.resource_id)).status=D.speaker.status,log.info("===acception UPDATE_SPEAKER_MSG, callback microphone_status_notify, audioId:"+y.id+",audioName:"+y.name+",audioStatus:"+y.status+",userId:"+ie.id),ie.eventEmitter.emit(UserCallback.microphone_status_notify,y.status,y.id,y.name,ie.id);break;case r.UPDATE_WEBCAM_MSG:log.debug("===acception UPDATE_WEBCAM_MSG init");var N=t.decodeBody(e);if(ie=room.getUserByNodeId(N.node_id))(v=ie.getVideo(N.resource_id)).level=N.webcam.level,v.description=N.webcam.description,v.streamName=N.webcam.stream_name,v.streamNickName=N.webcam.stream_nick_name,v.status!=N.webcam.status&&(v.status=N.webcam.status,ie.eventEmitter.emit(UserCallback.camera_status_notify,v.status,v.id,v.name,ie.id)),log.info("===acception UPDATE_WEBCAM_MSG, callback camera_data_notify, videoId:"+v.id+",videoName:"+v.name+",videoStatus:"+v.status+",userId:"+ie.id),ie.eventEmitter.emit(UserCallback.camera_data_notify,v.level,v.description,v.id,v.name,ie.id);break;case r.UPDATE_DESKTOP_MSG:log.debug("===acception UPDATE_DESKTOP_MSG init");var B=t.decodeBody(e);if(ie=room.getUserByNodeId(B.node_id))(J=ie.getScreen(B.resource_id)).level=B.desktop.level,J.description=B.desktop.description,J.status=B.desktop.status,log.info("===acception UPDATE_DESKTOP_MSG, callback screen_data_notify, screenId:"+J.id+",screenName:"+J.name+",screenStatus:"+J.status+",userId:"+ie.id),ie.eventEmitter.emit(UserCallback.screen_data_notify,J.level,J.description,J.id,J.name,ie.id);break;case r.PUB_ROOM_RESOURCE_MSG:log.debug("===acception PUB_ROOM_RESOURCE_MSG init");var j=t.decodeBody(e).info;if(log.debug("===acception PUB_ROOM_RESOURCE_MSG,mediaType:"+j.stream.type+",ownerId:"+j.owner_id),j.stream.type==o.video){var V=[];if(ie=room.getUserByNodeId(j.owner_id))log.debug("===acception PUB_ROOM_RESOURCE_MSG,owner_id:"+j.owner_id+",userId:"+ie.id),null==(v=ie.getVideo(j.resource_id))&&(v=ie.createVideo(j.resource_id,"")),log.debug("===acception PUB_ROOM_RESOURCE_MSG,video,userId:"+ie.id+",userName:"+ie.name+",resourceInfo.stream.sdp:"+j.stream.sdp),v.resourceInfo=j,v.status=StreamStatus.published,v.ownerId=ie.id,V.push(v),room.hasObject(room.pubVideos,v)?log.debug("===video accept PUB_ROOM_RESOURCE_MSG, room.pubVideos not to push(), videoId:"+v.id):(log.debug("===video accept PUB_ROOM_RESOURCE_MSG, room.pubVideos to push(), videoId:"+v.id),room.pubVideos.push(v)),log.info("===video accept PUB_ROOM_RESOURCE_MSG, callback camera_status_notify  resourceId:"+j.resource_id+",ownerId:",j.owner_id+",status:"+v.status+",videoId:"+v.id+",videoName:"+v.name+",userId:"+ie.id),ie.eventEmitter.emit(UserCallback.camera_status_notify,v.status,v.id,v.name,ie.id),log.info("===video accept PUB_ROOM_RESOURCE_MSG, callback publish_camera_notify  resourceId:"+j.resource_id+",ownerId:",j.owner_id+",videosLength:",V.length),ie.eventEmitter.emit(UserCallback.publish_camera_notify,V)}else if(j.stream.type==o.audio){var F=[];if(ie=room.getUserByNodeId(j.owner_id))if(null==(y=ie.getAudio(j.resource_id))&&(y=ie.createAudio(j.resource_id,"")),log.debug("===acception PUB_ROOM_RESOURCE_MSG,audio,userId:"+ie.id+",userName:"+ie.name+",resourceInfo.stream.sdp:"+j.stream.sdp),y.resourceInfo=j,y.status=StreamStatus.published,y.ownerId=ie.id,F.push(y),room.hasObject(room.pubAudios,y)?log.info("===audio accept PUB_ROOM_RESOURCE_MSG, room.pubAudios not to push(), audioId:"+y.id):(log.info("===audio accept PUB_ROOM_RESOURCE_MSG, room.pubAudios to push(), audioId:"+y.id),room.pubAudios.push(y)),log.info("===audio accept PUB_ROOM_RESOURCE_MSG, callback microphone_status_notify  resourceId:"+j.resource_id+",ownerId:",j.owner_id+",status:"+y.status+",audioId:"+y.id+",audioName:"+y.name+",userId:"+ie.id),ie.eventEmitter.emit(UserCallback.microphone_status_notify,y.status,y.id,y.name,ie.id),audioAutoSub){room.selfUser.subAudioIds.push(y.id),log.info("===audio accept PUB_ROOM_RESOURCE_MSG,,to masterServer.audioSubscribleHandle(),ownerId:"+j.owner_id+",resourceId:"+j.resource_id+",audioId:"+y.id),loggerReport.info("audio accept PUB_ROOM_RESOURCE_MSG,,to masterServer.audioSubscribleHandle(),ownerId:"+j.owner_id+",resourceId:"+j.resource_id+",audioId:"+y.id);E=getRandomNum(17001,17500);room.masterServer.audioSubscribleHandle(j,E)}else log.info("===audio accept PUB_ROOM_RESOURCE_MSG, callback  publish_microphone_notify  resourceId:"+j.resource_id+",ownerId:",j.owner_id+",audiosLength:",F.length),ie.eventEmitter.emit(UserCallback.publish_microphone_notify,F)}else if(j.stream.type==o.desktop){var q=[];if(ie=room.getUserByNodeId(j.owner_id))null==(J=ie.getScreen(j.resource_id))&&(J=ie.createScreen(j.resource_id,"")),log.debug("===acception PUB_ROOM_RESOURCE_MSG,screen,userId:"+ie.id+",userName:"+ie.name+",resourceInfo.stream.sdp:"+j.stream.sdp),J.resourceInfo=j,J.status=StreamStatus.published,J.ownerId=ie.id,q.push(J),room.hasObject(room.pubScreens,J)?log.info("===screen accept PUB_ROOM_RESOURCE_MSG, room.pubScreens not to push(), screenId:"+J.id):(log.info("===screen accept PUB_ROOM_RESOURCE_MSG, room.pubScreens to push(), screenId:"+J.id),room.pubScreens.push(J)),log.info("===screen accept PUB_ROOM_RESOURCE_MSG, callback screen_status_notify  resourceId:"+j.resource_id+",ownerId:",j.owner_id+",status:"+J.status+",screenId:"+J.id+",screenName:"+J.name+",userId:"+ie.id),ie.eventEmitter.emit(UserCallback.screen_status_notify,J.status,J.id,J.name,ie.id),log.info("===screen accept PUB_ROOM_RESOURCE_MSG,callback publish_screen_notify  resourceId:"+j.resource_id+",ownerId:",j.owner_id+",screensLength:",q.length),ie.eventEmitter.emit(UserCallback.publish_screen_notify,q)}break;case r.PUB_ROOM_RESOURCE_MSG_REP:log.debug("===acception PUB_ROOM_RESOURCE_MSG_REP init");var G=t.decodeBody(e),H=G.id,W=G.result,Y=G.description;if(log.info("===acception PUB_ROOM_RESOURCE_MSG_REP,orderId:"+H+",result:"+W+",description:",Y),0==W)room.eventEmitter.emit(EngineCallback.pub_roomresourcemsg_rep_success,H);else{var z=new it(W,Y);room.eventEmitter.emit(EngineCallback.pub_roomresourcemsg_rep_error,z,H)}break;case r.SUB_ROOM_RESOURCE_MSG_REP:log.debug("===acception SUB_ROOM_RESOURCE_MSG_REP init");var K=t.decodeBody(e);H=K.id,W=K.result,Y=K.description;if(log.info("===acception SUB_ROOM_RESOURCE_MSG_REP,orderId:"+H+",result:"+W+",description:",Y),0==W)room.eventEmitter.emit(EngineCallback.sub_roomresourcemsg_rep_success,H);else{var X=new it(W,Y);room.eventEmitter.emit(EngineCallback.sub_roomresourcemsg_rep_error,X,H)}break;case r.UNPUB_ROOM_RESOURCE_MSG:log.debug("===acception UNPUB_ROOM_RESOURCE_MSG init");j=t.decodeBody(e).info;if(ie=room.getUserByNodeId(j.owner_id))if(j.stream.type==o.video)(v=ie.getVideo(j.resource_id)).status=n.init,arrayUtil.objectSplice(room.pubVideos,j.resource_id),log.info("===video accept UNPUB_ROOM_RESOURCE_MSG,, callback camera_status_notify videoStatus:"+v.status+",videoId:"+v.id+",videoName:"+v.name+",userId:"+ie.id),ie.eventEmitter.emit(UserCallback.camera_status_notify,v.status,v.id,v.name,ie.id),log.info("===video accept UNPUB_ROOM_RESOURCE_MSG,, callback unpublish_camera_notify  ownerId:"+j.owner_id+",resourceId:"+j.resource_id+",videoId:"+v.id),ie.eventEmitter.emit(UserCallback.unpublish_camera_notify,v);else if(j.stream.type==o.audio){if((y=ie.getAudio(j.resource_id)).status=n.init,arrayUtil.objectSplice(room.pubAudios,j.resource_id),log.info("===audio accept UNPUB_ROOM_RESOURCE_MSG,, callback microphone_status_notify audioStatus:"+y.status+",audioId:"+y.id+",audioName:"+y.name+",userId:"+ie.id),ie.eventEmitter.emit(UserCallback.microphone_status_notify,y.status,y.id,y.name,ie.id),audioAutoSub){log.info("===audio accept UNPUB_ROOM_RESOURCE_MSG,,to masterServer.audioUnsubscribleHandle(),ownerId:"+j.owner_id+",resourceId:"+j.resource_id+",audioId:"+y.id);E=getRandomNum(19001,19500);room.masterServer.audioUnsubscribleHandle(y.resourceInfo,E)}else log.info("===audio accept UNPUB_ROOM_RESOURCE_MSG,, callback unpublish_microphone_notify,ownerId:"+j.owner_id+",resourceId:"+j.resource_id+",audioId:"+y.id),ie.eventEmitter.emit(UserCallback.unpublish_microphone_notify,y)}else if(j.stream.type==o.desktop){var J;(J=ie.getScreen(j.resource_id)).status=n.init,arrayUtil.objectSplice(room.pubScreens,j.resource_id),log.info("===screen accept UNPUB_ROOM_RESOURCE_MSG,,, callback screen_status_notify screenStatus:"+J.status+",screenId:"+J.id+",videoName:"+J.name+",userId:"+ie.id),ie.eventEmitter.emit(UserCallback.screen_status_notify,J.status,J.id,J.name,ie.id),log.info("===screen accept UNPUB_ROOM_RESOURCE_MSG,, callback unpublish_screen_notify  ownerId:"+j.owner_id+",resourceId:"+j.resource_id+",screenId:"+J.id),ie.eventEmitter.emit(UserCallback.unpublish_screen_notify,J)}break;case r.UNSUB_ROOM_RESOURCE_MSG_REP:log.debug("===acception UNSUB_ROOM_RESOURCE_MSG_REP init");var Q=t.decodeBody(e);H=Q.id,W=Q.result;if(log.info("===acception UNSUB_ROOM_RESOURCE_MSG_REP,orderId:"+H+",result:"+W),0==W)room.eventEmitter.emit(EngineCallback.unsub_roomresourcemsg_rep_success,H);else{var $=new it(W,"");room.eventEmitter.emit(EngineCallback.unsub_roomresourcemsg_rep_error,$,H)}break;case r.VIDEO_INDICTION:log.debug("===acception VIDEO_INDICTION init");var Z=t.decodeBody(e),ee=room.getDeviceIdByUUID(0,Z.resource_id);v=room.selfUser.getVideo(ee);log.debug("===acception VIDEO_INDICTION resource_id:"+Z.resource_id+",opt:"+Z.opt),Z.opt==i.pub?v.publish():Z.opt==i.unpub&&v.unpublish();break;case r.AUDIO_INDICTION:log.debug("===acception AUDIO_INDICTION init");Z=t.decodeBody(e);var te=room.getDeviceIdByUUID(2,Z.resource_id);y=room.selfUser.getAudio(te);log.debug("===acception AUDIO_INDICTION resource_id:"+Z.resource_id+",opt:"+Z.opt),Z.opt==i.pub?y.openMicrophone():Z.opt==i.unpub?y.closeMicrophone():Z.opt==i.mute?y.muteMicrophone():Z.opt==i.unmute&&y.unmuteMicrophone();break;case r.PUBLIC_TEXT_MSG:log.debug("===acception PUBLIC_TEXT_MSG init");var re=t.decodeBody(e),oe=at(s.src,re);room.eventEmitter.emit(RoomCallback.public_message,oe);break;case r.PRIVATE_TEXT_MSG:log.debug("===acception PRIVATE_TEXT_MSG init");re=t.decodeBody(e),oe=at(s.src,re);room.eventEmitter.emit(RoomCallback.private_message,oe);break;case r.PUBLIC_DATA:log.debug("===acception PUBLIC_DATA init");var ne=t.decodeBody(e),ie=room.getUserByNodeId(s.src);room.eventEmitter.emit(RoomCallback.public_data,ne.content.toArrayBuffer(),ie.id);break;case r.PRIVATE_DATA:log.debug("===acception PRIVATE_DATA init");ne=t.decodeBody(e),ie=room.getUserByNodeId(s.src);room.eventEmitter.emit(RoomCallback.private_data,ne.content.toArrayBuffer(),ie.id);break;case r.UPDATE_USER_DATA_MSG:log.debug("===acception UPDATE_USER_DATA_MSG init");var ae=t.decodeBody(e);(ie=room.getUserByNodeId(ae.node_id)).data=ae.user_data,room.eventEmitter.emit(RoomCallback.user_data_notify,ae.user_data,ie.id);break;case r.ROOM_DATA_INFO:log.debug("===acception ROOM_DATA_INFO init");var se=t.decodeBody(e).kvs;if(null!=se)for(g=0;g<se.length;++g){var de=se[g];room.appData[de.key]=de.value,room.eventEmitter.emit(RoomCallback.app_data_notify,de.key,de.value),de.key==appDataKeyEnum.voiceActivated&&de.value==room.selfUser.id&&(log.debug("===acception ROOM_DATA_INFO voice_activated key:"+de.key+",value:"+de.value),room.voiceActivatedHandler())}break;case r.USER_INDICTION:log.debug("===acception USER_INDICTION init");var le=t.decodeBody(e);if(le.type==r.USER_MSG){var ue=t.decodeUserMsg(le.body),ce=room.getUserId(le.operator_id);log.info("===acception USER_INDICTION,callback leave_indication,reason:"+ue.reason+",userId:"+ce),room.eventEmitter.emit(RoomCallback.leave_indication,ue.reason,ce);room.leave(ue.reason,!0)}break;case r.USER_MSG:log.debug("===acception USER_MSG init");ue=t.decodeBody(e);if(ie=room.getUserByNodeId(ue.node_id)){if(log.info("===acception USER_MSG reason:"+ue.reason+",userId:"+ie.id+",userName:"+ie.name+",nodeId:"+ue.node_id),"avd_mp4_importer"==ie.userAgent&&(room.mp4ImporterUserAudioRtpPacketTemp=0,room.mp4ImporterUserAudioRtpPacketReal=0),ie.videos&&0<ie.videos.length)for(var f in ie.videos){v=ie.videos[f];room.pubVideos&&0<room.pubVideos.length&&arrayUtil.objectSplice(room.pubVideos,v.id),room.selfUser.subVideoIds&&0<room.selfUser.subVideoIds.length&&-1<room.selfUser.subVideoIds.indexOf(v.id)&&(log.debug("===acception USER_MSG,to video.unsubscrible(),userId:"+ie.id+",userName:"+ie.name+",videoId:"+v.id),v.unsubscrible())}return ie.audio&&(room.pubAudios&&0<room.pubAudios.length&&arrayUtil.objectSplice(room.pubAudios,ie.audio.id),room.selfUser.subAudioIds&&0<room.selfUser.subAudioIds.length&&ie.audio.resourceInfo&&(log.debug("===acception USER_MSG,to audio.unsubscrible(),userId:"+ie.id+",userName:"+ie.name+",audioId:"+ie.audio.id),-1<room.selfUser.subAudioIds.indexOf(ie.audio.id)&&ie.audio.unsubscrible())),ie.screen&&(room.pubScreens&&0<room.pubScreens.length&&arrayUtil.objectSplice(room.pubScreens,ie.screen.id),room.selfUser.subScreenIds&&0<room.selfUser.subScreenIds.length&&ie.screen.resourceInfo&&(log.debug("===acception USER_MSG,to screen.unsubscrible(),userId:"+ie.id+",userName:"+ie.name+",screenId:"+ie.screen.id),-1<room.selfUser.subScreenIds.indexOf(ie.screen.id)&&ie.screen.unsubscrible())),setTimeout(function(){room&&(room.selfUser.nodeId!=ie.nodeId||room.selfUser.waitingDelete)&&(log.debug("===acception USER_MSG,to remove user,userId:"+ie.id+",nodeId:"+ie.nodeId+",userName:"+ie.name),room.removeUserByUserIdAndNodeId(ie.id,ie.nodeId))},3500),804==ue.reason?void(ie.id==room.selfUser.id?(room.selfUser.mulLanding=!0,room.masterServer.pingInit(),log.info("===acception USER_MSG,callback leave_indication,reason:"+ue.reason+",userId:"+room.selfUser.id+",userName:"+room.selfUser.name),room.eventEmitter.emit(RoomCallback.leave_indication,ue.reason,room.selfUser.id),room.leave(ue.reason,!0)):(ie.waitingDelete=!0,log.info("===acception USER_MSG,callback user_leave_notify,reason:"+ue.reason+",userId:"+ie.id+",userName:"+ie.name),room.eventEmitter.emit(RoomCallback.user_leave_notify,ue.opt,ue.reason,ie))):807==ue.reason?(ie.waitingDelete=!0,log.info("===acception USER_MSG,callback user_leave_notify,reason:"+ue.reason+",userId:"+ie.id+",userName:"+ie.name),void room.eventEmitter.emit(RoomCallback.user_leave_notify,ue.opt,ue.reason,ie)):808==ue.reason?void(ie.id==room.selfUser.id?(room.masterServer.pingInit(),log.info("===acception USER_MSG,callback leave_indication,reason:"+ue.reason+",userId:"+room.selfUser.id+",userName:"+room.selfUser.name),room.eventEmitter.emit(RoomCallback.leave_indication,ue.reason,room.selfUser.id),room.leave(ue.reason,!0)):(ie.waitingDelete=!0,log.info("===acception USER_MSG,callback user_leave_notify,reason:"+ue.reason+",userId:"+ie.id+",userName:"+ie.name),room.eventEmitter.emit(RoomCallback.user_leave_notify,ue.opt,ue.reason,ie))):812==ue.reason?void(ie.id!=room.selfUser.id&&(ie.waitingDelete=!0,log.info("===acception USER_MSG,callback user_leave_notify,reason:"+ue.reason+",userId:"+ie.id+",userName:"+ie.name),room.eventEmitter.emit(RoomCallback.user_leave_notify,ue.opt,ue.reason,ie))):(ie.waitingDelete=!0,log.info("===acception USER_MSG,callback user_leave_notify,reason:"+ue.reason+",userId:"+ie.id+",userName:"+ie.name),void room.eventEmitter.emit(RoomCallback.user_leave_notify,ue.opt,ue.reason,ie))}break;case r.CLOSE_ROOM_REP:log.debug("===acception CLOSE_ROOM_REP init");var pe=t.decodeBody(e);log.info("===acception CLOSE_ROOM_REP,callback close_room_result,result:"+pe.result+",description:"+pe.description),room.eventEmitter.emit(RoomCallback.close_room_result,pe.result,pe.description);break;case r.CLOSE_ROOM_MSG:log.debug("===acception CLOSE_ROOM_MSG init");var he=t.decodeBody(e);room.userClearInfo(),log.info("===acception CLOSE_ROOM_MSG,callback close_room_notify,reason:"+he.reason+",roomId:"+he.room_id),room.eventEmitter.emit(RoomCallback.close_room_notify,he.room_id,he.reason);break;case r.UPDATE_USER_NAME:log.debug("===acception UPDATE_USER_NAME init");var fe=t.decodeBody(e);ie=room.getUserByNodeId(fe.node_id);for(var me in room.participants)room.participants[me].id==ie.id&&(room.participants[me].name=fe.new_name);log.info("===acception UPDATE_USER_NAME,callback user_name_notify,newName:"+fe.new_name+",userId:"+ie.id),room.eventEmitter.emit(RoomCallback.user_name_notify,fe.new_name,ie.id);break;case r.MODIFY_RESOURCE_REQ:log.debug("===acception MODIFY_RESOURCE_REQ init");var ge=t.decodeBody(e);log.debug("===acception MODIFY_RESOURCE_REQ,on modify resource req,resource_id:"+ge.info.resource_id);var ve=room.getDeviceIdByUUID(0,ge.info.resource_id);(v=room.selfUser.getVideo(ve))&&(log.debug("===acception MODIFY_RESOURCE_REQ,to video.changePublishVideoQuality(),videoId:"+v.id+",video_level:"+ge.video_level),v.changePublishVideoQuality(ge.video_level));break;case r.BIND_AUDIO_TO_VIDEO_REP:log.debug("===acception BIND_AUDIO_TO_VIDEO_REP init");var ye=t.decodeBody(e);ye&&0==ye.result?room.eventEmitter.emit(RoomCallback.bind_audio2video_rep_success,ye.id):room.eventEmitter.emit(RoomCallback.bind_audio2video_rep_error,ye.id);break;case r.USER_STREAM_ACTIVE:log.debug("===acception USER_STREAM_ACTIVE init");var be=t.decodeBody(e);if(be&&be.resource_id){var _e=be.resource_id,we=be.active_base,Se=be.active_ass1,Ee=be.active_ass2;log.debug("===acception USER_STREAM_ACTIVE resource_id:"+_e+",active_base:"+we+",active_ass1:"+Se+",active_ass2:"+Ee);ve=room.getDeviceIdByUUID(0,_e);(v=room.selfUser.getVideo(ve))&&v.setSpatialLayerActive(we,Se,Ee)}break;case r.ROOM_ATTRIBUTE_CHANGE_NOTIFY:log.debug("===acception ROOM_ATTRIBUTE_CHANGE_NOTIFY init");var Ie=t.decodeBody(e);if(Ie){var Te=Ie.attributes;if(Te){var Re=JSON.parse(Te);Re.record&&(room.roomControl.record=Re.record),Re.mix_record&&(room.roomControl.mix_record=Re.mix_record),Re.avc_model&&(room.roomControl.avc_model=Re.avc_model),Re.resolution&&(room.roomControl.resolution=Re.resolution),Re.liver&&(room.roomControl.liver=Re.liver),Re.mixer_liver&&(room.roomControl.mixer_liver=Re.mixer_liver),room.eventEmitter.emit(RoomCallback.room_control_change_notify,room.roomControl)}}break;case r.MEDIA_PLAY_EVENT_NOTIFY:log.debug("===acception MEDIA_PLAY_EVENT_NOTIFY init");var Ce=t.decodeBody(e);if(Ce){if(Ce.event==a.MediaPlayEventsStarted)room.mp4ImporterUserAudioStateStart(200),log.info("===acception MEDIA_PLAY_EVENT_NOTIFY callback mediaplay_started_notify, id:"+Ce.id+",roomId:"+Ce.room_id+",userId:"+Ce.user_id+",playId:"+Ce.play_id+",filePath:"+Ce.file_path),room.eventEmitter.emit(RoomCallback.mediaplay_started_notify,Ce.id,Ce.room_id,Ce.user_id,Ce.play_id,Ce.file_path);else if(Ce.event==a.MediaPlayEventsStoped){(ie=room.getUser(Ce.user_id))?ie.audio?0==ie.audio.audioLevel?(room.mp4ImporterUserAudioStateStop(),log.info("===acception MEDIA_PLAY_EVENT_NOTIFY callback mediaplay_stoped_notify, id:"+Ce.id+",roomId:"+Ce.room_id+",userId:"+Ce.user_id+",playId:"+Ce.play_id+",filePath:"+Ce.file_path),room.eventEmitter.emit(RoomCallback.mediaplay_stoped_notify,Ce.id,Ce.room_id,Ce.user_id,Ce.play_id,Ce.file_path)):(null==room.baseMediaPalyEventStopTime&&(room.baseMediaPalyEventStopTime=new Date),room.mediaPalyEventStopIntervalId=setInterval(function(){1e3<=new Date-room.baseMediaPalyEventStopTime&&(clearInterval(room.mediaPalyEventStopIntervalId),room.mp4ImporterUserAudioStateStop(),log.info("===acception MEDIA_PLAY_EVENT_NOTIFY timeout callback mediaplay_stoped_notify, id:"+Ce.id+",roomId:"+Ce.room_id+",userId:"+Ce.user_id+",playId:"+Ce.play_id+",filePath:"+Ce.file_path),room.eventEmitter.emit(RoomCallback.mediaplay_stoped_notify,Ce.id,Ce.room_id,Ce.user_id,Ce.play_id,Ce.file_path)),0==ie.audio.audioLevel&&(clearInterval(room.mediaPalyEventStopIntervalId),room.mp4ImporterUserAudioStateStop(),log.info("===acception MEDIA_PLAY_EVENT_NOTIFY IntervalId callback mediaplay_stoped_notify, id:"+Ce.id+",roomId:"+Ce.room_id+",userId:"+Ce.user_id+",playId:"+Ce.play_id+",filePath:"+Ce.file_path),room.eventEmitter.emit(RoomCallback.mediaplay_stoped_notify,Ce.id,Ce.room_id,Ce.user_id,Ce.play_id,Ce.file_path))},100)):log.debug("===acception MEDIA_PLAY_EVENT_NOTIFY user.audio is null"):log.debug("===acception MEDIA_PLAY_EVENT_NOTIFY user is null")}}else log.debug("===acception MEDIA_PLAY_EVENT_NOTIFY mediaPlayEventNotify is null");break;case r.STREAM_KEEP_ALIVE_TIMEOUT_NOTIFY:log.debug("===acception STREAM_KEEP_ALIVE_TIMEOUT_NOTIFY init");var Pe=t.decodeBody(e);if(Pe&&Pe.onwer_id)(ie=room.getUserByNodeId(Pe.onwer_id))&&(log.info("===acception STREAM_KEEP_ALIVE_TIMEOUT_NOTIFY callback stream_keep_alive_timeout_notify, userId:"+ie.id+", userName:"+ie.name+", mediaType:"+Pe.media_type+", resourceId:"+Pe.resource_id+", ssrc:"+Pe.ssrc),room.eventEmitter.emit(RoomCallback.stream_keep_alive_timeout_notify,ie.id,ie.name,Pe.media_type,Pe.resource_id,Pe.ssrc));break;case r.OFFER_REQ:log.debug("===P2P acception OFFER_REQ");var Me=t.decodeBody(e);room.traceableP2PPeerConnection.setRemoteP2P(Me);break;case r.OFFER_REP:log.debug("===P2P acception OFFER_REP");var xe=t.decodeBody(e);room.traceableP2PPeerConnection.setAnswerP2P(xe);break;case r.CANDIDATE_MSG:log.debug("===P2P acception CANDIDATE_MSG");b=t.decodeBody(e);room.traceableP2PPeerConnection.addIceCandidateP2P(b);break;case r.SUB_ROOM_RESOURCE_REQ:log.debug("===P2P acception SUB_ROOM_RESOURCE_REQ");var Ae=t.decodeBody(e);if(room.selfUser.nodeId>Ae.sub_node_id){room.traceableP2PPeerConnection.addStreamP2P(Ae);var ke=Ae.info,Oe=room.traceableP2PPeerConnection.getToP2PPeerConnection(Ae.sub_node_id);ke.stream.type==o.video?(log.info("===accept video P2P SUB_ROOM_RESOURCE_REQ: "+Ae.sub_node_id+"------\x3e"+room.selfUser.nodeId),room.selfUser.subVideoStream2ResourceInfo[ke.stream.stream_name]=ke,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("offerSub",Oe,"video",1,ke,Ae.sub_node_id)):ke.stream.type==o.audio?(log.info("===accept audio P2P SUB_ROOM_RESOURCE_REQ: "+Ae.sub_node_id+"------\x3e"+room.selfUser.nodeId),room.selfUser.subAudioStream2ResourceInfo[ke.stream.stream_name]=ke,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("offerSub",Oe,"audio",1,ke,Ae.sub_node_id)):ke.stream.type==o.desktop&&(log.info("===accept desktop P2P  SUB_ROOM_RESOURCE_REQ: "+Ae.sub_node_id+"------\x3e"+room.selfUser.nodeId),room.selfUser.subScreenStream2ResourceInfo[ke.stream.stream_name]=ke,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("offerSub",Oe,"desktop",1,ke,Ae.sub_node_id))}else room.traceableP2PPeerConnection.addStreamP2P(Ae),room.traceableP2PPeerConnection.sendSubSdpOfferP2P("answerSub",Ae);break;case r.SUB_ROOM_RESOURCE_REP:log.debug("===P2P acception SUB_ROOM_RESOURCE_REP, TO sub");var Ue=t.decodeBody(e);if(room.selfUser.nodeId>Ue.info.owner_id){ke=Ue.info,Oe=room.traceableP2PPeerConnection.getToP2PPeerConnection(ke.owner_id);ke.stream.type==o.video?(room.selfUser.subVideoStream2ResourceInfo[ke.stream.stream_name]=ke,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("answerSub",Oe,"video",1,ke,ke.owner_id)):ke.stream.type==o.audio?(room.selfUser.subAudioStream2ResourceInfo[ke.stream.stream_name]=ke,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("answerSub",Oe,"audio",1,ke,ke.owner_id)):ke.stream.type==o.desktop&&(room.selfUser.subScreenStream2ResourceInfo[ke.stream.stream_name]=ke,room.traceableP2PPeerConnection.sendSubSdpAnswerP2P("answerSub",Oe,"desktop",1,ke,ke.owner_id))}else room.traceableP2PPeerConnection.getSubSdpAnswerP2PByRep(Ue);break;case r.SUB_ROOM_RESOURCE_MSG:log.debug("===P2P acception SUB_ROOM_RESOURCE_MSG");var Le=t.decodeBody(e);room.traceableP2PPeerConnection.getSubSdpAnswerP2P(Le);break;case r.UPDATE_BOARD_MSG:log.debug("===acception UPDATE_BOARD_MSG init");var De=t.decodeBody(e);log.debug("===acception UPDATE_BOARD_MSG,operType:"+De.operType+",operNodeId:"+De.operNodeId+",operUserId:"+De.operUserId+",boardId:"+De.boardId),setTimeout(function(){var e=room.getUser(De.operUserId);if(De.operType==OperType.add){log.debug("===acception UPDATE_BOARD_MSG,operType=add");var t=(r=De.board.bgColor).r+","+r.g+","+r.b+","+r.a/255;(a=new nt(De.board.ownerUserId,De.board.width,De.board.height,t,De.board.bgImage,De.board.title,"","",De.board.description,De.board.extendData)).setBoardId(De.board.objectId),e.boards.push(a),room.boardId2userId[a.id]=e.id,e.eventEmitter.emit(UserCallback.board_add_result,a)}else if(De.operType==OperType.update){log.debug("===acception UPDATE_BOARD_MSG,operType=update");t=(r=De.board.bgColor).r+","+r.g+","+r.b+","+r.a/255;var r,o=De.board.bgImage,n=De.board.objectId;log.debug("===acception UPDATE_BOARD_MSG,operType=update,boardId:"+n+",backgroundColor:"+t+",backgroundImage:"+o),e.eventEmitter.emit(UserCallback.board_update_result,n,t,o)}else if(De.operType==OperType.remove)log.debug("===acception UPDATE_BOARD_MSG,operType=remove"),arrayUtil.objectSplice(e.boards,De.boardId),delete room.boardId2userId[e.id],delete room.annotation2boardId[De.boardId],e.eventEmitter.emit(UserCallback.board_remove_result,De.boardId);else if(De.operType==OperType.share){if(log.debug("===acception UPDATE_BOARD_MSG,operType=share"),(a=(e=room.getUser(room.boardId2userId[De.boardId])).getBoard(De.boardId)).status=boardStatusEnum.open,room.annotation2boardId[De.boardId]){for(var i in room.annotation2boardId[De.boardId].storageArr)room.annotation2boardId[De.boardId].queueArr.push(room.annotation2boardId[De.boardId].storageArr[i]);room.updateAnnotationDrow(room.annotation2boardId[De.boardId].queueArr)}e.eventEmitter.emit(UserCallback.board_share_result,a)}else if(De.operType==OperType.close){var a;if(log.debug("===acception UPDATE_BOARD_MSG,operType=close"),(a=(e=room.getUser(room.boardId2userId[De.boardId])).getBoard(De.boardId)).status=boardStatusEnum.close,a.annotation=null,room.annotation2boardId[De.boardId])for(var i in room.annotation2boardId[De.boardId].storageArr)room.annotation2boardId[De.boardId].queueArr.push(room.annotation2boardId[De.boardId].storageArr[i]);e.eventEmitter.emit(UserCallback.board_close_result,De.boardId)}},500);break;case r.BOARDS_INFO_PDU:log.debug("===acception BOARDS_INFO_PDU init");var Ne=t.decodeBody(e);break;case r.UPDATE_ANNOTATION_MSG:log.debug("===acception UPDATE_ANNOTATION_MSG init");var Be=t.decodeBody(e);log.debug("===acception UPDATE_ANNOTATION_MSG, operType:"+Be.operType+",objectId:"+Be.objectId+",annotationType:"+Be.annotationType+",annotationId:"+Be.annotationId+",operNodeId:"+Be.operNodeId+",operUserId:"+Be.operUserId),room.addAnnotationMsg(Be);ie=room.getUser(room.boardId2userId[Be.objectId]);if(Be.annotationType==shapeTypeEnum.clear&&room.annotation2boardId[Be.objectId]&&0<room.annotation2boardId[Be.objectId].storageArr.length)for(g=0;g<room.annotation2boardId[Be.objectId].storageArr.length;g++){var je=room.annotation2boardId[Be.objectId].storageArr[g];je.operUserId==Be.operUserId&&je.operType==OperType.add&&(room.annotation2boardId[Be.objectId].storageArr.splice(g,1),g--)}if(ie){var Ve=ie.getBoard(Be.objectId),Fe=room.annotation2boardId[Be.objectId];log.debug("===acception UPDATE_ANNOTATION_MSG"),Ve&&Ve.status==boardStatusEnum.open&&Fe&&(log.debug("===acception UPDATE_ANNOTATION_MSG, board.status == boardStatusEnum.open"),room.updateAnnotationDrow(Fe.queueArr))}break;case r.OUTGOING_CREATE_STREAMS_EXPORTER_REP:log.debug("===acception OUTGOING_CREATE_STREAMS_EXPORTER_REP init");var qe=t.decodeBody(e);if(0==qe.result)log.debug("===acception OUTGOING_CREATE_STREAMS_EXPORTER_REP,callback create_server_recorder_rep_success,result:0,outgoingCreateStreamsExporterRep.exporter_id:",qe.exporter_id),room.eventEmitter.emit(ExporderCallBack.create_server_recorder_rep_success,qe.id,qe.exporter_id,qe.exporter_name,qe.play_urls);else{log.debug("===acception OUTGOING_CREATE_STREAMS_EXPORTER_REP,callbakc create_server_recorder_rep_error, result:"+qe.result+",msg:"+qe.msg+",exporter_id:",qe.exporter_id);var Ge=new it(qe.result,qe.msg);room.eventEmitter.emit(ExporderCallBack.create_server_recorder_rep_error,Ge,qe.id)}break;case r.OUTGOING_SELECT_STREAM_REP:log.debug("===acception OUTGOING_SELECT_STREAM_REP init");var He=t.decodeBody(e);if(0==He.result)log.debug("===acception OUTGOING_SELECT_STREAM_REP,callback select_stream_rep_success,result:0,selectStreamRep.exporter_id:",He.exporter_id),room.eventEmitter.emit(ExporderCallBack.select_stream_rep_success,He.id,He.exporter_id);else{log.debug("===acception OUTGOING_SELECT_STREAM_REP,callbakc select_stream_rep_error, result:"+He.result+",msg:"+He.msg+",exporter_id:",He.exporter_id);var We=new it(He.result,He.msg);room.eventEmitter.emit(ExporderCallBack.select_stream_rep_error,We,He.id)}break;case r.OUTGOING_MIX_STREAMS_REP:log.debug("===acception OUTGOING_MIX_STREAMS_REP init");var Ye=t.decodeBody(e);if(0==Ye.result)log.debug("===acception OUTGOING_MIX_STREAMS_REP,callback mix_media_rep_success,result:0,mixStreamsRep.exporter_id:",Ye.exporter_id),room.eventEmitter.emit(ExporderCallBack.mix_media_rep_success,Ye.id,Ye.exporter_id);else{log.debug("===acception OUTGOING_MIX_STREAMS_REP,callbakc mix_media_rep_error, result:"+Ye.result+",msg:"+Ye.msg+",exporter_id:",Ye.exporter_id);We=new it(Ye.result,Ye.msg);room.eventEmitter.emit(ExporderCallBack.mix_media_rep_error,We,Ye.id)}break;case r.OUTGOING_PAUSE_RESUME_EXPORTER_REP:log.debug("===acception OUTGOING_PAUSE_RESUME_EXPORTER_REP init");var ze=t.decodeBody(e);if(0==ze.result)log.debug("===acception OUTGOING_PAUSE_RESUME_EXPORTER_REP,callback pause_stream_rep_success,result:0,pauseResumeRep.exporter_id:",ze.exporter_id),room.eventEmitter.emit(ExporderCallBack.pause_stream_rep_success,ze.id,ze.exporter_id);else{log.debug("===acception OUTGOING_PAUSE_RESUME_EXPORTER_REP,callbakc pause_stream_rep_error, result:"+ze.result+",msg:"+ze.msg+",exporter_id:",ze.exporter_id);We=new it(ze.result,ze.msg);room.eventEmitter.emit(ExporderCallBack.pause_stream_rep_error,We,ze.id)}log.debug("===acception OUTGOING_PAUSE_RESUME_EXPORTER_REP pauseResumeRep:",ze);break;case r.OUTGOING_DESTROY_EXPORTER_REP:log.debug("===acception OUTGOING_DESTROY_EXPORTER_REP init ");var Ke=t.decodeBody(e);if(0==Ke.result)log.debug("===acception OUTGOING_DESTROY_EXPORTER_REP,callback stop_stream_rep_success, result:0, stopStreamRep.exporter_id:",Ke.exporter_id),room.eventEmitter.emit(ExporderCallBack.stop_stream_rep_success,Ke.id,Ke.exporter_id);else{log.debug("===acception OUTGOING_DESTROY_EXPORTER_REP,callback stop_stream_rep_error, result:"+Ke.result+",msg"+Ke.msg+", stopStreamRep.exporter_id:",Ke.exporter_id);We=new it(Ke.result,Ke.msg);room.eventEmitter.emit(ExporderCallBack.stop_stream_rep_error,We,Ke.id)}break;case r.OUTGOING_EXPORTER_ERROR_NOTIFY:log.debug("===acception OUTGOING_EXPORTER_ERROR_NOTIFY init");Ne=t.decodeBody(e);log.debug("===acception OUTGOING_EXPORTER_ERROR_NOTIFY boardsInfoMsg:",Ne);break;case r.OUTGOING_INVITE_STATUS_NOTIFY:log.debug("===acception SIP_INVITE_STATUS_NOTIFY init");var Xe=t.decodeBody(e);log.debug("===acception SIP_INVITE_STATUS_NOTIFY,callbakc outgoing_invite_status_notify,statusNotify:",Xe.outgoing_invite_status_notify),room.eventEmitter.emit(RoomCallback.outgoing_invite_status_notify,Xe.type,Xe.room_id,Xe.sip_addr,Xe.status,Xe.msg);break;case r.ROOM_SET_STREAM_NAME_RSP:log.debug("===acception ROOM_SET_STREAM_NAME_RSP init");var Je=t.decodeBody(e);if(0==Je.ret)log.debug("===acception ROOM_SET_STREAM_NAME_RSP,callback room_set_stream_name_rep_success, result:0, roomSetStreamNameRsp.id:",Je.id),room.eventEmitter.emit(UserCallback.room_set_stream_name_rep_success,Je.id);else{log.debug("===acception ROOM_SET_STREAM_NAME_RSP,callback room_set_stream_name_rep_error, result:"+Je.result+",msg:"+Je.msg+", roomSetStreamNameRsp.id:",Je.id);var Qe=new it(Je.ret,Je.msg);room.eventEmitter.emit(UserCallback.room_set_stream_name_rep_error,Qe,Je.id)}break;case r.ROOM_STREAM_NAME_CHANGED_NOTIFY:log.debug("===acception ROOM_STREAM_NAME_CHANGED_NOTIFY init");var $e=t.decodeBody(e);log.debug("===acception ROOM_STREAM_NAME_CHANGED_NOTIFY roomStreamNameChangedNotify",$e),(ie=room.getUser($e.user_id))&&ie.id!=room.selfUser.id&&(v=ie.getVideo($e.video_resource_id))&&(v.streamName=$e.stream_name,v.streamNickName=$e.stream_nick_name);break;case r.OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP:log.debug("===acception OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP init");var Ze=t.decodeBody(e);if(0==Ze.ret)log.debug("===acception OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP,callback set_focus_video_rep_success, result:0, outgoingExporterSetFocusVideoRsp.id:",Ze.id),room.eventEmitter.emit(ExporderCallBack.set_focus_video_rep_success,Ze.id);else{log.debug("===acception OUTGOING_EXPORTER_SET_FOCUS_VIDEO_RSP,callback set_focus_video_rep_error, result:"+Ze.result+",msg:"+Ze.msg+", outgoingExporterSetFocusVideoRsp.id:",Ze.id);var et=new it(Ze.ret,Ze.msg);room.eventEmitter.emit(ExporderCallBack.set_focus_video_rep_error,et,Ze.id)}break;case r.OUTGOING_GET_EXPORTER_INFO_RSP:log.debug("===acception OUTGOING_GET_EXPORTER_INFO_RSP init");var tt=t.decodeBody(e);log.debug("===acception OUTGOING_GET_EXPORTER_INFO_RSP outgoingGetExporterInfoRsp:",tt);V=null;log.debug("===acception OUTGOING_GET_EXPORTER_INFO_RSP outgoingGetExporterInfoRsp.videos:",tt.videos),tt.videos&&0<tt.videos.length&&(V=t.decodeOutgoingVideoInfo(tt.videos)),room.eventEmitter.emit(ExporderCallBack.get_exporter_info_rep_success,tt.id,tt,V)}},e}),ModuleBase.define("User",["Video","Audio","Screen","Board","Error"],function(o,n,i,d,r){var e=function(e,t,r){this.id=e,this.name=t,this.data=r,this.eventEmitter=new EventEmitter,this.subVideoTrack2ResourceInfo={},this.subAudioTrack2ResourceInfo={},this.subScreenTrack2ResourceInfo={},this.reJoinSubVideoIds=[],this.reJoinSubAudioIds=[],this.reJoinSubScreenIds=[],this.reJoinVideoId2Description={},this.reJoinScreenDescription=null,this.boards=[],this.init()};return e.prototype.init=function(){this.nodeId=null,this.role=null,this.userAgent=null,this.stream=null,this.waitingDelete=!1,this.videos=[],this.audio,this.screen,this.toMCUPC,this.mulLanding=!1,this.deviceId2VideoSdpSsrc={},this.audioSdpSsrc,this.screenSdpSsrc,this.subVideoIds=[],this.subAudioIds=[],this.subScreenIds=[],this.toP2PPCs={},this.sdpP2PMap={},this.videoSdpSsrcMapP2PMap={},this.audioSdpSsrcP2PMap={},this.screenSdpSsrcP2PMap={},this.subMyVideosP2P=[],this.subMyAudiosP2P=[],this.subMyScreensP2P=[]},e.prototype.createVideo=function(e,t){var r=new o(e,t);return r.ownerId=this.id,this.videos.push(r),r},e.prototype.createAudio=function(e,t){var r=new n(e,t);return r.ownerId=this.id,this.audio=r},e.prototype.createScreen=function(e,t){var r=new i(e,t);return r.ownerId=this.id,this.screen=r},e.prototype.initScreen=function(){var e=Math.uuid(),t=this.name+"-screen",r=this.createScreen(e,t);r.level=0,r.description="",this.reJoinScreenDescription&&(r.description=this.reJoinScreenDescription),this.eventEmitter.emit(UserCallback.screen_status_notify,r.status,r.id,r.name,this.id),room.masterServer.addScreenMsg(e,r)},e.prototype.initVideo=function(e,t){var r=this.createVideo(e,t);r.cameraType=CameraType.unknown,r.level=0,r.description="";var o=this.reJoinVideoId2Description[e];o&&(r.description=o),this.eventEmitter.emit(UserCallback.camera_status_notify,r.status,r.id,r.name,this.id);var n=room.setDeviceIdByUUID(0,e);room.masterServer.addWebcamMsg(n,r)},e.prototype.deleteVideo=function(e){var t=this.getVideo(e);if(t){t.status==StreamStatus.opened?t.unpreview():t.status==StreamStatus.published&&t.unpublish(),arrayUtil.objectSplice(this.videos,e),this.eventEmitter.emit(UserCallback.camera_status_notify,StreamStatus.none,t.id,t.name,this.id);var r=room.setDeviceIdByUUID(0,e);room.masterServer.removeWebcamMsg(r)}},e.prototype.initAudio=function(e,t){var r=this.createAudio(e,t);room.avdEngine.checkAudioId=e,room.avdEngine.checkAudioName=t,this.eventEmitter.emit(UserCallback.microphone_status_notify,r.status,r.id,r.name,this.id);var o=room.setDeviceIdByUUID(2,e);room.masterServer.addSpeakerMsg(o,r)},e.prototype.deleteAudio=function(e){var t=this.getAudio(e);if(t){t.status==StreamStatus.published&&t.closeMicrophone(),this.audio=null,this.eventEmitter.emit(UserCallback.microphone_status_notify,StreamStatus.none,t.id,t.name,this.id);var r=room.setDeviceIdByUUID(2,e);room.masterServer.removeSpeakerMsg(r)}},e.prototype.getVideo=function(e){for(var t=null,r=0;r<this.videos.length;r++){var o=this.videos[r];if(o.id==e){t=o;break}}return t},e.prototype.getScreen=function(){return this.screen},e.prototype.getAudio=function(e){var t=null;return this.audio&&this.audio.id==e&&(t=this.audio),t},e.prototype.openCameraAndMicrophone=function(s,d,l,u){log.info("===user.openCameraAndMicrophone(),",s,d),loggerReport.info("");var c=when.defer(),p=this;return s&&null==d?s.publish():null==s&&d?d.openMicrophone():s&&d&&obtainUserMedia(d,s,function(e){var r=getRandomNum(1,3e3);s.status=StreamStatus.opened,s.track=e.videoStream.getVideoTracks()[0],null==room.selfUser.stream?room.selfUser.stream=e.videoStream:room.selfUser.stream.addTrack(s.track);var t=room.setDeviceIdByUUID(0,s.id),o=p.getNewStreamByTrack(s.track);room.masterServer.videoPublishHandle(t,o,r),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==r&&((s.element=l).srcObject=o,s.status=StreamStatus.published,room.hasObject(room.pubVideos,s)||room.pubVideos.push(s),p.eventEmitter.emit(UserCallback.camera_status_notify,s.status,s.id,s.name,p.id))}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==r&&c.reject(e)});var n=getRandomNum(30001,6e3);d.state=StreamStatus.opened,d.track=e.audioStream.getAudioTracks()[0],null==room.selfUser.stream?room.selfUser.stream=e.audioStream:room.selfUser.stream.addTrack(d.track);var i=room.setDeviceIdByUUID(2,d.id),a=p.getNewStreamByTrack(d.track);room.masterServer.audioPublishHandle(i,a,n),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_success,function(e){e==n&&(u&&((d.element=u).srcObject=a),d.status=StreamStatus.published,room.hasObject(room.pubAudios,d)||room.pubAudios.push(d),p.eventEmitter.emit(UserCallback.microphone_status_notify,d.status,d.id,d.name,p.id))}),room.addCallback(EngineCallback.pub_roomresourcemsg_rep_error,function(e,t){t==n&&c.reject(e)})},function(e){var t=new r(ErrorConstant.failed_access_localMedia);c.reject(t)}),c.promise},e.prototype.remotecmdPublishCamera=function(e){log.info("===user.remotecmdPublishCamera(),userId:"+e.ownerId+",Id:"+e.id),loggerReport.info(",userId:"+e.ownerId+",Id:"+e.id);var t=room.getNodeId(e.ownerId);room.masterServer.videoIndiction(!0,e.id,t)},e.prototype.remotecmdUnpublishCamera=function(e,t){log.info("===user.remotecmdUnpublishCamera(),userId:"+e+",cameraId:"+t),loggerReport.info(", userId:"+e+",cameraId:"+t);var r=room.getNodeId(e);room.masterServer.videoIndiction(!1,t,r)},e.prototype.remotecmdOpenMicrophone=function(e){log.info("===user.remotecmdOpenMicrophone(),userId:"+e),loggerReport.info(", userId:"+e);var t=room.getUser(e),r=room.getNodeId(e);room.masterServer.audioIndiction("pub",t.audio.id,r)},e.prototype.remotecmdCloseMicrophone=function(e){log.info("===user.remotecmdCloseMicrophone(),userId:"+e),loggerReport.info(", userId:"+e);var t=room.getUser(e),r=room.getNodeId(e);room.masterServer.audioIndiction("unpub",t.audio.id,r)},e.prototype.remotecmdMuteMicrophone=function(e){log.info("===user.remotecmdMuteMicrophone(),userId:"+e),loggerReport.info(", userId:"+e);var t=room.getUser(e),r=room.getNodeId(e);room.masterServer.audioIndiction("mute",t.audio.id,r)},e.prototype.remotecmdUnmuteMicrophone=function(e){log.info("===user.remotecmdUnmuteMicrophone(),userId:"+e),loggerReport.info(", userId:"+e);var t=room.getUser(e),r=room.getNodeId(e);room.masterServer.audioIndiction("unmute",t.audio.id,r)},e.prototype.updateUserName=function(e){for(var t in log.info("===user.updateUserName(),userName:"+e),loggerReport.info("===user.updateUserName(), userName:"+e),room.participants)room.participants[t].id==this.id&&(room.participants[t].name=e);room.masterServer.updateUserName(this.nodeId,e)},e.prototype.updateUserData=function(e){this.data=e,room.masterServer.updateUserDataMsg(e)},e.prototype.getUserData=function(e){if(void 0===e||null==e||""==e)return this.data;var t=room.getUser(e);return t?t.data:void 0},e.prototype.attachVideoElementMediaStream=function(e,t){if(t){var r=t.getTracks()[0],o=this.subVideoTrack2ResourceInfo[r.id],n=this.getUserByVideoTrackId(r.id);if(n){var i=n.getVideo(o.resource_id);i&&(i.element=e)}}e&&(log.debug("===attachVideoElementMediaStream(),userId:"+this.id+",userName:"+this.name+",elementId:"+e.id),e.srcObject=t)},e.prototype.attachScreenElementMediaStream=function(e,t){if(t){var r=t.getTracks()[0],o=this.subScreenTrack2ResourceInfo[r.id],n=this.getUserByScreenTrackId(r.id);if(n){var i=n.getScreen(o.resource_id);i&&(i.element=e)}}e&&(e.srcObject=t)},e.prototype.attachAudioElementMediaStream=function(e,t){if(t){var r=t.getTracks()[0],o=this.subAudioTrack2ResourceInfo[r.id],n=this.getUserByAudioTrackId(r.id);if(n){var i=n.getAudio(o.resource_id);i&&(i.element=e)}}e&&(e.srcObject=t)},e.prototype.addCallback=function(e,t){this.eventEmitter.addListener(e,t)},e.prototype.getUserByVideoTrackId=function(e){var t=this.subVideoTrack2ResourceInfo[e];if(t){var r=t.owner_id;return room.getUserByNodeId(r)}return null},e.prototype.getUserByAudioTrackId=function(e){var t=this.subAudioTrack2ResourceInfo[e];if(t){var r=t.owner_id;return room.getUserByNodeId(r)}return null},e.prototype.getUserByScreenTrackId=function(e){var t=this.subScreenTrack2ResourceInfo[e];if(t){var r=t.owner_id;return room.getUserByNodeId(r)}return null},e.prototype.getNewStreamByTrack=function(e){var t=null;e&&this.stream&&0<this.stream.getTracks().length&&((t=this.stream.clone()).getTracks().forEach(function(e){t.removeTrack(e)}),t.addTrack(e));return t},e.prototype.bindAudioToVideo=function(e,t){var r=when.defer();return room.masterServer.bindAudioToVideo(109,e,t),room.addCallback(EngineCallback.bind_audio2video_rep_success,function(e){109==e&&r.resolve()}),room.addCallback(EngineCallback.bind_audio2video_rep_error,function(e){109==e&&r.reject()}),r.promise},e.prototype.createBoard=function(e,t,r,o,n,i,a){var s=new d(this.id,e,t,r,o,n,i,a);return s.inputWidth=null,s.inputHeight=null,this.boards.push(s),room.boardId2userId[s.id]=this.id,room.masterServer.addBoardMsg(OperType.add,s),this.shareBoardById(s.id),s},e.prototype.updateBoard=function(e){room.masterServer.addBoardMsg(OperType.update,e)},e.prototype.getBoard=function(e){for(var t,r=0;r<this.boards.length;r++){var o=this.boards[r];if(o.id==e){t=o;break}}return t},e.prototype.getAllBoards=function(){return room.boards},e.prototype.removeBoardById=function(e){arrayUtil.objectSplice(this.boards,e),delete room.boardId2userId[e],delete room.annotation2boardId[e],room.masterServer.removeBoardMsg(OperType.remove,e)},e.prototype.closeBoardById=function(e){var t=this.getBoard(e);if(t.status!=boardStatusEnum.close){if(t.status=boardStatusEnum.close,t.annotation=null,room.annotation2boardId[e])for(var r in room.annotation2boardId[e].queueArr=[],room.annotation2boardId[e].storageArr)room.annotation2boardId[e].queueArr.push(room.annotation2boardId[e].storageArr[r]);room.masterServer.closeBoardMsg(OperType.close,e)}},e.prototype.shareBoardById=function(l,u){var c=this.getBoard(l);if(u||c.status!=boardStatusEnum.open){c.status=boardStatusEnum.open,u&&room.masterServer.addBoardMsg(OperType.add,c);var p=room.annotation2boardId[l];p&&setTimeout(function(){if(u&&0<c.annotation.shapeArray.length){for(var e in c.annotation.shapeArray){var t=c.annotation.shapeArray[e];room.sendAddAnnotation(l,t.shape,t.shapeType,t.color,t.lineWidth,t.arrowtype,t.fillType)}var r=c.annotation.otherShapeMap;for(var o in r){var n=r[o];for(var e in n){var i=room.annotation2boardId[c.id].storageArr;for(var a in i)if(i[a].annotationId==n[e].id){var s={boardId:c.id,shapeObj:n[e].shape,shapeType:i[a].ann2pt.objectBase.type,lineColor:"",lineWidth:i[a].ann2pt.objectBase.lineWidth,arrowType:i[a].ann2pt.objectBase.arrow,fillType:1},d=i[a].ann2pt.objectBase.lineColor;s.lineColor="rgba("+d.r+","+d.g+","+d.b+","+d.a,0==room.annotation2boardId[c.id].storageArr[a].ann2pt.objectBase.fillColor.a?s.fillType=1:s.fillType=2,room.sendAddAnnotation(c.id,s.shapeObj,s.shapeType,s.lineColor,s.lineWidth,s.arrowType,s.fillType)}}}}else room.updateAnnotationDrow(p.queueArr)},50),room.masterServer.shareBoardMsg(OperType.share,l,c)}},e.prototype.removeBoard=function(){for(var e in this.boards)delete room.boardId2userId[boards[e].id],delete room.annotation2boardId[boards[e].id];arrayUtil.objectSplice(this.boards,this.id)},e.prototype.openMobileFrontVideo=function(r){var o=when.defer(),n=this;return navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user"}}).then(function(e){log.debug("===user.openFrontVideo(),stream:",e);var t=n.videos[0];currentVideoParameter.videoWidth=t.resolution.width,currentVideoParameter.videoHeight=t.resolution.height,currentVideoParameter.frameRate=t.frameRate,t.track=e.getVideoTracks()[0],null==room.selfUser.stream?room.selfUser.stream=e:room.selfUser.stream.addTrack(t.track),t.isPubState=!0,t.publishHandle(r).then(function(){log.info("===user.openFrontVideo(),,videoId:"+t.id+",videoName"+t.name+",userId:"+t.ownerId),o.resolve()}).otherwise(function(e){t.isPubState=!1,log.error("===user.openFrontVideo(),,videoId:"+t.id+",videoName"+t.name+",userId:"+t.ownerId+",error:"+JSON.stringify(e)),o.reject(e)})}).catch(function(e){log.error("===user.openFrontVideo() failed,error: ",e),video.isPubState=!1,o.reject(e)}),o.promise},e.prototype.closeMobileFrontVideo=function(){var e=this.videos[0];e.unpreview(),e.unpublish()},e.prototype.openMobileBackVideo=function(r){var o=when.defer(),n=this;return navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}}).then(function(e){log.debug("===user.openBackVideo(),stream:",e);var t=n.videos[1];currentVideoParameter.videoWidth=t.resolution.width,currentVideoParameter.videoHeight=t.resolution.height,currentVideoParameter.frameRate=t.frameRate,t.track=e.getVideoTracks()[0],null==room.selfUser.stream?room.selfUser.stream=e:room.selfUser.stream.addTrack(t.track),t.isPubState=!0,t.publishHandle(r).then(function(){log.info("===user.openBackVideo(),,videoId:"+t.id+",videoName"+t.name+",userId:"+t.ownerId),o.resolve()}).otherwise(function(e){t.isPubState=!1,log.error("===user.openBackVideo(),,videoId:"+t.id+",videoName"+t.name+",userId:"+t.ownerId+",error:"+JSON.stringify(e)),o.reject(e)})}).catch(function(e){log.error("===user.openBackVideo() failed,error: ",e),video.isPubState=!1,o.reject(e)}),o.promise},e.prototype.closeMobileBackVideo=function(){var e=this.videos[1];e.unpreview(),e.unpublish()},e}),ModuleBase.define("Record",["RecordRestServer","Error"],function(t,n){var e=function(e){this.restServerURI=e,this.recordRestServer=new t,this.recordInfo={name:"",tag:"",roomId:"",userId:"",audioType:RecordEnum.AudioType.singleuser,videoType:RecordEnum.VideoType.mainflow,fileType:RecordEnum.FileType.mp4}};return e.prototype.createUserRecord=function(e,t){var r=when.defer();if(!t){o=new n(ErrorConstant.params_require);return r.reject(o),r.promise}if(""==t.roomId){var o=new n(ErrorConstant.roomId_required);return r.reject(o),r.promise}if(""!=t.userId)return this.recordRestServer.createUserRecord(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise;var o=new n(ErrorConstant.userId_required);return r.reject(o),r.promise},e.prototype.stopRecord=function(e,t){var r=when.defer();return this.recordRestServer.stopRecord(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.getRecord=function(e,t){var r=when.defer();return this.recordRestServer.getRecord(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.deleteRecord=function(e,t){var r=when.defer();return this.recordRestServer.deleteRecord(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.findRecords=function(e,t,r,o){var n=when.defer();return this.recordRestServer.findRecords(this.restServerURI,e,t,r,o).then(function(e){n.resolve(e)}).otherwise(function(e){n.reject(e)}),n.promise},e}),ModuleBase.define("RecordRestServer",["Error"],function(l){var e=function(){};return e.prototype.createUserRecord=function(e,t,r){var o=when.defer(),n=document.location.protocol;"httpsionic:"==n&&(n="https:");var i=n+"//"+e+"/avd/api/record/createUserRecord?accessToken="+t,a={params:r};return this.fetchGet(i,a).then(function(e){if(e&&0==e.result)o.resolve(e.data);else{var t=new l(e.result,e.err);o.reject(t)}}).catch(function(e){e=new l(e.code,e.message);return o.reject(e),!1}),o.promise},e.prototype.stopRecord=function(e,t,r){var o=when.defer(),n=document.location.protocol;"httpsionic:"==n&&(n="https:");var i=n+"//"+e+"/avd/api/record/stop",a={params:{id:r,accessToken:t}};return this.fetchGet(i,a).then(function(e){if(e&&0==e.result)o.resolve(e.data);else{var t=new l(e.result,e.err);o.reject(t)}}).catch(function(e){e=new l(e.code,e.message);return o.reject(e),!1}),o.promise},e.prototype.getRecord=function(e,t,r){var o=when.defer(),n=document.location.protocol;"httpsionic:"==n&&(n="https:");var i=n+"//"+e+"/avd/api/record/getRecord",a={params:{id:r,accessToken:t}};return this.fetchGet(i,a).then(function(e){if(e&&0==e.result)o.resolve(e.data);else{var t=new l(e.result,e.err);o.reject(t)}}).catch(function(e){e=new l(e.code,e.message);return o.reject(e),!1}),o.promise},e.prototype.deleteRecord=function(e,t,r){var o=when.defer(),n=document.location.protocol;"httpsionic:"==n&&(n="https:");var i=n+"//"+e+"/avd/api/record/delete",a={params:{id:r,accessToken:t}};return this.fetchGet(i,a).then(function(e){if(e&&0==e.result)o.resolve(e.data);else{var t=new l(e.result,e.err);o.reject(t)}}).catch(function(e){e=new l(e.code,e.message);return o.reject(e),!1}),o.promise},e.prototype.findRecords=function(e,t,r,o,n){var i=when.defer(),a=document.location.protocol;"httpsionic:"==a&&(a="https:");var s=a+"//"+e+"/avd/api/record/findRecords",d={params:{begin:r,count:o,filter:n,accessToken:t}};return this.fetchGet(s,d).then(function(e){if(e&&0==e.result)i.resolve(e.data);else{var t=new l(e.result,e.err);i.reject(t)}}).catch(function(e){e=new l(e.code,e.message);return i.reject(e),!1}),i.promise},e.prototype.fetchGet=function(e,t){return new Promise(function(r,o){axios.get(e,t).then(function(e){if(0===e.data.result)r(e.data);else{var t={code:e.data.result,message:e.data.err};o(t)}}).catch(function(e){if(e.response){var t=new l(e.response.status,e.response.data);o(t)}else{t=new l(1e4,e.message);o(t)}o(e)})})},e.prototype.fetchPost=function(e,t){return new Promise(function(r,o){axios.post(e,t).then(function(e){if(0===e.data.result)r(e.data);else{var t={code:e.data.result,message:e.data.err};o(t)}}).catch(function(e){if(e.response){var t=new l(e.response.status,e.response.data);o(t)}else{t=new l(1e4,e.message);o(t)}o(e)})})},e}),ModuleBase.define("Live",["LiveRestServer","Error"],function(t,n){var e=function(e){this.restServerURI=e,this.liveRestServer=new t,this.liveInfo={name:"",tag:"",roomId:"",userId:"",audioType:LiveEnum.AudioType.singleuser,videoType:LiveEnum.VideoType.mainflow,publishurl:"",rtmpurl:"",hlsurl:""}};return e.prototype.createUserLive=function(e,t){var r=when.defer();if(!t){o=new n(ErrorConstant.params_require);return r.reject(o),r.promise}if(""==t.roomId){var o=new n(ErrorConstant.roomId_required);return r.reject(o),r.promise}if(""!=t.userId)return this.liveRestServer.createUserLive(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise;var o=new n(ErrorConstant.userId_required);return r.reject(o),r.promise},e.prototype.stopLive=function(e,t){var r=when.defer();return this.liveRestServer.stopLive(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.getLive=function(e,t){var r=when.defer();return this.liveRestServer.getLive(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.deleteLive=function(e,t){var r=when.defer();return this.liveRestServer.deleteLive(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.findLives=function(e,t,r,o){var n=when.defer();return this.liveRestServer.findLives(this.restServerURI,e,t,r,o).then(function(e){n.resolve(e)}).otherwise(function(e){n.reject(e)}),n.promise},e}),ModuleBase.define("LiveRestServer",["Error"],function(l){var e=function(){};return e.prototype.createUserLive=function(e,t,r){var o=when.defer(),n=document.location.protocol;"httpsionic:"==n&&(n="https:");var i=n+"//"+e+"/avd/api/live/createUserLive?accessToken="+t,a={params:r};return this.fetchGet(i,a).then(function(e){if(e&&0==e.result)o.resolve(e.data);else{var t=new l(e.result,e.err);o.reject(t)}}).catch(function(e){e=new l(e.code,e.message);return o.reject(e),!1}),o.promise},e.prototype.stopLive=function(e,t,r){var o=when.defer(),n=document.location.protocol;"httpsionic:"==n&&(n="https:");var i=n+"//"+e+"/avd/api/live/stop",a={params:{accessToken:t,id:r}};return this.fetchGet(i,a).then(function(e){if(e&&0==e.result)o.resolve(e.data);else{var t=new l(e.result,e.err);o.reject(t)}}).catch(function(e){e=new l(e.code,e.message);return o.reject(e),!1}),o.promise},e.prototype.getLive=function(e,t,r){var o=when.defer(),n=document.location.protocol;"httpsionic:"==n&&(n="https:");var i=n+"//"+e+"/avd/api/live/getLive",a={params:{accessToken:t,id:r}};return this.fetchGet(i,a).then(function(e){if(e&&0==e.result)o.resolve(e.data);else{var t=new l(e.result,e.err);o.reject(t)}}).catch(function(e){e=new l(e.code,e.message);return o.reject(e),!1}),o.promise},e.prototype.deleteLive=function(e,t,r){var o=when.defer(),n=document.location.protocol;"httpsionic:"==n&&(n="https:");var i=n+"//"+e+"/avd/api/live/delete",a={params:{accessToken:t,id:r}};return this.fetchGet(i,a).then(function(e){if(e&&0==e.result)o.resolve(e.data);else{var t=new l(e.result,e.err);o.reject(t)}}).catch(function(e){e=new l(e.code,e.message);return o.reject(e),!1}),o.promise},e.prototype.findLives=function(e,t,r,o,n){var i=when.defer(),a=document.location.protocol;"httpsionic:"==a&&(a="https:");var s=a+"//"+e+"/avd/api/live/findLives",d={params:{begin:r,count:o,filter:n,accessToken:t}};return this.fetchGet(s,d).then(function(e){if(e&&0==e.result)i.resolve(e.data);else{var t=new l(e.result,e.err);i.reject(t)}}).catch(function(e){e=new l(e.code,e.message);return i.reject(e),!1}),i.promise},e.prototype.fetchGet=function(e,t){return new Promise(function(r,o){axios.get(e,t).then(function(e){if(0===e.data.result)r(e.data);else{var t={code:e.data.result,message:e.data.err};o(t)}}).catch(function(e){if(e.response){var t=new l(e.response.status,e.response.data);o(t)}else{t=new l(1e4,e.message);o(t)}o(e)})})},e.prototype.fetchPost=function(e,t){return new Promise(function(r,o){axios.post(e,t).then(function(e){if(0===e.data.result)r(e.data);else{var t={code:e.data.result,message:e.data.err};o(t)}}).catch(function(e){if(e.response){var t=new l(e.response.status,e.response.data);o(t)}else{t=new l(1e4,e.message);o(t)}o(e)})})},e}),ModuleBase.define("Board",["Annotation","Error"],function(r,e){var t=function(e,t,r,o,n,i,a,s,d,l){this.id=Math.uuid(),this.status=boardStatusEnum.close,this.title=i||"",this.description=d||"",this.extendData=l||"",this.userId=e,this.width=t,this.height=r,this.backgroundColor=o,this.backgroundImage=n,this.annotation,this.outputWidth=t,a&&(this.outputWidth=a),this.outputHeight=r,s&&(this.outputHeight=s),this.inputWidth=t,this.inputHeight=r,room.boardOutputXRatio=this.outputWidth/this.width,room.boardOutputYRatio=this.outputHeight/this.height,room.boardInputXRatio=this.width/this.outputWidth,room.boardInputYRatio=this.height/this.outputHeight};return t.prototype.setRenderWidthAndHeight=function(e,t){this.width=e,this.height=t,room.boardInputXRatio=this.width/this.inputWidth,room.boardInputYRatio=this.height/this.inputHeight,room.boardOutputXRatio=this.inputWidth/this.width,room.boardOutputYRatio=this.inputHeight/this.height},t.prototype.setBoardId=function(e){this.id=e},t.prototype.updateBackgroundImage=function(e){this.backgroundImage=e},t.prototype.updateBackgroundColor=function(e){this.backgroundColor=e},t.prototype.updateWidthAndHeight=function(e,t){this.width=e,this.height=t},t.prototype.createAnnotation=function(){var e=when.defer();if(this.annotation)e.reject();else{var t=new r(this.id);this.annotation=t,e.resolve(this.annotation)}return e.promise},t.prototype.updateAnnotation=function(){},t.prototype.removeAnnotation=function(){this.annotation=null},t.prototype.getAnnotation=function(){return this.annotation},t}),ModuleBase.define("Annotation",["Error"],function(e){var r=function(e){this.boardId=e,this.shapeType=shapeTypeEnum.mouse,this.color="rgba(0,0,0,1)",this.lineWidth=2,this.arrowLength=10,this.arrowtype=arrowTypeEnum.end,this.fillType=fillTypeEnum.none,this.fillColor="none",this.shapeArray=[],this.redoArray=[],this.undoArray=[],this.zr=null,this.annoDiv=null,this.currentIndex=-1,this.drawOrEraser=annoSelectTypeEnum.draw,this.isEraser=!1,this.eraserShape=null,this.eraserImageWidth=32,this.eraserImageHeight=32,this.otherShapeMap={},this.screenSize={width:0,height:0},this.hlightPointInfo={imgUrl:"",width:"",height:"",intervalTime:200,isSend:!0},this.hlightPointShape=null,this.textTagShape=null,this.arrowLineStartPoint={x:0,y:0},this.currentX=0,this.currentY=0,this.x=0,this.y=0,this.shapeData=[],this.rhombData=[],this.shapeObj={},this.shape=null},K=zrender.Path.extend({type:"Successright",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var r=t.x,o=t.y+t.height/3*2,n=t.x+t.width/2,i=t.y+t.height,a=t.x+t.width,s=t.y;e.moveTo(r,o),e.lineTo(n,i),e.lineTo(a,s)}}),X=zrender.Path.extend({type:"Failure",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var r=t.x,o=t.y,n=t.width,i=t.height,a=r-n/2,s=r+n/2,d=o-i/2,l=o+i/2;e.moveTo(a,d),e.lineTo(s,l),e.closePath(),e.moveTo(s,d),e.lineTo(a,l),e.closePath()}}),J=zrender.Path.extend({type:"Arrow",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var r=t.x,o=t.y+t.height/3,n=t.x,i=t.y+t.height/3*2,a=t.x+t.width/3*2,s=t.y+t.height/3*2,d=t.x+t.width/3*2,l=t.y+t.height,u=t.x+t.width,c=t.y+t.height/2,p=t.x+t.width/3*2,h=t.y,f=t.x+t.width/3*2,m=t.y+t.height/3;e.moveTo(r,o),e.lineTo(n,i),e.lineTo(a,s),e.lineTo(d,l),e.lineTo(u,c),e.lineTo(p,h),e.lineTo(f,m),e.closePath()}}),Q=zrender.Path.extend({type:"Texttag",shape:{x:0,y:0,width:0,height:0},buildPath:function(e,t){var r=t.x,o=t.y+t.height/4,n=t.x,i=t.y+t.height/4*3,a=t.x+t.width/5*4,s=t.y+t.height/4*3,d=t.x+t.width/5*4,l=t.y+t.height,u=t.x+t.width,c=t.y+t.height/2,p=t.x+t.width/5*4,h=t.y,f=t.x+t.width/5*4,m=t.y+t.height/4;e.moveTo(r,o),e.lineTo(n,i),e.lineTo(a,s),e.lineTo(d,l),e.lineTo(u,c),e.lineTo(p,h),e.lineTo(f,m),e.closePath()}});function $(e){return"rgba("+e.r+","+e.g+","+e.b+","+parseFloat(e.a/255)+")"}return r.prototype.init=function(e){var D=this;if(D.annoDiv=e,D.zr=zrender.init(D.annoDiv),"100%"==D.annoDiv.style.width){var t=D.annoDiv.firstChild;D.screenSize.width=parseInt(t.style.width),D.screenSize.height=parseInt(t.style.height),log.debug("===Annotation.init(),childDiv.style.width:"+t.style.width+",childDiv.style.height:"+t.style.height)}else D.screenSize.width=parseInt(D.annoDiv.style.width),D.screenSize.height=parseInt(D.annoDiv.style.height),log.debug("===Annotation.init(),annoDiv.style.width:"+e.style.width+",annoDiv.style.height:"+e.style.height);function i(e){if(D.shapeType==shapeTypeEnum.eraser&&D.isEraser)for(var t in D.shapeArray)D.shapeArray[t].shape.id==e.target.id&&(D.zr.remove(D.shapeArray[t].shape),room.sendRemoveAnnotation(D.boardId,D.shapeType,D.shapeArray[t].shape.id),D.undoArray.push({type:"delete",shapeObj:D.shapeArray[t]}),D.shapeArray.splice(t,1))}D.annoDiv.onmousedown=function(e){if(D.shapeType!=shapeTypeEnum.mouse&&D.shapeType!=shapeTypeEnum.hlight_point){D.shapeType==shapeTypeEnum.eraser&&(D.isEraser=!0);var r,o;D.currentX=e.clientX-this.getBoundingClientRect().left,D.currentY=e.clientY-this.getBoundingClientRect().top,shapeData=[],shapeData.push([D.currentX,D.currentY]);var n=null;switch(D.shapeType){case shapeTypeEnum.failure:n=new X({shape:{x:D.currentX,y:D.currentY,width:20,height:20},style:{stroke:D.color,lineWidth:D.lineWidth},onmouseover:i});break;case shapeTypeEnum.success:n=new K({shape:{x:D.currentX-10,y:D.currentY-10,width:20,height:20},style:{stroke:D.color,fill:"none",lineWidth:D.lineWidth},onmouseover:i});break;case shapeTypeEnum.arrow:n=new J({shape:{x:D.currentX-15,y:D.currentY-10,width:30,height:20},style:{stroke:D.color,fill:D.fillColor,lineWidth:D.lineWidth},onmouseover:i});break;case shapeTypeEnum.hlight_texttag:D.textTagShape?D.textTagShape.attr({shape:{x:D.currentX-40,y:D.currentY-20},style:{text:room.selfUser.name}}):(D.textTagShape=new Q({shape:{x:D.currentX-40,y:D.currentY-20,width:80,height:40},style:{stroke:"red",fill:"red",text:room.selfUser.name,truncate:{outerWidth:50},lineWidth:D.lineWidth},onmouseover:i}),D.textTagShape.id=Math.uuid(),D.zr.add(D.textTagShape)),room.sendAddAnnotation(D.boardId,D.textTagShape,D.shapeType,D.color,D.lineWidth,D.arrowtype,D.fillType);break;case shapeTypeEnum.rhomb:n=new zrender.Polygon({shape:{points:[],smooth:0},style:{stroke:D.color,fill:"none",lineWidth:D.lineWidth},onmouseover:i});break;case shapeTypeEnum.line:n=new zrender.Arrowline({shape:{x1:D.currentX,y1:D.currentY,x2:D.currentX,y2:D.currentY,arrowlength:10,arrowtype:D.arrowtype},style:{stroke:D.color,lineWidth:D.lineWidth},onmouseover:i});break;case shapeTypeEnum.polyline:n=new zrender.Polyline({shape:{points:[],smooth:0},style:{stroke:D.color,lineWidth:D.lineWidth},onmouseover:i});break;case shapeTypeEnum.rect:n=new zrender.Rect({shape:{x:D.currentX,y:D.currentY},style:{stroke:D.color,fill:D.fillColor,lineWidth:D.lineWidth},onmouseover:i});break;case shapeTypeEnum.ellipse:n=new zrender.Ellipse({shape:{cx:D.currentX,cy:D.currentY,rx:0,ry:0},style:{stroke:D.color,fill:D.fillColor,lineWidth:D.lineWidth},onmouseover:i})}n&&(n.id=Math.uuid(),D.zr.add(n),D.annoDiv.onmousemove=function(e){if(D.shapeType!=shapeTypeEnum.eraser){r=e.clientX-this.getBoundingClientRect().left,o=e.clientY-this.getBoundingClientRect().top,shapeData.push([r,o]);var t=[[D.currentX,D.currentY+(o-D.currentY)/2],[D.currentX+(r-D.currentX)/2,o],[r,D.currentY+(o-D.currentY)/2],[D.currentX+(r-D.currentX)/2,D.currentY]];switch(D.shapeType){case shapeTypeEnum.rhomb:n.attr("shape",{points:t});break;case shapeTypeEnum.line:n.attr("shape",{x2:r,y2:o});break;case shapeTypeEnum.polyline:n.attr("shape",{points:shapeData});break;case shapeTypeEnum.rect:n.attr("shape",{width:r-D.currentX,height:o-D.currentY});break;case shapeTypeEnum.ellipse:n.attr("shape",{cx:r+(D.currentX-r)/2,cy:o+(D.currentY-o)/2,rx:Math.abs(r-D.currentX)/2,ry:Math.abs(o-D.currentY)/2})}}},D.annoDiv.onmouseup=function(){if(D.annoDiv.onmousemove=null,D.annoDiv.onmouseup=null,D.annoDiv.onmouseleave=null,D.shapeType!=shapeTypeEnum.eraser){var e={shape:n,shapeType:D.shapeType,color:D.color,lineWidth:D.lineWidth,arrowtype:D.arrowtype,fillType:D.fillType};D.shapeArray.push(e),D.undoArray.push({type:"add",shapeObj:e}),D.redoArray=[],room.sendAddAnnotation(D.boardId,n,D.shapeType,D.color,D.lineWidth,D.arrowtype,D.fillType)}else D.isEraser=!1},D.annoDiv.onmouseleave=function(){if(D.annoDiv.onmousemove=null,D.annoDiv.onmouseup=null,D.annoDiv.onmouseleave=null,D.shapeType!=shapeTypeEnum.eraser){parseInt(D.annoDiv.style.width),parseInt(D.annoDiv.style.height);D.shapeArray.push({shape:n,shapeType:D.shapeType,color:D.color,lineWidth:D.lineWidth,arrowtype:D.arrowtype,fillType:D.fillType}),D.redoArray=[],room.sendAddAnnotation(D.boardId,n,D.shapeType,D.color,D.lineWidth,D.arrowtype,D.fillType)}else D.isEraser=!1})}},D.annoDiv.ontouchstart=function(e){if(e.preventDefault(),D.shapeType!=shapeTypeEnum.mouse&&D.shapeType!=shapeTypeEnum.hlight_point&&(D.currentX=e.touches[0].clientX-this.getBoundingClientRect().left,D.currentY=e.touches[0].clientY-this.getBoundingClientRect().top,D.shapeType!=shapeTypeEnum.eraser)){switch(D.arrowLineStartPoint.x=e.touches[0].clientX-this.getBoundingClientRect().left,D.arrowLineStartPoint.y=e.touches[0].clientY-this.getBoundingClientRect().top,D.shapeData=[],D.shapeData.push([D.currentX,D.currentY]),D.shapeType){case shapeTypeEnum.failure:D.shape=new X({shape:{x:D.currentX,y:D.currentY,width:20,height:20},style:{stroke:D.color,lineWidth:D.lineWidth}});break;case shapeTypeEnum.success:D.shape=new K({shape:{x:D.currentX-10,y:D.currentY-10,width:20,height:20},style:{stroke:D.color,fill:"none",lineWidth:D.lineWidth}});break;case shapeTypeEnum.arrow:D.shape=new J({shape:{x:D.currentX-15,y:D.currentY-10,width:30,height:20},style:{stroke:D.color,fill:D.fillColor,lineWidth:D.lineWidth}});break;case shapeTypeEnum.hlight_texttag:D.textTagShape?D.textTagShape.attr({shape:{x:D.currentX-40,y:D.currentY-20},style:{text:room.selfUser.name}}):(D.textTagShape=new Q({shape:{x:D.currentX-40,y:D.currentY-20,width:80,height:40},style:{stroke:"red",fill:"red",text:room.selfUser.name,truncate:{outerWidth:50},lineWidth:D.lineWidth}}),D.textTagShape.id=Math.uuid(),D.zr.add(D.textTagShape)),room.sendAddAnnotation(D.boardId,D.textTagShape,D.shapeType,D.color,D.lineWidth,D.arrowtype,D.fillType),D.shape&&(D.shape=null);break;case shapeTypeEnum.rhomb:D.shape=new zrender.Polygon({shape:{points:[],smooth:0},style:{stroke:D.color,fill:"none",lineWidth:D.lineWidth}});break;case shapeTypeEnum.line:D.shape=new zrender.Arrowline({shape:{arrowlength:10,arrowtype:D.arrowtype},style:{stroke:D.color,lineWidth:D.lineWidth}});break;case shapeTypeEnum.polyline:D.shape=new zrender.Polyline({shape:{points:[],smooth:0},style:{stroke:D.color,lineWidth:D.lineWidth}});break;case shapeTypeEnum.rect:D.shape=new zrender.Rect({shape:{x:D.currentX,y:D.currentY},style:{stroke:D.color,fill:D.fillColor,lineWidth:D.lineWidth}});break;case shapeTypeEnum.ellipse:D.shape=new zrender.Ellipse({shape:{cx:D.currentX,cy:D.currentY,rx:0,ry:0},style:{stroke:D.color,fill:D.fillColor,lineWidth:D.lineWidth}})}if(D.shape){if(D.shape.id=Math.uuid(),D.shapeType==shapeTypeEnum.success||D.shapeType==shapeTypeEnum.failure||D.shapeType==shapeTypeEnum.arrow){var t={shape:D.shape,shapeType:D.shapeType,color:D.color,lineWidth:D.lineWidth,arrowtype:D.arrowtype,fillType:D.fillType};D.shapeArray.push(t),D.undoArray.push({type:"add",shapeObj:t}),room.sendAddAnnotation(D.boardId,D.shape,D.shapeType,D.color,D.lineWidth,D.arrowtype,D.fillType)}D.zr.add(D.shape)}}},D.annoDiv.ontouchmove=function(e){if(D.x=e.touches[0].clientX-this.getBoundingClientRect().left,D.y=e.touches[0].clientY-this.getBoundingClientRect().top,D.shapeType!=shapeTypeEnum.eraser){D.shapeData.push([D.x,D.y]);var t=[[D.currentX,D.currentY+(D.y-D.currentY)/2],[D.currentX+(D.x-D.currentX)/2,D.y],[D.x,D.currentY+(D.y-D.currentY)/2],[D.currentX+(D.x-D.currentX)/2,D.currentY]];switch(D.shapeType){case shapeTypeEnum.rhomb:D.shape.attr("shape",{points:t});break;case shapeTypeEnum.line:D.arrowLineStartPoint.x,D.arrowLineStartPoint.y,D.x,D.y;D.shape.attr("shape",{x1:D.arrowLineStartPoint.x,y1:D.arrowLineStartPoint.y,x2:D.x,y2:D.y});break;case shapeTypeEnum.polyline:D.shape.attr("shape",{points:D.shapeData});break;case shapeTypeEnum.rect:D.shape.attr("shape",{width:D.x-D.currentX,height:D.y-D.currentY});break;case shapeTypeEnum.ellipse:D.shape.attr("shape",{cx:D.x+(D.currentX-D.x)/2,cy:D.y+(D.currentY-D.y)/2,rx:Math.abs(D.x-D.currentX)/2,ry:Math.abs(D.y-D.currentY)/2});break;case shapeTypeEnum.hlight_point:g=D.hlightPointInfo.width,v=D.hlightPointInfo.height,r=D.x-g/2,o=D.y-v/2;D.hlightPointShape.attr("position",[r,o]),D.hlightPointInfo.isSend&&(D.hlightPointInfo.isSend=!1,room.sendAddAnnotation(D.boardId,D.hlightPointShape,shapeTypeEnum.hlight_point,D.color,D.lineWidth,D.arrowtype,D.fillType),setTimeout(function(){D.hlightPointInfo.isSend=!0},D.hlightPointInfo.intervalTime))}}else{D.isEraser=!0;var r=D.x-D.eraserImageWidth/2,o=D.y-D.eraserImageHeight/2;for(var n in D.eraserShape&&D.eraserShape.attr("position",[r,o]),D.shapeArray){var i=D.shapeArray[n];switch(i.shapeType){case shapeTypeEnum.line:var a=i.shape.shape,s=a.x1,d=a.x2,l=a.y1,u=a.y2;s<d&&l<u?D.x>=s&&D.x<=d&&D.y>=l&&D.y<=u&&D.excuteRemoveAnnotation(i):d<s&&l<u?D.x>=d&&D.x<=s&&D.y>=l&&D.y<=u&&D.excuteRemoveAnnotation(i):s<d&&u<l?D.x>=s&&D.x<=d&&D.y>=u&&D.y<=l&&D.excuteRemoveAnnotation(i):d<s&&u<l&&D.x>=d&&D.x<=s&&D.y>=u&&D.y<=l&&D.excuteRemoveAnnotation(i);break;case shapeTypeEnum.polyline:var c=D.shapeArray[n].shape.shape.points,p=D.x-D.eraserImageWidth/2,h=D.x+D.eraserImageWidth/2,f=D.y-D.eraserImageWidth/2,m=D.y+D.eraserImageWidth/2;0<c.length&&c.forEach(function(e){var t=e[0],r=e[1];p<=t&&t<=h&&f<=r&&r<=m&&D.excuteRemoveAnnotation(i)});break;case shapeTypeEnum.success:var g=i.shape.shape.width,v=i.shape.shape.height,y=i.shape.shape.x,b=i.shape.shape.y;D.x>=y&&D.x<=y+g&&D.y>=b&&D.y<=b+v&&D.excuteRemoveAnnotation(i);break;case shapeTypeEnum.failure:var g=i.shape.shape.width,v=i.shape.shape.height,_=i.shape.shape.x,w=i.shape.shape.y;D.x>=_&&D.x<=_+g&&D.y>=w&&D.y<=w+v&&D.excuteRemoveAnnotation(i);break;case shapeTypeEnum.rhomb:var S=i.shape.shape.points[0],E=i.shape.shape.points[1],I=i.shape.shape.points[2],T=i.shape.shape.points[3];s=S[0],d=I[0],l=E[1],u=T[1];if(D.x>=s&&D.x<=d&&D.y>=l&&D.y<=u){D.excuteRemoveAnnotation(i);break}if(D.x<=s&&D.x>=d&&D.y>=l&&D.y<=u){D.excuteRemoveAnnotation(i);break}if(D.x>=s&&D.x<=d&&D.y<=l&&D.y>=u){D.excuteRemoveAnnotation(i);break}if(D.x<=s&&D.x>=d&&D.y<=l&&D.y>=u){D.excuteRemoveAnnotation(i);break}break;case shapeTypeEnum.arrow:g=i.shape.shape.width,v=i.shape.shape.height;var R=i.shape.shape.x,C=i.shape.shape.y;D.x>=R&&D.x<=R+g&&D.y>=C&&D.y<=C+v&&D.excuteRemoveAnnotation(i);break;case shapeTypeEnum.ellipse:var P=i.shape.shape.cx,M=i.shape.shape.cy,x=i.shape.shape.rx,A=i.shape.shape.ry;D.x>=P-x&&D.x<=P+x&&D.y>=M-A&&D.y<=M+A&&D.excuteRemoveAnnotation(i);break;case shapeTypeEnum.rect:var k=i.shape.shape.width,O=i.shape.shape.height,U=i.shape.shape.x,L=i.shape.shape.y;0<=k&&0<=O?D.x>=U&&D.x<=U+k&&D.y>=L&&D.y<=L+O&&D.excuteRemoveAnnotation(i):k<=0&&0<=O?D.x>=U+k&&D.x<=U&&D.y>=L&&D.y<=L+O&&D.excuteRemoveAnnotation(i):0<=k&&O<=0?D.x>=U&&D.x<=U+k&&D.y>=L+O&&D.y<=L&&D.excuteRemoveAnnotation(i):k<=0&&O<=0&&D.x>=U+k&&D.x<=U&&D.y>=L+O&&D.y<=L&&D.excuteRemoveAnnotation(i)}}}},D.annoDiv.ontouchend=function(){if(D.shapeType!=shapeTypeEnum.hlight_texttag&&D.shapeType!=shapeTypeEnum.mouse&&D.shapeType!=shapeTypeEnum.success&&D.shapeType!=shapeTypeEnum.failure&&D.shapeType!=shapeTypeEnum.arrow)if(D.shapeType!=shapeTypeEnum.eraser){var e={shape:D.shape,shapeType:D.shapeType,color:D.color,lineWidth:D.lineWidth,arrowtype:D.arrowtype,fillType:D.fillType};D.shapeArray.push(e),D.redoArray=[],D.shapeType!=shapeTypeEnum.hlight_point&&(D.undoArray.push({type:"add",shapeObj:e}),room.sendAddAnnotation(D.boardId,D.shape,D.shapeType,D.color,D.lineWidth,D.arrowtype,D.fillType))}else D.isEraser=!1},r.prototype.excuteRemoveAnnotation=function(r){var o=this;o.zr.remove(r.shape),room.sendRemoveAnnotation(o.boardId,o.shapeType,r.shape.id),o.shapeArray.forEach(function(e,t){e.shape.id==r.shape.id&&(o.undoArray.push({type:"delete",shapeObj:e}),o.shapeArray.splice(t,1))});var e=o.zr.storage._displayList;for(var t in e)e[t].id==r.shape.id&&o.zr.remove(e[t])}},r.prototype.initEraserShape=function(e){this.eraserShape=new zrender.Image({position:[0,0],scale:[1,1],style:{image:e,width:this.eraserImageWidth,height:this.eraserImageHeight},draggable:!0}),this.zr.add(this.eraserShape),this.eraserShape.id=Math.uuid()},r.prototype.removeToBoard=function(e){log.debug("===annotation removeToBoard");var t=this,r="userId"+e.operUserId;if(e.annotationType==shapeTypeEnum.clear){if(e.operUserId==room.selfUser.id){for(var o in t.shapeArray)t.zr.remove(t.shapeArray[o].shape);t.shapeArray=[]}else for(var o in t.otherShapeMap)if(o==r)for(var n in t.otherShapeMap[o])t.zr.remove(t.otherShapeMap[o][n].shape);delete t.otherShapeMap[r]}else if(e.annotationType==shapeTypeEnum.eraser)if(t.hlightPointShape&&t.hlightPointShape.id==e.annotationId)t.clearCurrHlightPoint();else if(t.textTagShape&&t.textTagShape.id==e.annotationId)t.clearCurrHlightPoint();else if(e.operUserId==room.selfUser.id)for(var o in t.shapeArray)t.shapeArray[o].shape.id==e.annotationId&&(t.zr.remove(t.shapeArray[o].shape),t.shapeArray.splice(o,1));else{for(var o in t.otherShapeMap)if(o==r)for(var n in t.otherShapeMap[o])t.otherShapeMap[o][n].id==e.annotationId&&t.zr.remove(t.otherShapeMap[o][n].shape);var i=t.zr.storage._displayList;for(var a in i)i[a].id==e.annotationId&&t.zr.remove(i[a])}},r.prototype.drawToBoard=function(e){var n=this,t=parseInt(e.objectBase.type),r=parseInt(e.objectBase.lineWidth),o=parseInt(e.objectBase.arrow),i=$(e.objectBase.lineColor),a=$(e.objectBase.fillColor),s=null;switch(t){case shapeTypeEnum.rhomb:var d=e.start.x,l=e.start.y,u=e.end.x,c=e.end.y;log.debug("===annotation.drawToBoard(),room.boardInputXRatio:"+room.boardInputXRatio+",room.boardInputYRatio:"+room.boardInputYRatio),log.debug("===annotation.drawToBoard(),shapeTypeEnum.rhomb,currentX:",d+",currentY:",l+",x:"+u+",y:"+c);var p=Math.round(d*room.boardInputXRatio),h=Math.round(l*room.boardInputYRatio),f=Math.round(u*room.boardInputXRatio),m=Math.round(c*room.boardInputYRatio);log.debug("===annotation.drawToBoard(),ishapeTypeEnum.rhomb,nputCurrentX:",p+",inputCurrentY:",h+",inputX:"+f+",inputY:"+m);var g=[[p,h+(m-h)/2],[p+(f-p)/2,m],[f,h+(m-h)/2],[p+(f-p)/2,h]];s=new zrender.Polygon({shape:{points:g,smooth:0},style:{stroke:i,fill:"none",lineWidth:r},onmouseover:z});break;case shapeTypeEnum.line:var v=e.start.x,y=e.start.y,b=e.end.x,_=e.end.y;log.debug("===annotation.drawToBoard(),shapeTypeEnum.line,x1:",v+",y1:",y+",x2:"+b+",y2:"+_);var w=Math.round(v*room.boardInputXRatio),S=Math.round(y*room.boardInputYRatio),E=Math.round(b*room.boardInputXRatio),I=Math.round(_*room.boardInputYRatio);log.debug("===annotation.drawToBoard(),shapeTypeEnum.line,inputx1:",w+",inputy1:",S+",inputx2:"+E+",inputy2:"+I),s=new zrender.Arrowline({shape:{x1:w,y1:S,x2:E,y2:I,arrowlength:10,arrowtype:o},style:{stroke:i,lineWidth:r},onmouseover:z});break;case shapeTypeEnum.failure:u=e.start.x,c=e.start.y;var T=e.end.x-e.start.x,R=e.end.y-e.start.y;log.debug("===annotation.drawToBoard(),shapeTypeEnum.failure,x:",u+",y:",c+",width:"+T+",height:"+R);f=Math.round(u*room.boardInputXRatio),m=Math.round(c*room.boardInputYRatio);var C=Math.round(T*room.boardInputXRatio),P=Math.round(R*room.boardInputYRatio);log.debug("===annotation.drawToBoard(),shapeTypeEnum.failure,inputX:",f+",inputY:",m+",inputWidth:"+C+",inputHeight:"+P),s=new X({shape:{x:f,y:m,width:C,height:P},style:{stroke:i,lineWidth:r},onmouseover:z});break;case shapeTypeEnum.success:u=e.start.x,c=e.start.y,T=e.end.x-e.start.x,R=e.end.y-e.start.y;log.debug("===annotation.drawToBoard(),shapeTypeEnum.success,x:",u+",y:",c+",width:"+T+",height:"+R);f=Math.round(u*room.boardInputXRatio),m=Math.round(c*room.boardInputYRatio),C=Math.round(T*room.boardInputXRatio),P=Math.round(R*room.boardInputYRatio);log.debug("===annotation.drawToBoard(),shapeTypeEnum.success,inputX:",f+",inputY:",m+",inputWidth:"+C+",inputHeight:"+P),s=new K({shape:{x:f,y:m,width:C,height:P},style:{stroke:i,fill:"none",lineWidth:r},onmouseover:z});break;case shapeTypeEnum.arrow:u=e.start.x,c=e.start.y,T=e.end.x-e.start.x,R=e.end.y-e.start.y;log.debug("===annotation.drawToBoard(),shapeTypeEnum.arrow,x:",u+",y:",c+",width:"+T+",height:"+R);f=Math.round(u*room.boardInputXRatio),m=Math.round(c*room.boardInputYRatio),C=Math.round(T*room.boardInputXRatio),P=Math.round(R*room.boardInputYRatio);log.debug("===annotation.drawToBoard(),shapeTypeEnum.arrow,inputX:",f+",inputY:",m+",inputWidth:"+C+",inputHeight:"+P),s=new J({shape:{x:f,y:m,width:C,height:P},style:{stroke:i,fill:a,lineWidth:r},onmouseover:z});break;case shapeTypeEnum.hlight_texttag:var M=room.getUser(e.objectBase.ownerUserId);u=e.start.x,c=e.start.y,T=e.end.x-e.start.x,R=e.end.y-e.start.y;log.debug("===annotation.drawToBoard(),shapeTypeEnum.hlight_texttag,x:",u+",y:",c+",width:"+T+",height:"+R);f=Math.round(u*room.boardInputXRatio),m=Math.round(c*room.boardInputYRatio),C=Math.round(T*room.boardInputXRatio),P=Math.round(R*room.boardInputYRatio);if(log.debug("===annotation.drawToBoard(),shapeTypeEnum.hlight_texttag,inputX:",f+",inputY:",m+",inputWidth:"+C+",inputHeight:"+P),!M)return;n.textTagShape?n.textTagShape.attr({shape:{x:f,y:m},style:{text:M.name}}):(n.textTagShape=new Q({shape:{x:f,y:m,width:C,height:P},style:{stroke:"red",fill:"red",text:M.name,truncate:{outerWidth:50},lineWidth:r},onmouseover:z}),n.zr.add(n.textTagShape),n.textTagShape.id=e.objectBase.annotationId);break;case shapeTypeEnum.polyline:var x=[];for(var A in console.log("===annotation.drawToBoard(),shapeTypeEnum.polyline,points",x),e.points){u=e.points[A].x,c=e.points[A].y;var k=[f=Math.round(u*room.boardInputXRatio),m=Math.round(c*room.boardInputYRatio)];x.push(k)}s=new zrender.Polyline({shape:{points:x,smooth:0},style:{stroke:i,lineWidth:r},onmouseover:z});break;case shapeTypeEnum.rect:console.log("===kw9999990000000");u=e.start.x,c=e.start.y,T=e.end.x-e.start.x,R=e.end.y-e.start.y;log.debug("===annotation.drawToBoard(),shapeTypeEnum.rect,x:",u+",y:",c+",width:"+T+",height:"+R);f=Math.round(u*room.boardInputXRatio),m=Math.round(c*room.boardInputYRatio),C=Math.round(T*room.boardInputXRatio),P=Math.round(R*room.boardInputYRatio);log.debug("===annotation.drawToBoard(),shapeTypeEnum.rect,inputX:",f+",inputY:",m+",inputWidth:"+C+",inputHeight:"+P),s=new zrender.Rect({shape:{x:f,y:m,width:C,height:P},style:{stroke:i,fill:a,lineWidth:r},onmouseover:z});break;case shapeTypeEnum.ellipse:var O=e.start.x,U=e.end.x,L=e.start.y,D=e.end.y;log.debug("===annotation.drawToBoard(),shapeTypeEnum.ellipse,startX :",O+",endX:",U+",startY:"+L+",endY:"+D);var N=Math.round(O*room.boardInputXRatio),B=Math.round(U*room.boardInputXRatio),j=Math.round(L*room.boardInputYRatio),V=Math.round(D*room.boardInputYRatio);log.debug("===annotation.drawToBoard(),shapeTypeEnum.ellipse,inputStartX :",N+",inputEndX:",B+",inputStartY:"+j+",inputEndY:"+V);var F=(B-N)/2,q=(V-j)/2,G=N+F,H=j+q;s=new zrender.Ellipse({shape:{cx:G,cy:H,rx:F,ry:q},style:{stroke:i,fill:a,lineWidth:r},onmouseover:z});break;case shapeTypeEnum.hlight_point:u=e.start.x,c=e.start.y,T=n.hlightPointInfo.width,R=n.hlightPointInfo.height;console.log("===annotation.drawToBoard(),shapeTypeEnum.hlight_point,x:",u+",y:",c+",width:"+T+",height:"+R);f=Math.round(u*room.boardInputXRatio),m=Math.round(c*room.boardInputYRatio),C=Math.round(T*room.boardInputXRatio),P=Math.round(R*room.boardInputYRatio);log.debug("===annotation.drawToBoard(),shapeTypeEnum.hlight_point,inputX:",f+",inputY:",m+",inputWidth:"+C+",inputHeight:"+P),n.hlightPointShape?n.hlightPointShape.attr("position",[f-C/2,m-P/2]):(n.hlightPointShape=new zrender.Image({position:[f,m],scale:[1,1],style:{image:n.hlightPointInfo.imgUrl,width:C,height:P},draggable:!0}),n.zr.add(n.hlightPointShape),n.hlightPointShape.id=e.objectBase.annotationId)}if(s){var W={id:e.objectBase.annotationId,shape:s};if(n.zr.add(s),s.id=e.objectBase.annotationId,e.objectBase.ownerUserId==room.selfUser.id)n.shapeArray.push({shape:s,shapeType:t,color:i,lineWidth:r,arrowtype:o,fillType:fillTypeEnum.none});else{var Y="userId"+e.objectBase.ownerUserId;n.otherShapeMap[Y]||(n.otherShapeMap[Y]=[]),n.otherShapeMap[Y].push(W)}}function z(e){if(n.shapeType==shapeTypeEnum.eraser&&n.isEraser)for(var t in n.shapeArray)if(n.shapeArray[t].shape.id==e.target.id){n.zr.remove(n.shapeArray[t].shape);var r=n.zr.storage._displayList;for(var o in r)r[o].id==e.target.id&&n.zr.remove(r[o]);room.sendRemoveAnnotation(n.boardId,n.shapeType,n.shapeArray[t].shape.id),n.shapeArray.splice(t,1)}}},r.prototype.setShapeType=function(e,t){var r=room.avdEngine.getBrowserDetect().osName;this.shapeType==shapeTypeEnum.hlight_point&&this.hlightPointShape&&this.clearCurrHlightPoint(),this.eraserShape&&this.clearCurrEraser(),(e==shapeTypeEnum.eraser&&t&&"Android"==r||"iOS"==r)&&this.initEraserShape(t),this.shapeType==shapeTypeEnum.hlight_texttag&&this.textTagShape&&this.clearCurrHlightPoint();var o="";t&&(o="url("+t+"),auto"),this.zr.handler.proxy.cursor=o||"default",this.shapeType=parseInt(e)},r.prototype.clearCurrEraser=function(){console.log("+++SDK clear eraser"),this.eraserShape&&(this.zr.remove(this.eraserShape),this.eraserShape=null)},r.prototype.setColor=function(e){this.color=e,"none"!=this.fillColor&&(this.fillColor=e)},r.prototype.setColorOpacity=function(e){var t=this.color.split(",");t[t.length-1]=e+")";var r=t.join(",");console.log(r),this.color=r,"none"!=this.fillColor&&(this.fillColor=r)},r.prototype.setLineWidth=function(e){this.lineWidth=parseInt(e)},r.prototype.setArrowLength=function(e){this.arrowLength=parseInt(e)},r.prototype.setArrowType=function(e){this.arrowtype=parseInt(e)},r.prototype.download=function(e){var t=this.zr.dom.getElementsByTagName("canvas")[0];if(t){var r;if(e)e.getContext("2d").drawImage(t,0,0),r=e;else r=t;!function(e){var t=e.toDataURL("image/png");imgData=t.replace((r="png","image/"+(r=r.toLowerCase().replace(/jpg/i,"jpeg")).match(/png|jpeg|bmp|gif/)[0]),"image/octet-stream");var r;var o="_"+(new Date).getTime()+".png";!function(e,t){var r=document.createElementNS("http://www.w3.org/1999/xhtml","a");r.href=e,r.download=t;var o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(o)}(imgData,o)}(r)}},r.prototype.setFillColor=function(e){(this.fillType=e)==fillTypeEnum.none?this.fillColor="none":this.fillColor=this.color},r.prototype.clear=function(){for(var e in this.shapeArray)this.zr.remove(this.shapeArray[e].shape);this.shapeArray=[],room.sendRemoveAnnotation(this.boardId,shapeTypeEnum.clear,"")},r.prototype.undo=function(){if(!(this.undoArray.length<1)){var e=this.undoArray.pop();this.undoShape(e)}},r.prototype.undoShape=function(e){var r=this;switch(e.type){case"delete":r.zr.add(e.shapeObj.shape),r.shapeArray.push(e.shapeObj),room.sendAddAnnotation(r.boardId,e.shapeObj.shape,e.shapeObj.shapeType,e.shapeObj.color,e.shapeObj.lineWidth,e.shapeObj.arrowtype,e.shapeObj.fillType);break;case"add":r.zr.remove(e.shapeObj.shape),function(e){if(r.shapeArray.length<1)return;for(var t=0;t<r.shapeArray.length;t++)r.shapeArray[t].shape.id===e&&r.shapeArray.splice(t,1)}(e.shapeObj.shape.id),room.sendRemoveAnnotation(r.boardId,shapeTypeEnum.eraser,e.shapeObj.shape.id)}},r.prototype.redo=function(){if(!(this.redoArray.length<1)){var e=this.redoArray.pop();this.zr.add(e.shape),this.shapeArray.push(e),room.sendAddAnnotation(this.boardId,e.shape,e.shapeType,e.color,e.lineWidth,e.arrowtype,e.fillType)}},r.prototype.hlightPointInit=function(e,t,r,o){this.hlightPointInfo.imgUrl=e,this.hlightPointInfo.width=parseInt(t)?parseInt(t):this.hlightPointInfo.width,this.hlightPointInfo.height=parseInt(r)?parseInt(r):this.hlightPointInfo.height,this.hlightPointInfo.intervalTime=parseInt(o)?parseInt(o):this.hlightPointInfo.intervalTime},r.prototype.clearCurrHlightPoint=function(){var e=this;e.hlightPointShape&&(room.sendRemoveAnnotation(e.boardId,shapeTypeEnum.eraser,e.hlightPointShape.id),e.zr.remove(e.hlightPointShape),e.hlightPointShape=null),e.textTagShape&&(room.sendRemoveAnnotation(e.boardId,shapeTypeEnum.eraser,e.textTagShape.id),e.zr.remove(e.textTagShape),e.textTagShape=null)},r.prototype.startHlightPoint=function(){var o=this;o.setShapeType(shapeTypeEnum.hlight_point);var n=o.hlightPointInfo.width,i=o.hlightPointInfo.height;o.hlightPointShape=new zrender.Image({position:[-100,-100],scale:[1,1],style:{image:o.hlightPointInfo.imgUrl,width:o.hlightPointInfo.width,height:o.hlightPointInfo.height},draggable:!0}),o.zr.add(o.hlightPointShape),o.hlightPointShape.id=Math.uuid(),o.annoDiv.onmousemove=function(e){if(o.shapeType==shapeTypeEnum.hlight_point){x=e.clientX-this.getBoundingClientRect().left,y=e.clientY-this.getBoundingClientRect().top;var t=x-n/2,r=y-i/2;o.hlightPointShape.attr("position",[t,r]),o.hlightPointInfo.isSend&&(o.hlightPointInfo.isSend=!1,room.sendAddAnnotation(o.boardId,o.hlightPointShape,shapeTypeEnum.hlight_point,o.color,o.lineWidth,o.arrowtype,o.fillType),setTimeout(function(){o.hlightPointInfo.isSend=!0},o.hlightPointInfo.intervalTime))}}},r.prototype.changeScreen=function(e,t){if(this.zr&&0<this.shapeArray.length)for(var r in this.zr.resize(),this.shapeArray){var o=e/this.screenSize.width,n=t/this.screenSize.height;console.log("===Annotation.changeScreen(),x:"+o+",y:"+n),this.shapeArray[r].shape.animateTo({scale:[o,n]},function(){console.log("changeScreen")})}this.screenSize.width=e,this.screenSize.width=t},r}),ModuleBase.define("Outgoing",["OutgoingRestServer","Error"],function(t,l){var e=function(e){this.restServerURI=e,this.outgoingRestServer=new t};return e.prototype.createOutgoingUser=function(e,t,r,o,n,i,a){var s=when.defer();if(""==t){var d=new l(ErrorConstant.roomId_required);return s.reject(d),s.promise}if(""==r){d=new l(ErrorConstant.userId_required);return s.reject(d),s.promise}if(""!=n)return this.outgoingRestServer.createOutgoingUser(this.restServerURI,e,t,r,o,n,i,a).then(function(e){s.resolve(e)}).otherwise(function(e){s.reject(e)}),s.promise;d=new l(ErrorConstant.userAddress_require);return s.reject(d),s.promise},e.prototype.destroyOutgoingUser=function(e,t,r,o){var n=when.defer();return this.outgoingRestServer.destroyOutgoingUser(this.restServerURI,e,t,r,o).then(function(e){n.resolve(e)}).otherwise(function(e){n.reject(e)}),n.promise},e.prototype.getOutgoingUsers=function(e,t){var r=when.defer();return this.outgoingRestServer.getOutgoingUsers(this.restServerURI,e,t).then(function(e){r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e}),ModuleBase.define("OutgoingRestServer",["Error"],function(p){var e=function(){};return e.prototype.createOutgoingUser=function(e,t,r,o,n,i,a,s){var d=when.defer(),l=document.location.protocol;"httpsionic:"==l&&(l="https:");var u=l+"//"+e+"/avd/api/outgoing/createOutgoingUser",c={params:{roomId:r,userAddress:i,userId:o,accessToken:t,userName:n,userData:a,options:s}};return this.fetchGet(u,c).then(function(e){if(e&&0==e.result)d.resolve(e.data);else{var t=new p(e.result,e.err);d.reject(t)}}).catch(function(e){e=new p(e.code,e.message);return d.reject(e),!1}),d.promise},e.prototype.destroyOutgoingUser=function(e,t,r,o,n){var i=when.defer(),a=document.location.protocol;"httpsionic:"==a&&(a="https:");var s=a+"//"+e+"/avd/api/outgoing/destroyOutgoingUser",d={params:{roomId:r,userAddress:o,userId:n,accessToken:t}};return this.fetchGet(s,d).then(function(e){if(e&&0==e.result)i.resolve(e.data);else{var t=new p(e.result,e.err);i.reject(t)}}).catch(function(e){e=new p(e.code,e.message);return i.reject(e),!1}),i.promise},e.prototype.getOutgoingUsers=function(e,t,r){var o=when.defer(),n=document.location.protocol;"httpsionic:"==n&&(n="https:");var i=n+"//"+e+"/avd/api/outgoing/getOutgoingUsers",a={params:{roomId:r,accessToken:t}};return this.fetchGet(i,a).then(function(e){if(e&&0==e.result)o.resolve(e.data);else{var t=new p(e.result,e.err);o.reject(t)}}).catch(function(e){e=new p(e.code,e.message);return o.reject(e),!1}),o.promise},e.prototype.fetchGet=function(e,t){return new Promise(function(r,o){axios.get(e,t).then(function(e){if(0===e.data.result)r(e.data);else{var t={code:e.data.result,message:e.data.err};o(t)}}).catch(function(e){if(e.response){var t=new p(e.response.status,e.response.data);o(t)}else{t=new p(1e4,e.message);o(t)}o(e)})})},e}),ModuleBase.define("StreamExporterManager",["StreamExporterServer","Error"],function(u,e){var t=function(){this.streamExporterServers=[]};return t.prototype.createServerRecorder=function(e,t,r,o,n,i,a){var s=when.defer();return i||(i=10),this.createExportServer(exporterTypeEnum.record,e,t,r,o,n,i,a).then(function(e){s.resolve(e)}).otherwise(function(e){s.reject(e)}),s.promise},t.prototype.createServerRealtimeRecorder=function(e,t,r,o,n,i,a){var s=when.defer();return i||(i=10),this.createExportServer(exporterTypeEnum.record_real_time,e,t,r,o,n,i,a).then(function(e){s.resolve(e)}).otherwise(function(e){s.reject(e)}),s.promise},t.prototype.createServerLivecast=function(e,t,r,o,n,i,a){var s=when.defer();return i||(i=10),this.createExportServer(exporterTypeEnum.liver,e,t,r,o,n,i,a).then(function(e){s.resolve(e)}).otherwise(function(e){s.reject(e)}),s.promise},t.prototype.createExportServer=function(r,e,o,n,i,a,t,s){var d=this,l=when.defer();return t||(t=10),room.masterServer.createServerRecorder(Math.uuid(),room.id,room.selfUser.id,e,r,o,n,i,a,t,"",s).then(function(e){var t=new u;t.exporterId=e.exporter_id,t.name=e.exporter_name,t.viewWidth=o,t.viewHeight=n,t.outBitrate=i,t.outFps=a,t.playurls=e.play_urls,t.exporterType=r,d.streamExporterServers.push(t),l.resolve(t)}).otherwise(function(e){l.reject(e)}),l.promise},t.prototype.getExporter=function(e){var t=null;for(var r in streamExporterServers){var o=streamExporterServers[r];(o.exporterId=e)&&(t=o,brea)}return t},t.prototype.getStreamExporterServer=function(e,t,s){var d=when.defer();return room.masterServer.outgoingGetExporterInfo(e,t,s).then(function(e,t){var r=new u;r.exporterId=e.view_stream_id,r.name=e.exporter_name,r.viewWidth=e.view_width,r.viewHeight=e.view_height,r.outBitrate=e.view_bitrate,r.outFps=e.view_fps,r.maxVideoNumber=e.max_video_number,r.viewLayoutMode=e.layoutMode,r.exporterType=s;var o=[];if(t)for(var n in t){var i=t[n],a={userId:i.owner_user_id,deviceId:i.video_resource_id,x:i.x,y:i.y,width:i.w,height:i.h,zorder:i.zoder,data:i.video_data};o.push(a)}r.videoItems=o,d.resolve(r)}).otherwise(function(e){d.reject(e)}),d.promise},t.prototype.setFocusVideo=function(e,t,r){var o=when.defer();return room.masterServer.outgoingExporterSetFocusVideo(e,t,r).then(function(){o.resolve()}).otherwise(function(e){o.reject(e)}),o.promise},t}),ModuleBase.define("StreamExporterServer",["Error"],function(m){var e=function(){this.exporterId="",this.name="",this.appdata=null,this.exporterType=null,this.playurls="",this.viewWidth=0,this.viewHeight=0,this.outBitrate=0,this.outFps=0,this.maxVideoNumber=4,this.createTime="",this.status=exporterStatusEnum.live,this.size=0,this.desturl="",this.videoItems=[],this.audioUserId="",this.viewLayoutMode=viewLayoutModeEnum.fixation,this.pause_resume=!1};return e.prototype.updateStreamsExporter=function(t,e,r,o,n,i,a,s){var d=this,l=when.defer();return room.masterServer.createServerRecorder(e,room.id,room.selfUser.id,r,t,o,n,i,a,s,"").then(function(e){d.exporterId=e.exporter_id,d.name=e.exporter_name,d.viewWidth=o,d.viewHeight=n,d.outBitrate=i,d.outFps=a,d.playurls=e.play_urls,d.exporterType=t,l.resolve()}).otherwise(function(e){l.reject(e)}),l.promise},e.prototype.selectSingleVideo4Exporter=function(e,t,r,o){var n=when.defer(),i=t;if(e==room.selfUser.id&&(i=room.setDeviceIdByUUID(0,t)),arguments.length<3){var a=new m(ErrorConstant.exporter_parameter_lack_error);n.reject(a)}else this.audioUserId=r,o||(o=""),room.masterServer.selectStream4Exporter(this.exporterId,room.id,e,i,this.audioUserId,o,this.exporterType).then(function(e){n.resolve(e)}).otherwise(function(e){n.reject(e)});return n.promise},e.prototype.selectMixedVideos4Exporter=function(){var t=when.defer();return room.masterServer.mixMedia4Exporter(this.exporterId,room.id,this.viewLayoutMode,this.videoItems,this.audioUserId,this.exporterType).then(function(e){t.resolve(e)}).otherwise(function(e){t.reject(e)}),t.promise},e.prototype.selectMixedVideos4ExporterStart=function(){var e=this,t=when.defer();return setTimeout(function(){e.selectMixedVideos4Exporter().then(function(e){t.resolve(e)},function(e){t.reject(e)})},0),t.promise},e.prototype.setAudioUserId=function(e){this.audioUserId=e},e.prototype.setAutoLayout=function(e){var t=when.defer(),r=!1;for(var o in viewLayoutModeEnum)if(e==viewLayoutModeEnum[o]){r=!0;break}if(r)this.viewLayoutMode=e,self.selectMixedVideos4Exporter().then(function(e){t.resolve(e)}).otherwise(function(e){t.reject(e)});else{var n=new m(ErrorConstant.exporter_parameter_type_error);t.reject(n)}return t.promise},e.prototype.addVideoItem=function(t,e,r,o,n,i,a,s,d,l){var u=this,c=when.defer(),p=e;if(t==room.selfUser.id&&(p=room.setDeviceIdByUUID(0,e)),arguments.length<7){var h=new m(ErrorConstant.exporter_parameter_lack_error);c.reject(h)}else u.checkoutArguments(r,o,n,i,a).then(function(){var e={userId:t,deviceId:p,x:parseFloat(r),y:parseFloat(o),width:parseFloat(n),height:parseFloat(i),zorder:parseFloat(a),videoData:l};u.videoItems.push(e),c.resolve()}).otherwise(function(e){c.reject(e)});return c.promise},e.prototype.removeAllVideoItem=function(){this.videoItems=[]},e.prototype.addSubVideo=function(e,t,r,o,n,i,a,s,d){var l=this,u=when.defer(),c=t;if(e==room.selfUser.id&&(c=room.setDeviceIdByUUID(0,t)),arguments.length<7){var p=new m(ErrorConstant.exporter_parameter_lack_error);u.reject(p)}else{var h=!1;for(var f in l.videoItems)if(l.videoItems[f].deviceId==c){h=!0;break}if(h){p=new m(ErrorConstant.video_has_exporter_error);u.reject(p)}else l.addVideoItem(e,c,r,o,n,i,a,s,d).then(function(){l.selectMixedVideos4Exporter().then(function(e){u.resolve(e)}).otherwise(function(e){u.reject(e)})},function(e){u.reject(e)})}return u.promise},e.prototype.updataVideo=function(e,t,r){var o=!1,n=when.defer(),i=r;if(t==room.selfUser.id&&(i=room.setDeviceIdByUUID(0,r)),arguments.length<3){var a=new m(ErrorConstant.exporter_parameter_lack_error);n.reject(a)}else{for(var s in this.videoItems)if(this.videoItems[s].deviceId==e){o=!0,this.videoItems[s].deviceId=i,this.videoItems[s].userId=t;break}if(o)this.selectMixedVideos4Exporter().then(function(e){n.resolve(e)}).otherwise(function(e){n.reject(e)});else{a=new m(ErrorConstant.video_not_exporter_error);n.reject(a)}}},e.prototype.modSubVideo=function(e,t,r,o,n,i,a,s,d){var l=this,u=!1,c=when.defer(),p=t;if(e==room.selfUser.id&&(p=room.setDeviceIdByUUID(0,t)),arguments.length<7){var h=new m(ErrorConstant.exporter_parameter_lack_error);c.reject(h)}else this.checkoutArguments(r,o,n,i,a).then(function(){for(var e in l.videoItems)if(l.videoItems[e].deviceId==p){u=!0,l.videoItems[e].x=parseFloat(r),l.videoItems[e].y=parseFloat(o),l.videoItems[e].width=parseFloat(n),l.videoItems[e].height=parseFloat(i),l.videoItems[e].zorder=parseFloat(a);break}if(u)l.selectMixedVideos4Exporter().then(function(e){c.resolve(e)}).otherwise(function(e){c.reject(e)});else{var t=new m(ErrorConstant.video_not_exporter_error);c.reject(t)}},function(e){c.reject(e)});return c.promise},e.prototype.rmvSubVideo=function(e,t){var r=!1,o=when.defer(),n=t;for(var i in e==room.selfUser.id&&(n=room.setDeviceIdByUUID(0,t)),this.videoItems)if(this.videoItems[i].deviceId==n){r=!0,this.videoItems.splice(i,1);break}if(r)this.selectMixedVideos4Exporter().then(function(e){o.resolve(e)}).otherwise(function(e){o.reject(e)});else{var a=new m(ErrorConstant.video_not_exporter_error);o.reject(a)}return o.promise},e.prototype.pauseResume=function(){var t=this,r=when.defer(),o=!1;if(t.status!=exporterStatusEnum.stop)return t.status==exporterStatusEnum.live&&(o=!0),room.masterServer.pauseResumeExporter(t.exporterId,room.id,o,t.exporterType).then(function(e){t.status=o?exporterStatusEnum.pause:exporterStatusEnum.live,r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise;var e=new m(ErrorConstant.exporter_has_stop_error);return r.reject(e),r.promise},e.prototype.stopExporter=function(){var t=this,r=when.defer();return room.masterServer.destroyExporter(t.exporterId,room.id,t.exporterType).then(function(e){t.status=exporterStatusEnum.stop,r.resolve(e)}).otherwise(function(e){r.reject(e)}),r.promise},e.prototype.checkoutArguments=function(e,t,r,o,n){var i=when.defer();if("number"!=typeof e||"number"!=typeof t||"number"!=typeof r||"number"!=typeof o||"number"!=typeof n){var a=new m(ErrorConstant.exporter_parameter_type_error);i.reject(a)}else if(1<e||e<0||1<t||t<0||1<r||r<0||1<o||o<0){a=new m(ErrorConstant.exporter_parameter_number_error);i.reject(a)}else if(n<0||10<n){a=new m(ErrorConstant.exporter_parameter_number1_error);i.reject(a)}else i.resolve();return i.promise},e}),ModuleBase.define("ElectronManager",["PeerConnection","Error"],function(p,e){var t=function(){this.electron=require("electron"),this.path=require("path"),this.remote=require("electron").remote,this.ipc=require("electron").ipcRenderer,this.BrowserWindow=this.remote.BrowserWindow,this.curWindId=this.remote.getCurrentWindow().id,this.desktopTypes=["window","screen"],this.appThumbnailSize={width:150,height:150},this.winId2PeerConnection={},this.renderPeerConnection=null,this.ipc&&this.registerElectronIPCInner()};return t.prototype.getDesktopSources=function(e,t){e&&(this.desktopTypes=e),t&&(this.appThumbnailSize=t);var r={types:this.desktopTypes,thumbnailSize:this.appThumbnailSize},i=when.defer();return this.electron.desktopCapturer.getSources(r).then(function(e){var t=[];for(var r in e){var o=e[r];console.log("===ElectronManager.getDesktopSources(),source:",o);var n={sourceId:o.id?o.id:"",sourceName:o.name?o.name:"",thumbnail:o.thumbnail?o.thumbnail.toDataURL():""};t.push(n)}i.resolve(t)}).catch(function(e){i.reject(e)}),i.promise},t.prototype.getAllDisplays=function(){return this.electron.screen.getAllDisplays()},t.prototype.getPrimaryDisplay=function(){return this.electron.screen.getPrimaryDisplay()},t.prototype.getExternalDisplays=function(){var e=[],t=this.electron.screen.getAllDisplays();for(var r in t){var o=t[r];0===o.bounds.x&&0===o.bounds.y||e.push(o)}return e},t.prototype.renderToDisplay=function(e,t,r,o,n,i,a,s,d,l){var u=this.createWindowInner(t,r,o,n,i,a,s,d,l);if(u){var c=this.getPeerConnectionInner(u.id);c||((c=new p).createPeerConnectionInner(),c.startInner(e.srcObject,u,this.curWindId),this.winId2PeerConnection[u.id]=c)}return u.id},t.prototype.cancelRenderToDisplay=function(e){if(e){var t=this.getPeerConnectionInner(e);t&&(t.close(),t=null,delete this.winId2PeerConnection[e],this.remote.BrowserWindow.fromId(e).close())}},t.prototype.getRender=function(e){var t=new p(e);this.renderPeerConnection=t},t.prototype.closeRenderWindow=function(){this.remote.BrowserWindow.fromId(this.renderPeerConnection.parentWindId).webContents.send("closeWindow",this.remote.getCurrentWindow().id),this.remote.getCurrentWindow().close()},t.prototype.createWindowInner=function(e,t,r,o,n,i,a,s,d){var l=this,u=new this.BrowserWindow({x:e.bounds.x+r,y:e.bounds.y+o,webPreferences:{webSecurity:!1,nodeIntegration:"boolean"==typeof a&&a,enableRemoteModule:"boolean"==typeof s&&s,contextIsolation:"boolean"==typeof d&&d}}),c=u.id;return u.on("close",function(){l.remote.getCurrentWindow().webContents.send("closeWindow",c),u=null}),u.loadURL(t),n&&u.webContents.openDevTools(),i&&u.maximize(),u.show(),u},t.prototype.getPeerConnectionInner=function(e){return this.winId2PeerConnection[e]},t.prototype.registerElectronIPCInner=function(){var n=this;n.ipc.on("closeWindow",function(e,t){log.debug("==closeWindow,winId:",t);var r=n.winId2PeerConnection[t];r&&(r.close(),r=null,delete n.winId2PeerConnection[t])}),n.ipc.on("remoteSDP",function(e,t,r){log.debug("===ElectronManager.registerElectronIPCInner(),remoteSDP id:",t);var o=n.winId2PeerConnection[t];o&&o.setAnswerRemoteDescriptionInner(r)}),n.ipc.on("candidates",function(e,t,r){var o=n.winId2PeerConnection[t];o&&(log.debug("===ElectronManager.registerElectronIPCInner(),candidates remoteCandidates:",r),o.remoteCandidates=r)})},t}),ModuleBase.define("PeerConnection",["Error"],function(e){var t=function(e){this.pc=null,this.localSDP=null,this.remoteSDP=null,this.localCandidates=[],this.remoteCandidates=null,this.renderVideoElement=e,this.remote=require("electron").remote,this.ipc=require("electron").ipcRenderer,this.curWindId=this.remote.getCurrentWindow().id,this.parentWindId=null,this.subWin=null,this.remoteCandidatesIntervalId=null,this.ipc&&this.registerElectronIPCInner()};return t.prototype.createPeerConnectionInner=function(){var r=this,e=new RTCPeerConnection({iceServers:[],sdpSemantics:"plan-b"});(r.pc=e).onicecandidate=function(e){if(e.candidate){var t=JSON.stringify(e.candidate.toJSON());r.localCandidates.push(t)}else console.debug("===electron onicecandidate(),candidates:",r.localCandidates),r.subWin?r.subWin.webContents.send("candidates",r.localCandidates):r.remote.BrowserWindow.fromId(r.parentWindId).webContents.send("candidates",r.curWindId,r.localCandidates)},e.ontrack=function(e){console.debug("===ontrack(),track: ",e.track);var t=new window.MediaStream;t.addTrack(e.track),r.renderVideoElement.srcObject=t},e.oniceconnectionstatechange=function(e){console.info("electron oniceconnectionstatechange(),  iceConnectionState :"+e.target.iceConnectionState)},e.onsignalingstatechange=function(e){console.debug("electron onsignalingstatechange(),  signalingState :"+e.target.signalingState)}},t.prototype.startInner=function(r,o,e){var n=this;n.parentWindId=e,(n.subWin=o).webContents.on("did-finish-load",function(e){if(r){var t=r.getVideoTracks()[0];n.pc.addTrack(t,r)}n.createOfferInner().then(function(e){n.localSDP=e.sdp,n.setLocalDescriptionInner(e).then(function(){o.webContents.send("extrnal-show",n.parentWindId,n.localSDP)}).catch(function(e){console.error("electron setLocalDescriptionInner(),error:",e)})}).catch(function(e){console.error("electron createOfferInner(),error:",e)})})},t.prototype.registerElectronIPCInner=function(){var i=this;i.ipc.on("extrnal-show",function(e,t,r){if(i.pc||i.createPeerConnectionInner(),i.parentWindId=t,i.remoteSDP=r){var o={type:"offer",sdp:i.remoteSDP},n=new RTCSessionDescription(o);i.setRemoteDescriptionInner(n).then(function(){i.createAnswerInner().then(function(e){i.localSDP=e.sdp,i.setLocalDescriptionInner(e).then(function(){i.remote.BrowserWindow.fromId(i.parentWindId).webContents.send("remoteSDP",i.curWindId,i.localSDP)}).catch(function(e){console.error("electron setLocalDescriptionInner(),error:",e)})}).catch(function(e){console.error("electron createAnswerInner(),error:",e)})}).catch(function(e){console.error("electron setRemoteDescriptionInner(),error:",e)})}})},t.prototype.createOfferInner=function(){var e=this;return new Promise(function(t,r){e.pc.createOffer(function(e){console.log("===electron createOffer sessionDescription:",e),t(e)},function(e){console.error("===electron createOffer,error:",e),r(e)},{offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!1})})},t.prototype.createAnswerInner=function(){var e=this;return new Promise(function(t,r){e.pc.createAnswer(function(e){console.log("===electron  createAnswer sessionDescription:",e),t(e)},function(e){console.error("===electron createAnswer,error:",e),r(e)})})},t.prototype.setLocalDescriptionInner=function(r){var o=this;return new Promise(function(e,t){console.log("===electron Local SDP:",r.sdp),o.pc.setLocalDescription(r,function(){console.debug("===electron setLocalDescription Success"),e()},function(e){console.error("===electron setLocalDescription error,error:",e),t(e)})})},t.prototype.setAnswerRemoteDescriptionInner=function(e){var t=new RTCSessionDescription({type:"answer",sdp:e});this.setRemoteDescriptionInner(t).then(function(){}).catch(function(e){console.error("===electron setRemoteDescription(),error:",e)})},t.prototype.setRemoteDescriptionInner=function(r){var o=this;return new Promise(function(e,t){r.sdp=r.sdp.replace(/a=inactive/g,"a=recvonly"),"answer"==r.type&&(o.subWin?r.sdp=r.sdp.replace(/a=setup:actpass/g,"a=setup:active"):r.sdp=r.sdp.replace(/a=setup:actpass/g,"a=setup:passive")),r.sdp=r.sdp.replace(/96 97 98 99 100 101 102 122 127/g,"127 96 97 98 99 100 101 102 122"),console.log("===electron Remote  SDP:",r.sdp),o.pc.setRemoteDescription(r,function(){console.debug("===electron setRemoteDescription Success"),o.addIceCandidateInner(),e()},function(e){console.error("===electron setRemoteDescription error,error:",e),t(e)})})},t.prototype.addIceCandidateInner=function(){var e=this;e.remoteCandidates?e.addIceCandidateHandleInner():e.remoteCandidatesIntervalId=setInterval(function(){e.remoteCandidates&&(e.addIceCandidateHandleInner(),null!=e.remoteCandidatesIntervalId&&(clearInterval(e.remoteCandidatesIntervalId),e.remoteCandidatesIntervalId=null))},500)},t.prototype.addIceCandidateHandleInner=function(){for(var e in this.remoteCandidates){var t=JSON.parse(this.remoteCandidates[e]);this.pc.addIceCandidate(t,function(){console.log("===electron addIceCandidate Success")},function(e){console.error("===electron addIceCandidate error:",e)})}},t.prototype.close=function(){this.pc&&"closed"!=this.pc.signalingState&&this.pc.close()},t}),ModuleBase.define("RtmManager",["RtmMessageManager","Error"],function(s,d){var e=function(e,t,r){this.mqttWSAddr=e,this.account=t,this.password=r};return e.prototype.connect=function(){var r=when.defer();try{var e=document.location.protocol;"httpsionic:"==e&&(e="https:"),"http:"!=e&&"https:"!=e&&"httpsionic:"!=e&&(e="http:");var t="ws://";"https:"==e&&(t="wss://");var o=t+this.mqttWSAddr;log.debug("===mqtt webSocket URL:"+o);var n={clientId:this.account,username:this.account,password:this.password},i=mqtt.connect(o,n);console.log("===client:",i),i.on("connect",function(){console.log("mqtt connect success!"),r.resolve(i)}),i.on("error",function(e){console.log("mqtt connect error:",e);var t=new d(e.code,e.message);i.end(),r.reject(t)}),i.on("message",function(e,t){console.log([e,t]),(new s).OnWebSocketMessage(e,t)})}catch(e){log.info("MQTT  Operation  failed. with exception:"+e);var a=new d(ErrorConstant.websock_catch_exception);r.reject(a)}return r.promise},e}),ModuleBase.define("RtmMessageManager",["Error"],function(e){var t=function(){};return t.prototype.OnWebSocketMessage=function(e,t){if(console.log("===RtmMessageManager.OnWebSocketMessage(),topic:"+e+",payload:",t),signalClient.topicReservedWords.contains(e)){var r=signalClient.rtmServer.rtmProtobufCoded.decodePacket(t);console.log("===RtmMessageManager.OnWebSocketMessage(),signalHeader:",r);var o=r.group_type,n=r.cmd_type,i=r.content,a=r.from,s=r.to,d=signalClient.rtmServer.signalGroupTypeEnum,l=signalClient.rtmServer.signalCmdTypeEnum;switch(o){case d.SIGNALE_GROUP_TYPE_INVITE:switch(log.debug("acception  groupType = SIGNALE_GROUP_TYPE_INVITE"),n){case l.SIGNALE_CMD_TYPE_INVITE:log.debug("acception cmdType = SIGNALE_CMD_TYPE_INVITE");var u=signalClient.rtmServer.rtmProtobufCoded.decodeInvite(i);console.log("===RtmMessageManager.OnWebSocketMessage(),invite:",u),signalClient.inviteManager.emitCallNotify(u.id,a,s,u.options);break;case l.SIGNALE_CMD_TYPE_INVITE_CANCEL:log.debug("acception cmdType = SIGNALE_CMD_TYPE_INVITE_CANCEL");var c=signalClient.rtmServer.rtmProtobufCoded.decodeInviteCancel(i);console.log("===RtmMessageManager.OnWebSocketMessage(),decodeInviteCancel:",c),(u=signalClient.inviteManager.getInvite(c.id)).emitCallCancelNotify();break;case l.SIGNALE_CMD_TYPE_INVITE_RINGING:log.debug("acception cmdType = SIGNALE_CMD_TYPE_INVITE_RINGING");var p=signalClient.rtmServer.rtmProtobufCoded.decodeInviteRinging(i);console.log("===RtmMessageManager.OnWebSocketMessage(),decodeInviteRinging:",p),(u=signalClient.inviteManager.getInvite(p.id)).emitCallRingingNotify();break;case l.SIGNALE_CMD_TYPE_INVITE_OK:log.debug("acception cmdType = SIGNALE_CMD_TYPE_INVITE_OK");var h=signalClient.rtmServer.rtmProtobufCoded.decodeInviteOk(i);console.log("===RtmMessageManager.OnWebSocketMessage(),inviteOk:",h),(u=signalClient.inviteManager.getInvite(h.id)).emitCallAcceptNotify(h.options);break;case l.SIGNALE_CMD_TYPE_INVITE_REJECT:log.debug("acception cmdType = SIGNALE_CMD_TYPE_INVITE_REJECT");var f=signalClient.rtmServer.rtmProtobufCoded.decodeInviteReject(i);console.log("===RtmMessageManager.OnWebSocketMessage(),inviteReject:",f),(u=signalClient.inviteManager.getInvite(f.id)).emitCallRejectNotify(f.reson);break;case l.SIGNALE_CMD_TYPE_INVITE_BYE:log.debug("acception cmdType = SIGNALE_CMD_TYPE_INVITE_BYE");var m=signalClient.rtmServer.rtmProtobufCoded.decodeInviteBye(i);console.log("===RtmMessageManager.OnWebSocketMessage(),inviteBye:",m),(u=signalClient.inviteManager.getInvite(m.id)).emitCallCloseNotify(m.reson)}break;case d.SIGNALE_GROUP_TYPE_REMOTE_CONTROL:switch(log.debug("acception  groupType = SIGNALE_GROUP_TYPE_REMOTE_CONTROL"),n){case l.SIGNALE_CMD_TYPE_RC_MOUSE_EVENTS:log.debug("acception cmdType = SIGNALE_CMD_TYPE_RC_MOUSE_EVENTS");var g=signalClient.rtmServer.rtmProtobufCoded.decodeMouseEvents(i);console.log("===RtmMessageManager.OnWebSocketMessage(),mouseEvents:",g),signalClient.remoteControlManager.baseRemotectrl&&signalClient.remoteControlManager.baseRemotectrl.sendMouseMessage(g.eventsType,g.video_x,g.video_y,g.video_w,g.video_h);break;case l.SIGNALE_CMD_TYPE_RC_KEYBOARD_EVENTS:log.debug("acception cmdType = SIGNALE_CMD_TYPE_RC_KEYBOARD_EVENTS");var v=signalClient.rtmServer.rtmProtobufCoded.decodeKeyBoardEvents(i);console.log("===RtmMessageManager.OnWebSocketMessage(),keyBoardEvents:",v),signalClient.remoteControlManager.baseRemotectrl&&signalClient.remoteControlManager.baseRemotectrl.sendKeyboardMessage(v.eventsType,v.keyc,v.keyv)}break;case d.SIGNALE_GROUP_TYPE_MESSAGE:switch(log.debug("acception  groupType = SIGNALE_GROUP_TYPE_MESSAGE"),n){case l.SIGNALE_CMD_TYPE_MESSAGE_DATA:if(a==signalClient.selfUser.userId)return;var y=signalClient.rtmServer.rtmProtobufCoded.decodeMsgData(i);console.log("===RtmMessageManager.OnWebSocketMessage(),msgData:",y),signalClient.chatManager.emitReceiveMessageNotify(a,y.msg_id,y.session_type,y.session_id,y.create_time,y.msg_type,y.msg_content.toArrayBuffer())}break;case d.SIGNALE_GROUP_TYPE_RPC:switch(log.debug("acception  groupType = SIGNALE_GROUP_TYPE_RPC"),n){case l.SIGNALE_CMD_TYPE_RPC_CALL_RESPONSE:var b=signalClient.rtmServer.rtmProtobufCoded.decodeRpcCallResponse(i);console.log("===RtmMessageManager.OnWebSocketMessage(),rpcCallResponse:",b),b&&signalClient.rpcManager.eventEmitter.emit(signalClient.rpcManager.RpcManagerCallbackEnum.CALL_RESPONSE_SUCCESS+b.id,b.id,b.rpc_data);break;case l.SIGNALE_CMD_TYPE_RPC_NOTIFICATION:var _=signalClient.rtmServer.rtmProtobufCoded.decodeRpcNotification(i);console.log("===RtmMessageManager.OnWebSocketMessage(),rpcNotification:",_),_&&signalClient.rpcManager.eventEmitter.emit(signalClient.rpcManager.RpcManagerCallbackEnum.RPC_NOTIFICATION,_.rpc_data)}}}else{console.log("===RtmMessageManager.OnWebSocketMessage(),Native payload");var w=new Uint8Array(t),S=typeConversionUtil.Uint8ArrayToString(w);signalClient.eventEmitter.emit(signalClient.ClientCallbackEnum.NATIVE_PAYLOAD_NOTIFY,e,S)}},t}),ModuleBase.define("RtmServer",["RtmProtobufCoded","Error"],function(t,c){var e=function(e){this.signalingChannel=e,this.rtmProtobufCoded=new t,this.signalGroupTypeEnum=this.rtmProtobufCoded.getSignalGroupTypeEnum(),this.signalCmdTypeEnum=this.rtmProtobufCoded.getSignalCmdTypeEnum(),this.mouseEventsTypeEnum=this.rtmProtobufCoded.getMouseEventsTypeEnum(),this.keyboardEventsTypeEnum=this.rtmProtobufCoded.getKeyboardEventsTypeEnum(),this.keyboardVKTypeEnum=this.rtmProtobufCoded.getKeyboardVKTypeEnum()};return e.prototype.publish=function(e,t){console.debug("===RtmServer.publish(),topic:",e),this.signalingChannel&&this.signalingChannel.publish(e,t)},e.prototype.subscribe=function(e){console.log("===RtmServer.subscribe(),topic:",e),this.signalingChannel&&this.signalingChannel.subscribe(e)},e.prototype.unsubscribe=function(e){console.log("===RtmServer.unsubscribe(),topic:",e),this.signalingChannel&&this.signalingChannel.unsubscribe(e)},e.prototype.end=function(){console.debug("===RtmServer.end()"),this.signalingChannel&&this.signalingChannel.end()},e.prototype.sendInviteCall=function(e,t,r,o){console.debug("===RtmServer.sendInviteCall()");var n=when.defer();try{var i="/u/"+r,a="";o&&(a=JSON.stringify(o));var s=this.rtmProtobufCoded.newInvite(e,a),d=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE,t,r,s);console.log("===RtmServer.sendInviteCall(),headerBuffer:",d);var l=new Uint8Array(d);this.publish(i,l),n.resolve()}catch(e){n.reject(e)}return n.promise},e.prototype.sendInviteCancel=function(e,t,r){console.debug("===RtmServer.sendInviteCancel()");var o=when.defer();try{var n="/u/"+r,i=this.rtmProtobufCoded.newInviteCancel(e),a=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_CANCEL,t,r,i);console.log("===RtmServer.sendInviteCancel(),headerBuffer:",a);var s=new Uint8Array(a);this.publish(n,s),o.resolve()}catch(e){o.reject(e)}return o.promise},e.prototype.sendInviteRinging=function(e,t,r){console.debug("===RtmServer.sendInviteRinging()");var o=when.defer();try{var n="/u/"+r,i=this.rtmProtobufCoded.newInviteRinging(e),a=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_RINGING,t,r,i);console.log("===rtmServer.sendInviteRinging(),headerBuffer:",a);var s=new Uint8Array(a);this.publish(n,s),o.resolve()}catch(e){o.reject(e)}return o.promise},e.prototype.sendInviteAccept=function(e,t,r,o){console.debug("===RtmServer.sendInviteAccept()");var n=when.defer();try{var i="/u/"+r,a="";o&&(a=JSON.stringify(o));var s=this.rtmProtobufCoded.newInviteOk(e,a),d=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_OK,t,r,s);console.log("===RtmServer.sendInviteAccept(),headerBuffer:",d);var l=new Uint8Array(d);this.publish(i,l),n.resolve()}catch(e){n.reject(e)}return n.promise},e.prototype.sendInviteReject=function(e,t,r,o){console.debug("===RtmServer.sendInviteReject()");var n=when.defer();try{var i="/u/"+r,a=this.rtmProtobufCoded.newInviteReject(e,o),s=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_REJECT,t,r,a);console.log("===RtmServer.sendInviteReject(),headerBuffer:",s);var d=new Uint8Array(s);this.publish(i,d),n.resolve()}catch(e){n.reject(e)}return n.promise},e.prototype.sendInviteClose=function(e,t,r,o){console.debug("===RtmServer.sendInviteClose()");var n=when.defer();try{var i="/u/"+r,a=this.rtmProtobufCoded.newInviteBye(e,o),s=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_BYE,t,r,a);console.log("===RtmServer.sendInviteClose(),headerBuffer:",s);var d=new Uint8Array(s);this.publish(i,d),n.resolve()}catch(e){n.reject(e)}return n.promise},e.prototype.sendMouseMessage=function(e,t,r,o,n,i,a,s){console.debug("===RtmServer.sendMouseMessage()");var d=when.defer();try{var l="/u/"+r,u=this.rtmProtobufCoded.newMouseEvents(e,n,i,a,s,o);console.log("===RtmServer.sendMouseMessage(),mouseEvents:",u);var c=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_REMOTE_CONTROL,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_RC_MOUSE_EVENTS,t,r,u);console.log("===RtmServer.sendMouseMessage(),headerBuffer:",c);var p=new Uint8Array(c);this.publish(l,p),d.resolve()}catch(e){d.reject(e)}return d.promise},e.prototype.sendKeyboardMessage=function(e,t,r,o,n,i){console.debug("===RtmServer.sendKeyboardMessage()");var a=when.defer();try{var s="/u/"+r,d=this.rtmProtobufCoded.newKeyBoardEvents(e,n,i,o);console.log("===RtmServer.sendKeyboardMessage(),keyBoardEvents:",d);var l=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_REMOTE_CONTROL,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_RC_KEYBOARD_EVENTS,t,r,d);console.log("===RtmServer.sendKeyboardMessage(),headerBuffer:",l);var u=new Uint8Array(l);this.publish(s,u),a.resolve()}catch(e){a.reject(e)}return a.promise},e.prototype.sendMsgData=function(e,t){console.debug("===RtmServer.sendMsgData()");var r=when.defer();try{var o=typeConversionUtil.stringToUint8Array(t.content),n=this.rtmProtobufCoded.newMsgData(t.messageId,t.sessionType,t.sessionId,t.createTime,t.messageType,o);console.log("===RtmServer.sendMsgData(),msgData:",n);var i=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_MESSAGE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_MESSAGE_DATA,t.sendUserId,t.sessionId,n);console.log("===RtmServer.sendMsgData(),headerBuffer:",i);var a=new Uint8Array(i);this.publish(e,a),r.resolve()}catch(e){r.reject(e)}return r.promise},e.prototype.sendRpcCall=function(e,t,r,o){console.debug("===RtmServer.sendRpcCall()");var n=when.defer(),i=++Task_Id,a=JSON.stringify(o),s=this.rtmProtobufCoded.newRpcCallRequest(i,a);console.log("===RtmServer.sendRpcCall(),rpcCallRequest:",s);var d=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_RPC,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_RPC_CALL_REQUEST,e,t,s);console.log("===RtmServer.sendMsgData(),headerBuffer:",d);var l=new Uint8Array(d);this.publish(r,l);var u=setTimeout(function(){var e=new c(1e4,"sendRpcCall time out");n.reject(e)},5e3);return signalClient.rpcManager.addCallback(signalClient.rpcManager.RpcManagerCallbackEnum.CALL_RESPONSE_SUCCESS+i,function(e,t){console.log("===RtmServer.sendRpcCall().addCallback(),id:",e,"parameters:",t),e==i&&(signalClient.rpcManager.offCallback([signalClient.rpcManager.RpcManagerCallbackEnum.CALL_RESPONSE_SUCCESS+i]),n.resolve(t),clearTimeout(u))}),n.promise},e.prototype.sendRpcNotification=function(e,t,r,o){console.debug("===RtmServer.sendRpcNotification()");var n=when.defer();try{var i=++Task_Id,a=JSON.stringify(o),s=this.rtmProtobufCoded.newRpcNotification(i,a);console.log("====RtmServer.sendRpcNotification(),rpcNotification:",s);var d=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_RPC,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_RPC_NOTIFICATION,e,t,s);console.log("===RtmServer.sendRpcNotification(),headerBuffer:",d);var l=new Uint8Array(d);this.publish(r,l),n.resolve()}catch(e){n.reject(e)}return n.promise},e}),ModuleBase.define("RtmProtobufCoded",[],function(){var s,e=function(){s=rtmBuilder.signal_pdu};return e.prototype.getSignalGroupTypeEnum=function(){return s.signal_group_type},e.prototype.getSignalCmdTypeEnum=function(){return s.signal_cmd_type},e.prototype.getMouseEventsTypeEnum=function(){return s.mouse_events_type},e.prototype.getKeyboardEventsTypeEnum=function(){return s.keyboard_events_type},e.prototype.getKeyboardVKTypeEnum=function(){return s.keybaord_vk_type},e.prototype.getSessionTypeEnum=function(){return s.SessionType},e.prototype.getMsgTypeEnum=function(){return s.MsgType},e.prototype.getMsgStatusEnum=function(){return s.MsgStatus},e.prototype.encodedHeader=function(e,t,r,o,n){var i=null;null!=n&&(i=n.toArrayBuffer());var a=Math.round((new Date).getTime()/1e3),s=this.newSignalHeader("1.0",e,t,a,r,o,i);return console.log("===encodedHeader(),signalHeader:",s),s.toArrayBuffer()},e.prototype.newSignalHeader=function(e,t,r,o,n,i,a){return new s.signal_header(e,t,r,o,n,i,a)},e.prototype.newInvite=function(e,t){return new s.Invite(e,t)},e.prototype.newInviteCancel=function(e){return new s.InviteCancel(e)},e.prototype.newInviteRinging=function(e){return new s.InviteRinging(e)},e.prototype.newInviteOk=function(e,t){return new s.InviteOk(e,t)},e.prototype.newInviteReject=function(e,t){return new s.InviteReject(e,t)},e.prototype.newInviteBye=function(e,t){return new s.InviteBye(e,t)},e.prototype.newMouseEvents=function(e,t,r,o,n,i){return new s.MouseEvents(e,t,r,o,n,i)},e.prototype.newKeyBoardEvents=function(e,t,r,o){return new s.KeyBoardEvents(e,t,r,o)},e.prototype.newMsgData=function(e,t,r,o,n,i){return new s.MsgData(e,t,r,o,n,i)},e.prototype.newMsgDataDelivered=function(e,t,r){return new s.MsgDataDelivered(e,t,r)},e.prototype.newMsgDataRead=function(e,t,r){return new s.MsgDataRead(e,t,r)},e.prototype.newMsgDataRecalled=function(e,t,r){return new s.MsgDataRecalled(e,t,r)},e.prototype.newRpcCallRequest=function(e,t){return new s.RpcCallRequest(e,t)},e.prototype.newRpcNotification=function(e,t){return new s.RpcNotification(e,t)},e.prototype.decodePacket=function(e){return s.signal_header.decode(e)},e.prototype.decodeInvite=function(e){return s.Invite.decode(e)},e.prototype.decodeInviteCancel=function(e){return s.InviteCancel.decode(e)},e.prototype.decodeInviteRinging=function(e){return s.InviteRinging.decode(e)},e.prototype.decodeInviteOk=function(e){return s.InviteOk.decode(e)},e.prototype.decodeInviteReject=function(e){return s.InviteReject.decode(e)},e.prototype.decodeInviteBye=function(e){return s.InviteBye.decode(e)},e.prototype.decodeMouseEvents=function(e){return s.MouseEvents.decode(e)},e.prototype.decodeKeyBoardEvents=function(e){return s.KeyBoardEvents.decode(e)},e.prototype.decodeMsgData=function(e){return s.MsgData.decode(e)},e.prototype.decodeRpcCallResponse=function(e){return s.RpcCallResponse.decode(e)},e.prototype.decodeRpcNotification=function(e){return s.RpcNotification.decode(e)},e}),ModuleBase.define("ClientUser",["Error"],function(e){return function(e,t){this.userId=e,this.account=e,this.password=t,this.userName}}),ModuleBase.define("InviteManager",["Invite","Error"],function(a,e){var t=function(){this.InviteManagerCallbackEnum={CALL_NOTIFY:"call.notify"},this.invites={},this.eventEmitter=new EventEmitter};return t.prototype.createInvite=function(e,t,r){var o=new a(e,t,r);return this.invites[o.inviteId]=o},t.prototype.getInvite=function(e){return this.invites[e]},t.prototype.call=function(e){var t=when.defer();return e.callInner().then(function(){log.debug("===InviteManager.call(),success"),t.resolve()}).otherwise(function(e){log.debug("===InviteManager.call(),error:",e),t.reject(e)}),t.promise},t.prototype.emitCallNotify=function(e,t,r,o){var n=null;o&&(n=JSON.parse(o));var i=new a(r,t,n);i.inviteId=e,(this.invites[i.inviteId]=i).onCallTimeOutInner(),this.eventEmitter.emit(this.InviteManagerCallbackEnum.CALL_NOTIFY,i)},t.prototype.addCallback=function(e,t){this.eventEmitter.on(e,t)},t}),ModuleBase.define("Invite",["Error"],function(e){var t=function(e,t,r){this.InviteCallbackEnum={CALL_ACCEPT_NOTIFY:"call.accept.notify",CALL_REJECT_NOTIFY:"call.reject.notify",CALL_TIMEOUT_NOTIFY:"call.timeout.notify",CALL_RINGING_NOTIFY:"call.ringing.notify",CALL_CANCEL_NOTIFY:"call.cancel.notify",RESPONSE_CALL_TIMEOUT_NOTIFY:"response.call.timeout.notify",CALL_CLOSE_NOTIFY:"call.close.notify"},this.eventEmitter=new EventEmitter,this.inviteId=++Task_Id,this.fromUserId=e,this.toUserId=t,this.options=r,this.callTimeout=6e4,this.callBaseTime=null,this.callTimeoutIntervalId=null,this.onCallTimeout=55e3,this.onCallBaseTime=null,this.onCallTimeoutIntervalId=null};return t.prototype.callInner=function(){console.debug("===invite.callInner()");var e=this;null==e.callBaseTime&&(e.callBaseTime=new Date),e.callTimeoutIntervalId=setInterval(function(){new Date-e.callBaseTime>=e.callTimeout&&(e.clearanceInner(),e.eventEmitter.emit(e.InviteCallbackEnum.CALL_TIMEOUT_NOTIFY,e.toUserId))},500);var t=when.defer();return signalClient.rtmServer.sendInviteCall(e.inviteId,e.fromUserId,e.toUserId,e.options).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},t.prototype.onCallTimeOutInner=function(){console.debug("===invite.onCallTimeOutInner()");var e=this;null==e.onCallBaseTime&&(e.onCallBaseTime=new Date),e.onCallTimeoutIntervalId=setInterval(function(){new Date-e.onCallBaseTime>=e.onCallTimeout&&(e.clearanceInnerOnCall(),e.eventEmitter.emit(e.InviteCallbackEnum.RESPONSE_CALL_TIMEOUT_NOTIFY,e.fromUserId))},500)},t.prototype.clearanceInner=function(){clearInterval(this.callTimeoutIntervalId),this.callTimeoutIntervalId=null,this.callBaseTime=null},t.prototype.clearanceInnerOnCall=function(){clearInterval(this.onCallTimeoutIntervalId),this.onCallTimeoutIntervalId=null,this.onCallBaseTime=null},t.prototype.cancel=function(){var t=when.defer(),e=this;return signalClient.rtmServer.sendInviteCancel(e.inviteId,e.fromUserId,e.toUserId).then(function(){e.clearanceInner(),t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},t.prototype.ringing=function(){var t=when.defer();return signalClient.rtmServer.sendInviteRinging(this.inviteId,this.fromUserId,this.toUserId).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},t.prototype.accept=function(e){var t=this,r=when.defer();return signalClient.rtmServer.sendInviteAccept(t.inviteId,t.fromUserId,t.toUserId,e).then(function(){t.clearanceInnerOnCall(),r.resolve()}).otherwise(function(e){r.reject(e)}),r.promise},t.prototype.reject=function(e){var t=this,r=when.defer();return signalClient.rtmServer.sendInviteReject(t.inviteId,t.fromUserId,t.toUserId,e).then(function(){t.clearanceInnerOnCall(),r.resolve()}).otherwise(function(e){r.reject(e)}),r.promise},t.prototype.close=function(e){var t=this,r=when.defer();return signalClient.rtmServer.sendInviteClose(t.inviteId,t.fromUserId,t.toUserId,e).then(function(){t.clearanceInner(),t.clearanceInnerOnCall(),r.resolve()}).otherwise(function(e){r.reject(e)}),r.promise},t.prototype.emitCallCancelNotify=function(){this.eventEmitter.emit(this.InviteCallbackEnum.CALL_CANCEL_NOTIFY,this.toUserId)},t.prototype.emitCallRingingNotify=function(){this.callBaseTime=new Date,this.eventEmitter.emit(this.InviteCallbackEnum.CALL_RINGING_NOTIFY,this.toUserId)},t.prototype.emitCallAcceptNotify=function(e){this.clearanceInner();var t=null;e&&(t=JSON.parse(e)),this.eventEmitter.emit(this.InviteCallbackEnum.CALL_ACCEPT_NOTIFY,this.toUserId,t)},t.prototype.emitCallRejectNotify=function(e){this.clearanceInner(),this.eventEmitter.emit(this.InviteCallbackEnum.CALL_REJECT_NOTIFY,this.toUserId,e)},t.prototype.emitCallCloseNotify=function(e){this.clearanceInner(),this.clearanceInnerOnCall(),this.eventEmitter.emit(this.InviteCallbackEnum.CALL_CLOSE_NOTIFY,this.toUserId,e)},t.prototype.addCallback=function(e,t){this.eventEmitter.on(e,t)},t}),ModuleBase.define("RemoteControlManager",["Error"],function(e){var t=function(){this.MouseEventsTypeEnum={WM_MOUSEMOVE:512,WM_LBUTTONDOWN:513,WM_LBUTTONUP:514,WM_LBUTTONDBLCLK:515,WM_RBUTTONDOWN:516,WM_RBUTTONUP:517,WM_RBUTTONDBLCLK:518,WM_MBUTTONDOWN:519,WM_MBUTTONUP:520,WM_MBUTTONDBLCLK:521,WM_MOUSEWHEEL:522},this.KeyboardEventsTypeEnum={WM_KEYDOWN:256,WM_KEYUP:257,WM_CHAR:258},this.KeyboardVKTypeEnum={VK_BACK:8,VK_TAB:9,VK_SHIFT:16,VK_CONTROL:17,VK_MENU:18,VK_PAUSE:19,VK_CAPITAL:20,VK_KANA:21,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_ESCAPE:27,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SPACE:32,VK_PRIOR:33,VK_NEXT:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SNAPSHOT:44,VK_INSERT:45,VK_DELETE:46,VK_HELP:47},this.RemoteControlManagerCallbackEnum={MOUSE_EVENTS_NOTIFY:"mouse.events.notify",KEYBOARD_EVENTS_NOTIFY:"KeyBoard.events.notify"},this.fromUserId="",this.toUserId="",this.baseRemotectrl=null};return t.prototype.setBaseRemotectrl=function(e){this.baseRemotectrl=e},t.prototype.setFromUserAndToUser=function(e,t){this.fromUserId=e,this.toUserId=t},t.prototype.sendMouseMessage=function(e,t,r,o,n){var i=++Task_Id,a=when.defer();return signalClient.rtmServer.sendMouseMessage(i,this.fromUserId,this.toUserId,e,t,r,o,n).then(function(){a.resolve()}).otherwise(function(e){a.reject(e)}),a.promise},t.prototype.sendKeyboardMessage=function(e,t,r){var o=++Task_Id,n=when.defer();return signalClient.rtmServer.sendKeyboardMessage(o,this.fromUserId,this.toUserId,e,t,r).then(function(){n.resolve()}).otherwise(function(e){n.reject(e)}),n.promise},t}),ModuleBase.define("ChatManager",["Message","Error"],function(l,e){var t=function(){this.ChatManagerCallbackEnum={RECEIVE_MESSAGE_NOTIFY:"receive.message.notify",MESSAGE_STATUS_CHANGED_NOTIFY:"message.status.changed.notify"},this.SessionTypeEnum={peers:1,group:2,chatroom:3},this.MessageTypeEnum={text:1,image:2,file:3,audio:4,video:5,location:6},this.MessageStatussEnum={delivering:1,delivered:2,read:3,failed:4,recalled:5},this.eventEmitter=new EventEmitter};return t.prototype.registerGroups=function(e){if(e)for(var t=0;t<e.length;t++){var r=e[t];signalClient.rtmServer.subscribe("/g/"+r)}},t.prototype.unregisterGroup=function(e){e&&signalClient.rtmServer.unsubscribe("/g/"+e)},t.prototype.newTextMessage=function(e,t,r){var o=Math.uuid(),n=new l(o,e,t);return n.sendUserId=signalClient.selfUser.userId,n.messageType=this.MessageTypeEnum.text,n.content=r,n.createTime=signalClient.getServeTime(),n.status=this.MessageStatussEnum.delivering,n},t.prototype.sendMessage=function(e){var t=when.defer(),r="/u/"+e.sessionId;return e.sessionType!=this.SessionTypeEnum.peers&&(r="/g/"+e.sessionId),signalClient.rtmServer.sendMsgData(r,e).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},t.prototype.emitReceiveMessageNotify=function(e,t,r,o,n,i,a){var s=new l(t,r,o);s.sendUserId=e,s.messageType=i;var d=new Uint8Array(a);s.content=typeConversionUtil.Uint8ArrayToString(d),s.createTime=n,s.status=this.MessageStatussEnum.delivered,this.eventEmitter.emit(this.ChatManagerCallbackEnum.RECEIVE_MESSAGE_NOTIFY,s)},t.prototype.sendImageMessage=function(e,t,r,o){},t.prototype.sendFileMessage=function(e,t,r,o){},t.prototype.sendAudioMessage=function(e,t,r,o){},t.prototype.readMessage=function(e){},t.prototype.recallMessage=function(e){},t.prototype.addCallback=function(e,t){this.eventEmitter.on(e,t)},t.prototype.offCallback=function(e){for(var t in e){var r=e[t];this.eventEmitter.off(r)}},t}),ModuleBase.define("Message",["Error"],function(e){return function(e,t,r){this.messageId=e,this.sessionType=t,this.sessionId=r,this.sendUserId=null,this.messageType=null,this.content=null,this.createTime=null,this.status=null}}),ModuleBase.define("RpcManager",["Error"],function(n){var e=function(){this.RpcManagerCallbackEnum={CALL_RESPONSE_SUCCESS:"call.response.success",CALL_RESPONSE_ERROR:"call.response.error",RPC_NOTIFICATION:"rpc.notification"},this.eventEmitter=new EventEmitter};return e.prototype.call=function(e){var o=when.defer(),t=signalClient.selfUser.userId;return signalClient.rtmServer.sendRpcCall(t,"root","/s",e).then(function(e){console.log("===RpcManager.call(),result rpcData:",e);var t=JSON.parse(e);if(console.log("===RpcManager.call(),result Json:",t),t.error){var r=new n(t.error.code,t.error.message);o.reject(r)}else o.resolve(t.result)}).otherwise(function(e){o.reject(e)}),o.promise},e.prototype.notification=function(e){var t=when.defer(),r=signalClient.selfUser.userId;return signalClient.rtmServer.sendRpcNotification(r,"root","/s",e).then(function(){t.resolve()}).otherwise(function(e){t.reject(e)}),t.promise},e.prototype.addCallback=function(e,t){this.eventEmitter.on(e,t)},e.prototype.offCallback=function(e){for(var t in e){var r=e[t];this.eventEmitter.removeAllListeners(r)}},e}),!log)var log=log4javascript.getLogger();if(!bugout)var bugout=null;var signalClient=null,Task_Id=0,rtmVersion="1.0.0.0";ModuleBase.define("Client",["RestServer","RtmManager","RtmServer","ClientUser","InviteManager","RemoteControlManager","ChatManager","RpcManager","Error"],function(r,t,a,s,e,o,n,i,d){var l=function(e,t){this.ClientCallbackEnum={NATIVE_PAYLOAD_NOTIFY:"native.payload"},this.serverURI=e,this.accessToken=t,this.mqttWSAddr=null,this.restServer=new r,this.rtmManager=null,this.rtmServer=null,this.inviteManager=null,this.remoteControlManager=null,this.chatManager=null,this.rpcManager=null,this.selfUser=null,this.eventEmitter=new EventEmitter,this.topicReservedWords=["/u/","/g/","/s"],signalClient=this};return l.prototype.getVersion=function(){return"cn.tee3.rtm-"+rtmVersion},l.prototype.setLog=function(e,t){var r,o,n;e==Appender.alert?r=new log4javascript.AlertAppender:e==Appender.inpage?r=new log4javascript.InPageAppender:e==Appender.popup?r=new log4javascript.PopUpAppender:e==Appender.browserConsole&&(r=new log4javascript.BrowserConsoleAppender),t==LogLevel.all?r.setThreshold(log4javascript.Level.ALL):t==LogLevel.trace?r.setThreshold(log4javascript.Level.TRACE):t==LogLevel.debug?r.setThreshold(log4javascript.Level.DEBUG):t==LogLevel.info?r.setThreshold(log4javascript.Level.INFO):t==LogLevel.warn?r.setThreshold(log4javascript.Level.WARN):t==LogLevel.error?r.setThreshold(log4javascript.Level.ERROR):t==LogLevel.fatal?r.setThreshold(log4javascript.Level.FATAL):t==LogLevel.off&&r.setThreshold(log4javascript.Level.OFF),o=r,n=new log4javascript.PatternLayout("%d{yyyy-MM-dd HH:mm:ss SSS} %-5p - %m{1}%n"),o.setLayout(n),log.addAppender(o)},l.prototype.login=function(r,o){var n=when.defer(),i=this;return i.restServer.getMqttWSAddr(i.serverURI,i.accessToken).then(function(e){log.info("===client.login(),restServer.getMqttWSAddr(), mqttWSAddr:",e),i.mqttWSAddr=e,i.rtmManager=new t(i.mqttWSAddr,r,o),i.rtmManager.connect().then(function(e){signalClient.rtmServer=new a(e),signalClient.rtmServer.subscribe("/u/"+r);var t=new s(r,o);i.selfUser=t,n.resolve()}).otherwise(function(e){n.reject(e)})}).otherwise(function(e){log.error("===client.login(),error:",e),n.reject(e)}),n.promise},l.prototype.logout=function(e){var t=when.defer();try{this.rtmServer.end(),signalClient=null,this.selfUser=null,t.resolve()}catch(e){t.reject(e)}return t.promise},l.prototype.getInviteManager=function(){return this.inviteManager||(this.inviteManager=new e),this.inviteManager},l.prototype.getRemoteControlManager=function(){return this.remoteControlManager||(this.remoteControlManager=new o),this.remoteControlManager},l.prototype.getChatManager=function(){return this.chatManager||(this.chatManager=new n),this.chatManager},l.prototype.getRpcManager=function(){return this.rpcManager||(this.rpcManager=new i),this.rpcManager},l.prototype.getServeTime=function(){var e=new Date;e.setMinutes(e.getMinutes()+e.getTimezoneOffset());var t=e.getTime();return t=Math.round(t/1e3)},l.prototype.nativePublish=function(e,t){var r=when.defer();if(this.topicReservedWords.contains(e)){var o=new d(ErrorConstant.mqtt_topic_reservedword_error);r.reject(o)}else this.rtmServer.publish(e,t),r.resolve();return r.promise},l.prototype.nativeSubscribe=function(e){var t=when.defer();if(this.topicReservedWords.contains(e)){var r=new d(ErrorConstant.mqtt_topic_reservedword_error);t.reject(r)}else this.rtmServer.subscribe(e),t.resolve();return t.promise},l.prototype.getTopicReservedWords=function(){return this.topicReservedWords},l.prototype.addCallback=function(e,t){this.eventEmitter.on(e,t)},l.prototype.offCallback=function(e){for(var t in e){var r=e[t];this.eventEmitter.off(r)}},Array.prototype.contains=function(e){for(var t=0;t<this.length;t++)if(0<=e.indexOf(this[t]))return!0;return!1},l}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.axios=t():e.axios=t()}(this,function(){return function(r){function o(e){if(n[e])return n[e].exports;var t=n[e]={exports:{},id:e,loaded:!1};return r[e].call(t.exports,t,t.exports,o),t.loaded=!0,t.exports}var n={};return o.m=r,o.c=n,o.p="",o(0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";function o(e){var t=new a(e),r=i(a.prototype.request,t);return n.extend(r,a.prototype,t),n.extend(r,t),r}var n=r(2),i=r(3),a=r(4),s=r(5),d=o(s);d.Axios=a,d.create=function(e){return o(n.merge(s,e))},d.Cancel=r(22),d.CancelToken=r(23),d.isCancel=r(19),d.all=function(e){return Promise.all(e)},d.spread=r(24),e.exports=d,e.exports.default=d},function(e,t,r){"use strict";function i(e){return"[object Array]"===d.call(e)}function o(e){return null!==e&&"object"==typeof e}function n(e){return"[object Function]"===d.call(e)}function a(e,t){if(null!=e)if("object"==typeof e||i(e)||(e=[e]),i(e))for(var r=0,o=e.length;r<o;r++)t.call(null,e[r],r,e);else for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.call(null,e[n],n,e)}var s=r(3),d=Object.prototype.toString;e.exports={isArray:i,isArrayBuffer:function(e){return"[object ArrayBuffer]"===d.call(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:o,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===d.call(e)},isFile:function(e){return"[object File]"===d.call(e)},isBlob:function(e){return"[object Blob]"===d.call(e)},isFunction:n,isStream:function(e){return o(e)&&n(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return"undefined"!=typeof window&&"undefined"!=typeof document&&"function"==typeof document.createElement},forEach:a,merge:function r(){function e(e,t){"object"==typeof o[t]&&"object"==typeof e?o[t]=r(o[t],e):o[t]=e}for(var o={},t=0,n=arguments.length;t<n;t++)a(arguments[t],e);return o},extend:function(r,e,o){return a(e,function(e,t){r[t]=o&&"function"==typeof e?s(e,o):e}),r},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(e,t){"use strict";e.exports=function(r,o){return function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];return r.apply(o,e)}}},function(e,t,r){"use strict";function n(e){this.defaults=e,this.interceptors={request:new a,response:new a}}var o=r(5),i=r(2),a=r(16),s=r(17),d=r(20),l=r(21);n.prototype.request=function(e){"string"==typeof e&&(e=i.merge({url:arguments[0]},arguments[1])),(e=i.merge(o,this.defaults,{method:"get"},e)).baseURL&&!d(e.url)&&(e.url=l(e.baseURL,e.url));var t=[s,void 0],r=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)r=r.then(t.shift(),t.shift());return r},i.forEach(["delete","get","head"],function(r){n.prototype[r]=function(e,t){return this.request(i.merge(t||{},{method:r,url:e}))}}),i.forEach(["post","put","patch"],function(o){n.prototype[o]=function(e,t,r){return this.request(i.merge(r||{},{method:o,url:e,data:t}))}}),e.exports=n},function(e,t,r){"use strict";function o(e,t){!i.isUndefined(e)&&i.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var n,i=r(2),a=r(6),s=/^\)\]\}',?\n/,d={"Content-Type":"application/x-www-form-urlencoded"},l={adapter:("undefined"!=typeof XMLHttpRequest?n=r(7):"undefined"!=typeof process&&(n=r(7)),n),transformRequest:[function(e,t){return a(t,"Content-Type"),i.isFormData(e)||i.isArrayBuffer(e)||i.isStream(e)||i.isFile(e)||i.isBlob(e)?e:i.isArrayBufferView(e)?e.buffer:i.isURLSearchParams(e)?(o(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):i.isObject(e)?(o(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e){e=e.replace(s,"");try{e=JSON.parse(e)}catch(e){}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return 200<=e&&e<300}};l.headers={common:{Accept:"application/json, text/plain, */*"}},i.forEach(["delete","get","head"],function(e){l.headers[e]={}}),i.forEach(["post","put","patch"],function(e){l.headers[e]=i.merge(d)}),e.exports=l},function(e,t,r){"use strict";var n=r(2);e.exports=function(r,o){n.forEach(r,function(e,t){t!==o&&t.toUpperCase()===o.toUpperCase()&&(r[o]=e,delete r[t])})}},function(e,t,p){"use strict";var h=p(2),f=p(8),m=p(11),g=p(12),v=p(13),y=p(9),b="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||p(14);e.exports=function(c){return new Promise(function(r,o){var n=c.data,i=c.headers;h.isFormData(n)&&delete i["Content-Type"];var a=new XMLHttpRequest,e="onreadystatechange",s=!1;if("undefined"==typeof window||!window.XDomainRequest||"withCredentials"in a||v(c.url)||(a=new window.XDomainRequest,e="onload",s=!0,a.onprogress=function(){},a.ontimeout=function(){}),c.auth){var t=c.auth.username||"",d=c.auth.password||"";i.Authorization="Basic "+b(t+":"+d)}if(a.open(c.method.toUpperCase(),m(c.url,c.params,c.paramsSerializer),!0),a.timeout=c.timeout,a[e]=function(){if(a&&(4===a.readyState||s)&&(0!==a.status||a.responseURL&&0===a.responseURL.indexOf("file:"))){var e="getAllResponseHeaders"in a?g(a.getAllResponseHeaders()):null,t={data:c.responseType&&"text"!==c.responseType?a.response:a.responseText,status:1223===a.status?204:a.status,statusText:1223===a.status?"No Content":a.statusText,headers:e,config:c,request:a};f(r,o,t),a=null}},a.onerror=function(){o(y("Network Error",c)),a=null},a.ontimeout=function(){o(y("timeout of "+c.timeout+"ms exceeded",c,"ECONNABORTED")),a=null},h.isStandardBrowserEnv()){var l=p(15),u=(c.withCredentials||v(c.url))&&c.xsrfCookieName?l.read(c.xsrfCookieName):void 0;u&&(i[c.xsrfHeaderName]=u)}if("setRequestHeader"in a&&h.forEach(i,function(e,t){void 0===n&&"content-type"===t.toLowerCase()?delete i[t]:a.setRequestHeader(t,e)}),c.withCredentials&&(a.withCredentials=!0),c.responseType)try{a.responseType=c.responseType}catch(e){if("json"!==a.responseType)throw e}"function"==typeof c.onDownloadProgress&&a.addEventListener("progress",c.onDownloadProgress),"function"==typeof c.onUploadProgress&&a.upload&&a.upload.addEventListener("progress",c.onUploadProgress),c.cancelToken&&c.cancelToken.promise.then(function(e){a&&(a.abort(),o(e),a=null)}),void 0===n&&(n=null),a.send(n)})}},function(e,t,r){"use strict";var n=r(9);e.exports=function(e,t,r){var o=r.config.validateStatus;r.status&&o&&!o(r.status)?t(n("Request failed with status code "+r.status,r.config,null,r)):e(r)}},function(e,t,r){"use strict";var i=r(10);e.exports=function(e,t,r,o){var n=new Error(e);return i(n,t,r,o)}},function(e,t){"use strict";e.exports=function(e,t,r,o){return e.config=t,r&&(e.code=r),e.response=o,e}},function(e,t,r){"use strict";function i(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var a=r(2);e.exports=function(e,t,r){if(!t)return e;var o;if(r)o=r(t);else if(a.isURLSearchParams(t))o=t.toString();else{var n=[];a.forEach(t,function(e,t){null!=e&&(a.isArray(e)&&(t+="[]"),a.isArray(e)||(e=[e]),a.forEach(e,function(e){a.isDate(e)?e=e.toISOString():a.isObject(e)&&(e=JSON.stringify(e)),n.push(i(t)+"="+i(e))}))}),o=n.join("&")}return o&&(e+=(-1===e.indexOf("?")?"?":"&")+o),e}},function(e,t,r){"use strict";var i=r(2);e.exports=function(e){var t,r,o,n={};return e&&i.forEach(e.split("\n"),function(e){o=e.indexOf(":"),t=i.trim(e.substr(0,o)).toLowerCase(),r=i.trim(e.substr(o+1)),t&&(n[t]=n[t]?n[t]+", "+r:r)}),n}},function(e,t,r){"use strict";var a=r(2);e.exports=a.isStandardBrowserEnv()?function(){function r(e){var t=e;return n&&(i.setAttribute("href",t),t=i.href),i.setAttribute("href",t),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:"/"===i.pathname.charAt(0)?i.pathname:"/"+i.pathname}}var o,n=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");return o=r(window.location.href),function(e){var t=a.isString(e)?r(e):e;return t.protocol===o.protocol&&t.host===o.host}}():function(){return!0}},function(e,t){"use strict";function s(){this.message="String contains an invalid character"}(s.prototype=new Error).code=5,s.prototype.name="InvalidCharacterError",e.exports=function(e){for(var t,r,o=String(e),n="",i=0,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";o.charAt(0|i)||(a="=",i%1);n+=a.charAt(63&t>>8-i%1*8)){if(255<(r=o.charCodeAt(i+=.75)))throw new s;t=t<<8|r}return n}},function(e,t,r){"use strict";var s=r(2);e.exports=s.isStandardBrowserEnv()?{write:function(e,t,r,o,n,i){var a=[];a.push(e+"="+encodeURIComponent(t)),s.isNumber(r)&&a.push("expires="+new Date(r).toGMTString()),s.isString(o)&&a.push("path="+o),s.isString(n)&&a.push("domain="+n),!0===i&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,r){"use strict";function o(){this.handlers=[]}var n=r(2);o.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},o.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},o.prototype.forEach=function(t){n.forEach(this.handlers,function(e){null!==e&&t(e)})},e.exports=o},function(e,t,r){"use strict";function o(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var n=r(2),i=r(18),a=r(19),s=r(5);e.exports=function(t){return o(t),t.headers=t.headers||{},t.data=i(t.data,t.headers,t.transformRequest),t.headers=n.merge(t.headers.common||{},t.headers[t.method]||{},t.headers||{}),n.forEach(["delete","get","head","post","put","patch","common"],function(e){delete t.headers[e]}),(t.adapter||s.adapter)(t).then(function(e){return o(t),e.data=i(e.data,e.headers,t.transformResponse),e},function(e){return a(e)||(o(t),e&&e.response&&(e.response.data=i(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)})}},function(e,t,r){"use strict";var o=r(2);e.exports=function(t,r,e){return o.forEach(e,function(e){t=e(t,r)}),t}},function(e,t){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t){"use strict";e.exports=function(e,t){return e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,"")}},function(e,t){"use strict";function r(e){this.message=e}r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,e.exports=r},function(e,t,r){"use strict";function o(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var r=this;e(function(e){r.reason||(r.reason=new n(e),t(r.reason))})}var n=r(22);o.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},o.source=function(){var t;return{token:new o(function(e){t=e}),cancel:t}},e.exports=o},function(e,t){"use strict";e.exports=function(t){return function(e){return t.apply(null,e)}}}])});