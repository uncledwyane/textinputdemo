/*! cn.tee3.rtm-1.0.0.0 2019-09-16 04:34:14 */

var base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64DecodeChars=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);function base64encode(t){var e,r,n,i,o,s;for(n=t.length,r=0,e="";r<n;){if(i=255&t.charCodeAt(r++),r==n){e+=base64EncodeChars.charAt(i>>2),e+=base64EncodeChars.charAt((3&i)<<4),e+="==";break}if(o=t.charCodeAt(r++),r==n){e+=base64EncodeChars.charAt(i>>2),e+=base64EncodeChars.charAt((3&i)<<4|(240&o)>>4),e+=base64EncodeChars.charAt((15&o)<<2),e+="=";break}s=t.charCodeAt(r++),e+=base64EncodeChars.charAt(i>>2),e+=base64EncodeChars.charAt((3&i)<<4|(240&o)>>4),e+=base64EncodeChars.charAt((15&o)<<2|(192&s)>>6),e+=base64EncodeChars.charAt(63&s)}return e}function base64decode(t){var e,r,n,i,o,s,a;for(s=t.length,o=0,a="";o<s;){for(;e=base64DecodeChars[255&t.charCodeAt(o++)],o<s&&-1==e;);if(-1==e)break;for(;r=base64DecodeChars[255&t.charCodeAt(o++)],o<s&&-1==r;);if(-1==r)break;a+=String.fromCharCode(e<<2|(48&r)>>4);do{if(61==(n=255&t.charCodeAt(o++)))return a;n=base64DecodeChars[n]}while(o<s&&-1==n);if(-1==n)break;a+=String.fromCharCode((15&r)<<4|(60&n)>>2);do{if(61==(i=255&t.charCodeAt(o++)))return a;i=base64DecodeChars[i]}while(o<s&&-1==i);if(-1==i)break;a+=String.fromCharCode((3&n)<<6|i)}return a}function utf16to8(t){var e,r,n,i;for(e="",n=t.length,r=0;r<n;r++)1<=(i=t.charCodeAt(r))&&i<=127?e+=t.charAt(r):(2047<i?(e+=String.fromCharCode(224|i>>12&15),e+=String.fromCharCode(128|i>>6&63)):e+=String.fromCharCode(192|i>>6&31),e+=String.fromCharCode(128|i>>0&63));return e}function utf8to16(t){var e,r,n,i,o,s;for(e="",n=t.length,r=0;r<n;)switch((i=t.charCodeAt(r++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=t.charAt(r-1);break;case 12:case 13:o=t.charCodeAt(r++),e+=String.fromCharCode((31&i)<<6|63&o);break;case 14:o=t.charCodeAt(r++),s=t.charCodeAt(r++),e+=String.fromCharCode((15&i)<<12|(63&o)<<6|(63&s)<<0)}return e}function doit(){var t=document.f;t.output.value=base64encode(utf16to8(t.source.value)),t.decode.value=utf8to16(base64decode(t.output.value))}function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(t){return"function"==typeof t}function isNumber(t){return"number"==typeof t}function isObject(t){return"object"==typeof t&&null!==t}function isUndefined(t){return void 0===t}function debugout(){var a=this;if(a.realTimeLoggingOn=!0,a.useTimestamps=!1,a.useLocalStorage=!1,a.recordLogs=!0,a.autoTrim=!0,a.maxLines=5e4,a.tailNumLines=100,a.logFilename="debugout.txt",a.maxDepth=25,a.depth=0,a.parentSizes=[0],a.currentResult="",a.startTime=new Date,a.output="",a.logLevel={all:1,trace:2,debug:3,info:4,warn:5,error:6,fatal:7,off:8},this.version=function(){return"0.5.0"},this.getLog=function(){var t=new Date;if(a.recordLogs||a.log("[debugout.js] log recording is off."),a.useLocalStorage){var e=window.localStorage.getItem("debugout.js");e&&(e=JSON.parse(e),a.startTime=new Date(e.startTime),a.output=e.log,t=new Date(e.lastLog))}return a.output+"\n---- Log retrieved: "+t+" ----\n"+a.formatSessionDuration(a.startTime,t)},this.tail=function(t){t=t||a.tailLines;return a.trimLog(a.getLog(),t)},this.search=function(t){for(var e=a.output.split("\n"),r=new RegExp(t),n=[],i=0;i<e.length;i++){var o="["+i+"] ";e[i].match(r)&&n.push(o+e[i])}var s=n.join("\n");return 0==s.length&&(s='Nothing found for "'+t+'".'),s},this.getSlice=function(t,e){return a.output.split("\n").slice(t,t+e).join("\n")},this.downloadLog=function(){var t="data:text/plain;charset=utf-8,",e=a.getLog();t+=encodeURIComponent(e);var r=document.createElement("a");r.href=t,r.target="_blank",r.download=a.logFilename,document.body.appendChild(r),r.click(),r.remove()},this.clear=function(){var t=new Date;if(a.output="---- Log cleared: "+t+" ----\n",a.useLocalStorage){var e={startTime:a.startTime,log:a.output,lastLog:t};e=JSON.stringify(e),window.localStorage.setItem("debugout.js",e)}a.realTimeLoggingOn&&console.log("[debugout.js] clear()")},this.track=function(t){a.log(a.logLevel.track,t)},this.debug=function(t){a.log(a.logLevel.debug,t)},this.info=function(t){a.log(a.logLevel.info,t)},this.error=function(t){a.log(a.logLevel.error,t)},this.log=function(t,e){a.realTimeLoggingOn&&(t==this.logLevel.trace?console.trace(e):t==this.logLevel.debug?console.debug(e):t==this.logLevel.info?console.info(e):t==this.logLevel.error?console.error(e):console.info(e));var r=a.determineType(e);if(null!=r&&a.recordLogs){var n=a.formatType(r,e);if(a.useTimestamps){var i=new Date;a.output+=a.formatTimestamp(i)}if(t==this.logLevel.trace?a.output+="TRACK - ":t==this.logLevel.debug?a.output+="DEBUG - ":t==this.logLevel.info?a.output+="INFO - ":t==this.logLevel.error?a.output+="ERROR - ":a.output+="INFO - ",a.output+=n+"\n",a.autoTrim&&(a.output=a.trimLog(a.output,a.maxLines)),a.useLocalStorage){var o=new Date,s={startTime:a.startTime,log:a.output,lastLog:o};s=JSON.stringify(s),window.localStorage.setItem("debugout.js",s)}}a.depth=0,a.parentSizes=[0],a.currentResult=""},this.determineType=function(t){if(null==t)return null;var e=typeof t;return"object"==e?null==t.length?"function"==typeof t.getTime?"Date":"function"==typeof t.test?"RegExp":"Object":"Array":e},this.formatType=function(t,e){if(a.maxDepth&&a.depth>=a.maxDepth)return"... (max-depth reached)";switch(t){case"Object":a.currentResult+="{\n",a.depth++,a.parentSizes.push(a.objectSize(e));var r=0;for(var n in e){a.currentResult+=a.indentsForDepth(a.depth),a.currentResult+=n+": ";var i=a.determineType(e[n]);(o=a.formatType(i,e[n]))&&(a.currentResult+=o),r!=a.parentSizes[a.depth]-1&&(a.currentResult+=","),a.currentResult+="\n",r++}if(a.depth--,a.parentSizes.pop(),a.currentResult+=a.indentsForDepth(a.depth),a.currentResult+="}",0==a.depth)return a.currentResult;break;case"Array":a.currentResult+="[",a.depth++,a.parentSizes.push(e.length);for(r=0;r<e.length;r++){var o;"Object"!=(i=a.determineType(e[r]))&&"Array"!=i||(a.currentResult+="\n"+a.indentsForDepth(a.depth)),(o=a.formatType(i,e[r]))?(a.currentResult+=o,r!=a.parentSizes[a.depth]-1&&(a.currentResult+=", "),"Array"==i&&(a.currentResult+="\n")):(r!=a.parentSizes[a.depth]-1&&(a.currentResult+=", "),"Object"!=i?a.currentResult+="\n":r==a.parentSizes[a.depth]-1&&(a.currentResult+="\n"))}if(a.depth--,a.parentSizes.pop(),a.currentResult+="]",0==a.depth)return a.currentResult;break;case"function":var s=(e+="").split("\n");for(r=0;r<s.length;r++)s[r].match(/\}/)&&a.depth--,a.currentResult+=a.indentsForDepth(a.depth),s[r].match(/\{/)&&a.depth++,a.currentResult+=s[r]+"\n";return a.currentResult;case"RegExp":return"/"+e.source+"/";case"Date":case"string":return 0<a.depth||0==e.length?'"'+e+'"':e;case"boolean":return e?"true":"false";case"number":return e+""}},this.indentsForDepth=function(t){for(var e="",r=0;r<t;r++)e+="\t";return e},this.trimLog=function(t,e){var r=t.split("\n");return r.length>e&&(r=r.slice(r.length-e)),r.join("\n")},this.lines=function(){return a.output.split("\n").length},this.formatSessionDuration=function(t,e){var r=e-t,n=Math.floor(r/1e3/60/60),i=("0"+n).slice(-2);r-=1e3*n*60*60;var o=Math.floor(r/1e3/60),s=("0"+o).slice(-2);r-=1e3*o*60;var a=Math.floor(r/1e3);return r-=1e3*a,"---- Session duration: "+i+":"+s+":"+("0"+a).slice(-2)+" ----"},this.formatTimestamp=function(t){var e=t.getFullYear(),r=t.getDate();return"["+e+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+r+" "+Number(t.getHours())+":"+("0"+t.getMinutes()).slice(-2)+":"+("0"+t.getSeconds()).slice(-2)+"]: "},this.objectSize=function(t){var e,r=0;for(e in t)t.hasOwnProperty(e)&&r++;return r},a.useLocalStorage){var t=window.localStorage.getItem("debugout.js");if(t){t=JSON.parse(t),a.output=t.log;var e=new Date(t.startTime),r=new Date(t.lastLog);a.output+="\n---- Session end: "+t.lastLog+" ----\n",a.output+=a.formatSessionDuration(e,r),a.output+="\n\n"}}a.output+="---- Session started: "+a.startTime+" ----\n\n"}!function(t,e){"function"==typeof define&&define.amd?define([],e):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=e():(t.dcodeIO=t.dcodeIO||{}).Long=e()}(this,function(){"use strict";function p(t,e,r){this.low=0|t,this.high=0|e,this.unsigned=!!r}try{Object.defineProperty(p.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1})}catch(t){}p.isLong=function(t){return!0===(t&&t.__isLong__)};var i={},o={};p.fromInt=function(t,e){var r,n;return e?0<=(t>>>=0)&&t<256&&(n=o[t])?n:(r=new p(t,(0|t)<0?-1:0,!0),0<=t&&t<256&&(o[t]=r),r):-128<=(t|=0)&&t<128&&(n=i[t])?n:(r=new p(t,t<0?-1:0,!1),-128<=t&&t<128&&(i[t]=r),r)},p.fromNumber=function(t,e){return e=!!e,isNaN(t)||!isFinite(t)?p.ZERO:!e&&t<=-s?p.MIN_VALUE:!e&&s<=t+1?p.MAX_VALUE:e&&n<=t?p.MAX_UNSIGNED_VALUE:t<0?p.fromNumber(-t,e).negate():new p(t%r|0,t/r|0,e)},p.fromBits=function(t,e,r){return new p(t,e,r)},p.fromString=function(t,e,r){if(0===t.length)throw Error("number format error: empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return p.ZERO;if("number"==typeof e&&(r=e,e=!1),(r=r||10)<2||36<r)throw Error("radix out of range: "+r);var n;if(0<(n=t.indexOf("-")))throw Error('number format error: interior "-" character: '+t);if(0===n)return p.fromString(t.substring(1),e,r).negate();for(var i=p.fromNumber(Math.pow(r,8)),o=p.ZERO,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),l=parseInt(t.substring(s,s+a),r);if(a<8){var u=p.fromNumber(Math.pow(r,a));o=o.multiply(u).add(p.fromNumber(l))}else o=(o=o.multiply(i)).add(p.fromNumber(l))}return o.unsigned=e,o},p.fromValue=function(t){return t instanceof p?t:"number"==typeof t?p.fromNumber(t):"string"==typeof t?p.fromString(t):new p(t.low,t.high,t.unsigned)};var r=4294967296,n=r*r,s=n/2,d=p.fromInt(1<<24);return p.ZERO=p.fromInt(0),p.UZERO=p.fromInt(0,!0),p.ONE=p.fromInt(1),p.UONE=p.fromInt(1,!0),p.NEG_ONE=p.fromInt(-1),p.MAX_VALUE=p.fromBits(-1,2147483647,!1),p.MAX_UNSIGNED_VALUE=p.fromBits(-1,-1,!0),p.MIN_VALUE=p.fromBits(0,-2147483648,!1),p.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},p.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*r+(this.low>>>0):this.high*r+(this.low>>>0)},p.prototype.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix out of range: "+t);if(this.isZero())return"0";var e;if(this.isNegative()){if(this.equals(p.MIN_VALUE)){var r=p.fromNumber(t),n=this.divide(r);return e=n.multiply(r).subtract(this),n.toString(t)+e.toInt().toString(t)}return"-"+this.negate().toString(t)}var i=p.fromNumber(Math.pow(t,6),this.unsigned);e=this;for(var o="";;){var s=e.divide(i),a=(e.subtract(s.multiply(i)).toInt()>>>0).toString(t);if((e=s).isZero())return a+o;for(;a.length<6;)a="0"+a;o=""+a+o}},p.prototype.getHighBits=function(){return this.high},p.prototype.getHighBitsUnsigned=function(){return this.high>>>0},p.prototype.getLowBits=function(){return this.low},p.prototype.getLowBitsUnsigned=function(){return this.low>>>0},p.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(p.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;0<e&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},p.prototype.isZero=function(){return 0===this.high&&0===this.low},p.prototype.isNegative=function(){return!this.unsigned&&this.high<0},p.prototype.isPositive=function(){return this.unsigned||0<=this.high},p.prototype.isOdd=function(){return 1==(1&this.low)},p.prototype.isEven=function(){return 0==(1&this.low)},p.eq=p.prototype.equals=function(t){return p.isLong(t)||(t=p.fromValue(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},p.neq=p.prototype.notEquals=function(t){return!this.equals(t)},p.prototype.lt=p.prototype.lessThan=function(t){return this.compare(t)<0},p.prototype.lte=p.prototype.lessThanOrEqual=function(t){return this.compare(t)<=0},p.prototype.gt=p.prototype.greaterThan=function(t){return 0<this.compare(t)},p.prototype.gte=p.prototype.greaterThanOrEqual=function(t){return 0<=this.compare(t)},p.prototype.compare=function(t){if(p.isLong(t)||(t=p.fromValue(t)),this.equals(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.subtract(t).isNegative()?-1:1},p.prototype.neg=p.prototype.negate=function(){return!this.unsigned&&this.equals(p.MIN_VALUE)?p.MIN_VALUE:this.not().add(p.ONE)},p.prototype.add=function(t){p.isLong(t)||(t=p.fromValue(t));var e=this.high>>>16,r=65535&this.high,n=this.low>>>16,i=65535&this.low,o=t.high>>>16,s=65535&t.high,a=t.low>>>16,l=0,u=0,c=0,h=0;return c+=(h+=i+(65535&t.low))>>>16,u+=(c+=n+a)>>>16,l+=(u+=r+s)>>>16,l+=e+o,p.fromBits((c&=65535)<<16|(h&=65535),(l&=65535)<<16|(u&=65535),this.unsigned)},p.prototype.sub=p.prototype.subtract=function(t){return p.isLong(t)||(t=p.fromValue(t)),this.add(t.negate())},p.prototype.mul=p.prototype.multiply=function(t){if(this.isZero())return p.ZERO;if(p.isLong(t)||(t=p.fromValue(t)),t.isZero())return p.ZERO;if(this.equals(p.MIN_VALUE))return t.isOdd()?p.MIN_VALUE:p.ZERO;if(t.equals(p.MIN_VALUE))return this.isOdd()?p.MIN_VALUE:p.ZERO;if(this.isNegative())return t.isNegative()?this.negate().multiply(t.negate()):this.negate().multiply(t).negate();if(t.isNegative())return this.multiply(t.negate()).negate();if(this.lessThan(d)&&t.lessThan(d))return p.fromNumber(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,r=65535&this.high,n=this.low>>>16,i=65535&this.low,o=t.high>>>16,s=65535&t.high,a=t.low>>>16,l=65535&t.low,u=0,c=0,h=0,f=0;return h+=(f+=i*l)>>>16,c+=(h+=n*l)>>>16,h&=65535,c+=(h+=i*a)>>>16,u+=(c+=r*l)>>>16,c&=65535,u+=(c+=n*a)>>>16,c&=65535,u+=(c+=i*s)>>>16,u+=e*l+r*a+n*s+i*o,p.fromBits((h&=65535)<<16|(f&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},p.prototype.div=p.prototype.divide=function(t){if(p.isLong(t)||(t=p.fromValue(t)),t.isZero())throw new Error("division by zero");if(this.isZero())return this.unsigned?p.UZERO:p.ZERO;var e,r,n;{if(this.equals(p.MIN_VALUE))return t.equals(p.ONE)||t.equals(p.NEG_ONE)?p.MIN_VALUE:t.equals(p.MIN_VALUE)?p.ONE:(e=this.shiftRight(1).divide(t).shiftLeft(1)).equals(p.ZERO)?t.isNegative()?p.ONE:p.NEG_ONE:(r=this.subtract(t.multiply(e)),n=e.add(r.divide(t)));if(t.equals(p.MIN_VALUE))return this.unsigned?p.UZERO:p.ZERO}if(this.isNegative())return t.isNegative()?this.negate().divide(t.negate()):this.negate().divide(t).negate();if(t.isNegative())return this.divide(t.negate()).negate();for(n=p.ZERO,r=this;r.greaterThanOrEqual(t);){e=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var i=Math.ceil(Math.log(e)/Math.LN2),o=i<=48?1:Math.pow(2,i-48),s=p.fromNumber(e),a=s.multiply(t);a.isNegative()||a.greaterThan(r);)a=(s=p.fromNumber(e-=o,this.unsigned)).multiply(t);s.isZero()&&(s=p.ONE),n=n.add(s),r=r.subtract(a)}return n},p.prototype.mod=p.prototype.modulo=function(t){return p.isLong(t)||(t=p.fromValue(t)),this.subtract(this.divide(t).multiply(t))},p.prototype.not=function(){return p.fromBits(~this.low,~this.high,this.unsigned)},p.prototype.and=function(t){return p.isLong(t)||(t=p.fromValue(t)),p.fromBits(this.low&t.low,this.high&t.high,this.unsigned)},p.prototype.or=function(t){return p.isLong(t)||(t=p.fromValue(t)),p.fromBits(this.low|t.low,this.high|t.high,this.unsigned)},p.prototype.xor=function(t){return p.isLong(t)||(t=p.fromValue(t)),p.fromBits(this.low^t.low,this.high^t.high,this.unsigned)},p.prototype.shl=p.prototype.shiftLeft=function(t){return p.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?p.fromBits(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):p.fromBits(0,this.low<<t-32,this.unsigned)},p.prototype.shr=p.prototype.shiftRight=function(t){return p.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?p.fromBits(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):p.fromBits(this.high>>t-32,0<=this.high?0:-1,this.unsigned)},p.prototype.shru=p.prototype.shiftRightUnsigned=function(t){if(p.isLong(t)&&(t=t.toInt()),0===(t&=63))return this;var e=this.high;if(t<32){var r=this.low;return p.fromBits(r>>>t|e<<32-t,e>>>t,this.unsigned)}return p.fromBits(32===t?e:e>>>t-32,0,this.unsigned)},p.prototype.toSigned=function(){return this.unsigned?new p(this.low,this.high,!1):this},p.prototype.toUnsigned=function(){return this.unsigned?this:new p(this.low,this.high,!0)},p}),function(t,e){"function"==typeof define&&define.amd?define(["long"],e):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=function(){var t;try{t=require("long")}catch(t){}return e(t)}():(t.dcodeIO=t.dcodeIO||{}).ByteBuffer=e(t.dcodeIO.Long)}(this,function(l){"use strict";var d=function(t,e,r){if(void 0===t&&(t=d.DEFAULT_CAPACITY),void 0===e&&(e=d.DEFAULT_ENDIAN),void 0===r&&(r=d.DEFAULT_NOASSERT),!r){if((t|=0)<0)throw RangeError("Illegal capacity");e=!!e,r=!!r}this.buffer=0===t?o:new ArrayBuffer(t),this.view=0===t?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=t,this.littleEndian=e,this.noAssert=r};d.VERSION="5.0.1",d.LITTLE_ENDIAN=!0,d.BIG_ENDIAN=!1,d.DEFAULT_CAPACITY=16,d.DEFAULT_ENDIAN=d.BIG_ENDIAN,d.DEFAULT_NOASSERT=!1,d.Long=l||null;var s=d.prototype;s.__isByteBuffer__;try{Object.defineProperty(s,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1})}catch(t){}try{var o=new ArrayBuffer(0)}catch(t){o=""}var r=String.fromCharCode;function a(t){var e=0;return function(){return e<t.length?t.charCodeAt(e++):null}}function u(){var t=[],e=[];return function(){if(0===arguments.length)return e.join("")+r.apply(String,t);1024<t.length+arguments.length&&(e.push(r.apply(String,t)),t.length=0),Array.prototype.push.apply(t,arguments)}}function n(t,e,r,n,i){var o,s,a=8*i-n-1,l=(1<<a)-1,u=l>>1,c=-7,h=r?i-1:0,f=r?-1:1,p=t[e+h];for(h+=f,o=p&(1<<-c)-1,p>>=-c,c+=a;0<c;o=256*o+t[e+h],h+=f,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=n;0<c;s=256*s+t[e+h],h+=f,c-=8);if(0===o)o=1-u;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=u}return(p?-1:1)*s*Math.pow(2,o-n)}function i(t,e,r,n,i,o){var s,a,l,u=8*o-i-1,c=(1<<u)-1,h=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,d=n?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=c):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),2<=(e+=1<=s+h?f/l:f*Math.pow(2,1-h))*l&&(s++,l/=2),c<=s+h?(a=0,s=c):1<=s+h?(a=(e*l-1)*Math.pow(2,i),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),s=0));8<=i;t[r+p]=255&a,p+=d,a/=256,i-=8);for(s=s<<i|a,u+=i;0<u;t[r+p]=255&s,p+=d,s/=256,u-=8);t[r+p-d]|=128*g}d.accessor=function(){return Uint8Array},d.allocate=function(t,e,r){return new d(t,e,r)},d.concat=function(t,e,r,n){"boolean"!=typeof e&&"string"==typeof e||(n=r,r=e,e=void 0);for(var i,o=0,s=0,a=t.length;s<a;++s)d.isByteBuffer(t[s])||(t[s]=d.wrap(t[s],e)),0<(i=t[s].limit-t[s].offset)&&(o+=i);if(0===o)return new d(0,r,n);var l,u=new d(o,r,n);for(s=0;s<a;)(i=(l=t[s++]).limit-l.offset)<=0||(u.view.set(l.view.subarray(l.offset,l.limit),u.offset),u.offset+=i);return u.limit=u.offset,u.offset=0,u},d.isByteBuffer=function(t){return!0===(t&&t.__isByteBuffer__)},d.type=function(){return ArrayBuffer},d.wrap=function(t,e,r,n){if("string"!=typeof e&&(n=r,r=e,e=void 0),"string"==typeof t)switch(void 0===e&&(e="utf8"),e){case"base64":return d.fromBase64(t,r);case"hex":return d.fromHex(t,r);case"binary":return d.fromBinary(t,r);case"utf8":return d.fromUTF8(t,r);case"debug":return d.fromDebug(t,r);default:throw Error("Unsupported encoding: "+e)}if(null===t||"object"!=typeof t)throw TypeError("Illegal buffer");var i;if(d.isByteBuffer(t))return(i=s.clone.call(t)).markedOffset=-1,i;if(t instanceof Uint8Array)i=new d(0,r,n),0<t.length&&(i.buffer=t.buffer,i.offset=t.byteOffset,i.limit=t.byteOffset+t.byteLength,i.view=new Uint8Array(t.buffer));else if(t instanceof ArrayBuffer)i=new d(0,r,n),0<t.byteLength&&(i.buffer=t,i.offset=0,i.limit=t.byteLength,i.view=0<t.byteLength?new Uint8Array(t):null);else{if("[object Array]"!==Object.prototype.toString.call(t))throw TypeError("Illegal buffer");(i=new d(t.length,r,n)).limit=t.length;for(var o=0;o<t.length;++o)i.view[o]=t[o]}return i},s.writeBitSet=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if(!(t instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var n,i=e,o=t.length,s=o>>3,a=0;for(e+=this.writeVarint32(o,e);s--;)n=1&!!t[a++]|(1&!!t[a++])<<1|(1&!!t[a++])<<2|(1&!!t[a++])<<3|(1&!!t[a++])<<4|(1&!!t[a++])<<5|(1&!!t[a++])<<6|(1&!!t[a++])<<7,this.writeByte(n,e++);if(a<o){var l=0;for(n=0;a<o;)n|=(1&!!t[a++])<<l++;this.writeByte(n,e++)}return r?(this.offset=e,this):e-i},s.readBitSet=function(t){var e=void 0===t;e&&(t=this.offset);var r,n=this.readVarint32(t),i=n.value,o=i>>3,s=0,a=[];for(t+=n.length;o--;)r=this.readByte(t++),a[s++]=!!(1&r),a[s++]=!!(2&r),a[s++]=!!(4&r),a[s++]=!!(8&r),a[s++]=!!(16&r),a[s++]=!!(32&r),a[s++]=!!(64&r),a[s++]=!!(128&r);if(s<i){var l=0;for(r=this.readByte(t++);s<i;)a[s++]=!!(r>>l++&1)}return e&&(this.offset=t),a},s.readBytes=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+t>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+"+t+") <= "+this.buffer.byteLength)}var n=this.slice(e,e+t);return r&&(this.offset+=t),n},s.writeBytes=s.append,s.writeInt8=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=1;var n=this.buffer.byteLength;return n<e&&this.resize((n*=2)>e?n:e),e-=1,this.view[e]=t,r&&(this.offset+=1),this},s.writeByte=s.writeInt8,s.readInt8=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r=this.view[t];return 128==(128&r)&&(r=-(255-r+1)),e&&(this.offset+=1),r},s.readByte=s.readInt8,s.writeUint8=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=1;var n=this.buffer.byteLength;return n<e&&this.resize((n*=2)>e?n:e),e-=1,this.view[e]=t,r&&(this.offset+=1),this},s.writeUInt8=s.writeUint8,s.readUint8=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r=this.view[t];return e&&(this.offset+=1),r},s.readUInt8=s.readUint8,s.writeInt16=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=2;var n=this.buffer.byteLength;return n<e&&this.resize((n*=2)>e?n:e),e-=2,this.littleEndian?(this.view[e+1]=(65280&t)>>>8,this.view[e]=255&t):(this.view[e]=(65280&t)>>>8,this.view[e+1]=255&t),r&&(this.offset+=2),this},s.writeShort=s.writeInt16,s.readInt16=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+2) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[t],r|=this.view[t+1]<<8):(r=this.view[t]<<8,r|=this.view[t+1]),32768==(32768&r)&&(r=-(65535-r+1)),e&&(this.offset+=2),r},s.readShort=s.readInt16,s.writeUint16=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=2;var n=this.buffer.byteLength;return n<e&&this.resize((n*=2)>e?n:e),e-=2,this.littleEndian?(this.view[e+1]=(65280&t)>>>8,this.view[e]=255&t):(this.view[e]=(65280&t)>>>8,this.view[e+1]=255&t),r&&(this.offset+=2),this},s.writeUInt16=s.writeUint16,s.readUint16=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+2) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[t],r|=this.view[t+1]<<8):(r=this.view[t]<<8,r|=this.view[t+1]),e&&(this.offset+=2),r},s.readUInt16=s.readUint16,s.writeInt32=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var n=this.buffer.byteLength;return n<e&&this.resize((n*=2)>e?n:e),e-=4,this.littleEndian?(this.view[e+3]=t>>>24&255,this.view[e+2]=t>>>16&255,this.view[e+1]=t>>>8&255,this.view[e]=255&t):(this.view[e]=t>>>24&255,this.view[e+1]=t>>>16&255,this.view[e+2]=t>>>8&255,this.view[e+3]=255&t),r&&(this.offset+=4),this},s.writeInt=s.writeInt32,s.readInt32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[t+2]<<16,r|=this.view[t+1]<<8,r|=this.view[t],r+=this.view[t+3]<<24>>>0):(r=this.view[t+1]<<16,r|=this.view[t+2]<<8,r|=this.view[t+3],r+=this.view[t]<<24>>>0),r|=0,e&&(this.offset+=4),r},s.readInt=s.readInt32,s.writeUint32=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var n=this.buffer.byteLength;return n<e&&this.resize((n*=2)>e?n:e),e-=4,this.littleEndian?(this.view[e+3]=t>>>24&255,this.view[e+2]=t>>>16&255,this.view[e+1]=t>>>8&255,this.view[e]=255&t):(this.view[e]=t>>>24&255,this.view[e+1]=t>>>16&255,this.view[e+2]=t>>>8&255,this.view[e+3]=255&t),r&&(this.offset+=4),this},s.writeUInt32=s.writeUint32,s.readUint32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var r=0;return this.littleEndian?(r=this.view[t+2]<<16,r|=this.view[t+1]<<8,r|=this.view[t],r+=this.view[t+3]<<24>>>0):(r=this.view[t+1]<<16,r|=this.view[t+2]<<8,r|=this.view[t+3],r+=this.view[t]<<24>>>0),e&&(this.offset+=4),r},s.readUInt32=s.readUint32,l&&(s.writeInt64=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"==typeof t)t=l.fromNumber(t);else if("string"==typeof t)t=l.fromString(t);else if(!(t&&t instanceof l))throw TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}"number"==typeof t?t=l.fromNumber(t):"string"==typeof t&&(t=l.fromString(t)),e+=8;var n=this.buffer.byteLength;n<e&&this.resize((n*=2)>e?n:e),e-=8;var i=t.low,o=t.high;return this.littleEndian?(this.view[e+3]=i>>>24&255,this.view[e+2]=i>>>16&255,this.view[e+1]=i>>>8&255,this.view[e]=255&i,e+=4,this.view[e+3]=o>>>24&255,this.view[e+2]=o>>>16&255,this.view[e+1]=o>>>8&255,this.view[e]=255&o):(this.view[e]=o>>>24&255,this.view[e+1]=o>>>16&255,this.view[e+2]=o>>>8&255,this.view[e+3]=255&o,e+=4,this.view[e]=i>>>24&255,this.view[e+1]=i>>>16&255,this.view[e+2]=i>>>8&255,this.view[e+3]=255&i),r&&(this.offset+=8),this},s.writeLong=s.writeInt64,s.readInt64=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var r=0,n=0;this.littleEndian?(r=this.view[t+2]<<16,r|=this.view[t+1]<<8,r|=this.view[t],r+=this.view[t+3]<<24>>>0,t+=4,n=this.view[t+2]<<16,n|=this.view[t+1]<<8,n|=this.view[t],n+=this.view[t+3]<<24>>>0):(n=this.view[t+1]<<16,n|=this.view[t+2]<<8,n|=this.view[t+3],n+=this.view[t]<<24>>>0,t+=4,r=this.view[t+1]<<16,r|=this.view[t+2]<<8,r|=this.view[t+3],r+=this.view[t]<<24>>>0);var i=new l(r,n,!1);return e&&(this.offset+=8),i},s.readLong=s.readInt64,s.writeUint64=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"==typeof t)t=l.fromNumber(t);else if("string"==typeof t)t=l.fromString(t);else if(!(t&&t instanceof l))throw TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}"number"==typeof t?t=l.fromNumber(t):"string"==typeof t&&(t=l.fromString(t)),e+=8;var n=this.buffer.byteLength;n<e&&this.resize((n*=2)>e?n:e),e-=8;var i=t.low,o=t.high;return this.littleEndian?(this.view[e+3]=i>>>24&255,this.view[e+2]=i>>>16&255,this.view[e+1]=i>>>8&255,this.view[e]=255&i,e+=4,this.view[e+3]=o>>>24&255,this.view[e+2]=o>>>16&255,this.view[e+1]=o>>>8&255,this.view[e]=255&o):(this.view[e]=o>>>24&255,this.view[e+1]=o>>>16&255,this.view[e+2]=o>>>8&255,this.view[e+3]=255&o,e+=4,this.view[e]=i>>>24&255,this.view[e+1]=i>>>16&255,this.view[e+2]=i>>>8&255,this.view[e+3]=255&i),r&&(this.offset+=8),this},s.writeUInt64=s.writeUint64,s.readUint64=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var r=0,n=0;this.littleEndian?(r=this.view[t+2]<<16,r|=this.view[t+1]<<8,r|=this.view[t],r+=this.view[t+3]<<24>>>0,t+=4,n=this.view[t+2]<<16,n|=this.view[t+1]<<8,n|=this.view[t],n+=this.view[t+3]<<24>>>0):(n=this.view[t+1]<<16,n|=this.view[t+2]<<8,n|=this.view[t+3],n+=this.view[t]<<24>>>0,t+=4,r=this.view[t+1]<<16,r|=this.view[t+2]<<8,r|=this.view[t+3],r+=this.view[t]<<24>>>0);var i=new l(r,n,!0);return e&&(this.offset+=8),i},s.readUInt64=s.readUint64),s.writeFloat32=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t)throw TypeError("Illegal value: "+t+" (not a number)");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var n=this.buffer.byteLength;return n<e&&this.resize((n*=2)>e?n:e),e-=4,i(this.view,t,e,this.littleEndian,23,4),r&&(this.offset+=4),this},s.writeFloat=s.writeFloat32,s.readFloat32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var r=n(this.view,t,this.littleEndian,23,4);return e&&(this.offset+=4),r},s.readFloat=s.readFloat32,s.writeFloat64=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t)throw TypeError("Illegal value: "+t+" (not a number)");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=8;var n=this.buffer.byteLength;return n<e&&this.resize((n*=2)>e?n:e),e-=8,i(this.view,t,e,this.littleEndian,52,8),r&&(this.offset+=8),this},s.writeDouble=s.writeFloat64,s.readFloat64=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var r=n(this.view,t,this.littleEndian,52,8);return e&&(this.offset+=8),r},s.readDouble=s.readFloat64,d.MAX_VARINT32_BYTES=5,d.calculateVarint32=function(t){return(t>>>=0)<128?1:t<16384?2:t<1<<21?3:t<1<<28?4:5},d.zigZagEncode32=function(t){return((t|=0)<<1^t>>31)>>>0},d.zigZagDecode32=function(t){return t>>>1^-(1&t)|0},s.writeVarint32=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var n,i=d.calculateVarint32(t);e+=i;var o=this.buffer.byteLength;for(o<e&&this.resize((o*=2)>e?o:e),e-=i,t>>>=0;128<=t;)n=127&t|128,this.view[e++]=n,t>>>=7;return this.view[e++]=t,r?(this.offset=e,this):i},s.writeVarint32ZigZag=function(t,e){return this.writeVarint32(d.zigZagEncode32(t),e)},s.readVarint32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r,n=0,i=0;do{if(!this.noAssert&&t>this.limit){var o=Error("Truncated");throw o.truncated=!0,o}r=this.view[t++],n<5&&(i|=(127&r)<<7*n),++n}while(0!=(128&r));return i|=0,e?(this.offset=t,i):{value:i,length:n}},s.readVarint32ZigZag=function(t){var e=this.readVarint32(t);return"object"==typeof e?e.value=d.zigZagDecode32(e.value):e=d.zigZagDecode32(e),e},l&&(d.MAX_VARINT64_BYTES=10,d.calculateVarint64=function(t){"number"==typeof t?t=l.fromNumber(t):"string"==typeof t&&(t=l.fromString(t));var e=t.toInt()>>>0,r=t.shiftRightUnsigned(28).toInt()>>>0,n=t.shiftRightUnsigned(56).toInt()>>>0;return 0==n?0==r?e<16384?e<128?1:2:e<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:n<128?9:10},d.zigZagEncode64=function(t){return"number"==typeof t?t=l.fromNumber(t,!1):"string"==typeof t?t=l.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned()),t.shiftLeft(1).xor(t.shiftRight(63)).toUnsigned()},d.zigZagDecode64=function(t){return"number"==typeof t?t=l.fromNumber(t,!1):"string"==typeof t?t=l.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned()),t.shiftRightUnsigned(1).xor(t.and(l.ONE).toSigned().negate()).toSigned()},s.writeVarint64=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("number"==typeof t)t=l.fromNumber(t);else if("string"==typeof t)t=l.fromString(t);else if(!(t&&t instanceof l))throw TypeError("Illegal value: "+t+" (not an integer or Long)");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}"number"==typeof t?t=l.fromNumber(t,!1):"string"==typeof t?t=l.fromString(t,!1):!1!==t.unsigned&&(t=t.toSigned());var n=d.calculateVarint64(t),i=t.toInt()>>>0,o=t.shiftRightUnsigned(28).toInt()>>>0,s=t.shiftRightUnsigned(56).toInt()>>>0;e+=n;var a=this.buffer.byteLength;switch(a<e&&this.resize((a*=2)>e?a:e),e-=n,n){case 10:this.view[e+9]=s>>>7&1;case 9:this.view[e+8]=9!==n?128|s:127&s;case 8:this.view[e+7]=8!==n?o>>>21|128:o>>>21&127;case 7:this.view[e+6]=7!==n?o>>>14|128:o>>>14&127;case 6:this.view[e+5]=6!==n?o>>>7|128:o>>>7&127;case 5:this.view[e+4]=5!==n?128|o:127&o;case 4:this.view[e+3]=4!==n?i>>>21|128:i>>>21&127;case 3:this.view[e+2]=3!==n?i>>>14|128:i>>>14&127;case 2:this.view[e+1]=2!==n?i>>>7|128:i>>>7&127;case 1:this.view[e]=1!==n?128|i:127&i}return r?(this.offset+=n,this):n},s.writeVarint64ZigZag=function(t,e){return this.writeVarint64(d.zigZagEncode64(t),e)},s.readVarint64=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r=t,n=0,i=0,o=0,s=0;if(n=127&(s=this.view[t++]),128&s&&(n|=(127&(s=this.view[t++]))<<7,(128&s||this.noAssert&&void 0===s)&&(n|=(127&(s=this.view[t++]))<<14,(128&s||this.noAssert&&void 0===s)&&(n|=(127&(s=this.view[t++]))<<21,(128&s||this.noAssert&&void 0===s)&&(i=127&(s=this.view[t++]),(128&s||this.noAssert&&void 0===s)&&(i|=(127&(s=this.view[t++]))<<7,(128&s||this.noAssert&&void 0===s)&&(i|=(127&(s=this.view[t++]))<<14,(128&s||this.noAssert&&void 0===s)&&(i|=(127&(s=this.view[t++]))<<21,(128&s||this.noAssert&&void 0===s)&&(o=127&(s=this.view[t++]),(128&s||this.noAssert&&void 0===s)&&(o|=(127&(s=this.view[t++]))<<7,128&s||this.noAssert&&void 0===s))))))))))throw Error("Buffer overrun");var a=l.fromBits(n|i<<28,i>>>4|o<<24,!1);return e?(this.offset=t,a):{value:a,length:t-r}},s.readVarint64ZigZag=function(t){var e=this.readVarint64(t);return e&&e.value instanceof l?e.value=d.zigZagDecode64(e.value):e=d.zigZagDecode64(e),e}),s.writeCString=function(t,e){var r=void 0===e;r&&(e=this.offset);var n,i=t.length;if(!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");for(n=0;n<i;++n)if(0===t.charCodeAt(n))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}i=f.calculateUTF16asUTF8(a(t))[1],e+=i+1;var o=this.buffer.byteLength;return o<e&&this.resize((o*=2)>e?o:e),e-=i+1,f.encodeUTF16toUTF8(a(t),function(t){this.view[e++]=t}.bind(this)),this.view[e++]=0,r?(this.offset=e,this):i},s.readCString=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r,n=t,i=-1;return f.decodeUTF8toUTF16(function(){if(0===i)return null;if(t>=this.limit)throw RangeError("Illegal range: Truncated data, "+t+" < "+this.limit);return 0===(i=this.view[t++])?null:i}.bind(this),r=u(),!0),e?(this.offset=t,r()):{string:r(),length:t-n}},s.writeIString=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var n,i=e;n=f.calculateUTF16asUTF8(a(t),this.noAssert)[1],e+=4+n;var o=this.buffer.byteLength;if(o<e&&this.resize((o*=2)>e?o:e),e-=4+n,this.littleEndian?(this.view[e+3]=n>>>24&255,this.view[e+2]=n>>>16&255,this.view[e+1]=n>>>8&255,this.view[e]=255&n):(this.view[e]=n>>>24&255,this.view[e+1]=n>>>16&255,this.view[e+2]=n>>>8&255,this.view[e+3]=255&n),e+=4,f.encodeUTF16toUTF8(a(t),function(t){this.view[e++]=t}.bind(this)),e!==i+4+n)throw RangeError("Illegal range: Truncated data, "+e+" == "+(e+4+n));return r?(this.offset=e,this):e-i},s.readIString=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var r=t,n=this.readUint32(t),i=this.readUTF8String(n,d.METRICS_BYTES,t+=4);return t+=i.length,e?(this.offset=t,i.string):{string:i.string,length:t-r}},d.METRICS_CHARS="c",d.METRICS_BYTES="b",s.writeUTF8String=function(t,e){var r,n=void 0===e;if(n&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var i=e;r=f.calculateUTF16asUTF8(a(t))[1],e+=r;var o=this.buffer.byteLength;return o<e&&this.resize((o*=2)>e?o:e),e-=r,f.encodeUTF16toUTF8(a(t),function(t){this.view[e++]=t}.bind(this)),n?(this.offset=e,this):e-i},s.writeString=s.writeUTF8String,d.calculateUTF8Chars=function(t){return f.calculateUTF16asUTF8(a(t))[0]},d.calculateUTF8Bytes=function(t){return f.calculateUTF16asUTF8(a(t))[1]},d.calculateString=d.calculateUTF8Bytes,s.readUTF8String=function(t,e,r){"number"==typeof e&&(r=e,e=void 0);var n=void 0===r;if(n&&(r=this.offset),void 0===e&&(e=d.METRICS_CHARS),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal length: "+t+" (not an integer)");if(t|=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}var i,o=0,s=r;if(e===d.METRICS_CHARS){if(i=u(),f.decodeUTF8(function(){return o<t&&r<this.limit?this.view[r++]:null}.bind(this),function(t){++o,f.UTF8toUTF16(t,i)}),o!==t)throw RangeError("Illegal range: Truncated data, "+o+" == "+t);return n?(this.offset=r,i()):{string:i(),length:r-s}}if(e!==d.METRICS_BYTES)throw TypeError("Unsupported metrics: "+e);if(!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+t>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+"+t+") <= "+this.buffer.byteLength)}var a=r+t;if(f.decodeUTF8toUTF16(function(){return r<a?this.view[r++]:null}.bind(this),i=u(),this.noAssert),r!==a)throw RangeError("Illegal range: Truncated data, "+r+" == "+a);return n?(this.offset=r,i()):{string:i(),length:r-s}},s.readString=s.readUTF8String,s.writeVString=function(t,e){var r=void 0===e;if(r&&(e=this.offset),!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var n,i,o=e;n=f.calculateUTF16asUTF8(a(t),this.noAssert)[1],i=d.calculateVarint32(n),e+=i+n;var s=this.buffer.byteLength;if(s<e&&this.resize((s*=2)>e?s:e),e-=i+n,e+=this.writeVarint32(n,e),f.encodeUTF16toUTF8(a(t),function(t){this.view[e++]=t}.bind(this)),e!==o+n+i)throw RangeError("Illegal range: Truncated data, "+e+" == "+(e+n+i));return r?(this.offset=e,this):e-o},s.readVString=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var r=t,n=this.readVarint32(t),i=this.readUTF8String(n.value,d.METRICS_BYTES,t+=n.length);return t+=i.length,e?(this.offset=t,i.string):{string:i.string,length:t-r}},s.append=function(t,e,r){"number"!=typeof e&&"string"==typeof e||(r=e,e=void 0);var n=void 0===r;if(n&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}t instanceof d||(t=d.wrap(t,e));var i=t.limit-t.offset;if(i<=0)return this;r+=i;var o=this.buffer.byteLength;return o<r&&this.resize((o*=2)>r?o:r),r-=i,this.view.set(t.view.subarray(t.offset,t.limit),r),t.offset+=i,n&&(this.offset+=i),this},s.appendTo=function(t,e){return t.append(this,e),this},s.assert=function(t){return this.noAssert=!t,this},s.capacity=function(){return this.buffer.byteLength},s.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},s.clone=function(t){var e=new d(0,this.littleEndian,this.noAssert);return t?(e.buffer=new ArrayBuffer(this.buffer.byteLength),e.view=new Uint8Array(e.buffer)):(e.buffer=this.buffer,e.view=this.view),e.offset=this.offset,e.markedOffset=this.markedOffset,e.limit=this.limit,e},s.compact=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||e<t||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}if(0===t&&e===this.buffer.byteLength)return this;var r=e-t;if(0===r)return this.buffer=o,this.view=null,0<=this.markedOffset&&(this.markedOffset-=t),this.offset=0,this.limit=0,this;var n=new ArrayBuffer(r),i=new Uint8Array(n);return i.set(this.view.subarray(t,e)),this.buffer=n,this.view=i,0<=this.markedOffset&&(this.markedOffset-=t),this.offset=0,this.limit=r,this},s.copy=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||e<t||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}if(t===e)return new d(0,this.littleEndian,this.noAssert);var r=e-t,n=new d(r,this.littleEndian,this.noAssert);return n.offset=0,n.limit=r,0<=n.markedOffset&&(n.markedOffset-=t),this.copyTo(n,0,t,e),n},s.copyTo=function(t,e,r,n){var i,o;if(!this.noAssert&&!d.isByteBuffer(t))throw TypeError("Illegal target: Not a ByteBuffer");if(e=(o=void 0===e)?t.offset:0|e,r=(i=void 0===r)?this.offset:0|r,n=void 0===n?this.limit:0|n,e<0||e>t.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+e+" <= "+t.buffer.byteLength);if(r<0||n>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+r+" <= "+this.buffer.byteLength);var s=n-r;return 0===s?t:(t.ensureCapacity(e+s),t.view.set(this.view.subarray(r,n),e),i&&(this.offset+=s),o&&(t.offset+=s),this)},s.ensureCapacity=function(t){var e=this.buffer.byteLength;return e<t?this.resize((e*=2)>t?e:t):this},s.fill=function(t,e,r){var n=void 0===e;if(n&&(e=this.offset),"string"==typeof t&&0<t.length&&(t=t.charCodeAt(0)),void 0===e&&(e=this.offset),void 0===r&&(r=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal end: Not an integer");if(r>>>=0,e<0||r<e||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+r+" <= "+this.buffer.byteLength)}if(r<=e)return this;for(;e<r;)this.view[e++]=t;return n&&(this.offset=e),this},s.flip=function(){return this.limit=this.offset,this.offset=0,this},s.mark=function(t){if(t=void 0===t?this.offset:t,!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=t,this},s.order=function(t){if(!this.noAssert&&"boolean"!=typeof t)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!t,this},s.LE=function(t){return this.littleEndian=void 0===t||!!t,this},s.BE=function(t){return this.littleEndian=void 0!==t&&!t,this},s.prepend=function(t,e,r){"number"!=typeof e&&"string"==typeof e||(r=e,e=void 0);var n=void 0===r;if(n&&(r=this.offset),!this.noAssert){if("number"!=typeof r||r%1!=0)throw TypeError("Illegal offset: "+r+" (not an integer)");if((r>>>=0)<0||r+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+r+" (+0) <= "+this.buffer.byteLength)}t instanceof d||(t=d.wrap(t,e));var i=t.limit-t.offset;if(i<=0)return this;var o=i-r;if(0<o){var s=new ArrayBuffer(this.buffer.byteLength+o),a=new Uint8Array(s);a.set(this.view.subarray(r,this.buffer.byteLength),i),this.buffer=s,this.view=a,this.offset+=o,0<=this.markedOffset&&(this.markedOffset+=o),this.limit+=o,r+=o}else new Uint8Array(this.buffer);return this.view.set(t.view.subarray(t.offset,t.limit),r-i),t.offset=t.limit,n&&(this.offset-=i),this},s.prependTo=function(t,e){return t.prepend(this,e),this},s.printDebug=function(t){"function"!=typeof t&&(t=console.log.bind(console)),t(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},s.remaining=function(){return this.limit-this.offset},s.reset=function(){return 0<=this.markedOffset?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},s.resize=function(t){if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal capacity: "+t+" (not an integer)");if((t|=0)<0)throw RangeError("Illegal capacity: 0 <= "+t)}if(this.buffer.byteLength<t){var e=new ArrayBuffer(t),r=new Uint8Array(e);r.set(this.view),this.buffer=e,this.view=r}return this},s.reverse=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||e<t||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}return t===e||Array.prototype.reverse.call(this.view.subarray(t,e)),this},s.skip=function(t){if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal length: "+t+" (not an integer)");t|=0}var e=this.offset+t;if(!this.noAssert&&(e<0||e>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+t+" <= "+this.buffer.byteLength);return this.offset=e,this},s.slice=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||e<t||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}var r=this.clone();return r.offset=t,r.limit=e,r},s.toBuffer=function(t){var e=this.offset,r=this.limit;if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: Not an integer");if(e>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal limit: Not an integer");if(r>>>=0,e<0||r<e||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+r+" <= "+this.buffer.byteLength)}if(!t&&0===e&&r===this.buffer.byteLength)return this.buffer;if(e===r)return o;var n=new ArrayBuffer(r-e);return new Uint8Array(n).set(new Uint8Array(this.buffer).subarray(e,r),0),n},s.toArrayBuffer=s.toBuffer,s.toString=function(t,e,r){if(void 0===t)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof t&&(r=e=t="utf8"),t){case"utf8":return this.toUTF8(e,r);case"base64":return this.toBase64(e,r);case"hex":return this.toHex(e,r);case"binary":return this.toBinary(e,r);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+t)}};var c=function(){for(var t={},i=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],s=[],e=0,r=i.length;e<r;++e)s[i[e]]=e;return t.encode=function(t,e){for(var r,n;null!==(r=t());)e(i[r>>2&63]),n=(3&r)<<4,null!==(r=t())?(e(i[63&((n|=r>>4&15)|r>>4&15)]),n=(15&r)<<2,null!==(r=t())?(e(i[63&(n|r>>6&3)]),e(i[63&r])):(e(i[63&n]),e(61))):(e(i[63&n]),e(61),e(61))},t.decode=function(t,e){var r,n,i;function o(t){throw Error("Illegal character code: "+t)}for(;null!==(r=t());)if(void 0===(n=s[r])&&o(r),null!==(r=t())&&(void 0===(i=s[r])&&o(r),e(n<<2>>>0|(48&i)>>4),null!==(r=t()))){if(void 0===(n=s[r])){if(61===r)break;o(r)}if(e((15&i)<<4>>>0|(60&n)>>2),null!==(r=t())){if(void 0===(i=s[r])){if(61===r)break;o(r)}e((3&n)<<6>>>0|i)}}},t.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)},t}();s.toBase64=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),e|=0,(t|=0)<0||e>this.capacity||e<t)throw RangeError("begin, end");var r;return c.encode(function(){return t<e?this.view[t++]:null}.bind(this),r=u()),r()},d.fromBase64=function(t,e){if("string"!=typeof t)throw TypeError("str");var r=new d(t.length/4*3,e),n=0;return c.decode(a(t),function(t){r.view[n++]=t}),r.limit=n,r},d.btoa=function(t){return d.fromBinary(t).toBase64()},d.atob=function(t){return d.fromBase64(t).toBinary()},s.toBinary=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),e|=0,(t|=0)<0||e>this.capacity()||e<t)throw RangeError("begin, end");if(t===e)return"";for(var r=[],n=[];t<e;)r.push(this.view[t++]),1024<=r.length&&(n.push(String.fromCharCode.apply(String,r)),r=[]);return n.join("")+String.fromCharCode.apply(String,r)},d.fromBinary=function(t,e){if("string"!=typeof t)throw TypeError("str");for(var r,n=0,i=t.length,o=new d(i,e);n<i;){if(255<(r=t.charCodeAt(n)))throw RangeError("illegal char code: "+r);o.view[n++]=r}return o.limit=i,o},s.toDebug=function(t){for(var e,r=-1,n=this.buffer.byteLength,i="",o="",s="";r<n;){if(-1!==r&&(i+=(e=this.view[r])<16?"0"+e.toString(16).toUpperCase():e.toString(16).toUpperCase(),t&&(o+=32<e&&e<127?String.fromCharCode(e):".")),++r,t&&0<r&&r%16==0&&r!==n){for(;i.length<51;)i+=" ";s+=i+o+"\n",i=o=""}r===this.offset&&r===this.limit?i+=r===this.markedOffset?"!":"|":r===this.offset?i+=r===this.markedOffset?"[":"<":r===this.limit?i+=r===this.markedOffset?"]":">":i+=r===this.markedOffset?"'":t||0!==r&&r!==n?" ":""}if(t&&" "!==i){for(;i.length<51;)i+=" ";s+=i+o+"\n"}return t?s:i},d.fromDebug=function(t,e,r){for(var n,i,o=t.length,s=new d((o+1)/3|0,e,r),a=0,l=0,u=!1,c=!1,h=!1,f=!1,p=!1;a<o;){switch(n=t.charAt(a++)){case"!":if(!r){if(c||h||f){p=!0;break}c=h=f=!0}s.offset=s.markedOffset=s.limit=l,u=!1;break;case"|":if(!r){if(c||f){p=!0;break}c=f=!0}s.offset=s.limit=l,u=!1;break;case"[":if(!r){if(c||h){p=!0;break}c=h=!0}s.offset=s.markedOffset=l,u=!1;break;case"<":if(!r){if(c){p=!0;break}c=!0}s.offset=l,u=!1;break;case"]":if(!r){if(f||h){p=!0;break}f=h=!0}s.limit=s.markedOffset=l,u=!1;break;case">":if(!r){if(f){p=!0;break}f=!0}s.limit=l,u=!1;break;case"'":if(!r){if(h){p=!0;break}h=!0}s.markedOffset=l,u=!1;break;case" ":u=!1;break;default:if(!r&&u){p=!0;break}if(i=parseInt(n+t.charAt(a++),16),!r&&(isNaN(i)||i<0||255<i))throw TypeError("Illegal str: Not a debug encoded string");s.view[l++]=i,u=!0}if(p)throw TypeError("Illegal str: Invalid symbol at "+a)}if(!r){if(!c||!f)throw TypeError("Illegal str: Missing offset or limit");if(l<s.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+l+" < "+o)}return s},s.toHex=function(t,e){if(t=void 0===t?this.offset:t,e=void 0===e?this.limit:e,!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||e<t||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}for(var r,n=new Array(e-t);t<e;)(r=this.view[t++])<16?n.push("0",r.toString(16)):n.push(r.toString(16));return n.join("")},d.fromHex=function(t,e,r){if(!r){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if(t.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var n,i=t.length,o=new d(i/2|0,e),s=0,a=0;s<i;s+=2){if(n=parseInt(t.substring(s,s+2),16),!r&&(!isFinite(n)||n<0||255<n))throw TypeError("Illegal str: Contains non-hex characters");o.view[a++]=n}return o.limit=a,o};var h,f=h={MAX_CODEPOINT:1114111,encodeUTF8:function(t,e){var r=null;for("number"==typeof t&&(r=t,t=function(){return null});null!==r||null!==(r=t());)r<128?e(127&r):(r<2048?e(r>>6&31|192):(r<65536?e(r>>12&15|224):(e(r>>18&7|240),e(r>>12&63|128)),e(r>>6&63|128)),e(63&r|128)),r=null},decodeUTF8:function(t,e){for(var r,n,i,o,s=function(t){t=t.slice(0,t.indexOf(null));var e=Error(t.toString());throw e.name="TruncatedError",e.bytes=t,e};null!==(r=t());)if(0==(128&r))e(r);else if(192==(224&r))null===(n=t())&&s([r,n]),e((31&r)<<6|63&n);else if(224==(240&r))(null===(n=t())||null===(i=t()))&&s([r,n,i]),e((15&r)<<12|(63&n)<<6|63&i);else{if(240!=(248&r))throw RangeError("Illegal starting byte: "+r);(null===(n=t())||null===(i=t())||null===(o=t()))&&s([r,n,i,o]),e((7&r)<<18|(63&n)<<12|(63&i)<<6|63&o)}},UTF16toUTF8:function(t,e){for(var r,n=null;null!==(r=null!==n?n:t());)55296<=r&&r<=57343&&null!==(n=t())&&56320<=n&&n<=57343?(e(1024*(r-55296)+n-56320+65536),n=null):e(r);null!==n&&e(n)},UTF8toUTF16:function(t,e){var r=null;for("number"==typeof t&&(r=t,t=function(){return null});null!==r||null!==(r=t());)r<=65535?e(r):(e(55296+((r-=65536)>>10)),e(r%1024+56320)),r=null},encodeUTF16toUTF8:function(t,e){h.UTF16toUTF8(t,function(t){h.encodeUTF8(t,e)})},decodeUTF8toUTF16:function(t,e){h.decodeUTF8(t,function(t){h.UTF8toUTF16(t,e)})},calculateCodePoint:function(t){return t<128?1:t<2048?2:t<65536?3:4},calculateUTF8:function(t){for(var e,r=0;null!==(e=t());)r+=e<128?1:e<2048?2:e<65536?3:4;return r},calculateUTF16asUTF8:function(t){var e=0,r=0;return h.UTF16toUTF8(t,function(t){++e,r+=t<128?1:t<2048?2:t<65536?3:4}),[e,r]}};return s.toUTF8=function(e,r){if(void 0===e&&(e=this.offset),void 0===r&&(r=this.limit),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof r||r%1!=0)throw TypeError("Illegal end: Not an integer");if(r>>>=0,e<0||r<e||r>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+r+" <= "+this.buffer.byteLength)}var t;try{f.decodeUTF8toUTF16(function(){return e<r?this.view[e++]:null}.bind(this),t=u())}catch(t){if(e!==r)throw RangeError("Illegal range: Truncated data, "+e+" != "+r)}return t()},d.fromUTF8=function(t,e,r){if(!r&&"string"!=typeof t)throw TypeError("Illegal str: Not a string");var n=new d(f.calculateUTF16asUTF8(a(t),!0)[1],e,r),i=0;return f.encodeUTF16toUTF8(a(t),function(t){n.view[i++]=t}),n.limit=i,n},d}),function(t,e){"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&"object"==typeof exports?module.exports=t():e.log4javascript=t()}(function(){function isUndefined(t){return void 0===t}function EventSupport(){}Array.prototype.push||(Array.prototype.push=function(){for(var t=0,e=arguments.length;t<e;t++)this[this.length]=arguments[t];return this.length}),Array.prototype.shift||(Array.prototype.shift=function(){if(0<this.length){for(var t=this[0],e=0,r=this.length-1;e<r;e++)this[e]=this[e+1];return this.length=this.length-1,t}}),Array.prototype.splice||(Array.prototype.splice=function(t,e){var r=this.slice(t+e),n=this.slice(t,t+e);this.length=t;for(var i=[],o=0,s=arguments.length;o<s;o++)i[o]=arguments[o];var a=2<i.length?r=i.slice(2).concat(r):r;for(o=0,s=a.length;o<s;o++)this.push(a[o]);return n}),EventSupport.prototype={eventTypes:[],eventListeners:{},setEventTypes:function(t){if(t instanceof Array){this.eventTypes=t,this.eventListeners={};for(var e=0,r=this.eventTypes.length;e<r;e++)this.eventListeners[this.eventTypes[e]]=[]}else handleError("log4javascript.EventSupport ["+this+"]: setEventTypes: eventTypes parameter must be an Array")},addEventListener:function(t,e){"function"==typeof e?(array_contains(this.eventTypes,t)||handleError("log4javascript.EventSupport ["+this+"]: addEventListener: no event called '"+t+"'"),this.eventListeners[t].push(e)):handleError("log4javascript.EventSupport ["+this+"]: addEventListener: listener must be a function")},removeEventListener:function(t,e){"function"==typeof e?(array_contains(this.eventTypes,t)||handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: no event called '"+t+"'"),array_remove(this.eventListeners[t],e)):handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: listener must be a function")},dispatchEvent:function(t,e){if(array_contains(this.eventTypes,t))for(var r=this.eventListeners[t],n=0,i=r.length;n<i;n++)r[n](this,t,e);else handleError("log4javascript.EventSupport ["+this+"]: dispatchEvent: no event called '"+t+"'")}};var applicationStartDate=new Date,uniqueId="log4javascript_"+applicationStartDate.getTime()+"_"+Math.floor(1e8*Math.random()),emptyFunction=function(){},newLine="\r\n",pageLoaded=!1;function Log4JavaScript(){}Log4JavaScript.prototype=new EventSupport;var log4javascript=new Log4JavaScript;function toStr(t){return t&&t.toString?t.toString():String(t)}function getExceptionMessage(t){return t.message?t.message:t.description?t.description:toStr(t)}function getUrlFileName(t){var e=Math.max(t.lastIndexOf("/"),t.lastIndexOf("\\"));return t.substr(e+1)}function getExceptionStringRep(t){if(t){var e="Exception: "+getExceptionMessage(t);try{t.lineNumber&&(e+=" on line number "+t.lineNumber),t.fileName&&(e+=" in file "+getUrlFileName(t.fileName))}catch(t){logLog.warn("Unable to obtain file and line information for error")}return showStackTraces&&t.stack&&(e+=newLine+"Stack trace:"+newLine+t.stack),e}return null}function bool(t){return Boolean(t)}function trim(t){return t.replace(/^\s+/,"").replace(/\s+$/,"")}function splitIntoLines(t){return t.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n")}log4javascript.version="1.4.11",log4javascript.edition="log4javascript";var urlEncode=void 0!==window.encodeURIComponent?function(t){return encodeURIComponent(t)}:function(t){return escape(t).replace(/\+/g,"%2B").replace(/"/g,"%22").replace(/'/g,"%27").replace(/\//g,"%2F").replace(/=/g,"%3D")};function array_remove(t,e){for(var r=-1,n=0,i=t.length;n<i;n++)if(t[n]===e){r=n;break}return 0<=r&&(t.splice(r,1),!0)}function array_contains(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]==e)return!0;return!1}function extractBooleanFromParam(t,e){return isUndefined(t)?e:bool(t)}function extractStringFromParam(t,e){return isUndefined(t)?e:String(t)}function extractIntFromParam(e,r){if(isUndefined(e))return r;try{var t=parseInt(e,10);return isNaN(t)?r:t}catch(t){return logLog.warn("Invalid int param "+e,t),r}}function extractFunctionFromParam(t,e){return"function"==typeof t?t:e}function isError(t){return t instanceof Error}Function.prototype.apply||(Function.prototype.apply=function(obj,args){var methodName="__apply__";void 0!==obj[methodName]&&(methodName+=String(Math.random()).substr(2)),obj[methodName]=this;for(var argsStrings=[],i=0,len=args.length;i<len;i++)argsStrings[i]="args["+i+"]";var script="obj."+methodName+"("+argsStrings.join(",")+")",returnValue=eval(script);return delete obj[methodName],returnValue}),Function.prototype.call||(Function.prototype.call=function(t){for(var e=[],r=1,n=arguments.length;r<n;r++)e[r-1]=arguments[r];return this.apply(t,e)});var logLog={quietMode:!1,debugMessages:[],setQuietMode:function(t){this.quietMode=bool(t)},numberOfErrors:0,alertAllErrors:!1,setAlertAllErrors:function(t){this.alertAllErrors=t},debug:function(t){this.debugMessages.push(t)},displayDebug:function(){alert(this.debugMessages.join(newLine))},warn:function(t,e){},error:function(t,e){if((1==++this.numberOfErrors||this.alertAllErrors)&&!this.quietMode){var r="log4javascript error: "+t;e&&(r+=newLine+newLine+"Original error: "+getExceptionStringRep(e)),alert(r)}}};function handleError(t,e){logLog.error(t,e),log4javascript.dispatchEvent("error",{message:t,exception:e})}log4javascript.logLog=logLog,log4javascript.setEventTypes(["load","error"]),log4javascript.handleError=handleError;var enabled=!("undefined"!=typeof log4javascript_disabled&&log4javascript_disabled);log4javascript.setEnabled=function(t){enabled=bool(t)},log4javascript.isEnabled=function(){return enabled};var useTimeStampsInMilliseconds=!0;log4javascript.setTimeStampsInMilliseconds=function(t){useTimeStampsInMilliseconds=bool(t)},log4javascript.isTimeStampsInMilliseconds=function(){return useTimeStampsInMilliseconds},log4javascript.evalInScope=function(expr){return eval(expr)};var showStackTraces=!1;log4javascript.setShowStackTraces=function(t){showStackTraces=bool(t)};var Level=function(t,e){this.level=t,this.name=e};function Timer(t,e){this.name=t,this.level=isUndefined(e)?Level.INFO:e,this.start=new Date}Level.prototype={toString:function(){return this.name},equals:function(t){return this.level==t.level},isGreaterOrEqual:function(t){return this.level>=t.level}},Level.ALL=new Level(Number.MIN_VALUE,"ALL"),Level.TRACE=new Level(1e4,"TRACE"),Level.DEBUG=new Level(2e4,"DEBUG"),Level.INFO=new Level(3e4,"INFO"),Level.WARN=new Level(4e4,"WARN"),Level.ERROR=new Level(5e4,"ERROR"),Level.FATAL=new Level(6e4,"FATAL"),Level.OFF=new Level(Number.MAX_VALUE,"OFF"),log4javascript.Level=Level,Timer.prototype.getElapsedTime=function(){return(new Date).getTime()-this.start.getTime()};var anonymousLoggerName="[anonymous]",defaultLoggerName="[default]",nullLoggerName="[null]",rootLoggerName="root";function Logger(t){this.name=t,this.parent=null,this.children=[];var r=[],e=null,n=this.name===rootLoggerName,i=this.name===nullLoggerName,o=null,s=!1;this.addChild=function(t){this.children.push(t),t.parent=this,t.invalidateAppenderCache()};var a=!0;this.getAdditivity=function(){return a},this.setAdditivity=function(t){var e=a!=t;a=t,e&&this.invalidateAppenderCache()},this.addAppender=function(t){i?handleError("Logger.addAppender: you may not add an appender to the null logger"):t instanceof log4javascript.Appender?array_contains(r,t)||(r.push(t),t.setAddedToLogger(this),this.invalidateAppenderCache()):handleError("Logger.addAppender: appender supplied ('"+toStr(t)+"') is not a subclass of Appender")},this.removeAppender=function(t){array_remove(r,t),t.setRemovedFromLogger(this),this.invalidateAppenderCache()},this.removeAllAppenders=function(){var t=r.length;if(0<t){for(var e=0;e<t;e++)r[e].setRemovedFromLogger(this);r.length=0,this.invalidateAppenderCache()}},this.getEffectiveAppenders=function(){if(null===o||s){var t=n||!this.getAdditivity()?[]:this.parent.getEffectiveAppenders();o=t.concat(r),s=!1}return o},this.invalidateAppenderCache=function(){s=!0;for(var t=0,e=this.children.length;t<e;t++)this.children[t].invalidateAppenderCache()},this.log=function(t,e){if(enabled&&t.isGreaterOrEqual(this.getEffectiveLevel())){var r,n=e.length-1,i=e[n];1<e.length&&isError(i)&&(r=i,n--);for(var o=[],s=0;s<=n;s++)o[s]=e[s];var a=new LoggingEvent(this,new Date,t,o,r);this.callAppenders(a),bugout&&(t==Level.TRACE?bugout.trace(o.toString()):t==Level.DEBUG?bugout.debug(o.toString()):t==Level.INFO?bugout.info(o.toString()):t==Level.ERROR?bugout.error(o.toString()):bugout.info(o.toString()))}"undefined"!=typeof logAjax&&logAjax.enabled&&t.level>=logAjax.level&&saveLog(t.name,e[0],e[1])},this.callAppenders=function(t){for(var e=this.getEffectiveAppenders(),r=0,n=e.length;r<n;r++)e[r].doAppend(t)},this.setLevel=function(t){n&&null===t?handleError("Logger.setLevel: you cannot set the level of the root logger to null"):t instanceof Level?e=t:handleError("Logger.setLevel: level supplied to logger "+this.name+" is not an instance of log4javascript.Level")},this.getLevel=function(){return e},this.getEffectiveLevel=function(){for(var t=this;null!==t;t=t.parent){var e=t.getLevel();if(null!==e)return e}},this.group=function(t,e){if(enabled)for(var r=this.getEffectiveAppenders(),n=0,i=r.length;n<i;n++)r[n].group(t,e)},this.groupEnd=function(){if(enabled)for(var t=this.getEffectiveAppenders(),e=0,r=t.length;e<r;e++)t[e].groupEnd()};var l={};this.time=function(t,e){enabled&&(isUndefined(t)?handleError("Logger.time: a name for the timer must be supplied"):!e||e instanceof Level?l[t]=new Timer(t,e):handleError("Logger.time: level supplied to timer "+t+" is not an instance of log4javascript.Level"))},this.timeEnd=function(t){if(enabled)if(isUndefined(t))handleError("Logger.timeEnd: a name for the timer must be supplied");else if(l[t]){var e=l[t],r=e.getElapsedTime();this.log(e.level,["Timer "+toStr(t)+" completed in "+r+"ms"]),delete l[t]}else logLog.warn("Logger.timeEnd: no timer found with name "+t)},this.assert=function(t){if(enabled&&!t){for(var e=[],r=1,n=arguments.length;r<n;r++)e.push(arguments[r]);(e=0<e.length?e:["Assertion Failure"]).push(newLine),e.push(t),this.log(Level.ERROR,e)}},this.toString=function(){return"Logger["+this.name+"]"}}Logger.prototype={trace:function(){this.log(Level.TRACE,arguments)},debug:function(){this.log(Level.DEBUG,arguments)},info:function(){this.log(Level.INFO,arguments)},warn:function(){this.log(Level.WARN,arguments)},error:function(){this.log(Level.ERROR,arguments)},fatal:function(){this.log(Level.FATAL,arguments)},isEnabledFor:function(t){return t.isGreaterOrEqual(this.getEffectiveLevel())},isTraceEnabled:function(){return this.isEnabledFor(Level.TRACE)},isDebugEnabled:function(){return this.isEnabledFor(Level.DEBUG)},isInfoEnabled:function(){return this.isEnabledFor(Level.INFO)},isWarnEnabled:function(){return this.isEnabledFor(Level.WARN)},isErrorEnabled:function(){return this.isEnabledFor(Level.ERROR)},isFatalEnabled:function(){return this.isEnabledFor(Level.FATAL)}},Logger.prototype.trace.isEntryPoint=!0,Logger.prototype.debug.isEntryPoint=!0,Logger.prototype.info.isEntryPoint=!0,Logger.prototype.warn.isEntryPoint=!0,Logger.prototype.error.isEntryPoint=!0,Logger.prototype.fatal.isEntryPoint=!0;var loggers={},loggerNames=[],ROOT_LOGGER_DEFAULT_LEVEL=Level.DEBUG,rootLogger=new Logger(rootLoggerName);rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL),log4javascript.getRootLogger=function(){return rootLogger},log4javascript.getLogger=function(t){if("string"!=typeof t&&(t=anonymousLoggerName,logLog.warn("log4javascript.getLogger: non-string logger name "+toStr(t)+" supplied, returning anonymous logger")),t==rootLoggerName&&handleError("log4javascript.getLogger: root logger may not be obtained by name"),!loggers[t]){var e=new Logger(t);loggers[t]=e,loggerNames.push(t);var r,n=t.lastIndexOf(".");if(-1<n){var i=t.substring(0,n);r=log4javascript.getLogger(i)}else r=rootLogger;r.addChild(e)}return loggers[t]};var defaultLogger=null;log4javascript.getDefaultLogger=function(){return defaultLogger||(defaultLogger=createDefaultLogger()),defaultLogger};var nullLogger=null;log4javascript.getNullLogger=function(){return nullLogger||(nullLogger=new Logger(nullLoggerName)).setLevel(Level.OFF),nullLogger},log4javascript.resetConfiguration=function(){rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL),loggers={}};var LoggingEvent=function(t,e,r,n,i){this.logger=t,this.timeStamp=e,this.timeStampInMilliseconds=e.getTime(),this.timeStampInSeconds=Math.floor(this.timeStampInMilliseconds/1e3),this.milliseconds=this.timeStamp.getMilliseconds(),this.level=r,this.messages=n,this.exception=i};LoggingEvent.prototype={getThrowableStrRep:function(){return this.exception?getExceptionStringRep(this.exception):""},getCombinedMessages:function(){return 1==this.messages.length?this.messages[0]:this.messages.join(newLine)},toString:function(){return"LoggingEvent["+this.level+"]"}},log4javascript.LoggingEvent=LoggingEvent;var Layout=function(){};Layout.prototype={defaults:{loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url"},loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url",batchHeader:"",batchFooter:"",batchSeparator:"",returnsPostData:!1,overrideTimeStampsSetting:!1,useTimeStampsInMilliseconds:null,format:function(){handleError("Layout.format: layout supplied has no format() method")},ignoresThrowable:function(){handleError("Layout.ignoresThrowable: layout supplied has no ignoresThrowable() method")},getContentType:function(){return"text/plain"},allowBatching:function(){return!0},setTimeStampsInMilliseconds:function(t){this.overrideTimeStampsSetting=!0,this.useTimeStampsInMilliseconds=bool(t)},isTimeStampsInMilliseconds:function(){return this.overrideTimeStampsSetting?this.useTimeStampsInMilliseconds:useTimeStampsInMilliseconds},getTimeStampValue:function(t){return this.isTimeStampsInMilliseconds()?t.timeStampInMilliseconds:t.timeStampInSeconds},getDataValues:function(t,e){var r=[[this.loggerKey,t.logger.name],[this.timeStampKey,this.getTimeStampValue(t)],[this.levelKey,t.level.name],[this.urlKey,window.location.href],[this.messageKey,e?t.getCombinedMessages():t.messages]];if(this.isTimeStampsInMilliseconds()||r.push([this.millisecondsKey,t.milliseconds]),t.exception&&r.push([this.exceptionKey,getExceptionStringRep(t.exception)]),this.hasCustomFields())for(var n=0,i=this.customFields.length;n<i;n++){var o=this.customFields[n].value;"function"==typeof o&&(o=o(this,t)),r.push([this.customFields[n].name,o])}return r},setKeys:function(t,e,r,n,i,o,s){this.loggerKey=extractStringFromParam(t,this.defaults.loggerKey),this.timeStampKey=extractStringFromParam(e,this.defaults.timeStampKey),this.levelKey=extractStringFromParam(r,this.defaults.levelKey),this.messageKey=extractStringFromParam(n,this.defaults.messageKey),this.exceptionKey=extractStringFromParam(i,this.defaults.exceptionKey),this.urlKey=extractStringFromParam(o,this.defaults.urlKey),this.millisecondsKey=extractStringFromParam(s,this.defaults.millisecondsKey)},setCustomField:function(t,e){for(var r=!1,n=0,i=this.customFields.length;n<i;n++)this.customFields[n].name===t&&(this.customFields[n].value=e,r=!0);r||this.customFields.push({name:t,value:e})},hasCustomFields:function(){return 0<this.customFields.length},formatWithException:function(t){var e=this.format(t);return t.exception&&this.ignoresThrowable()&&(e+=t.getThrowableStrRep()),e},toString:function(){handleError("Layout.toString: all layouts must override this method")}},log4javascript.Layout=Layout;var Appender=function(){},SimpleDateFormat;function SimpleLayout(){this.customFields=[]}function NullLayout(){this.customFields=[]}function XmlLayout(t){this.combineMessages=extractBooleanFromParam(t,!0),this.customFields=[]}function escapeNewLines(t){return t.replace(/\r\n|\r|\n/g,"\\r\\n")}function JsonLayout(t,e){this.readable=extractBooleanFromParam(t,!1),this.combineMessages=extractBooleanFromParam(e,!0),this.batchHeader=this.readable?"["+newLine:"[",this.batchFooter=this.readable?"]"+newLine:"]",this.batchSeparator=this.readable?","+newLine:",",this.setKeys(),this.colon=this.readable?": ":":",this.tab=this.readable?"\t":"",this.lineBreak=this.readable?newLine:"",this.customFields=[]}function HttpPostDataLayout(){this.setKeys(),this.customFields=[],this.returnsPostData=!0}function formatObjectExpansion(t,e,r){var f=[];return function t(e,r,i){var n,o,s,a,l,u,c;function h(t){for(var e=splitIntoLines(t),r=1,n=e.length;r<n;r++)e[r]=i+e[r];return e.join(newLine)}if(i||(i=""),null===e)return"null";if(void 0===e)return"undefined";if("string"==typeof e)return h(e);if("object"==typeof e&&array_contains(f,e)){try{u=toStr(e)}catch(t){u="Error formatting property. Details: "+getExceptionStringRep(t)}return u+" [already expanded]"}if(e instanceof Array&&0<r){for(f.push(e),u="["+newLine,s=r-1,a=i+"  ",l=[],n=0,o=e.length;n<o;n++)try{c=t(e[n],s,a),l.push(a+c)}catch(t){l.push(a+"Error formatting array member. Details: "+getExceptionStringRep(t))}return u+=l.join(","+newLine)+newLine+i+"]"}if("[object Date]"==Object.prototype.toString.call(e))return e.toString();if("object"==typeof e&&0<r){for(n in f.push(e),u="{"+newLine,s=r-1,a=i+"  ",l=[],e)try{c=t(e[n],s,a),l.push(a+n+": "+c)}catch(t){l.push(a+n+": Error formatting property. Details: "+getExceptionStringRep(t))}return u+=l.join(","+newLine)+newLine+i+"}"}return h(toStr(e))}(t,e,r)}function PatternLayout(t){this.pattern=t||PatternLayout.DEFAULT_CONVERSION_PATTERN,this.customFields=[]}function AlertAppender(){}function BrowserConsoleAppender(){}Appender.prototype=new EventSupport,Appender.prototype.layout=new PatternLayout,Appender.prototype.threshold=Level.ALL,Appender.prototype.loggers=[],Appender.prototype.doAppend=function(t){enabled&&t.level.level>=this.threshold.level&&this.append(t)},Appender.prototype.append=function(t){},Appender.prototype.setLayout=function(t){t instanceof Layout?this.layout=t:handleError("Appender.setLayout: layout supplied to "+this.toString()+" is not a subclass of Layout")},Appender.prototype.getLayout=function(){return this.layout},Appender.prototype.setThreshold=function(t){t instanceof Level?this.threshold=t:handleError("Appender.setThreshold: threshold supplied to "+this.toString()+" is not a subclass of Level")},Appender.prototype.getThreshold=function(){return this.threshold},Appender.prototype.setAddedToLogger=function(t){this.loggers.push(t)},Appender.prototype.setRemovedFromLogger=function(t){array_remove(this.loggers,t)},Appender.prototype.group=emptyFunction,Appender.prototype.groupEnd=emptyFunction,Appender.prototype.toString=function(){handleError("Appender.toString: all appenders must override this method")},log4javascript.Appender=Appender,SimpleLayout.prototype=new Layout,SimpleLayout.prototype.format=function(t){return t.level.name+" - "+t.getCombinedMessages()},SimpleLayout.prototype.ignoresThrowable=function(){return!0},SimpleLayout.prototype.toString=function(){return"SimpleLayout"},log4javascript.SimpleLayout=SimpleLayout,NullLayout.prototype=new Layout,NullLayout.prototype.format=function(t){return t.messages},NullLayout.prototype.ignoresThrowable=function(){return!0},NullLayout.prototype.formatWithException=function(t){var e=t.messages,r=t.exception;return r?e.concat([r]):e},NullLayout.prototype.toString=function(){return"NullLayout"},log4javascript.NullLayout=NullLayout,XmlLayout.prototype=new Layout,XmlLayout.prototype.isCombinedMessages=function(){return this.combineMessages},XmlLayout.prototype.getContentType=function(){return"text/xml"},XmlLayout.prototype.escapeCdata=function(t){return t.replace(/\]\]>/,"]]>]]&gt;<![CDATA[")},XmlLayout.prototype.format=function(t){var e,r,n=this;function i(t){return t="string"==typeof t?t:toStr(t),"<log4javascript:message><![CDATA["+n.escapeCdata(t)+"]]></log4javascript:message>"}var o='<log4javascript:event logger="'+t.logger.name+'" timestamp="'+this.getTimeStampValue(t)+'"';if(this.isTimeStampsInMilliseconds()||(o+=' milliseconds="'+t.milliseconds+'"'),o+=' level="'+t.level.name+'">'+newLine,this.combineMessages)o+=i(t.getCombinedMessages());else{for(o+="<log4javascript:messages>"+newLine,e=0,r=t.messages.length;e<r;e++)o+=i(t.messages[e])+newLine;o+="</log4javascript:messages>"+newLine}if(this.hasCustomFields())for(e=0,r=this.customFields.length;e<r;e++)o+='<log4javascript:customfield name="'+this.customFields[e].name+'"><![CDATA['+this.customFields[e].value.toString()+"]]></log4javascript:customfield>"+newLine;return t.exception&&(o+="<log4javascript:exception><![CDATA["+getExceptionStringRep(t.exception)+"]]></log4javascript:exception>"+newLine),o+="</log4javascript:event>"+newLine+newLine},XmlLayout.prototype.ignoresThrowable=function(){return!1},XmlLayout.prototype.toString=function(){return"XmlLayout"},log4javascript.XmlLayout=XmlLayout,JsonLayout.prototype=new Layout,JsonLayout.prototype.isReadable=function(){return this.readable},JsonLayout.prototype.isCombinedMessages=function(){return this.combineMessages},JsonLayout.prototype.format=function(t){var e,r,l=this,n=this.getDataValues(t,this.combineMessages),i="{"+this.lineBreak;function u(t,e,r){var n,i=typeof t;if(t instanceof Date)n=String(t.getTime());else if(r&&t instanceof Array){n="["+l.lineBreak;for(var o=0,s=t.length;o<s;o++){var a=e+l.tab;n+=a+u(t[o],a,!1),o<t.length-1&&(n+=","),n+=l.lineBreak}n+=e+"]"}else n="number"!==i&&"boolean"!==i?'"'+escapeNewLines(toStr(t).replace(/\"/g,'\\"'))+'"':t;return n}for(e=0,r=n.length-1;e<=r;e++)i+=this.tab+'"'+n[e][0]+'"'+this.colon+u(n[e][1],this.tab,!0),e<r&&(i+=","),i+=this.lineBreak;return i+="}"+this.lineBreak},JsonLayout.prototype.ignoresThrowable=function(){return!1},JsonLayout.prototype.toString=function(){return"JsonLayout"},JsonLayout.prototype.getContentType=function(){return"application/json"},log4javascript.JsonLayout=JsonLayout,HttpPostDataLayout.prototype=new Layout,HttpPostDataLayout.prototype.allowBatching=function(){return!1},HttpPostDataLayout.prototype.format=function(t){for(var e=this.getDataValues(t),r=[],n=0,i=e.length;n<i;n++){var o=e[n][1]instanceof Date?String(e[n][1].getTime()):e[n][1];r.push(urlEncode(e[n][0])+"="+urlEncode(o))}return r.join("&")},HttpPostDataLayout.prototype.ignoresThrowable=function(t){return!1},HttpPostDataLayout.prototype.toString=function(){return"HttpPostDataLayout"},log4javascript.HttpPostDataLayout=HttpPostDataLayout,function(){var g=/('[^']*')|(G+|y+|M+|w+|W+|D+|d+|F+|E+|a+|H+|k+|K+|h+|m+|s+|S+|Z+)|([a-zA-Z]+)|([^a-zA-Z']+)/,m=["January","February","March","April","May","June","July","August","September","October","November","December"],v=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],y={G:0,y:3,M:4,w:2,W:2,D:2,d:2,F:2,E:1,a:0,H:2,k:2,K:2,h:2,m:2,s:2,S:2,Z:5},i=function(t,e,r){var n=new Date(t,e,r,0,0,0);return n.setMilliseconds(0),n};Date.prototype.getDifference=function(t){return this.getTime()-t.getTime()},Date.prototype.isBefore=function(t){return this.getTime()<t.getTime()},Date.prototype.getUTCTime=function(){return Date.UTC(this.getFullYear(),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds())},Date.prototype.getTimeSince=function(t){return this.getUTCTime()-t.getUTCTime()},Date.prototype.getPreviousSunday=function(){var t=new Date(this.getFullYear(),this.getMonth(),this.getDate(),12,0,0),e=new Date(t.getTime()-864e5*this.getDay());return i(e.getFullYear(),e.getMonth(),e.getDate())},Date.prototype.getWeekInYear=function(t){isUndefined(this.minimalDaysInFirstWeek)&&(t=1);var e=this.getPreviousSunday(),r=i(this.getFullYear(),0,1),n=e.isBefore(r)?0:1+Math.floor(e.getTimeSince(r)/6048e5);return 7-r.getDay()<t&&n--,n},Date.prototype.getWeekInMonth=function(t){isUndefined(this.minimalDaysInFirstWeek)&&(t=1);var e=this.getPreviousSunday(),r=i(this.getFullYear(),this.getMonth(),1),n=e.isBefore(r)?0:1+Math.floor(e.getTimeSince(r)/6048e5);return t<=7-r.getDay()&&n++,n},Date.prototype.getDayInYear=function(){var t=i(this.getFullYear(),0,1);return 1+Math.floor(this.getTimeSince(t)/864e5)},(SimpleDateFormat=function(t){this.formatString=t}).prototype.setMinimalDaysInFirstWeek=function(t){this.minimalDaysInFirstWeek=t},SimpleDateFormat.prototype.getMinimalDaysInFirstWeek=function(){return isUndefined(this.minimalDaysInFirstWeek)?1:this.minimalDaysInFirstWeek};var b=function(t,e){for(;t.length<e;)t="0"+t;return t},w=function(t,e,r){return 4<=e?t:t.substr(0,Math.max(r,e))},E=function(t,e){return b(""+t,e)};SimpleDateFormat.prototype.format=function(t){for(var e,r="",n=this.formatString;e=g.exec(n);){var i=e[1],o=e[2],s=e[3],a=e[4];if(i)r+="''"==i?"'":i.substring(1,i.length-1);else if(s);else if(a)r+=a;else if(o){var l=o.charAt(0),u=o.length,c="";switch(l){case"G":c="AD";break;case"y":c=t.getFullYear();break;case"M":c=t.getMonth();break;case"w":c=t.getWeekInYear(this.getMinimalDaysInFirstWeek());break;case"W":c=t.getWeekInMonth(this.getMinimalDaysInFirstWeek());break;case"D":c=t.getDayInYear();break;case"d":c=t.getDate();break;case"F":c=1+Math.floor((t.getDate()-1)/7);break;case"E":c=v[t.getDay()];break;case"a":c=12<=t.getHours()?"PM":"AM";break;case"H":c=t.getHours();break;case"k":c=t.getHours()||24;break;case"K":c=t.getHours()%12;break;case"h":c=t.getHours()%12||12;break;case"m":c=t.getMinutes();break;case"s":c=t.getSeconds();break;case"S":c=t.getMilliseconds();break;case"Z":c=t.getTimezoneOffset()}switch(y[l]){case 0:r+=w(c,u,2);break;case 1:r+=w(c,u,3);break;case 2:r+=E(c,u);break;case 3:if(u<=3)r+=(""+c).substr(2,2);else r+=E(c,u);break;case 4:r+=3<=u?w(m[c],u,u):E(c+1,u);break;case 5:var h=0<c?"-":"+",f=Math.abs(c),p=""+Math.floor(f/60),d=""+f%60;r+=h+(p=b(p,2))+(d=b(d,2))}}n=n.substr(e.index+e[0].length)}return r}}(),log4javascript.SimpleDateFormat=SimpleDateFormat,PatternLayout.TTCC_CONVERSION_PATTERN="%r %p %c - %m%n",PatternLayout.DEFAULT_CONVERSION_PATTERN="%m%n",PatternLayout.ISO8601_DATEFORMAT="yyyy-MM-dd HH:mm:ss,SSS",PatternLayout.DATETIME_DATEFORMAT="dd MMM yyyy HH:mm:ss,SSS",PatternLayout.ABSOLUTETIME_DATEFORMAT="HH:mm:ss,SSS",PatternLayout.prototype=new Layout,PatternLayout.prototype.format=function(t){for(var e,r=/%(-?[0-9]+)?(\.?[0-9]+)?([acdfmMnpr%])(\{([^\}]+)\})?|([^%]+)/,n="",i=this.pattern;e=r.exec(i);){var o=e[0],s=e[1],a=e[2],l=e[3],u=e[5],c=e[6];if(c)n+=""+c;else{var h,f="";switch(l){case"a":case"m":var p=0;u&&(p=parseInt(u,10),isNaN(p)&&(handleError("PatternLayout.format: invalid specifier '"+u+"' for conversion character '"+l+"' - should be a number"),p=0));for(var d="a"===l?t.messages[0]:t.messages,g=0,m=d.length;g<m;g++)0<g&&" "!==f.charAt(f.length-1)&&(f+=" "),f+=0===p?d[g]:formatObjectExpansion(d[g],p);break;case"c":var v=t.logger.name;if(u){var y=parseInt(u,10),b=t.logger.name.split(".");f=y>=b.length?v:b.slice(b.length-y).join(".")}else f=v;break;case"d":var w=PatternLayout.ISO8601_DATEFORMAT;u&&("ISO8601"==(w=u)?w=PatternLayout.ISO8601_DATEFORMAT:"ABSOLUTE"==w?w=PatternLayout.ABSOLUTETIME_DATEFORMAT:"DATE"==w&&(w=PatternLayout.DATETIME_DATEFORMAT)),f=new SimpleDateFormat(w).format(t.timeStamp);break;case"f":if(this.hasCustomFields()){var E=0;u&&(E=parseInt(u,10),isNaN(E)?handleError("PatternLayout.format: invalid specifier '"+u+"' for conversion character 'f' - should be a number"):0===E?handleError("PatternLayout.format: invalid specifier '"+u+"' for conversion character 'f' - must be greater than zero"):E>this.customFields.length?handleError("PatternLayout.format: invalid specifier '"+u+"' for conversion character 'f' - there aren't that many custom fields"):E-=1);var _=this.customFields[E].value;"function"==typeof _&&(_=_(this,t)),f=_}break;case"n":f=newLine;break;case"p":f=t.level.name;break;case"r":f=""+t.timeStamp.getDifference(applicationStartDate);break;case"%":f="%";break;default:f=o}if(a){h=parseInt(a.substr(1),10);var S=f.length;h<S&&(f=f.substring(S-h,S))}if(s)if("-"==s.charAt(0))for(h=parseInt(s.substr(1),10);f.length<h;)f+=" ";else for(h=parseInt(s,10);f.length<h;)f=" "+f;n+=f}i=i.substr(e.index+e[0].length)}return n},PatternLayout.prototype.ignoresThrowable=function(){return!0},PatternLayout.prototype.toString=function(){return"PatternLayout"},log4javascript.PatternLayout=PatternLayout,AlertAppender.prototype=new Appender,AlertAppender.prototype.layout=new SimpleLayout,AlertAppender.prototype.append=function(t){alert(this.getLayout().formatWithException(t))},AlertAppender.prototype.toString=function(){return"AlertAppender"},log4javascript.AlertAppender=AlertAppender,BrowserConsoleAppender.prototype=new log4javascript.Appender,BrowserConsoleAppender.prototype.layout=new NullLayout,BrowserConsoleAppender.prototype.threshold=Level.DEBUG,BrowserConsoleAppender.prototype.append=function(e){var t,r=this,n=function(){var t=r.getLayout().formatWithException(e);return"string"==typeof t?[t]:t};if((t=window.console)&&t.log){var i,o=n();t[i=t.debug&&Level.DEBUG.isGreaterOrEqual(e.level)?"debug":t.info&&Level.INFO.equals(e.level)?"info":t.warn&&Level.WARN.equals(e.level)?"warn":t.error&&e.level.isGreaterOrEqual(Level.ERROR)?"error":"log"].apply?t[i].apply(t,o):t[i](o)}else"undefined"!=typeof opera&&opera.postError&&opera.postError(n())},BrowserConsoleAppender.prototype.group=function(t){window.console&&window.console.group&&window.console.group(t)},BrowserConsoleAppender.prototype.groupEnd=function(){window.console&&window.console.groupEnd&&window.console.groupEnd()},BrowserConsoleAppender.prototype.toString=function(){return"BrowserConsoleAppender"},log4javascript.BrowserConsoleAppender=BrowserConsoleAppender;var xhrFactory=function(){return new XMLHttpRequest},xmlHttpFactories=[xhrFactory,function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],withCredentialsSupported=!1,getXmlHttp=function(t){for(var e,r=null,n=0,i=xmlHttpFactories.length;n<i;n++){e=xmlHttpFactories[n];try{return r=e(),withCredentialsSupported=e==xhrFactory&&"withCredentials"in r,getXmlHttp=e,r}catch(t){}}t?t():handleError("getXmlHttp: unable to obtain XMLHttpRequest object")},ConsoleAppender;function isHttpRequestSuccessful(t){return isUndefined(t.status)||0===t.status||200<=t.status&&t.status<300||1223==t.status}function AjaxAppender(a,l){var i=this,u=!0;a||(handleError("AjaxAppender: URL must be specified in constructor"),u=!1);var o=this.defaults.timed,s=this.defaults.waitForResponse,c=this.defaults.batchSize,e=this.defaults.timerInterval,h=this.defaults.requestSuccessCallback,f=this.defaults.failCallback,p=this.defaults.postVarName,d=this.defaults.sendAllOnUnload,g=this.defaults.contentType,r=null,m=[],v=[],y=[],b=!1,w=!1;function n(t){return!w||(handleError("AjaxAppender: configuration option '"+t+"' may not be set after the appender has been initialized"),!1)}function E(){var t;if(u&&enabled)if(b=!0,s)0<v.length?C(S(t=v.shift()),E):(b=!1,o&&T());else{for(;t=v.shift();)C(S(t));b=!1,o&&T()}}function _(){var t=!1;if(u&&enabled){for(var e,r=i.getLayout().allowBatching()?c:1,n=[];e=m.shift();)n.push(e),m.length>=r&&(v.push(n),n=[]);0<n.length&&v.push(n),t=0<v.length,o=s=!1,E()}return t}function S(t){for(var e,r=[],n="";e=t.shift();)r.push(i.getLayout().formatWithException(e));return n=1==t.length?r.join(""):i.getLayout().batchHeader+r.join(i.getLayout().batchSeparator)+i.getLayout().batchFooter,g==i.defaults.contentType&&(0<(n=i.getLayout().returnsPostData?n:urlEncode(p)+"="+urlEncode(n)).length&&(n+="&"),n+="layout="+urlEncode(i.getLayout().toString())),n}function T(){window.setTimeout(E,e)}function I(){var t="AjaxAppender: could not create XMLHttpRequest object. AjaxAppender disabled";handleError(t),u=!1,f&&f(t)}function C(t,e){try{var r=getXmlHttp(I);if(u){r.onreadystatechange=function(){if(4==r.readyState){if(isHttpRequestSuccessful(r))h&&h(r),e&&e(r);else{var t="AjaxAppender.append: XMLHttpRequest request to URL "+a+" returned status code "+r.status;handleError(t),f&&f(t)}r.onreadystatechange=emptyFunction,r=null}},r.open("POST",a,!0),l&&withCredentialsSupported&&(r.withCredentials=!0);try{for(var n,i=0;n=y[i++];)r.setRequestHeader(n.name,n.value);r.setRequestHeader("Content-Type",g)}catch(t){var o="AjaxAppender.append: your browser's XMLHttpRequest implementation does not support setRequestHeader, therefore cannot post data. AjaxAppender disabled";return handleError(o),u=!1,void(f&&f(o))}r.send(t)}}catch(t){var s="AjaxAppender.append: error sending log message to "+a;handleError(s,t),u=!1,f&&f(s+". Details: "+getExceptionStringRep(t))}}this.getSessionId=function(){return r},this.setSessionId=function(t){r=extractStringFromParam(t,null),this.layout.setCustomField("sessionid",r)},this.setLayout=function(t){n("layout")&&(this.layout=t,null!==r&&this.setSessionId(r))},this.isTimed=function(){return o},this.setTimed=function(t){n("timed")&&(o=bool(t))},this.getTimerInterval=function(){return e},this.setTimerInterval=function(t){n("timerInterval")&&(e=extractIntFromParam(t,e))},this.isWaitForResponse=function(){return s},this.setWaitForResponse=function(t){n("waitForResponse")&&(s=bool(t))},this.getBatchSize=function(){return c},this.setBatchSize=function(t){n("batchSize")&&(c=extractIntFromParam(t,c))},this.isSendAllOnUnload=function(){return d},this.setSendAllOnUnload=function(t){n("sendAllOnUnload")&&(d=extractBooleanFromParam(t,d))},this.setRequestSuccessCallback=function(t){h=extractFunctionFromParam(t,h)},this.setFailCallback=function(t){f=extractFunctionFromParam(t,f)},this.getPostVarName=function(){return p},this.setPostVarName=function(t){n("postVarName")&&(p=extractStringFromParam(t,p))},this.getHeaders=function(){return y},this.addHeader=function(t,e){"content-type"==t.toLowerCase()?g=e:y.push({name:t,value:e})},this.sendAll=E,this.sendAllRemaining=_,this.append=function(t){if(u){w||function(){if(w=!0,d){var t=window.onbeforeunload;window.onbeforeunload=function(){t&&t(),_()}}o&&T()}(),m.push(t);var e=this.getLayout().allowBatching()?c:1;if(m.length>=e){for(var r,n=[];r=m.shift();)n.push(r);v.push(n),o||s&&(!s||b)||E()}}}}function setCookie(t,e,r,n){var i;if(n=n?"; path="+n:"",r){var o=new Date;o.setTime(o.getTime()+24*r*60*60*1e3),i="; expires="+o.toGMTString()}else i="";document.cookie=escape(t)+"="+escape(e)+i+n}function getCookie(t){for(var e=escape(t)+"=",r=document.cookie.split(";"),n=0,i=r.length;n<i;n++){for(var o=r[n];" "===o.charAt(0);)o=o.substring(1,o.length);if(0===o.indexOf(e))return unescape(o.substring(e.length,o.length))}return null}function getBaseUrl(){for(var t=document.getElementsByTagName("script"),e=0,r=t.length;e<r;++e)if(-1!=t[e].src.indexOf("log4javascript")){var n=t[e].src.lastIndexOf("/");return-1==n?"":t[e].src.substr(0,n+1)}return null}function isLoaded(t){try{return bool(t.loaded)}catch(t){return!1}}function padWithSpaces(t,e){if(t.length<e){for(var r=[],n=Math.max(0,e-t.length),i=0;i<n;i++)r[i]=" ";t+=r.join("")}return t}function createDefaultLogger(){var t=log4javascript.getLogger(defaultLoggerName),e=new log4javascript.PopUpAppender;return t.addAppender(e),t}if(AjaxAppender.prototype=new Appender,AjaxAppender.prototype.defaults={waitForResponse:!1,timed:!1,timerInterval:1e3,batchSize:1,sendAllOnUnload:!1,requestSuccessCallback:null,failCallback:null,postVarName:"data",contentType:"application/x-www-form-urlencoded"},AjaxAppender.prototype.layout=new HttpPostDataLayout,AjaxAppender.prototype.toString=function(){return"AjaxAppender"},log4javascript.AjaxAppender=AjaxAppender,function(){var tt=[],et=1;function t(t,e,r,n,i){this.create(!1,null,t,e,r,n,i,this.defaults.focusPopUp)}function e(t,e,r,n,i,o){this.create(!0,t,e,r,n,i,o,!1)}(ConsoleAppender=function(){}).prototype=new Appender,ConsoleAppender.prototype.create=function(t,r,e,a,l,u,c,n){var p=this,i=!1,h=!1,f=!1,d=!1,o=[],g=!0,m=et++;a=extractBooleanFromParam(a,this.defaults.initiallyMinimized),e=extractBooleanFromParam(e,this.defaults.lazyInit),l=extractBooleanFromParam(l,this.defaults.useDocumentWrite);var s=this.defaults.newestMessageAtTop,v=this.defaults.scrollToLatestMessage;u=u||this.defaults.width,c=c||this.defaults.height;var y,b,w,E,_,S=this.defaults.maxMessages,T=this.defaults.showCommandLine,I=this.defaults.commandLineObjectExpansionDepth,C=this.defaults.showHideButton,x=this.defaults.showCloseButton;this.setLayout(this.defaults.layout);var L=t?"InPageAppender":"PopUpAppender",A=function(t){return!h||(handleError(L+": configuration option '"+t+"' may not be set after the appender has been initialized"),!1)},M=function(){return f&&g&&!d};this.isNewestMessageAtTop=function(){return s},this.setNewestMessageAtTop=function(t){s=bool(t),M()&&E().setNewestAtTop(s)},this.isScrollToLatestMessage=function(){return v},this.setScrollToLatestMessage=function(t){v=bool(t),M()&&E().setScrollToLatest(v)},this.getWidth=function(){return u},this.setWidth=function(t){A("width")&&(u=extractStringFromParam(t,u))},this.getHeight=function(){return c},this.setHeight=function(t){A("height")&&(c=extractStringFromParam(t,c))},this.getMaxMessages=function(){return S},this.setMaxMessages=function(t){S=extractIntFromParam(t,S),M()&&E().setMaxMessages(S)},this.isShowCommandLine=function(){return T},this.setShowCommandLine=function(t){T=bool(t),M()&&E().setShowCommandLine(T)},this.isShowHideButton=function(){return C},this.setShowHideButton=function(t){C=bool(t),M()&&E().setShowHideButton(C)},this.isShowCloseButton=function(){return x},this.setShowCloseButton=function(t){x=bool(t),M()&&E().setShowCloseButton(x)},this.getCommandLineObjectExpansionDepth=function(){return I},this.setCommandLineObjectExpansionDepth=function(t){I=extractIntFromParam(t,I)};var R=a;function k(t,e){this.loggingEvent=t,this.levelName=t.level.name,this.formattedMessage=e}function N(t,e){this.name=t,this.initiallyExpanded=e}function O(){}this.isInitiallyMinimized=function(){return a},this.setInitiallyMinimized=function(t){A("initiallyMinimized")&&(a=bool(t),R=a)},this.isUseDocumentWrite=function(){return l},this.setUseDocumentWrite=function(t){A("useDocumentWrite")&&(l=bool(t))},k.prototype.append=function(){E().log(this.levelName,this.formattedMessage)},N.prototype.append=function(){E().group(this.name,this.initiallyExpanded)},O.prototype.append=function(){E().groupEnd()};var P=function(){w(),i?d&&Q&&b():y(),w()&&j()};this.append=function(t){if(g){var e=p.getLayout().formatWithException(t);o.push(new k(t,e)),P()}},this.group=function(t,e){g&&(o.push(new N(t,e)),P())},this.groupEnd=function(){g&&(o.push(new O),P())};var j=function(){for(;0<o.length;)o.shift().append();n&&E().focus()};this.setAddedToLogger=function(t){this.loggers.push(t),enabled&&!e&&y()},this.clear=function(){M()&&E().clearLog(),o.length=0},this.focus=function(){M()&&E().focus()},this.focusCommandLine=function(){M()&&E().focusCommandLine()},this.focusSearch=function(){M()&&E().focusSearch()};var U=window;this.getCommandWindow=function(){return U},this.setCommandWindow=function(t){U=t},this.executeLastCommand=function(){M()&&E().evalLastCommand()};var D=new PatternLayout("%m");this.getCommandLayout=function(){return D},this.setCommandLayout=function(t){D=t},this.evalCommandAndAppend=function(t){var e={appendResult:!0,isError:!1},r="";try{var n,i;!U.eval&&U.execScript&&U.execScript("null");var o={};for(i=0,len=B.length;i<len;i++)o[B[i][0]]=B[i][1];var s=[],a=function(t){s.push([t,U[t]])};a("appender"),U.appender=p,a("commandReturnValue"),U.commandReturnValue=e,a("commandLineFunctionsHash"),U.commandLineFunctionsHash=o;var l=function(t){a(t),U[t]=function(){return this.commandLineFunctionsHash[t](p,arguments,e)}};for(i=0,len=B.length;i<len;i++)l(B[i][0]);for(r=isUndefined(n=U===window&&U.execScript?(a("evalExpr"),a("result"),window.evalExpr=t,U.execScript("window.result=eval(window.evalExpr);"),window.result):U.eval(t))?n:formatObjectExpansion(n,I),i=0,len=s.length;i<len;i++)U[s[i][0]]=s[i][1]}catch(t){r="Error evaluating command: "+getExceptionStringRep(t),e.isError=!0}if(e.appendResult){var u=">>> "+t;isUndefined(r)||(u+=newLine+r);var c=e.isError?Level.ERROR:Level.INFO,h=new LoggingEvent(null,new Date,c,[u],null),f=this.getLayout();this.setLayout(D),this.append(h),this.setLayout(f)}};var B=tt.concat([]);this.addCommandLineFunction=function(t,e){B.push([t,e])};var F="log4javascriptCommandHistory";this.storeCommandHistory=function(t){setCookie(F,t.join(","))};var V=function(t){var e=['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">','<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">',"\t<head>","\t\t<title>log4javascript</title>",'\t\t<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />',"\t\t\x3c!-- Make IE8 behave like IE7, having gone to all the trouble of making IE work --\x3e",'\t\t<meta http-equiv="X-UA-Compatible" content="IE=7" />','\t\t<script type="text/javascript">var isIe = false, isIePre7 = false;<\/script>','\t\t\x3c!--[if IE]><script type="text/javascript">isIe = true<\/script><![endif]--\x3e','\t\t\x3c!--[if lt IE 7]><script type="text/javascript">isIePre7 = true<\/script><![endif]--\x3e','\t\t<script type="text/javascript">',"\t\t\t//<![CDATA[","\t\t\tvar loggingEnabled = true;","\t\t\tvar logQueuedEventsTimer = null;","\t\t\tvar logEntries = [];","\t\t\tvar logEntriesAndSeparators = [];","\t\t\tvar logItems = [];","\t\t\tvar renderDelay = 100;","\t\t\tvar unrenderedLogItemsExist = false;","\t\t\tvar rootGroup, currentGroup = null;","\t\t\tvar loaded = false;","\t\t\tvar currentLogItem = null;","\t\t\tvar logMainContainer;","","\t\t\tfunction copyProperties(obj, props) {","\t\t\t\tfor (var i in props) {","\t\t\t\t\tobj[i] = props[i];","\t\t\t\t}","\t\t\t}","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItem() {","\t\t\t}","","\t\t\tLogItem.prototype = {","\t\t\t\tmainContainer: null,","\t\t\t\twrappedContainer: null,","\t\t\t\tunwrappedContainer: null,","\t\t\t\tgroup: null,","","\t\t\t\tappendToLog: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].appendToLog();","\t\t\t\t\t}","\t\t\t\t\tthis.group.update();","\t\t\t\t},","","\t\t\t\tdoRemove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tif (this.rendered) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].remove();","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.unwrappedElementContainer = null;","\t\t\t\t\t\tthis.wrappedElementContainer = null;","\t\t\t\t\t\tthis.mainElementContainer = null;","\t\t\t\t\t}","\t\t\t\t\tif (this.group && removeFromGroup) {","\t\t\t\t\t\tthis.group.removeChild(this, doUpdate);","\t\t\t\t\t}","\t\t\t\t\tif (this === currentLogItem) {","\t\t\t\t\t\tcurrentLogItem = null;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tthis.doRemove(doUpdate, removeFromGroup);","\t\t\t\t},","","\t\t\t\trender: function() {},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visit(this);","\t\t\t\t},","","\t\t\t\tgetUnwrappedDomContainer: function() {","\t\t\t\t\treturn this.group.unwrappedElementContainer.contentDiv;","\t\t\t\t},","","\t\t\t\tgetWrappedDomContainer: function() {","\t\t\t\t\treturn this.group.wrappedElementContainer.contentDiv;","\t\t\t\t},","","\t\t\t\tgetMainDomContainer: function() {","\t\t\t\t\treturn this.group.mainElementContainer.contentDiv;","\t\t\t\t}","\t\t\t};","","\t\t\tLogItem.serializedItemKeys = {LOG_ENTRY: 0, GROUP_START: 1, GROUP_END: 2};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemContainerElement() {","\t\t\t}","","\t\t\tLogItemContainerElement.prototype = {","\t\t\t\tappendToLog: function() {","\t\t\t\t\tvar insertBeforeFirst = (newestAtTop && this.containerDomNode.hasChildNodes());","\t\t\t\t\tif (insertBeforeFirst) {","\t\t\t\t\t\tthis.containerDomNode.insertBefore(this.mainDiv, this.containerDomNode.firstChild);","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.containerDomNode.appendChild(this.mainDiv);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction SeparatorElementContainer(containerDomNode) {","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "separator";','\t\t\t\tthis.mainDiv.innerHTML = "&nbsp;";',"\t\t\t}","","\t\t\tSeparatorElementContainer.prototype = new LogItemContainerElement();","","\t\t\tSeparatorElementContainer.prototype.remove = function() {","\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\tthis.mainDiv = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction Separator() {","\t\t\t\tthis.rendered = false;","\t\t\t}","","\t\t\tSeparator.prototype = new LogItem();","","\t\t\tcopyProperties(Separator.prototype, {","\t\t\t\trender: function() {","\t\t\t\t\tvar containerDomNode = this.group.contentDiv;","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tthis.unwrappedElementContainer = new SeparatorElementContainer(this.getUnwrappedDomContainer());","\t\t\t\t\t\tthis.wrappedElementContainer = new SeparatorElementContainer(this.getWrappedDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.mainElementContainer = new SeparatorElementContainer(this.getMainDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.content = this.formattedMessage;","\t\t\t\t\tthis.rendered = true;","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction GroupElementContainer(group, containerDomNode, isRoot, isWrapped) {","\t\t\t\tthis.group = group;","\t\t\t\tthis.containerDomNode = containerDomNode;","\t\t\t\tthis.isRoot = isRoot;","\t\t\t\tthis.isWrapped = isWrapped;","\t\t\t\tthis.expandable = false;","","\t\t\t\tif (this.isRoot) {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tthis.contentDiv = logMainContainer.appendChild(document.createElement("div"));','\t\t\t\t\t\tthis.contentDiv.id = this.isWrapped ? "log_wrapped" : "log_unwrapped";',"\t\t\t\t\t} else {","\t\t\t\t\t\tthis.contentDiv = logMainContainer;","\t\t\t\t\t}","\t\t\t\t} else {","\t\t\t\t\tvar groupElementContainer = this;","\t\t\t\t\t",'\t\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\t\tthis.mainDiv.className = "group";',"",'\t\t\t\t\tthis.headingDiv = this.mainDiv.appendChild(document.createElement("div"));','\t\t\t\t\tthis.headingDiv.className = "groupheading";',"",'\t\t\t\t\tthis.expander = this.headingDiv.appendChild(document.createElement("span"));','\t\t\t\t\tthis.expander.className = "expander unselectable greyedout";',"\t\t\t\t\tthis.expander.unselectable = true;",'\t\t\t\t\tvar expanderText = this.group.expanded ? "-" : "+";',"\t\t\t\t\tthis.expanderTextNode = this.expander.appendChild(document.createTextNode(expanderText));","\t\t\t\t\t",'\t\t\t\t\tthis.headingDiv.appendChild(document.createTextNode(" " + this.group.name));',"",'\t\t\t\t\tthis.contentDiv = this.mainDiv.appendChild(document.createElement("div"));','\t\t\t\t\tvar contentCssClass = this.group.expanded ? "expanded" : "collapsed";','\t\t\t\t\tthis.contentDiv.className = "groupcontent " + contentCssClass;',"","\t\t\t\t\tthis.expander.onclick = function() {","\t\t\t\t\t\tif (groupElementContainer.group.expandable) {","\t\t\t\t\t\t\tgroupElementContainer.group.toggleExpanded();","\t\t\t\t\t\t}","\t\t\t\t\t};","\t\t\t\t}","\t\t\t}","","\t\t\tGroupElementContainer.prototype = new LogItemContainerElement();","","\t\t\tcopyProperties(GroupElementContainer.prototype, {","\t\t\t\ttoggleExpanded: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tvar oldCssClass, newCssClass, expanderText;","\t\t\t\t\t\tif (this.group.expanded) {",'\t\t\t\t\t\t\tnewCssClass = "expanded";','\t\t\t\t\t\t\toldCssClass = "collapsed";','\t\t\t\t\t\t\texpanderText = "-";',"\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\tnewCssClass = "collapsed";','\t\t\t\t\t\t\toldCssClass = "expanded";','\t\t\t\t\t\t\texpanderText = "+";',"\t\t\t\t\t\t}","\t\t\t\t\t\treplaceClass(this.contentDiv, newCssClass, oldCssClass);","\t\t\t\t\t\tthis.expanderTextNode.nodeValue = expanderText;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tthis.headingDiv = null;","\t\t\t\t\t\tthis.expander.onclick = null;","\t\t\t\t\t\tthis.expander = null;","\t\t\t\t\t\tthis.expanderTextNode = null;","\t\t\t\t\t\tthis.contentDiv = null;","\t\t\t\t\t\tthis.containerDomNode = null;","\t\t\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\t\t\tthis.mainDiv = null;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\treverseChildren: function() {","\t\t\t\t\t// Invert the order of the log entries","\t\t\t\t\tvar node = null;","","\t\t\t\t\t// Remove all the log container nodes","\t\t\t\t\tvar childDomNodes = [];","\t\t\t\t\twhile ((node = this.contentDiv.firstChild)) {","\t\t\t\t\t\tthis.contentDiv.removeChild(node);","\t\t\t\t\t\tchildDomNodes.push(node);","\t\t\t\t\t}","","\t\t\t\t\t// Put them all back in reverse order","\t\t\t\t\twhile ((node = childDomNodes.pop())) {","\t\t\t\t\t\tthis.contentDiv.appendChild(node);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tupdate: function() {","\t\t\t\t\tif (!this.isRoot) {","\t\t\t\t\t\tif (this.group.expandable) {",'\t\t\t\t\t\t\tremoveClass(this.expander, "greyedout");',"\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\taddClass(this.expander, "greyedout");',"\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclear: function() {","\t\t\t\t\tif (this.isRoot) {",'\t\t\t\t\t\tthis.contentDiv.innerHTML = "";',"\t\t\t\t\t}","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction Group(name, isRoot, initiallyExpanded) {","\t\t\t\tthis.name = name;","\t\t\t\tthis.group = null;","\t\t\t\tthis.isRoot = isRoot;","\t\t\t\tthis.initiallyExpanded = initiallyExpanded;","\t\t\t\tthis.elementContainers = [];","\t\t\t\tthis.children = [];","\t\t\t\tthis.expanded = initiallyExpanded;","\t\t\t\tthis.rendered = false;","\t\t\t\tthis.expandable = false;","\t\t\t}","","\t\t\tGroup.prototype = new LogItem();","","\t\t\tcopyProperties(Group.prototype, {","\t\t\t\taddChild: function(logItem) {","\t\t\t\t\tthis.children.push(logItem);","\t\t\t\t\tlogItem.group = this;","\t\t\t\t},","","\t\t\t\trender: function() {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tvar unwrappedDomContainer, wrappedDomContainer;","\t\t\t\t\t\tif (this.isRoot) {","\t\t\t\t\t\t\tunwrappedDomContainer = logMainContainer;","\t\t\t\t\t\t\twrappedDomContainer = logMainContainer;","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tunwrappedDomContainer = this.getUnwrappedDomContainer();","\t\t\t\t\t\t\twrappedDomContainer = this.getWrappedDomContainer();","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.unwrappedElementContainer = new GroupElementContainer(this, unwrappedDomContainer, this.isRoot, false);","\t\t\t\t\t\tthis.wrappedElementContainer = new GroupElementContainer(this, wrappedDomContainer, this.isRoot, true);","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tvar mainDomContainer = this.isRoot ? logMainContainer : this.getMainDomContainer();","\t\t\t\t\t\tthis.mainElementContainer = new GroupElementContainer(this, mainDomContainer, this.isRoot, false);","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.rendered = true;","\t\t\t\t},","","\t\t\t\ttoggleExpanded: function() {","\t\t\t\t\tthis.expanded = !this.expanded;","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].toggleExpanded();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\texpand: function() {","\t\t\t\t\tif (!this.expanded) {","\t\t\t\t\t\tthis.toggleExpanded();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visitGroup(this);","\t\t\t\t},","","\t\t\t\treverseChildren: function() {","\t\t\t\t\tif (this.rendered) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].reverseChildren();","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tupdate: function() {","\t\t\t\t\tvar previouslyExpandable = this.expandable;","\t\t\t\t\tthis.expandable = (this.children.length !== 0);","\t\t\t\t\tif (this.expandable !== previouslyExpandable) {","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].update();","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tflatten: function() {","\t\t\t\t\tvar visitor = new GroupFlattener();","\t\t\t\t\tthis.accept(visitor);","\t\t\t\t\treturn visitor.logEntriesAndSeparators;","\t\t\t\t},","","\t\t\t\tremoveChild: function(child, doUpdate) {","\t\t\t\t\tarray_remove(this.children, child);","\t\t\t\t\tchild.group = null;","\t\t\t\t\tif (doUpdate) {","\t\t\t\t\t\tthis.update();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tremove: function(doUpdate, removeFromGroup) {","\t\t\t\t\tfor (var i = 0, len = this.children.length; i < len; i++) {","\t\t\t\t\t\tthis.children[i].remove(false, false);","\t\t\t\t\t}","\t\t\t\t\tthis.children = [];","\t\t\t\t\tthis.update();","\t\t\t\t\tif (this === currentGroup) {","\t\t\t\t\t\tcurrentGroup = this.group;","\t\t\t\t\t}","\t\t\t\t\tthis.doRemove(doUpdate, removeFromGroup);","\t\t\t\t},","","\t\t\t\tserialize: function(items) {","\t\t\t\t\titems.push([LogItem.serializedItemKeys.GROUP_START, this.name]);","\t\t\t\t\tfor (var i = 0, len = this.children.length; i < len; i++) {","\t\t\t\t\t\tthis.children[i].serialize(items);","\t\t\t\t\t}","\t\t\t\t\tif (this !== currentGroup) {","\t\t\t\t\t\titems.push([LogItem.serializedItemKeys.GROUP_END]);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclear: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].clear();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryElementContainer() {","\t\t\t}","","\t\t\tLogEntryElementContainer.prototype = new LogItemContainerElement();","","\t\t\tcopyProperties(LogEntryElementContainer.prototype, {","\t\t\t\tremove: function() {","\t\t\t\t\tthis.doRemove();","\t\t\t\t},","","\t\t\t\tdoRemove: function() {","\t\t\t\t\tthis.mainDiv.parentNode.removeChild(this.mainDiv);","\t\t\t\t\tthis.mainDiv = null;","\t\t\t\t\tthis.contentElement = null;","\t\t\t\t\tthis.containerDomNode = null;","\t\t\t\t},","","\t\t\t\tsetContent: function(content, wrappedContent) {","\t\t\t\t\tif (content === this.formattedMessage) {",'\t\t\t\t\t\tthis.contentElement.innerHTML = "";',"\t\t\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.formattedMessage));","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.contentElement.innerHTML = content;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tsetSearchMatch: function(isMatch) {",'\t\t\t\t\tvar oldCssClass = isMatch ? "searchnonmatch" : "searchmatch";','\t\t\t\t\tvar newCssClass = isMatch ? "searchmatch" : "searchnonmatch";',"\t\t\t\t\treplaceClass(this.mainDiv, newCssClass, oldCssClass);","\t\t\t\t},","","\t\t\t\tclearSearch: function() {",'\t\t\t\t\tremoveClass(this.mainDiv, "searchmatch");','\t\t\t\t\tremoveClass(this.mainDiv, "searchnonmatch");',"\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryWrappedElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");',"\t\t\t\tthis.mainDiv.appendChild(document.createTextNode(this.logEntry.formattedMessage));",'\t\t\t\tthis.mainDiv.className = "logentry wrapped " + this.logEntry.level;',"\t\t\t\tthis.contentElement = this.mainDiv;","\t\t\t}","","\t\t\tLogEntryWrappedElementContainer.prototype = new LogEntryElementContainer();","","\t\t\tLogEntryWrappedElementContainer.prototype.setContent = function(content, wrappedContent) {","\t\t\t\tif (content === this.formattedMessage) {",'\t\t\t\t\tthis.contentElement.innerHTML = "";',"\t\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.formattedMessage));","\t\t\t\t} else {","\t\t\t\t\tthis.contentElement.innerHTML = wrappedContent;","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryUnwrappedElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "logentry unwrapped " + this.logEntry.level;','\t\t\t\tthis.pre = this.mainDiv.appendChild(document.createElement("pre"));',"\t\t\t\tthis.pre.appendChild(document.createTextNode(this.logEntry.formattedMessage));",'\t\t\t\tthis.pre.className = "unwrapped";',"\t\t\t\tthis.contentElement = this.pre;","\t\t\t}","","\t\t\tLogEntryUnwrappedElementContainer.prototype = new LogEntryElementContainer();","","\t\t\tLogEntryUnwrappedElementContainer.prototype.remove = function() {","\t\t\t\tthis.doRemove();","\t\t\t\tthis.pre = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntryMainElementContainer(logEntry, containerDomNode) {","\t\t\t\tthis.logEntry = logEntry;","\t\t\t\tthis.containerDomNode = containerDomNode;",'\t\t\t\tthis.mainDiv = document.createElement("div");','\t\t\t\tthis.mainDiv.className = "logentry nonielogentry " + this.logEntry.level;','\t\t\t\tthis.contentElement = this.mainDiv.appendChild(document.createElement("span"));',"\t\t\t\tthis.contentElement.appendChild(document.createTextNode(this.logEntry.formattedMessage));","\t\t\t}","","\t\t\tLogEntryMainElementContainer.prototype = new LogEntryElementContainer();","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogEntry(level, formattedMessage) {","\t\t\t\tthis.level = level;","\t\t\t\tthis.formattedMessage = formattedMessage;","\t\t\t\tthis.rendered = false;","\t\t\t}","","\t\t\tLogEntry.prototype = new LogItem();","","\t\t\tcopyProperties(LogEntry.prototype, {","\t\t\t\trender: function() {","\t\t\t\t\tvar logEntry = this;","\t\t\t\t\tvar containerDomNode = this.group.contentDiv;","","\t\t\t\t\t// Support for the CSS attribute white-space in IE for Windows is","\t\t\t\t\t// non-existent pre version 6 and slightly odd in 6, so instead","\t\t\t\t\t// use two different HTML elements","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tthis.formattedMessage = this.formattedMessage.replace(/\\r\\n/g, "\\r"); // Workaround for IE\'s treatment of white space',"\t\t\t\t\t\tthis.unwrappedElementContainer = new LogEntryUnwrappedElementContainer(this, this.getUnwrappedDomContainer());","\t\t\t\t\t\tthis.wrappedElementContainer = new LogEntryWrappedElementContainer(this, this.getWrappedDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.mainElementContainer = new LogEntryMainElementContainer(this, this.getMainDomContainer());","\t\t\t\t\t\tthis.elementContainers = [this.mainElementContainer];","\t\t\t\t\t}","\t\t\t\t\tthis.content = this.formattedMessage;","\t\t\t\t\tthis.rendered = true;","\t\t\t\t},","","\t\t\t\tsetContent: function(content, wrappedContent) {","\t\t\t\t\tif (content != this.content) {","\t\t\t\t\t\tif (isIe && (content !== this.formattedMessage)) {",'\t\t\t\t\t\t\tcontent = content.replace(/\\r\\n/g, "\\r"); // Workaround for IE\'s treatment of white space',"\t\t\t\t\t\t}","\t\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\t\tthis.elementContainers[i].setContent(content, wrappedContent);","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.content = content;","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tgetSearchMatches: function() {","\t\t\t\t\tvar matches = [];","\t\t\t\t\tvar i, len;","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tvar unwrappedEls = getElementsByClass(this.unwrappedElementContainer.mainDiv, "searchterm", "span");','\t\t\t\t\t\tvar wrappedEls = getElementsByClass(this.wrappedElementContainer.mainDiv, "searchterm", "span");',"\t\t\t\t\t\tfor (i = 0, len = unwrappedEls.length; i < len; i++) {","\t\t\t\t\t\t\tmatches[i] = new Match(this.level, null, unwrappedEls[i], wrappedEls[i]);","\t\t\t\t\t\t}","\t\t\t\t\t} else {",'\t\t\t\t\t\tvar els = getElementsByClass(this.mainElementContainer.mainDiv, "searchterm", "span");',"\t\t\t\t\t\tfor (i = 0, len = els.length; i < len; i++) {","\t\t\t\t\t\t\tmatches[i] = new Match(this.level, els[i]);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn matches;","\t\t\t\t},","","\t\t\t\tsetSearchMatch: function(isMatch) {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].setSearchMatch(isMatch);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tclearSearch: function() {","\t\t\t\t\tfor (var i = 0, len = this.elementContainers.length; i < len; i++) {","\t\t\t\t\t\tthis.elementContainers[i].clearSearch();","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\taccept: function(visitor) {","\t\t\t\t\tvisitor.visitLogEntry(this);","\t\t\t\t},","","\t\t\t\tserialize: function(items) {","\t\t\t\t\titems.push([LogItem.serializedItemKeys.LOG_ENTRY, this.level, this.formattedMessage]);","\t\t\t\t}","\t\t\t});","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemVisitor() {","\t\t\t}","","\t\t\tLogItemVisitor.prototype = {","\t\t\t\tvisit: function(logItem) {","\t\t\t\t},","","\t\t\t\tvisitParent: function(logItem) {","\t\t\t\t\tif (logItem.group) {","\t\t\t\t\t\tlogItem.group.accept(this);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tvisitChildren: function(logItem) {","\t\t\t\t\tfor (var i = 0, len = logItem.children.length; i < len; i++) {","\t\t\t\t\t\tlogItem.children[i].accept(this);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tvisitLogEntry: function(logEntry) {","\t\t\t\t\tthis.visit(logEntry);","\t\t\t\t},","","\t\t\t\tvisitSeparator: function(separator) {","\t\t\t\t\tthis.visit(separator);","\t\t\t\t},","","\t\t\t\tvisitGroup: function(group) {","\t\t\t\t\tthis.visit(group);","\t\t\t\t}","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction GroupFlattener() {","\t\t\t\tthis.logEntriesAndSeparators = [];","\t\t\t}","","\t\t\tGroupFlattener.prototype = new LogItemVisitor();","","\t\t\tGroupFlattener.prototype.visitGroup = function(group) {","\t\t\t\tthis.visitChildren(group);","\t\t\t};","","\t\t\tGroupFlattener.prototype.visitLogEntry = function(logEntry) {","\t\t\t\tthis.logEntriesAndSeparators.push(logEntry);","\t\t\t};","","\t\t\tGroupFlattener.prototype.visitSeparator = function(separator) {","\t\t\t\tthis.logEntriesAndSeparators.push(separator);","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\twindow.onload = function() {","\t\t\t\t// Sort out document.domain","\t\t\t\tif (location.search) {",'\t\t\t\t\tvar queryBits = unescape(location.search).substr(1).split("&"), nameValueBits;',"\t\t\t\t\tfor (var i = 0, len = queryBits.length; i < len; i++) {",'\t\t\t\t\t\tnameValueBits = queryBits[i].split("=");','\t\t\t\t\t\tif (nameValueBits[0] == "log4javascript_domain") {',"\t\t\t\t\t\t\tdocument.domain = nameValueBits[1];","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","","\t\t\t\t// Create DOM objects",'\t\t\t\tlogMainContainer = $("log");',"\t\t\t\tif (isIePre7) {",'\t\t\t\t\taddClass(logMainContainer, "oldIe");',"\t\t\t\t}","",'\t\t\t\trootGroup = new Group("root", true);',"\t\t\t\trootGroup.render();","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\t","\t\t\t\tsetCommandInputWidth();","\t\t\t\tsetLogContainerHeight();","\t\t\t\ttoggleLoggingEnabled();","\t\t\t\ttoggleSearchEnabled();","\t\t\t\ttoggleSearchFilter();","\t\t\t\ttoggleSearchHighlight();","\t\t\t\tapplyFilters();","\t\t\t\tcheckAllLevels();","\t\t\t\ttoggleWrap();","\t\t\t\ttoggleNewestAtTop();","\t\t\t\ttoggleScrollToLatest();","\t\t\t\trenderQueuedLogItems();","\t\t\t\tloaded = true;",'\t\t\t\t$("command").value = "";','\t\t\t\t$("command").autocomplete = "off";','\t\t\t\t$("command").onkeydown = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 10 || evt.keyCode == 13) { // Return/Enter","\t\t\t\t\t\tevalCommandLine();","\t\t\t\t\t\tstopPropagation(evt);","\t\t\t\t\t} else if (evt.keyCode == 27) { // Escape",'\t\t\t\t\t\tthis.value = "";',"\t\t\t\t\t\tthis.focus();","\t\t\t\t\t} else if (evt.keyCode == 38 && commandHistory.length > 0) { // Up","\t\t\t\t\t\tcurrentCommandIndex = Math.max(0, currentCommandIndex - 1);","\t\t\t\t\t\tthis.value = commandHistory[currentCommandIndex];","\t\t\t\t\t\tmoveCaretToEnd(this);","\t\t\t\t\t} else if (evt.keyCode == 40 && commandHistory.length > 0) { // Down","\t\t\t\t\t\tcurrentCommandIndex = Math.min(commandHistory.length - 1, currentCommandIndex + 1);","\t\t\t\t\t\tthis.value = commandHistory[currentCommandIndex];","\t\t\t\t\t\tmoveCaretToEnd(this);","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Prevent the keypress moving the caret in Firefox",'\t\t\t\t$("command").onkeypress = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 38 && commandHistory.length > 0 && evt.preventDefault) { // Up","\t\t\t\t\t\tevt.preventDefault();","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Prevent the keyup event blurring the input in Opera",'\t\t\t\t$("command").onkeyup = function(evt) {',"\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tif (evt.keyCode == 27 && evt.preventDefault) { // Up","\t\t\t\t\t\tevt.preventDefault();","\t\t\t\t\t\tthis.focus();","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Add document keyboard shortcuts","\t\t\t\tdocument.onkeydown = function keyEventHandler(evt) {","\t\t\t\t\tevt = getEvent(evt);","\t\t\t\t\tswitch (evt.keyCode) {","\t\t\t\t\t\tcase 69: // Ctrl + shift + E: re-execute last command","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tevalLastCommand();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase 75: // Ctrl + shift + K: focus search","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tfocusSearch();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase 40: // Ctrl + shift + down arrow: focus command line","\t\t\t\t\t\tcase 76: // Ctrl + shift + L: focus command line","\t\t\t\t\t\t\tif (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","\t\t\t\t\t\t\t\tfocusCommandLine();","\t\t\t\t\t\t\t\tcancelKeyEvent(evt);","\t\t\t\t\t\t\t\treturn false;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t};","","\t\t\t\t// Workaround to make sure log div starts at the correct size","\t\t\t\tsetTimeout(setLogContainerHeight, 20);","","\t\t\t\tsetShowCommandLine(showCommandLine);","\t\t\t\tdoSearch();","\t\t\t};","","\t\t\twindow.onunload = function() {","\t\t\t\tif (mainWindowExists()) {","\t\t\t\t\tappender.unload();","\t\t\t\t}","\t\t\t\tappender = null;","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction toggleLoggingEnabled() {",'\t\t\t\tsetLoggingEnabled($("enableLogging").checked);',"\t\t\t}","","\t\t\tfunction setLoggingEnabled(enable) {","\t\t\t\tloggingEnabled = enable;","\t\t\t}","","\t\t\tvar appender = null;","","\t\t\tfunction setAppender(appenderParam) {","\t\t\t\tappender = appenderParam;","\t\t\t}","","\t\t\tfunction setShowCloseButton(showCloseButton) {",'\t\t\t\t$("closeButton").style.display = showCloseButton ? "inline" : "none";',"\t\t\t}","","\t\t\tfunction setShowHideButton(showHideButton) {",'\t\t\t\t$("hideButton").style.display = showHideButton ? "inline" : "none";',"\t\t\t}","","\t\t\tvar newestAtTop = false;","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction LogItemContentReverser() {","\t\t\t}","\t\t\t","\t\t\tLogItemContentReverser.prototype = new LogItemVisitor();","\t\t\t","\t\t\tLogItemContentReverser.prototype.visitGroup = function(group) {","\t\t\t\tgroup.reverseChildren();","\t\t\t\tthis.visitChildren(group);","\t\t\t};","","\t\t\t/*----------------------------------------------------------------*/","","\t\t\tfunction setNewestAtTop(isNewestAtTop) {","\t\t\t\tvar oldNewestAtTop = newestAtTop;","\t\t\t\tvar i, iLen, j, jLen;","\t\t\t\tnewestAtTop = Boolean(isNewestAtTop);","\t\t\t\tif (oldNewestAtTop != newestAtTop) {","\t\t\t\t\tvar visitor = new LogItemContentReverser();","\t\t\t\t\trootGroup.accept(visitor);","","\t\t\t\t\t// Reassemble the matches array","\t\t\t\t\tif (currentSearch) {","\t\t\t\t\t\tvar currentMatch = currentSearch.matches[currentMatchIndex];","\t\t\t\t\t\tvar matchIndex = 0;","\t\t\t\t\t\tvar matches = [];","\t\t\t\t\t\tvar actOnLogEntry = function(logEntry) {","\t\t\t\t\t\t\tvar logEntryMatches = logEntry.getSearchMatches();","\t\t\t\t\t\t\tfor (j = 0, jLen = logEntryMatches.length; j < jLen; j++) {","\t\t\t\t\t\t\t\tmatches[matchIndex] = logEntryMatches[j];","\t\t\t\t\t\t\t\tif (currentMatch && logEntryMatches[j].equals(currentMatch)) {","\t\t\t\t\t\t\t\t\tcurrentMatchIndex = matchIndex;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tmatchIndex++;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t};","\t\t\t\t\t\tif (newestAtTop) {","\t\t\t\t\t\t\tfor (i = logEntries.length - 1; i >= 0; i--) {","\t\t\t\t\t\t\t\tactOnLogEntry(logEntries[i]);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tfor (i = 0, iLen = logEntries.length; i < iLen; i++) {","\t\t\t\t\t\t\t\tactOnLogEntry(logEntries[i]);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\tcurrentSearch.matches = matches;","\t\t\t\t\t\tif (currentMatch) {","\t\t\t\t\t\t\tcurrentMatch.setCurrent();","\t\t\t\t\t\t}","\t\t\t\t\t} else if (scrollToLatest) {","\t\t\t\t\t\tdoScrollToLatest();","\t\t\t\t\t}","\t\t\t\t}",'\t\t\t\t$("newestAtTop").checked = isNewestAtTop;',"\t\t\t}","","\t\t\tfunction toggleNewestAtTop() {",'\t\t\t\tvar isNewestAtTop = $("newestAtTop").checked;',"\t\t\t\tsetNewestAtTop(isNewestAtTop);","\t\t\t}","","\t\t\tvar scrollToLatest = true;","","\t\t\tfunction setScrollToLatest(isScrollToLatest) {","\t\t\t\tscrollToLatest = isScrollToLatest;","\t\t\t\tif (scrollToLatest) {","\t\t\t\t\tdoScrollToLatest();","\t\t\t\t}",'\t\t\t\t$("scrollToLatest").checked = isScrollToLatest;',"\t\t\t}","","\t\t\tfunction toggleScrollToLatest() {",'\t\t\t\tvar isScrollToLatest = $("scrollToLatest").checked;',"\t\t\t\tsetScrollToLatest(isScrollToLatest);","\t\t\t}","","\t\t\tfunction doScrollToLatest() {","\t\t\t\tvar l = logMainContainer;",'\t\t\t\tif (typeof l.scrollTop != "undefined") {',"\t\t\t\t\tif (newestAtTop) {","\t\t\t\t\t\tl.scrollTop = 0;","\t\t\t\t\t} else {","\t\t\t\t\t\tvar latestLogEntry = l.lastChild;","\t\t\t\t\t\tif (latestLogEntry) {","\t\t\t\t\t\t\tl.scrollTop = l.scrollHeight;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tvar closeIfOpenerCloses = true;","","\t\t\tfunction setCloseIfOpenerCloses(isCloseIfOpenerCloses) {","\t\t\t\tcloseIfOpenerCloses = isCloseIfOpenerCloses;","\t\t\t}","","\t\t\tvar maxMessages = null;","","\t\t\tfunction setMaxMessages(max) {","\t\t\t\tmaxMessages = max;","\t\t\t\tpruneLogEntries();","\t\t\t}","","\t\t\tvar showCommandLine = false;","","\t\t\tfunction setShowCommandLine(isShowCommandLine) {","\t\t\t\tshowCommandLine = isShowCommandLine;","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("commandLine").style.display = showCommandLine ? "block" : "none";',"\t\t\t\t\tsetCommandInputWidth();","\t\t\t\t\tsetLogContainerHeight();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction focusCommandLine() {","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("command").focus();',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction focusSearch() {","\t\t\t\tif (loaded) {",'\t\t\t\t\t$("searchBox").focus();',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction getLogItems() {","\t\t\t\tvar items = [];","\t\t\t\tfor (var i = 0, len = logItems.length; i < len; i++) {","\t\t\t\t\tlogItems[i].serialize(items);","\t\t\t\t}","\t\t\t\treturn items;","\t\t\t}","","\t\t\tfunction setLogItems(items) {","\t\t\t\tvar loggingReallyEnabled = loggingEnabled;","\t\t\t\t// Temporarily turn logging on","\t\t\t\tloggingEnabled = true;","\t\t\t\tfor (var i = 0, len = items.length; i < len; i++) {","\t\t\t\t\tswitch (items[i][0]) {","\t\t\t\t\t\tcase LogItem.serializedItemKeys.LOG_ENTRY:","\t\t\t\t\t\t\tlog(items[i][1], items[i][2]);","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase LogItem.serializedItemKeys.GROUP_START:","\t\t\t\t\t\t\tgroup(items[i][1]);","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\tcase LogItem.serializedItemKeys.GROUP_END:","\t\t\t\t\t\t\tgroupEnd();","\t\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tloggingEnabled = loggingReallyEnabled;","\t\t\t}","","\t\t\tfunction log(logLevel, formattedMessage) {","\t\t\t\tif (loggingEnabled) {","\t\t\t\t\tvar logEntry = new LogEntry(logLevel, formattedMessage);","\t\t\t\t\tlogEntries.push(logEntry);","\t\t\t\t\tlogEntriesAndSeparators.push(logEntry);","\t\t\t\t\tlogItems.push(logEntry);","\t\t\t\t\tcurrentGroup.addChild(logEntry);","\t\t\t\t\tif (loaded) {","\t\t\t\t\t\tif (logQueuedEventsTimer !== null) {","\t\t\t\t\t\t\tclearTimeout(logQueuedEventsTimer);","\t\t\t\t\t\t}","\t\t\t\t\t\tlogQueuedEventsTimer = setTimeout(renderQueuedLogItems, renderDelay);","\t\t\t\t\t\tunrenderedLogItemsExist = true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction renderQueuedLogItems() {","\t\t\t\tlogQueuedEventsTimer = null;","\t\t\t\tvar pruned = pruneLogEntries();","","\t\t\t\t// Render any unrendered log entries and apply the current search to them","\t\t\t\tvar initiallyHasMatches = currentSearch ? currentSearch.hasMatches() : false;","\t\t\t\tfor (var i = 0, len = logItems.length; i < len; i++) {","\t\t\t\t\tif (!logItems[i].rendered) {","\t\t\t\t\t\tlogItems[i].render();","\t\t\t\t\t\tlogItems[i].appendToLog();","\t\t\t\t\t\tif (currentSearch && (logItems[i] instanceof LogEntry)) {","\t\t\t\t\t\t\tcurrentSearch.applyTo(logItems[i]);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (currentSearch) {","\t\t\t\t\tif (pruned) {","\t\t\t\t\t\tif (currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\t\tif (currentMatchIndex === null) {","\t\t\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t\t}","\t\t\t\t\t} else if (!initiallyHasMatches && currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (scrollToLatest) {","\t\t\t\t\tdoScrollToLatest();","\t\t\t\t}","\t\t\t\tunrenderedLogItemsExist = false;","\t\t\t}","","\t\t\tfunction pruneLogEntries() {","\t\t\t\tif ((maxMessages !== null) && (logEntriesAndSeparators.length > maxMessages)) {","\t\t\t\t\tvar numberToDelete = logEntriesAndSeparators.length - maxMessages;","\t\t\t\t\tvar prunedLogEntries = logEntriesAndSeparators.slice(0, numberToDelete);","\t\t\t\t\tif (currentSearch) {","\t\t\t\t\t\tcurrentSearch.removeMatches(prunedLogEntries);","\t\t\t\t\t}","\t\t\t\t\tvar group;","\t\t\t\t\tfor (var i = 0; i < numberToDelete; i++) {","\t\t\t\t\t\tgroup = logEntriesAndSeparators[i].group;","\t\t\t\t\t\tarray_remove(logItems, logEntriesAndSeparators[i]);","\t\t\t\t\t\tarray_remove(logEntries, logEntriesAndSeparators[i]);","\t\t\t\t\t\tlogEntriesAndSeparators[i].remove(true, true);","\t\t\t\t\t\tif (group.children.length === 0 && group !== currentGroup && group !== rootGroup) {","\t\t\t\t\t\t\tarray_remove(logItems, group);","\t\t\t\t\t\t\tgroup.remove(true, true);","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\tlogEntriesAndSeparators = array_removeFromStart(logEntriesAndSeparators, numberToDelete);","\t\t\t\t\treturn true;","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction group(name, startExpanded) {","\t\t\t\tif (loggingEnabled) {",'\t\t\t\t\tinitiallyExpanded = (typeof startExpanded === "undefined") ? true : Boolean(startExpanded);',"\t\t\t\t\tvar newGroup = new Group(name, false, initiallyExpanded);","\t\t\t\t\tcurrentGroup.addChild(newGroup);","\t\t\t\t\tcurrentGroup = newGroup;","\t\t\t\t\tlogItems.push(newGroup);","\t\t\t\t\tif (loaded) {","\t\t\t\t\t\tif (logQueuedEventsTimer !== null) {","\t\t\t\t\t\t\tclearTimeout(logQueuedEventsTimer);","\t\t\t\t\t\t}","\t\t\t\t\t\tlogQueuedEventsTimer = setTimeout(renderQueuedLogItems, renderDelay);","\t\t\t\t\t\tunrenderedLogItemsExist = true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction groupEnd() {","\t\t\t\tcurrentGroup = (currentGroup === rootGroup) ? rootGroup : currentGroup.group;","\t\t\t}","","\t\t\tfunction mainPageReloaded() {","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\tvar separator = new Separator();","\t\t\t\tlogEntriesAndSeparators.push(separator);","\t\t\t\tlogItems.push(separator);","\t\t\t\tcurrentGroup.addChild(separator);","\t\t\t}","","\t\t\tfunction closeWindow() {","\t\t\t\tif (appender && mainWindowExists()) {","\t\t\t\t\tappender.close(true);","\t\t\t\t} else {","\t\t\t\t\twindow.close();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction hide() {","\t\t\t\tif (appender && mainWindowExists()) {","\t\t\t\t\tappender.hide();","\t\t\t\t}","\t\t\t}","","\t\t\tvar mainWindow = window;",'\t\t\tvar windowId = "log4javascriptConsoleWindow_" + new Date().getTime() + "_" + ("" + Math.random()).substr(2);',"","\t\t\tfunction setMainWindow(win) {","\t\t\t\tmainWindow = win;","\t\t\t\tmainWindow[windowId] = window;","\t\t\t\t// If this is a pop-up, poll the opener to see if it's closed","\t\t\t\tif (opener && closeIfOpenerCloses) {","\t\t\t\t\tpollOpener();","\t\t\t\t}","\t\t\t}","","\t\t\tfunction pollOpener() {","\t\t\t\tif (closeIfOpenerCloses) {","\t\t\t\t\tif (mainWindowExists()) {","\t\t\t\t\t\tsetTimeout(pollOpener, 500);","\t\t\t\t\t} else {","\t\t\t\t\t\tcloseWindow();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction mainWindowExists() {","\t\t\t\ttry {","\t\t\t\t\treturn (mainWindow && !mainWindow.closed &&","\t\t\t\t\t\tmainWindow[windowId] == window);","\t\t\t\t} catch (ex) {}","\t\t\t\treturn false;","\t\t\t}","",'\t\t\tvar logLevels = ["TRACE", "DEBUG", "INFO", "WARN", "ERROR", "FATAL"];',"","\t\t\tfunction getCheckBox(logLevel) {",'\t\t\t\treturn $("switch_" + logLevel);',"\t\t\t}","","\t\t\tfunction getIeWrappedLogContainer() {",'\t\t\t\treturn $("log_wrapped");',"\t\t\t}","","\t\t\tfunction getIeUnwrappedLogContainer() {",'\t\t\t\treturn $("log_unwrapped");',"\t\t\t}","","\t\t\tfunction applyFilters() {","\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tif (getCheckBox(logLevels[i]).checked) {","\t\t\t\t\t\taddClass(logMainContainer, logLevels[i]);","\t\t\t\t\t} else {","\t\t\t\t\t\tremoveClass(logMainContainer, logLevels[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tupdateSearchFromFilters();","\t\t\t}","","\t\t\tfunction toggleAllLevels() {",'\t\t\t\tvar turnOn = $("switch_ALL").checked;',"\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tgetCheckBox(logLevels[i]).checked = turnOn;","\t\t\t\t\tif (turnOn) {","\t\t\t\t\t\taddClass(logMainContainer, logLevels[i]);","\t\t\t\t\t} else {","\t\t\t\t\t\tremoveClass(logMainContainer, logLevels[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction checkAllLevels() {","\t\t\t\tfor (var i = 0; i < logLevels.length; i++) {","\t\t\t\t\tif (!getCheckBox(logLevels[i]).checked) {",'\t\t\t\t\t\tgetCheckBox("ALL").checked = false;',"\t\t\t\t\t\treturn;","\t\t\t\t\t}","\t\t\t\t}",'\t\t\t\tgetCheckBox("ALL").checked = true;',"\t\t\t}","","\t\t\tfunction clearLog() {","\t\t\t\trootGroup.clear();","\t\t\t\tcurrentGroup = rootGroup;","\t\t\t\tlogEntries = [];","\t\t\t\tlogItems = [];","\t\t\t\tlogEntriesAndSeparators = [];"," \t\t\t\tdoSearch();","\t\t\t}","","\t\t\tfunction toggleWrap() {",'\t\t\t\tvar enable = $("wrap").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "wrap");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "wrap");',"\t\t\t\t}","\t\t\t\trefreshCurrentMatch();","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------- */","","\t\t\t// Search","","\t\t\tvar searchTimer = null;","","\t\t\tfunction scheduleSearch() {","\t\t\t\ttry {","\t\t\t\t\tclearTimeout(searchTimer);","\t\t\t\t} catch (ex) {","\t\t\t\t\t// Do nothing","\t\t\t\t}","\t\t\t\tsearchTimer = setTimeout(doSearch, 500);","\t\t\t}","","\t\t\tfunction Search(searchTerm, isRegex, searchRegex, isCaseSensitive) {","\t\t\t\tthis.searchTerm = searchTerm;","\t\t\t\tthis.isRegex = isRegex;","\t\t\t\tthis.searchRegex = searchRegex;","\t\t\t\tthis.isCaseSensitive = isCaseSensitive;","\t\t\t\tthis.matches = [];","\t\t\t}","","\t\t\tSearch.prototype = {","\t\t\t\thasMatches: function() {","\t\t\t\t\treturn this.matches.length > 0;","\t\t\t\t},","","\t\t\t\thasVisibleMatches: function() {","\t\t\t\t\tif (this.hasMatches()) {","\t\t\t\t\t\tfor (var i = 0; i < this.matches.length; i++) {","\t\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\t\treturn true;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn false;","\t\t\t\t},","","\t\t\t\tmatch: function(logEntry) {","\t\t\t\t\tvar entryText = String(logEntry.formattedMessage);","\t\t\t\t\tvar matchesSearch = false;","\t\t\t\t\tif (this.isRegex) {","\t\t\t\t\t\tmatchesSearch = this.searchRegex.test(entryText);","\t\t\t\t\t} else if (this.isCaseSensitive) {","\t\t\t\t\t\tmatchesSearch = (entryText.indexOf(this.searchTerm) > -1);","\t\t\t\t\t} else {","\t\t\t\t\t\tmatchesSearch = (entryText.toLowerCase().indexOf(this.searchTerm.toLowerCase()) > -1);","\t\t\t\t\t}","\t\t\t\t\treturn matchesSearch;","\t\t\t\t},","","\t\t\t\tgetNextVisibleMatchIndex: function() {","\t\t\t\t\tfor (var i = currentMatchIndex + 1; i < this.matches.length; i++) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\t// Start again from the first match","\t\t\t\t\tfor (i = 0; i <= currentMatchIndex; i++) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn -1;","\t\t\t\t},","","\t\t\t\tgetPreviousVisibleMatchIndex: function() {","\t\t\t\t\tfor (var i = currentMatchIndex - 1; i >= 0; i--) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\t// Start again from the last match","\t\t\t\t\tfor (var i = this.matches.length - 1; i >= currentMatchIndex; i--) {","\t\t\t\t\t\tif (this.matches[i].isVisible()) {","\t\t\t\t\t\t\treturn i;","\t\t\t\t\t\t}","\t\t\t\t\t}","\t\t\t\t\treturn -1;","\t\t\t\t},","","\t\t\t\tapplyTo: function(logEntry) {","\t\t\t\t\tvar doesMatch = this.match(logEntry);","\t\t\t\t\tif (doesMatch) {","\t\t\t\t\t\tlogEntry.group.expand();","\t\t\t\t\t\tlogEntry.setSearchMatch(true);","\t\t\t\t\t\tvar logEntryContent;","\t\t\t\t\t\tvar wrappedLogEntryContent;",'\t\t\t\t\t\tvar searchTermReplacementStartTag = "<span class=\\"searchterm\\">";','\t\t\t\t\t\tvar searchTermReplacementEndTag = "<" + "/span>";','\t\t\t\t\t\tvar preTagName = isIe ? "pre" : "span";','\t\t\t\t\t\tvar preStartTag = "<" + preTagName + " class=\\"pre\\">";','\t\t\t\t\t\tvar preEndTag = "<" + "/" + preTagName + ">";',"\t\t\t\t\t\tvar startIndex = 0;","\t\t\t\t\t\tvar searchIndex, matchedText, textBeforeMatch;","\t\t\t\t\t\tif (this.isRegex) {",'\t\t\t\t\t\t\tvar flags = this.isCaseSensitive ? "g" : "gi";','\t\t\t\t\t\t\tvar capturingRegex = new RegExp("(" + this.searchRegex.source + ")", flags);',"","\t\t\t\t\t\t\t// Replace the search term with temporary tokens for the start and end tags",'\t\t\t\t\t\t\tvar rnd = ("" + Math.random()).substr(2);','\t\t\t\t\t\t\tvar startToken = "%%s" + rnd + "%%";','\t\t\t\t\t\t\tvar endToken = "%%e" + rnd + "%%";','\t\t\t\t\t\t\tlogEntryContent = logEntry.formattedMessage.replace(capturingRegex, startToken + "$1" + endToken);',"","\t\t\t\t\t\t\t// Escape the HTML to get rid of angle brackets","\t\t\t\t\t\t\tlogEntryContent = escapeHtml(logEntryContent);","","\t\t\t\t\t\t\t// Substitute the proper HTML back in for the search match","\t\t\t\t\t\t\tvar result;","\t\t\t\t\t\t\tvar searchString = logEntryContent;",'\t\t\t\t\t\t\tlogEntryContent = "";','\t\t\t\t\t\t\twrappedLogEntryContent = "";',"\t\t\t\t\t\t\twhile ((searchIndex = searchString.indexOf(startToken, startIndex)) > -1) {","\t\t\t\t\t\t\t\tvar endTokenIndex = searchString.indexOf(endToken, searchIndex);","\t\t\t\t\t\t\t\tmatchedText = searchString.substring(searchIndex + startToken.length, endTokenIndex);","\t\t\t\t\t\t\t\ttextBeforeMatch = searchString.substring(startIndex, searchIndex);","\t\t\t\t\t\t\t\tlogEntryContent += preStartTag + textBeforeMatch + preEndTag;","\t\t\t\t\t\t\t\tlogEntryContent += searchTermReplacementStartTag + preStartTag + matchedText +","\t\t\t\t\t\t\t\t\tpreEndTag + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\t\twrappedLogEntryContent += textBeforeMatch + searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\t\tmatchedText + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tstartIndex = endTokenIndex + endToken.length;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tlogEntryContent += preStartTag + searchString.substr(startIndex) + preEndTag;","\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\twrappedLogEntryContent += searchString.substr(startIndex);","\t\t\t\t\t\t\t}","\t\t\t\t\t\t} else {",'\t\t\t\t\t\t\tlogEntryContent = "";','\t\t\t\t\t\t\twrappedLogEntryContent = "";',"\t\t\t\t\t\t\tvar searchTermReplacementLength = searchTermReplacementStartTag.length +","\t\t\t\t\t\t\t\tthis.searchTerm.length + searchTermReplacementEndTag.length;","\t\t\t\t\t\t\tvar searchTermLength = this.searchTerm.length;","\t\t\t\t\t\t\tvar searchTermLowerCase = this.searchTerm.toLowerCase();","\t\t\t\t\t\t\tvar logTextLowerCase = logEntry.formattedMessage.toLowerCase();","\t\t\t\t\t\t\twhile ((searchIndex = logTextLowerCase.indexOf(searchTermLowerCase, startIndex)) > -1) {","\t\t\t\t\t\t\t\tmatchedText = escapeHtml(logEntry.formattedMessage.substr(searchIndex, this.searchTerm.length));","\t\t\t\t\t\t\t\ttextBeforeMatch = escapeHtml(logEntry.formattedMessage.substring(startIndex, searchIndex));","\t\t\t\t\t\t\t\tvar searchTermReplacement = searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\tpreStartTag + matchedText + preEndTag + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\tlogEntryContent += preStartTag + textBeforeMatch + preEndTag + searchTermReplacement;","\t\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\t\twrappedLogEntryContent += textBeforeMatch + searchTermReplacementStartTag +","\t\t\t\t\t\t\t\t\t\tmatchedText + searchTermReplacementEndTag;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\tstartIndex = searchIndex + searchTermLength;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tvar textAfterLastMatch = escapeHtml(logEntry.formattedMessage.substr(startIndex));","\t\t\t\t\t\t\tlogEntryContent += preStartTag + textAfterLastMatch + preEndTag;","\t\t\t\t\t\t\tif (isIe) {","\t\t\t\t\t\t\t\twrappedLogEntryContent += textAfterLastMatch;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t\tlogEntry.setContent(logEntryContent, wrappedLogEntryContent);","\t\t\t\t\t\tvar logEntryMatches = logEntry.getSearchMatches();","\t\t\t\t\t\tthis.matches = this.matches.concat(logEntryMatches);","\t\t\t\t\t} else {","\t\t\t\t\t\tlogEntry.setSearchMatch(false);","\t\t\t\t\t\tlogEntry.setContent(logEntry.formattedMessage, logEntry.formattedMessage);","\t\t\t\t\t}","\t\t\t\t\treturn doesMatch;","\t\t\t\t},","","\t\t\t\tremoveMatches: function(logEntries) {","\t\t\t\t\tvar matchesToRemoveCount = 0;","\t\t\t\t\tvar currentMatchRemoved = false;","\t\t\t\t\tvar matchesToRemove = [];","\t\t\t\t\tvar i, iLen, j, jLen;","","\t\t\t\t\t// Establish the list of matches to be removed","\t\t\t\t\tfor (i = 0, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\tfor (j = 0, jLen = logEntries.length; j < jLen; j++) {","\t\t\t\t\t\t\tif (this.matches[i].belongsTo(logEntries[j])) {","\t\t\t\t\t\t\t\tmatchesToRemove.push(this.matches[i]);","\t\t\t\t\t\t\t\tif (i === currentMatchIndex) {","\t\t\t\t\t\t\t\t\tcurrentMatchRemoved = true;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","","\t\t\t\t\t// Set the new current match index if the current match has been deleted","\t\t\t\t\t// This will be the first match that appears after the first log entry being","\t\t\t\t\t// deleted, if one exists; otherwise, it's the first match overall","\t\t\t\t\tvar newMatch = currentMatchRemoved ? null : this.matches[currentMatchIndex];","\t\t\t\t\tif (currentMatchRemoved) {","\t\t\t\t\t\tfor (i = currentMatchIndex, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\t\tif (this.matches[i].isVisible() && !array_contains(matchesToRemove, this.matches[i])) {","\t\t\t\t\t\t\t\tnewMatch = this.matches[i];","\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t}","","\t\t\t\t\t// Remove the matches","\t\t\t\t\tfor (i = 0, iLen = matchesToRemove.length; i < iLen; i++) {","\t\t\t\t\t\tarray_remove(this.matches, matchesToRemove[i]);","\t\t\t\t\t\tmatchesToRemove[i].remove();","\t\t\t\t\t}","","\t\t\t\t\t// Set the new match, if one exists","\t\t\t\t\tif (this.hasVisibleMatches()) {","\t\t\t\t\t\tif (newMatch === null) {","\t\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\t// Get the index of the new match","\t\t\t\t\t\t\tvar newMatchIndex = 0;","\t\t\t\t\t\t\tfor (i = 0, iLen = this.matches.length; i < iLen; i++) {","\t\t\t\t\t\t\t\tif (newMatch === this.matches[i]) {","\t\t\t\t\t\t\t\t\tnewMatchIndex = i;","\t\t\t\t\t\t\t\t\tbreak;","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t}","\t\t\t\t\t\t\tsetCurrentMatchIndex(newMatchIndex);","\t\t\t\t\t\t}","\t\t\t\t\t} else {","\t\t\t\t\t\tcurrentMatchIndex = null;","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\tfunction getPageOffsetTop(el, container) {","\t\t\t\tvar currentEl = el;","\t\t\t\tvar y = 0;","\t\t\t\twhile (currentEl && currentEl != container) {","\t\t\t\t\ty += currentEl.offsetTop;","\t\t\t\t\tcurrentEl = currentEl.offsetParent;","\t\t\t\t}","\t\t\t\treturn y;","\t\t\t}","","\t\t\tfunction scrollIntoView(el) {","\t\t\t\tvar logContainer = logMainContainer;","\t\t\t\t// Check if the whole width of the element is visible and centre if not",'\t\t\t\tif (!$("wrap").checked) {',"\t\t\t\t\tvar logContainerLeft = logContainer.scrollLeft;","\t\t\t\t\tvar logContainerRight = logContainerLeft  + logContainer.offsetWidth;","\t\t\t\t\tvar elLeft = el.offsetLeft;","\t\t\t\t\tvar elRight = elLeft + el.offsetWidth;","\t\t\t\t\tif (elLeft < logContainerLeft || elRight > logContainerRight) {","\t\t\t\t\t\tlogContainer.scrollLeft = elLeft - (logContainer.offsetWidth - el.offsetWidth) / 2;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\t// Check if the whole height of the element is visible and centre if not","\t\t\t\tvar logContainerTop = logContainer.scrollTop;","\t\t\t\tvar logContainerBottom = logContainerTop  + logContainer.offsetHeight;","\t\t\t\tvar elTop = getPageOffsetTop(el) - getToolBarsHeight();","\t\t\t\tvar elBottom = elTop + el.offsetHeight;","\t\t\t\tif (elTop < logContainerTop || elBottom > logContainerBottom) {","\t\t\t\t\tlogContainer.scrollTop = elTop - (logContainer.offsetHeight - el.offsetHeight) / 2;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction Match(logEntryLevel, spanInMainDiv, spanInUnwrappedPre, spanInWrappedDiv) {","\t\t\t\tthis.logEntryLevel = logEntryLevel;","\t\t\t\tthis.spanInMainDiv = spanInMainDiv;","\t\t\t\tif (isIe) {","\t\t\t\t\tthis.spanInUnwrappedPre = spanInUnwrappedPre;","\t\t\t\t\tthis.spanInWrappedDiv = spanInWrappedDiv;","\t\t\t\t}","\t\t\t\tthis.mainSpan = isIe ? spanInUnwrappedPre : spanInMainDiv;","\t\t\t}","","\t\t\tMatch.prototype = {","\t\t\t\tequals: function(match) {","\t\t\t\t\treturn this.mainSpan === match.mainSpan;","\t\t\t\t},","","\t\t\t\tsetCurrent: function() {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\taddClass(this.spanInUnwrappedPre, "currentmatch");','\t\t\t\t\t\taddClass(this.spanInWrappedDiv, "currentmatch");',"\t\t\t\t\t\t// Scroll the visible one into view",'\t\t\t\t\t\tvar elementToScroll = $("wrap").checked ? this.spanInWrappedDiv : this.spanInUnwrappedPre;',"\t\t\t\t\t\tscrollIntoView(elementToScroll);","\t\t\t\t\t} else {",'\t\t\t\t\t\taddClass(this.spanInMainDiv, "currentmatch");',"\t\t\t\t\t\tscrollIntoView(this.spanInMainDiv);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tbelongsTo: function(logEntry) {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\treturn isDescendant(this.spanInUnwrappedPre, logEntry.unwrappedPre);","\t\t\t\t\t} else {","\t\t\t\t\t\treturn isDescendant(this.spanInMainDiv, logEntry.mainDiv);","\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tsetNotCurrent: function() {","\t\t\t\t\tif (isIe) {",'\t\t\t\t\t\tremoveClass(this.spanInUnwrappedPre, "currentmatch");','\t\t\t\t\t\tremoveClass(this.spanInWrappedDiv, "currentmatch");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(this.spanInMainDiv, "currentmatch");',"\t\t\t\t\t}","\t\t\t\t},","","\t\t\t\tisOrphan: function() {","\t\t\t\t\treturn isOrphan(this.mainSpan);","\t\t\t\t},","","\t\t\t\tisVisible: function() {","\t\t\t\t\treturn getCheckBox(this.logEntryLevel).checked;","\t\t\t\t},","","\t\t\t\tremove: function() {","\t\t\t\t\tif (isIe) {","\t\t\t\t\t\tthis.spanInUnwrappedPre = null;","\t\t\t\t\t\tthis.spanInWrappedDiv = null;","\t\t\t\t\t} else {","\t\t\t\t\t\tthis.spanInMainDiv = null;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t};","","\t\t\tvar currentSearch = null;","\t\t\tvar currentMatchIndex = null;","","\t\t\tfunction doSearch() {",'\t\t\t\tvar searchBox = $("searchBox");',"\t\t\t\tvar searchTerm = searchBox.value;",'\t\t\t\tvar isRegex = $("searchRegex").checked;','\t\t\t\tvar isCaseSensitive = $("searchCaseSensitive").checked;',"\t\t\t\tvar i;","",'\t\t\t\tif (searchTerm === "") {','\t\t\t\t\t$("searchReset").disabled = true;','\t\t\t\t\t$("searchNav").style.display = "none";','\t\t\t\t\tremoveClass(document.body, "searching");','\t\t\t\t\tremoveClass(searchBox, "hasmatches");','\t\t\t\t\tremoveClass(searchBox, "nomatches");',"\t\t\t\t\tfor (i = 0; i < logEntries.length; i++) {","\t\t\t\t\t\tlogEntries[i].clearSearch();","\t\t\t\t\t\tlogEntries[i].setContent(logEntries[i].formattedMessage, logEntries[i].formattedMessage);","\t\t\t\t\t}","\t\t\t\t\tcurrentSearch = null;","\t\t\t\t\tsetLogContainerHeight();","\t\t\t\t} else {",'\t\t\t\t\t$("searchReset").disabled = false;','\t\t\t\t\t$("searchNav").style.display = "block";',"\t\t\t\t\tvar searchRegex;","\t\t\t\t\tvar regexValid;","\t\t\t\t\tif (isRegex) {","\t\t\t\t\t\ttry {",'\t\t\t\t\t\t\tsearchRegex = isCaseSensitive ? new RegExp(searchTerm, "g") : new RegExp(searchTerm, "gi");',"\t\t\t\t\t\t\tregexValid = true;",'\t\t\t\t\t\t\treplaceClass(searchBox, "validregex", "invalidregex");','\t\t\t\t\t\t\tsearchBox.title = "Valid regex";',"\t\t\t\t\t\t} catch (ex) {","\t\t\t\t\t\t\tregexValid = false;",'\t\t\t\t\t\t\treplaceClass(searchBox, "invalidregex", "validregex");','\t\t\t\t\t\t\tsearchBox.title = "Invalid regex: " + (ex.message ? ex.message : (ex.description ? ex.description : "unknown error"));',"\t\t\t\t\t\t\treturn;","\t\t\t\t\t\t}","\t\t\t\t\t} else {",'\t\t\t\t\t\tsearchBox.title = "";','\t\t\t\t\t\tremoveClass(searchBox, "validregex");','\t\t\t\t\t\tremoveClass(searchBox, "invalidregex");',"\t\t\t\t\t}",'\t\t\t\t\taddClass(document.body, "searching");',"\t\t\t\t\tcurrentSearch = new Search(searchTerm, isRegex, searchRegex, isCaseSensitive);","\t\t\t\t\tfor (i = 0; i < logEntries.length; i++) {","\t\t\t\t\t\tcurrentSearch.applyTo(logEntries[i]);","\t\t\t\t\t}","\t\t\t\t\tsetLogContainerHeight();","","\t\t\t\t\t// Highlight the first search match","\t\t\t\t\tif (currentSearch.hasVisibleMatches()) {","\t\t\t\t\t\tsetCurrentMatchIndex(0);","\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t} else {","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction updateSearchFromFilters() {","\t\t\t\tif (currentSearch) {","\t\t\t\t\tif (currentSearch.hasMatches()) {","\t\t\t\t\t\tif (currentMatchIndex === null) {","\t\t\t\t\t\t\tcurrentMatchIndex = 0;","\t\t\t\t\t\t}","\t\t\t\t\t\tvar currentMatch = currentSearch.matches[currentMatchIndex];","\t\t\t\t\t\tif (currentMatch.isVisible()) {","\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t\tsetCurrentMatchIndex(currentMatchIndex);","\t\t\t\t\t\t} else {","\t\t\t\t\t\t\tcurrentMatch.setNotCurrent();","\t\t\t\t\t\t\t// Find the next visible match, if one exists","\t\t\t\t\t\t\tvar nextVisibleMatchIndex = currentSearch.getNextVisibleMatchIndex();","\t\t\t\t\t\t\tif (nextVisibleMatchIndex > -1) {","\t\t\t\t\t\t\t\tsetCurrentMatchIndex(nextVisibleMatchIndex);","\t\t\t\t\t\t\t\tdisplayMatches();","\t\t\t\t\t\t\t} else {","\t\t\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","\t\t\t\t\t} else {","\t\t\t\t\t\tdisplayNoMatches();","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction refreshCurrentMatch() {","\t\t\t\tif (currentSearch && currentSearch.hasVisibleMatches()) {","\t\t\t\t\tsetCurrentMatchIndex(currentMatchIndex);","\t\t\t\t}","\t\t\t}","","\t\t\tfunction displayMatches() {",'\t\t\t\treplaceClass($("searchBox"), "hasmatches", "nomatches");','\t\t\t\t$("searchBox").title = "" + currentSearch.matches.length + " matches found";','\t\t\t\t$("searchNav").style.display = "block";',"\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction displayNoMatches() {",'\t\t\t\treplaceClass($("searchBox"), "nomatches", "hasmatches");','\t\t\t\t$("searchBox").title = "No matches found";','\t\t\t\t$("searchNav").style.display = "none";',"\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction toggleSearchEnabled(enable) {",'\t\t\t\tenable = (typeof enable == "undefined") ? !$("searchDisable").checked : enable;','\t\t\t\t$("searchBox").disabled = !enable;','\t\t\t\t$("searchReset").disabled = !enable;','\t\t\t\t$("searchRegex").disabled = !enable;','\t\t\t\t$("searchNext").disabled = !enable;','\t\t\t\t$("searchPrevious").disabled = !enable;','\t\t\t\t$("searchCaseSensitive").disabled = !enable;','\t\t\t\t$("searchNav").style.display = (enable && ($("searchBox").value !== "") &&',"\t\t\t\t\t\tcurrentSearch && currentSearch.hasVisibleMatches()) ?",'\t\t\t\t\t"block" : "none";',"\t\t\t\tif (enable) {",'\t\t\t\t\tremoveClass($("search"), "greyedout");','\t\t\t\t\taddClass(document.body, "searching");','\t\t\t\t\tif ($("searchHighlight").checked) {','\t\t\t\t\t\taddClass(logMainContainer, "searchhighlight");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");',"\t\t\t\t\t}",'\t\t\t\t\tif ($("searchFilter").checked) {','\t\t\t\t\t\taddClass(logMainContainer, "searchfilter");',"\t\t\t\t\t} else {",'\t\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t\t}",'\t\t\t\t\t$("searchDisable").checked = !enable;',"\t\t\t\t} else {",'\t\t\t\t\taddClass($("search"), "greyedout");','\t\t\t\t\tremoveClass(document.body, "searching");','\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");','\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t}","\t\t\t\tsetLogContainerHeight();","\t\t\t}","","\t\t\tfunction toggleSearchFilter() {",'\t\t\t\tvar enable = $("searchFilter").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "searchfilter");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "searchfilter");',"\t\t\t\t}","\t\t\t\trefreshCurrentMatch();","\t\t\t}","","\t\t\tfunction toggleSearchHighlight() {",'\t\t\t\tvar enable = $("searchHighlight").checked;',"\t\t\t\tif (enable) {",'\t\t\t\t\taddClass(logMainContainer, "searchhighlight");',"\t\t\t\t} else {",'\t\t\t\t\tremoveClass(logMainContainer, "searchhighlight");',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction clearSearch() {",'\t\t\t\t$("searchBox").value = "";',"\t\t\t\tdoSearch();","\t\t\t}","","\t\t\tfunction searchNext() {","\t\t\t\tif (currentSearch !== null && currentMatchIndex !== null) {","\t\t\t\t\tcurrentSearch.matches[currentMatchIndex].setNotCurrent();","\t\t\t\t\tvar nextMatchIndex = currentSearch.getNextVisibleMatchIndex();",'\t\t\t\t\tif (nextMatchIndex > currentMatchIndex || confirm("Reached the end of the page. Start from the top?")) {',"\t\t\t\t\t\tsetCurrentMatchIndex(nextMatchIndex);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction searchPrevious() {","\t\t\t\tif (currentSearch !== null && currentMatchIndex !== null) {","\t\t\t\t\tcurrentSearch.matches[currentMatchIndex].setNotCurrent();","\t\t\t\t\tvar previousMatchIndex = currentSearch.getPreviousVisibleMatchIndex();",'\t\t\t\t\tif (previousMatchIndex < currentMatchIndex || confirm("Reached the start of the page. Continue from the bottom?")) {',"\t\t\t\t\t\tsetCurrentMatchIndex(previousMatchIndex);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction setCurrentMatchIndex(index) {","\t\t\t\tcurrentMatchIndex = index;","\t\t\t\tcurrentSearch.matches[currentMatchIndex].setCurrent();","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------------- */","","\t\t\t// CSS Utilities","","\t\t\tfunction addClass(el, cssClass) {","\t\t\t\tif (!hasClass(el, cssClass)) {","\t\t\t\t\tif (el.className) {",'\t\t\t\t\t\tel.className += " " + cssClass;',"\t\t\t\t\t} else {","\t\t\t\t\t\tel.className = cssClass;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction hasClass(el, cssClass) {","\t\t\t\tif (el.className) {",'\t\t\t\t\tvar classNames = el.className.split(" ");',"\t\t\t\t\treturn array_contains(classNames, cssClass);","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction removeClass(el, cssClass) {","\t\t\t\tif (hasClass(el, cssClass)) {","\t\t\t\t\t// Rebuild the className property",'\t\t\t\t\tvar existingClasses = el.className.split(" ");',"\t\t\t\t\tvar newClasses = [];","\t\t\t\t\tfor (var i = 0, len = existingClasses.length; i < len; i++) {","\t\t\t\t\t\tif (existingClasses[i] != cssClass) {","\t\t\t\t\t\t\tnewClasses[newClasses.length] = existingClasses[i];","\t\t\t\t\t\t}","\t\t\t\t\t}",'\t\t\t\t\tel.className = newClasses.join(" ");',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction replaceClass(el, newCssClass, oldCssClass) {","\t\t\t\tremoveClass(el, oldCssClass);","\t\t\t\taddClass(el, newCssClass);","\t\t\t}","","\t\t\t/* ------------------------------------------------------------------------- */","","\t\t\t// Other utility functions","","\t\t\tfunction getElementsByClass(el, cssClass, tagName) {","\t\t\t\tvar elements = el.getElementsByTagName(tagName);","\t\t\t\tvar matches = [];","\t\t\t\tfor (var i = 0, len = elements.length; i < len; i++) {","\t\t\t\t\tif (hasClass(elements[i], cssClass)) {","\t\t\t\t\t\tmatches.push(elements[i]);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\treturn matches;","\t\t\t}","","\t\t\t// Syntax borrowed from Prototype library","\t\t\tfunction $(id) {","\t\t\t\treturn document.getElementById(id);","\t\t\t}","","\t\t\tfunction isDescendant(node, ancestorNode) {","\t\t\t\twhile (node != null) {","\t\t\t\t\tif (node === ancestorNode) {","\t\t\t\t\t\treturn true;","\t\t\t\t\t}","\t\t\t\t\tnode = node.parentNode;","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction isOrphan(node) {","\t\t\t\tvar currentNode = node;","\t\t\t\twhile (currentNode) {","\t\t\t\t\tif (currentNode == document.body) {","\t\t\t\t\t\treturn false;","\t\t\t\t\t}","\t\t\t\t\tcurrentNode = currentNode.parentNode;","\t\t\t\t}","\t\t\t\treturn true;","\t\t\t}","","\t\t\tfunction escapeHtml(str) {",'\t\t\t\treturn str.replace(/&/g, "&amp;").replace(/[<]/g, "&lt;").replace(/>/g, "&gt;");',"\t\t\t}","","\t\t\tfunction getWindowWidth() {","\t\t\t\tif (window.innerWidth) {","\t\t\t\t\treturn window.innerWidth;","\t\t\t\t} else if (document.documentElement && document.documentElement.clientWidth) {","\t\t\t\t\treturn document.documentElement.clientWidth;","\t\t\t\t} else if (document.body) {","\t\t\t\t\treturn document.body.clientWidth;","\t\t\t\t}","\t\t\t\treturn 0;","\t\t\t}","","\t\t\tfunction getWindowHeight() {","\t\t\t\tif (window.innerHeight) {","\t\t\t\t\treturn window.innerHeight;","\t\t\t\t} else if (document.documentElement && document.documentElement.clientHeight) {","\t\t\t\t\treturn document.documentElement.clientHeight;","\t\t\t\t} else if (document.body) {","\t\t\t\t\treturn document.body.clientHeight;","\t\t\t\t}","\t\t\t\treturn 0;","\t\t\t}","","\t\t\tfunction getToolBarsHeight() {",'\t\t\t\treturn $("switches").offsetHeight;',"\t\t\t}","","\t\t\tfunction getChromeHeight() {","\t\t\t\tvar height = getToolBarsHeight();","\t\t\t\tif (showCommandLine) {",'\t\t\t\t\theight += $("commandLine").offsetHeight;',"\t\t\t\t}","\t\t\t\treturn height;","\t\t\t}","","\t\t\tfunction setLogContainerHeight() {","\t\t\t\tif (logMainContainer) {","\t\t\t\t\tvar windowHeight = getWindowHeight();",'\t\t\t\t\t$("body").style.height = getWindowHeight() + "px";','\t\t\t\t\tlogMainContainer.style.height = "" +','\t\t\t\t\t\tMath.max(0, windowHeight - getChromeHeight()) + "px";',"\t\t\t\t}","\t\t\t}","","\t\t\tfunction setCommandInputWidth() {","\t\t\t\tif (showCommandLine) {",'\t\t\t\t\t$("command").style.width = "" + Math.max(0, $("commandLineContainer").offsetWidth -','\t\t\t\t\t\t($("evaluateButton").offsetWidth + 13)) + "px";',"\t\t\t\t}","\t\t\t}","","\t\t\twindow.onresize = function() {","\t\t\t\tsetCommandInputWidth();","\t\t\t\tsetLogContainerHeight();","\t\t\t};","","\t\t\tif (!Array.prototype.push) {","\t\t\t\tArray.prototype.push = function() {","\t\t\t        for (var i = 0, len = arguments.length; i < len; i++){","\t\t\t            this[this.length] = arguments[i];","\t\t\t        }","\t\t\t        return this.length;","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.pop) {","\t\t\t\tArray.prototype.pop = function() {","\t\t\t\t\tif (this.length > 0) {","\t\t\t\t\t\tvar val = this[this.length - 1];","\t\t\t\t\t\tthis.length = this.length - 1;","\t\t\t\t\t\treturn val;","\t\t\t\t\t}","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.shift) {","\t\t\t\tArray.prototype.shift = function() {","\t\t\t\t\tif (this.length > 0) {","\t\t\t\t\t\tvar firstItem = this[0];","\t\t\t\t\t\tfor (var i = 0, len = this.length - 1; i < len; i++) {","\t\t\t\t\t\t\tthis[i] = this[i + 1];","\t\t\t\t\t\t}","\t\t\t\t\t\tthis.length = this.length - 1;","\t\t\t\t\t\treturn firstItem;","\t\t\t\t\t}","\t\t\t\t};","\t\t\t}","","\t\t\tif (!Array.prototype.splice) {","\t\t\t\tArray.prototype.splice = function(startIndex, deleteCount) {","\t\t\t\t\tvar itemsAfterDeleted = this.slice(startIndex + deleteCount);","\t\t\t\t\tvar itemsDeleted = this.slice(startIndex, startIndex + deleteCount);","\t\t\t\t\tthis.length = startIndex;","\t\t\t\t\t// Copy the arguments into a proper Array object","\t\t\t\t\tvar argumentsArray = [];","\t\t\t\t\tfor (var i = 0, len = arguments.length; i < len; i++) {","\t\t\t\t\t\targumentsArray[i] = arguments[i];","\t\t\t\t\t}","\t\t\t\t\tvar itemsToAppend = (argumentsArray.length > 2) ?","\t\t\t\t\t\titemsAfterDeleted = argumentsArray.slice(2).concat(itemsAfterDeleted) : itemsAfterDeleted;","\t\t\t\t\tfor (i = 0, len = itemsToAppend.length; i < len; i++) {","\t\t\t\t\t\tthis.push(itemsToAppend[i]);","\t\t\t\t\t}","\t\t\t\t\treturn itemsDeleted;","\t\t\t\t};","\t\t\t}","","\t\t\tfunction array_remove(arr, val) {","\t\t\t\tvar index = -1;","\t\t\t\tfor (var i = 0, len = arr.length; i < len; i++) {","\t\t\t\t\tif (arr[i] === val) {","\t\t\t\t\t\tindex = i;","\t\t\t\t\t\tbreak;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tif (index >= 0) {","\t\t\t\t\tarr.splice(index, 1);","\t\t\t\t\treturn index;","\t\t\t\t} else {","\t\t\t\t\treturn false;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction array_removeFromStart(array, numberToRemove) {","\t\t\t\tif (Array.prototype.splice) {","\t\t\t\t\tarray.splice(0, numberToRemove);","\t\t\t\t} else {","\t\t\t\t\tfor (var i = numberToRemove, len = array.length; i < len; i++) {","\t\t\t\t\t\tarray[i - numberToRemove] = array[i];","\t\t\t\t\t}","\t\t\t\t\tarray.length = array.length - numberToRemove;","\t\t\t\t}","\t\t\t\treturn array;","\t\t\t}","","\t\t\tfunction array_contains(arr, val) {","\t\t\t\tfor (var i = 0, len = arr.length; i < len; i++) {","\t\t\t\t\tif (arr[i] == val) {","\t\t\t\t\t\treturn true;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\treturn false;","\t\t\t}","","\t\t\tfunction getErrorMessage(ex) {","\t\t\t\tif (ex.message) {","\t\t\t\t\treturn ex.message;","\t\t\t\t} else if (ex.description) {","\t\t\t\t\treturn ex.description;","\t\t\t\t}",'\t\t\t\treturn "" + ex;',"\t\t\t}","","\t\t\tfunction moveCaretToEnd(input) {","\t\t\t\tif (input.setSelectionRange) {","\t\t\t\t\tinput.focus();","\t\t\t\t\tvar length = input.value.length;","\t\t\t\t\tinput.setSelectionRange(length, length);","\t\t\t\t} else if (input.createTextRange) {","\t\t\t\t\tvar range = input.createTextRange();","\t\t\t\t\trange.collapse(false);","\t\t\t\t\trange.select();","\t\t\t\t}","\t\t\t\tinput.focus();","\t\t\t}","","\t\t\tfunction stopPropagation(evt) {","\t\t\t\tif (evt.stopPropagation) {","\t\t\t\t\tevt.stopPropagation();",'\t\t\t\t} else if (typeof evt.cancelBubble != "undefined") {',"\t\t\t\t\tevt.cancelBubble = true;","\t\t\t\t}","\t\t\t}","","\t\t\tfunction getEvent(evt) {","\t\t\t\treturn evt ? evt : event;","\t\t\t}","","\t\t\tfunction getTarget(evt) {","\t\t\t\treturn evt.target ? evt.target : evt.srcElement;","\t\t\t}","","\t\t\tfunction getRelatedTarget(evt) {","\t\t\t\tif (evt.relatedTarget) {","\t\t\t\t\treturn evt.relatedTarget;","\t\t\t\t} else if (evt.srcElement) {","\t\t\t\t\tswitch(evt.type) {",'\t\t\t\t\t\tcase "mouseover":',"\t\t\t\t\t\t\treturn evt.fromElement;",'\t\t\t\t\t\tcase "mouseout":',"\t\t\t\t\t\t\treturn evt.toElement;","\t\t\t\t\t\tdefault:","\t\t\t\t\t\t\treturn evt.srcElement;","\t\t\t\t\t}","\t\t\t\t}","\t\t\t}","","\t\t\tfunction cancelKeyEvent(evt) {","\t\t\t\tevt.returnValue = false;","\t\t\t\tstopPropagation(evt);","\t\t\t}","","\t\t\tfunction evalCommandLine() {",'\t\t\t\tvar expr = $("command").value;',"\t\t\t\tevalCommand(expr);",'\t\t\t\t$("command").value = "";',"\t\t\t}","","\t\t\tfunction evalLastCommand() {","\t\t\t\tif (lastCommand != null) {","\t\t\t\t\tevalCommand(lastCommand);","\t\t\t\t}","\t\t\t}","","\t\t\tvar lastCommand = null;","\t\t\tvar commandHistory = [];","\t\t\tvar currentCommandIndex = 0;","","\t\t\tfunction evalCommand(expr) {","\t\t\t\tif (appender) {","\t\t\t\t\tappender.evalCommandAndAppend(expr);","\t\t\t\t} else {",'\t\t\t\t\tvar prefix = ">>> " + expr + "\\r\\n";',"\t\t\t\t\ttry {",'\t\t\t\t\t\tlog("INFO", prefix + eval(expr));',"\t\t\t\t\t} catch (ex) {",'\t\t\t\t\t\tlog("ERROR", prefix + "Error: " + getErrorMessage(ex));',"\t\t\t\t\t}","\t\t\t\t}","\t\t\t\t// Update command history","\t\t\t\tif (expr != commandHistory[commandHistory.length - 1]) {","\t\t\t\t\tcommandHistory.push(expr);","\t\t\t\t\t// Update the appender","\t\t\t\t\tif (appender) {","\t\t\t\t\t\tappender.storeCommandHistory(commandHistory);","\t\t\t\t\t}","\t\t\t\t}","\t\t\t\tcurrentCommandIndex = (expr == commandHistory[currentCommandIndex]) ? currentCommandIndex + 1 : commandHistory.length;","\t\t\t\tlastCommand = expr;","\t\t\t}","\t\t\t//]]>","\t\t<\/script>",'\t\t<style type="text/css">',"\t\t\tbody {","\t\t\t\tbackground-color: white;","\t\t\t\tcolor: black;","\t\t\t\tpadding: 0;","\t\t\t\tmargin: 0;","\t\t\t\tfont-family: tahoma, verdana, arial, helvetica, sans-serif;","\t\t\t\toverflow: hidden;","\t\t\t}","","\t\t\tdiv#switchesContainer input {","\t\t\t\tmargin-bottom: 0;","\t\t\t}","","\t\t\tdiv.toolbar {","\t\t\t\tborder-top: solid #ffffff 1px;","\t\t\t\tborder-bottom: solid #aca899 1px;","\t\t\t\tbackground-color: #f1efe7;","\t\t\t\tpadding: 3px 5px;","\t\t\t\tfont-size: 68.75%;","\t\t\t}","","\t\t\tdiv.toolbar, div#search input {","\t\t\t\tfont-family: tahoma, verdana, arial, helvetica, sans-serif;","\t\t\t}","","\t\t\tdiv.toolbar input.button {","\t\t\t\tpadding: 0 5px;","\t\t\t\tfont-size: 100%;","\t\t\t}","","\t\t\tdiv.toolbar input.hidden {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#switches input#clearButton {","\t\t\t\tmargin-left: 20px;","\t\t\t}","","\t\t\tdiv#levels label {","\t\t\t\tfont-weight: bold;","\t\t\t}","","\t\t\tdiv#levels label, div#options label {","\t\t\t\tmargin-right: 5px;","\t\t\t}","","\t\t\tdiv#levels label#wrapLabel {","\t\t\t\tfont-weight: normal;","\t\t\t}","","\t\t\tdiv#search label {","\t\t\t\tmargin-right: 10px;","\t\t\t}","","\t\t\tdiv#search label.searchboxlabel {","\t\t\t\tmargin-right: 0;","\t\t\t}","","\t\t\tdiv#search input {","\t\t\t\tfont-size: 100%;","\t\t\t}","","\t\t\tdiv#search input.validregex {","\t\t\t\tcolor: green;","\t\t\t}","","\t\t\tdiv#search input.invalidregex {","\t\t\t\tcolor: red;","\t\t\t}","","\t\t\tdiv#search input.nomatches {","\t\t\t\tcolor: white;","\t\t\t\tbackground-color: #ff6666;","\t\t\t}","","\t\t\tdiv#search input.nomatches {","\t\t\t\tcolor: white;","\t\t\t\tbackground-color: #ff6666;","\t\t\t}","","\t\t\tdiv#searchNav {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#commandLine {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv#commandLine input#command {","\t\t\t\tfont-size: 100%;","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t}","","\t\t\tdiv#commandLine input#evaluateButton {","\t\t\t}","","\t\t\t*.greyedout {","\t\t\t\tcolor: gray !important;","\t\t\t\tborder-color: gray !important;","\t\t\t}","","\t\t\t*.greyedout *.alwaysenabled { color: black; }","","\t\t\t*.unselectable {","\t\t\t\t-khtml-user-select: none;","\t\t\t\t-moz-user-select: none;","\t\t\t\tuser-select: none;","\t\t\t}","","\t\t\tdiv#log {","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t\tfont-size: 75%;","\t\t\t\twidth: 100%;","\t\t\t\toverflow: auto;","\t\t\t\tclear: both;","\t\t\t\tposition: relative;","\t\t\t}","","\t\t\tdiv.group {","\t\t\t\tborder-color: #cccccc;","\t\t\t\tborder-style: solid;","\t\t\t\tborder-width: 1px 0 1px 1px;","\t\t\t\toverflow: visible;","\t\t\t}","","\t\t\tdiv.oldIe div.group, div.oldIe div.group *, div.oldIe *.logentry {","\t\t\t\theight: 1%;","\t\t\t}","","\t\t\tdiv.group div.groupheading span.expander {","\t\t\t\tborder: solid black 1px;","\t\t\t\tfont-family: Courier New, Courier;","\t\t\t\tfont-size: 0.833em;","\t\t\t\tbackground-color: #eeeeee;","\t\t\t\tposition: relative;","\t\t\t\ttop: -1px;","\t\t\t\tcolor: black;","\t\t\t\tpadding: 0 2px;","\t\t\t\tcursor: pointer;","\t\t\t\tcursor: hand;","\t\t\t\theight: 1%;","\t\t\t}","","\t\t\tdiv.group div.groupcontent {","\t\t\t\tmargin-left: 10px;","\t\t\t\tpadding-bottom: 2px;","\t\t\t\toverflow: visible;","\t\t\t}","","\t\t\tdiv.group div.expanded {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv.group div.collapsed {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\t*.logentry {","\t\t\t\toverflow: visible;","\t\t\t\tdisplay: none;","\t\t\t\twhite-space: pre;","\t\t\t}","","\t\t\tspan.pre {","\t\t\t\twhite-space: pre;","\t\t\t}","\t\t\t","\t\t\tpre.unwrapped {","\t\t\t\tdisplay: inline !important;","\t\t\t}","","\t\t\tpre.unwrapped pre.pre, div.wrapped pre.pre {","\t\t\t\tdisplay: inline;","\t\t\t}","","\t\t\tdiv.wrapped pre.pre {","\t\t\t\twhite-space: normal;","\t\t\t}","","\t\t\tdiv.wrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tbody.searching *.logentry span.currentmatch {","\t\t\t\tcolor: white !important;","\t\t\t\tbackground-color: green !important;","\t\t\t}","","\t\t\tbody.searching div.searchhighlight *.logentry span.searchterm {","\t\t\t\tcolor: black;","\t\t\t\tbackground-color: yellow;","\t\t\t}","","\t\t\tdiv.wrap *.logentry {","\t\t\t\twhite-space: normal !important;","\t\t\t\tborder-width: 0 0 1px 0;","\t\t\t\tborder-color: #dddddd;","\t\t\t\tborder-style: dotted;","\t\t\t}","","\t\t\tdiv.wrap #log_wrapped, #log_unwrapped {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv.wrap #log_unwrapped, #log_wrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv.wrap *.logentry span.pre {","\t\t\t\toverflow: visible;","\t\t\t\twhite-space: normal;","\t\t\t}","","\t\t\tdiv.wrap *.logentry pre.unwrapped {","\t\t\t\tdisplay: none;","\t\t\t}","","\t\t\tdiv.wrap *.logentry span.wrapped {","\t\t\t\tdisplay: inline;","\t\t\t}","","\t\t\tdiv.searchfilter *.searchnonmatch {","\t\t\t\tdisplay: none !important;","\t\t\t}","","\t\t\tdiv#log *.TRACE, label#label_TRACE {","\t\t\t\tcolor: #666666;","\t\t\t}","","\t\t\tdiv#log *.DEBUG, label#label_DEBUG {","\t\t\t\tcolor: green;","\t\t\t}","","\t\t\tdiv#log *.INFO, label#label_INFO {","\t\t\t\tcolor: #000099;","\t\t\t}","","\t\t\tdiv#log *.WARN, label#label_WARN {","\t\t\t\tcolor: #999900;","\t\t\t}","","\t\t\tdiv#log *.ERROR, label#label_ERROR {","\t\t\t\tcolor: red;","\t\t\t}","","\t\t\tdiv#log *.FATAL, label#label_FATAL {","\t\t\t\tcolor: #660066;","\t\t\t}","","\t\t\tdiv.TRACE#log *.TRACE,","\t\t\tdiv.DEBUG#log *.DEBUG,","\t\t\tdiv.INFO#log *.INFO,","\t\t\tdiv.WARN#log *.WARN,","\t\t\tdiv.ERROR#log *.ERROR,","\t\t\tdiv.FATAL#log *.FATAL {","\t\t\t\tdisplay: block;","\t\t\t}","","\t\t\tdiv#log div.separator {","\t\t\t\tbackground-color: #cccccc;","\t\t\t\tmargin: 5px 0;","\t\t\t\tline-height: 1px;","\t\t\t}","\t\t</style>","\t</head>","",'\t<body id="body">','\t\t<div id="switchesContainer">','\t\t\t<div id="switches">','\t\t\t\t<div id="levels" class="toolbar">',"\t\t\t\t\tFilters:",'\t\t\t\t\t<input type="checkbox" id="switch_TRACE" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide trace messages" /><label for="switch_TRACE" id="label_TRACE">trace</label>','\t\t\t\t\t<input type="checkbox" id="switch_DEBUG" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide debug messages" /><label for="switch_DEBUG" id="label_DEBUG">debug</label>','\t\t\t\t\t<input type="checkbox" id="switch_INFO" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide info messages" /><label for="switch_INFO" id="label_INFO">info</label>','\t\t\t\t\t<input type="checkbox" id="switch_WARN" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide warn messages" /><label for="switch_WARN" id="label_WARN">warn</label>','\t\t\t\t\t<input type="checkbox" id="switch_ERROR" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide error messages" /><label for="switch_ERROR" id="label_ERROR">error</label>','\t\t\t\t\t<input type="checkbox" id="switch_FATAL" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide fatal messages" /><label for="switch_FATAL" id="label_FATAL">fatal</label>','\t\t\t\t\t<input type="checkbox" id="switch_ALL" onclick="toggleAllLevels(); applyFilters()" checked="checked" title="Show/hide all messages" /><label for="switch_ALL" id="label_ALL">all</label>',"\t\t\t\t</div>",'\t\t\t\t<div id="search" class="toolbar">','\t\t\t\t\t<label for="searchBox" class="searchboxlabel">Search:</label> <input type="text" id="searchBox" onclick="toggleSearchEnabled(true)" onkeyup="scheduleSearch()" size="20" />','\t\t\t\t\t<input type="button" id="searchReset" disabled="disabled" value="Reset" onclick="clearSearch()" class="button" title="Reset the search" />','\t\t\t\t\t<input type="checkbox" id="searchRegex" onclick="doSearch()" title="If checked, search is treated as a regular expression" /><label for="searchRegex">Regex</label>','\t\t\t\t\t<input type="checkbox" id="searchCaseSensitive" onclick="doSearch()" title="If checked, search is case sensitive" /><label for="searchCaseSensitive">Match case</label>','\t\t\t\t\t<input type="checkbox" id="searchDisable" onclick="toggleSearchEnabled()" title="Enable/disable search" /><label for="searchDisable" class="alwaysenabled">Disable</label>','\t\t\t\t\t<div id="searchNav">','\t\t\t\t\t\t<input type="button" id="searchNext" disabled="disabled" value="Next" onclick="searchNext()" class="button" title="Go to the next matching log entry" />','\t\t\t\t\t\t<input type="button" id="searchPrevious" disabled="disabled" value="Previous" onclick="searchPrevious()" class="button" title="Go to the previous matching log entry" />','\t\t\t\t\t\t<input type="checkbox" id="searchFilter" onclick="toggleSearchFilter()" title="If checked, non-matching log entries are filtered out" /><label for="searchFilter">Filter</label>','\t\t\t\t\t\t<input type="checkbox" id="searchHighlight" onclick="toggleSearchHighlight()" title="Highlight matched search terms" /><label for="searchHighlight" class="alwaysenabled">Highlight all</label>',"\t\t\t\t\t</div>","\t\t\t\t</div>",'\t\t\t\t<div id="options" class="toolbar">',"\t\t\t\t\tOptions:",'\t\t\t\t\t<input type="checkbox" id="enableLogging" onclick="toggleLoggingEnabled()" checked="checked" title="Enable/disable logging" /><label for="enableLogging" id="enableLoggingLabel">Log</label>','\t\t\t\t\t<input type="checkbox" id="wrap" onclick="toggleWrap()" title="Enable / disable word wrap" /><label for="wrap" id="wrapLabel">Wrap</label>','\t\t\t\t\t<input type="checkbox" id="newestAtTop" onclick="toggleNewestAtTop()" title="If checked, causes newest messages to appear at the top" /><label for="newestAtTop" id="newestAtTopLabel">Newest at the top</label>','\t\t\t\t\t<input type="checkbox" id="scrollToLatest" onclick="toggleScrollToLatest()" checked="checked" title="If checked, window automatically scrolls to a new message when it is added" /><label for="scrollToLatest" id="scrollToLatestLabel">Scroll to latest</label>','\t\t\t\t\t<input type="button" id="clearButton" value="Clear" onclick="clearLog()" class="button" title="Clear all log messages"  />','\t\t\t\t\t<input type="button" id="hideButton" value="Hide" onclick="hide()" class="hidden button" title="Hide the console" />','\t\t\t\t\t<input type="button" id="closeButton" value="Close" onclick="closeWindow()" class="hidden button" title="Close the window" />',"\t\t\t\t</div>","\t\t\t</div>","\t\t</div>",'\t\t<div id="log" class="TRACE DEBUG INFO WARN ERROR FATAL"></div>','\t\t<div id="commandLine" class="toolbar">','\t\t\t<div id="commandLineContainer">','\t\t\t\t<input type="text" id="command" title="Enter a JavaScript command here and hit return or press \'Evaluate\'" />','\t\t\t\t<input type="button" id="evaluateButton" value="Evaluate" class="button" title="Evaluate the command" onclick="evalCommandLine()" />',"\t\t\t</div>","\t\t</div>","\t</body>","</html>",""];t.open();for(var r=0,n=e.length;r<n;r++)t.writeln(e[r]);t.close()};this.setEventTypes(["load","unload"]);var Y=function(){var t=E();t.setAppender(p),t.setNewestAtTop(s),t.setScrollToLatest(v),t.setMaxMessages(S),t.setShowCommandLine(T),t.setShowHideButton(C),t.setShowCloseButton(x),t.setMainWindow(window);var e=getCookie(F);e&&(t.commandHistory=e.split(","),t.currentCommandIndex=t.commandHistory.length),p.dispatchEvent("load",{win:t})};this.unload=function(){logLog.debug("unload "+this+", caller: "+this.unload.caller),d||(logLog.debug("really doing unload "+this),h=f=!(d=!0),p.dispatchEvent("unload",{}))};var q=function(t,e,r,n){var i=setInterval(function(){try{d&&clearInterval(i),t(E())&&(clearInterval(i),r())}catch(t){clearInterval(i),g=!1,handleError(n,t)}},e)},W=function(){var t=document.domain!=location.hostname;return l?"":getBaseUrl()+"console_uncompressed.html"+(t?"?log4javascript_domain="+escape(document.domain):"")};if(t){var G,H=null,K=[],z=!(this.addCssProperty=function(t,e){A("cssProperties")&&K.push([t,e])}),$=uniqueId+"_InPageAppender_"+m;this.hide=function(){i&&h&&(M()&&E().$("command").blur(),G.style.display="none",R=!0)},this.show=function(){i&&(h?(G.style.display="block",this.setShowCommandLine(T),R=!1):z||b(!0))},this.isVisible=function(){return!R&&!d},this.close=function(t){d||t&&!confirm("This will permanently remove the console from the page. No more messages will be logged. Do you wish to continue?")||(G.parentNode.removeChild(G),this.unload())},_=function(){var e="InPageAppender.open: unable to create console iframe";function r(){try{a||p.show(),Y(),f=!0,j()}catch(t){g=!1,handleError(e,t)}}function t(){try{var t=function(t){return isLoaded(t)};l&&V(E().document),t(E())?r():q(t,100,r,e)}catch(t){g=!1,handleError(e,t)}}R=!1,(G=H.appendChild(document.createElement("div"))).style.width=u,G.style.height=c,G.style.border="solid gray 1px";for(var n=0,i=K.length;n<i;n++)G.style[K[n][0]]=K[n][1];var o=l?"":" src='"+W()+"'";G.innerHTML="<iframe id='"+$+"' name='"+$+"' width='100%' height='100%' frameborder='0'"+o+" scrolling='no'></iframe>",d=!1;var s=function(t){try{return bool(t)&&bool(t.document)}catch(t){return!1}};s(E())?t():q(s,100,t,e),h=!0},b=function(t){if(t||!a){var e=function(){if(r)try{var t=document.getElementById(r);1==t.nodeType&&(H=t),_()}catch(t){handleError("InPageAppender.init: invalid container element '"+r+"' supplied",t)}else(H=document.createElement("div")).style.position="fixed",H.style.left="0",H.style.right="0",H.style.bottom="0",document.body.appendChild(H),p.addCssProperty("borderWidth","1px 0 0 0"),p.addCssProperty("zIndex",1e6),_()};pageLoaded&&r&&r.appendChild?(H=r,_()):pageLoaded?e():log4javascript.addEventListener("load",e),z=!0}},y=function(){b(),i=!0},E=function(){var t=window.frames[$];if(t)return t},w=function(){return!(!g||d)&&(h&&!f&&E()&&isLoaded(E())&&(f=!0),f)}}else{var Z,X=p.defaults.useOldPopUp,J=p.defaults.complainAboutPopUpBlocking,Q=this.defaults.reopenWhenClosed;this.isUseOldPopUp=function(){return X},this.setUseOldPopUp=function(t){A("useOldPopUp")&&(X=bool(t))},this.isComplainAboutPopUpBlocking=function(){return J},this.setComplainAboutPopUpBlocking=function(t){A("complainAboutPopUpBlocking")&&(J=bool(t))},this.isFocusPopUp=function(){return n},this.setFocusPopUp=function(t){n=bool(t)},this.isReopenWhenClosed=function(){return Q},this.setReopenWhenClosed=function(t){Q=bool(t)},this.close=function(){logLog.debug("close "+this);try{Z.close(),this.unload()}catch(t){}},this.hide=function(){logLog.debug("hide "+this),M()&&this.close()},this.show=function(){logLog.debug("show "+this),h||_()},this.isVisible=function(){return w()},_=function(){var t="width="+u+",height="+c+",status,resizable",e="";try{var r=window.frameElement;r&&(e="_"+r.tagName+"_"+(r.name||r.id||""))}catch(t){e="_inaccessibleParentFrame"}var n="PopUp_"+location.host.replace(/[^a-z0-9]/gi,"_")+"_"+m+e;X&&l||(n=n+"_"+uniqueId);var i=function(t){if(d)return!0;try{return bool(t)&&t.closed}catch(t){}return!1},o=function(){d||p.unload()};function s(){E().setCloseIfOpenerCloses(!X||!l),Y(),f=!0,j(),q(i,500,o,"PopUpAppender.checkPopUpClosed: error checking pop-up window")}try{if(Z=window.open(W(),n,t),h=!(d=!1),Z&&Z.document)if(l&&X&&isLoaded(Z))Z.mainPageReloaded(),s();else{l&&V(Z.document);isLoaded(Z)?s():q(function(t){return bool(t)&&isLoaded(t)},100,s,"PopUpAppender.init: unable to create console window")}else g=!1,logLog.warn("PopUpAppender.init: pop-ups blocked, please unblock to use PopUpAppender"),J&&handleError("log4javascript: pop-up windows appear to be blocked. Please unblock them to use pop-up logging.")}catch(t){handleError("PopUpAppender.init: error creating pop-up",t)}},b=function(){a||_()},y=function(){b(),i=!0},E=function(){return Z},w=function(){if(g&&!isUndefined(Z)&&!d){if(Z.closed||f&&isUndefined(Z.closed))return p.unload(),logLog.debug("PopUpAppender: pop-up closed"),!1;!f&&isLoaded(Z)&&(f=!0)}return g&&f&&!d}}this.getConsoleWindow=E},ConsoleAppender.addGlobalCommandLineFunction=function(t,e){tt.push([t,e])},(t.prototype=new ConsoleAppender).defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:!1,focusPopUp:!1,lazyInit:!0,useOldPopUp:!0,complainAboutPopUpBlocking:!0,newestMessageAtTop:!1,scrollToLatestMessage:!0,width:"600",height:"400",reopenWhenClosed:!1,maxMessages:null,showCommandLine:!0,commandLineObjectExpansionDepth:1,showHideButton:!1,showCloseButton:!0,useDocumentWrite:!0},t.prototype.toString=function(){return"PopUpAppender"},log4javascript.PopUpAppender=t,(e.prototype=new ConsoleAppender).defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:!1,lazyInit:!0,newestMessageAtTop:!1,scrollToLatestMessage:!0,width:"100%",height:"220px",maxMessages:null,showCommandLine:!0,commandLineObjectExpansionDepth:1,showHideButton:!1,showCloseButton:!1,showLogEntryDeleteButtons:!0,useDocumentWrite:!0},e.prototype.toString=function(){return"InPageAppender"},log4javascript.InPageAppender=e,log4javascript.InlineAppender=e}(),function(){function s(t){var e=0;for(var r in t)e=Math.max(toStr(r).length,e);var n=[];for(r in t){var i,o="  "+padWithSpaces(toStr(r),e+2);try{i=splitIntoLines(toStr(t[r])).join(padWithSpaces(newLine,e+6))}catch(t){i="[Error obtaining property. Details: "+getExceptionMessage(t)+"]"}n.push(o+i)}return n.join(newLine)}var w={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},E=["script","pre"],_=["br","img","hr","param","link","area","input","col","base","meta"],S="  ";function T(t,e,r,n,i){var o;function s(t){for(var e=t.style.cssText.split(";"),r="",n=0,i=e.length;n<i;n++){var o=e[n].split(":"),s=[];/^\s*$/.test(o[0])||s.push(trim(o[0]).toLowerCase()+":"+trim(o[1])),r=s.join(";")}return r}"string"!=typeof r&&(r=""),n=!!n,i=!!i;var a,l,u,c;if(!(e=void 0===e||!!e)||t.nodeType==w.DOCUMENT_FRAGMENT_NODE){for(o="",a=0,l=t.childNodes.length;a<l;a++)o+=T(t.childNodes[a],!0,r+S);return o}switch(t.nodeType){case w.ELEMENT_NODE:var h=t.tagName.toLowerCase();o=n?newLine+r:"",o+="<";var f=(c=t).prefix?c.prefix:c.outerHTML&&new RegExp("<([^:]+):"+c.tagName+"[^>]*>","i").test(c.outerHTML)?RegExp.$1.toLowerCase():"",p=!!f;for(p&&(o+=f+":"),o+=h,a=0,l=t.attributes.length;a<l;a++){var d=t.attributes[a];d.specified&&null!==d.nodeValue&&"style"!==d.nodeName.toLowerCase()&&"string"==typeof d.nodeValue&&0!==d.nodeName.indexOf("_moz")&&(o+=" "+d.nodeName.toLowerCase()+'="',o+=d.nodeValue.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;"),o+='"')}if(t.style.cssText)""!==s(t)&&(o+=' style="'+s(t)+'"');if(array_contains(_,h)||p&&!t.hasChildNodes())o+="/>";else{o+=">";var g=!(1===t.childNodes.length&&t.childNodes[0].nodeType===w.TEXT_NODE),m=array_contains(E,h);for(a=0,l=t.childNodes.length;a<l;a++)o+=T(t.childNodes[a],!0,r+S,g,m);var v="</"+h+">";o+=g?newLine+r+v:v}return o;case w.TEXT_NODE:if((u=t).nodeType==w.TEXT_NODE&&/^[ \t\r\n]*$/.test(u.nodeValue))o="";else{if(i)o=t.nodeValue;else{var y=splitIntoLines(trim(t.nodeValue)),b=[];for(a=0,l=y.length;a<l;a++)b[a]=trim(y[a]);o=b.join(newLine+r)}n&&(o=newLine+r+o)}return o;case w.CDATA_SECTION_NODE:return"<![CDATA["+t.nodeValue+"]]>"+newLine;case w.DOCUMENT_NODE:for(o="",a=0,l=t.childNodes.length;a<l;a++)o+=T(t.childNodes[a],!0,r);return o;default:return""}}ConsoleAppender.addGlobalCommandLineFunction("$",function(t,e,r){return document.getElementById(e[0])}),ConsoleAppender.addGlobalCommandLineFunction("dir",function(t,e,r){for(var n=[],i=0,o=e.length;i<o;i++)n[i]=s(e[i]);return n.join(newLine+newLine)}),ConsoleAppender.addGlobalCommandLineFunction("dirxml",function(t,e,r){for(var n=[],i=0,o=e.length;i<o;i++)n[i]=T(e[i]);return n.join(newLine+newLine)}),ConsoleAppender.addGlobalCommandLineFunction("cd",function(t,e,r){var n,i;return 0===e.length||""===e[0]?(n=window,i="Command line set to run in main window"):e[0].window==e[0]?(n=e[0],i="Command line set to run in frame '"+e[0].name+"'"):(n=window.frames[e[0]])?i="Command line set to run in frame '"+e[0]+"'":(r.isError=!0,i="Frame '"+e[0]+"' does not exist",n=t.getCommandWindow()),t.setCommandWindow(n),i}),ConsoleAppender.addGlobalCommandLineFunction("clear",function(t,e,r){r.appendResult=!1,t.clear()}),ConsoleAppender.addGlobalCommandLineFunction("keys",function(t,e,r){var n=[];for(var i in e[0])n.push(i);return n}),ConsoleAppender.addGlobalCommandLineFunction("values",function(t,e,r){var n=[];for(var i in e[0])try{n.push(e[0][i])}catch(t){logLog.warn("values(): Unable to obtain value for key "+i+". Details: "+getExceptionMessage(t))}return n}),ConsoleAppender.addGlobalCommandLineFunction("expansionDepth",function(t,e,r){var n=parseInt(e[0],10);return isNaN(n)||n<0?(r.isError=!0,e[0]+" is not a valid expansion depth"):(t.setCommandLineObjectExpansionDepth(n),"Object expansion depth set to "+n)})}(),log4javascript.setDocumentReady=function(){pageLoaded=!0,log4javascript.dispatchEvent("load",{})},window.addEventListener)window.addEventListener("load",log4javascript.setDocumentReady,!1);else if(window.attachEvent)window.attachEvent("onload",log4javascript.setDocumentReady);else{var oldOnload=window.onload;"function"!=typeof window.onload?window.onload=log4javascript.setDocumentReady:window.onload=function(t){oldOnload&&oldOnload(t),log4javascript.setDocumentReady()}}return log4javascript},this),function(t,e){"function"==typeof define&&define.amd?define(["bytebuffer"],e):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=e(require("bytebuffer"),!0):(t.dcodeIO=t.dcodeIO||{}).ProtoBuf=e(t.dcodeIO.ByteBuffer)}(this,function(T,t){"use strict";var i,h,e,s,a,r,o={};return o.ByteBuffer=T,o.Long=T.Long||null,o.VERSION="5.0.1",o.WIRE_TYPES={},o.WIRE_TYPES.VARINT=0,o.WIRE_TYPES.BITS64=1,o.WIRE_TYPES.LDELIM=2,o.WIRE_TYPES.STARTGROUP=3,o.WIRE_TYPES.ENDGROUP=4,o.WIRE_TYPES.BITS32=5,o.PACKABLE_WIRE_TYPES=[o.WIRE_TYPES.VARINT,o.WIRE_TYPES.BITS64,o.WIRE_TYPES.BITS32],o.TYPES={int32:{name:"int32",wireType:o.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:o.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:o.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:o.WIRE_TYPES.VARINT,defaultValue:o.Long?o.Long.ZERO:void 0},uint64:{name:"uint64",wireType:o.WIRE_TYPES.VARINT,defaultValue:o.Long?o.Long.UZERO:void 0},sint64:{name:"sint64",wireType:o.WIRE_TYPES.VARINT,defaultValue:o.Long?o.Long.ZERO:void 0},bool:{name:"bool",wireType:o.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:"double",wireType:o.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:o.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:o.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:o.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:o.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:o.WIRE_TYPES.BITS64,defaultValue:o.Long?o.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:o.WIRE_TYPES.BITS64,defaultValue:o.Long?o.Long.ZERO:void 0},float:{name:"float",wireType:o.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:"enum",wireType:o.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:o.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:o.WIRE_TYPES.STARTGROUP,defaultValue:null}},o.MAP_KEY_TYPES=[o.TYPES.int32,o.TYPES.sint32,o.TYPES.sfixed32,o.TYPES.uint32,o.TYPES.fixed32,o.TYPES.int64,o.TYPES.sint64,o.TYPES.sfixed64,o.TYPES.uint64,o.TYPES.fixed64,o.TYPES.bool,o.TYPES.string,o.TYPES.bytes],o.ID_MIN=1,o.ID_MAX=536870911,o.convertFieldsToCamelCase=!1,o.populateAccessors=!0,o.populateDefaults=!0,o.Util=((i={}).IS_NODE=!("object"!=typeof process||process+""!="[object process]"||process.browser),i.XHR=function(){for(var t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],e=null,r=0;r<t.length;r++){try{e=t[r]()}catch(t){continue}break}if(!e)throw Error("XMLHttpRequest is not supported");return e},i.fetch=function(t,r){if(r&&"function"!=typeof r&&(r=null),i.IS_NODE){var e=require("fs");if(r)e.readFile(t,function(t,e){r(t?null:""+e)});else try{return e.readFileSync(t)}catch(t){return null}}else{var n=i.XHR();if(n.open("GET",t,!!r),n.setRequestHeader("Accept","text/plain"),"function"==typeof n.overrideMimeType&&n.overrideMimeType("text/plain"),!r)return n.send(null),200==n.status||0==n.status&&"string"==typeof n.responseText?n.responseText:null;if(n.onreadystatechange=function(){4==n.readyState&&(200==n.status||0==n.status&&"string"==typeof n.responseText?r(n.responseText):r(null))},4==n.readyState)return;n.send(null)}},i.toCamelCase=function(t){return t.replace(/_([a-zA-Z])/g,function(t,e){return e.toUpperCase()})},i),o.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},o.DotProto=function(i,s){var t={},e=function(t){this.source=t+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},r=e.prototype;r._readString=function(){var t='"'===this._stringOpen?s.STRING_DQ:s.STRING_SQ;t.lastIndex=this.index-1;var e=t.exec(this.source);if(!e)throw Error("unterminated string");return this.index=t.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,e[1]},r.next=function(){if(0<this.stack.length)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var t,e,r;do{for(t=!1;s.WHITESPACE.test(r=this.source.charAt(this.index));)if("\n"===r&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,t=!0}else{if("*"!==(r=this.source.charAt(this.index)))return"/";do{if("\n"===r&&++this.line,++this.index===this.source.length)return null;e=r,r=this.source.charAt(this.index)}while("*"!==e||"/"!==r);++this.index,t=!0}}while(t);if(this.index===this.source.length)return null;var n=this.index;if(s.DELIM.lastIndex=0,!s.DELIM.test(this.source.charAt(n++)))for(;n<this.source.length&&!s.DELIM.test(this.source.charAt(n));)++n;var i=this.source.substring(this.index,this.index=n);return'"'!==i&&"'"!==i||(this._stringOpen=i),i},r.peek=function(){if(0===this.stack.length){var t=this.next();if(null===t)return null;this.stack.push(t)}return this.stack[0]},r.skip=function(t){var e=this.next();if(e!==t)throw Error("illegal '"+e+"', '"+t+"' expected")},r.omit=function(t){return this.peek()===t&&(this.next(),!0)},r.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},t.Tokenizer=e;var n=function(t){this.tn=new e(t),this.proto3=!1},o=n.prototype;function a(t,e){var r=-1,n=1;if("-"==t.charAt(0)&&(n=-1,t=t.substring(1)),s.NUMBER_DEC.test(t))r=parseInt(t);else if(s.NUMBER_HEX.test(t))r=parseInt(t.substring(2),16);else{if(!s.NUMBER_OCT.test(t))throw Error("illegal id value: "+(n<0?"-":"")+t);r=parseInt(t.substring(1),8)}if(r=n*r|0,!e&&r<0)throw Error("illegal id value: "+(n<0?"-":"")+t);return r}function l(t){var e=1;if("-"==t.charAt(0)&&(e=-1,t=t.substring(1)),s.NUMBER_DEC.test(t))return e*parseInt(t,10);if(s.NUMBER_HEX.test(t))return e*parseInt(t.substring(2),16);if(s.NUMBER_OCT.test(t))return e*parseInt(t.substring(1),8);if("inf"===t)return e*(1/0);if("nan"===t)return NaN;if(s.NUMBER_FLT.test(t))return e*parseFloat(t);throw Error("illegal number value: "+(e<0?"-":"")+t)}function u(t,e,r){void 0===t[e]?t[e]=r:(Array.isArray(t[e])||(t[e]=[t[e]]),t[e].push(r))}return o.parse=function(){var t,e,r={name:"[ROOT]",package:null,messages:[],enums:[],imports:[],options:{},services:[]},n=!0;try{for(;t=this.tn.next();)switch(t){case"package":if(!n||null!==r.package)throw Error("unexpected 'package'");if(t=this.tn.next(),!s.TYPEREF.test(t))throw Error("illegal package name: "+t);this.tn.skip(";"),r.package=t;break;case"import":if(!n)throw Error("unexpected 'import'");("public"===(t=this.tn.peek())||(e="weak"===t))&&this.tn.next(),t=this._readString(),this.tn.skip(";"),e||r.imports.push(t);break;case"syntax":if(!n)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(r.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(r,null),n=!1;break;case"enum":this._parseEnum(r),n=!1;break;case"option":this._parseOption(r);break;case"service":this._parseService(r);break;case"extend":this._parseExtend(r);break;default:throw Error("unexpected '"+t+"'")}}catch(t){throw t.message="Parse error at line "+this.tn.line+": "+t.message,t}return delete r.name,r},n.parse=function(t){return new n(t).parse()},o._readString=function(){var t,e,r="";do{if("'"!==(e=this.tn.next())&&'"'!==e)throw Error("illegal string delimiter: "+e);r+=this.tn.next(),this.tn.skip(e),t=this.tn.peek()}while('"'===t||'"'===t);return r},o._readValue=function(t){var e=this.tn.peek();if('"'===e||"'"===e)return this._readString();if(this.tn.next(),s.NUMBER.test(e))return l(e);if(s.BOOL.test(e))return"true"===e.toLowerCase();if(t&&s.TYPEREF.test(e))return e;throw Error("illegal value: "+e)},o._parseOption=function(t,e){var r=this.tn.next(),n=!1;if("("===r&&(n=!0,r=this.tn.next()),!s.TYPEREF.test(r))throw Error("illegal option name: "+r);var i=r;n&&(this.tn.skip(")"),i="("+i+")",r=this.tn.peek(),s.FQTYPEREF.test(r)&&(i+=r,this.tn.next())),this.tn.skip("="),this._parseOptionValue(t,i),e||this.tn.skip(";")},o._parseOptionValue=function(t,e){var r=this.tn.peek();if("{"!==r)u(t.options,e,this._readValue(!0));else for(this.tn.skip("{");"}"!==(r=this.tn.next());){if(!s.NAME.test(r))throw Error("illegal option name: "+e+"."+r);this.tn.omit(":")?u(t.options,e+"."+r,this._readValue(!0)):this._parseOptionValue(t,e+"."+r)}},o._parseService=function(t){var e=this.tn.next();if(!s.NAME.test(e))throw Error("illegal service name at line "+this.tn.line+": "+e);var r={name:e,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(e=this.tn.next());)if("option"===e)this._parseOption(r);else{if("rpc"!==e)throw Error("illegal service token: "+e);this._parseServiceRPC(r)}this.tn.omit(";"),t.services.push(r)},o._parseServiceRPC=function(t){var e=this.tn.next();if(!s.NAME.test(e))throw Error("illegal rpc service method name: "+e);var r=e,n={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),"stream"===(e=this.tn.next()).toLowerCase()&&(n.request_stream=!0,e=this.tn.next()),!s.TYPEREF.test(e))throw Error("illegal rpc service request type: "+e);if(n.request=e,this.tn.skip(")"),"returns"!==(e=this.tn.next()).toLowerCase())throw Error("illegal rpc service request type delimiter: "+e);if(this.tn.skip("("),"stream"===(e=this.tn.next()).toLowerCase()&&(n.response_stream=!0,e=this.tn.next()),n.response=e,this.tn.skip(")"),"{"===(e=this.tn.peek())){for(this.tn.next();"}"!==(e=this.tn.next());){if("option"!==e)throw Error("illegal rpc service token: "+e);this._parseOption(n)}this.tn.omit(";")}else this.tn.skip(";");void 0===t.rpc&&(t.rpc={}),t.rpc[r]=n},o._parseMessage=function(t,e){var r=!!e,n=this.tn.next(),i={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!s.NAME.test(n))throw Error("illegal "+(r?"group":"message")+" name: "+n);for(i.name=n,r&&(this.tn.skip("="),e.id=a(this.tn.next()),i.isGroup=!0),"["===(n=this.tn.peek())&&e&&this._parseFieldOptions(e),this.tn.skip("{");"}"!==(n=this.tn.next());)if(s.RULE.test(n))this._parseMessageField(i,n);else if("oneof"===n)this._parseMessageOneOf(i);else if("enum"===n)this._parseEnum(i);else if("message"===n)this._parseMessage(i);else if("option"===n)this._parseOption(i);else if("service"===n)this._parseService(i);else if("extensions"===n)i.extensions=this._parseExtensionRanges();else if("reserved"===n)this._parseIgnored();else if("extend"===n)this._parseExtend(i);else{if(!s.TYPEREF.test(n))throw Error("illegal message token: "+n);if(!this.proto3)throw Error("illegal field rule: "+n);this._parseMessageField(i,"optional",n)}return this.tn.omit(";"),t.messages.push(i),i},o._parseIgnored=function(){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},o._parseMessageField=function(t,e,r){if(!s.RULE.test(e))throw Error("illegal message field rule: "+e);var n,i={rule:e,type:"",name:"",options:{},id:0};if("map"===e){if(r)throw Error("illegal type: "+r);if(this.tn.skip("<"),n=this.tn.next(),!s.TYPE.test(n)&&!s.TYPEREF.test(n))throw Error("illegal message field type: "+n);if(i.keytype=n,this.tn.skip(","),n=this.tn.next(),!s.TYPE.test(n)&&!s.TYPEREF.test(n))throw Error("illegal message field: "+n);if(i.type=n,this.tn.skip(">"),n=this.tn.next(),!s.NAME.test(n))throw Error("illegal message field name: "+n);i.name=n,this.tn.skip("="),i.id=a(this.tn.next()),"["===(n=this.tn.peek())&&this._parseFieldOptions(i),this.tn.skip(";")}else if("group"===(r=void 0!==r?r:this.tn.next())){var o=this._parseMessage(t,i);if(!/^[A-Z]/.test(o.name))throw Error("illegal group name: "+o.name);i.type=o.name,i.name=o.name.toLowerCase(),this.tn.omit(";")}else{if(!s.TYPE.test(r)&&!s.TYPEREF.test(r))throw Error("illegal message field type: "+r);if(i.type=r,n=this.tn.next(),!s.NAME.test(n))throw Error("illegal message field name: "+n);i.name=n,this.tn.skip("="),i.id=a(this.tn.next()),"["===(n=this.tn.peek())&&this._parseFieldOptions(i),this.tn.skip(";")}return t.fields.push(i),i},o._parseMessageOneOf=function(t){var e=this.tn.next();if(!s.NAME.test(e))throw Error("illegal oneof name: "+e);var r,n=e,i=[];for(this.tn.skip("{");"}"!==(e=this.tn.next());)(r=this._parseMessageField(t,"optional",e)).oneof=n,i.push(r.id);this.tn.omit(";"),t.oneofs[n]=i},o._parseFieldOptions=function(t){this.tn.skip("[");for(var e=!0;"]"!==this.tn.peek();)e||this.tn.skip(","),this._parseOption(t,!0),e=!1;this.tn.next()},o._parseEnum=function(t){var e={name:"",values:[],options:{}},r=this.tn.next();if(!s.NAME.test(r))throw Error("illegal name: "+r);for(e.name=r,this.tn.skip("{");"}"!==(r=this.tn.next());)if("option"===r)this._parseOption(e);else{if(!s.NAME.test(r))throw Error("illegal name: "+r);this.tn.skip("=");var n={name:r,id:a(this.tn.next(),!0)};"["===(r=this.tn.peek())&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),e.values.push(n)}this.tn.omit(";"),t.enums.push(e)},o._parseExtensionRanges=function(){var t,e,r,n=[];do{for(e=[];;){switch(t=this.tn.next()){case"min":r=i.ID_MIN;break;case"max":r=i.ID_MAX;break;default:r=l(t)}if(e.push(r),2===e.length)break;if("to"!==this.tn.peek()){e.push(r);break}this.tn.next()}n.push(e)}while(this.tn.omit(","));return this.tn.skip(";"),n},o._parseExtend=function(t){var e=this.tn.next();if(!s.TYPEREF.test(e))throw Error("illegal extend reference: "+e);var r={ref:e,fields:[]};for(this.tn.skip("{");"}"!==(e=this.tn.next());)if(s.RULE.test(e))this._parseMessageField(r,e);else{if(!s.TYPEREF.test(e))throw Error("illegal extend token: "+e);if(!this.proto3)throw Error("illegal field rule: "+e);this._parseMessageField(r,"optional",e)}return this.tn.omit(";"),t.messages.push(r),r},o.toString=function(){return"Parser at line "+this.tn.line},t.Parser=n,t}(o,o.Lang),o.Reflect=function(g){var s={},c=function(t,e,r){this.builder=t,this.parent=e,this.name=r,this.className},t=c.prototype;t.fqn=function(){for(var t=this.name,e=this;;){if(null==(e=e.parent))break;t=e.name+"."+t}return t},t.toString=function(t){return(t?this.className+" ":"")+this.fqn()},t.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},s.T=c;var a=function(t,e,r,n,i){c.call(this,t,e,r),this.className="Namespace",this.children=[],this.options=n||{},this.syntax=i||"proto2"};try{var e=a.prototype=Object.create(c.prototype)}catch(t){e=""}e.getChildren=function(t){if(null==(t=t||null))return this.children.slice();for(var e=[],r=0,n=this.children.length;r<n;++r)this.children[r]instanceof t&&e.push(this.children[r]);return e},e.addChild=function(t){var e;if(e=this.getChild(t.name))if(e instanceof f.Field&&e.name!==e.originalName&&null===this.getChild(e.originalName))e.name=e.originalName;else{if(!(t instanceof f.Field&&t.name!==t.originalName&&null===this.getChild(t.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+t.name);t.name=t.originalName}this.children.push(t)},e.getChild=function(t){for(var e="number"==typeof t?"id":"name",r=0,n=this.children.length;r<n;++r)if(this.children[r][e]===t)return this.children[r];return null},e.resolve=function(t,e){var r,n="string"==typeof t?t.split("."):t,i=this,o=0;if(""===n[o]){for(;null!==i.parent;)i=i.parent;o++}do{do{if(!(i instanceof s.Namespace)){i=null;break}if(!(r=i.getChild(n[o]))||!(r instanceof s.T)||e&&!(r instanceof s.Namespace)){i=null;break}i=r,o++}while(o<n.length);if(null!=i)break;if(null!==this.parent)return this.parent.resolve(t,e)}while(null!=i);return i},e.qn=function(t){for(var e=[],r=t;e.unshift(r.name),null!==(r=r.parent););for(var n=1;n<=e.length;n++){var i=e.slice(e.length-n);if(t===this.resolve(i,t instanceof s.Namespace))return i.join(".")}return t.fqn()},e.build=function(){for(var t,e={},r=this.children,n=0,i=r.length;n<i;++n)(t=r[n])instanceof a&&(e[t.name]=t.build());return Object.defineProperty&&Object.defineProperty(e,"$options",{value:this.buildOpt()}),e},e.buildOpt=function(){for(var t={},e=Object.keys(this.options),r=0,n=e.length;r<n;++r){var i=e[r],o=this.options[e[r]];t[i]=o}return t},e.getOption=function(t){return void 0===t?this.options:void 0!==this.options[t]?this.options[t]:null},s.Namespace=a;var h=function(t,e,r,n){if(this.type=t,this.resolvedType=e,this.isMapKey=r,this.syntax=n,r&&g.MAP_KEY_TYPES.indexOf(t)<0)throw Error("Invalid map key type: "+t.name)},r=h.prototype;function l(t,e){if(t&&"number"==typeof t.low&&"number"==typeof t.high&&"boolean"==typeof t.unsigned&&t.low==t.low&&t.high==t.high)return new g.Long(t.low,t.high,void 0===e?t.unsigned:e);if("string"==typeof t)return g.Long.fromString(t,e||!1,10);if("number"==typeof t)return g.Long.fromNumber(t,e||!1);throw Error("not convertible to Long")}h.defaultFieldValue=function(t){if("string"==typeof t&&(t=g.TYPES[t]),void 0===t.defaultValue)throw Error("default value for type "+t.name+" is not supported");return t==g.TYPES.bytes?new T(0):t.defaultValue},r.verifyValue=function(e){var r=this;function n(t,e){throw Error("Illegal value for "+r.toString(!0)+" of type "+r.type.name+": "+t+" ("+e+")")}switch(this.type){case g.TYPES.int32:case g.TYPES.sint32:case g.TYPES.sfixed32:return("number"!=typeof e||e==e&&e%1!=0)&&n(typeof e,"not an integer"),4294967295<e?0|e:e;case g.TYPES.uint32:case g.TYPES.fixed32:return("number"!=typeof e||e==e&&e%1!=0)&&n(typeof e,"not an integer"),e<0?e>>>0:e;case g.TYPES.int64:case g.TYPES.sint64:case g.TYPES.sfixed64:if(g.Long)try{return l(e,!1)}catch(t){n(typeof e,t.message)}else n(typeof e,"requires Long.js");case g.TYPES.uint64:case g.TYPES.fixed64:if(g.Long)try{return l(e,!0)}catch(t){n(typeof e,t.message)}else n(typeof e,"requires Long.js");case g.TYPES.bool:return"boolean"!=typeof e&&n(typeof e,"not a boolean"),e;case g.TYPES.float:case g.TYPES.double:return"number"!=typeof e&&n(typeof e,"not a number"),e;case g.TYPES.string:return"string"==typeof e||e&&e instanceof String||n(typeof e,"not a string"),""+e;case g.TYPES.bytes:return T.isByteBuffer(e)?e:T.wrap(e,"base64");case g.TYPES.enum:var t=this.resolvedType.getChildren(g.Reflect.Enum.Value);for(o=0;o<t.length;o++){if(t[o].name==e)return t[o].id;if(t[o].id==e)return t[o].id}if("proto3"===this.syntax)return("number"!=typeof e||e==e&&e%1!=0)&&n(typeof e,"not an integer"),(4294967295<e||e<0)&&n(typeof e,"not in range for uint32"),e;n(e,"not a valid enum value");case g.TYPES.group:case g.TYPES.message:if(e&&"object"==typeof e||n(typeof e,"object expected"),e instanceof this.resolvedType.clazz)return e;if(e instanceof g.Builder.Message){var i={};for(var o in e)e.hasOwnProperty(o)&&(i[o]=e[o]);e=i}return new this.resolvedType.clazz(e)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+e+" (undefined type "+this.type+")")},r.calculateLength=function(t,e){if(null===e)return 0;var r;switch(this.type){case g.TYPES.int32:return e<0?T.calculateVarint64(e):T.calculateVarint32(e);case g.TYPES.uint32:return T.calculateVarint32(e);case g.TYPES.sint32:return T.calculateVarint32(T.zigZagEncode32(e));case g.TYPES.fixed32:case g.TYPES.sfixed32:case g.TYPES.float:return 4;case g.TYPES.int64:case g.TYPES.uint64:return T.calculateVarint64(e);case g.TYPES.sint64:return T.calculateVarint64(T.zigZagEncode64(e));case g.TYPES.fixed64:case g.TYPES.sfixed64:return 8;case g.TYPES.bool:return 1;case g.TYPES.enum:return T.calculateVarint32(e);case g.TYPES.double:return 8;case g.TYPES.string:return r=T.calculateUTF8Bytes(e),T.calculateVarint32(r)+r;case g.TYPES.bytes:if(e.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+e.remaining()+" bytes remaining");return T.calculateVarint32(e.remaining())+e.remaining();case g.TYPES.message:return r=this.resolvedType.calculate(e),T.calculateVarint32(r)+r;case g.TYPES.group:return(r=this.resolvedType.calculate(e))+T.calculateVarint32(t<<3|g.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+e+" (unknown type)")},r.encodeValue=function(t,e,r){if(null===e)return r;switch(this.type){case g.TYPES.int32:e<0?r.writeVarint64(e):r.writeVarint32(e);break;case g.TYPES.uint32:r.writeVarint32(e);break;case g.TYPES.sint32:r.writeVarint32ZigZag(e);break;case g.TYPES.fixed32:r.writeUint32(e);break;case g.TYPES.sfixed32:r.writeInt32(e);break;case g.TYPES.int64:case g.TYPES.uint64:r.writeVarint64(e);break;case g.TYPES.sint64:r.writeVarint64ZigZag(e);break;case g.TYPES.fixed64:r.writeUint64(e);break;case g.TYPES.sfixed64:r.writeInt64(e);break;case g.TYPES.bool:"string"==typeof e?r.writeVarint32("false"===e.toLowerCase()?0:!!e):r.writeVarint32(e?1:0);break;case g.TYPES.enum:r.writeVarint32(e);break;case g.TYPES.float:r.writeFloat32(e);break;case g.TYPES.double:r.writeFloat64(e);break;case g.TYPES.string:r.writeVString(e);break;case g.TYPES.bytes:if(e.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+e.remaining()+" bytes remaining");var n=e.offset;r.writeVarint32(e.remaining()),r.append(e),e.offset=n;break;case g.TYPES.message:var i=(new T).LE();this.resolvedType.encode(e,i),r.writeVarint32(i.offset),r.append(i.flip());break;case g.TYPES.group:this.resolvedType.encode(e,r),r.writeVarint32(t<<3|g.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+e+" (unknown type)")}return r},r.decode=function(t,e,r){if(e!=this.type.wireType)throw Error("Unexpected wire type for element");var n,i;switch(this.type){case g.TYPES.int32:return 0|t.readVarint32();case g.TYPES.uint32:return t.readVarint32()>>>0;case g.TYPES.sint32:return 0|t.readVarint32ZigZag();case g.TYPES.fixed32:return t.readUint32()>>>0;case g.TYPES.sfixed32:return 0|t.readInt32();case g.TYPES.int64:return t.readVarint64();case g.TYPES.uint64:return t.readVarint64().toUnsigned();case g.TYPES.sint64:return t.readVarint64ZigZag();case g.TYPES.fixed64:return t.readUint64();case g.TYPES.sfixed64:return t.readInt64();case g.TYPES.bool:return!!t.readVarint32();case g.TYPES.enum:return t.readVarint32();case g.TYPES.float:return t.readFloat();case g.TYPES.double:return t.readDouble();case g.TYPES.string:return t.readVString();case g.TYPES.bytes:if(i=t.readVarint32(),t.remaining()<i)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+i+" required but got only "+t.remaining());return(n=t.clone()).limit=n.offset+i,t.offset+=i,n;case g.TYPES.message:return i=t.readVarint32(),this.resolvedType.decode(t,i);case g.TYPES.group:return this.resolvedType.decode(t,-1,r)}throw Error("[INTERNAL] Illegal decode type")},r.valueFromString=function(t){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case g.TYPES.int32:case g.TYPES.sint32:case g.TYPES.sfixed32:case g.TYPES.uint32:case g.TYPES.fixed32:return this.verifyValue(parseInt(t));case g.TYPES.int64:case g.TYPES.sint64:case g.TYPES.sfixed64:case g.TYPES.uint64:case g.TYPES.fixed64:return this.verifyValue(t);case g.TYPES.bool:return"true"===t;case g.TYPES.string:return this.verifyValue(t);case g.TYPES.bytes:return T.fromBinary(t)}},r.valueToString=function(t){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===g.TYPES.bytes?t.toString("binary"):t.toString()},s.Element=h;var f=function(t,e,r,n,i,o){a.call(this,t,e,r,n,o),this.className="Message",this.extensions=void 0,this.clazz=null,this.isGroup=!!i,this._fields=null,this._fieldsById=null,this._fieldsByName=null};try{var n=f.prototype=Object.create(a.prototype)}catch(t){n=""}function m(t,e){var r=e.readVarint32(),n=7&r,i=r>>>3;switch(n){case g.WIRE_TYPES.VARINT:for(;128==(128&(r=e.readUint8())););break;case g.WIRE_TYPES.BITS64:e.offset+=8;break;case g.WIRE_TYPES.LDELIM:r=e.readVarint32(),e.offset+=r;break;case g.WIRE_TYPES.STARTGROUP:m(i,e);break;case g.WIRE_TYPES.ENDGROUP:if(i===t)return!1;throw Error("Illegal GROUPEND after unknown group: "+i+" ("+t+" expected)");case g.WIRE_TYPES.BITS32:e.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+t+": "+n)}return!0}n.build=function(t){if(this.clazz&&!t)return this.clazz;var e=function(h,s){var a=s.getChildren(h.Reflect.Message.Field),l=s.getChildren(h.Reflect.Message.OneOf),u=function(t,e){h.Builder.Message.call(this);for(var r=0,n=l.length;r<n;++r)this[l[r].name]=null;for(r=0,n=a.length;r<n;++r){var i=a[r];this[i.name]=i.repeated?[]:i.map?new h.Map(i):null,!i.required&&"proto3"!==s.syntax||null===i.defaultValue||(this[i.name]=i.defaultValue)}var o;if(0<arguments.length)if(1!==arguments.length||null===t||"object"!=typeof t||!("function"!=typeof t.encode||t instanceof u)||Array.isArray(t)||t instanceof h.Map||T.isByteBuffer(t)||t instanceof ArrayBuffer||h.Long&&t instanceof h.Long)for(r=0,n=arguments.length;r<n;++r)void 0!==(o=arguments[r])&&this.$set(a[r].name,o);else this.$set(t)};try{var o=u.prototype=Object.create(h.Builder.Message.prototype)}catch(t){o=""}o.add=function(t,e,r){var n=s._fieldsByName[t];if(!r){if(!n)throw Error(this+"#"+t+" is undefined");if(!(n instanceof h.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: "+n.toString(!0));if(!n.repeated)throw Error(this+"#"+t+" is not a repeated field");e=n.verifyValue(e,!0)}return null===this[t]&&(this[t]=[]),this[t].push(e),this},o.$add=o.add,o.set=function(t,e,r){if(t&&"object"==typeof t){for(var n in r=e,t)t.hasOwnProperty(n)&&void 0!==(e=t[n])&&this.$set(n,e,r);return this}var i=s._fieldsByName[t];if(r)this[t]=e;else{if(!i)throw Error(this+"#"+t+" is not a field: undefined");if(!(i instanceof h.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: "+i.toString(!0));this[i.name]=e=i.verifyValue(e)}if(i&&i.oneof){var o=this[i.oneof.name];null!==e?(null!==o&&o!==i.name&&(this[o]=null),this[i.oneof.name]=i.name):o===t&&(this[i.oneof.name]=null)}return this},o.$set=o.set,o.get=function(t,e){if(e)return this[t];var r=s._fieldsByName[t];if(!(r&&r instanceof h.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: undefined");if(!(r instanceof h.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: "+r.toString(!0));return this[r.name]},o.$get=o.get;for(var t=0;t<a.length;t++){var e=a[t];e instanceof h.Reflect.Message.ExtensionField||s.builder.options.populateAccessors&&function(r){var t=r.originalName.replace(/(_[a-zA-Z])/g,function(t){return t.toUpperCase().replace("_","")});t=t.substring(0,1).toUpperCase()+t.substring(1);var e=r.originalName.replace(/([A-Z])/g,function(t){return"_"+t}),n=function(t,e){return this[r.name]=e?t:r.verifyValue(t),this},i=function(){return this[r.name]};null===s.getChild("set"+t)&&(o["set"+t]=n),null===s.getChild("set_"+e)&&(o["set_"+e]=n),null===s.getChild("get"+t)&&(o["get"+t]=i),null===s.getChild("get_"+e)&&(o["get_"+e]=i)}(e)}function f(t,r,n,i){if(null===t||"object"!=typeof t){if(i&&i instanceof h.Reflect.Enum){var e=h.Reflect.Enum.getName(i.object,t);if(null!==e)return e}return t}if(T.isByteBuffer(t))return r?t.toBase64():t.toBuffer();if(h.Long.isLong(t))return n?t.toString():h.Long.fromValue(t);var o;if(Array.isArray(t))return o=[],t.forEach(function(t,e){o[e]=f(t,r,n,i)}),o;if(o={},t instanceof h.Map){for(var s=t.entries(),a=s.next();!a.done;a=s.next())o[t.keyElem.valueToString(a.value[0])]=f(a.value[1],r,n,t.valueElem.resolvedType);return o}var l=t.$type,u=void 0;for(var c in t)t.hasOwnProperty(c)&&(l&&(u=l.getChild(c))?o[c]=f(t[c],r,n,u.resolvedType):o[c]=f(t[c],r,n));return o}return o.encode=function(e,t){"boolean"==typeof e&&(t=e,e=void 0);var r=!1;e||(e=new T,r=!0);var n=e.littleEndian;try{return s.encode(this,e.LE(),t),(r?e.flip():e).LE(n)}catch(t){throw e.LE(n),t}},u.encode=function(t,e,r){return new u(t).encode(e,r)},o.calculate=function(){return s.calculate(this)},o.encodeDelimited=function(t,e){var r=!1;t||(t=new T,r=!0);var n=(new T).LE();return s.encode(this,n,e).flip(),t.writeVarint32(n.remaining()),t.append(n),r?t.flip():t},o.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(t){throw t.encoded&&(t.encoded=t.encoded.toArrayBuffer()),t}},o.toArrayBuffer=o.encodeAB,o.encodeNB=function(){try{return this.encode().toBuffer()}catch(t){throw t.encoded&&(t.encoded=t.encoded.toBuffer()),t}},o.toBuffer=o.encodeNB,o.encode64=function(){try{return this.encode().toBase64()}catch(t){throw t.encoded&&(t.encoded=t.encoded.toBase64()),t}},o.toBase64=o.encode64,o.encodeHex=function(){try{return this.encode().toHex()}catch(t){throw t.encoded&&(t.encoded=t.encoded.toHex()),t}},o.toHex=o.encodeHex,o.toRaw=function(t,e){return f(this,!!t,!!e,this.$type)},o.encodeJSON=function(){return JSON.stringify(f(this,!0,!0,this.$type))},u.decode=function(e,t,r){"string"==typeof t&&(r=t,t=-1),"string"==typeof e&&(e=T.wrap(e,r||"base64"));var n=(e=T.isByteBuffer(e)?e:T.wrap(e)).littleEndian;try{var i=s.decode(e.LE());return e.LE(n),i}catch(t){throw e.LE(n),t}},u.decodeDelimited=function(e,t){if("string"==typeof e&&(e=T.wrap(e,t||"base64")),(e=T.isByteBuffer(e)?e:T.wrap(e)).remaining()<1)return null;var r=e.offset,n=e.readVarint32();if(e.remaining()<n)return e.offset=r,null;try{var i=s.decode(e.slice(e.offset,e.offset+n).LE());return e.offset+=n,i}catch(t){throw e.offset+=n,t}},u.decode64=function(t){return u.decode(t,"base64")},u.decodeHex=function(t){return u.decode(t,"hex")},u.decodeJSON=function(t){return new u(JSON.parse(t))},o.toString=function(){return s.toString()},Object.defineProperty&&(Object.defineProperty(u,"$options",{value:s.buildOpt()}),Object.defineProperty(o,"$options",{value:u.$options}),Object.defineProperty(u,"$type",{value:s}),Object.defineProperty(o,"$type",{value:s})),u}(g,this);this._fields=[],this._fieldsById={},this._fieldsByName={};for(var r,n=0,i=this.children.length;n<i;n++)if((r=this.children[n])instanceof p||r instanceof f||r instanceof b){if(e.hasOwnProperty(r.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+r.toString(!0)+" cannot override static property '"+r.name+"'");e[r.name]=r.build()}else if(r instanceof f.Field)r.build(),this._fields.push(r),this._fieldsById[r.id]=r,this._fieldsByName[r.name]=r;else if(!(r instanceof f.OneOf||r instanceof y))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[n].toString(!0));return this.clazz=e},n.encode=function(t,e,r){for(var n,i,o=null,s=0,a=this._fields.length;s<a;++s)i=t[(n=this._fields[s]).name],n.required&&null===i?null===o&&(o=n):n.encode(r?i:n.verifyValue(i),e,t);if(null===o)return e;var l=Error("Missing at least one required field for "+this.toString(!0)+": "+o);throw l.encoded=e,l},n.calculate=function(t){for(var e,r,n=0,i=0,o=this._fields.length;i<o;++i){if(r=t[(e=this._fields[i]).name],e.required&&null===r)throw Error("Missing at least one required field for "+this.toString(!0)+": "+e);n+=e.calculate(r,t)}return n},n.decode=function(t,e,r){e="number"==typeof e?e:-1;for(var n,i,o,s,a=t.offset,l=new this.clazz;t.offset<a+e||-1===e&&0<t.remaining();){if(o=(n=t.readVarint32())>>>3,(i=7&n)===g.WIRE_TYPES.ENDGROUP){if(o!==r)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+o+" ("+(r?r+" expected":"not a group")+")");break}if(s=this._fieldsById[o]){if(s.repeated&&!s.options.packed)l[s.name].push(s.decode(i,t));else if(s.map){var u=s.decode(i,t);l[s.name].set(u[0],u[1])}else if(l[s.name]=s.decode(i,t),s.oneof){var c=l[s.oneof.name];null!==c&&c!==s.name&&(l[c]=null),l[s.oneof.name]=s.name}}else switch(i){case g.WIRE_TYPES.VARINT:t.readVarint32();break;case g.WIRE_TYPES.BITS32:t.offset+=4;break;case g.WIRE_TYPES.BITS64:t.offset+=8;break;case g.WIRE_TYPES.LDELIM:var h=t.readVarint32();t.offset+=h;break;case g.WIRE_TYPES.STARTGROUP:for(;m(o,t););break;default:throw Error("Illegal wire type for unknown field "+o+" in "+this.toString(!0)+"#decode: "+i)}}for(var f=0,p=this._fields.length;f<p;++f)if(null===l[(s=this._fields[f]).name])if("proto3"===this.syntax)l[s.name]=s.defaultValue;else{if(s.required){var d=Error("Missing at least one required field for "+this.toString(!0)+": "+s.name);throw d.decoded=l,d}g.populateDefaults&&null!==s.defaultValue&&(l[s.name]=s.defaultValue)}return l},s.Message=f;var u=function(t,e,r,n,i,o,s,a,l,u){c.call(this,t,e,o),this.className="Message.Field",this.required="required"===r,this.repeated="repeated"===r,this.map="map"===r,this.keyType=n||null,this.type=i,this.resolvedType=null,this.id=s,this.options=a||{},this.defaultValue=null,this.oneof=l||null,this.syntax=u||"proto2",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof f.ExtensionField||(this.name=g.Util.toCamelCase(this.name))};try{var i=u.prototype=Object.create(c.prototype)}catch(t){i=""}i.build=function(){this.element=new h(this.type,this.resolvedType,!1,this.syntax),this.map&&(this.keyElement=new h(this.keyType,void 0,!0,this.syntax)),"proto3"!==this.syntax||this.repeated||this.map?void 0!==this.options.default&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=h.defaultFieldValue(this.type)},i.verifyValue=function(t,e){e=e||!1;var r,n=this;function i(t,e){throw Error("Illegal value for "+n.toString(!0)+" of type "+n.type.name+": "+t+" ("+e+")")}if(null===t)return this.required&&i(typeof t,"required"),"proto3"===this.syntax&&this.type!==g.TYPES.message&&i(typeof t,"proto3 field without field presence cannot be null"),null;if(!this.repeated||e)return this.map&&!e?t instanceof g.Map?t:(t instanceof Object||i(typeof t,"expected ProtoBuf.Map or raw object for map field"),new g.Map(this,t)):(!this.repeated&&Array.isArray(t)&&i(typeof t,"no array expected"),this.element.verifyValue(t));Array.isArray(t)||(t=[t]);var o=[];for(r=0;r<t.length;r++)o.push(this.element.verifyValue(t[r]));return o},i.hasWirePresence=function(t,e){if("proto3"!==this.syntax)return null!==t;if(this.oneof&&e[this.oneof.name]===this.name)return!0;switch(this.type){case g.TYPES.int32:case g.TYPES.sint32:case g.TYPES.sfixed32:case g.TYPES.uint32:case g.TYPES.fixed32:return 0!==t;case g.TYPES.int64:case g.TYPES.sint64:case g.TYPES.sfixed64:case g.TYPES.uint64:case g.TYPES.fixed64:return 0!==t.low||0!==t.high;case g.TYPES.bool:return t;case g.TYPES.float:case g.TYPES.double:return 0!==t;case g.TYPES.string:return 0<t.length;case g.TYPES.bytes:return 0<t.remaining();case g.TYPES.enum:return 0!==t;case g.TYPES.message:return null!==t;default:return!0}},i.encode=function(e,i,t){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===e||this.repeated&&0==e.length)return i;try{var r;if(this.repeated)if(this.options.packed&&0<=g.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){i.writeVarint32(this.id<<3|g.WIRE_TYPES.LDELIM),i.ensureCapacity(i.offset+=1);var n=i.offset;for(r=0;r<e.length;r++)this.element.encodeValue(this.id,e[r],i);var o=i.offset-n,s=T.calculateVarint32(o);if(1<s){var a=i.slice(n,i.offset);n+=s-1,i.offset=n,i.append(a)}i.writeVarint32(o,n-s)}else for(r=0;r<e.length;r++)i.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,e[r],i);else this.map?e.forEach(function(t,e,r){var n=T.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,e)+T.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,t);i.writeVarint32(this.id<<3|g.WIRE_TYPES.LDELIM),i.writeVarint32(n),i.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,e,i),i.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,t,i)},this):this.hasWirePresence(e,t)&&(i.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,e,i))}catch(t){throw Error("Illegal value for "+this.toString(!0)+": "+e+" ("+t+")")}return i},i.calculate=function(e,t){if(e=this.verifyValue(e),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===e||this.repeated&&0==e.length)return 0;var i=0;try{var r,n;if(this.repeated)if(this.options.packed&&0<=g.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){for(i+=T.calculateVarint32(this.id<<3|g.WIRE_TYPES.LDELIM),r=n=0;r<e.length;r++)n+=this.element.calculateLength(this.id,e[r]);i+=T.calculateVarint32(n),i+=n}else for(r=0;r<e.length;r++)i+=T.calculateVarint32(this.id<<3|this.type.wireType),i+=this.element.calculateLength(this.id,e[r]);else this.map?e.forEach(function(t,e,r){var n=T.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,e)+T.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,t);i+=T.calculateVarint32(this.id<<3|g.WIRE_TYPES.LDELIM),i+=T.calculateVarint32(n),i+=n},this):this.hasWirePresence(e,t)&&(i+=T.calculateVarint32(this.id<<3|this.type.wireType),i+=this.element.calculateLength(this.id,e))}catch(t){throw Error("Illegal value for "+this.toString(!0)+": "+e+" ("+t+")")}return i},i.decode=function(t,e,r){var n,i;if(!(!this.map&&t==this.type.wireType||!r&&this.repeated&&this.options.packed&&t==g.WIRE_TYPES.LDELIM||this.map&&t==g.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+t+" ("+this.type.wireType+" expected)");if(t==g.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&0<=g.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)&&!r){i=e.readVarint32(),i=e.offset+i;for(var o=[];e.offset<i;)o.push(this.decode(this.type.wireType,e,!0));return o}if(this.map){var s=h.defaultFieldValue(this.keyType);if(n=h.defaultFieldValue(this.type),i=e.readVarint32(),e.remaining()<i)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+i+" required but got only "+e.remaining());var a=e.clone();for(a.limit=a.offset+i,e.offset+=i;0<a.remaining();){var l=a.readVarint32();t=7&l;var u=l>>>3;if(1===u)s=this.keyElement.decode(a,t,u);else{if(2!==u)throw Error("Unexpected tag in map field key/value submessage");n=this.element.decode(a,t,u)}}return[s,n]}return this.element.decode(e,t,this.id)},s.Message.Field=u;var o=function(t,e,r,n,i,o,s){u.call(this,t,e,r,null,n,i,o,s),this.extension};try{o.prototype=Object.create(u.prototype)}catch(t){o.prototype=null}s.Message.ExtensionField=o;s.Message.OneOf=function(t,e,r){c.call(this,t,e,r),this.fields=[]};var p=function(t,e,r,n,i){a.call(this,t,e,r,n,i),this.className="Enum",this.object=null};p.getName=function(t,e){for(var r,n=Object.keys(t),i=0;i<n.length;++i)if(t[r=n[i]]===e)return r;return null};try{var d=p.prototype=Object.create(a.prototype)}catch(t){d=p.prototype=null}d&&(d.build=function(t){if(this.object&&!t)return this.object;for(var e=new g.Builder.Enum,r=this.getChildren(p.Value),n=0,i=r.length;n<i;++n)e[r[n].name]=r[n].id;return Object.defineProperty&&Object.defineProperty(e,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=e}),s.Enum=p;var v=function(t,e,r,n){c.call(this,t,e,r),this.className="Enum.Value",this.id=n};try{v.prototype=Object.create(c.prototype)}catch(t){v.prototype=null}s.Enum.Value=v;var y=function(t,e,r,n){c.call(this,t,e,r),this.field=n};try{y.prototype=Object.create(c.prototype)}catch(t){y.prototype=null}s.Extension=y;var b=function(t,e,r,n){a.call(this,t,e,r,n),this.className="Service",this.clazz=null};try{var w=b.prototype=Object.create(a.prototype)}catch(t){w=null}w&&(w.build=function(t){return this.clazz&&!t?this.clazz:this.clazz=function(e,i){for(var o=function(t){e.Builder.Service.call(this),this.rpcImpl=t||function(t,e,r){setTimeout(r.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},t=o.prototype=Object.create(e.Builder.Service.prototype),r=i.getChildren(e.Reflect.Service.RPCMethod),n=0;n<r.length;n++)!function(n){t[n.name]=function(t,r){try{try{t=n.resolvedRequestType.clazz.decode(T.wrap(t))}catch(t){if(!(t instanceof TypeError))throw t}if(null===t||"object"!=typeof t)throw Error("Illegal arguments");t instanceof n.resolvedRequestType.clazz||(t=new n.resolvedRequestType.clazz(t)),this.rpcImpl(n.fqn(),t,function(t,e){if(t)r(t);else{null===e&&(e="");try{e=n.resolvedResponseType.clazz.decode(e)}catch(t){}e&&e instanceof n.resolvedResponseType.clazz?r(null,e):r(Error("Illegal response type received in service method "+i.name+"#"+n.name))}})}catch(t){setTimeout(r.bind(this,t),0)}},o[n.name]=function(t,e,r){new o(t)[n.name](e,r)},Object.defineProperty&&(Object.defineProperty(o[n.name],"$options",{value:n.buildOpt()}),Object.defineProperty(t[n.name],"$options",{value:o[n.name].$options}))}(r[n]);return Object.defineProperty&&(Object.defineProperty(o,"$options",{value:i.buildOpt()}),Object.defineProperty(t,"$options",{value:o.$options}),Object.defineProperty(o,"$type",{value:i}),Object.defineProperty(t,"$type",{value:i})),o}(g,this)}),s.Service=b;var E=function(t,e,r,n){c.call(this,t,e,r),this.className="Service.Method",this.options=n||{}};try{var _=E.prototype=Object.create(c.prototype)}catch(t){_=null}_&&(_.buildOpt=e.buildOpt),s.Service.Method=E;var S=function(t,e,r,n,i,o,s,a){E.call(this,t,e,r,a),this.className="Service.RPCMethod",this.requestName=n,this.responseName=i,this.requestStream=o,this.responseStream=s,this.resolvedRequestType=null,this.resolvedResponseType=null};try{S.prototype=Object.create(E.prototype)}catch(t){S.prototype=null}return s.Service.RPCMethod=S,s}(o),o.Builder=(e=(h=o).Lang,s=o.Reflect,r=(a=function(t){this.ns=new s.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=t||{}}).prototype,a.isMessage=function(t){return"string"==typeof t.name&&void 0===t.values&&void 0===t.rpc},a.isMessageField=function(t){return"string"==typeof t.rule&&"string"==typeof t.name&&"string"==typeof t.type&&void 0!==t.id},a.isEnum=function(t){return"string"==typeof t.name&&!(void 0===t.values||!Array.isArray(t.values)||0===t.values.length)},a.isService=function(t){return!("string"!=typeof t.name||"object"!=typeof t.rpc||!t.rpc)},a.isExtend=function(t){return"string"==typeof t.ref},r.reset=function(){return this.ptr=this.ns,this},r.define=function(t){if("string"!=typeof t||!e.TYPEREF.test(t))throw Error("illegal namespace: "+t);return t.split(".").forEach(function(t){var e=this.ptr.getChild(t);null===e&&this.ptr.addChild(e=new s.Namespace(this,this.ptr,t)),this.ptr=e},this),this},r.create=function(t){if(!t)return this;if(Array.isArray(t)){if(0===t.length)return this;t=t.slice()}else t=[t];for(var e=[t];0<e.length;){if(t=e.pop(),!Array.isArray(t))throw Error("not a valid namespace: "+JSON.stringify(t));for(;0<t.length;){var r=t.shift();if(a.isMessage(r)){var o=new s.Message(this,this.ptr,r.name,r.options,r.isGroup,r.syntax),n={};r.oneofs&&Object.keys(r.oneofs).forEach(function(t){o.addChild(n[t]=new s.Message.OneOf(this,o,t))},this),r.fields&&r.fields.forEach(function(t){if(null!==o.getChild(0|t.id))throw Error("duplicate or invalid field id in "+o.name+": "+t.id);if(t.options&&"object"!=typeof t.options)throw Error("illegal field options in "+o.name+"#"+t.name);var e=null;if("string"==typeof t.oneof&&!(e=n[t.oneof]))throw Error("illegal oneof in "+o.name+"#"+t.name+": "+t.oneof);t=new s.Message.Field(this,o,t.rule,t.keytype,t.type,t.name,t.id,t.options,e,r.syntax),e&&e.fields.push(t),o.addChild(t)},this);var i=[];if(r.enums&&r.enums.forEach(function(t){i.push(t)}),r.messages&&r.messages.forEach(function(t){i.push(t)}),r.services&&r.services.forEach(function(t){i.push(t)}),r.extensions&&("number"==typeof r.extensions[0]?o.extensions=[r.extensions]:o.extensions=r.extensions),this.ptr.addChild(o),0<i.length){e.push(t),t=i,i=null,this.ptr=o,o=null;continue}i=null}else if(a.isEnum(r))o=new s.Enum(this,this.ptr,r.name,r.options,r.syntax),r.values.forEach(function(t){o.addChild(new s.Enum.Value(this,o,t.name,t.id))},this),this.ptr.addChild(o);else if(a.isService(r))o=new s.Service(this,this.ptr,r.name,r.options),Object.keys(r.rpc).forEach(function(t){var e=r.rpc[t];o.addChild(new s.Service.RPCMethod(this,o,t,e.request,e.response,!!e.request_stream,!!e.response_stream,e.options))},this),this.ptr.addChild(o);else{if(!a.isExtend(r))throw Error("not a valid definition: "+JSON.stringify(r));if(o=this.ptr.resolve(r.ref,!0))r.fields.forEach(function(e){if(null!==o.getChild(0|e.id))throw Error("duplicate extended field id in "+o.name+": "+e.id);if(o.extensions){var r=!1;if(o.extensions.forEach(function(t){e.id>=t[0]&&e.id<=t[1]&&(r=!0)}),!r)throw Error("illegal extended field id in "+o.name+": "+e.id+" (not within valid ranges)")}var t=e.name;this.options.convertFieldsToCamelCase&&(t=h.Util.toCamelCase(t));var n=new s.Message.ExtensionField(this,o,e.rule,e.type,this.ptr.fqn()+"."+t,e.id,e.options),i=new s.Extension(this,this.ptr,e.name,n);n.extension=i,this.ptr.addChild(i),o.addChild(n)},this);else if(!/\.?google\.protobuf\./.test(r.ref))throw Error("extended message "+r.ref+" is not defined")}o=r=null}t=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},r.import=function(e,t){var r="/";if("string"==typeof t){if(h.Util.IS_NODE&&(t=require("path").resolve(t)),!0===this.files[t])return this.reset();this.files[t]=!0}else if("object"==typeof t){var n=t.root;h.Util.IS_NODE&&(n=require("path").resolve(n)),(0<=n.indexOf("\\")||0<=t.file.indexOf("\\"))&&(r="\\");var i=n+r+t.file;if(!0===this.files[i])return this.reset();this.files[i]=!0}if(e.imports&&0<e.imports.length){var o,s=!1;"object"==typeof t?(this.importRoot=t.root,s=!0,o=this.importRoot,t=t.file,(0<=o.indexOf("\\")||0<=t.indexOf("\\"))&&(r="\\")):"string"==typeof t?this.importRoot?o=this.importRoot:0<=t.indexOf("/")?""===(o=t.replace(/\/[^\/]*$/,""))&&(o="/"):0<=t.indexOf("\\")?(o=t.replace(/\\[^\\]*$/,""),r="\\"):o=".":o=null;for(var a=0;a<e.imports.length;a++)if("string"==typeof e.imports[a]){if(!o)throw Error("cannot determine import root");var l=e.imports[a];if("google/protobuf/descriptor.proto"===l)continue;if(l=o+r+l,!0===this.files[l])continue;/\.proto$/i.test(l)&&!h.DotProto&&(l=l.replace(/\.proto$/,".json"));var u=h.Util.fetch(l);if(null===u)throw Error("failed to import '"+l+"' in '"+t+"': file not found");/\.json$/i.test(l)?this.import(JSON.parse(u+""),l):this.import(h.DotProto.Parser.parse(u),l)}else t?/\.(\w+)$/.test(t)?this.import(e.imports[a],t.replace(/^(.+)\.(\w+)$/,function(t,e,r){return e+"_import"+a+"."+r})):this.import(e.imports[a],t+"_import"+a):this.import(e.imports[a]);s&&(this.importRoot=null)}e.package&&this.define(e.package),e.syntax&&function e(r){r.messages&&r.messages.forEach(function(t){t.syntax=r.syntax,e(t)}),r.enums&&r.enums.forEach(function(t){t.syntax=r.syntax})}(e);var c=this.ptr;return e.options&&Object.keys(e.options).forEach(function(t){c.options[t]=e.options[t]}),e.messages&&(this.create(e.messages),this.ptr=c),e.enums&&(this.create(e.enums),this.ptr=c),e.services&&(this.create(e.services),this.ptr=c),e.extends&&this.create(e.extends),this.reset()},r.resolveAll=function(){var t;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof s.Namespace)this.ptr.children.forEach(function(t){this.ptr=t,this.resolveAll()},this);else if(this.ptr instanceof s.Message.Field){if(e.TYPE.test(this.ptr.type))this.ptr.type=h.TYPES[this.ptr.type];else{if(!e.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(!(t=(this.ptr instanceof s.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0)))throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if((this.ptr.resolvedType=t)instanceof s.Enum){if(this.ptr.type=h.TYPES.enum,"proto3"===this.ptr.syntax&&"proto3"!==t.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(t instanceof s.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=t.isGroup?h.TYPES.group:h.TYPES.message}}if(this.ptr.map){if(!e.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=h.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof h.Reflect.Service.Method){if(!(this.ptr instanceof h.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(!((t=this.ptr.parent.resolve(this.ptr.requestName,!0))&&t instanceof h.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=t,!((t=this.ptr.parent.resolve(this.ptr.responseName,!0))&&t instanceof h.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=t}else if(!(this.ptr instanceof h.Reflect.Message.OneOf||this.ptr instanceof h.Reflect.Extension||this.ptr instanceof h.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},r.build=function(t){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!t)return this.result;for(var e="string"==typeof t?t.split("."):t,r=this.result,n=0;n<e.length;n++){if(!r[e[n]]){r=null;break}r=r[e[n]]}return r},r.lookup=function(t,e){return t?this.ns.resolve(t,e):this.ns},r.toString=function(){return"Builder"},a.Message=function(){},a.Enum=function(){},a.Service=function(){},a),o.Map=function(t,s){var e=function(t,e){if(!t.map)throw Error("field is not a map");if(this.field=t,this.keyElem=new s.Element(t.keyType,null,!0,t.syntax),this.valueElem=new s.Element(t.type,t.resolvedType,!1,t.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),e)for(var r=Object.keys(e),n=0;n<r.length;n++){var i=this.keyElem.valueFromString(r[n]),o=this.valueElem.verifyValue(e[r[n]]);this.map[this.keyElem.valueToString(i)]={key:i,value:o}}},r=e.prototype;function i(t){var e=0;return{next:function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}}return r.clear=function(){this.map={}},r.delete=function(t){var e=this.keyElem.valueToString(this.keyElem.verifyValue(t)),r=e in this.map;return delete this.map[e],r},r.entries=function(){for(var t,e=[],r=Object.keys(this.map),n=0;n<r.length;n++)e.push([(t=this.map[r[n]]).key,t.value]);return i(e)},r.keys=function(){for(var t=[],e=Object.keys(this.map),r=0;r<e.length;r++)t.push(this.map[e[r]].key);return i(t)},r.values=function(){for(var t=[],e=Object.keys(this.map),r=0;r<e.length;r++)t.push(this.map[e[r]].value);return i(t)},r.forEach=function(t,e){for(var r,n=Object.keys(this.map),i=0;i<n.length;i++)t.call(e,(r=this.map[n[i]]).value,r.key,this)},r.set=function(t,e){var r=this.keyElem.verifyValue(t),n=this.valueElem.verifyValue(e);return this.map[this.keyElem.valueToString(r)]={key:r,value:n},this},r.get=function(t){var e=this.keyElem.valueToString(this.keyElem.verifyValue(t));if(e in this.map)return this.map[e].value},r.has=function(t){return this.keyElem.valueToString(this.keyElem.verifyValue(t))in this.map},e}(0,o.Reflect),o.loadProto=function(t,e,r){return("string"==typeof e||e&&"string"==typeof e.file&&"string"==typeof e.root)&&(r=e,e=void 0),o.loadJson(o.DotProto.Parser.parse(t),e,r)},o.protoFromString=o.loadProto,o.loadProtoFile=function(e,r,n){if(r&&"object"==typeof r?(n=r,r=null):r&&"function"==typeof r||(r=null),r)return o.Util.fetch("string"==typeof e?e:e.root+"/"+e.file,function(t){if(null!==t)try{r(null,o.loadProto(t,n,e))}catch(t){r(t)}else r(Error("Failed to fetch file"))});var t=o.Util.fetch("object"==typeof e?e.root+"/"+e.file:e);return null===t?null:o.loadProto(t,n,e)},o.protoFromFile=o.loadProtoFile,o.newBuilder=function(t){return void 0===(t=t||{}).convertFieldsToCamelCase&&(t.convertFieldsToCamelCase=o.convertFieldsToCamelCase),void 0===t.populateAccessors&&(t.populateAccessors=o.populateAccessors),new o.Builder(t)},o.loadJson=function(t,e,r){return("string"==typeof e||e&&"string"==typeof e.file&&"string"==typeof e.root)&&(r=e,e=null),e&&"object"==typeof e||(e=o.newBuilder()),"string"==typeof t&&(t=JSON.parse(t)),e.import(t,r),e.resolveAll(),e},o.loadJsonFile=function(e,r,n){if(r&&"object"==typeof r?(n=r,r=null):r&&"function"==typeof r||(r=null),r)return o.Util.fetch("string"==typeof e?e:e.root+"/"+e.file,function(t){if(null!==t)try{r(null,o.loadJson(JSON.parse(t),n,e))}catch(t){r(t)}else r(Error("Failed to fetch file"))});var t=o.Util.fetch("object"==typeof e?e.root+"/"+e.file:e);return null===t?null:o.loadJson(JSON.parse(t),n,e)},o}),function(t,C){t(function(){function g(t,e,r,n){return a(t).then(e,r,n)}function s(t,e){this.then=t,this.inspect=e}function a(e){return h(function(t){t(e)})}function h(t){function e(t){l&&(a=i(t),n(l,a),l=I)}function r(t){e(u(t))}var a,l=[];try{t(e,r,function(t){l&&n(l,function n(i){var o=new s(function(t,e,r){try{return"function"==typeof r?n(r(i)):o}catch(t){return n(t)}});return o}(t))})}catch(t){r(t)}return new s(function(i,o,s){return h(function(e,r,n){l?l.push(function(t){t.then(i,o,s).then(e,r,n)}):p(function(){a.then(i,o,s).then(e,r,n)})})},function(){return a?a.inspect():{state:"pending"}})}function i(i){return i instanceof s?i:i===Object(i)&&"then"in i?h(function(e,r,n){p(function(){try{var t=i.then;"function"==typeof t?b(t,i,e,r,n):e(o(i))}catch(t){r(t)}})}):o(i)}function o(e){var r=new s(function(t){try{return"function"==typeof t?i(t(e)):r}catch(t){return u(t)}},function(){return f(e)});return r}function u(r){var n=new s(function(t,e){try{return"function"==typeof e?i(e(r)):n}catch(t){return u(t)}},function(){return e(r)});return n}function n(r,n){p(function(){for(var t,e=0;t=r[e++];)t(n)})}function l(t,d,e,r,n){return g(t,function(p){return h(function(e,r,t){function n(t){c(t)}function i(t){u(t)}var o,s,a,l,u,c,h,f;if(h=p.length>>>0,o=Math.max(0,Math.min(d,h)),a=[],s=h-o+1,l=[],o)for(c=function(t){l.push(t),--s||(u=c=m,r(l))},u=function(t){a.push(t),--o||(u=c=m,e(a))},f=0;f<h;++f)f in p&&g(p[f],i,n,t);else e(a)}).then(e,r,n)})}function r(t,e,r,n){return c(t,m).then(e,r,n)}function c(t,u,c){return g(t,function(l){return h(function(r,n,i){var o,t,s,e,a;if(s=t=l.length>>>0,o=[],s)for(e=function(t,e){g(t,u,c).then(function(t){o[e]=t,--s||r(o)},n,i)},a=0;a<t;a++)a in l?e(l[a],a):--s;else r(o)})})}function f(t){return{state:"fulfilled",value:t}}function e(t){return{state:"rejected",reason:t}}function p(t){1===E.push(t)&&w(d)}function d(){for(var t,e=0;t=E[e++];)t();E=[]}function m(t){return t}var v,y,b,w,E,_,t,S,T,I;return g.defer=function(){var t,i,o;return(t={promise:I,resolve:I,reject:I,notify:I,resolver:{resolve:I,reject:I,notify:I}}).promise=i=h(function(e,r,n){t.resolve=t.resolver.resolve=function(t){return o?a(t):(o=!0,e(t),i)},t.reject=t.resolver.reject=function(t){return o?a(u(t)):(o=!0,r(t),i)},t.notify=t.resolver.notify=function(t){return n(t),t}}),t},g.resolve=a,g.reject=function(t){return g(t,u)},g.join=function(){return c(arguments,m)},g.all=r,g.map=function(t,e){return c(t,e)},g.reduce=function(t,o){var e=b(y,arguments,1);return g(t,function(t){var i;return i=t.length,e[0]=function(t,r,n){return g(t,function(e){return g(r,function(t){return o(e,t,n,i)})})},v.apply(t,e)})},g.settle=function(t){return c(t,f,e)},g.any=function(t,e,r,n){return l(t,1,function(t){return e?e(t[0]):t[0]},r,n)},g.some=l,g.isPromise=function(t){return t&&"function"==typeof t.then},g.promise=h,s.prototype={otherwise:function(t){return this.then(I,t)},ensure:function(t){function e(){return a(t())}return this.then(e,e).yield2(this)},yield2:function(t){return this.then(function(){return t})},spread:function(e){return this.then(function(t){return r(t,function(t){return e.apply(I,t)})})},always:function(t,e){return this.then(t,t,e)}},E=[],_=C.setTimeout,w="function"==typeof setImmediate?setImmediate.bind(C):"object"==typeof process&&process.nextTick?process.nextTick:"object"==typeof vertx?vertx.runOnLoop:function(t){_(t,0)},S=(t=Function.prototype).call,b=t.bind?S.bind(S):function(t,e){return t.apply(e,y.call(arguments,2))},y=(T=[]).slice,v=T.reduce||function(t){var e,r,n,i,o;if(o=0,i=(e=Object(this)).length>>>0,(r=arguments).length<=1)for(;;){if(o in e){n=e[o++];break}if(++o>=i)throw new TypeError}else n=r[1];for(;o<i;++o)o in e&&(n=t(n,e[o],o,e));return n},g})}("function"==typeof define&&define.amd?define:function(t){window.when=t()},this),EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=500,EventEmitter.prototype.setMaxListeners=function(t){if(!isNumber(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},EventEmitter.prototype.emit=function(t){var e,r,n,i,o,s;if(this._events||(this._events={}),"error"===t&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(isUndefined(r=this._events[t]))return!1;if(isFunction(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(n=arguments.length,i=new Array(n-1),o=1;o<n;o++)i[o-1]=arguments[o];r.apply(this,i)}else if(isObject(r)){for(n=arguments.length,i=new Array(n-1),o=1;o<n;o++)i[o-1]=arguments[o];for(n=(s=r.slice()).length,o=0;o<n;o++)s[o].apply(this,i)}return!0},EventEmitter.prototype.addListener=function(t,e){var r;if(!isFunction(e))throw TypeError("listener must be a function");(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,isFunction(e.listener)?e.listener:e),this._events[t]?isObject(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,isObject(this._events[t])&&!this._events[t].warned)&&((r=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners)&&0<r&&this._events[t].length>r&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()));return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(t,e){if(!isFunction(e))throw TypeError("listener must be a function");var r=!1;function n(){this.removeListener(t,n),r||(r=!0,e.apply(this,arguments))}return n.listener=e,this.on(t,n),this},EventEmitter.prototype.removeListener=function(t,e){var r,n,i,o;if(!isFunction(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(i=(r=this._events[t]).length,n=-1,r===e||isFunction(r.listener)&&r.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(isObject(r)){for(o=i;0<o--;)if(r[o]===e||r[o].listener&&r[o].listener===e){n=o;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[t]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},EventEmitter.prototype.removeAllListeners=function(t){var e,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(isFunction(r=this._events[t]))this.removeListener(t,r);else for(;r.length;)this.removeListener(t,r[r.length-1]);return delete this._events[t],this},EventEmitter.prototype.listeners=function(t){return this._events&&this._events[t]?isFunction(this._events[t])?[this._events[t]]:this._events[t].slice():[]},EventEmitter.listenerCount=function(t,e){return t._events&&t._events[e]?isFunction(t._events[e])?1:t._events[e].length:0},function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).mqtt=t()}}(function(){return function o(s,a,l){function u(e,t){if(!a[e]){if(!s[e]){var r="function"==typeof require&&require;if(!t&&r)return r(e,!0);if(c)return c(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var i=a[e]={exports:{}};s[e][0].call(i.exports,function(t){return u(s[e][1][t]||t)},i,i.exports,o,s,a,l)}return a[e].exports}for(var c="function"==typeof require&&require,t=0;t<l.length;t++)u(l[t]);return u}({1:[function(v,y,t){(function(l,t){"use strict";var n=v("events"),o=v("./store"),u=v("mqtt-packet"),c=v("readable-stream").Writable,e=v("inherits"),r=v("reinterval"),p=v("./validations"),d=v("xtend"),g=t.setImmediate||function(t){l.nextTick(t)},s={keepalive:60,reschedulePings:!0,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:1e3,connectTimeout:3e4,clean:!0,resubscribe:!0},h={0:"",1:"Unacceptable protocol version",2:"Identifier rejected",3:"Server unavailable",4:"Bad username or password",5:"Not authorized",16:"No matching subscribers",17:"No subscription existed",128:"Unspecified error",129:"Malformed Packet",130:"Protocol Error",131:"Implementation specific error",132:"Unsupported Protocol Version",133:"Client Identifier not valid",134:"Bad User Name or Password",135:"Not authorized",136:"Server unavailable",137:"Server busy",138:"Banned",139:"Server shutting down",140:"Bad authentication method",141:"Keep Alive timeout",142:"Session taken over",143:"Topic Filter invalid",144:"Topic Name invalid",145:"Packet identifier in use",146:"Packet Identifier not found",147:"Receive Maximum exceeded",148:"Topic Alias invalid",149:"Packet too large",150:"Message rate too high",151:"Quota exceeded",152:"Administrative action",153:"Payload format invalid",154:"Retain not supported",155:"QoS not supported",156:"Use another server",157:"Server moved",158:"Shared Subscriptions not supported",159:"Connection rate exceeded",160:"Maximum connect time",161:"Subscription Identifiers not supported",162:"Wildcard Subscriptions not supported"};function f(t,e,r){t.emit("packetsend",e),!u.writeToStream(e,t.stream,t.options)&&r?t.stream.once("drain",r):r&&r()}function i(e,r,n,i){e.outgoingStore.put(r,function(t){if(t)return n&&n(t);i(),f(e,r,n)})}function m(){}function a(t,e){var r,i=this;if(!(this instanceof a))return new a(t,e);for(r in this.options=e||{},s)void 0===this.options[r]?this.options[r]=s[r]:this.options[r]=e[r];this.options.clientId="string"==typeof e.clientId?e.clientId:"mqttjs_"+Math.random().toString(16).substr(2,8),this.options.customHandleAcks=5===e.protocolVersion&&e.customHandleAcks?e.customHandleAcks:function(){arguments[3](0)},this.streamBuilder=t,this.outgoingStore=e.outgoingStore||new o,this.incomingStore=e.incomingStore||new o,this.queueQoSZero=void 0===e.queueQoSZero||e.queueQoSZero,this._resubscribeTopics={},this.messageIdToTopic={},this.pingTimer=null,this.connected=!1,this.disconnecting=!1,this.queue=[],this.connackTimer=null,this.reconnectTimer=null,this._storeProcessing=!1,this._packetIdsDuringStoreProcessing={},this.nextId=Math.max(1,Math.floor(65535*Math.random())),this.outgoing={},this._firstConnection=!0,this.on("close",function(){this.connected=!1,clearTimeout(this.connackTimer)}),this.on("connect",function(){var n=this.queue;!function e(){var t,r=n.shift();r&&(t=r.packet,i._sendPacket(t,function(t){r.cb&&r.cb(t),e()}))}()}),this.on("close",function(){null!==i.pingTimer&&(i.pingTimer.clear(),i.pingTimer=null)}),this.on("close",this._setupReconnect),n.EventEmitter.call(this),this._setupStream()}e(a,n.EventEmitter),a.prototype._setupStream=function(){var t,r=this,e=new c,n=u.parser(this.options),i=null,o=[];function s(){if(o.length)l.nextTick(a);else{var t=i;i=null,t()}}function a(){var t=o.shift();if(t)r._handlePacket(t,s);else{var e=i;i=null,e&&e()}}if(this._clearReconnect(),this.stream=this.streamBuilder(this),n.on("packet",function(t){o.push(t)}),e._write=function(t,e,r){i=r,n.parse(t),a()},this.stream.pipe(e),this.stream.on("error",m),this.stream.on("close",function(){var e;(e=r.outgoing)&&Object.keys(e).forEach(function(t){e[t].volatile&&"function"==typeof e[t].cb&&(e[t].cb(new Error("Connection closed")),delete e[t])}),r.emit("close")}),(t=Object.create(this.options)).cmd="connect",f(this,t),n.on("error",this.emit.bind(this,"error")),this.options.properties){if(!this.options.properties.authenticationMethod&&this.options.properties.authenticationData)return this.emit("error",new Error("Packet has no Authentication Method")),this;if(this.options.properties.authenticationMethod&&this.options.authPacket&&"object"==typeof this.options.authPacket)f(this,d({cmd:"auth",reasonCode:0},this.options.authPacket))}this.stream.setMaxListeners(1e3),clearTimeout(this.connackTimer),this.connackTimer=setTimeout(function(){r._cleanUp(!0)},this.options.connectTimeout)},a.prototype._handlePacket=function(t,e){var r=this.options;if(5===r.protocolVersion&&r.properties&&r.properties.maximumPacketSize&&r.properties.maximumPacketSize<t.length)return this.emit("error",new Error("exceeding packets size "+t.cmd)),this.end({reasonCode:149,properties:{reasonString:"Maximum packet size was exceeded"}}),this;switch(this.emit("packetreceive",t),t.cmd){case"publish":this._handlePublish(t,e);break;case"puback":case"pubrec":case"pubcomp":case"suback":case"unsuback":this._handleAck(t),e();break;case"pubrel":this._handlePubrel(t,e);break;case"connack":this._handleConnack(t),e();break;case"pingresp":this._handlePingresp(t),e();break;case"disconnect":this._handleDisconnect(t),e()}},a.prototype._checkDisconnecting=function(t){return this.disconnecting&&(t?t(new Error("client disconnecting")):this.emit("error",new Error("client disconnecting"))),this.disconnecting},a.prototype.publish=function(t,e,r,n){var i,o=this.options;"function"==typeof r&&(n=r,r=null);if(r=d({qos:0,retain:!1,dup:!1},r),this._checkDisconnecting(n))return this;switch(i={cmd:"publish",topic:t,payload:e,qos:r.qos,retain:r.retain,messageId:this._nextId(),dup:r.dup},5===o.protocolVersion&&(i.properties=r.properties,(!o.properties&&i.properties&&i.properties.topicAlias||r.properties&&o.properties&&(r.properties.topicAlias&&o.properties.topicAliasMaximum&&r.properties.topicAlias>o.properties.topicAliasMaximum||!o.properties.topicAliasMaximum&&r.properties.topicAlias))&&delete i.properties.topicAlias),r.qos){case 1:case 2:this.outgoing[i.messageId]={volatile:!1,cb:n||m},this._storeProcessing?(this._packetIdsDuringStoreProcessing[i.messageId]=!1,this._storePacket(i,void 0,r.cbStorePut)):this._sendPacket(i,void 0,r.cbStorePut);break;default:this._storeProcessing?this._storePacket(i,n,r.cbStorePut):this._sendPacket(i,n,r.cbStorePut)}return this},a.prototype.subscribe=function(){for(var t,e=new Array(arguments.length),r=0;r<arguments.length;r++)e[r]=arguments[r];var n,i=[],o=e.shift(),s=o.resubscribe,a=e.pop()||m,l=e.pop(),u=this,c=this.options.protocolVersion;if(delete o.resubscribe,"string"==typeof o&&(o=[o]),"function"!=typeof a&&(l=a,a=m),null!==(n=p.validateTopics(o)))return g(a,new Error("Invalid topic "+n)),this;if(this._checkDisconnecting(a))return this;var h={qos:0};if(5===c&&(h.nl=!1,h.rap=!1,h.rh=0),l=d(h,l),Array.isArray(o)?o.forEach(function(t){if(!u._resubscribeTopics.hasOwnProperty(t)||u._resubscribeTopics[t].qos<l.qos||s){var e={topic:t,qos:l.qos};5===c&&(e.nl=l.nl,e.rap=l.rap,e.rh=l.rh,e.properties=l.properties),i.push(e)}}):Object.keys(o).forEach(function(t){if(!u._resubscribeTopics.hasOwnProperty(t)||u._resubscribeTopics[t].qos<o[t].qos||s){var e={topic:t,qos:o[t].qos};5===c&&(e.nl=o[t].nl,e.rap=o[t].rap,e.rh=o[t].rh,e.properties=l.properties),i.push(e)}}),t={cmd:"subscribe",subscriptions:i,qos:1,retain:!1,dup:!1,messageId:this._nextId()},l.properties&&(t.properties=l.properties),i.length){if(this.options.resubscribe){var f=[];i.forEach(function(t){if(0<u.options.reconnectPeriod){var e={qos:t.qos};5===c&&(e.nl=t.nl||!1,e.rap=t.rap||!1,e.rh=t.rh||0,e.properties=t.properties),u._resubscribeTopics[t.topic]=e,f.push(t.topic)}}),u.messageIdToTopic[t.messageId]=f}return this.outgoing[t.messageId]={volatile:!0,cb:function(t,e){if(!t)for(var r=e.granted,n=0;n<r.length;n+=1)i[n].qos=r[n];a(t,i)}},this._sendPacket(t),this}a(null,[])},a.prototype.unsubscribe=function(){for(var t={cmd:"unsubscribe",qos:1,messageId:this._nextId()},e=this,r=new Array(arguments.length),n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r.shift(),o=r.pop()||m,s=r.pop();return"string"==typeof i&&(i=[i]),"function"!=typeof o&&(s=o,o=m),this._checkDisconnecting(o)||("string"==typeof i?t.unsubscriptions=[i]:"object"==typeof i&&i.length&&(t.unsubscriptions=i),this.options.resubscribe&&t.unsubscriptions.forEach(function(t){delete e._resubscribeTopics[t]}),"object"==typeof s&&s.properties&&(t.properties=s.properties),this.outgoing[t.messageId]={volatile:!0,cb:o},this._sendPacket(t)),this},a.prototype.end=function(){var t=this,e=arguments[0],r=arguments[1],n=arguments[2];function i(){t.disconnected=!0,t.incomingStore.close(function(){t.outgoingStore.close(function(){n&&n.apply(null,arguments),t.emit("end")})}),t._deferredReconnect&&t._deferredReconnect()}function o(){t._cleanUp(e,g.bind(null,i),r)}return null!=e&&"boolean"==typeof e||(n=r||m,r=e,e=!1,"object"!=typeof r&&(n=r,r=null,"function"!=typeof n&&(n=m))),"object"!=typeof r&&(n=r,r=null),n=n||m,this.disconnecting||(this._clearReconnect(),this.disconnecting=!0,!e&&0<Object.keys(this.outgoing).length?this.once("outgoingEmpty",setTimeout.bind(null,o,10)):o()),this},a.prototype.removeOutgoingMessage=function(t){var e=this.outgoing[t]?this.outgoing[t].cb:null;return delete this.outgoing[t],this.outgoingStore.del({messageId:t},function(){e(new Error("Message removed"))}),this},a.prototype.reconnect=function(t){var e=this,r=function(){t?(e.options.incomingStore=t.incomingStore,e.options.outgoingStore=t.outgoingStore):(e.options.incomingStore=null,e.options.outgoingStore=null),e.incomingStore=e.options.incomingStore||new o,e.outgoingStore=e.options.outgoingStore||new o,e.disconnecting=!1,e.disconnected=!1,e._deferredReconnect=null,e._reconnect()};return this.disconnecting&&!this.disconnected?this._deferredReconnect=r:r(),this},a.prototype._reconnect=function(){this.emit("reconnect"),this._setupStream()},a.prototype._setupReconnect=function(){var t=this;!t.disconnecting&&!t.reconnectTimer&&0<t.options.reconnectPeriod&&(this.reconnecting||(this.emit("offline"),this.reconnecting=!0),t.reconnectTimer=setInterval(function(){t._reconnect()},t.options.reconnectPeriod))},a.prototype._clearReconnect=function(){this.reconnectTimer&&(clearInterval(this.reconnectTimer),this.reconnectTimer=null)},a.prototype._cleanUp=function(t,e){var r,n=arguments[2];if(e&&this.stream.on("close",e),t)0===this.options.reconnectPeriod&&this.options.clean&&(r=this.outgoing)&&Object.keys(r).forEach(function(t){"function"==typeof r[t].cb&&(r[t].cb(new Error("Connection closed")),delete r[t])}),this.stream.destroy();else{var i=d({cmd:"disconnect"},n);this._sendPacket(i,g.bind(null,this.stream.end.bind(this.stream)))}this.disconnecting||(this._clearReconnect(),this._setupReconnect()),null!==this.pingTimer&&(this.pingTimer.clear(),this.pingTimer=null),e&&!this.connected&&(this.stream.removeListener("close",e),e())},a.prototype._sendPacket=function(t,e,r){if(r=r||m,this.connected){switch(this._shiftPingInterval(),t.cmd){case"publish":break;case"pubrel":return void i(this,t,e,r);default:return void f(this,t,e)}switch(t.qos){case 2:case 1:i(this,t,e,r);break;case 0:default:f(this,t,e)}}else this._storePacket(t,e,r)},a.prototype._storePacket=function(t,e,r){r=r||m,0===(t.qos||0)&&this.queueQoSZero||"publish"!==t.cmd?this.queue.push({packet:t,cb:e}):0<t.qos?(e=this.outgoing[t.messageId]?this.outgoing[t.messageId].cb:null,this.outgoingStore.put(t,function(t){if(t)return e&&e(t);r()})):e&&e(new Error("No connection to broker"))},a.prototype._setupPingTimer=function(){var t=this;!this.pingTimer&&this.options.keepalive&&(this.pingResp=!0,this.pingTimer=r(function(){t._checkPing()},1e3*this.options.keepalive))},a.prototype._shiftPingInterval=function(){this.pingTimer&&this.options.keepalive&&this.options.reschedulePings&&this.pingTimer.reschedule(1e3*this.options.keepalive)},a.prototype._checkPing=function(){this.pingResp?(this.pingResp=!1,this._sendPacket({cmd:"pingreq"})):this._cleanUp(!0)},a.prototype._handlePingresp=function(){this.pingResp=!0},a.prototype._handleConnack=function(t){var e=this.options,r=5===e.protocolVersion?t.reasonCode:t.returnCode;if(clearTimeout(this.connackTimer),t.properties&&(t.properties.topicAliasMaximum&&(e.properties||(e.properties={}),e.properties.topicAliasMaximum=t.properties.topicAliasMaximum),t.properties.serverKeepAlive&&e.keepalive&&(e.keepalive=t.properties.serverKeepAlive,this._shiftPingInterval()),t.properties.maximumPacketSize&&(e.properties||(e.properties={}),e.properties.maximumPacketSize=t.properties.maximumPacketSize)),0===r)this.reconnecting=!1,this._onConnect(t);else if(0<r){var n=new Error("Connection refused: "+h[r]);n.code=r,this.emit("error",n)}},a.prototype._handlePublish=function(r,n){n=void 0!==n?n:m;var i=r.topic.toString(),o=r.payload,t=r.qos,s=r.messageId,a=this,e=this.options,l=[0,16,128,131,135,144,145,151,153];switch(t){case 2:e.customHandleAcks(i,o,r,function(t,e){return t instanceof Error||(e=t,t=null),t?a.emit("error",t):-1===l.indexOf(e)?a.emit("error",new Error("Wrong reason code for pubrec")):void(e?a._sendPacket({cmd:"pubrec",messageId:s,reasonCode:e},n):a.incomingStore.put(r,function(){a._sendPacket({cmd:"pubrec",messageId:s},n)}))});break;case 1:e.customHandleAcks(i,o,r,function(t,e){return t instanceof Error||(e=t,t=null),t?a.emit("error",t):-1===l.indexOf(e)?a.emit("error",new Error("Wrong reason code for puback")):(e||a.emit("message",i,o,r),void a.handleMessage(r,function(t){if(t)return n&&n(t);a._sendPacket({cmd:"puback",messageId:s,reasonCode:e},n)}))});break;case 0:this.emit("message",i,o,r),this.handleMessage(r,n)}},a.prototype.handleMessage=function(t,e){e()},a.prototype._handleAck=function(t){var e,r=t.messageId,n=t.cmd,i=null,o=this.outgoing[r]?this.outgoing[r].cb:null,s=this;if(o){switch(n){case"pubcomp":case"puback":var a=t.reasonCode;a&&0<a&&16!==a&&((e=new Error("Publish error: "+h[a])).code=a,o(e,t)),delete this.outgoing[r],this.outgoingStore.del(t,o);break;case"pubrec":i={cmd:"pubrel",qos:2,messageId:r};var l=t.reasonCode;l&&0<l&&16!==l?((e=new Error("Publish error: "+h[l])).code=l,o(e,t)):this._sendPacket(i);break;case"suback":delete this.outgoing[r];for(var u=0;u<t.granted.length;u++)if(0!=(128&t.granted[u])){var c=this.messageIdToTopic[r];c&&c.forEach(function(t){delete s._resubscribeTopics[t]})}o(null,t);break;case"unsuback":delete this.outgoing[r],o(null);break;default:s.emit("error",new Error("unrecognized packet type"))}this.disconnecting&&0===Object.keys(this.outgoing).length&&this.emit("outgoingEmpty")}},a.prototype._handlePubrel=function(t,r){r=void 0!==r?r:m;var e=t.messageId,n=this,i={cmd:"pubcomp",messageId:e};n.incomingStore.get(t,function(t,e){t?n._sendPacket(i,r):(n.emit("message",e.topic,e.payload,e),n.handleMessage(e,function(t){if(t)return r(t);n.incomingStore.del(e,m),n._sendPacket(i,r)}))})},a.prototype._handleDisconnect=function(t){this.emit("disconnect",t)},a.prototype._nextId=function(){var t=this.nextId++;return 65536===this.nextId&&(this.nextId=1),t},a.prototype.getLastMessageId=function(){return 1===this.nextId?65535:this.nextId-1},a.prototype._resubscribe=function(t){var e=Object.keys(this._resubscribeTopics);if(!this._firstConnection&&(this.options.clean||5===this.options.protocolVersion&&!t.sessionPresent)&&0<e.length)if(this.options.resubscribe)if(5===this.options.protocolVersion)for(var r=0;r<e.length;r++){var n={};n[e[r]]=this._resubscribeTopics[e[r]],n.resubscribe=!0,this.subscribe(n,{properties:n[e[r]].properties})}else this._resubscribeTopics.resubscribe=!0,this.subscribe(this._resubscribeTopics);else this._resubscribeTopics={};this._firstConnection=!1},a.prototype._onConnect=function(o){if(this.disconnected)this.emit("connect",o);else{var s=this;this._setupPingTimer(),this._resubscribe(o),this.connected=!0,function r(){var e=s.outgoingStore.createStream();function n(){s._storeProcessing=!1,s._packetIdsDuringStoreProcessing={}}function i(){e.destroy(),e=null,n()}s.once("close",i),e.on("error",function(t){n(),s.removeListener("close",i),s.emit("error",t)}),e.on("end",function(){var t=!0;for(var e in s._packetIdsDuringStoreProcessing)if(!s._packetIdsDuringStoreProcessing[e]){t=!1;break}t?(n(),s.removeListener("close",i),s.emit("connect",o)):r()}),function r(){if(e){s._storeProcessing=!0;var n,t=e.read(1);t?s._packetIdsDuringStoreProcessing[t.messageId]?r():s.disconnecting||s.reconnectTimer?e.destroy&&e.destroy():(n=s.outgoing[t.messageId]?s.outgoing[t.messageId].cb:null,s.outgoing[t.messageId]={volatile:!1,cb:function(t,e){n&&n(t,e),r()}},s._packetIdsDuringStoreProcessing[t.messageId]=!0,s._sendPacket(t)):e.once("readable",r)}}()}()}},y.exports=a}).call(this,v("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./store":7,"./validations":8,_process:92,events:13,inherits:80,"mqtt-packet":84,"readable-stream":108,reinterval:109,xtend:121}],2:[function(t,e,r){(function(c){"use strict";var h,f,p,d=t("readable-stream").Transform,g=t("duplexify"),m=t("base64-js"),v=!1;e.exports=function(t,e){if(e.hostname=e.hostname||e.host,!e.hostname)throw new Error("Could not determine host. Specify host manually.");var r,n="MQIsdp"===e.protocolId&&3===e.protocolVersion?"mqttv3.1":"mqtt";(r=e).hostname||(r.hostname="localhost"),r.path||(r.path="/"),r.wsOptions||(r.wsOptions={});var i,o,s,a,l,u=(o=t,s="alis"===(i=e).protocol?"wss":"ws",a=s+"://"+i.hostname+i.path,i.port&&80!==i.port&&443!==i.port&&(a=s+"://"+i.hostname+":"+i.port+i.path),"function"==typeof i.transformWsUrl&&(a=i.transformWsUrl(a,i,o)),a);return(h=e.my).connectSocket({url:u,protocols:n}),(l=new d)._write=function(t,e,r){h.sendSocketMessage({data:t.buffer,success:function(){r()},fail:function(){r(new Error)}})},l._flush=function(t){h.closeSocket({success:function(){t()}})},f=l,p=g.obj(),v||(v=!0,h.onSocketOpen(function(){p.setReadable(f),p.setWritable(f),p.emit("connect")}),h.onSocketMessage(function(t){if("string"==typeof t.data){var e=m.toByteArray(t.data),r=c.from(e);f.push(r)}else{var n=new FileReader;n.addEventListener("load",function(){var t=n.result;t=t instanceof ArrayBuffer?c.from(t):c.from(t,"utf8"),f.push(t)}),n.readAsArrayBuffer(t.data)}}),h.onSocketClose(function(){p.end(),p.destroy()}),h.onSocketError(function(t){p.destroy(t)})),p}}).call(this,t("buffer").Buffer)},{"base64-js":10,buffer:12,duplexify:17,"readable-stream":108}],3:[function(t,e,r){"use strict";var i=t("net");e.exports=function(t,e){var r,n;return e.port=e.port||1883,e.hostname=e.hostname||e.host||"localhost",r=e.port,n=e.hostname,i.createConnection(r,n)}},{net:11}],4:[function(t,e,r){"use strict";var i=t("tls");e.exports=function(e,r){var n;function t(t){r.rejectUnauthorized&&e.emit("error",t),n.end()}return r.port=r.port||8883,r.host=r.hostname||r.host||"localhost",r.rejectUnauthorized=!1!==r.rejectUnauthorized,delete r.path,(n=i.connect(r)).on("secureConnect",function(){r.rejectUnauthorized&&!n.authorized?n.emit("error",new Error("TLS not authorized")):n.removeListener("error",t)}),n.on("error",t),n}},{tls:11}],5:[function(e,r,t){(function(t){"use strict";var l=e("websocket-stream"),n=e("url"),u=["rejectUnauthorized","ca","cert","key","pfx","passphrase"],c="browser"===t.title;function i(t,e){var r,n="MQIsdp"===e.protocolId&&3===e.protocolVersion?"mqttv3.1":"mqtt";(r=e).hostname||(r.hostname="localhost"),r.port||("wss"===r.protocol?r.port=443:r.port=80),r.path||(r.path="/"),r.wsOptions||(r.wsOptions={}),c||"wss"!==r.protocol||u.forEach(function(t){r.hasOwnProperty(t)&&!r.wsOptions.hasOwnProperty(t)&&(r.wsOptions[t]=r[t])});var i,o,s,a=(o=t,s=(i=e).protocol+"://"+i.hostname+":"+i.port+i.path,"function"==typeof i.transformWsUrl&&(s=i.transformWsUrl(s,i,o)),s);return l(a,[n],e.wsOptions)}r.exports=c?function(t,e){if(e.hostname||(e.hostname=e.host),!e.hostname){if("undefined"==typeof document)throw new Error("Could not determine host. Specify host manually.");var r=n.parse(document.URL);e.hostname=r.hostname,e.port||(e.port=r.port)}return i(t,e)}:function(t,e){return i(t,e)}}).call(this,e("_process"))},{_process:92,url:113,"websocket-stream":118}],6:[function(t,e,r){(function(h,f){"use strict";var p,d,g,m=t("readable-stream").Transform,v=t("duplexify");e.exports=function(t,e){if(e.hostname=e.hostname||e.host,!e.hostname)throw new Error("Could not determine host. Specify host manually.");var r,n="MQIsdp"===e.protocolId&&3===e.protocolVersion?"mqttv3.1":"mqtt";(r=e).hostname||(r.hostname="localhost"),r.path||(r.path="/"),r.wsOptions||(r.wsOptions={});var i,o,s,a,l,u=(o=t,s="wxs"===(i=e).protocol?"wss":"ws",a=s+"://"+i.hostname+i.path,i.port&&80!==i.port&&443!==i.port&&(a=s+"://"+i.hostname+":"+i.port+i.path),"function"==typeof i.transformWsUrl&&(a=i.transformWsUrl(a,i,o)),a);p=wx.connectSocket({url:u,protocols:n}),(l=new m)._write=function(t,e,r){p.send({data:t.buffer,success:function(){r()},fail:function(t){r(new Error(t))}})},l._flush=function(t){p.close({success:function(){t()}})},d=l,(g=v.obj())._destroy=function(t,e){p.close({success:function(){e&&e(t)}})};var c=g.destroy;return g.destroy=function(){g.destroy=c;var t=this;h.nextTick(function(){p.close({fail:function(){t._destroy(new Error)}})})}.bind(g),p.onOpen(function(){g.setReadable(d),g.setWritable(d),g.emit("connect")}),p.onMessage(function(t){var e=t.data;e=e instanceof ArrayBuffer?f.from(e):f.from(e,"utf8"),d.push(e)}),p.onClose(function(){g.end(),g.destroy()}),p.onError(function(t){g.destroy(new Error(t.errMsg))}),g}}).call(this,t("_process"),t("buffer").Buffer)},{_process:92,buffer:12,duplexify:17,"readable-stream":108}],7:[function(t,l,e){(function(i){"use strict";var e=t("xtend"),o=t("readable-stream").Readable,s={objectMode:!0},r={clean:!0},n=t("es6-map");function a(t){if(!(this instanceof a))return new a(t);this.options=t||{},this.options=e(r,t),this._inflights=new n}a.prototype.put=function(t,e){return this._inflights.set(t.messageId,t),e&&e(),this},a.prototype.createStream=function(){var t=new o(s),e=!1,r=[],n=0;return this._inflights.forEach(function(t,e){r.push(t)}),t._read=function(){!e&&n<r.length?this.push(r[n++]):this.push(null)},t.destroy=function(){if(!e){var t=this;e=!0,i.nextTick(function(){t.emit("close")})}},t},a.prototype.del=function(t,e){return(t=this._inflights.get(t.messageId))?(this._inflights.delete(t.messageId),e(null,t)):e&&e(new Error("missing packet")),this},a.prototype.get=function(t,e){return(t=this._inflights.get(t.messageId))?e(null,t):e&&e(new Error("missing packet")),this},a.prototype.close=function(t){this.options.clean&&(this._inflights=null),t&&t()},l.exports=a}).call(this,t("_process"))},{_process:92,"es6-map":67,"readable-stream":108,xtend:121}],8:[function(t,e,r){"use strict";function n(t){for(var e=t.split("/"),r=0;r<e.length;r++)if("+"!==e[r]){if("#"===e[r])return r===e.length-1;if(-1!==e[r].indexOf("+")||-1!==e[r].indexOf("#"))return!1}return!0}e.exports={validateTopics:function(t){if(0===t.length)return"empty_topic_list";for(var e=0;e<t.length;e++)if(!n(t[e]))return t[e];return null}}},{}],9:[function(n,i,t){(function(t){"use strict";var s=n("../client"),e=n("../store"),a=n("url"),l=n("xtend"),u={};function r(t,e){if("object"!=typeof t||e||(e=t,t=null),e=e||{},t){var r=a.parse(t,!0);if(null!=r.port&&(r.port=Number(r.port)),null===(e=l(r,e)).protocol)throw new Error("Missing protocol");e.protocol=e.protocol.replace(/:$/,"")}var n,i;if((n=e).auth&&((i=n.auth.match(/^(.+):(.+)$/))?(n.username=i[1],n.password=i[2]):n.username=n.auth),e.query&&"string"==typeof e.query.clientId&&(e.clientId=e.query.clientId),e.cert&&e.key){if(!e.protocol)throw new Error("Missing secure protocol key");if(-1===["mqtts","wss","wxs","alis"].indexOf(e.protocol))switch(e.protocol){case"mqtt":e.protocol="mqtts";break;case"ws":e.protocol="wss";break;case"wx":e.protocol="wxs";break;case"ali":e.protocol="alis";break;default:throw new Error('Unknown protocol for secure connection: "'+e.protocol+'"!')}}if(!u[e.protocol]){var o=-1!==["mqtts","wss"].indexOf(e.protocol);e.protocol=["mqtt","mqtts","ws","wss","wx","wxs","ali","alis"].filter(function(t,e){return(!o||e%2!=0)&&"function"==typeof u[t]})[0]}if(!1===e.clean&&!e.clientId)throw new Error("Missing clientId for unclean clients");return e.protocol&&(e.defaultProtocol=e.protocol),new s(function(t){return e.servers&&(t._reconnectCount&&t._reconnectCount!==e.servers.length||(t._reconnectCount=0),e.host=e.servers[t._reconnectCount].host,e.port=e.servers[t._reconnectCount].port,e.protocol=e.servers[t._reconnectCount].protocol?e.servers[t._reconnectCount].protocol:e.defaultProtocol,e.hostname=e.host,t._reconnectCount++),u[e.protocol](t,e)},e)}"browser"!==t.title?(u.mqtt=n("./tcp"),u.tcp=n("./tcp"),u.ssl=n("./tls"),u.tls=n("./tls"),u.mqtts=n("./tls")):(u.wx=n("./wx"),u.wxs=n("./wx"),u.ali=n("./ali"),u.alis=n("./ali")),u.ws=n("./ws"),u.wss=n("./ws"),i.exports=r,i.exports.connect=r,i.exports.MqttClient=s,i.exports.Store=e}).call(this,n("_process"))},{"../client":1,"../store":7,"./ali":2,"./tcp":3,"./tls":4,"./ws":5,"./wx":6,_process:92,url:113,xtend:121}],10:[function(t,e,r){"use strict";r.byteLength=function(t){var e=p(t),r=e[0],n=e[1];return 3*(r+n)/4-n},r.toByteArray=function(t){for(var e,r=p(t),n=r[0],i=r[1],o=new f((u=n,c=i,3*(u+c)/4-c)),s=0,a=0<i?n-4:n,l=0;l<a;l+=4)e=h[t.charCodeAt(l)]<<18|h[t.charCodeAt(l+1)]<<12|h[t.charCodeAt(l+2)]<<6|h[t.charCodeAt(l+3)],o[s++]=e>>16&255,o[s++]=e>>8&255,o[s++]=255&e;var u,c;2===i&&(e=h[t.charCodeAt(l)]<<2|h[t.charCodeAt(l+1)]>>4,o[s++]=255&e);1===i&&(e=h[t.charCodeAt(l)]<<10|h[t.charCodeAt(l+1)]<<4|h[t.charCodeAt(l+2)]>>2,o[s++]=e>>8&255,o[s++]=255&e);return o},r.fromByteArray=function(t){for(var e,r=t.length,n=r%3,i=[],o=0,s=r-n;o<s;o+=16383)i.push(l(t,o,s<o+16383?s:o+16383));1===n?(e=t[r-1],i.push(a[e>>2]+a[e<<4&63]+"==")):2===n&&(e=(t[r-2]<<8)+t[r-1],i.push(a[e>>10]+a[e>>4&63]+a[e<<2&63]+"="));return i.join("")};for(var a=[],h=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,o=n.length;i<o;++i)a[i]=n[i],h[n.charCodeAt(i)]=i;function p(t){var e=t.length;if(0<e%4)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function l(t,e,r){for(var n,i,o=[],s=e;s<r;s+=3)n=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),o.push(a[(i=n)>>18&63]+a[i>>12&63]+a[i>>6&63]+a[63&i]);return o.join("")}h["-".charCodeAt(0)]=62,h["_".charCodeAt(0)]=63},{}],11:[function(t,e,r){},{}],12:[function(t,e,r){"use strict";var n=t("base64-js"),o=t("ieee754");r.Buffer=h,r.SlowBuffer=function(t){+t!=t&&(t=0);return h.alloc(+t)},r.INSPECT_MAX_BYTES=50;var i=2147483647;function s(t){if(i<t)throw new RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return e.__proto__=h.prototype,e}function h(t,e,r){if("number"!=typeof t)return a(t,e,r);if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return u(t)}function a(t,e,r){if("string"==typeof t)return function(t,e){"string"==typeof e&&""!==e||(e="utf8");if(!h.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var r=0|p(t,e),n=s(r),i=n.write(t,e);i!==r&&(n=n.slice(0,i));return n}(t,e);if(ArrayBuffer.isView(t))return c(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(j(t,ArrayBuffer)||t&&j(t.buffer,ArrayBuffer))return function(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r);return n.__proto__=h.prototype,n}(t,e,r);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return h.from(n,e,r);var i=function(t){if(h.isBuffer(t)){var e=0|f(t.length),r=s(e);return 0===r.length||t.copy(r,0,0,e),r}if(void 0!==t.length)return"number"!=typeof t.length||U(t.length)?s(0):c(t);if("Buffer"===t.type&&Array.isArray(t.data))return c(t.data)}(t);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return h.from(t[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function l(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function u(t){return l(t),s(t<0?0:0|f(t))}function c(t){for(var e=t.length<0?0:0|f(t.length),r=s(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}function f(t){if(i<=t)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return 0|t}function p(t,e){if(h.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||j(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var r=t.length,n=2<arguments.length&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return N(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return O(t).length;default:if(i)return n?-1:N(t).length;e=(""+e).toLowerCase(),i=!0}}function d(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function g(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),U(r=+r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=h.from(e,n)),h.isBuffer(e))return 0===e.length?-1:m(t,e,r,n,i);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):m(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function m(t,e,r,n,i){var o,s=1,a=t.length,l=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;a/=s=2,l/=2,r/=2}function u(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i){var c=-1;for(o=r;o<a;o++)if(u(t,o)===u(e,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===l)return c*s}else-1!==c&&(o-=o-c),c=-1}else for(a<r+l&&(r=a-l),o=r;0<=o;o--){for(var h=!0,f=0;f<l;f++)if(u(t,o+f)!==u(e,f)){h=!1;break}if(h)return o}return-1}function v(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?i<(n=Number(n))&&(n=i):n=i;var o=e.length;o/2<n&&(n=o/2);for(var s=0;s<n;++s){var a=parseInt(e.substr(2*s,2),16);if(U(a))return s;t[r+s]=a}return s}function y(t,e,r,n){return P(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function b(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function w(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o,s,a,l,u=t[i],c=null,h=239<u?4:223<u?3:191<u?2:1;if(i+h<=r)switch(h){case 1:u<128&&(c=u);break;case 2:128==(192&(o=t[i+1]))&&127<(l=(31&u)<<6|63&o)&&(c=l);break;case 3:o=t[i+1],s=t[i+2],128==(192&o)&&128==(192&s)&&2047<(l=(15&u)<<12|(63&o)<<6|63&s)&&(l<55296||57343<l)&&(c=l);break;case 4:o=t[i+1],s=t[i+2],a=t[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&65535<(l=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)&&l<1114112&&(c=l)}null===c?(c=65533,h=1):65535<c&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=h}return function(t){var e=t.length;if(e<=E)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=E));return r}(n)}r.kMaxLength=i,(h.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(t){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(h.prototype,"parent",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.buffer}}),Object.defineProperty(h.prototype,"offset",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),h.poolSize=8192,h.from=function(t,e,r){return a(t,e,r)},h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,h.alloc=function(t,e,r){return i=e,o=r,l(n=t),n<=0?s(n):void 0!==i?"string"==typeof o?s(n).fill(i,o):s(n).fill(i):s(n);var n,i,o},h.allocUnsafe=function(t){return u(t)},h.allocUnsafeSlow=function(t){return u(t)},h.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==h.prototype},h.compare=function(t,e){if(j(t,Uint8Array)&&(t=h.from(t,t.offset,t.byteLength)),j(e,Uint8Array)&&(e=h.from(e,e.offset,e.byteLength)),!h.isBuffer(t)||!h.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},h.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return h.alloc(0);var r;if(void 0===e)for(r=e=0;r<t.length;++r)e+=t[r].length;var n=h.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var o=t[r];if(j(o,Uint8Array)&&(o=h.from(o)),!h.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},h.byteLength=p,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)d(this,e,e+1);return this},h.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)d(this,e,e+3),d(this,e+1,e+2);return this},h.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)d(this,e,e+7),d(this,e+1,e+6),d(this,e+2,e+5),d(this,e+3,e+4);return this},h.prototype.toLocaleString=h.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?w(this,0,t):function(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return T(this,e,r);case"utf8":case"utf-8":return w(this,e,r);case"ascii":return _(this,e,r);case"latin1":case"binary":return S(this,e,r);case"base64":return b(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}.apply(this,arguments)},h.prototype.equals=function(t){if(!h.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===h.compare(this,t)},h.prototype.inspect=function(){var t="",e=r.INSPECT_MAX_BYTES;return t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(t+=" ... "),"<Buffer "+t+">"},h.prototype.compare=function(t,e,r,n,i){if(j(t,Uint8Array)&&(t=h.from(t,t.offset,t.byteLength)),!h.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(i<=n&&r<=e)return 0;if(i<=n)return-1;if(r<=e)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(e>>>=0),a=Math.min(o,s),l=this.slice(n,i),u=t.slice(e,r),c=0;c<a;++c)if(l[c]!==u[c]){o=l[c],s=u[c];break}return o<s?-1:s<o?1:0},h.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},h.prototype.indexOf=function(t,e,r){return g(this,t,e,r,!0)},h.prototype.lastIndexOf=function(t,e,r){return g(this,t,e,r,!1)},h.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||i<r)&&(r=i),0<t.length&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o,s,a,l,u,c,h,f,p,d=!1;;)switch(n){case"hex":return v(this,t,e,r);case"utf8":case"utf-8":return f=e,p=r,P(N(t,(h=this).length-f),h,f,p);case"ascii":return y(this,t,e,r);case"latin1":case"binary":return y(this,t,e,r);case"base64":return l=this,u=e,c=r,P(O(t),l,u,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return s=e,a=r,P(function(t,e){for(var r,n,i,o=[],s=0;s<t.length&&!((e-=2)<0);++s)r=t.charCodeAt(s),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(t,(o=this).length-s),o,s,a);default:if(d)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),d=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var E=4096;function _(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function S(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function T(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||n<r)&&(r=n);for(var i="",o=e;o<r;++o)i+=k(t[o]);return i}function I(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function C(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(r<t+e)throw new RangeError("Trying to access beyond buffer length")}function x(t,e,r,n,i,o){if(!h.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(i<e||e<o)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function L(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function A(t,e,r,n,i){return e=+e,r>>>=0,i||L(t,0,r,4),o.write(t,e,r,n,23,4),r+4}function M(t,e,r,n,i){return e=+e,r>>>=0,i||L(t,0,r,8),o.write(t,e,r,n,52,8),r+8}h.prototype.slice=function(t,e){var r=this.length;(t=~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),e<t&&(e=t);var n=this.subarray(t,e);return n.__proto__=h.prototype,n},h.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},h.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);for(var n=this[t+--e],i=1;0<e&&(i*=256);)n+=this[t+--e]*i;return n},h.prototype.readUInt8=function(t,e){return t>>>=0,e||C(t,1,this.length),this[t]},h.prototype.readUInt16LE=function(t,e){return t>>>=0,e||C(t,2,this.length),this[t]|this[t+1]<<8},h.prototype.readUInt16BE=function(t,e){return t>>>=0,e||C(t,2,this.length),this[t]<<8|this[t+1]},h.prototype.readUInt32LE=function(t,e){return t>>>=0,e||C(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},h.prototype.readUInt32BE=function(t,e){return t>>>=0,e||C(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},h.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return(i*=128)<=n&&(n-=Math.pow(2,8*e)),n},h.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||C(t,e,this.length);for(var n=e,i=1,o=this[t+--n];0<n&&(i*=256);)o+=this[t+--n]*i;return(i*=128)<=o&&(o-=Math.pow(2,8*e)),o},h.prototype.readInt8=function(t,e){return t>>>=0,e||C(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},h.prototype.readInt16LE=function(t,e){t>>>=0,e||C(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},h.prototype.readInt16BE=function(t,e){t>>>=0,e||C(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},h.prototype.readInt32LE=function(t,e){return t>>>=0,e||C(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},h.prototype.readInt32BE=function(t,e){return t>>>=0,e||C(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},h.prototype.readFloatLE=function(t,e){return t>>>=0,e||C(t,4,this.length),o.read(this,t,!0,23,4)},h.prototype.readFloatBE=function(t,e){return t>>>=0,e||C(t,4,this.length),o.read(this,t,!1,23,4)},h.prototype.readDoubleLE=function(t,e){return t>>>=0,e||C(t,8,this.length),o.read(this,t,!0,52,8)},h.prototype.readDoubleBE=function(t,e){return t>>>=0,e||C(t,8,this.length),o.read(this,t,!1,52,8)},h.prototype.writeUIntLE=function(t,e,r,n){(t=+t,e>>>=0,r>>>=0,n)||x(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},h.prototype.writeUIntBE=function(t,e,r,n){(t=+t,e>>>=0,r>>>=0,n)||x(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[e+i]=255&t;0<=--i&&(o*=256);)this[e+i]=t/o&255;return e+r},h.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||x(this,t,e,1,255,0),this[e]=255&t,e+1},h.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||x(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},h.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||x(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},h.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||x(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},h.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||x(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},h.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);x(this,t,e,r,i-1,-i)}var o=0,s=1,a=0;for(this[e]=255&t;++o<r&&(s*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+r},h.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);x(this,t,e,r,i-1,-i)}var o=r-1,s=1,a=0;for(this[e+o]=255&t;0<=--o&&(s*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+r},h.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||x(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},h.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||x(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},h.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||x(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},h.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||x(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},h.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||x(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},h.prototype.writeFloatLE=function(t,e,r){return A(this,t,e,!0,r)},h.prototype.writeFloatBE=function(t,e,r){return A(this,t,e,!1,r)},h.prototype.writeDoubleLE=function(t,e,r){return M(this,t,e,!0,r)},h.prototype.writeDoubleBE=function(t,e,r){return M(this,t,e,!1,r)},h.prototype.copy=function(t,e,r,n){if(!h.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),0<n&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i=n-r;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,r,n);else if(this===t&&r<e&&e<n)for(var o=i-1;0<=o;--o)t[o+e]=this[o+r];else Uint8Array.prototype.set.call(t,this.subarray(r,n),e);return i},h.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!h.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===t.length){var i=t.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(t=i)}}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var o;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(o=e;o<r;++o)this[o]=t;else{var s=h.isBuffer(t)?t:h.from(t,n),a=s.length;if(0===a)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(o=0;o<r-e;++o)this[o+e]=s[o%a]}return this};var R=/[^+/0-9A-Za-z-_]/g;function k(t){return t<16?"0"+t.toString(16):t.toString(16)}function N(t,e){var r;e=e||1/0;for(var n=t.length,i=null,o=[],s=0;s<n;++s){if(55295<(r=t.charCodeAt(s))&&r<57344){if(!i){if(56319<r){-1<(e-=3)&&o.push(239,191,189);continue}if(s+1===n){-1<(e-=3)&&o.push(239,191,189);continue}i=r;continue}if(r<56320){-1<(e-=3)&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&-1<(e-=3)&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function O(t){return n.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(R,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function P(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function j(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function U(t){return t!=t}},{"base64-js":10,ieee754:79}],13:[function(t,e,r){var l=Object.create||function(t){var e=function(){};return e.prototype=t,new e},s=Object.keys||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.push(r);return r},o=Function.prototype.bind||function(t){var e=this;return function(){return e.apply(t,arguments)}};function n(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=l(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}((e.exports=n).EventEmitter=n).prototype._events=void 0,n.prototype._maxListeners=void 0;var i,a=10;try{var u={};Object.defineProperty&&Object.defineProperty(u,"x",{value:0}),i=0===u.x}catch(t){i=!1}function c(t){return void 0===t._maxListeners?n.defaultMaxListeners:t._maxListeners}function h(t,e,r,n){var i,o,s;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((o=t._events)?(o.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),o=t._events),s=o[e]):(o=t._events=l(null),t._eventsCount=0),s){if("function"==typeof s?s=o[e]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),!s.warned&&(i=c(t))&&0<i&&s.length>i){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+' "'+String(e)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=s.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",a.name,a.message)}}else s=o[e]=r,++t._eventsCount;return t}function f(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];this.listener.apply(this.target,t)}}function p(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=o.call(f,n);return i.listener=r,n.wrapFn=i}function d(t,e,r){var n=t._events;if(!n)return[];var i=n[e];return i?"function"==typeof i?r?[i.listener||i]:[i]:r?function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(i):m(i,i.length):[]}function g(t){var e=this._events;if(e){var r=e[t];if("function"==typeof r)return 1;if(r)return r.length}return 0}function m(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}i?Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(t){if("number"!=typeof t||t<0||t!=t)throw new TypeError('"defaultMaxListeners" must be a positive number');a=t}}):n.defaultMaxListeners=a,n.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},n.prototype.getMaxListeners=function(){return c(this)},n.prototype.emit=function(t){var e,r,n,i,o,s,a="error"===t;if(s=this._events)a=a&&null==s.error;else if(!a)return!1;if(a){if(1<arguments.length&&(e=arguments[1]),e instanceof Error)throw e;var l=new Error('Unhandled "error" event. ('+e+")");throw l.context=e,l}if(!(r=s[t]))return!1;var u="function"==typeof r;switch(n=arguments.length){case 1:!function(t,e,r){if(e)t.call(r);else for(var n=t.length,i=m(t,n),o=0;o<n;++o)i[o].call(r)}(r,u,this);break;case 2:!function(t,e,r,n){if(e)t.call(r,n);else for(var i=t.length,o=m(t,i),s=0;s<i;++s)o[s].call(r,n)}(r,u,this,arguments[1]);break;case 3:!function(t,e,r,n,i){if(e)t.call(r,n,i);else for(var o=t.length,s=m(t,o),a=0;a<o;++a)s[a].call(r,n,i)}(r,u,this,arguments[1],arguments[2]);break;case 4:!function(t,e,r,n,i,o){if(e)t.call(r,n,i,o);else for(var s=t.length,a=m(t,s),l=0;l<s;++l)a[l].call(r,n,i,o)}(r,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(n-1),o=1;o<n;o++)i[o-1]=arguments[o];!function(t,e,r,n){if(e)t.apply(r,n);else for(var i=t.length,o=m(t,i),s=0;s<i;++s)o[s].apply(r,n)}(r,u,this,i)}return!0},n.prototype.on=n.prototype.addListener=function(t,e){return h(this,t,e,!1)},n.prototype.prependListener=function(t,e){return h(this,t,e,!0)},n.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,p(this,t,e)),this},n.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,p(this,t,e)),this},n.prototype.removeListener=function(t,e){var r,n,i,o,s;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=l(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(i=-1,o=r.length-1;0<=o;o--)if(r[o]===e||r[o].listener===e){s=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(t,e){for(var r=e,n=r+1,i=t.length;n<i;r+=1,n+=1)t[r]=t[n];t.pop()}(r,i),1===r.length&&(n[t]=r[0]),n.removeListener&&this.emit("removeListener",t,s||e)}return this},n.prototype.removeAllListeners=function(t){var e,r,n;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=l(null),this._eventsCount=0):r[t]&&(0==--this._eventsCount?this._events=l(null):delete r[t]),this;if(0===arguments.length){var i,o=s(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=l(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(e)for(n=e.length-1;0<=n;n--)this.removeListener(t,e[n]);return this},n.prototype.listeners=function(t){return d(this,t,!0)},n.prototype.rawListeners=function(t){return d(this,t,!1)},n.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):g.call(t,e)},n.prototype.listenerCount=g,n.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],14:[function(t,e,r){(function(t){function e(t){return Object.prototype.toString.call(t)}r.isArray=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===e(t)},r.isBoolean=function(t){return"boolean"==typeof t},r.isNull=function(t){return null===t},r.isNullOrUndefined=function(t){return null==t},r.isNumber=function(t){return"number"==typeof t},r.isString=function(t){return"string"==typeof t},r.isSymbol=function(t){return"symbol"==typeof t},r.isUndefined=function(t){return void 0===t},r.isRegExp=function(t){return"[object RegExp]"===e(t)},r.isObject=function(t){return"object"==typeof t&&null!==t},r.isDate=function(t){return"[object Date]"===e(t)},r.isError=function(t){return"[object Error]"===e(t)||t instanceof Error},r.isFunction=function(t){return"function"==typeof t},r.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},r.isBuffer=t.isBuffer}).call(this,{isBuffer:t("../../is-buffer/index.js")})},{"../../is-buffer/index.js":81}],15:[function(t,e,r){"use strict";var n,o=t("es5-ext/object/copy"),i=t("es5-ext/object/normalize-options"),s=t("es5-ext/object/valid-callable"),a=t("es5-ext/object/map"),l=t("es5-ext/object/valid-callable"),u=t("es5-ext/object/valid-value"),c=Function.prototype.bind,h=Object.defineProperty,f=Object.prototype.hasOwnProperty;n=function(t,e,r){var n,i=u(e)&&l(e.value);return delete(n=o(e)).writable,delete n.value,n.get=function(){return!r.overwriteDefinition&&f.call(this,t)?i:(e.value=c.call(i,r.resolveContext?r.resolveContext(this):this),h(this,t,e),this[t])},n},e.exports=function(t){var r=i(arguments[1]);return null!=r.resolveContext&&s(r.resolveContext),a(t,function(t,e){return n(e,t,r)})}},{"es5-ext/object/copy":39,"es5-ext/object/map":48,"es5-ext/object/normalize-options":49,"es5-ext/object/valid-callable":54,"es5-ext/object/valid-value":55}],16:[function(t,e,r){"use strict";var a=t("es5-ext/object/assign"),l=t("es5-ext/object/normalize-options"),u=t("es5-ext/object/is-callable"),c=t("es5-ext/string/#/contains");(e.exports=function(t,e){var r,n,i,o,s;return arguments.length<2||"string"!=typeof t?(o=e,e=t,t=null):o=arguments[2],null==t?(r=i=!0,n=!1):(r=c.call(t,"c"),n=c.call(t,"e"),i=c.call(t,"w")),s={value:e,configurable:r,enumerable:n,writable:i},o?a(l(o),s):s}).gs=function(t,e,r){var n,i,o,s;return"string"!=typeof t?(o=r,r=e,e=t,t=null):o=arguments[3],null==e?e=void 0:u(e)?null==r?r=void 0:u(r)||(o=r,r=void 0):(o=e,e=r=void 0),i=null==t?!(n=!0):(n=c.call(t,"c"),c.call(t,"e")),s={get:e,set:r,configurable:n,enumerable:i},o?a(l(o),s):s}},{"es5-ext/object/assign":36,"es5-ext/object/is-callable":42,"es5-ext/object/normalize-options":49,"es5-ext/string/#/contains":56}],17:[function(c,h,t){(function(i,t){var s=c("readable-stream"),a=c("end-of-stream"),e=c("inherits"),r=c("stream-shift"),n=t.from&&t.from!==Uint8Array.from?t.from([0]):new t([0]),o=function(t,e){t._corked?t.once("uncork",e):e()},l=function(n,i){return function(t){var e,r;t?(e=n,r="premature close"===t.message?null:t,e._autoDestroy&&e.destroy(r)):i&&!n._ended&&n.end()}},u=function(t,e,r){if(!(this instanceof u))return new u(t,e,r);s.Duplex.call(this,r),this._writable=null,this._readable=null,this._readable2=null,this._autoDestroy=!r||!1!==r.autoDestroy,this._forwardDestroy=!r||!1!==r.destroy,this._forwardEnd=!r||!1!==r.end,this._corked=1,this._ondrain=null,this._drained=!1,this._forwarding=!1,this._unwrite=null,this._unread=null,this._ended=!1,this.destroyed=!1,t&&this.setWritable(t),e&&this.setReadable(e)};e(u,s.Duplex),u.obj=function(t,e,r){return r||(r={}),r.objectMode=!0,r.highWaterMark=16,new u(t,e,r)},u.prototype.cork=function(){1==++this._corked&&this.emit("cork")},u.prototype.uncork=function(){this._corked&&0==--this._corked&&this.emit("uncork")},u.prototype.setWritable=function(t){if(this._unwrite&&this._unwrite(),this.destroyed)t&&t.destroy&&t.destroy();else if(null!==t&&!1!==t){var e=this,r=a(t,{writable:!0,readable:!1},l(this,this._forwardEnd)),n=function(){var t=e._ondrain;e._ondrain=null,t&&t()};this._unwrite&&i.nextTick(n),this._writable=t,this._writable.on("drain",n),this._unwrite=function(){e._writable.removeListener("drain",n),r()},this.uncork()}else this.end()},u.prototype.setReadable=function(t){if(this._unread&&this._unread(),this.destroyed)t&&t.destroy&&t.destroy();else{if(null===t||!1===t)return this.push(null),void this.resume();var e,r=this,n=a(t,{writable:!1,readable:!0},l(this)),i=function(){r._forward()},o=function(){r.push(null)};this._drained=!0,this._readable=t,this._readable2=t._readableState?t:(e=t,new s.Readable({objectMode:!0,highWaterMark:16}).wrap(e)),this._readable2.on("readable",i),this._readable2.on("end",o),this._unread=function(){r._readable2.removeListener("readable",i),r._readable2.removeListener("end",o),n()},this._forward()}},u.prototype._read=function(){this._drained=!0,this._forward()},u.prototype._forward=function(){if(!this._forwarding&&this._readable2&&this._drained){var t;for(this._forwarding=!0;this._drained&&null!==(t=r(this._readable2));)this.destroyed||(this._drained=this.push(t));this._forwarding=!1}},u.prototype.destroy=function(t){if(!this.destroyed){this.destroyed=!0;var e=this;i.nextTick(function(){e._destroy(t)})}},u.prototype._destroy=function(t){if(t){var e=this._ondrain;this._ondrain=null,e?e(t):this.emit("error",t)}this._forwardDestroy&&(this._readable&&this._readable.destroy&&this._readable.destroy(),this._writable&&this._writable.destroy&&this._writable.destroy()),this.emit("close")},u.prototype._write=function(t,e,r){return this.destroyed?r():this._corked?o(this,this._write.bind(this,t,e,r)):t===n?this._finish(r):this._writable?void(!1===this._writable.write(t)?this._ondrain=r:r()):r()},u.prototype._finish=function(r){var n=this;this.emit("preend"),o(this,function(){var t,e;t=n._forwardEnd&&n._writable,e=function(){!1===n._writableState.prefinished&&(n._writableState.prefinished=!0),n.emit("prefinish"),o(n,r)},t?t._writableState&&t._writableState.finished?e():t._writableState?t.end(e):(t.end(),e()):e()})},u.prototype.end=function(t,e,r){return"function"==typeof t?this.end(null,null,t):"function"==typeof e?this.end(t,null,e):(this._ended=!0,t&&this.write(t),this._writableState.ending||this.write(n),s.Writable.prototype.end.call(this,r))},h.exports=u}).call(this,c("_process"),c("buffer").Buffer)},{_process:92,buffer:12,"end-of-stream":18,inherits:80,"readable-stream":108,"stream-shift":111}],18:[function(t,e,r){var m=t("once"),v=function(){},y=function(e,t,r){if("function"==typeof t)return y(e,null,t);t||(t={}),r=m(r||v);var n,i,o=e._writableState,s=e._readableState,a=t.readable||!1!==t.readable&&e.readable,l=t.writable||!1!==t.writable&&e.writable,u=function(){e.writable||c()},c=function(){l=!1,a||r.call(e)},h=function(){a=!1,l||r.call(e)},f=function(t){r.call(e,t?new Error("exited with error code: "+t):null)},p=function(t){r.call(e,t)},d=function(){return(!a||s&&s.ended)&&(!l||o&&o.ended)?void 0:r.call(e,new Error("premature close"))},g=function(){e.req.on("finish",c)};return(n=e).setHeader&&"function"==typeof n.abort?(e.on("complete",c),e.on("abort",d),e.req?g():e.on("request",g)):l&&!o&&(e.on("end",u),e.on("close",u)),(i=e).stdio&&Array.isArray(i.stdio)&&3===i.stdio.length&&e.on("exit",f),e.on("end",h),e.on("finish",c),!1!==t.error&&e.on("error",p),e.on("close",d),function(){e.removeListener("complete",c),e.removeListener("abort",d),e.removeListener("request",g),e.req&&e.req.removeListener("finish",c),e.removeListener("end",u),e.removeListener("close",u),e.removeListener("finish",c),e.removeListener("exit",f),e.removeListener("end",h),e.removeListener("error",p),e.removeListener("close",d)}};e.exports=y},{once:90}],19:[function(t,e,r){"use strict";var n=t("../../object/valid-value");e.exports=function(){return n(this).length=0,this}},{"../../object/valid-value":55}],20:[function(t,e,r){"use strict";var o=t("../../number/is-nan"),s=t("../../number/to-pos-integer"),a=t("../../object/valid-value"),l=Array.prototype.indexOf,u=Object.prototype.hasOwnProperty,c=Math.abs,h=Math.floor;e.exports=function(t){var e,r,n,i;if(!o(t))return l.apply(this,arguments);for(r=s(a(this).length),n=arguments[1],e=n=isNaN(n)?0:0<=n?h(n):s(this.length)-h(c(n));e<r;++e)if(u.call(this,e)&&(i=this[e],o(i)))return e;return-1}},{"../../number/is-nan":30,"../../number/to-pos-integer":34,"../../object/valid-value":55}],21:[function(t,e,r){"use strict";e.exports=t("./is-implemented")()?Array.from:t("./shim")},{"./is-implemented":22,"./shim":23}],22:[function(t,e,r){"use strict";e.exports=function(){var t,e,r=Array.from;return"function"==typeof r&&(e=r(t=["raz","dwa"]),Boolean(e&&e!==t&&"dwa"===e[1]))}},{}],23:[function(t,e,r){"use strict";var p=t("es6-symbol").iterator,d=t("../../function/is-arguments"),g=t("../../function/is-function"),m=t("../../number/to-pos-integer"),v=t("../../object/valid-callable"),y=t("../../object/valid-value"),b=t("../../object/is-value"),w=t("../../string/is-string"),E=Array.isArray,_=Function.prototype.call,S={configurable:!0,enumerable:!0,writable:!0,value:null},T=Object.defineProperty;e.exports=function(t){var e,r,n,i,o,s,a,l,u,c,h=arguments[1],f=arguments[2];if(t=Object(y(t)),b(h)&&v(h),this&&this!==Array&&g(this))e=this;else{if(!h){if(d(t))return 1!==(o=t.length)?Array.apply(null,t):((i=new Array(1))[0]=t[0],i);if(E(t)){for(i=new Array(o=t.length),r=0;r<o;++r)i[r]=t[r];return i}}i=[]}if(!E(t))if(void 0!==(u=t[p])){for(a=v(u).call(t),e&&(i=new e),l=a.next(),r=0;!l.done;)c=h?_.call(h,f,l.value,r):l.value,e?(S.value=c,T(i,r,S)):i[r]=c,l=a.next(),++r;o=r}else if(w(t)){for(o=t.length,e&&(i=new e),n=r=0;r<o;++r)c=t[r],r+1<o&&55296<=(s=c.charCodeAt(0))&&s<=56319&&(c+=t[++r]),c=h?_.call(h,f,c,n):c,e?(S.value=c,T(i,n,S)):i[n]=c,++n;o=n}if(void 0===o)for(o=m(t.length),e&&(i=new e(o)),r=0;r<o;++r)c=h?_.call(h,f,t[r],r):t[r],e?(S.value=c,T(i,r,S)):i[r]=c;return e&&(S.value=null,i.length=o),i}},{"../../function/is-arguments":24,"../../function/is-function":25,"../../number/to-pos-integer":34,"../../object/is-value":44,"../../object/valid-callable":54,"../../object/valid-value":55,"../../string/is-string":59,"es6-symbol":73}],24:[function(t,e,r){"use strict";var n=Object.prototype.toString,i=n.call(function(){return arguments}());e.exports=function(t){return n.call(t)===i}},{}],25:[function(t,e,r){"use strict";var n=Object.prototype.toString,i=n.call(t("./noop"));e.exports=function(t){return"function"==typeof t&&n.call(t)===i}},{"./noop":26}],26:[function(t,e,r){"use strict";e.exports=function(){}},{}],27:[function(t,e,r){"use strict";e.exports=t("./is-implemented")()?Math.sign:t("./shim")},{"./is-implemented":28,"./shim":29}],28:[function(t,e,r){"use strict";e.exports=function(){var t=Math.sign;return"function"==typeof t&&(1===t(10)&&-1===t(-20))}},{}],29:[function(t,e,r){"use strict";e.exports=function(t){return t=Number(t),isNaN(t)||0===t?t:0<t?1:-1}},{}],30:[function(t,e,r){"use strict";e.exports=t("./is-implemented")()?Number.isNaN:t("./shim")},{"./is-implemented":31,"./shim":32}],31:[function(t,e,r){"use strict";e.exports=function(){var t=Number.isNaN;return"function"==typeof t&&(!t({})&&t(NaN)&&!t(34))}},{}],32:[function(t,e,r){"use strict";e.exports=function(t){return t!=t}},{}],33:[function(t,e,r){"use strict";var n=t("../math/sign"),i=Math.abs,o=Math.floor;e.exports=function(t){return isNaN(t)?0:0!==(t=Number(t))&&isFinite(t)?n(t)*o(i(t)):t}},{"../math/sign":27}],34:[function(t,e,r){"use strict";var n=t("./to-integer"),i=Math.max;e.exports=function(t){return i(0,n(t))}},{"./to-integer":33}],35:[function(t,e,r){"use strict";var a=t("./valid-callable"),l=t("./valid-value"),u=Function.prototype.bind,c=Function.prototype.call,h=Object.keys,f=Object.prototype.propertyIsEnumerable;e.exports=function(o,s){return function(r,n){var t,i=arguments[2],e=arguments[3];return r=Object(l(r)),a(n),t=h(r),e&&t.sort("function"==typeof e?u.call(e,r):void 0),"function"!=typeof o&&(o=t[o]),c.call(o,t,function(t,e){return f.call(r,t)?c.call(n,i,r[t],t,r,e):s})}}},{"./valid-callable":54,"./valid-value":55}],36:[function(t,e,r){"use strict";e.exports=t("./is-implemented")()?Object.assign:t("./shim")},{"./is-implemented":37,"./shim":38}],37:[function(t,e,r){"use strict";e.exports=function(){var t,e=Object.assign;return"function"==typeof e&&(e(t={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}},{}],38:[function(t,e,r){"use strict";var s=t("../keys"),a=t("../valid-value"),l=Math.max;e.exports=function(e,r){var n,t,i,o=l(arguments.length,2);for(e=Object(a(e)),i=function(t){try{e[t]=r[t]}catch(t){n||(n=t)}},t=1;t<o;++t)r=arguments[t],s(r).forEach(i);if(void 0!==n)throw n;return e}},{"../keys":45,"../valid-value":55}],39:[function(t,e,r){"use strict";var o=t("../array/from"),s=t("./assign"),a=t("./valid-value");e.exports=function(e){var t=Object(a(e)),r=arguments[1],n=Object(arguments[2]);if(t!==e&&!r)return t;var i={};return r?o(r,function(t){(n.ensure||t in e)&&(i[t]=e[t])}):s(i,e),i}},{"../array/from":21,"./assign":36,"./valid-value":55}],40:[function(t,e,r){"use strict";var n,i,o,s,a=Object.create;t("./set-prototype-of/is-implemented")()||(n=t("./set-prototype-of/shim")),e.exports=n?1!==n.level?a:(s={configurable:(o={},!1),enumerable:(i={},!1),writable:!0,value:void 0},Object.getOwnPropertyNames(Object.prototype).forEach(function(t){o[t]="__proto__"!==t?s:{configurable:!0,enumerable:!1,writable:!0,value:void 0}}),Object.defineProperties(i,o),Object.defineProperty(n,"nullPolyfill",{configurable:!1,enumerable:!1,writable:!1,value:i}),function(t,e){return a(null===t?i:t,e)}):a},{"./set-prototype-of/is-implemented":52,"./set-prototype-of/shim":53}],41:[function(t,e,r){"use strict";e.exports=t("./_iterate")("forEach")},{"./_iterate":35}],42:[function(t,e,r){"use strict";e.exports=function(t){return"function"==typeof t}},{}],43:[function(t,e,r){"use strict";var n=t("./is-value"),i={function:!0,object:!0};e.exports=function(t){return n(t)&&i[typeof t]||!1}},{"./is-value":44}],44:[function(t,e,r){"use strict";var n=t("../function/noop")();e.exports=function(t){return t!==n&&null!==t}},{"../function/noop":26}],45:[function(t,e,r){"use strict";e.exports=t("./is-implemented")()?Object.keys:t("./shim")},{"./is-implemented":46,"./shim":47}],46:[function(t,e,r){"use strict";e.exports=function(){try{return Object.keys("primitive"),!0}catch(t){return!1}}},{}],47:[function(t,e,r){"use strict";var n=t("../is-value"),i=Object.keys;e.exports=function(t){return i(n(t)?Object(t):t)}},{"../is-value":44}],48:[function(t,e,r){"use strict";var n=t("./valid-callable"),a=t("./for-each"),l=Function.prototype.call;e.exports=function(t,i){var o={},s=arguments[2];return n(i),a(t,function(t,e,r,n){o[e]=l.call(i,s,t,e,r,n)}),o}},{"./for-each":41,"./valid-callable":54}],49:[function(t,e,r){"use strict";var n=t("./is-value"),i=Array.prototype.forEach,o=Object.create;e.exports=function(t){var e=o(null);return i.call(arguments,function(t){n(t)&&function(t,e){var r;for(r in t)e[r]=t[r]}(Object(t),e)}),e}},{"./is-value":44}],50:[function(t,e,r){"use strict";var n=Array.prototype.forEach,i=Object.create;e.exports=function(t){var e=i(null);return n.call(arguments,function(t){e[t]=!0}),e}},{}],51:[function(t,e,r){"use strict";e.exports=t("./is-implemented")()?Object.setPrototypeOf:t("./shim")},{"./is-implemented":52,"./shim":53}],52:[function(t,e,r){"use strict";var n=Object.create,i=Object.getPrototypeOf,o={};e.exports=function(){var t=Object.setPrototypeOf,e=arguments[0]||n;return"function"==typeof t&&i(t(e(null),o))===o}},{}],53:[function(t,e,r){"use strict";var i,n,o,s,a=t("../is-object"),l=t("../valid-value"),u=Object.prototype.isPrototypeOf,c=Object.defineProperty,h={configurable:!0,enumerable:!1,writable:!0,value:void 0};i=function(t,e){if(l(t),null===e||a(e))return t;throw new TypeError("Prototype must be null or an object")},e.exports=(n=function(){var t,e=Object.create(null),r={},n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__");if(n){try{(t=n.set).call(e,r)}catch(t){}if(Object.getPrototypeOf(e)===r)return{set:t,level:2}}return e.__proto__=r,Object.getPrototypeOf(e)===r?{level:2}:((e={}).__proto__=r,Object.getPrototypeOf(e)===r&&{level:1})}())?(o=2===n.level?n.set?(s=n.set,function(t,e){return s.call(i(t,e),e),t}):function(t,e){return i(t,e).__proto__=e,t}:function t(e,r){var n;return i(e,r),(n=u.call(t.nullPolyfill,e))&&delete t.nullPolyfill.__proto__,null===r&&(r=t.nullPolyfill),e.__proto__=r,n&&c(t.nullPolyfill,"__proto__",h),e},Object.defineProperty(o,"level",{configurable:!1,enumerable:!1,writable:!1,value:n.level})):null,t("../create")},{"../create":40,"../is-object":43,"../valid-value":55}],54:[function(t,e,r){"use strict";e.exports=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");return t}},{}],55:[function(t,e,r){"use strict";var n=t("./is-value");e.exports=function(t){if(!n(t))throw new TypeError("Cannot use null or undefined");return t}},{"./is-value":44}],56:[function(t,e,r){"use strict";e.exports=t("./is-implemented")()?String.prototype.contains:t("./shim")},{"./is-implemented":57,"./shim":58}],57:[function(t,e,r){"use strict";var n="razdwatrzy";e.exports=function(){return"function"==typeof n.contains&&(!0===n.contains("dwa")&&!1===n.contains("foo"))}},{}],58:[function(t,e,r){"use strict";var n=String.prototype.indexOf;e.exports=function(t){return-1<n.call(this,t,arguments[1])}},{}],59:[function(t,e,r){"use strict";var n=Object.prototype.toString,i=n.call("");e.exports=function(t){return"string"==typeof t||t&&"object"==typeof t&&(t instanceof String||n.call(t)===i)||!1}},{}],60:[function(t,e,r){"use strict";var n,i=t("es5-ext/object/set-prototype-of"),o=t("es5-ext/string/#/contains"),s=t("d"),a=t("es6-symbol"),l=t("./"),u=Object.defineProperty;n=e.exports=function(t,e){if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");l.call(this,t),e=e?o.call(e,"key+value")?"key+value":o.call(e,"key")?"key":"value":"value",u(this,"__kind__",s("",e))},i&&i(n,l),delete n.prototype.constructor,n.prototype=Object.create(l.prototype,{_resolve:s(function(t){return"value"===this.__kind__?this.__list__[t]:"key+value"===this.__kind__?[t,this.__list__[t]]:t})}),u(n.prototype,a.toStringTag,s("c","Array Iterator"))},{"./":63,d:16,"es5-ext/object/set-prototype-of":51,"es5-ext/string/#/contains":56,"es6-symbol":73}],61:[function(t,e,r){"use strict";var h=t("es5-ext/function/is-arguments"),f=t("es5-ext/object/valid-callable"),p=t("es5-ext/string/is-string"),d=t("./get"),g=Array.isArray,m=Function.prototype.call,v=Array.prototype.some;e.exports=function(t,e){var r,n,i,o,s,a,l,u,c=arguments[2];if(g(t)||h(t)?r="array":p(t)?r="string":t=d(t),f(e),i=function(){o=!0},"array"!==r)if("string"!==r)for(n=t.next();!n.done;){if(m.call(e,c,n.value,i),o)return;n=t.next()}else for(a=t.length,s=0;s<a&&(l=t[s],s+1<a&&55296<=(u=l.charCodeAt(0))&&u<=56319&&(l+=t[++s]),m.call(e,c,l,i),!o);++s);else v.call(t,function(t){return m.call(e,c,t,i),o})}},{"./get":62,"es5-ext/function/is-arguments":24,"es5-ext/object/valid-callable":54,"es5-ext/string/is-string":59}],62:[function(t,e,r){"use strict";var n=t("es5-ext/function/is-arguments"),i=t("es5-ext/string/is-string"),o=t("./array"),s=t("./string"),a=t("./valid-iterable"),l=t("es6-symbol").iterator;e.exports=function(t){return"function"==typeof a(t)[l]?t[l]():n(t)?new o(t):i(t)?new s(t):new o(t)}},{"./array":60,"./string":65,"./valid-iterable":66,"es5-ext/function/is-arguments":24,"es5-ext/string/is-string":59,"es6-symbol":73}],63:[function(t,e,r){"use strict";var n,i=t("es5-ext/array/#/clear"),o=t("es5-ext/object/assign"),s=t("es5-ext/object/valid-callable"),a=t("es5-ext/object/valid-value"),l=t("d"),u=t("d/auto-bind"),c=t("es6-symbol"),h=Object.defineProperty,f=Object.defineProperties;e.exports=n=function(t,e){if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");f(this,{__list__:l("w",a(t)),__context__:l("w",e),__nextIndex__:l("w",0)}),e&&(s(e.on),e.on("_add",this._onAdd),e.on("_delete",this._onDelete),e.on("_clear",this._onClear))},delete n.prototype.constructor,f(n.prototype,o({_next:l(function(){var t;if(this.__list__)return this.__redo__&&void 0!==(t=this.__redo__.shift())?t:this.__nextIndex__<this.__list__.length?this.__nextIndex__++:void this._unBind()}),next:l(function(){return this._createResult(this._next())}),_createResult:l(function(t){return void 0===t?{done:!0,value:void 0}:{done:!1,value:this._resolve(t)}}),_resolve:l(function(t){return this.__list__[t]}),_unBind:l(function(){this.__list__=null,delete this.__redo__,this.__context__&&(this.__context__.off("_add",this._onAdd),this.__context__.off("_delete",this._onDelete),this.__context__.off("_clear",this._onClear),this.__context__=null)}),toString:l(function(){return"[object "+(this[c.toStringTag]||"Object")+"]"})},u({_onAdd:l(function(r){r>=this.__nextIndex__||(++this.__nextIndex__,this.__redo__?(this.__redo__.forEach(function(t,e){r<=t&&(this.__redo__[e]=++t)},this),this.__redo__.push(r)):h(this,"__redo__",l("c",[r])))}),_onDelete:l(function(r){var t;r>=this.__nextIndex__||(--this.__nextIndex__,this.__redo__&&(-1!==(t=this.__redo__.indexOf(r))&&this.__redo__.splice(t,1),this.__redo__.forEach(function(t,e){r<t&&(this.__redo__[e]=--t)},this)))}),_onClear:l(function(){this.__redo__&&i.call(this.__redo__),this.__nextIndex__=0})}))),h(n.prototype,c.iterator,l(function(){return this}))},{d:16,"d/auto-bind":15,"es5-ext/array/#/clear":19,"es5-ext/object/assign":36,"es5-ext/object/valid-callable":54,"es5-ext/object/valid-value":55,"es6-symbol":73}],64:[function(t,e,r){"use strict";var n=t("es5-ext/function/is-arguments"),i=t("es5-ext/object/is-value"),o=t("es5-ext/string/is-string"),s=t("es6-symbol").iterator,a=Array.isArray;e.exports=function(t){return!!i(t)&&(!!a(t)||(!!o(t)||(!!n(t)||"function"==typeof t[s])))}},{"es5-ext/function/is-arguments":24,"es5-ext/object/is-value":44,"es5-ext/string/is-string":59,"es6-symbol":73}],65:[function(t,e,r){"use strict";var n,i=t("es5-ext/object/set-prototype-of"),o=t("d"),s=t("es6-symbol"),a=t("./"),l=Object.defineProperty;n=e.exports=function(t){if(!(this instanceof n))throw new TypeError("Constructor requires 'new'");t=String(t),a.call(this,t),l(this,"__length__",o("",t.length))},i&&i(n,a),delete n.prototype.constructor,n.prototype=Object.create(a.prototype,{_next:o(function(){if(this.__list__)return this.__nextIndex__<this.__length__?this.__nextIndex__++:void this._unBind()}),_resolve:o(function(t){var e,r=this.__list__[t];return this.__nextIndex__===this.__length__?r:55296<=(e=r.charCodeAt(0))&&e<=56319?r+this.__list__[this.__nextIndex__++]:r})}),l(n.prototype,s.toStringTag,o("c","String Iterator"))},{"./":63,d:16,"es5-ext/object/set-prototype-of":51,"es6-symbol":73}],66:[function(t,e,r){"use strict";var n=t("./is-iterable");e.exports=function(t){if(!n(t))throw new TypeError(t+" is not iterable");return t}},{"./is-iterable":64}],67:[function(t,e,r){"use strict";e.exports=t("./is-implemented")()?Map:t("./polyfill")},{"./is-implemented":68,"./polyfill":72}],68:[function(t,e,r){"use strict";e.exports=function(){var t,e;if("function"!=typeof Map)return!1;try{t=new Map([["raz","one"],["dwa","two"],["trzy","three"]])}catch(t){return!1}return"[object Map]"===String(t)&&(3===t.size&&("function"==typeof t.clear&&("function"==typeof t.delete&&("function"==typeof t.entries&&("function"==typeof t.forEach&&("function"==typeof t.get&&("function"==typeof t.has&&("function"==typeof t.keys&&("function"==typeof t.set&&("function"==typeof t.values&&(!1===(e=t.entries().next()).done&&(!!e.value&&("raz"===e.value[0]&&"one"===e.value[1])))))))))))))}},{}],69:[function(t,e,r){"use strict";e.exports="undefined"!=typeof Map&&"[object Map]"===Object.prototype.toString.call(new Map)},{}],70:[function(t,e,r){"use strict";e.exports=t("es5-ext/object/primitive-set")("key","value","key+value")},{"es5-ext/object/primitive-set":50}],71:[function(t,e,r){"use strict";var n,i=t("es5-ext/object/set-prototype-of"),o=t("d"),s=t("es6-iterator"),a=t("es6-symbol").toStringTag,l=t("./iterator-kinds"),u=Object.defineProperties,c=s.prototype._unBind;n=e.exports=function(t,e){if(!(this instanceof n))return new n(t,e);s.call(this,t.__mapKeysData__,t),e&&l[e]||(e="key+value"),u(this,{__kind__:o("",e),__values__:o("w",t.__mapValuesData__)})},i&&i(n,s),n.prototype=Object.create(s.prototype,{constructor:o(n),_resolve:o(function(t){return"value"===this.__kind__?this.__values__[t]:"key"===this.__kind__?this.__list__[t]:[this.__list__[t],this.__values__[t]]}),_unBind:o(function(){this.__values__=null,c.call(this)}),toString:o(function(){return"[object Map Iterator]"})}),Object.defineProperty(n.prototype,a,o("c","Map Iterator"))},{"./iterator-kinds":70,d:16,"es5-ext/object/set-prototype-of":51,"es6-iterator":63,"es6-symbol":73}],72:[function(t,e,r){"use strict";var i,n=t("es5-ext/array/#/clear"),o=t("es5-ext/array/#/e-index-of"),s=t("es5-ext/object/set-prototype-of"),a=t("es5-ext/object/valid-callable"),l=t("es5-ext/object/valid-value"),u=t("d"),c=t("event-emitter"),h=t("es6-symbol"),f=t("es6-iterator/valid-iterable"),p=t("es6-iterator/for-of"),d=t("./lib/iterator"),g=t("./is-native-implemented"),m=Function.prototype.call,v=Object.defineProperties,y=Object.getPrototypeOf;e.exports=i=function(){var r,n,t,e=arguments[0];if(!(this instanceof i))throw new TypeError("Constructor requires 'new'");return t=g&&s&&Map!==i?s(new Map,y(this)):this,null!=e&&f(e),v(t,{__mapKeysData__:u("c",r=[]),__mapValuesData__:u("c",n=[])}),e&&p(e,function(t){var e=l(t)[0];t=t[1],-1===o.call(r,e)&&(r.push(e),n.push(t))},t),t},g&&(s&&s(i,Map),i.prototype=Object.create(Map.prototype,{constructor:u(i)})),c(v(i.prototype,{clear:u(function(){this.__mapKeysData__.length&&(n.call(this.__mapKeysData__),n.call(this.__mapValuesData__),this.emit("_clear"))}),delete:u(function(t){var e=o.call(this.__mapKeysData__,t);return-1!==e&&(this.__mapKeysData__.splice(e,1),this.__mapValuesData__.splice(e,1),this.emit("_delete",e,t),!0)}),entries:u(function(){return new d(this,"key+value")}),forEach:u(function(t){var e,r,n=arguments[1];for(a(t),r=(e=this.entries())._next();void 0!==r;)m.call(t,n,this.__mapValuesData__[r],this.__mapKeysData__[r],this),r=e._next()}),get:u(function(t){var e=o.call(this.__mapKeysData__,t);if(-1!==e)return this.__mapValuesData__[e]}),has:u(function(t){return-1!==o.call(this.__mapKeysData__,t)}),keys:u(function(){return new d(this,"key")}),set:u(function(t,e){var r,n=o.call(this.__mapKeysData__,t);return-1===n&&(n=this.__mapKeysData__.push(t)-1,r=!0),this.__mapValuesData__[n]=e,r&&this.emit("_add",n,t),this}),size:u.gs(function(){return this.__mapKeysData__.length}),values:u(function(){return new d(this,"value")}),toString:u(function(){return"[object Map]"})})),Object.defineProperty(i.prototype,h.iterator,u(function(){return this.entries()})),Object.defineProperty(i.prototype,h.toStringTag,u("c","Map"))},{"./is-native-implemented":69,"./lib/iterator":71,d:16,"es5-ext/array/#/clear":19,"es5-ext/array/#/e-index-of":20,"es5-ext/object/set-prototype-of":51,"es5-ext/object/valid-callable":54,"es5-ext/object/valid-value":55,"es6-iterator/for-of":61,"es6-iterator/valid-iterable":66,"es6-symbol":73,"event-emitter":78}],73:[function(t,e,r){"use strict";e.exports=t("./is-implemented")()?Symbol:t("./polyfill")},{"./is-implemented":74,"./polyfill":76}],74:[function(t,e,r){"use strict";var n={object:!0,symbol:!0};e.exports=function(){var t;if("function"!=typeof Symbol)return!1;t=Symbol("test symbol");try{String(t)}catch(t){return!1}return!!n[typeof Symbol.iterator]&&(!!n[typeof Symbol.toPrimitive]&&!!n[typeof Symbol.toStringTag])}},{}],75:[function(t,e,r){"use strict";e.exports=function(t){return!!t&&("symbol"==typeof t||!!t.constructor&&("Symbol"===t.constructor.name&&"Symbol"===t[t.constructor.toStringTag]))}},{}],76:[function(t,e,r){"use strict";var n,i,o,s,a=t("d"),l=t("./validate-symbol"),u=Object.create,c=Object.defineProperties,h=Object.defineProperty,f=Object.prototype,p=u(null);if("function"==typeof Symbol){n=Symbol;try{String(n()),s=!0}catch(t){}}var d,g=(d=u(null),function(t){for(var e,r,n=0;d[t+(n||"")];)++n;return d[t+=n||""]=!0,h(f,e="@@"+t,a.gs(null,function(t){r||(r=!0,h(this,e,a(t)),r=!1)})),e});o=function(t){if(this instanceof o)throw new TypeError("Symbol is not a constructor");return i(t)},e.exports=i=function t(e){var r;if(this instanceof t)throw new TypeError("Symbol is not a constructor");return s?n(e):(r=u(o.prototype),e=void 0===e?"":String(e),c(r,{__description__:a("",e),__name__:a("",g(e))}))},c(i,{for:a(function(t){return p[t]?p[t]:p[t]=i(String(t))}),keyFor:a(function(t){var e;for(e in l(t),p)if(p[e]===t)return e}),hasInstance:a("",n&&n.hasInstance||i("hasInstance")),isConcatSpreadable:a("",n&&n.isConcatSpreadable||i("isConcatSpreadable")),iterator:a("",n&&n.iterator||i("iterator")),match:a("",n&&n.match||i("match")),replace:a("",n&&n.replace||i("replace")),search:a("",n&&n.search||i("search")),species:a("",n&&n.species||i("species")),split:a("",n&&n.split||i("split")),toPrimitive:a("",n&&n.toPrimitive||i("toPrimitive")),toStringTag:a("",n&&n.toStringTag||i("toStringTag")),unscopables:a("",n&&n.unscopables||i("unscopables"))}),c(o.prototype,{constructor:a(i),toString:a("",function(){return this.__name__})}),c(i.prototype,{toString:a(function(){return"Symbol ("+l(this).__description__+")"}),valueOf:a(function(){return l(this)})}),h(i.prototype,i.toPrimitive,a("",function(){var t=l(this);return"symbol"==typeof t?t:t.toString()})),h(i.prototype,i.toStringTag,a("c","Symbol")),h(o.prototype,i.toStringTag,a("c",i.prototype[i.toStringTag])),h(o.prototype,i.toPrimitive,a("c",i.prototype[i.toPrimitive]))},{"./validate-symbol":77,d:16}],77:[function(t,e,r){"use strict";var n=t("./is-symbol");e.exports=function(t){if(!n(t))throw new TypeError(t+" is not a symbol");return t}},{"./is-symbol":75}],78:[function(t,e,r){"use strict";var i,n,o,s,a,l,u,c=t("d"),h=t("es5-ext/object/valid-callable"),f=Function.prototype.apply,p=Function.prototype.call,d=Object.create,g=Object.defineProperty,m=Object.defineProperties,v=Object.prototype.hasOwnProperty,y={configurable:!0,enumerable:!1,writable:!0};n=function(t,e){var r,n;return h(e),i.call(n=this,t,r=function(){o.call(n,t,r),f.call(e,this,arguments)}),r.__eeOnceListener__=e,this},a={on:i=function(t,e){var r;return h(e),v.call(this,"__ee__")?r=this.__ee__:(r=y.value=d(null),g(this,"__ee__",y),y.value=null),r[t]?"object"==typeof r[t]?r[t].push(e):r[t]=[r[t],e]:r[t]=e,this},once:n,off:o=function(t,e){var r,n,i,o;if(h(e),!v.call(this,"__ee__"))return this;if(!(r=this.__ee__)[t])return this;if("object"==typeof(n=r[t]))for(o=0;i=n[o];++o)i!==e&&i.__eeOnceListener__!==e||(2===n.length?r[t]=n[o?0:1]:n.splice(o,1));else n!==e&&n.__eeOnceListener__!==e||delete r[t];return this},emit:s=function(t){var e,r,n,i,o;if(v.call(this,"__ee__")&&(i=this.__ee__[t]))if("object"==typeof i){for(r=arguments.length,o=new Array(r-1),e=1;e<r;++e)o[e-1]=arguments[e];for(i=i.slice(),e=0;n=i[e];++e)f.call(n,this,o)}else switch(arguments.length){case 1:p.call(i,this);break;case 2:p.call(i,this,arguments[1]);break;case 3:p.call(i,this,arguments[1],arguments[2]);break;default:for(r=arguments.length,o=new Array(r-1),e=1;e<r;++e)o[e-1]=arguments[e];f.call(i,this,o)}}},l={on:c(i),once:c(n),off:c(o),emit:c(s)},u=m({},l),e.exports=r=function(t){return null==t?d(u):m(Object(t),l)},r.methods=a},{d:16,"es5-ext/object/valid-callable":54}],79:[function(t,e,r){r.read=function(t,e,r,n,i){var o,s,a=8*i-n-1,l=(1<<a)-1,u=l>>1,c=-7,h=r?i-1:0,f=r?-1:1,p=t[e+h];for(h+=f,o=p&(1<<-c)-1,p>>=-c,c+=a;0<c;o=256*o+t[e+h],h+=f,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=n;0<c;s=256*s+t[e+h],h+=f,c-=8);if(0===o)o=1-u;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=u}return(p?-1:1)*s*Math.pow(2,o-n)},r.write=function(t,e,r,n,i,o){var s,a,l,u=8*o-i-1,c=(1<<u)-1,h=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,d=n?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=c):(s=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-s))<1&&(s--,l*=2),2<=(e+=1<=s+h?f/l:f*Math.pow(2,1-h))*l&&(s++,l/=2),c<=s+h?(a=0,s=c):1<=s+h?(a=(e*l-1)*Math.pow(2,i),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),s=0));8<=i;t[r+p]=255&a,p+=d,a/=256,i-=8);for(s=s<<i|a,u+=i;0<u;t[r+p]=255&s,p+=d,s/=256,u-=8);t[r+p-d]|=128*g}},{}],80:[function(t,e,r){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}},{}],81:[function(t,e,r){function n(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}e.exports=function(t){return null!=t&&(n(t)||"function"==typeof(e=t).readFloatLE&&"function"==typeof e.slice&&n(e.slice(0,0))||!!t._isBuffer);var e}},{}],82:[function(t,e,r){"use strict";var o=t("safe-buffer").Buffer,s=e.exports;for(var n in s.types={0:"reserved",1:"connect",2:"connack",3:"publish",4:"puback",5:"pubrec",6:"pubrel",7:"pubcomp",8:"subscribe",9:"suback",10:"unsubscribe",11:"unsuback",12:"pingreq",13:"pingresp",14:"disconnect",15:"auth"},s.codes={},s.types){var i=s.types[n];s.codes[i]=n}for(var a in s.CMD_SHIFT=4,s.CMD_MASK=240,s.DUP_MASK=8,s.QOS_MASK=3,s.QOS_SHIFT=1,s.RETAIN_MASK=1,s.LENGTH_MASK=127,s.LENGTH_FIN_MASK=128,s.SESSIONPRESENT_MASK=1,s.SESSIONPRESENT_HEADER=o.from([s.SESSIONPRESENT_MASK]),s.CONNACK_HEADER=o.from([s.codes.connack<<s.CMD_SHIFT]),s.USERNAME_MASK=128,s.PASSWORD_MASK=64,s.WILL_RETAIN_MASK=32,s.WILL_QOS_MASK=24,s.WILL_QOS_SHIFT=3,s.WILL_FLAG_MASK=4,s.CLEAN_SESSION_MASK=2,s.CONNECT_HEADER=o.from([s.codes.connect<<s.CMD_SHIFT]),s.properties={sessionExpiryInterval:17,willDelayInterval:24,receiveMaximum:33,maximumPacketSize:39,topicAliasMaximum:34,requestResponseInformation:25,requestProblemInformation:23,userProperties:38,authenticationMethod:21,authenticationData:22,payloadFormatIndicator:1,messageExpiryInterval:2,contentType:3,responseTopic:8,correlationData:9,maximumQoS:36,retainAvailable:37,assignedClientIdentifier:18,reasonString:31,wildcardSubscriptionAvailable:40,subscriptionIdentifiersAvailable:41,sharedSubscriptionAvailable:42,serverKeepAlive:19,responseInformation:26,serverReference:28,topicAlias:35,subscriptionIdentifier:11},s.propertiesCodes={},s.properties){var l=s.properties[a];s.propertiesCodes[l]=a}function u(i){return[0,1,2].map(function(n){return[0,1].map(function(r){return[0,1].map(function(t){var e=new o(1);return e.writeUInt8(s.codes[i]<<s.CMD_SHIFT|(r?s.DUP_MASK:0)|n<<s.QOS_SHIFT|t,0,!0),e})})})}s.propertiesTypes={sessionExpiryInterval:"int32",willDelayInterval:"int32",receiveMaximum:"int16",maximumPacketSize:"int32",topicAliasMaximum:"int16",requestResponseInformation:"byte",requestProblemInformation:"byte",userProperties:"pair",authenticationMethod:"string",authenticationData:"binary",payloadFormatIndicator:"byte",messageExpiryInterval:"int32",contentType:"string",responseTopic:"string",correlationData:"binary",maximumQoS:"int8",retainAvailable:"byte",assignedClientIdentifier:"string",reasonString:"string",wildcardSubscriptionAvailable:"byte",subscriptionIdentifiersAvailable:"byte",sharedSubscriptionAvailable:"byte",serverKeepAlive:"int32",responseInformation:"string",serverReference:"string",topicAlias:"int16",subscriptionIdentifier:"var"},s.PUBLISH_HEADER=u("publish"),s.SUBSCRIBE_HEADER=u("subscribe"),s.SUBSCRIBE_OPTIONS_QOS_MASK=3,s.SUBSCRIBE_OPTIONS_NL_MASK=1,s.SUBSCRIBE_OPTIONS_NL_SHIFT=2,s.SUBSCRIBE_OPTIONS_RAP_MASK=1,s.SUBSCRIBE_OPTIONS_RAP_SHIFT=3,s.SUBSCRIBE_OPTIONS_RH_MASK=3,s.SUBSCRIBE_OPTIONS_RH_SHIFT=4,s.SUBSCRIBE_OPTIONS_RH=[0,16,32],s.SUBSCRIBE_OPTIONS_NL=4,s.SUBSCRIBE_OPTIONS_RAP=8,s.SUBSCRIBE_OPTIONS_QOS=[0,1,2],s.UNSUBSCRIBE_HEADER=u("unsubscribe"),s.ACKS={unsuback:u("unsuback"),puback:u("puback"),pubcomp:u("pubcomp"),pubrel:u("pubrel"),pubrec:u("pubrec")},s.SUBACK_HEADER=o.from([s.codes.suback<<s.CMD_SHIFT]),s.VERSION3=o.from([3]),s.VERSION4=o.from([4]),s.VERSION5=o.from([5]),s.QOS=[0,1,2].map(function(t){return o.from([t])}),s.EMPTY={pingreq:o.from([s.codes.pingreq<<4,0]),pingresp:o.from([s.codes.pingresp<<4,0]),disconnect:o.from([s.codes.disconnect<<4,0])}},{"safe-buffer":110}],83:[function(t,e,r){"use strict";var s=t("safe-buffer").Buffer,n=t("./writeToStream"),i=t("events").EventEmitter;function o(){this._array=new Array(20),this._i=0}t("inherits")(o,i),o.prototype.write=function(t){return this._array[this._i++]=t,!0},o.prototype.concat=function(){var t,e,r=0,n=new Array(this._array.length),i=this._array,o=0;for(t=0;t<i.length&&void 0!==i[t];t++)"string"!=typeof i[t]?n[t]=i[t].length:n[t]=s.byteLength(i[t]),r+=n[t];for(e=s.allocUnsafe(r),t=0;t<i.length&&void 0!==i[t];t++)"string"!=typeof i[t]?i[t].copy(e,o):e.write(i[t],o),o+=n[t];return e},e.exports=function(t,e){var r=new o;return n(t,r,e),r.concat()}},{"./writeToStream":89,events:13,inherits:80,"safe-buffer":110}],84:[function(t,e,r){"use strict";r.parser=t("./parser"),r.generate=t("./generate"),r.writeToStream=t("./writeToStream")},{"./generate":83,"./parser":88,"./writeToStream":89}],85:[function(t,e,r){var n=t("readable-stream/duplex"),i=t("util"),f=t("safe-buffer").Buffer;function o(t){if(!(this instanceof o))return new o(t);if(this._bufs=[],this.length=0,"function"==typeof t){this._callback=t;var e=function(t){this._callback&&(this._callback(t),this._callback=null)}.bind(this);this.on("pipe",function(t){t.on("error",e)}),this.on("unpipe",function(t){t.removeListener("error",e)})}else this.append(t);n.call(this)}i.inherits(o,n),o.prototype._offset=function(t){var e,r=0,n=0;if(0===t)return[0,0];for(;n<this._bufs.length;n++){if(t<(e=r+this._bufs[n].length)||n==this._bufs.length-1)return[n,t-r];r=e}},o.prototype.append=function(t){var e=0;if(f.isBuffer(t))this._appendBuffer(t);else if(Array.isArray(t))for(;e<t.length;e++)this.append(t[e]);else if(t instanceof o)for(;e<t._bufs.length;e++)this.append(t._bufs[e]);else null!=t&&("number"==typeof t&&(t=t.toString()),this._appendBuffer(f.from(t)));return this},o.prototype._appendBuffer=function(t){this._bufs.push(t),this.length+=t.length},o.prototype._write=function(t,e,r){this._appendBuffer(t),"function"==typeof r&&r()},o.prototype._read=function(t){if(!this.length)return this.push(null);t=Math.min(t,this.length),this.push(this.slice(0,t)),this.consume(t)},o.prototype.end=function(t){n.prototype.end.call(this,t),this._callback&&(this._callback(null,this.slice()),this._callback=null)},o.prototype.get=function(t){return this.slice(t,t+1)[0]},o.prototype.slice=function(t,e){return"number"==typeof t&&t<0&&(t+=this.length),"number"==typeof e&&e<0&&(e+=this.length),this.copy(null,0,t,e)},o.prototype.copy=function(t,e,r,n){if(("number"!=typeof r||r<0)&&(r=0),("number"!=typeof n||n>this.length)&&(n=this.length),r>=this.length)return t||f.alloc(0);if(n<=0)return t||f.alloc(0);var i,o,s=!!t,a=this._offset(r),l=n-r,u=l,c=s&&e||0,h=a[1];if(0===r&&n==this.length){if(!s)return 1===this._bufs.length?this._bufs[0]:f.concat(this._bufs,this.length);for(o=0;o<this._bufs.length;o++)this._bufs[o].copy(t,c),c+=this._bufs[o].length;return t}if(u<=this._bufs[a[0]].length-h)return s?this._bufs[a[0]].copy(t,e,h,h+u):this._bufs[a[0]].slice(h,h+u);for(s||(t=f.allocUnsafe(l)),o=a[0];o<this._bufs.length;o++){if(!((i=this._bufs[o].length-h)<u)){this._bufs[o].copy(t,c,h,h+u);break}this._bufs[o].copy(t,c,h),c+=i,u-=i,h&&(h=0)}return t},o.prototype.shallowSlice=function(t,e){t=t||0,e=e||this.length,t<0&&(t+=this.length),e<0&&(e+=this.length);var r=this._offset(t),n=this._offset(e),i=this._bufs.slice(r[0],n[0]+1);return 0==n[1]?i.pop():i[i.length-1]=i[i.length-1].slice(0,n[1]),0!=r[1]&&(i[0]=i[0].slice(r[1])),new o(i)},o.prototype.toString=function(t,e,r){return this.slice(e,r).toString(t)},o.prototype.consume=function(t){for(;this._bufs.length;){if(!(t>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(t),this.length-=t;break}t-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},o.prototype.duplicate=function(){for(var t=0,e=new o;t<this._bufs.length;t++)e.append(this._bufs[t]);return e},o.prototype.destroy=function(){this._bufs.length=0,this.length=0,this.push(null)},function(){var r={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};for(var t in r)!function(e){o.prototype[e]=function(t){return this.slice(t,t+r[e])[e](0)}}(t)}(),e.exports=o},{"readable-stream/duplex":97,"safe-buffer":110,util:117}],86:[function(t,e,r){"use strict";var s=t("safe-buffer").Buffer,n={};function i(t){var e=s.allocUnsafe(2);return e.writeUInt8(t>>8,0),e.writeUInt8(255&t,1),e}e.exports={cache:n,generateCache:function(){for(var t=0;t<65536;t++)n[t]=i(t)},generateNumber:i,genBufVariableByteInt:function(t){for(var e,r=0,n=0,i=0<=(e=t)&&e<128?1:128<=e&&e<16384?2:16384<=e&&e<2097152?3:2097152<=e&&e<268435456?4:0,o=s.allocUnsafe(i);r=t%128|0,0<(t=t/128|0)&&(r|=128),o.writeUInt8(r,n++),0<t;);return{data:o,length:i}},generate4ByteBuffer:function(t){var e=s.allocUnsafe(4);return e.writeUInt32BE(t,0),e}}},{"safe-buffer":110}],87:[function(t,e,r){e.exports=function(){this.cmd=null,this.retain=!1,this.qos=0,this.dup=!1,this.length=-1,this.topic=null,this.payload=null}},{}],88:[function(t,e,r){"use strict";var n=t("bl"),i=t("inherits"),o=t("events").EventEmitter,s=t("./packet"),c=t("./constants");function a(t){if(!(this instanceof a))return new a(t);this.settings=t||{},this._states=["_parseHeader","_parseLength","_parsePayload","_newPacket"],this._resetState()}i(a,o),a.prototype._resetState=function(){this.packet=new s,this.error=null,this._list=n(),this._stateCounter=0},a.prototype.parse=function(t){for(this.error&&this._resetState(),this._list.append(t);(-1!==this.packet.length||0<this._list.length)&&this[this._states[this._stateCounter]]()&&!this.error;)this._stateCounter++,this._stateCounter>=this._states.length&&(this._stateCounter=0);return this._list.length},a.prototype._parseHeader=function(){var t=this._list.readUInt8(0);return this.packet.cmd=c.types[t>>c.CMD_SHIFT],this.packet.retain=0!=(t&c.RETAIN_MASK),this.packet.qos=t>>c.QOS_SHIFT&c.QOS_MASK,this.packet.dup=0!=(t&c.DUP_MASK),this._list.consume(1),!0},a.prototype._parseLength=function(){var t=this._parseVarByteNum(!0);return t&&(this.packet.length=t.value,this._list.consume(t.bytes)),!!t},a.prototype._parsePayload=function(){var t=!1;if(0===this.packet.length||this._list.length>=this.packet.length){switch(this._pos=0,this.packet.cmd){case"connect":this._parseConnect();break;case"connack":this._parseConnack();break;case"publish":this._parsePublish();break;case"puback":case"pubrec":case"pubrel":case"pubcomp":this._parseConfirmation();break;case"subscribe":this._parseSubscribe();break;case"suback":this._parseSuback();break;case"unsubscribe":this._parseUnsubscribe();break;case"unsuback":this._parseUnsuback();break;case"pingreq":case"pingresp":break;case"disconnect":this._parseDisconnect();break;case"auth":this._parseAuth();break;default:this._emitError(new Error("Not supported"))}t=!0}return t},a.prototype._parseConnect=function(){var t,e,r,n,i,o,s={},a=this.packet;if(null===(t=this._parseString()))return this._emitError(new Error("Cannot parse protocolId"));if("MQTT"!==t&&"MQIsdp"!==t)return this._emitError(new Error("Invalid protocolId"));if(a.protocolId=t,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(a.protocolVersion=this._list.readUInt8(this._pos),3!==a.protocolVersion&&4!==a.protocolVersion&&5!==a.protocolVersion)return this._emitError(new Error("Invalid protocol version"));if(this._pos++,this._pos>=this._list.length)return this._emitError(new Error("Packet too short"));if(s.username=this._list.readUInt8(this._pos)&c.USERNAME_MASK,s.password=this._list.readUInt8(this._pos)&c.PASSWORD_MASK,s.will=this._list.readUInt8(this._pos)&c.WILL_FLAG_MASK,s.will&&(a.will={},a.will.retain=0!=(this._list.readUInt8(this._pos)&c.WILL_RETAIN_MASK),a.will.qos=(this._list.readUInt8(this._pos)&c.WILL_QOS_MASK)>>c.WILL_QOS_SHIFT),a.clean=0!=(this._list.readUInt8(this._pos)&c.CLEAN_SESSION_MASK),this._pos++,a.keepalive=this._parseNum(),-1===a.keepalive)return this._emitError(new Error("Packet too short"));if(5===a.protocolVersion){var l=this._parseProperties();Object.getOwnPropertyNames(l).length&&(a.properties=l)}if(null===(e=this._parseString()))return this._emitError(new Error("Packet too short"));if(a.clientId=e,s.will){if(5===a.protocolVersion){var u=this._parseProperties();Object.getOwnPropertyNames(u).length&&(a.will.properties=u)}if(null===(r=this._parseString()))return this._emitError(new Error("Cannot parse will topic"));if(a.will.topic=r,null===(n=this._parseBuffer()))return this._emitError(new Error("Cannot parse will payload"));a.will.payload=n}if(s.username){if(null===(o=this._parseString()))return this._emitError(new Error("Cannot parse username"));a.username=o}if(s.password){if(null===(i=this._parseBuffer()))return this._emitError(new Error("Cannot parse password"));a.password=i}return this.settings=a},a.prototype._parseConnack=function(){var t=this.packet;if(this._list.length<2)return null;if(t.sessionPresent=!!(this._list.readUInt8(this._pos++)&c.SESSIONPRESENT_MASK),5===this.settings.protocolVersion?t.reasonCode=this._list.readUInt8(this._pos++):t.returnCode=this._list.readUInt8(this._pos++),-1===t.returnCode||-1===t.reasonCode)return this._emitError(new Error("Cannot parse return code"));if(5===this.settings.protocolVersion){var e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}},a.prototype._parsePublish=function(){var t=this.packet;if(t.topic=this._parseString(),null===t.topic)return this._emitError(new Error("Cannot parse topic"));if(!(0<t.qos)||this._parseMessageId()){if(5===this.settings.protocolVersion){var e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}t.payload=this._list.slice(this._pos,t.length)}},a.prototype._parseSubscribe=function(){var t,e,r,n,i,o,s,a=this.packet;if(1!==a.qos)return this._emitError(new Error("Wrong subscribe header"));if(a.subscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var l=this._parseProperties();Object.getOwnPropertyNames(l).length&&(a.properties=l)}for(;this._pos<a.length;){if(null===(t=this._parseString()))return this._emitError(new Error("Cannot parse topic"));r=(e=this._parseByte())&c.SUBSCRIBE_OPTIONS_QOS_MASK,o=0!=(e>>c.SUBSCRIBE_OPTIONS_NL_SHIFT&c.SUBSCRIBE_OPTIONS_NL_MASK),i=0!=(e>>c.SUBSCRIBE_OPTIONS_RAP_SHIFT&c.SUBSCRIBE_OPTIONS_RAP_MASK),n=e>>c.SUBSCRIBE_OPTIONS_RH_SHIFT&c.SUBSCRIBE_OPTIONS_RH_MASK,s={topic:t,qos:r},5===this.settings.protocolVersion&&(s.nl=o,s.rap=i,s.rh=n),a.subscriptions.push(s)}}},a.prototype._parseSuback=function(){var t=this.packet;if(this.packet.granted=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}for(;this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}},a.prototype._parseUnsubscribe=function(){var t=this.packet;if(t.unsubscriptions=[],this._parseMessageId()){if(5===this.settings.protocolVersion){var e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}for(;this._pos<t.length;){var r;if(null===(r=this._parseString()))return this._emitError(new Error("Cannot parse topic"));t.unsubscriptions.push(r)}}},a.prototype._parseUnsuback=function(){var t=this.packet;if(!this._parseMessageId())return this._emitError(new Error("Cannot parse messageId"));if(5===this.settings.protocolVersion){var e=this._parseProperties();for(Object.getOwnPropertyNames(e).length&&(t.properties=e),t.granted=[];this._pos<this.packet.length;)this.packet.granted.push(this._list.readUInt8(this._pos++))}},a.prototype._parseConfirmation=function(){var t=this.packet;if(this._parseMessageId(),5===this.settings.protocolVersion&&2<t.length){t.reasonCode=this._parseByte();var e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}return!0},a.prototype._parseDisconnect=function(){var t=this.packet;if(5===this.settings.protocolVersion){t.reasonCode=this._parseByte();var e=this._parseProperties();Object.getOwnPropertyNames(e).length&&(t.properties=e)}return!0},a.prototype._parseAuth=function(){var t=this.packet;if(5!==this.settings.protocolVersion)return this._emitError(new Error("Not supported auth packet for this version MQTT"));t.reasonCode=this._parseByte();var e=this._parseProperties();return Object.getOwnPropertyNames(e).length&&(t.properties=e),!0},a.prototype._parseMessageId=function(){var t=this.packet;return t.messageId=this._parseNum(),null!==t.messageId||(this._emitError(new Error("Cannot parse messageId")),!1)},a.prototype._parseString=function(t){var e,r=this._parseNum(),n=r+this._pos;return-1===r||n>this._list.length||n>this.packet.length?null:(e=this._list.toString("utf8",this._pos,n),this._pos+=r,e)},a.prototype._parseStringPair=function(){return{name:this._parseString(),value:this._parseString()}},a.prototype._parseBuffer=function(){var t,e=this._parseNum(),r=e+this._pos;return-1===e||r>this._list.length||r>this.packet.length?null:(t=this._list.slice(this._pos,r),this._pos+=e,t)},a.prototype._parseNum=function(){if(this._list.length-this._pos<2)return-1;var t=this._list.readUInt16BE(this._pos);return this._pos+=2,t},a.prototype._parse4ByteNum=function(){if(this._list.length-this._pos<4)return-1;var t=this._list.readUInt32BE(this._pos);return this._pos+=4,t},a.prototype._parseVarByteNum=function(t){for(var e,r=0,n=1,i=0,o=!0,s=this._pos?this._pos:0;r<5&&(i+=n*((e=this._list.readUInt8(s+r++))&c.LENGTH_MASK),n*=128,0!=(e&c.LENGTH_FIN_MASK));)if(this._list.length<=r){o=!1;break}return s&&(this._pos+=r),o=!!o&&(t?{bytes:r,value:i}:i)},a.prototype._parseByte=function(){var t=this._list.readUInt8(this._pos);return this._pos++,t},a.prototype._parseByType=function(t){switch(t){case"byte":return 0!==this._parseByte();case"int8":return this._parseByte();case"int16":return this._parseNum();case"int32":return this._parse4ByteNum();case"var":return this._parseVarByteNum();case"string":return this._parseString();case"pair":return this._parseStringPair();case"binary":return this._parseBuffer()}},a.prototype._parseProperties=function(){for(var t=this._parseVarByteNum(),e=this._pos+t,r={};this._pos<e;){var n=this._parseByte(),i=c.propertiesCodes[n];if(!i)return this._emitError(new Error("Unknown property")),!1;if("userProperties"!==i)r[i]=this._parseByType(c.propertiesTypes[i]);else{r[i]||(r[i]={});var o=this._parseByType(c.propertiesTypes[i]);r[i][o.name]=o.value}}return r},a.prototype._newPacket=function(){return this.packet&&(this._list.consume(this.packet.length),this.emit("packet",this.packet)),this.packet=new s,!(this._pos=0)},a.prototype._emitError=function(t){this.error=t,this.emit("error",t)},e.exports=a},{"./constants":82,"./packet":87,bl:85,events:13,inherits:80}],89:[function(t,e,r){"use strict";var C=t("./constants"),x=t("safe-buffer").Buffer,p=x.allocUnsafe(0),u=x.from([0]),n=t("./numbers"),i=t("process-nextick-args").nextTick,o=n.cache,s=n.generateNumber,a=n.generateCache,l=n.genBufVariableByteInt,c=n.generate4ByteBuffer,L=m,h=!0;function f(t,e,r){switch(e.cork&&(e.cork(),i(d,e)),h&&(h=!1,a()),t.cmd){case"connect":return function(t,e,r){var n=t||{},i=n.protocolId||"MQTT",o=n.protocolVersion||4,s=n.will,a=n.clean,l=n.keepalive||0,u=n.clientId||"",c=n.username,h=n.password,f=n.properties;void 0===a&&(a=!0);var p=0;{if(!i||"string"!=typeof i&&!x.isBuffer(i))return e.emit("error",new Error("Invalid protocolId")),!1;p+=i.length+2}{if(3!==o&&4!==o&&5!==o)return e.emit("error",new Error("Invalid protocol version")),!1;p+=1}if("string"!=typeof u&&!x.isBuffer(u)||!u&&4!==o||!u&&!a){if(o<4)return e.emit("error",new Error("clientId must be supplied before 3.1.1")),!1;if(1*a==0)return e.emit("error",new Error("clientId must be given if cleanSession set to 0")),!1}else p+=u.length+2;{if("number"!=typeof l||l<0||65535<l||l%1!=0)return e.emit("error",new Error("Invalid keepalive")),!1;p+=2}if(p+=1,5===o){var d=R(e,f);p+=d.length}if(s){if("object"!=typeof s)return e.emit("error",new Error("Invalid will")),!1;if(!s.topic||"string"!=typeof s.topic)return e.emit("error",new Error("Invalid will topic")),!1;if(p+=x.byteLength(s.topic)+2,s.payload){if(!(0<=s.payload.length))return e.emit("error",new Error("Invalid will payload")),!1;"string"==typeof s.payload?p+=x.byteLength(s.payload)+2:p+=s.payload.length+2;var g={};5===o&&(g=R(e,s.properties),p+=g.length)}}var m=!1;if(null!=c){if(!_(c))return e.emit("error",new Error("Invalid username")),!1;m=!0,p+=x.byteLength(c)+2}if(null!=h){if(!m)return e.emit("error",new Error("Username is required to use password")),!1;if(!_(h))return e.emit("error",new Error("Invalid password")),!1;p+=E(h)+2}e.write(C.CONNECT_HEADER),A(e,p),y(e,i),e.write(4===o?C.VERSION4:5===o?C.VERSION5:C.VERSION3);var v=0;v|=null!=c?C.USERNAME_MASK:0,v|=null!=h?C.PASSWORD_MASK:0,v|=s&&s.retain?C.WILL_RETAIN_MASK:0,v|=s&&s.qos?s.qos<<C.WILL_QOS_SHIFT:0,v|=s?C.WILL_FLAG_MASK:0,v|=a?C.CLEAN_SESSION_MASK:0,e.write(x.from([v])),L(e,l),5===o&&d.write();y(e,u),s&&(5===o&&g.write(),M(e,s.topic),y(e,s.payload));null!=c&&y(e,c);null!=h&&y(e,h);return!0}(t,e);case"connack":return function(t,e,r){var n=r?r.protocolVersion:4,i=t||{},o=5===n?i.reasonCode:i.returnCode,s=i.properties,a=2;if("number"!=typeof o)return e.emit("error",new Error("Invalid return code")),!1;var l=null;5===n&&(l=R(e,s),a+=l.length);e.write(C.CONNACK_HEADER),A(e,a),e.write(i.sessionPresent?C.SESSIONPRESENT_HEADER:u),e.write(x.from([o])),null!=l&&l.write();return!0}(t,e,r);case"publish":return function(t,e,r){var n=r?r.protocolVersion:4,i=t||{},o=i.qos||0,s=i.retain?C.RETAIN_MASK:0,a=i.topic,l=i.payload||p,u=i.messageId,c=i.properties,h=0;if("string"==typeof a)h+=x.byteLength(a)+2;else{if(!x.isBuffer(a))return e.emit("error",new Error("Invalid topic")),!1;h+=a.length+2}x.isBuffer(l)?h+=l.length:h+=x.byteLength(l);{if(o&&"number"!=typeof u)return e.emit("error",new Error("Invalid messageId")),!1;o&&(h+=2)}var f=null;5===n&&(f=R(e,c),h+=f.length);e.write(C.PUBLISH_HEADER[o][i.dup?1:0][s?1:0]),A(e,h),L(e,E(a)),e.write(a),0<o&&L(e,u);null!=f&&f.write();return e.write(l)}(t,e,r);case"puback":case"pubrec":case"pubrel":case"pubcomp":return function(t,e,r){var n=r?r.protocolVersion:4,i=t||{},o=i.cmd||"puback",s=i.messageId,a=i.dup&&"pubrel"===o?C.DUP_MASK:0,l=0,u=i.reasonCode,c=i.properties,h=5===n?3:2;"pubrel"===o&&(l=1);if("number"!=typeof s)return e.emit("error",new Error("Invalid messageId")),!1;var f=null;if(5===n){if(!(f=b(e,c,r,h)))return!1;h+=f.length}e.write(C.ACKS[o][l][a][0]),A(e,h),L(e,s),5===n&&e.write(x.from([u]));null!==f&&f.write();return!0}(t,e,r);case"subscribe":return function(t,e,r){var n=r?r.protocolVersion:4,i=t||{},o=i.dup?C.DUP_MASK:0,s=i.messageId,a=i.subscriptions,l=i.properties,u=0;{if("number"!=typeof s)return e.emit("error",new Error("Invalid messageId")),!1;u+=2}var c=null;5===n&&(c=R(e,l),u+=c.length);{if("object"!=typeof a||!a.length)return e.emit("error",new Error("Invalid subscriptions")),!1;for(var h=0;h<a.length;h+=1){var f=a[h].topic,p=a[h].qos;if("string"!=typeof f)return e.emit("error",new Error("Invalid subscriptions - invalid topic")),!1;if("number"!=typeof p)return e.emit("error",new Error("Invalid subscriptions - invalid qos")),!1;if(5===n){var d=a[h].nl||!1;if("boolean"!=typeof d)return e.emit("error",new Error("Invalid subscriptions - invalid No Local")),!1;var g=a[h].rap||!1;if("boolean"!=typeof g)return e.emit("error",new Error("Invalid subscriptions - invalid Retain as Published")),!1;var m=a[h].rh||0;if("number"!=typeof m||2<m)return e.emit("error",new Error("Invalid subscriptions - invalid Retain Handling")),!1}u+=x.byteLength(f)+2+1}}e.write(C.SUBSCRIBE_HEADER[1][o?1:0][0]),A(e,u),L(e,s),null!==c&&c.write();for(var v=!0,y=0;y<a.length;y++){var b,w=a[y],E=w.topic,_=w.qos,S=+w.nl,T=+w.rap,I=w.rh;M(e,E),b=C.SUBSCRIBE_OPTIONS_QOS[_],5===n&&(b|=S?C.SUBSCRIBE_OPTIONS_NL:0,b|=T?C.SUBSCRIBE_OPTIONS_RAP:0,b|=I?C.SUBSCRIBE_OPTIONS_RH[I]:0),v=e.write(x.from([b]))}return v}(t,e,r);case"suback":return function(t,e,r){var n=r?r.protocolVersion:4,i=t||{},o=i.messageId,s=i.granted,a=i.properties,l=0;{if("number"!=typeof o)return e.emit("error",new Error("Invalid messageId")),!1;l+=2}{if("object"!=typeof s||!s.length)return e.emit("error",new Error("Invalid qos vector")),!1;for(var u=0;u<s.length;u+=1){if("number"!=typeof s[u])return e.emit("error",new Error("Invalid qos vector")),!1;l+=1}}var c=null;if(5===n){if(!(c=b(e,a,r,l)))return!1;l+=c.length}e.write(C.SUBACK_HEADER),A(e,l),L(e,o),null!==c&&c.write();return e.write(x.from(s))}(t,e,r);case"unsubscribe":return function(t,e,r){var n=r?r.protocolVersion:4,i=t||{},o=i.messageId,s=i.dup?C.DUP_MASK:0,a=i.unsubscriptions,l=i.properties,u=0;{if("number"!=typeof o)return e.emit("error",new Error("Invalid messageId")),!1;u+=2}{if("object"!=typeof a||!a.length)return e.emit("error",new Error("Invalid unsubscriptions")),!1;for(var c=0;c<a.length;c+=1){if("string"!=typeof a[c])return e.emit("error",new Error("Invalid unsubscriptions")),!1;u+=x.byteLength(a[c])+2}}var h=null;5===n&&(h=R(e,l),u+=h.length);e.write(C.UNSUBSCRIBE_HEADER[1][s?1:0][0]),A(e,u),L(e,o),null!==h&&h.write();for(var f=!0,p=0;p<a.length;p++)f=M(e,a[p]);return f}(t,e,r);case"unsuback":return function(t,e,r){var n=r?r.protocolVersion:4,i=t||{},o=i.messageId,s=i.dup?C.DUP_MASK:0,a=i.granted,l=i.properties,u=i.cmd,c=2;if("number"!=typeof o)return e.emit("error",new Error("Invalid messageId")),!1;if(5===n){if("object"!=typeof a||!a.length)return e.emit("error",new Error("Invalid qos vector")),!1;for(var h=0;h<a.length;h+=1){if("number"!=typeof a[h])return e.emit("error",new Error("Invalid qos vector")),!1;c+=1}}var f=null;if(5===n){if(!(f=b(e,l,r,c)))return!1;c+=f.length}e.write(C.ACKS[u][0][s][0]),A(e,c),L(e,o),null!==f&&f.write();5===n&&e.write(x.from(a));return!0}(t,e,r);case"pingreq":case"pingresp":return n=t,e.write(C.EMPTY[n.cmd]);case"disconnect":return function(t,e,r){var n=r?r.protocolVersion:4,i=t||{},o=i.reasonCode,s=i.properties,a=5===n?1:0,l=null;if(5===n){if(!(l=b(e,s,r,a)))return!1;a+=l.length}e.write(x.from([C.codes.disconnect<<4])),A(e,a),5===n&&e.write(x.from([o]));null!==l&&l.write();return!0}(t,e,r);case"auth":return function(t,e,r){var n=r?r.protocolVersion:4,i=t||{},o=i.reasonCode,s=i.properties,a=5===n?1:0;5!==n&&e.emit("error",new Error("Invalid mqtt version for auth packet"));var l=b(e,s,r,a);if(!l)return!1;a+=l.length,e.write(x.from([C.codes.auth<<4])),A(e,a),e.write(x.from([o])),null!==l&&l.write();return!0}(t,e,r);default:return e.emit("error",new Error("Unknown command")),!1}var n}function d(t){t.uncork()}Object.defineProperty(f,"cacheNumbers",{get:function(){return L===m},set:function(t){L=t?(o&&0!==Object.keys(o).length||(h=!0),m):(h=!1,v)}});var g={};function A(t,e){var r=g[e];r||(r=l(e).data,e<16384&&(g[e]=r)),t.write(r)}function M(t,e){var r=x.byteLength(e);L(t,r),t.write(e,"utf8")}function m(t,e){return t.write(o[e])}function v(t,e){return t.write(s(e))}function y(t,e){"string"==typeof e?M(t,e):e?(L(t,e.length),t.write(e)):L(t,0)}function R(i,o){if("object"!=typeof o||null!=o.length)return{length:1,write:function(){w(i,{},0)}};var t=0;function e(t){var e=C.propertiesTypes[t],r=o[t],n=0;switch(e){case"byte":if("boolean"!=typeof r)return i.emit("error",new Error("Invalid "+t)),!1;n+=2;break;case"int8":if("number"!=typeof r)return i.emit("error",new Error("Invalid "+t)),!1;n+=2;break;case"binary":if(r&&null===r)return i.emit("error",new Error("Invalid "+t)),!1;n+=1+x.byteLength(r)+2;break;case"int16":if("number"!=typeof r)return i.emit("error",new Error("Invalid "+t)),!1;n+=3;break;case"int32":if("number"!=typeof r)return i.emit("error",new Error("Invalid "+t)),!1;n+=5;break;case"var":if("number"!=typeof r)return i.emit("error",new Error("Invalid "+t)),!1;n+=1+l(r).length;break;case"string":if("string"!=typeof r)return i.emit("error",new Error("Invalid "+t)),!1;n+=3+x.byteLength(r.toString());break;case"pair":if("object"!=typeof r)return i.emit("error",new Error("Invalid "+t)),!1;n+=Object.getOwnPropertyNames(r).reduce(function(t,e){return t+=3+x.byteLength(e.toString())+2+x.byteLength(r[e].toString())},0);break;default:return i.emit("error",new Error("Invalid property "+t)),!1}return n}if(o)for(var r in o){var n=e(r);if(!n)return!1;t+=n}return{length:l(t).length+t,write:function(){w(i,o,t)}}}function b(t,e,r,n){var i=["reasonString","userProperties"],o=r&&r.properties&&r.properties.maximumPacketSize?r.properties.maximumPacketSize:0,s=R(t,e);if(o)for(;n+s.length>o;){var a=i.shift();if(!a||!e[a])return!1;delete e[a],s=R(t,e)}return s}function w(i,t,e){for(var o in A(i,e),t)if(t.hasOwnProperty(o)&&null!==t[o]){var s=t[o];switch(C.propertiesTypes[o]){case"byte":i.write(x.from([C.properties[o]])),i.write(x.from([+s]));break;case"int8":i.write(x.from([C.properties[o]])),i.write(x.from([s]));break;case"binary":i.write(x.from([C.properties[o]])),y(i,s);break;case"int16":i.write(x.from([C.properties[o]])),L(i,s);break;case"int32":i.write(x.from([C.properties[o]])),r=s,i.write(c(r));break;case"var":i.write(x.from([C.properties[o]])),A(i,s);break;case"string":i.write(x.from([C.properties[o]])),M(i,s);break;case"pair":Object.getOwnPropertyNames(s).forEach(function(t){var e,r,n;i.write(x.from([C.properties[o]])),e=i,r=t.toString(),n=s[t].toString(),M(e,r),M(e,n)});break;default:return i.emit("error",new Error("Invalid property "+o)),!1}}var r}function E(t){return t?t instanceof x?t.length:x.byteLength(t):0}function _(t){return"string"==typeof t||t instanceof x}e.exports=f},{"./constants":82,"./numbers":86,"process-nextick-args":91,"safe-buffer":110}],90:[function(t,e,r){var n=t("wrappy");function i(t){var e=function(){return e.called?e.value:(e.called=!0,e.value=t.apply(this,arguments))};return e.called=!1,e}function o(t){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=t.apply(this,arguments)},r=t.name||"Function wrapped with `once`";return e.onceError=r+" shouldn't be called more than once",e.called=!1,e}e.exports=n(i),e.exports.strict=n(o),i.proto=i(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return i(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return o(this)},configurable:!0})})},{wrappy:120}],91:[function(t,e,r){(function(a){"use strict";!a.version||0===a.version.indexOf("v0.")||0===a.version.indexOf("v1.")&&0!==a.version.indexOf("v1.8.")?e.exports={nextTick:function(t,e,r,n){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var i,o,s=arguments.length;switch(s){case 0:case 1:return a.nextTick(t);case 2:return a.nextTick(function(){t.call(null,e)});case 3:return a.nextTick(function(){t.call(null,e,r)});case 4:return a.nextTick(function(){t.call(null,e,r,n)});default:for(i=new Array(s-1),o=0;o<i.length;)i[o++]=arguments[o];return a.nextTick(function(){t.apply(null,i)})}}}:e.exports=a}).call(this,t("_process"))},{_process:92}],92:[function(t,e,r){var n,i,o=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function l(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(t){n=s}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(t){i=a}}();var u,c=[],h=!1,f=-1;function p(){h&&u&&(h=!1,u.length?c=u.concat(c):f=-1,c.length&&d())}function d(){if(!h){var t=l(p);h=!0;for(var e=c.length;e;){for(u=c,c=[];++f<e;)u&&u[f].run();f=-1,e=c.length}u=null,h=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(t)}}function g(t,e){this.fun=t,this.array=e}function m(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new g(t,e)),1!==c.length||h||l(d)},g.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],93:[function(t,k,N){(function(R){!function(t){var e="object"==typeof N&&N&&!N.nodeType&&N,r="object"==typeof k&&k&&!k.nodeType&&k,n="object"==typeof R&&R;n.global!==n&&n.window!==n&&n.self!==n||(t=n);var i,o,v=2147483647,y=36,b=1,w=26,s=38,a=700,E=72,_=128,S="-",l=/^xn--/,u=/[^\x20-\x7E]/,c=/[\x2E\u3002\uFF0E\uFF61]/g,h={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=y-b,T=Math.floor,I=String.fromCharCode;function C(t){throw new RangeError(h[t])}function p(t,e){for(var r=t.length,n=[];r--;)n[r]=e(t[r]);return n}function d(t,e){var r=t.split("@"),n="";return 1<r.length&&(n=r[0]+"@",t=r[1]),n+p((t=t.replace(c,".")).split("."),e).join(".")}function x(t){for(var e,r,n=[],i=0,o=t.length;i<o;)55296<=(e=t.charCodeAt(i++))&&e<=56319&&i<o?56320==(64512&(r=t.charCodeAt(i++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),i--):n.push(e);return n}function L(t){return p(t,function(t){var e="";return 65535<t&&(e+=I((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=I(t)}).join("")}function A(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function M(t,e,r){var n=0;for(t=r?T(t/a):t>>1,t+=T(t/e);f*w>>1<t;n+=y)t=T(t/f);return T(n+(f+1)*t/(t+s))}function g(t){var e,r,n,i,o,s,a,l,u,c,h,f=[],p=t.length,d=0,g=_,m=E;for((r=t.lastIndexOf(S))<0&&(r=0),n=0;n<r;++n)128<=t.charCodeAt(n)&&C("not-basic"),f.push(t.charCodeAt(n));for(i=0<r?r+1:0;i<p;){for(o=d,s=1,a=y;p<=i&&C("invalid-input"),h=t.charCodeAt(i++),(y<=(l=h-48<10?h-22:h-65<26?h-65:h-97<26?h-97:y)||l>T((v-d)/s))&&C("overflow"),d+=l*s,!(l<(u=a<=m?b:m+w<=a?w:a-m));a+=y)s>T(v/(c=y-u))&&C("overflow"),s*=c;m=M(d-o,e=f.length+1,0==o),T(d/e)>v-g&&C("overflow"),g+=T(d/e),d%=e,f.splice(d++,0,g)}return L(f)}function m(t){var e,r,n,i,o,s,a,l,u,c,h,f,p,d,g,m=[];for(f=(t=x(t)).length,e=_,o=E,s=r=0;s<f;++s)(h=t[s])<128&&m.push(I(h));for(n=i=m.length,i&&m.push(S);n<f;){for(a=v,s=0;s<f;++s)e<=(h=t[s])&&h<a&&(a=h);for(a-e>T((v-r)/(p=n+1))&&C("overflow"),r+=(a-e)*p,e=a,s=0;s<f;++s)if((h=t[s])<e&&++r>v&&C("overflow"),h==e){for(l=r,u=y;!(l<(c=u<=o?b:o+w<=u?w:u-o));u+=y)g=l-c,d=y-c,m.push(I(A(c+g%d,0))),l=T(g/d);m.push(I(A(l,0))),o=M(r,p,n==i),r=0,++n}++r,++e}return m.join("")}if(i={version:"1.4.1",ucs2:{decode:x,encode:L},decode:g,encode:m,toASCII:function(t){return d(t,function(t){return u.test(t)?"xn--"+m(t):t})},toUnicode:function(t){return d(t,function(t){return l.test(t)?g(t.slice(4).toLowerCase()):t})}},e&&r)if(k.exports==e)r.exports=i;else for(o in i)i.hasOwnProperty(o)&&(e[o]=i[o]);else t.punycode=i}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],94:[function(t,e,r){"use strict";e.exports=function(t,e,r,n){e=e||"&",r=r||"=";var i={};if("string"!=typeof t||0===t.length)return i;var o=/\+/g;t=t.split(e);var s=1e3;n&&"number"==typeof n.maxKeys&&(s=n.maxKeys);var a,l,u=t.length;0<s&&s<u&&(u=s);for(var c=0;c<u;++c){var h,f,p,d,g=t[c].replace(o,"%20"),m=g.indexOf(r);f=0<=m?(h=g.substr(0,m),g.substr(m+1)):(h=g,""),p=decodeURIComponent(h),d=decodeURIComponent(f),a=i,l=p,Object.prototype.hasOwnProperty.call(a,l)?v(i[p])?i[p].push(d):i[p]=[i[p],d]:i[p]=d}return i};var v=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{}],95:[function(t,e,r){"use strict";var o=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};e.exports=function(r,n,i,t){return n=n||"&",i=i||"=",null===r&&(r=void 0),"object"==typeof r?a(l(r),function(t){var e=encodeURIComponent(o(t))+i;return s(r[t])?a(r[t],function(t){return e+encodeURIComponent(o(t))}).join(n):e+encodeURIComponent(o(r[t]))}).join(n):t?encodeURIComponent(o(t))+i+encodeURIComponent(o(r)):""};var s=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function a(t,e){if(t.map)return t.map(e);for(var r=[],n=0;n<t.length;n++)r.push(e(t[n],n));return r}var l=Object.keys||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.push(r);return e}},{}],96:[function(t,e,r){"use strict";r.decode=r.parse=t("./decode"),r.encode=r.stringify=t("./encode")},{"./decode":94,"./encode":95}],97:[function(t,e,r){e.exports=t("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":98}],98:[function(t,e,r){"use strict";var n=t("process-nextick-args"),i=Object.keys||function(t){var e=[];for(var r in t)e.push(r);return e};e.exports=h;var o=t("core-util-is");o.inherits=t("inherits");var s=t("./_stream_readable"),a=t("./_stream_writable");o.inherits(h,s);for(var l=i(a.prototype),u=0;u<l.length;u++){var c=l[u];h.prototype[c]||(h.prototype[c]=a.prototype[c])}function h(t){if(!(this instanceof h))return new h(t);s.call(this,t),a.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",f)}function f(){this.allowHalfOpen||this._writableState.ended||n.nextTick(p,this)}function p(t){t.end()}Object.defineProperty(h.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(h.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),h.prototype._destroy=function(t,e){this.push(null),this.end(),n.nextTick(e,t)}},{"./_stream_readable":100,"./_stream_writable":102,"core-util-is":14,inherits:80,"process-nextick-args":91}],99:[function(t,e,r){"use strict";e.exports=o;var n=t("./_stream_transform"),i=t("core-util-is");function o(t){if(!(this instanceof o))return new o(t);n.call(this,t)}i.inherits=t("inherits"),i.inherits(o,n),o.prototype._transform=function(t,e,r){r(null,t)}},{"./_stream_transform":101,"core-util-is":14,inherits:80}],100:[function(N,O,t){(function(m,t){"use strict";var v=N("process-nextick-args");O.exports=f;var s,y=N("isarray");f.ReadableState=o;N("events").EventEmitter;var b=function(t,e){return t.listeners(e).length},i=N("./internal/streams/stream"),u=N("safe-buffer").Buffer,c=t.Uint8Array||function(){};var e=N("core-util-is");e.inherits=N("inherits");var r=N("util"),w=void 0;w=r&&r.debuglog?r.debuglog("stream"):function(){};var a,l=N("./internal/streams/BufferList"),n=N("./internal/streams/destroy");e.inherits(f,i);var h=["error","close","destroy","pause","resume"];function o(t,e){t=t||{};var r=e instanceof(s=s||N("./_stream_duplex"));this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var n=t.highWaterMark,i=t.readableHighWaterMark,o=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r&&(i||0===i)?i:o,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new l,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(a||(a=N("string_decoder/").StringDecoder),this.decoder=new a(t.encoding),this.encoding=t.encoding)}function f(t){if(s=s||N("./_stream_duplex"),!(this instanceof f))return new f(t);this._readableState=new o(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),i.call(this)}function p(t,e,r,n,i){var o,s,a,l=t._readableState;null===e?(l.reading=!1,function(t,e){if(e.ended)return;if(e.decoder){var r=e.decoder.end();r&&r.length&&(e.buffer.push(r),e.length+=e.objectMode?1:r.length)}e.ended=!0,_(t)}(t,l)):(i||(o=function(t,e){var r;n=e,u.isBuffer(n)||n instanceof c||"string"==typeof e||void 0===e||t.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));var n;return r}(l,e)),o?t.emit("error",o):l.objectMode||e&&0<e.length?("string"==typeof e||l.objectMode||Object.getPrototypeOf(e)===u.prototype||(s=e,e=u.from(s)),n?l.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):d(t,l,e,!0):l.ended?t.emit("error",new Error("stream.push() after EOF")):(l.reading=!1,l.decoder&&!r?(e=l.decoder.write(e),l.objectMode||0!==e.length?d(t,l,e,!1):T(t,l)):d(t,l,e,!1))):n||(l.reading=!1));return!(a=l).ended&&(a.needReadable||a.length<a.highWaterMark||0===a.length)}function d(t,e,r,n){e.flowing&&0===e.length&&!e.sync?(t.emit("data",r),t.read(0)):(e.length+=e.objectMode?1:r.length,n?e.buffer.unshift(r):e.buffer.push(r),e.needReadable&&_(t)),T(t,e)}Object.defineProperty(f.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),f.prototype.destroy=n.destroy,f.prototype._undestroy=n.undestroy,f.prototype._destroy=function(t,e){this.push(null),e(t)},f.prototype.push=function(t,e){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof t&&((e=e||n.defaultEncoding)!==n.encoding&&(t=u.from(t,e),e=""),r=!0),p(this,t,e,!1,r)},f.prototype.unshift=function(t){return p(this,t,null,!0,!1)},f.prototype.isPaused=function(){return!1===this._readableState.flowing},f.prototype.setEncoding=function(t){return a||(a=N("string_decoder/").StringDecoder),this._readableState.decoder=new a(t),this._readableState.encoding=t,this};var g=8388608;function E(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=(g<=(r=t)?r=g:(r--,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r++),r)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0));var r}function _(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(w("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?v.nextTick(S,t):S(t))}function S(t){w("emit readable"),t.emit("readable"),L(t)}function T(t,e){e.readingMore||(e.readingMore=!0,v.nextTick(I,t,e))}function I(t,e){for(var r=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(w("maybeReadMore read 0"),t.read(0),r!==e.length);)r=e.length;e.readingMore=!1}function C(t){w("readable nexttick read 0"),t.read(0)}function x(t,e){e.reading||(w("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),L(t),e.flowing&&!e.reading&&t.read(0)}function L(t){var e=t._readableState;for(w("flow",e.flowing);e.flowing&&null!==t.read(););}function A(t,e){return 0===e.length?null:(e.objectMode?r=e.buffer.shift():!t||t>=e.length?(r=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):r=function(t,e,r){var n;t<e.head.data.length?(n=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):n=t===e.head.data.length?e.shift():r?function(t,e){var r=e.head,n=1,i=r.data;t-=i.length;for(;r=r.next;){var o=r.data,s=t>o.length?o.length:t;if(s===o.length?i+=o:i+=o.slice(0,t),0===(t-=s)){s===o.length?(++n,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r).data=o.slice(s);break}++n}return e.length-=n,i}(t,e):function(t,e){var r=u.allocUnsafe(t),n=e.head,i=1;n.data.copy(r),t-=n.data.length;for(;n=n.next;){var o=n.data,s=t>o.length?o.length:t;if(o.copy(r,r.length-t,0,s),0===(t-=s)){s===o.length?(++i,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n).data=o.slice(s);break}++i}return e.length-=i,r}(t,e);return n}(t,e.buffer,e.decoder),r);var r}function M(t){var e=t._readableState;if(0<e.length)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,v.nextTick(R,e,t))}function R(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function k(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}f.prototype.read=function(t){w("read",t),t=parseInt(t,10);var e=this._readableState,r=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return w("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?M(this):_(this),null;if(0===(t=E(t,e))&&e.ended)return 0===e.length&&M(this),null;var n,i=e.needReadable;return w("need readable",i),(0===e.length||e.length-t<e.highWaterMark)&&w("length less than watermark",i=!0),e.ended||e.reading?w("reading or ended",i=!1):i&&(w("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=E(r,e))),null===(n=0<t?A(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&M(this)),null!==n&&this.emit("data",n),n},f.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},f.prototype.pipe=function(r,t){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=r;break;case 1:i.pipes=[i.pipes,r];break;default:i.pipes.push(r)}i.pipesCount+=1,w("pipe count=%d opts=%j",i.pipesCount,t);var e=(!t||!1!==t.end)&&r!==m.stdout&&r!==m.stderr?s:g;function o(t,e){w("onunpipe"),t===n&&e&&!1===e.hasUnpiped&&(e.hasUnpiped=!0,w("cleanup"),r.removeListener("close",p),r.removeListener("finish",d),r.removeListener("drain",l),r.removeListener("error",f),r.removeListener("unpipe",o),n.removeListener("end",s),n.removeListener("end",g),n.removeListener("data",h),u=!0,!i.awaitDrain||r._writableState&&!r._writableState.needDrain||l())}function s(){w("onend"),r.end()}i.endEmitted?v.nextTick(e):n.once("end",e),r.on("unpipe",o);var a,l=(a=n,function(){var t=a._readableState;w("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&b(a,"data")&&(t.flowing=!0,L(a))});r.on("drain",l);var u=!1;var c=!1;function h(t){w("ondata"),(c=!1)!==r.write(t)||c||((1===i.pipesCount&&i.pipes===r||1<i.pipesCount&&-1!==k(i.pipes,r))&&!u&&(w("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,c=!0),n.pause())}function f(t){w("onerror",t),g(),r.removeListener("error",f),0===b(r,"error")&&r.emit("error",t)}function p(){r.removeListener("finish",d),g()}function d(){w("onfinish"),r.removeListener("close",p),g()}function g(){w("unpipe"),n.unpipe(r)}return n.on("data",h),function(t,e,r){if("function"==typeof t.prependListener)return t.prependListener(e,r);t._events&&t._events[e]?y(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]:t.on(e,r)}(r,"error",f),r.once("close",p),r.once("finish",d),r.emit("pipe",n),i.flowing||(w("pipe resume"),n.resume()),r},f.prototype.unpipe=function(t){var e=this._readableState,r={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,r)),this;if(!t){var n=e.pipes,i=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,r);return this}var s=k(e.pipes,t);return-1===s||(e.pipes.splice(s,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,r)),this},f.prototype.addListener=f.prototype.on=function(t,e){var r=i.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&_(this):v.nextTick(C,this))}return r},f.prototype.resume=function(){var t,e,r=this._readableState;return r.flowing||(w("resume"),r.flowing=!0,t=this,(e=r).resumeScheduled||(e.resumeScheduled=!0,v.nextTick(x,t,e))),this},f.prototype.pause=function(){return w("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(w("pause"),this._readableState.flowing=!1,this.emit("pause")),this},f.prototype.wrap=function(e){var r=this,n=this._readableState,i=!1;for(var t in e.on("end",function(){if(w("wrapped end"),n.decoder&&!n.ended){var t=n.decoder.end();t&&t.length&&r.push(t)}r.push(null)}),e.on("data",function(t){(w("wrapped data"),n.decoder&&(t=n.decoder.write(t)),n.objectMode&&null==t)||(n.objectMode||t&&t.length)&&(r.push(t)||(i=!0,e.pause()))}),e)void 0===this[t]&&"function"==typeof e[t]&&(this[t]=function(t){return function(){return e[t].apply(e,arguments)}}(t));for(var o=0;o<h.length;o++)e.on(h[o],this.emit.bind(this,h[o]));return this._read=function(t){w("wrapped _read",t),i&&(i=!1,e.resume())},this},Object.defineProperty(f.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),f._fromList=A}).call(this,N("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":98,"./internal/streams/BufferList":103,"./internal/streams/destroy":104,"./internal/streams/stream":105,_process:92,"core-util-is":14,events:13,inherits:80,isarray:106,"process-nextick-args":91,"safe-buffer":110,"string_decoder/":107,util:11}],101:[function(t,e,r){"use strict";e.exports=o;var n=t("./_stream_duplex"),i=t("core-util-is");function o(t){if(!(this instanceof o))return new o(t);n.call(this,t),this._transformState={afterTransform:function(t,e){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,(r.writecb=null)!=e&&this.push(e),n(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",s)}function s(){var r=this;"function"==typeof this._flush?this._flush(function(t,e){a(r,t,e)}):a(this,null,null)}function a(t,e,r){if(e)return t.emit("error",e);if(null!=r&&t.push(r),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}i.inherits=t("inherits"),i.inherits(o,n),o.prototype.push=function(t,e){return this._transformState.needTransform=!1,n.prototype.push.call(this,t,e)},o.prototype._transform=function(t,e,r){throw new Error("_transform() is not implemented")},o.prototype._write=function(t,e,r){var n=this._transformState;if(n.writecb=r,n.writechunk=t,n.writeencoding=e,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},o.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},o.prototype._destroy=function(t,e){var r=this;n.prototype._destroy.call(this,t,function(t){e(t),r.emit("close")})}},{"./_stream_duplex":98,"core-util-is":14,inherits:80}],102:[function(S,T,t){(function(t,e,r){"use strict";var v=S("process-nextick-args");function h(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function(t,e,r){var n=t.entry;t.entry=null;for(;n;){var i=n.callback;e.pendingcb--,i(r),n=n.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}(e,t)}}T.exports=c;var a,f=!t.browser&&-1<["v0.10","v0.9."].indexOf(t.version.slice(0,5))?r:v.nextTick;c.WritableState=u;var n=S("core-util-is");n.inherits=S("inherits");var i={deprecate:S("util-deprecate")},o=S("./internal/streams/stream"),y=S("safe-buffer").Buffer,b=e.Uint8Array||function(){};var s,l=S("./internal/streams/destroy");function w(){}function u(t,e){a=a||S("./_stream_duplex"),t=t||{};var r=e instanceof a;this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var n=t.highWaterMark,i=t.writableHighWaterMark,o=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r&&(i||0===i)?i:o,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var s=(this.destroyed=!1)===t.decodeStrings;this.decodeStrings=!s,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var r=t._writableState,n=r.sync,i=r.writecb;if(h=r,h.writing=!1,h.writecb=null,h.length-=h.writelen,h.writelen=0,e)s=t,a=r,l=n,u=e,c=i,--a.pendingcb,l?(v.nextTick(c,u),v.nextTick(_,s,a),s._writableState.errorEmitted=!0,s.emit("error",u)):(c(u),s._writableState.errorEmitted=!0,s.emit("error",u),_(s,a));else{var o=g(r);o||r.corked||r.bufferProcessing||!r.bufferedRequest||d(t,r),n?f(p,t,r,o,i):p(t,r,o,i)}var s,a,l,u,c;var h}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new h(this)}function c(t){if(a=a||S("./_stream_duplex"),!(s.call(c,this)||this instanceof a))return new c(t);this._writableState=new u(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),o.call(this)}function E(t,e,r,n,i,o,s){e.writelen=n,e.writecb=s,e.writing=!0,e.sync=!0,r?t._writev(i,e.onwrite):t._write(i,o,e.onwrite),e.sync=!1}function p(t,e,r,n){var i,o;r||(i=t,0===(o=e).length&&o.needDrain&&(o.needDrain=!1,i.emit("drain"))),e.pendingcb--,n(),_(t,e)}function d(t,e){e.bufferProcessing=!0;var r=e.bufferedRequest;if(t._writev&&r&&r.next){var n=e.bufferedRequestCount,i=new Array(n),o=e.corkedRequestsFree;o.entry=r;for(var s=0,a=!0;r;)(i[s]=r).isBuf||(a=!1),r=r.next,s+=1;i.allBuffers=a,E(t,e,!0,e.length,i,"",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new h(e),e.bufferedRequestCount=0}else{for(;r;){var l=r.chunk,u=r.encoding,c=r.callback;if(E(t,e,!1,e.objectMode?1:l.length,l,u,c),r=r.next,e.bufferedRequestCount--,e.writing)break}null===r&&(e.lastBufferedRequest=null)}e.bufferedRequest=r,e.bufferProcessing=!1}function g(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function m(e,r){e._final(function(t){r.pendingcb--,t&&e.emit("error",t),r.prefinished=!0,e.emit("prefinish"),_(e,r)})}function _(t,e){var r,n,i=g(e);return i&&(r=t,(n=e).prefinished||n.finalCalled||("function"==typeof r._final?(n.pendingcb++,n.finalCalled=!0,v.nextTick(m,r,n)):(n.prefinished=!0,r.emit("prefinish"))),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),i}n.inherits(c,o),u.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(u.prototype,"buffer",{get:i.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(s=Function.prototype[Symbol.hasInstance],Object.defineProperty(c,Symbol.hasInstance,{value:function(t){return!!s.call(this,t)||this===c&&(t&&t._writableState instanceof u)}})):s=function(t){return t instanceof this},c.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},c.prototype.write=function(t,e,r){var n,i,o,s,a,l,u,c,h,f,p,d=this._writableState,g=!1,m=!d.objectMode&&(n=t,y.isBuffer(n)||n instanceof b);return m&&!y.isBuffer(t)&&(i=t,t=y.from(i)),"function"==typeof e&&(r=e,e=null),m?e="buffer":e||(e=d.defaultEncoding),"function"!=typeof r&&(r=w),d.ended?(h=this,f=r,p=new Error("write after end"),h.emit("error",p),v.nextTick(f,p)):(m||(o=this,s=d,l=r,c=!(u=!0),null===(a=t)?c=new TypeError("May not write null values to stream"):"string"==typeof a||void 0===a||s.objectMode||(c=new TypeError("Invalid non-string/buffer chunk")),c&&(o.emit("error",c),v.nextTick(l,c),u=!1),u))&&(d.pendingcb++,g=function(t,e,r,n,i,o){if(!r){var s=function(t,e,r){t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=y.from(e,r));return e}(e,n,i);n!==s&&(r=!0,i="buffer",n=s)}var a=e.objectMode?1:n.length;e.length+=a;var l=e.length<e.highWaterMark;l||(e.needDrain=!0);if(e.writing||e.corked){var u=e.lastBufferedRequest;e.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},u?u.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else E(t,e,!1,a,n,i,o);return l}(this,d,m,t,e,r)),g},c.prototype.cork=function(){this._writableState.corked++},c.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||d(this,t))},c.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),c.prototype._write=function(t,e,r){r(new Error("_write() is not implemented"))},c.prototype._writev=null,c.prototype.end=function(t,e,r){var n=this._writableState;"function"==typeof t?(r=t,e=t=null):"function"==typeof e&&(r=e,e=null),null!=t&&this.write(t,e),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(t,e,r){e.ending=!0,_(t,e),r&&(e.finished?v.nextTick(r):t.once("finish",r));e.ended=!0,t.writable=!1}(this,n,r)},Object.defineProperty(c.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),c.prototype.destroy=l.destroy,c.prototype._undestroy=l.undestroy,c.prototype._destroy=function(t,e){this.end(),e(t)}}).call(this,S("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},S("timers").setImmediate)},{"./_stream_duplex":98,"./internal/streams/destroy":104,"./internal/streams/stream":105,_process:92,"core-util-is":14,inherits:80,"process-nextick-args":91,"safe-buffer":110,timers:112,"util-deprecate":115}],103:[function(t,e,r){"use strict";var a=t("safe-buffer").Buffer,n=t("util");e.exports=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.head=null,this.tail=null,this.length=0}return t.prototype.push=function(t){var e={data:t,next:null};0<this.length?this.tail.next=e:this.head=e,this.tail=e,++this.length},t.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},t.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},t.prototype.clear=function(){this.head=this.tail=null,this.length=0},t.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,r=""+e.data;e=e.next;)r+=t+e.data;return r},t.prototype.concat=function(t){if(0===this.length)return a.alloc(0);if(1===this.length)return this.head.data;for(var e,r,n,i=a.allocUnsafe(t>>>0),o=this.head,s=0;o;)e=o.data,r=i,n=s,e.copy(r,n),s+=o.data.length,o=o.next;return i},t}(),n&&n.inspect&&n.inspect.custom&&(e.exports.prototype[n.inspect.custom]=function(){var t=n.inspect({length:this.length});return this.constructor.name+" "+t})},{"safe-buffer":110,util:11}],104:[function(t,e,r){"use strict";var o=t("process-nextick-args");function s(t,e){t.emit("error",e)}e.exports={destroy:function(t,e){var r=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?e?e(t):!t||this._writableState&&this._writableState.errorEmitted||o.nextTick(s,this,t):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!e&&t?(o.nextTick(s,r,t),r._writableState&&(r._writableState.errorEmitted=!0)):e&&e(t)})),this},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},{"process-nextick-args":91}],105:[function(t,e,r){e.exports=t("events").EventEmitter},{events:13}],106:[function(t,e,r){var n={}.toString;e.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},{}],107:[function(t,e,r){"use strict";var n=t("safe-buffer").Buffer,i=n.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(n.isEncoding===i||!i(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=l,this.end=u,e=4;break;case"utf8":this.fillLast=a,e=4;break;case"base64":this.text=c,this.end=h,e=3;break;default:return this.write=f,void(this.end=p)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(e)}function s(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function a(t){var e=this.lastTotal-this.lastNeed,r=function(t,e,r){if(128!=(192&e[0]))return t.lastNeed=0,"�";if(1<t.lastNeed&&1<e.length){if(128!=(192&e[1]))return t.lastNeed=1,"�";if(2<t.lastNeed&&2<e.length&&128!=(192&e[2]))return t.lastNeed=2,"�"}}(this,t);return void 0!==r?r:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function l(t,e){if((t.length-e)%2!=0)return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1);var r=t.toString("utf16le",e);if(r){var n=r.charCodeAt(r.length-1);if(55296<=n&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}function u(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,r)}return e}function c(t,e){var r=(t.length-e)%3;return 0===r?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}function h(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function f(t){return t.toString(this.encoding)}function p(t){return t&&t.length?this.write(t):""}(r.StringDecoder=o).prototype.write=function(t){if(0===t.length)return"";var e,r;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""},o.prototype.end=function(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"�":e},o.prototype.text=function(t,e){var r=function(t,e,r){var n=e.length-1;if(n<r)return 0;var i=s(e[n]);if(0<=i)return 0<i&&(t.lastNeed=i-1),i;if(--n<r||-2===i)return 0;if(0<=(i=s(e[n])))return 0<i&&(t.lastNeed=i-2),i;if(--n<r||-2===i)return 0;if(0<=(i=s(e[n])))return 0<i&&(2===i?i=0:t.lastNeed=i-3),i;return 0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;var n=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",e,n)},o.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},{"safe-buffer":110}],108:[function(t,e,r){(((r=e.exports=t("./lib/_stream_readable.js")).Stream=r).Readable=r).Writable=t("./lib/_stream_writable.js"),r.Duplex=t("./lib/_stream_duplex.js"),r.Transform=t("./lib/_stream_transform.js"),r.PassThrough=t("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":98,"./lib/_stream_passthrough.js":99,"./lib/_stream_readable.js":100,"./lib/_stream_transform.js":101,"./lib/_stream_writable.js":102}],109:[function(t,e,r){"use strict";function n(t,e,r){var n=this;this._callback=t,this._args=r,this._interval=setInterval(t,e,this._args),this.reschedule=function(t){t||(t=n._interval),n._interval&&clearInterval(n._interval),n._interval=setInterval(n._callback,t,n._args)},this.clear=function(){n._interval&&(clearInterval(n._interval),n._interval=void 0)},this.destroy=function(){n._interval&&clearInterval(n._interval),n._callback=void 0,n._interval=void 0,n._args=void 0}}e.exports=function(){if("function"!=typeof arguments[0])throw new Error("callback needed");if("number"!=typeof arguments[1])throw new Error("interval needed");var t;if(0<arguments.length){t=new Array(arguments.length-2);for(var e=0;e<t.length;e++)t[e]=arguments[e+2]}return new n(arguments[0],arguments[1],t)}},{}],110:[function(t,e,r){var n=t("buffer"),i=n.Buffer;function o(t,e){for(var r in t)e[r]=t[r]}function s(t,e,r){return i(t,e,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(o(n,r),r.Buffer=s),o(i,s),s.from=function(t,e,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,e,r)},s.alloc=function(t,e,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");var n=i(t);return void 0!==e?"string"==typeof r?n.fill(e,r):n.fill(e):n.fill(0),n},s.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},s.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n.SlowBuffer(t)}},{buffer:12}],111:[function(t,e,r){e.exports=function(t){var e=t._readableState;return e?e.objectMode?t.read():t.read((r=e,r.buffer.length?r.buffer.head?r.buffer.head.data.length:r.buffer[0].length:r.length)):null;var r}},{}],112:[function(l,t,u){(function(t,e){var n=l("process/browser.js").nextTick,r=Function.prototype.apply,i=Array.prototype.slice,o={},s=0;function a(t,e){this._id=t,this._clearFn=e}u.setTimeout=function(){return new a(r.call(setTimeout,window,arguments),clearTimeout)},u.setInterval=function(){return new a(r.call(setInterval,window,arguments),clearInterval)},u.clearTimeout=u.clearInterval=function(t){t.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(window,this._id)},u.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},u.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},u._unrefActive=u.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;0<=e&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},u.setImmediate="function"==typeof t?t:function(t){var e=s++,r=!(arguments.length<2)&&i.call(arguments,1);return o[e]=!0,n(function(){o[e]&&(r?t.apply(null,r):t.call(null),u.clearImmediate(e))}),e},u.clearImmediate="function"==typeof e?e:function(t){delete o[t]}}).call(this,l("timers").setImmediate,l("timers").clearImmediate)},{"process/browser.js":92,timers:112}],113:[function(t,e,r){"use strict";var N=t("punycode"),O=t("./util");function x(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}r.parse=o,r.resolve=function(t,e){return o(t,!1,!0).resolve(e)},r.resolveObject=function(t,e){return t?o(t,!1,!0).resolveObject(e):e},r.format=function(t){O.isString(t)&&(t=o(t));return t instanceof x?t.format():x.prototype.format.call(t)},r.Url=x;var P=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,j=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,i=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),U=["'"].concat(i),D=["%","/","?",";","#"].concat(U),B=["/","?","#"],F=/^[+a-z0-9A-Z_-]{0,63}$/,V=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,Y={javascript:!0,"javascript:":!0},q={javascript:!0,"javascript:":!0},W={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},G=t("querystring");function o(t,e,r){if(t&&O.isObject(t)&&t instanceof x)return t;var n=new x;return n.parse(t,e,r),n}x.prototype.parse=function(t,e,r){if(!O.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var n=t.indexOf("?"),i=-1!==n&&n<t.indexOf("#")?"?":"#",o=t.split(i);o[0]=o[0].replace(/\\/g,"/");var s=t=o.join(i);if(s=s.trim(),!r&&1===t.split("#").length){var a=j.exec(s);if(a)return this.path=s,this.href=s,this.pathname=a[1],a[2]?(this.search=a[2],this.query=e?G.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var l=P.exec(s);if(l){var u=(l=l[0]).toLowerCase();this.protocol=u,s=s.substr(l.length)}if(r||l||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var c="//"===s.substr(0,2);!c||l&&q[l]||(s=s.substr(2),this.slashes=!0)}if(!q[l]&&(c||l&&!W[l])){for(var h,f,p=-1,d=0;d<B.length;d++){-1!==(g=s.indexOf(B[d]))&&(-1===p||g<p)&&(p=g)}-1!==(f=-1===p?s.lastIndexOf("@"):s.lastIndexOf("@",p))&&(h=s.slice(0,f),s=s.slice(f+1),this.auth=decodeURIComponent(h)),p=-1;for(d=0;d<D.length;d++){var g;-1!==(g=s.indexOf(D[d]))&&(-1===p||g<p)&&(p=g)}-1===p&&(p=s.length),this.host=s.slice(0,p),s=s.slice(p),this.parseHost(),this.hostname=this.hostname||"";var m="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!m)for(var v=this.hostname.split(/\./),y=(d=0,v.length);d<y;d++){var b=v[d];if(b&&!b.match(F)){for(var w="",E=0,_=b.length;E<_;E++)127<b.charCodeAt(E)?w+="x":w+=b[E];if(!w.match(F)){var S=v.slice(0,d),T=v.slice(d+1),I=b.match(V);I&&(S.push(I[1]),T.unshift(I[2])),T.length&&(s="/"+T.join(".")+s),this.hostname=S.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),m||(this.hostname=N.toASCII(this.hostname));var C=this.port?":"+this.port:"",x=this.hostname||"";this.host=x+C,this.href+=this.host,m&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!Y[u])for(d=0,y=U.length;d<y;d++){var L=U[d];if(-1!==s.indexOf(L)){var A=encodeURIComponent(L);A===L&&(A=escape(L)),s=s.split(L).join(A)}}var M=s.indexOf("#");-1!==M&&(this.hash=s.substr(M),s=s.slice(0,M));var R=s.indexOf("?");if(-1!==R?(this.search=s.substr(R),this.query=s.substr(R+1),e&&(this.query=G.parse(this.query)),s=s.slice(0,R)):e&&(this.search="",this.query={}),s&&(this.pathname=s),W[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){C=this.pathname||"";var k=this.search||"";this.path=C+k}return this.href=this.format(),this},x.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",n=this.hash||"",i=!1,o="";this.host?i=t+this.host:this.hostname&&(i=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&O.isObject(this.query)&&Object.keys(this.query).length&&(o=G.stringify(this.query));var s=this.search||o&&"?"+o||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||W[e])&&!1!==i?(i="//"+(i||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),s&&"?"!==s.charAt(0)&&(s="?"+s),e+i+(r=r.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(s=s.replace("#","%23"))+n},x.prototype.resolve=function(t){return this.resolveObject(o(t,!1,!0)).format()},x.prototype.resolveObject=function(t){if(O.isString(t)){var e=new x;e.parse(t,!1,!0),t=e}for(var r=new x,n=Object.keys(this),i=0;i<n.length;i++){var o=n[i];r[o]=this[o]}if(r.hash=t.hash,""===t.href)return r.href=r.format(),r;if(t.slashes&&!t.protocol){for(var s=Object.keys(t),a=0;a<s.length;a++){var l=s[a];"protocol"!==l&&(r[l]=t[l])}return W[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(t.protocol&&t.protocol!==r.protocol){if(!W[t.protocol]){for(var u=Object.keys(t),c=0;c<u.length;c++){var h=u[c];r[h]=t[h]}return r.href=r.format(),r}if(r.protocol=t.protocol,t.host||q[t.protocol])r.pathname=t.pathname;else{for(var f=(t.pathname||"").split("/");f.length&&!(t.host=f.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),r.pathname=f.join("/")}if(r.search=t.search,r.query=t.query,r.host=t.host||"",r.auth=t.auth,r.hostname=t.hostname||t.host,r.port=t.port,r.pathname||r.search){var p=r.pathname||"",d=r.search||"";r.path=p+d}return r.slashes=r.slashes||t.slashes,r.href=r.format(),r}var g=r.pathname&&"/"===r.pathname.charAt(0),m=t.host||t.pathname&&"/"===t.pathname.charAt(0),v=m||g||r.host&&t.pathname,y=v,b=r.pathname&&r.pathname.split("/")||[],w=(f=t.pathname&&t.pathname.split("/")||[],r.protocol&&!W[r.protocol]);if(w&&(r.hostname="",r.port=null,r.host&&(""===b[0]?b[0]=r.host:b.unshift(r.host)),r.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===f[0]?f[0]=t.host:f.unshift(t.host)),t.host=null),v=v&&(""===f[0]||""===b[0])),m)r.host=t.host||""===t.host?t.host:r.host,r.hostname=t.hostname||""===t.hostname?t.hostname:r.hostname,r.search=t.search,r.query=t.query,b=f;else if(f.length)b||(b=[]),b.pop(),b=b.concat(f),r.search=t.search,r.query=t.query;else if(!O.isNullOrUndefined(t.search)){if(w)r.hostname=r.host=b.shift(),(I=!!(r.host&&0<r.host.indexOf("@"))&&r.host.split("@"))&&(r.auth=I.shift(),r.host=r.hostname=I.shift());return r.search=t.search,r.query=t.query,O.isNull(r.pathname)&&O.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r}if(!b.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var E=b.slice(-1)[0],_=(r.host||t.host||1<b.length)&&("."===E||".."===E)||""===E,S=0,T=b.length;0<=T;T--)"."===(E=b[T])?b.splice(T,1):".."===E?(b.splice(T,1),S++):S&&(b.splice(T,1),S--);if(!v&&!y)for(;S--;S)b.unshift("..");!v||""===b[0]||b[0]&&"/"===b[0].charAt(0)||b.unshift(""),_&&"/"!==b.join("/").substr(-1)&&b.push("");var I,C=""===b[0]||b[0]&&"/"===b[0].charAt(0);w&&(r.hostname=r.host=C?"":b.length?b.shift():"",(I=!!(r.host&&0<r.host.indexOf("@"))&&r.host.split("@"))&&(r.auth=I.shift(),r.host=r.hostname=I.shift()));return(v=v||r.host&&b.length)&&!C&&b.unshift(""),b.length?r.pathname=b.join("/"):(r.pathname=null,r.path=null),O.isNull(r.pathname)&&O.isNull(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=t.auth||r.auth,r.slashes=r.slashes||t.slashes,r.href=r.format(),r},x.prototype.parseHost=function(){var t=this.host,e=n.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},{"./util":114,punycode:93,querystring:96}],114:[function(t,e,r){"use strict";e.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},{}],115:[function(t,e,r){(function(r){function n(t){try{if(!r.localStorage)return!1}catch(t){return!1}var e=r.localStorage[t];return null!=e&&"true"===String(e).toLowerCase()}e.exports=function(t,e){if(n("noDeprecation"))return t;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(e);n("traceDeprecation")?console.trace(e):console.warn(e),r=!0}return t.apply(this,arguments)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],116:[function(t,e,r){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],117:[function(f,t,x){(function(n,i){var a=/%[sdj%]/g;x.format=function(t){if(!w(t)){for(var e=[],r=0;r<arguments.length;r++)e.push(l(arguments[r]));return e.join(" ")}r=1;for(var n=arguments,i=n.length,o=String(t).replace(a,function(t){if("%%"===t)return"%";if(i<=r)return t;switch(t){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(t){return"[Circular]"}default:return t}}),s=n[r];r<i;s=n[++r])y(s)||!c(s)?o+=" "+s:o+=" "+l(s);return o},x.deprecate=function(t,e){if(E(i.process))return function(){return x.deprecate(t,e).apply(this,arguments)};if(!0===n.noDeprecation)return t;var r=!1;return function(){if(!r){if(n.throwDeprecation)throw new Error(e);n.traceDeprecation?console.trace(e):console.error(e),r=!0}return t.apply(this,arguments)}};var t,o={};function l(t,e){var r={seen:[],stylize:u};return 3<=arguments.length&&(r.depth=arguments[2]),4<=arguments.length&&(r.colors=arguments[3]),v(e)?r.showHidden=e:e&&x._extend(r,e),E(r.showHidden)&&(r.showHidden=!1),E(r.depth)&&(r.depth=2),E(r.colors)&&(r.colors=!1),E(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=s),p(r,t,r.depth)}function s(t,e){var r=l.styles[e];return r?"["+l.colors[r][0]+"m"+t+"["+l.colors[r][1]+"m":t}function u(t,e){return t}function p(e,r,n){if(e.customInspect&&r&&I(r.inspect)&&r.inspect!==x.inspect&&(!r.constructor||r.constructor.prototype!==r)){var t=r.inspect(n,e);return w(t)||(t=p(e,t,n)),t}var i=function(t,e){if(E(e))return t.stylize("undefined","undefined");if(w(e)){var r="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(r,"string")}if(b(e))return t.stylize(""+e,"number");if(v(e))return t.stylize(""+e,"boolean");if(y(e))return t.stylize("null","null")}(e,r);if(i)return i;var o,s=Object.keys(r),a=(o={},s.forEach(function(t,e){o[t]=!0}),o);if(e.showHidden&&(s=Object.getOwnPropertyNames(r)),T(r)&&(0<=s.indexOf("message")||0<=s.indexOf("description")))return d(r);if(0===s.length){if(I(r)){var l=r.name?": "+r.name:"";return e.stylize("[Function"+l+"]","special")}if(_(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(S(r))return e.stylize(Date.prototype.toString.call(r),"date");if(T(r))return d(r)}var u,c="",h=!1,f=["{","}"];(m(r)&&(h=!0,f=["[","]"]),I(r))&&(c=" [Function"+(r.name?": "+r.name:"")+"]");return _(r)&&(c=" "+RegExp.prototype.toString.call(r)),S(r)&&(c=" "+Date.prototype.toUTCString.call(r)),T(r)&&(c=" "+d(r)),0!==s.length||h&&0!=r.length?n<0?_(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),u=h?function(e,r,n,i,t){for(var o=[],s=0,a=r.length;s<a;++s)C(r,String(s))?o.push(g(e,r,n,i,String(s),!0)):o.push("");return t.forEach(function(t){t.match(/^\d+$/)||o.push(g(e,r,n,i,t,!0))}),o}(e,r,n,a,s):s.map(function(t){return g(e,r,n,a,t,h)}),e.seen.pop(),function(t,e,r){if(60<t.reduce(function(t,e){return 0,0<=e.indexOf("\n")&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0))return r[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+r[1];return r[0]+e+" "+t.join(", ")+" "+r[1]}(u,c,f)):f[0]+c+f[1]}function d(t){return"["+Error.prototype.toString.call(t)+"]"}function g(t,e,r,n,i,o){var s,a,l;if((l=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]}).get?a=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(a=t.stylize("[Setter]","special")),C(n,i)||(s="["+i+"]"),a||(t.seen.indexOf(l.value)<0?-1<(a=y(r)?p(t,l.value,null):p(t,l.value,r-1)).indexOf("\n")&&(a=o?a.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+a.split("\n").map(function(t){return"   "+t}).join("\n")):a=t.stylize("[Circular]","special")),E(s)){if(o&&i.match(/^\d+$/))return a;s=(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),t.stylize(s,"string"))}return s+": "+a}function m(t){return Array.isArray(t)}function v(t){return"boolean"==typeof t}function y(t){return null===t}function b(t){return"number"==typeof t}function w(t){return"string"==typeof t}function E(t){return void 0===t}function _(t){return c(t)&&"[object RegExp]"===e(t)}function c(t){return"object"==typeof t&&null!==t}function S(t){return c(t)&&"[object Date]"===e(t)}function T(t){return c(t)&&("[object Error]"===e(t)||t instanceof Error)}function I(t){return"function"==typeof t}function e(t){return Object.prototype.toString.call(t)}function r(t){return t<10?"0"+t.toString(10):t.toString(10)}x.debuglog=function(e){if(E(t)&&(t=n.env.NODE_DEBUG||""),e=e.toUpperCase(),!o[e])if(new RegExp("\\b"+e+"\\b","i").test(t)){var r=n.pid;o[e]=function(){var t=x.format.apply(x,arguments);console.error("%s %d: %s",e,r,t)}}else o[e]=function(){};return o[e]},(x.inspect=l).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},l.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},x.isArray=m,x.isBoolean=v,x.isNull=y,x.isNullOrUndefined=function(t){return null==t},x.isNumber=b,x.isString=w,x.isSymbol=function(t){return"symbol"==typeof t},x.isUndefined=E,x.isRegExp=_,x.isObject=c,x.isDate=S,x.isError=T,x.isFunction=I,x.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},x.isBuffer=f("./support/isBuffer");var h=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function C(t,e){return Object.prototype.hasOwnProperty.call(t,e)}x.log=function(){var t,e;console.log("%s - %s",(t=new Date,e=[r(t.getHours()),r(t.getMinutes()),r(t.getSeconds())].join(":"),[t.getDate(),h[t.getMonth()],e].join(" ")),x.format.apply(x,arguments))},x.inherits=f("inherits"),x._extend=function(t,e){if(!e||!c(e))return t;for(var r=Object.keys(e),n=r.length;n--;)t[r[n]]=e[r[n]];return t}}).call(this,f("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":116,_process:92,inherits:80}],118:[function(t,e,r){(function(m,v){"use strict";var y=t("readable-stream").Transform,b=t("duplexify"),w=t("ws"),E=t("safe-buffer").Buffer;e.exports=function(t,e,r){var n,i,o="browser"===m.title,s=!!v.WebSocket,a=o?function t(e,r,n){if(i.bufferedAmount>p)return void setTimeout(t,d,e,r,n);g&&"string"==typeof e&&(e=E.from(e,"utf8"));try{i.send(e)}catch(t){return n(t)}n()}:function(t,e,r){if(i.readyState!==i.OPEN)return void r();g&&"string"==typeof t&&(t=E.from(t,"utf8"));i.send(t,r)};e&&!Array.isArray(e)&&"object"==typeof e&&(r=e,e=null,("string"==typeof r.protocol||Array.isArray(r.protocol))&&(e=r.protocol));r||(r={});void 0===r.objectMode&&(r.objectMode=!(!0===r.binary||void 0===r.binary));var l=(u=r,c=a,h=function(t){i.close(),t()},f=new y({objectMode:u.objectMode}),f._write=c,f._flush=h,f);var u,c,h,f;r.objectMode||(l._writev=function(t,e){for(var r=new Array(t.length),n=0;n<t.length;n++)"string"==typeof t[n].chunk?r[n]=E.from(t[n],"utf8"):r[n]=t[n].chunk;this._write(E.concat(r),"binary",e)});var p=r.browserBufferSize||524288,d=r.browserBufferTimeout||1e3;"object"==typeof t?i=t:(i=s&&o?new w(t,e):new w(t,e,r)).binaryType="arraybuffer";i.readyState===i.OPEN?n=l:(n=b.obj(),i.onopen=function(){n.setReadable(l),n.setWritable(l),n.emit("connect")});(n.socket=i).onclose=function(){n.end(),n.destroy()},i.onerror=function(t){n.destroy(t)},i.onmessage=function(t){var e=t.data;e=e instanceof ArrayBuffer?E.from(e):E.from(e,"utf8");l.push(e)},l.on("close",function(){i.close()});var g=!r.objectMode;return n}}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:92,duplexify:17,"readable-stream":108,"safe-buffer":110,ws:119}],119:[function(t,e,r){var n=null;"undefined"!=typeof WebSocket?n=WebSocket:"undefined"!=typeof MozWebSocket?n=MozWebSocket:"undefined"!=typeof window&&(n=window.WebSocket||window.MozWebSocket),e.exports=n},{}],120:[function(t,e,r){e.exports=function t(i,e){if(i&&e)return t(i)(e);if("function"!=typeof i)throw new TypeError("need wrapper function");Object.keys(i).forEach(function(t){r[t]=i[t]});return r;function r(){for(var t=new Array(arguments.length),e=0;e<t.length;e++)t[e]=arguments[e];var r=i.apply(this,t),n=t[t.length-1];return"function"==typeof r&&r!==n&&Object.keys(n).forEach(function(t){r[t]=n[t]}),r}}},{}],121:[function(t,e,r){e.exports=function(){for(var t={},e=0;e<arguments.length;e++){var r=arguments[e];for(var n in r)i.call(r,n)&&(t[n]=r[n])}return t};var i=Object.prototype.hasOwnProperty},{}]},{},[9])(9)});var ErrorConstant={check_webrtc_supported:{code:2e3,message:"此浏览器不支持WebRTC"},not_support_mediaStreamTrack:{code:2001,message:"此浏览器不支持MediaStreamTrack."},screen_sharing_plugin_not_accessible:{code:2003,message:"屏幕共享插件找不到"},screen_sharing_response_is_null:{code:2004,message:"没有屏幕共享"},not_join_room:{code:2005,message:"还未加会"},navigatorUserMediaError_notSupportedError:{code:2010,message:"打开设备权限不足，原因是非https访问"},navigatorUserMediaError_overconstrainedError:{code:2011,message:"设备打开失败，因为设备约束可能不满足"},navigatorUserMediaError_trackStartError:{code:2012,message:"设备打开失败，因为设备已被占用"},navigatorUserMediaError_notAllowedError:{code:2013,message:"打开设备权限不足，原因是用户拒绝了媒体访问请求"},navigatorUserMediaError_typeError:{code:2014,message:"设备打开失败，因为至少有一个音频和视频被请求"},navigatorUserMediaError_unknown:{code:2015,message:"设备打开失败未知错误"},navigatorUserMediaError_notFoundError:{code:2016,message:"设备打开失败，请确保想要打开的音/视频设备连接正常"},navigatorDisplayMediaError_notSupportedError:{code:2030,message:"打开桌面共享权限不足，原因是非https访问"},navigatorDisplayMediaError_overconstrainedError:{code:2031,message:"打开桌面共享失败，因为桌面共享约束可能不满足"},navigatorDisplayMediaError_notAllowedError:{code:2033,message:"打开桌面共享失败，原因用户没有选择共享内容，就做了退出操作"},navigatorDisplayMediaError_unknown:{code:2035,message:"桌面共享打开失败未知错误"},cameraId_does_not_exist:{code:2017,message:"摄像头ID不存在"},closeVideo_before_operation_warnings:{code:2018,message:"请关闭摄像头以后再进行此操作"},open_device_no_response:{code:2019,message:"设备打开无响应，请重启浏览器后重试"},websock_create_error:{code:2020,message:"Websocket创建失败"},websock_catch_exception:{code:2021,message:"Websocket操作失败"},join_room_timeout:{code:1014,message:"加会超时"},oemname_notfound:{code:1017,message:"OEM名称没找到"},avdEngine_init_failed:{code:1018,message:"sdk引擎初始化失败"},userId_format:{code:1309,message:"userId不能带_字符"},userId_required:{code:1300,message:"userId是必须项，不能为空"},mulLanding_error:{code:1301,message:"同一个userId不能多次登录"},roomId_required:{code:1302,message:"roomId是必须项，不能为空"},params_require:{code:1303,message:"params是必须项，不能为空"},userAddress_require:{code:1304,message:"userAddress是必须项，不能为空"},ft_no_authorization:{code:1305,message:"模块无授权."},exporter_parameter_type_error:{code:1401,message:"参数类型错误"},exporter_parameter_number_error:{code:1402,message:"参数范围错误，x,y,width,height请输入0 - 1 之间的数值"},exporter_parameter_number1_error:{code:1403,message:"参数范围错误，zorder请输入0 - 10 之间的数值"},exporter_parameter_lack_error:{code:1404,message:"缺少必要的参数"},video_not_exporter_error:{code:1405,message:"该视频还未开始录制"},video_has_exporter_error:{code:1406,message:"该视频已经开始录制不要重复录制"},exporter_mix_start_error:{code:1407,message:"还未添加任何视频，无法进行混屏录制"},video_and_userId_error:{code:1408,message:"用户Id和设备Id不匹配"},exporter_has_stop_error:{code:1409,message:"录制已经停止"}},FTConstant={datachannel:{name:"透明通道",value:"ft_datachannel"},chat:{name:"聊天",value:"ft_chat"},audio:{name:"语音",value:"ft_audio"},video:{name:"普通视频",value:"ft_video"},video_hd:{name:"高清视频",value:"ft_video_hd"},screen:{name:"屏幕共享",value:"ft_screen"},annotation:{name:"注释白板",value:"ft_annotation"},p2p:{name:"P2P房间",value:"ft_p2p"},avei:{name:"音视频导入导出",value:"ft_avei"},h265:{name:"H265模块",value:"ft_h265"},client_record_audio:{name:"客户端音频录制",value:"ft_client_record_audio"},client_record_video:{name:"客户端视频录制",value:"ft_client_record_video"},clinet_livebroadcast:{name:"客户端直播路数",value:"ft_clinet_livebroadcast"},record_audio:{name:"录制音频",value:"ft_record_audio"},record_video:{name:"录制视频",value:"ft_record_video"},outgoing:{name:"设备集成，如rtsp、h323、sip等",value:"ft_outgoing"},livebroadcast:{name:"旁路直播",value:"ft_livebroadcast"},platform_android:{name:"Android系统",value:"ft_platform_android"},platform_ios:{name:"ios系统",value:"ft_platform_ios"},platform_win:{name:"windows桌面系统",value:"ft_platform_win"},platform_mac:{name:"mac ox桌面系统",value:"ft_platform_mac"},platform_linux:{name:"linux桌面系统",value:"ft_platform_linux"},platform_web:{name:"web js系统",value:"ft_platform_web"},server_platform_linux:{name:"服务器平台linux",value:"ft_server_platform_linux"},server_platform_win:{name:"服务器平台windows",value:"ft_server_platform_win"},server_platform_linux_cluster:{name:"服务器平台linux集群",value:"ft_server_platform_linux_cluster"}},USER_AGENT_AVD_DEFAULT="web",USER_AGENT_AVD_VIDEO_TRANSCODING="avd_video_transcoding",USER_AGENT_AVD_MEDIA_MIXER="avd_media_mixer",USER_AGENT_AVD_MEDIA_MIXER_ADMIN="avd_media_mixer_admin",USER_AGENT_AVD_THROWING_SCREEN_ANONYM="avd_throwing_screen_anonym",ModulesEnum={avdEngine:"AVDEngine",browserDetect:"BrowserDetect",video:"Video",audio:"Audio",error:"Error",annotation:"Annotation",client:"Client"},Appender={alert:1,inpage:2,popup:3,browserConsole:4},LogLevel={all:1,trace:2,debug:3,info:4,warn:5,error:6,fatal:7,off:8},SignalType={websocket:"websocket",dataChannel:"dataChannel"},RoomTypeEnum={join_host_first:"join.host.first",net_acc:"net.acc",host_control:"host.control",free_speech:"free.speech"},roomTypePrivilige={join_host_first:2,net_acc:4,host_control:8},EngineCallback={room_join_success:"room.join.success",room_join_error:"room.join.error",room_join_websocket_reconnection_success:"room.join.websocket.reconnection.success",pub_roomresourcemsg_rep_success:"pub.roomresourcemsg.rep.success",pub_roomresourcemsg_rep_error:"pub.roomresourcemsg.rep.error"},VideoCodingType={VP8:0,VP9:1,H264:2},AudioCodingType={ISAC_16k:0,ISAC_32k:1,opus:2,G722:3,PCMA:4,PCMU:5},Resolution={"1920*1280":{width:1920,height:1280,order:16},"1920*1080":{width:1920,height:1080,order:15},"1280*1024":{width:1280,height:1024,order:14},"1280*720":{width:1280,height:720,order:13},"960*720":{width:960,height:720,order:12},"640*1024":{width:640,height:1024,order:11},"640*960":{width:640,height:960,order:10},"640*480":{width:640,height:480,order:9},"640*360":{width:640,height:360,order:8},"508*360":{width:508,height:360,order:7},"480*854":{width:480,height:854,order:6},"480*800":{width:480,height:800,order:5},"320*480":{width:320,height:480,order:4},"320*240":{width:320,height:240,order:3},"320*180":{width:320,height:180,order:2},"160*120":{width:160,height:120,order:1}},ResolutionSetType={exact:0,ideal:1},ConnectionStatus={init:0,connecting:1,connected:2,connectFailed:3,reJoinRoomTimeOut:4,reJoinConnected:5,reconnected:6},MCUPeerConnectionStatus={failed:0,completed:1},RoomStatus={scheduled:0,opening:1,locked:2,closed:3};StreamStatus={none:0,init:1,published:2,muted:3,forbided:4,subed:5,opened:6},CameraType={unknown:0,front:1,back:2},VideoQualityType={high:4,normal:3,low:2};var RoomCallback={connection_status:"connection.status",connection_indicator:"connection.indicator",room_status_notify:"room.status.notify",app_data_notify:"app.data.notify",user_data_notify:"user.data.notify",user_name_notify:"user.name.notify",public_data:"public.data",private_data:"private.data",public_message:"public.message ",private_message:"private.message",user_join_notify:"user.join.notify",user_leave_notify:"user.leave.notify",leave_indication:"leave.indication",close_room_result:"close.room.result",close_room_notify:"close.room.notify",screen_sharing_ended:"screen.sharing.ended",mcu_peerconnection_completed:"mcu.peerconnection.completed",outgoing_invite_status_notify:"outgoing.invite.status.notify",room_control_change_notify:"room.control.change.notify"},UserCallback={microphone_status_notify:"microphone.status.notify",camera_status_notify:"camera.status.notify",screen_status_notify:"screen.status.notify",camera_data_notify:"camera.data.notify",screen_data_notify:"screen.data.notify",publish_camera_notify:"publish.camera.notify",unpublish_camera_notify:"unpublish.camera.notify",subscrible_camera_result:"subscrible.camera.result",unsubscrible_camera_result:"unsubscrible.camera.result",publish_screen_notify:"publish.screen.notify",unpublish_screen_notify:"unpublish.screen.notify",subscrible_screen_result:"subscrible.screen.result",unsubscrible_screen_result:"unsubscrible.screen.result",publish_microphone_notify:"publish.microphone.notify",unpublish_microphone_notify:"unpublish.microphone.notify",subscrible_microphone_result:"subscrible.microphone.result",unsubscrible_microphone_result:"unsubscrible.microphone.result",board_add_result:"board.add.result",board_remove_result:"board.remove.result",board_share_result:"board.share.result",board_close_result:"board.close.result",room_set_stream_name_rep_success:"room.set.stream.name.rep.success",room_set_stream_name_rep_error:"room.set.stream.name.rep.error"},ExporderCallBack={stop_stream_rep_success:"stop.stream.rep.success",stop_stream_rep_error:"stop.stream.rep.error",pause_stream_rep_error:"pause.stream.rep.error",pause_stream_rep_success:"pause.stream.rep.success",mix_media_rep_error:"mix.media.rep.error",mix_media_rep_success:"mix.media.rep.success",select_stream_rep_success:"select.stream.rep.success",select_stream_rep_error:"select.stream.rep.error",create_server_recorder_rep_success:"create.server.recorder.rep.success",create_server_recorder_rep_error:"create.server.recorder.rep.error",bind_audio2video_rep_success:"bind.audio2video.rep.success",bind_audio2video_rep_error:"bind.audio2video.rep.error",set_focus_video_rep_success:"set.focus.video.rep.success",set_focus_video_rep_error:"set.focus.video.rep.error",get_exporter_info_rep_success:"get.exporter.info.rep.success",get_exporter_info_rep_error:"get.exporter.info.rep.error"};OperType={add:1,remove:2,update:3,share:4,close:5};var RecordEnum={VideoType:{novideo:0,mainflow:1,auxiliaryflow1:2,auxiliaryflow2:3},AudioType:{noaudio:0,singleuser:1,allusers:2},FileType:{mp4:0,webM:1}},LiveEnum={VideoType:{novideo:0,mainflow:1,auxiliaryflow1:2,auxiliaryflow2:3},AudioType:{noaudio:0,singleuser:1,allusers:2}},shapeTypeEnum={mouse:1,line:2,rect:3,ellipse:4,polyline:5,hlight_point:7,hlight_texttag:8,eraser:9,rhomb:11,arrow:12,success:13,failure:14,clear:17},boardStatusEnum={close:0,open:1},annoSelectTypeEnum={mouse:1,draw:2,eraser:3},canvasTypeEnum={mouse:1,line:2,rect:3,ellipse:4,polyline:5,hlight_point:7,hlight_texttag:8,eraser:9,rhomb:11,arrow:12,success:13,failure:14,clear:17},fillTypeEnum={none:1,full:2},arrowTypeEnum={none:1,begin:2,end:3,double:4},connectionEventTypeEnum={sendVideo:1,recvVideo:2,sendAudio:3,recvAudio:4,conndidate:5},exporterTypeEnum={record:0,record_real_time:1,liver:2,avc_media_mixer:7},viewLayoutModeEnum={fixation:0,auto:1,auto_orato:2},exporterStatusEnum={stop:0,live:1,pause:2},recorderAudioEnum={AVD_userId_allUser:"userId2allUser",AVD_userId_allUserWithoutMe:"userId2withoutMe",AVD_userId_noneUser:"userId2None"},appDataKeyEnum={lecturer:"meeting_lecturer",voiceActivated:"voice_activated"},arrayUtil={intersection:function(t,e){for(var r=new Object,n=0,i=t.length;n<i;n++)r[t[n]]=t[n];for(n=0,i=e.length;n<i;n++)r[e[n]]=e[n];var o=new Array;n=0;for(var s in r)o[n++]=r[s];return o},chaji:function(t,e){for(var r=new Object,n=0,i=t.length;n<i;n++)r[t[n]]=1;for(n=0,i=e.length;n<i;n++)r[e[n]]=r[e[n]]?2:1;var o=new Array;n=0;for(var s in r)1==r[s]&&(o[n++]=s);return o},chajiObject:function(t,e){for(var r=new Object,n=0,i=t.length;n<i;n++)r[t[n].nodeId]=1;for(n=0,i=e.length;n<i;n++)r[e[n].nodeId]=r[e[n].nodeId]?2:1;var o=new Array;n=0;for(var s in r)1==r[s]&&(o[n++]=s);return o},inANotInB:function(t,e){for(var r=new Object,n=0,i=t.length;n<i;n++)r[t[n]]=1;for(n=0,i=e.length;n<i;n++)r.hasOwnProperty(e[n])&&(r[e[n]]=void 0);var o=new Array;n=0;for(var s in r)r[s]&&(o[n++]=s);return o},baseSplice:function(t,e){for(var r,n=0;n<t.length;n++){if(t[n]==e){r=n;break}}-1<r&&t.splice(r,1)},objectSplice:function(t,e){for(var r,n=0;n<t.length;n++){if(t[n].id==e){r=n;break}}-1<r&&t.splice(r,1)},userIdSplice:function(t,e){for(var r,n=0;n<t.length;n++){if(t[n].userId==e){r=n;break}}-1<r&&t.splice(r,1)}};function getRandomNum(t,e){var r=e-t,n=Math.random();return t+Math.round(n*r)}var typeConversionUtil={String2ArrayBuffer:function(t){t=btoa(unescape(encodeURIComponent(t)));for(var e=new ArrayBuffer(t.length),r=new Uint8Array(e),n=0,i=t.length;n<i;n++)r[n]=t.charCodeAt(n);return e},ArrayBuffer2String:function(t){var e=String.fromCharCode.apply(null,new Uint8Array(t));return decodeURIComponent(escape(atob(e)))},Uint8ArrayToString:function(t){for(var e="",r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},stringToUint8Array:function(t){for(var e=[],r=0,n=t.length;r<n;++r)e.push(t.charCodeAt(r));return new Uint8Array(e)}};function resizeVideo(t,e,r){doResizeVideo(t,e,r,!1)}function resizeRealVideo(t,e,r){doResizeVideo(t,e,r,!0)}function doResizeVideo(n,i,o,s){i||(i=window.innerWidth),o||(o=window.innerHeight),n.addEventListener("loadedmetadata",function(t){var e=this.videoWidth,r=this.videoHeight;positionLarge(n,e,r,i,o,s)})}function positionLarge(t,e,r,n,i,o){var s,a=(s=o?getCameraRealVideoSize(e,r,n,i):getCameraVideoSize(e,r,n,i))[0],l=s[1],u=getCameraVideoPosition(a,l,n,i),c=u[0],h=u[1];o?positionRealVideo(t,a,l,c,h):positionVideo(t,a,l,c,h)}function getCameraVideoSize(t,e,r,n){var i=t/e;return(r=Math.max(t,r))/i<(n=Math.max(e,n))&&(r=(n=n)*i),n*i<r&&(n=(r=r)/i),[r,n]}function getCameraRealVideoSize(t,e,r,n){var i=t/e,o=Math.max(t,r),s=Math.max(e,n);t<=o&&e<=s?r/n<i?n=(r=r)/i:r=(n=n)*i:((n=s)<(r=o)/i&&(r=(n=n)*i),r<n*i&&(n=(r=r)/i));return[r,n]}function getCameraVideoPosition(t,e,r,n){return[(r-t)/2,(n-e)/2]}function positionVideo(t,e,r,n,i){t.setAttribute("width",e),t.setAttribute("height",r)}function positionRealVideo(t,e,r,n,i){t.setAttribute("width",e),t.setAttribute("height",r);var o=t.parentNode;o.style.top=i+"px",o.style.bottom=i+"px",o.style.left=n+"px",o.style.right=n+"px"}function fullScreenInit(){document.cancelFullScreen=document.webkitCancelFullScreen||document.mozCancelFullScreen||document.cancelFullScreen,document.body.requestFullScreen=document.body.webkitRequestFullScreen||document.body.mozRequestFullScreen||document.body.requestFullScreen,document.onfullscreenchange=document.onwebkitfullscreenchange=document.onmozfullscreenchange=displayFullScreenStatus,displayFullScreenStatus()}function doFullScreen(t,e){t.requestFullScreen=t.webkitRequestFullScreen||t.mozRequestFullScreen||t.requestFullScreen,isFullScreen()&&e.target!==t||fullScreenElement()===t?document.cancelFullScreen():(e.target,t.requestFullScreen())}function displayFullScreenStatus(){isFullScreen()}function isFullScreen(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.isFullScreen)}function fullScreenElement(){return document.webkitFullScreenElement||document.webkitCurrentFullScreenElement||document.mozFullScreenElement||document.fullScreenElement}function doFullScreenInIE(t){window.innerWidth?winWidth=window.innerWidth:document.body&&document.body.clientWidth&&(winWidth=document.body.clientWidth),window.innerHeight?winHeight=window.innerHeight:document.body&&document.body.clientHeight&&(winHeight=document.body.clientHeight),document.documentElement&&document.documentElement.clientHeight&&document.documentElement.clientWidth&&(winHeight=document.documentElement.clientHeight,winWidth=document.documentElement.clientWidth);var e=window.createPopup(),r=e.document.body;r.style.backgroundColor="lime",r.style.border="solid black 1px",r.innerHTML="在鼠标点击窗口以外区域时自动关闭";var n=e.document.createElement("object");if(Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(window,"ActiveXObject")||"ActiveXObject"in window){var i=e.document.createElement("param");i.setAttribute("name","windowless"),i.setAttribute("value",!0),n.appendChild(i),n.setAttribute("classid","CLSID:7FD49E23-C8D7-4C4F-93A1-F7EACFA1EC53")}else n.setAttribute("type","application/avd-plugin");n.setAttribute("id","fullScreen"),n.setAttribute("width",winWidth),n.setAttribute("height",winHeight),n.src=t,r.appendChild(n),e.show(0,0,winWidth,winHeight,document.body)}function getLocalClientIP(){var i=when.defer(),t=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;return t?function(){var e=new t({iceServers:[]});e.createDataChannel("",{reliable:!1}),e.onicecandidate=function(t){t.candidate&&r("a="+t.candidate.candidate)},e.createOffer(function(t){r(t.sdp),e.setLocalDescription(t)},function(t){console.warn("offer failed",t)});var n=Object.create(null);function o(t){if(!(t in n)){n[t]=!0;for(var e=Object.keys(n).filter(function(t){return n[t]}),r=0;r<e.length;r++)16<e[r].length&&(e.splice(r,1),r--);i.resolve(e[0])}}function r(t){t.split("\r\n").forEach(function(t,e,r){if(~t.indexOf("a=candidate")){var n=(i=t.split(" "))[4];"host"===i[7]&&o(n)}else if(~t.indexOf("c=")){var i;o(n=(i=t.split(" "))[2])}})}n["0.0.0.0"]=!1}():i.reject(""),i.promise}function getEffectiveType(){return navigator.connection.effectiveType}if(function(){var i={},a={},o=function(){},t={define:function(t,e,r){if(!i[t]){var n={name:t,dependencies:e,factory:r};i[t]=n}return i[t]},use:function(t){var e=i[t];if(!e)return null;if(!e.entity){for(var r=[],n=0;n<e.dependencies.length;n++)i[e.dependencies[n]].entity?r.push(i[e.dependencies[n]].entity):r.push(this.use(e.dependencies[n]));e.entity=e.factory.apply(o,r)}return e.entity},require:function(r,n){for(var t=0;t<r.length;t++){var e=r[t];if(!a[e]){var i=document.getElementsByTagName("head")[0],o=document.createElement("script");o.type="text/javascript",o.async="true",o.src=e+".js",o.onload=function(){a[e]=!0,i.removeChild(o),s()},i.appendChild(o)}}function s(){for(var t=!0,e=0;e<r.length;e++)if(!a[r[e]]){t=!1;break}t&&n()}}};window.ModuleBase=t}(),ModuleBase.define("Error",[],function(){var t=function(t,e){"object"==typeof t&&void 0===e?(this.code=t.code,this.message=t.message):(this.code=t,this.message=e)};return t.prototype.errorShow=function(){return"error code:"+this.code+"; error message:"+this.message},t}),dcodeIO)var dcodeIO=dcodeIO.ProtoBuf;else var dcodeIO=module.exports;var rtmBuilder=dcodeIO.newBuilder({}).import({package:"signal_pdu",messages:[{name:"signal_header",fields:[{rule:"required",type:"string",name:"version",id:1},{rule:"required",type:"signal_group_type",name:"group_type",id:2},{rule:"required",type:"signal_cmd_type",name:"cmd_type",id:3},{rule:"required",type:"uint32",name:"timestamp",id:4},{rule:"required",type:"string",name:"from",id:5},{rule:"required",type:"string",name:"to",id:6},{rule:"required",type:"bytes",name:"content",id:7}]},{name:"Invite",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"options",id:2}]},{name:"InviteCancel",fields:[{rule:"required",type:"int32",name:"id",id:1}]},{name:"InviteOk",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"options",id:2}]},{name:"InviteReject",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"reson",id:2}]},{name:"InviteRinging",fields:[{rule:"required",type:"int32",name:"id",id:1}]},{name:"InviteTimeOut",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"reson",id:2}]},{name:"InviteBye",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"reson",id:2}]},{name:"MsgData",fields:[{rule:"required",type:"string",name:"msg_id",id:1},{rule:"required",type:"SessionType",name:"session_type",id:2},{rule:"required",type:"string",name:"session_id",id:3},{rule:"required",type:"uint32",name:"create_time",id:4},{rule:"required",type:"MsgType",name:"msg_type",id:5},{rule:"required",type:"bytes",name:"msg_content",id:6}]},{name:"MsgDataDelivered",fields:[{rule:"required",type:"string",name:"msg_id",id:1},{rule:"required",type:"SessionType",name:"session_type",id:2},{rule:"required",type:"string",name:"session_id",id:3}]},{name:"MsgDataRead",fields:[{rule:"required",type:"string",name:"msg_id",id:1},{rule:"required",type:"SessionType",name:"session_type",id:2},{rule:"required",type:"string",name:"session_id",id:3}]},{name:"MsgDataRecalled",fields:[{rule:"required",type:"string",name:"msg_id",id:1},{rule:"required",type:"SessionType",name:"session_type",id:2},{rule:"required",type:"string",name:"session_id",id:3}]},{name:"MouseEvents",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"optional",type:"int32",name:"video_x",id:2},{rule:"optional",type:"int32",name:"video_y",id:3},{rule:"optional",type:"int32",name:"video_w",id:4},{rule:"optional",type:"int32",name:"video_h",id:5},{rule:"optional",type:"mouse_events_type",name:"eventsType",id:6}]},{name:"KeyBoardEvents",fields:[{rule:"required",type:"int32",name:"id",id:1},{rule:"repeated",type:"int32",name:"keyc",id:2},{rule:"repeated",type:"int32",name:"keyv",id:3},{rule:"optional",type:"keyboard_events_type",name:"eventsType",id:4}]},{name:"RpcCallRequest",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"required",type:"bytes",name:"rpc_data",id:2}]},{name:"RpcCallResponse",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"required",type:"bytes",name:"rpc_data",id:2}]},{name:"RpcNotification",fields:[{rule:"required",type:"string",name:"id",id:1},{rule:"required",type:"bytes",name:"rpc_data",id:2}]}],enums:[{name:"signal_group_type",values:[{name:"SIGNALE_GROUP_TYPE_SYS",id:0},{name:"SIGNALE_GROUP_TYPE_MESSAGE",id:1},{name:"SIGNALE_GROUP_TYPE_INVITE",id:3},{name:"SIGNALE_GROUP_TYPE_RPC",id:4},{name:"SIGNALE_GROUP_TYPE_ADDRESS_BOOK",id:5},{name:"SIGNALE_GROUP_TYPE_REMOTE_CONTROL",id:6}]},{name:"signal_cmd_type",values:[{name:"SIGNALE_CMD_TYPE_INVITE",id:0},{name:"SIGNALE_CMD_TYPE_INVITE_CANCEL",id:1},{name:"SIGNALE_CMD_TYPE_INVITE_RINGING",id:2},{name:"SIGNALE_CMD_TYPE_INVITE_OK",id:3},{name:"SIGNALE_CMD_TYPE_INVITE_REJECT",id:4},{name:"SIGNALE_CMD_TYPE_INVITE_TIMEOUT",id:5},{name:"SIGNALE_CMD_TYPE_INVITE_BYE",id:6},{name:"SIGNALE_CMD_TYPE_RC_MOUSE_EVENTS",id:32},{name:"SIGNALE_CMD_TYPE_RC_KEYBOARD_EVENTS",id:33},{name:"SIGNALE_CMD_TYPE_MESSAGE_DATA",id:48},{name:"SIGNALE_CMD_TYPE_MESSAGE_RECEIVED",id:49},{name:"SIGNALE_CMD_TYPE_MESSAGE_READ",id:50},{name:"SIGNALE_CMD_TYPE_MESSAGE_RECALLED",id:51},{name:"SIGNALE_CMD_TYPE_RPC_CALL_REQUEST",id:64},{name:"SIGNALE_CMD_TYPE_RPC_CALL_RESPONSE",id:65},{name:"SIGNALE_CMD_TYPE_RPC_NOTIFICATION",id:66}]},{name:"SessionType",values:[{name:"SESSION_TYPE_PEERS",id:1},{name:"SESSION_TYPE_GROUP",id:2},{name:"SESSION_TYPE_CHATROOM",id:3}]},{name:"MsgType",values:[{name:"MSG_TYPE_TEXT",id:1},{name:"MSG_TYPE_IMAGE",id:2},{name:"MSG_TYPE_FILE",id:3},{name:"MSG_TYPE_AUDIO",id:4},{name:"MSG_TYPE_VIDEO",id:5},{name:"MSG_TYPE_LOCATION",id:6}]},{name:"MsgStatus",values:[{name:"MSG_STAT_DELIVERING",id:1},{name:"MSG_STAT_DELIVERED",id:2},{name:"MSG_STAT_READ",id:3},{name:"MSG_STAT_FAILED",id:4},{name:"MSG_TYPE_RECALLED",id:5}]},{name:"mouse_events_type",values:[{name:"WM_MOUSEMOVE",id:512},{name:"WM_LBUTTONDOWN",id:513},{name:"WM_LBUTTONUP",id:514},{name:"WM_LBUTTONDBLCLK",id:515},{name:"WM_RBUTTONDOWN",id:516},{name:"WM_RBUTTONUP",id:517},{name:"WM_RBUTTONDBLCLK",id:518},{name:"WM_MBUTTONDOWN",id:519},{name:"WM_MBUTTONUP",id:520},{name:"WM_MBUTTONDBLCLK",id:521},{name:"WM_MOUSEWHEEL",id:522}]},{name:"keyboard_events_type",values:[{name:"WM_KEYDOWN",id:256},{name:"WM_KEYUP",id:257},{name:"WM_CHAR",id:258}]},{name:"keyboard_vk_type",values:[{name:"VK_BACK",id:8},{name:"VK_TAB",id:9},{name:"VK_SHIFT",id:16},{name:"VK_CONTROL",id:17},{name:"VK_MENU",id:18},{name:"VK_PAUSE",id:19},{name:"VK_CAPITAL",id:20},{name:"VK_KANA",id:21},{name:"VK_JUNJA",id:23},{name:"VK_FINAL",id:24},{name:"VK_HANJA",id:25},{name:"VK_KANJI",id:25},{name:"VK_ESCAPE",id:27},{name:"VK_CONVERT",id:28},{name:"VK_NONCONVERT",id:29},{name:"VK_ACCEPT",id:30},{name:"VK_MODECHANGE",id:31},{name:"VK_SPACE",id:32},{name:"VK_PRIOR",id:33},{name:"VK_NEXT",id:34},{name:"VK_END",id:35},{name:"VK_HOME",id:36},{name:"VK_LEFT",id:37},{name:"VK_UP",id:38},{name:"VK_RIGHT",id:39},{name:"VK_DOWN",id:40},{name:"VK_SELECT",id:41},{name:"VK_PRINT",id:42},{name:"VK_EXECUTE",id:43},{name:"VK_SNAPSHOT",id:44},{name:"VK_INSERT",id:45},{name:"VK_DELETE",id:46},{name:"VK_HELP",id:47}]}]}).build(),mcuServerUrl,clusterRestAddr,roomServerUrl,iceServers,stunUrl,trunUrl,iceusername,iceCredential;!function(){var s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(t,e){var r,n,i=s,o=[];if(e=e||i.length,t)for(r=0;r<t;r++)o[r]=i[0|Math.random()*e];else for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",r=0;r<36;r++)o[r]||(n=0|16*Math.random(),o[r]=i[19==r?3&n|8:n]);return o.join("")},Math.uuidFast=function(){for(var t,e=s,r=new Array(36),n=0,i=0;i<36;i++)8==i||13==i||18==i||23==i?r[i]="-":14==i?r[i]="4":(n<=2&&(n=33554432+16777216*Math.random()|0),t=15&n,n>>=4,r[i]=e[19==i?3&t|8:t]);return r.join("")},Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})}}();var is_cluster=!1,protocolStr=document.location.protocol;"http:"!=protocolStr&&"https:"!=protocolStr&&(protocolStr="http:");var fsCheck={isCheck:!1,content:{}},connectionStatisticsConfig=null,loggerReportConfig=null,loggerReport=null,doFsCheck=function(t,e){var r=null;1==fsCheck.isCheck&&(1!=fsCheck.content[t.value]&&(r=new e(ErrorConstant.ft_no_authorization.code,t.name+ErrorConstant.ft_no_authorization.message)));return r};if(ModuleBase.define("RestServer",["Error"],function(Error){var RestServer=function(t){t&&(protocolStr=t)};return RestServer.prototype.getServerinfo=function(serverURI,accessToken){var deferred=when.defer();mcuServerUrl=serverURI;var url=protocolStr+"//"+serverURI+"/sdk/config/serverinfo",params={params:{uri_encode:"yes",client_info:{access_tocken:accessToken}}};return this.fetchGet(url,params).then(function(serverinfo){var fuValue=serverinfo.ft_value;fuValue&&(fsCheck.isCheck=!0,"object"==typeof fuValue?fsCheck.content=fuValue:"string"==typeof fuValue&&(fsCheck.content=eval("("+fuValue+")")));var error=doFsCheck(FTConstant.platform_web,Error);if(null!=error)return deferred.reject(error),deferred.promise;connectionStatisticsConfig=serverinfo.statistic_config?serverinfo.statistic_config:{},connectionStatisticsConfig.open_statistic=serverinfo.open_statistic?serverinfo.open_statistic:0,connectionStatisticsConfig.trace_id=serverinfo.trace_id?serverinfo.trace_id:"",loggerReportConfig=serverinfo.logger_config?serverinfo.logger_config:{},loggerReportConfig.open_logger=serverinfo.open_logger?serverinfo.open_logger:0,loggerReportConfig.trace_id=serverinfo.trace_id?serverinfo.trace_id:"",roomServerUrl=serverinfo.room_server.uri,iceServers=serverinfo.ice_servers,null!=iceServers&&0<iceServers.length&&(stunUrl=iceServers[0].url,trunUrl=iceServers[1].url,iceusername=iceServers[1].username,iceCredential=iceServers[1].credential),serverinfo.is_cluster&&("true"!=serverinfo.is_cluster&&1!=serverinfo.is_cluster||(is_cluster=!0)),deferred.resolve()}).catch(function(t){t=new Error(t.code,t.message);return deferred.reject(t),!1}),deferred.promise},RestServer.prototype.getMcu=function(t,e){var n=when.defer();loggerReport.info("调度服务器地址:"+mcuServerUrl);var r=protocolStr+"//"+mcuServerUrl+"/sdk/get_mcu",i={params:{room_id:t,token:e}};return console.log("=======restServer.getMcu(),room.avdEngine.mcuClusterRouteParams:"+room.avdEngine.mcuClusterRouteParams),room.avdEngine.mcuClusterRouteParams&&(i.params.options=room.avdEngine.mcuClusterRouteParams,log.info("ajax (/sdk/getMcu) getMcuUrl(带mcuClusterRouteParams):")),this.fetchGet(r,i).then(function(t){var e=t.ret;if(0==e)roomServerUrl=t.addr,clusterRestAddr=t.cluster_rest_addr,loggerReport.info("MCU服务器地址:"+clusterRestAddr),log.debug("============getMcu(),clusterRestAddr:"+clusterRestAddr),n.resolve();else{var r=new Error(e,t.msg);n.reject(r)}}).catch(function(t){console.log(t);t=new Error(t.code,t.message);return n.reject(t),!1}),n.promise},RestServer.prototype.getMcuWithOEM=function(t,e){var n=when.defer(),r=protocolStr+"//"+mcuServerUrl+"/sdk/get_mcu",i={params:{room_id:t,access_token:e}};return this.fetchGet(r,i).then(function(t){var e=t.ret;if(0==e)roomServerUrl=t.addr,clusterRestAddr=t.cluster_rest_addr,room.avdEngine.accessToken=t.access_token,log.info("ajax (/sdk/getMcuWithOEM)  roomServerUrl:"+t.addr+"；accessToken："+t.access_token),n.resolve();else{var r=new Error(e,t.msg);n.reject(r)}}).catch(function(t){t=new Error(t.code,t.message);return n.reject(t),!1}),n.promise},RestServer.prototype.getMqttWSAddr=function(t,e){var i=when.defer(),r=protocolStr+"//"+t+"/sdk/mqtt/serverinfo",n={params:{token:e}};return this.fetchGet(r,n).then(function(t){var e=t.ret;if(0==e){var r=t.data.mqtt_ws_addr;log.info("ajax (/sdk/mqtt/serverinfo)  mqttWSAddr:"+r),i.resolve(r)}else{var n=new Error(e,t.msg);i.reject(n)}}).catch(function(t){t=new Error(t.code,t.message);return i.reject(t),!1}),i.promise},RestServer.prototype.fetchGet=function(t,e){return new Promise(function(r,n){axios.get(t,e).then(function(t){if(0===t.data.ret)r(t.data);else{var e={code:t.data.ret,message:t.data.msg};n(e)}}).catch(function(t){if(t.response){var e=new Error(t.response.status,t.response.data);n(e)}else{e=new Error(1e4,t.message);n(e)}n(t)})})},RestServer}),ModuleBase.define("RtmManager",["RtmMessageManager","Error"],function(a,l){var t=function(t,e,r){this.mqttWSAddr=t,this.account=e,this.password=r};return t.prototype.connect=function(){var r=when.defer();try{var t=document.location.protocol;"http:"!=t&&"https:"!=t&&(t="http:");var e="ws://";"https:"==t&&(e="wss://");var n=e+this.mqttWSAddr;log.debug("=====mqtt webSocket URL==="+n);var i={clientId:this.account,username:this.account,password:this.password},o=mqtt.connect(n,i);console.log("======client:",o),o.on("connect",function(){console.log("mqtt connect success!"),r.resolve(o)}),o.on("error",function(t){console.log("mqtt connect error:",t);var e=new l(t.code,t.message);o.end(),r.reject(e)}),o.on("message",function(t,e){console.log([t,e]),(new a).OnWebSocketMessage(e)})}catch(t){log.info("MQTT  Operation  failed. with exception:"+t);var s=new l(ErrorConstant.websock_catch_exception);r.reject(s)}return r.promise},t}),ModuleBase.define("RtmMessageManager",["Error"],function(t){var e=function(){};return e.prototype.OnWebSocketMessage=function(t){console.log("======RtmMessageManager.OnWebSocketMessage(),payload:",t);var e=signalClient.rtmServer.rtmProtobufCoded.decodePacket(t);console.log("======RtmMessageManager.OnWebSocketMessage(),signalHeader:",e);var r=e.group_type,n=e.cmd_type,i=e.content,o=e.from,s=e.to,a=signalClient.rtmServer.signalGroupTypeEnum,l=signalClient.rtmServer.signalCmdTypeEnum;switch(r){case a.SIGNALE_GROUP_TYPE_INVITE:switch(log.debug("acception  groupType = SIGNALE_GROUP_TYPE_INVITE"),n){case l.SIGNALE_CMD_TYPE_INVITE:log.debug("acception cmdType = SIGNALE_CMD_TYPE_INVITE");var u=signalClient.rtmServer.rtmProtobufCoded.decodeInvite(i);console.log("======RtmMessageManager.OnWebSocketMessage(),invite:",u),signalClient.inviteManager.emitCallNotify(u.id,o,s,u.options);break;case l.SIGNALE_CMD_TYPE_INVITE_CANCEL:log.debug("acception cmdType = SIGNALE_CMD_TYPE_INVITE_CANCEL");var c=signalClient.rtmServer.rtmProtobufCoded.decodeInviteCancel(i);console.log("======RtmMessageManager.OnWebSocketMessage(),decodeInviteCancel:",c),(u=signalClient.inviteManager.getInvite(c.id)).emitCallCancelNotify();break;case l.SIGNALE_CMD_TYPE_INVITE_RINGING:log.debug("acception cmdType = SIGNALE_CMD_TYPE_INVITE_RINGING");var h=signalClient.rtmServer.rtmProtobufCoded.decodeInviteRinging(i);console.log("======RtmMessageManager.OnWebSocketMessage(),decodeInviteRinging:",h),(u=signalClient.inviteManager.getInvite(h.id)).emitCallRingingNotify();break;case l.SIGNALE_CMD_TYPE_INVITE_OK:log.debug("acception cmdType = SIGNALE_CMD_TYPE_INVITE_OK");var f=signalClient.rtmServer.rtmProtobufCoded.decodeInviteOk(i);console.log("======RtmMessageManager.OnWebSocketMessage(),inviteOk:",f),(u=signalClient.inviteManager.getInvite(f.id)).emitCallAcceptNotify(f.options);break;case l.SIGNALE_CMD_TYPE_INVITE_REJECT:log.debug("acception cmdType = SIGNALE_CMD_TYPE_INVITE_REJECT");var p=signalClient.rtmServer.rtmProtobufCoded.decodeInviteReject(i);console.log("======RtmMessageManager.OnWebSocketMessage(),inviteReject:",p),(u=signalClient.inviteManager.getInvite(p.id)).emitCallRejectNotify(p.reson);break;case l.SIGNALE_CMD_TYPE_INVITE_BYE:log.debug("acception cmdType = SIGNALE_CMD_TYPE_INVITE_BYE");var d=signalClient.rtmServer.rtmProtobufCoded.decodeInviteBye(i);console.log("======RtmMessageManager.OnWebSocketMessage(),inviteBye:",d),(u=signalClient.inviteManager.getInvite(d.id)).emitCallCloseNotify(d.reson)}break;case a.SIGNALE_GROUP_TYPE_REMOTE_CONTROL:switch(log.debug("acception  groupType = SIGNALE_GROUP_TYPE_REMOTE_CONTROL"),n){case l.SIGNALE_CMD_TYPE_RC_MOUSE_EVENTS:log.debug("acception cmdType = SIGNALE_CMD_TYPE_RC_MOUSE_EVENTS");var g=signalClient.rtmServer.rtmProtobufCoded.decodeMouseEvents(i);console.log("======RtmMessageManager.OnWebSocketMessage(),mouseEvents:",g),signalClient.remoteControlManager.baseRemotectrl&&signalClient.remoteControlManager.baseRemotectrl.sendMouseMessage(g.eventsType,g.video_x,g.video_y,g.video_w,g.video_h);break;case l.SIGNALE_CMD_TYPE_RC_KEYBOARD_EVENTS:log.debug("acception cmdType = SIGNALE_CMD_TYPE_RC_KEYBOARD_EVENTS");var m=signalClient.rtmServer.rtmProtobufCoded.decodeKeyBoardEvents(i);console.log("======RtmMessageManager.OnWebSocketMessage(),keyBoardEvents:",m),signalClient.remoteControlManager.baseRemotectrl&&signalClient.remoteControlManager.baseRemotectrl.sendKeyboardMessage(m.eventsType,m.keyc,m.keyv)}break;case a.SIGNALE_GROUP_TYPE_MESSAGE:switch(log.debug("acception  groupType = SIGNALE_GROUP_TYPE_MESSAGE"),n){case l.SIGNALE_CMD_TYPE_MESSAGE_DATA:if(o==signalClient.selfUser.userId)return;var v=signalClient.rtmServer.rtmProtobufCoded.decodeMsgData(i);console.log("======RtmMessageManager.OnWebSocketMessage(),msgData:",v),signalClient.chatManager.emitReceiveMessageNotify(o,v.msg_id,v.session_type,v.session_id,v.create_time,v.msg_type,v.msg_content.toArrayBuffer())}break;case a.SIGNALE_GROUP_TYPE_RPC:switch(log.debug("acception  groupType = SIGNALE_GROUP_TYPE_RPC"),n){case l.SIGNALE_CMD_TYPE_RPC_CALL_RESPONSE:var y=signalClient.rtmServer.rtmProtobufCoded.decodeRpcCallResponse(i);console.log("======RtmMessageManager.OnWebSocketMessage(),rpcCallResponse:",y),y&&signalClient.rpcManager.eventEmitter.emit(signalClient.rpcManager.RpcManagerCallbackEnum.CALL_RESPONSE_SUCCESS+y.id,y.id,y.rpc_data.toArrayBuffer())}}},e}),ModuleBase.define("RtmServer",["RtmProtobufCoded","Error"],function(e,f){var t=function(t){this.signalingChannel=t,this.rtmProtobufCoded=new e,this.signalGroupTypeEnum=this.rtmProtobufCoded.getSignalGroupTypeEnum(),this.signalCmdTypeEnum=this.rtmProtobufCoded.getSignalCmdTypeEnum(),this.mouseEventsTypeEnum=this.rtmProtobufCoded.getMouseEventsTypeEnum(),this.keyboardEventsTypeEnum=this.rtmProtobufCoded.getKeyboardEventsTypeEnum(),this.keyboardVKTypeEnum=this.rtmProtobufCoded.getKeyboardVKTypeEnum()};return t.prototype.publish=function(t,e){console.debug("===========RtmServer.publish(),topic:",t),this.signalingChannel&&this.signalingChannel.publish(t,e)},t.prototype.subscribe=function(t){console.log("===========RtmServer.subscribe(),topic:",t),this.signalingChannel&&this.signalingChannel.subscribe(t)},t.prototype.unsubscribe=function(t){console.log("===========RtmServer.unsubscribe(),topic:",t),this.signalingChannel&&this.signalingChannel.unsubscribe(t)},t.prototype.end=function(){console.debug("===========RtmServer.end()"),this.signalingChannel&&this.signalingChannel.end()},t.prototype.sendInviteCall=function(t,e,r,n){console.debug("===========RtmServer.sendInviteCall()");var i=when.defer();try{var o="/u/"+r,s="";n&&(s=JSON.stringify(n));var a=this.rtmProtobufCoded.newInvite(t,s),l=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE,e,r,a);console.log("===============RtmServer.sendInviteCall(),headerBuffer:",l);var u=new Uint8Array(l);this.publish(o,u),i.resolve()}catch(t){i.reject(t)}return i.promise},t.prototype.sendInviteCancel=function(t,e,r){console.debug("===========RtmServer.sendInviteCancel()");var n=when.defer();try{var i="/u/"+r,o=this.rtmProtobufCoded.newInviteCancel(t),s=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_CANCEL,e,r,o);console.log("===============RtmServer.sendInviteCancel(),headerBuffer:",s);var a=new Uint8Array(s);this.publish(i,a),n.resolve()}catch(t){n.reject(t)}return n.promise},t.prototype.sendInviteRinging=function(t,e,r){console.debug("===========RtmServer.sendInviteRinging()");var n=when.defer();try{var i="/u/"+r,o=this.rtmProtobufCoded.newInviteRinging(t),s=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_RINGING,e,r,o);console.log("===============rtmServer.sendInviteRinging(),headerBuffer:",s);var a=new Uint8Array(s);this.publish(i,a),n.resolve()}catch(t){n.reject(t)}return n.promise},t.prototype.sendInviteAccept=function(t,e,r,n){console.debug("===========RtmServer.sendInviteAccept()");var i=when.defer();try{var o="/u/"+r,s="";n&&(s=JSON.stringify(n));var a=this.rtmProtobufCoded.newInviteOk(t,s),l=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_OK,e,r,a);console.log("===============RtmServer.sendInviteAccept(),headerBuffer:",l);var u=new Uint8Array(l);this.publish(o,u),i.resolve()}catch(t){i.reject(t)}return i.promise},t.prototype.sendInviteReject=function(t,e,r,n){console.debug("===========RtmServer.sendInviteReject()");var i=when.defer();try{var o="/u/"+r,s=this.rtmProtobufCoded.newInviteReject(t,n),a=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_REJECT,e,r,s);console.log("===============RtmServer.sendInviteReject(),headerBuffer:",a);var l=new Uint8Array(a);this.publish(o,l),i.resolve()}catch(t){i.reject(t)}return i.promise},t.prototype.sendInviteClose=function(t,e,r,n){console.debug("===========RtmServer.sendInviteClose()");var i=when.defer();try{var o="/u/"+r,s=this.rtmProtobufCoded.newInviteBye(t,n),a=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_INVITE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_INVITE_BYE,e,r,s);console.log("===============RtmServer.sendInviteClose(),headerBuffer:",a);var l=new Uint8Array(a);this.publish(o,l),i.resolve()}catch(t){i.reject(t)}return i.promise},t.prototype.sendMouseMessage=function(t,e,r,n,i,o,s,a){console.debug("===========RtmServer.sendMouseMessage()");var l=when.defer();try{var u="/u/"+r,c=this.rtmProtobufCoded.newMouseEvents(t,i,o,s,a,n);console.log("===============RtmServer.sendMouseMessage(),mouseEvents:",c);var h=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_REMOTE_CONTROL,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_RC_MOUSE_EVENTS,e,r,c);console.log("===============RtmServer.sendMouseMessage(),headerBuffer:",h);var f=new Uint8Array(h);this.publish(u,f),l.resolve()}catch(t){l.reject(t)}return l.promise},t.prototype.sendKeyboardMessage=function(t,e,r,n,i,o){console.debug("===========RtmServer.sendKeyboardMessage()");var s=when.defer();try{var a="/u/"+r,l=this.rtmProtobufCoded.newKeyBoardEvents(t,i,o,n);console.log("===============RtmServer.sendKeyboardMessage(),keyBoardEvents:",l);var u=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_REMOTE_CONTROL,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_RC_KEYBOARD_EVENTS,e,r,l);console.log("===============RtmServer.sendKeyboardMessage(),headerBuffer:",u);var c=new Uint8Array(u);this.publish(a,c),s.resolve()}catch(t){s.reject(t)}return s.promise},t.prototype.sendMsgData=function(t,e){console.debug("===========RtmServer.sendMsgData()");var r=when.defer();try{var n=typeConversionUtil.stringToUint8Array(e.content),i=this.rtmProtobufCoded.newMsgData(e.messageId,e.sessionType,e.sessionId,e.createTime,e.messageType,n);console.log("===============RtmServer.sendMsgData(),msgData:",i);var o=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_MESSAGE,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_MESSAGE_DATA,e.sendUserId,e.sessionId,i);console.log("===============RtmServer.sendMsgData(),headerBuffer:",o);var s=new Uint8Array(o);this.publish(t,s),r.resolve()}catch(t){r.reject(t)}return r.promise},t.prototype.sendRpcCall=function(t,e,r,n){console.debug("===========RtmServer.sendRpcCall()");var i=when.defer(),o=Math.uuid();n.id=o;var s=JSON.stringify(n),a=typeConversionUtil.stringToUint8Array(s),l=this.rtmProtobufCoded.newRpcCallRequest(o,a);console.log("===============RtmServer.sendRpcCall(),rpcCallRequest:",l);var u=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_RPC,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_RPC_CALL_REQUEST,t,e,l);console.log("===============RtmServer.sendMsgData(),headerBuffer:",u);var c=new Uint8Array(u);this.publish(r,c);var h=setTimeout(function(){var t=new f(1e4,"sendRpcCall time out");i.reject(t)},5e3);return signalClient.rpcManager.addCallback(signalClient.rpcManager.RpcManagerCallbackEnum.CALL_RESPONSE_SUCCESS+o,function(t,e){console.log("=========RtmServer.sendRpcCall().addCallback(),id:",t,"parameters:",e),t==o&&(signalClient.rpcManager.offCallback([signalClient.rpcManager.RpcManagerCallbackEnum.CALL_RESPONSE_SUCCESS+o]),i.resolve(e),clearTimeout(h))}),i.promise},t.prototype.sendRpcNotification=function(t,e,r,n){console.debug("===========RtmServer.sendRpcNotification()");var i=when.defer();try{var o=Math.uuid();n.id=o;var s=JSON.stringify(n),a=typeConversionUtil.stringToUint8Array(s),l=this.rtmProtobufCoded.newRpcNotification(o,a);console.log("===============RtmServer.sendRpcNotification(),rpcNotification:",l);var u=this.rtmProtobufCoded.encodedHeader(this.signalGroupTypeEnum.SIGNALE_GROUP_TYPE_RPC,this.signalCmdTypeEnum.SIGNALE_CMD_TYPE_RPC_NOTIFICATION,t,e,rpcCallRequest);console.log("===============RtmServer.sendRpcNotification(),headerBuffer:",u);var c=new Uint8Array(u);this.publish(r,c),i.resolve()}catch(t){i.reject(t)}return i.promise},t}),ModuleBase.define("RtmProtobufCoded",[],function(){var a,t=function(){a=rtmBuilder.signal_pdu};return t.prototype.getSignalGroupTypeEnum=function(){return a.signal_group_type},t.prototype.getSignalCmdTypeEnum=function(){return a.signal_cmd_type},t.prototype.getMouseEventsTypeEnum=function(){return a.mouse_events_type},t.prototype.getKeyboardEventsTypeEnum=function(){return a.keyboard_events_type},t.prototype.getKeyboardVKTypeEnum=function(){return a.keybaord_vk_type},t.prototype.getSessionTypeEnum=function(){return a.SessionType},t.prototype.getMsgTypeEnum=function(){return a.MsgType},t.prototype.getMsgStatusEnum=function(){return a.MsgStatus},t.prototype.encodedHeader=function(t,e,r,n,i){var o=null;null!=i&&(o=i.toArrayBuffer());var s=Math.round((new Date).getTime()/1e3),a=this.newSignalHeader("1.0",t,e,s,r,n,o);return console.log("=====================encodedHeader(),signalHeader:",a),a.toArrayBuffer()},t.prototype.newSignalHeader=function(t,e,r,n,i,o,s){return new a.signal_header(t,e,r,n,i,o,s)},t.prototype.newInvite=function(t,e){return new a.Invite(t,e)},t.prototype.newInviteCancel=function(t){return new a.InviteCancel(t)},t.prototype.newInviteRinging=function(t){return new a.InviteRinging(t)},t.prototype.newInviteOk=function(t,e){return new a.InviteOk(t,e)},t.prototype.newInviteReject=function(t,e){return new a.InviteReject(t,e)},t.prototype.newInviteBye=function(t,e){return new a.InviteBye(t,e)},t.prototype.newMouseEvents=function(t,e,r,n,i,o){return new a.MouseEvents(t,e,r,n,i,o)},t.prototype.newKeyBoardEvents=function(t,e,r,n){return new a.KeyBoardEvents(t,e,r,n)},t.prototype.newMsgData=function(t,e,r,n,i,o){return new a.MsgData(t,e,r,n,i,o)},t.prototype.newMsgDataDelivered=function(t,e,r){return new a.MsgDataDelivered(t,e,r)},t.prototype.newMsgDataRead=function(t,e,r){return new a.MsgDataRead(t,e,r)},t.prototype.newMsgDataRecalled=function(t,e,r){return new a.MsgDataRecalled(t,e,r)},t.prototype.newRpcCallRequest=function(t,e){return new a.RpcCallRequest(t,e)},t.prototype.newRpcNotification=function(t,e){return new a.RpcNotification(t,e)},t.prototype.decodePacket=function(t){return a.signal_header.decode(t)},t.prototype.decodeInvite=function(t){return a.Invite.decode(t)},t.prototype.decodeInviteCancel=function(t){return a.InviteCancel.decode(t)},t.prototype.decodeInviteRinging=function(t){return a.InviteRinging.decode(t)},t.prototype.decodeInviteOk=function(t){return a.InviteOk.decode(t)},t.prototype.decodeInviteReject=function(t){return a.InviteReject.decode(t)},t.prototype.decodeInviteBye=function(t){return a.InviteBye.decode(t)},t.prototype.decodeMouseEvents=function(t){return a.MouseEvents.decode(t)},t.prototype.decodeKeyBoardEvents=function(t){return a.KeyBoardEvents.decode(t)},t.prototype.decodeMsgData=function(t){return a.MsgData.decode(t)},t.prototype.decodeRpcCallResponse=function(t){return a.RpcCallResponse.decode(t)},t}),ModuleBase.define("ClientUser",["Error"],function(t){return function(t,e){this.userId=t,this.account=t,this.password=e,this.userName}}),ModuleBase.define("InviteManager",["Invite","Error"],function(s,t){var e=function(){this.InviteManagerCallbackEnum={CALL_NOTIFY:"call.notify"},this.invites={},this.eventEmitter=new EventEmitter};return e.prototype.createInvite=function(t,e,r){var n=new s(t,e,r);return this.invites[n.inviteId]=n},e.prototype.getInvite=function(t){return this.invites[t]},e.prototype.call=function(t){var e=when.defer();return t.callInner().then(function(){log.debug("=============InviteManager.call(),success"),e.resolve()}).otherwise(function(t){log.debug("=============InviteManager.call(),error:",t),e.reject(t)}),e.promise},e.prototype.emitCallNotify=function(t,e,r,n){var i=null;n&&(i=JSON.parse(n));var o=new s(r,e,i);o.inviteId=t,(this.invites[o.inviteId]=o).onCallTimeOutInner(),this.eventEmitter.emit(this.InviteManagerCallbackEnum.CALL_NOTIFY,o)},e.prototype.addCallback=function(t,e){this.eventEmitter.on(t,e)},e}),ModuleBase.define("Invite",["Error"],function(t){var e=function(t,e,r){this.InviteCallbackEnum={CALL_ACCEPT_NOTIFY:"call.accept.notify",CALL_REJECT_NOTIFY:"call.reject.notify",CALL_TIMEOUT_NOTIFY:"call.timeout.notify",CALL_RINGING_NOTIFY:"call.ringing.notify",CALL_CANCEL_NOTIFY:"call.cancel.notify",RESPONSE_CALL_TIMEOUT_NOTIFY:"response.call.timeout.notify",CALL_CLOSE_NOTIFY:"call.close.notify"},this.eventEmitter=new EventEmitter,this.inviteId=++Task_Id,this.fromUserId=t,this.toUserId=e,this.options=r,this.callTimeout=6e4,this.callBaseTime=null,this.callTimeoutIntervalId=null,this.onCallTimeout=55e3,this.onCallBaseTime=null,this.onCallTimeoutIntervalId=null};return e.prototype.callInner=function(){console.debug("===========invite.callInner()");var t=this;null==t.callBaseTime&&(t.callBaseTime=new Date),t.callTimeoutIntervalId=setInterval(function(){new Date-t.callBaseTime>=t.callTimeout&&(t.clearanceInner(),t.eventEmitter.emit(t.InviteCallbackEnum.CALL_TIMEOUT_NOTIFY,t.toUserId))},500);var e=when.defer();return signalClient.rtmServer.sendInviteCall(t.inviteId,t.fromUserId,t.toUserId,t.options).then(function(){e.resolve()}).otherwise(function(t){e.reject(t)}),e.promise},e.prototype.onCallTimeOutInner=function(){console.debug("===========invite.onCallTimeOutInner()");var t=this;null==t.onCallBaseTime&&(t.onCallBaseTime=new Date),t.onCallTimeoutIntervalId=setInterval(function(){new Date-t.onCallBaseTime>=t.onCallTimeout&&(t.clearanceInnerOnCall(),t.eventEmitter.emit(t.InviteCallbackEnum.RESPONSE_CALL_TIMEOUT_NOTIFY,t.fromUserId))},500)},e.prototype.clearanceInner=function(){clearInterval(this.callTimeoutIntervalId),this.callTimeoutIntervalId=null,this.callBaseTime=null},e.prototype.clearanceInnerOnCall=function(){clearInterval(this.onCallTimeoutIntervalId),this.onCallTimeoutIntervalId=null,this.onCallBaseTime=null},e.prototype.cancel=function(){var e=when.defer(),t=this;return signalClient.rtmServer.sendInviteCancel(t.inviteId,t.fromUserId,t.toUserId).then(function(){t.clearanceInner(),e.resolve()}).otherwise(function(t){e.reject(t)}),e.promise},e.prototype.ringing=function(){var e=when.defer();return signalClient.rtmServer.sendInviteRinging(this.inviteId,this.fromUserId,this.toUserId).then(function(){e.resolve()}).otherwise(function(t){e.reject(t)}),e.promise},e.prototype.accept=function(t){var e=this,r=when.defer();return signalClient.rtmServer.sendInviteAccept(e.inviteId,e.fromUserId,e.toUserId,t).then(function(){e.clearanceInnerOnCall(),r.resolve()}).otherwise(function(t){r.reject(t)}),r.promise},e.prototype.reject=function(t){var e=this,r=when.defer();return signalClient.rtmServer.sendInviteReject(e.inviteId,e.fromUserId,e.toUserId,t).then(function(){e.clearanceInnerOnCall(),r.resolve()}).otherwise(function(t){r.reject(t)}),r.promise},e.prototype.close=function(t){var e=this,r=when.defer();return signalClient.rtmServer.sendInviteClose(e.inviteId,e.fromUserId,e.toUserId,t).then(function(){e.clearanceInner(),e.clearanceInnerOnCall(),r.resolve()}).otherwise(function(t){r.reject(t)}),r.promise},e.prototype.emitCallCancelNotify=function(){this.eventEmitter.emit(this.InviteCallbackEnum.CALL_CANCEL_NOTIFY,this.toUserId)},e.prototype.emitCallRingingNotify=function(){this.callBaseTime=new Date,this.eventEmitter.emit(this.InviteCallbackEnum.CALL_RINGING_NOTIFY,this.toUserId)},e.prototype.emitCallAcceptNotify=function(t){this.clearanceInner();var e=null;t&&(e=JSON.parse(t)),this.eventEmitter.emit(this.InviteCallbackEnum.CALL_ACCEPT_NOTIFY,this.toUserId,e)},e.prototype.emitCallRejectNotify=function(t){this.clearanceInner(),this.eventEmitter.emit(this.InviteCallbackEnum.CALL_REJECT_NOTIFY,this.toUserId,t)},e.prototype.emitCallCloseNotify=function(t){this.clearanceInner(),this.clearanceInnerOnCall(),this.eventEmitter.emit(this.InviteCallbackEnum.CALL_CLOSE_NOTIFY,this.fromUserId,t)},e.prototype.addCallback=function(t,e){this.eventEmitter.on(t,e)},e}),ModuleBase.define("RemoteControlManager",["Error"],function(t){var e=function(){this.MouseEventsTypeEnum={WM_MOUSEMOVE:512,WM_LBUTTONDOWN:513,WM_LBUTTONUP:514,WM_LBUTTONDBLCLK:515,WM_RBUTTONDOWN:516,WM_RBUTTONUP:517,WM_RBUTTONDBLCLK:518,WM_MBUTTONDOWN:519,WM_MBUTTONUP:520,WM_MBUTTONDBLCLK:521,WM_MOUSEWHEEL:522},this.KeyboardEventsTypeEnum={WM_KEYDOWN:256,WM_KEYUP:257,WM_CHAR:258},this.KeyboardVKTypeEnum={VK_BACK:8,VK_TAB:9,VK_SHIFT:16,VK_CONTROL:17,VK_MENU:18,VK_PAUSE:19,VK_CAPITAL:20,VK_KANA:21,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_ESCAPE:27,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SPACE:32,VK_PRIOR:33,VK_NEXT:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SNAPSHOT:44,VK_INSERT:45,VK_DELETE:46,VK_HELP:47},this.RemoteControlManagerCallbackEnum={MOUSE_EVENTS_NOTIFY:"mouse.events.notify",KEYBOARD_EVENTS_NOTIFY:"KeyBoard.events.notify"},this.fromUserId="",this.toUserId="",this.baseRemotectrl=null};return e.prototype.setBaseRemotectrl=function(t){this.baseRemotectrl=t},e.prototype.setFromUserAndToUser=function(t,e){this.fromUserId=t,this.toUserId=e},e.prototype.sendMouseMessage=function(t,e,r,n,i){var o=++Task_Id,s=when.defer();return signalClient.rtmServer.sendMouseMessage(o,this.fromUserId,this.toUserId,t,e,r,n,i).then(function(){s.resolve()}).otherwise(function(t){s.reject(t)}),s.promise},e.prototype.sendKeyboardMessage=function(t,e,r){var n=++Task_Id,i=when.defer();return signalClient.rtmServer.sendKeyboardMessage(n,this.fromUserId,this.toUserId,t,e,r).then(function(){i.resolve()}).otherwise(function(t){i.reject(t)}),i.promise},e}),ModuleBase.define("ChatManager",["Message","Error"],function(u,t){var e=function(){this.ChatManagerCallbackEnum={RECEIVE_MESSAGE_NOTIFY:"receive.message.notify",MESSAGE_STATUS_CHANGED_NOTIFY:"message.status.changed.notify"},this.SessionTypeEnum={peers:1,group:2,chatroom:3},this.MessageTypeEnum={text:1,image:2,file:3,audio:4,video:5,location:6},this.MessageStatussEnum={delivering:1,delivered:2,read:3,failed:4,recalled:5},this.eventEmitter=new EventEmitter};return e.prototype.registerGroups=function(t){if(t)for(var e=0;e<t.length;e++){var r=t[e];signalClient.rtmServer.subscribe("/g/"+r)}},e.prototype.unregisterGroup=function(t){t&&signalClient.rtmServer.unsubscribe("/g/"+t)},e.prototype.newTextMessage=function(t,e,r){var n=Math.uuid(),i=new u(n,t,e);return i.sendUserId=signalClient.selfUser.userId,i.messageType=this.MessageTypeEnum.text,i.content=r,i.createTime=signalClient.getServeTime(),i.status=this.MessageStatussEnum.delivering,i},e.prototype.sendMessage=function(t){var e=when.defer(),r="/u/"+t.sessionId;return t.sessionType!=this.SessionTypeEnum.peers&&(r="/g/"+t.sessionId),signalClient.rtmServer.sendMsgData(r,t).then(function(){e.resolve()}).otherwise(function(t){e.reject(t)}),e.promise},e.prototype.emitReceiveMessageNotify=function(t,e,r,n,i,o,s){var a=new u(e,r,n);a.sendUserId=t,a.messageType=o;var l=new Uint8Array(s);a.content=typeConversionUtil.Uint8ArrayToString(l),a.createTime=i,a.status=this.MessageStatussEnum.delivered,this.eventEmitter.emit(this.ChatManagerCallbackEnum.RECEIVE_MESSAGE_NOTIFY,a)},e.prototype.sendImageMessage=function(t,e,r,n){},e.prototype.sendFileMessage=function(t,e,r,n){},e.prototype.sendAudioMessage=function(t,e,r,n){},e.prototype.readMessage=function(t){},e.prototype.recallMessage=function(t){},e.prototype.addCallback=function(t,e){this.eventEmitter.on(t,e)},e.prototype.offCallback=function(t){for(var e in t){var r=t[e];this.eventEmitter.off(r)}},e}),ModuleBase.define("Message",["Error"],function(t){return function(t,e,r){this.messageId=t,this.sessionType=e,this.sessionId=r,this.sendUserId=null,this.messageType=null,this.content=null,this.createTime=null,this.status=null}}),ModuleBase.define("RpcManager",["Error"],function(s){var t=function(){this.RpcManagerCallbackEnum={CALL_RESPONSE_SUCCESS:"call.response.success",CALL_RESPONSE_ERROR:"call.response.error"},this.eventEmitter=new EventEmitter};return t.prototype.call=function(t){var o=when.defer(),e=signalClient.selfUser.userId;return signalClient.rtmServer.sendRpcCall(e,"root","/s",t).then(function(t){console.log("=========RpcManager.call(),result rpcData:",t);var e=new Uint8Array(t),r=typeConversionUtil.Uint8ArrayToString(e),n=JSON.parse(r);if(console.log("=========RpcManager.call(),result Json:",n),n.error){var i=new s(n.error.code,n.error.message);o.reject(i)}else o.resolve(n.result)}).otherwise(function(t){o.reject(t)}),o.promise},t.prototype.notification=function(t){var e=when.defer(),r=signalClient.selfUser.userId;return signalClient.rtmServer.sendRpcNotification(r,"root","/s",t).then(function(){e.resolve()}).otherwise(function(t){e.reject(t)}),e.promise},t.prototype.addCallback=function(t,e){this.eventEmitter.on(t,e)},t.prototype.offCallback=function(t){for(var e in t){var r=t[e];this.eventEmitter.removeAllListeners(r)}},t}),!log)var log=log4javascript.getLogger();if(!bugout)var bugout=null;var signalClient=null,Task_Id=0,rtmVersion="1.0.0.0";ModuleBase.define("Client",["RestServer","RtmManager","RtmServer","ClientUser","InviteManager","RemoteControlManager","ChatManager","RpcManager","Error"],function(r,e,s,a,t,n,i,o,l){var u=function(t,e){this.serverURI=t,this.accessToken=e,this.mqttWSAddr=null,this.restServer=new r,this.rtmManager=null,this.rtmServer=null,this.inviteManager=null,this.remoteControlManager=null,this.chatManager=null,this.rpcManager=null,this.selfUser=null,signalClient=this};return u.prototype.getVersion=function(){return"cn.tee3.rtm-"+rtmVersion},u.prototype.setLog=function(t,e){var r,n,i;t==Appender.alert?r=new log4javascript.AlertAppender:t==Appender.inpage?r=new log4javascript.InPageAppender:t==Appender.popup?r=new log4javascript.PopUpAppender:t==Appender.browserConsole&&(r=new log4javascript.BrowserConsoleAppender),e==LogLevel.all?r.setThreshold(log4javascript.Level.ALL):e==LogLevel.trace?r.setThreshold(log4javascript.Level.TRACE):e==LogLevel.debug?r.setThreshold(log4javascript.Level.DEBUG):e==LogLevel.info?r.setThreshold(log4javascript.Level.INFO):e==LogLevel.warn?r.setThreshold(log4javascript.Level.WARN):e==LogLevel.error?r.setThreshold(log4javascript.Level.ERROR):e==LogLevel.fatal?r.setThreshold(log4javascript.Level.FATAL):e==LogLevel.off&&r.setThreshold(log4javascript.Level.OFF),n=r,i=new log4javascript.PatternLayout("%d{yyyy-MM-dd HH:mm:ss SSS} %-5p - %m{1}%n"),n.setLayout(i),log.addAppender(n)},u.prototype.login=function(r,n){var i=when.defer(),o=this;return o.restServer.getMqttWSAddr(o.serverURI,o.accessToken).then(function(t){console.log("login resule  mqttWSAddr:",t),o.mqttWSAddr=t,o.rtmManager=new e(o.mqttWSAddr,r,n),o.rtmManager.connect().then(function(t){signalClient.rtmServer=new s(t),signalClient.rtmServer.subscribe("/u/"+r);var e=new a(r,n);o.selfUser=e,i.resolve()}).otherwise(function(t){i.reject(t)})}).otherwise(function(t){console.log("login error:",t),i.reject(t)}),i.promise},u.prototype.logout=function(t){var e=when.defer();try{this.rtmServer.end(),signalClient=null,this.selfUser=null,e.resolve()}catch(t){e.reject(t)}return e.promise},u.prototype.getInviteManager=function(){return this.inviteManager||(this.inviteManager=new t),this.inviteManager},u.prototype.getRemoteControlManager=function(){return this.remoteControlManager||(this.remoteControlManager=new n),this.remoteControlManager},u.prototype.getChatManager=function(){return this.chatManager||(this.chatManager=new i),this.chatManager},u.prototype.getRpcManager=function(){return this.rpcManager||(this.rpcManager=new o),this.rpcManager},u.prototype.getServeTime=function(){var t=new Date;t.setMinutes(t.getMinutes()+t.getTimezoneOffset());var e=t.getTime();return e=Math.round(e/1e3)},u.prototype.addCallback=function(t,e){this.eventEmitter.on(t,e)},u.prototype.offCallback=function(t){for(var e in t){var r=t[e];this.eventEmitter.off(r)}},u}),function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.axios=e():t.axios=e()}(this,function(){return function(r){function n(t){if(i[t])return i[t].exports;var e=i[t]={exports:{},id:t,loaded:!1};return r[t].call(e.exports,e,e.exports,n),e.loaded=!0,e.exports}var i={};return n.m=r,n.c=i,n.p="",n(0)}([function(t,e,r){t.exports=r(1)},function(t,e,r){"use strict";function n(t){var e=new s(t),r=o(s.prototype.request,e);return i.extend(r,s.prototype,e),i.extend(r,e),r}var i=r(2),o=r(3),s=r(4),a=r(5),l=n(a);l.Axios=s,l.create=function(t){return n(i.merge(a,t))},l.Cancel=r(22),l.CancelToken=r(23),l.isCancel=r(19),l.all=function(t){return Promise.all(t)},l.spread=r(24),t.exports=l,t.exports.default=l},function(t,e,r){"use strict";function o(t){return"[object Array]"===l.call(t)}function n(t){return null!==t&&"object"==typeof t}function i(t){return"[object Function]"===l.call(t)}function s(t,e){if(null!=t)if("object"==typeof t||o(t)||(t=[t]),o(t))for(var r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.call(null,t[i],i,t)}var a=r(3),l=Object.prototype.toString;t.exports={isArray:o,isArrayBuffer:function(t){return"[object ArrayBuffer]"===l.call(t)},isFormData:function(t){return"undefined"!=typeof FormData&&t instanceof FormData},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:n,isUndefined:function(t){return void 0===t},isDate:function(t){return"[object Date]"===l.call(t)},isFile:function(t){return"[object File]"===l.call(t)},isBlob:function(t){return"[object Blob]"===l.call(t)},isFunction:i,isStream:function(t){return n(t)&&i(t.pipe)},isURLSearchParams:function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams},isStandardBrowserEnv:function(){return"undefined"!=typeof window&&"undefined"!=typeof document&&"function"==typeof document.createElement},forEach:s,merge:function r(){function t(t,e){"object"==typeof n[e]&&"object"==typeof t?n[e]=r(n[e],t):n[e]=t}for(var n={},e=0,i=arguments.length;e<i;e++)s(arguments[e],t);return n},extend:function(r,t,n){return s(t,function(t,e){r[e]=n&&"function"==typeof t?a(t,n):t}),r},trim:function(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(t,e){"use strict";t.exports=function(r,n){return function(){for(var t=new Array(arguments.length),e=0;e<t.length;e++)t[e]=arguments[e];return r.apply(n,t)}}},function(t,e,r){"use strict";function i(t){this.defaults=t,this.interceptors={request:new s,response:new s}}var n=r(5),o=r(2),s=r(16),a=r(17),l=r(20),u=r(21);i.prototype.request=function(t){"string"==typeof t&&(t=o.merge({url:arguments[0]},arguments[1])),(t=o.merge(n,this.defaults,{method:"get"},t)).baseURL&&!l(t.url)&&(t.url=u(t.baseURL,t.url));var e=[a,void 0],r=Promise.resolve(t);for(this.interceptors.request.forEach(function(t){e.unshift(t.fulfilled,t.rejected)}),this.interceptors.response.forEach(function(t){e.push(t.fulfilled,t.rejected)});e.length;)r=r.then(e.shift(),e.shift());return r},o.forEach(["delete","get","head"],function(r){i.prototype[r]=function(t,e){return this.request(o.merge(e||{},{method:r,url:t}))}}),o.forEach(["post","put","patch"],function(n){i.prototype[n]=function(t,e,r){return this.request(o.merge(r||{},{method:n,url:t,data:e}))}}),t.exports=i},function(t,e,r){"use strict";function n(t,e){!o.isUndefined(t)&&o.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var i,o=r(2),s=r(6),a=/^\)\]\}',?\n/,l={"Content-Type":"application/x-www-form-urlencoded"},u={adapter:("undefined"!=typeof XMLHttpRequest?i=r(7):"undefined"!=typeof process&&(i=r(7)),i),transformRequest:[function(t,e){return s(e,"Content-Type"),o.isFormData(t)||o.isArrayBuffer(t)||o.isStream(t)||o.isFile(t)||o.isBlob(t)?t:o.isArrayBufferView(t)?t.buffer:o.isURLSearchParams(t)?(n(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):o.isObject(t)?(n(e,"application/json;charset=utf-8"),JSON.stringify(t)):t}],transformResponse:[function(t){if("string"==typeof t){t=t.replace(a,"");try{t=JSON.parse(t)}catch(t){}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(t){return 200<=t&&t<300}};u.headers={common:{Accept:"application/json, text/plain, */*"}},o.forEach(["delete","get","head"],function(t){u.headers[t]={}}),o.forEach(["post","put","patch"],function(t){u.headers[t]=o.merge(l)}),t.exports=u},function(t,e,r){"use strict";var i=r(2);t.exports=function(r,n){i.forEach(r,function(t,e){e!==n&&e.toUpperCase()===n.toUpperCase()&&(r[n]=t,delete r[e])})}},function(t,e,f){"use strict";var p=f(2),d=f(8),g=f(11),m=f(12),v=f(13),y=f(9),b="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||f(14);t.exports=function(h){return new Promise(function(r,n){var i=h.data,o=h.headers;p.isFormData(i)&&delete o["Content-Type"];var s=new XMLHttpRequest,t="onreadystatechange",a=!1;if("undefined"==typeof window||!window.XDomainRequest||"withCredentials"in s||v(h.url)||(s=new window.XDomainRequest,t="onload",a=!0,s.onprogress=function(){},s.ontimeout=function(){}),h.auth){var e=h.auth.username||"",l=h.auth.password||"";o.Authorization="Basic "+b(e+":"+l)}if(s.open(h.method.toUpperCase(),g(h.url,h.params,h.paramsSerializer),!0),s.timeout=h.timeout,s[t]=function(){if(s&&(4===s.readyState||a)&&(0!==s.status||s.responseURL&&0===s.responseURL.indexOf("file:"))){var t="getAllResponseHeaders"in s?m(s.getAllResponseHeaders()):null,e={data:h.responseType&&"text"!==h.responseType?s.response:s.responseText,status:1223===s.status?204:s.status,statusText:1223===s.status?"No Content":s.statusText,headers:t,config:h,request:s};d(r,n,e),s=null}},s.onerror=function(){n(y("Network Error",h)),s=null},s.ontimeout=function(){n(y("timeout of "+h.timeout+"ms exceeded",h,"ECONNABORTED")),s=null},p.isStandardBrowserEnv()){var u=f(15),c=(h.withCredentials||v(h.url))&&h.xsrfCookieName?u.read(h.xsrfCookieName):void 0;c&&(o[h.xsrfHeaderName]=c)}if("setRequestHeader"in s&&p.forEach(o,function(t,e){void 0===i&&"content-type"===e.toLowerCase()?delete o[e]:s.setRequestHeader(e,t)}),h.withCredentials&&(s.withCredentials=!0),h.responseType)try{s.responseType=h.responseType}catch(t){if("json"!==s.responseType)throw t}"function"==typeof h.onDownloadProgress&&s.addEventListener("progress",h.onDownloadProgress),"function"==typeof h.onUploadProgress&&s.upload&&s.upload.addEventListener("progress",h.onUploadProgress),h.cancelToken&&h.cancelToken.promise.then(function(t){s&&(s.abort(),n(t),s=null)}),void 0===i&&(i=null),s.send(i)})}},function(t,e,r){"use strict";var i=r(9);t.exports=function(t,e,r){var n=r.config.validateStatus;r.status&&n&&!n(r.status)?e(i("Request failed with status code "+r.status,r.config,null,r)):t(r)}},function(t,e,r){"use strict";var o=r(10);t.exports=function(t,e,r,n){var i=new Error(t);return o(i,e,r,n)}},function(t,e){"use strict";t.exports=function(t,e,r,n){return t.config=e,r&&(t.code=r),t.response=n,t}},function(t,e,r){"use strict";function o(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var s=r(2);t.exports=function(t,e,r){if(!e)return t;var n;if(r)n=r(e);else if(s.isURLSearchParams(e))n=e.toString();else{var i=[];s.forEach(e,function(t,e){null!=t&&(s.isArray(t)&&(e+="[]"),s.isArray(t)||(t=[t]),s.forEach(t,function(t){s.isDate(t)?t=t.toISOString():s.isObject(t)&&(t=JSON.stringify(t)),i.push(o(e)+"="+o(t))}))}),n=i.join("&")}return n&&(t+=(-1===t.indexOf("?")?"?":"&")+n),t}},function(t,e,r){"use strict";var o=r(2);t.exports=function(t){var e,r,n,i={};return t&&o.forEach(t.split("\n"),function(t){n=t.indexOf(":"),e=o.trim(t.substr(0,n)).toLowerCase(),r=o.trim(t.substr(n+1)),e&&(i[e]=i[e]?i[e]+", "+r:r)}),i}},function(t,e,r){"use strict";var s=r(2);t.exports=s.isStandardBrowserEnv()?function(){function r(t){var e=t;return i&&(o.setAttribute("href",e),e=o.href),o.setAttribute("href",e),{href:o.href,protocol:o.protocol?o.protocol.replace(/:$/,""):"",host:o.host,search:o.search?o.search.replace(/^\?/,""):"",hash:o.hash?o.hash.replace(/^#/,""):"",hostname:o.hostname,port:o.port,pathname:"/"===o.pathname.charAt(0)?o.pathname:"/"+o.pathname}}var n,i=/(msie|trident)/i.test(navigator.userAgent),o=document.createElement("a");return n=r(window.location.href),function(t){var e=s.isString(t)?r(t):t;return e.protocol===n.protocol&&e.host===n.host}}():function(){return!0}},function(t,e){"use strict";function a(){this.message="String contains an invalid character"}(a.prototype=new Error).code=5,a.prototype.name="InvalidCharacterError",t.exports=function(t){for(var e,r,n=String(t),i="",o=0,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.charAt(0|o)||(s="=",o%1);i+=s.charAt(63&e>>8-o%1*8)){if(255<(r=n.charCodeAt(o+=.75)))throw new a;e=e<<8|r}return i}},function(t,e,r){"use strict";var a=r(2);t.exports=a.isStandardBrowserEnv()?{write:function(t,e,r,n,i,o){var s=[];s.push(t+"="+encodeURIComponent(e)),a.isNumber(r)&&s.push("expires="+new Date(r).toGMTString()),a.isString(n)&&s.push("path="+n),a.isString(i)&&s.push("domain="+i),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(t,e,r){"use strict";function n(){this.handlers=[]}var i=r(2);n.prototype.use=function(t,e){return this.handlers.push({fulfilled:t,rejected:e}),this.handlers.length-1},n.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},n.prototype.forEach=function(e){i.forEach(this.handlers,function(t){null!==t&&e(t)})},t.exports=n},function(t,e,r){"use strict";function n(t){t.cancelToken&&t.cancelToken.throwIfRequested()}var i=r(2),o=r(18),s=r(19),a=r(5);t.exports=function(e){return n(e),e.headers=e.headers||{},e.data=o(e.data,e.headers,e.transformRequest),e.headers=i.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),i.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||a.adapter)(e).then(function(t){return n(e),t.data=o(t.data,t.headers,e.transformResponse),t},function(t){return s(t)||(n(e),t&&t.response&&(t.response.data=o(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})}},function(t,e,r){"use strict";var n=r(2);t.exports=function(e,r,t){return n.forEach(t,function(t){e=t(e,r)}),e}},function(t,e){"use strict";t.exports=function(t){return!(!t||!t.__CANCEL__)}},function(t,e){"use strict";t.exports=function(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)}},function(t,e){"use strict";t.exports=function(t,e){return t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,"")}},function(t,e){"use strict";function r(t){this.message=t}r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,t.exports=r},function(t,e,r){"use strict";function n(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise(function(t){e=t});var r=this;t(function(t){r.reason||(r.reason=new i(t),e(r.reason))})}var i=r(22);n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.source=function(){var e;return{token:new n(function(t){e=t}),cancel:e}},t.exports=n},function(t,e){"use strict";t.exports=function(e){return function(t){return e.apply(null,t)}}}])});